var yP=Object.defineProperty;var xP=(u,p,y)=>p in u?yP(u,p,{enumerable:!0,configurable:!0,writable:!0,value:y}):u[p]=y;var Q0=(u,p,y)=>xP(u,typeof p!="symbol"?p+"":p,y);(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const C of document.querySelectorAll('link[rel="modulepreload"]'))b(C);new MutationObserver(C=>{for(const M of C)if(M.type==="childList")for(const D of M.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&b(D)}).observe(document,{childList:!0,subtree:!0});function y(C){const M={};return C.integrity&&(M.integrity=C.integrity),C.referrerPolicy&&(M.referrerPolicy=C.referrerPolicy),C.crossOrigin==="use-credentials"?M.credentials="include":C.crossOrigin==="anonymous"?M.credentials="omit":M.credentials="same-origin",M}function b(C){if(C.ep)return;C.ep=!0;const M=y(C);fetch(C.href,M)}})();function l3(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var ex={exports:{}},fg={},tx={exports:{}},dr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B2;function vP(){if(B2)return dr;B2=1;var u=Symbol.for("react.element"),p=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),M=Symbol.for("react.provider"),D=Symbol.for("react.context"),r=Symbol.for("react.forward_ref"),U=Symbol.for("react.suspense"),G=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),se=Symbol.iterator;function de(Ue){return Ue===null||typeof Ue!="object"?null:(Ue=se&&Ue[se]||Ue["@@iterator"],typeof Ue=="function"?Ue:null)}var Pe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Se=Object.assign,ve={};function ce(Ue,zt,un){this.props=Ue,this.context=zt,this.refs=ve,this.updater=un||Pe}ce.prototype.isReactComponent={},ce.prototype.setState=function(Ue,zt){if(typeof Ue!="object"&&typeof Ue!="function"&&Ue!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Ue,zt,"setState")},ce.prototype.forceUpdate=function(Ue){this.updater.enqueueForceUpdate(this,Ue,"forceUpdate")};function ze(){}ze.prototype=ce.prototype;function et(Ue,zt,un){this.props=Ue,this.context=zt,this.refs=ve,this.updater=un||Pe}var pt=et.prototype=new ze;pt.constructor=et,Se(pt,ce.prototype),pt.isPureReactComponent=!0;var Tt=Array.isArray,It=Object.prototype.hasOwnProperty,di={current:null},Bt={key:!0,ref:!0,__self:!0,__source:!0};function Yt(Ue,zt,un){var ln,Di={},Zi=null,fn=null;if(zt!=null)for(ln in zt.ref!==void 0&&(fn=zt.ref),zt.key!==void 0&&(Zi=""+zt.key),zt)It.call(zt,ln)&&!Bt.hasOwnProperty(ln)&&(Di[ln]=zt[ln]);var Ln=arguments.length-2;if(Ln===1)Di.children=un;else if(1<Ln){for(var Xi=Array(Ln),Hr=0;Hr<Ln;Hr++)Xi[Hr]=arguments[Hr+2];Di.children=Xi}if(Ue&&Ue.defaultProps)for(ln in Ln=Ue.defaultProps,Ln)Di[ln]===void 0&&(Di[ln]=Ln[ln]);return{$$typeof:u,type:Ue,key:Zi,ref:fn,props:Di,_owner:di.current}}function vt(Ue,zt){return{$$typeof:u,type:Ue.type,key:zt,ref:Ue.ref,props:Ue.props,_owner:Ue._owner}}function Jt(Ue){return typeof Ue=="object"&&Ue!==null&&Ue.$$typeof===u}function Ht(Ue){var zt={"=":"=0",":":"=2"};return"$"+Ue.replace(/[=:]/g,function(un){return zt[un]})}var Nt=/\/+/g;function Li(Ue,zt){return typeof Ue=="object"&&Ue!==null&&Ue.key!=null?Ht(""+Ue.key):zt.toString(36)}function Dt(Ue,zt,un,ln,Di){var Zi=typeof Ue;(Zi==="undefined"||Zi==="boolean")&&(Ue=null);var fn=!1;if(Ue===null)fn=!0;else switch(Zi){case"string":case"number":fn=!0;break;case"object":switch(Ue.$$typeof){case u:case p:fn=!0}}if(fn)return fn=Ue,Di=Di(fn),Ue=ln===""?"."+Li(fn,0):ln,Tt(Di)?(un="",Ue!=null&&(un=Ue.replace(Nt,"$&/")+"/"),Dt(Di,zt,un,"",function(Hr){return Hr})):Di!=null&&(Jt(Di)&&(Di=vt(Di,un+(!Di.key||fn&&fn.key===Di.key?"":(""+Di.key).replace(Nt,"$&/")+"/")+Ue)),zt.push(Di)),1;if(fn=0,ln=ln===""?".":ln+":",Tt(Ue))for(var Ln=0;Ln<Ue.length;Ln++){Zi=Ue[Ln];var Xi=ln+Li(Zi,Ln);fn+=Dt(Zi,zt,un,Xi,Di)}else if(Xi=de(Ue),typeof Xi=="function")for(Ue=Xi.call(Ue),Ln=0;!(Zi=Ue.next()).done;)Zi=Zi.value,Xi=ln+Li(Zi,Ln++),fn+=Dt(Zi,zt,un,Xi,Di);else if(Zi==="object")throw zt=String(Ue),Error("Objects are not valid as a React child (found: "+(zt==="[object Object]"?"object with keys {"+Object.keys(Ue).join(", ")+"}":zt)+"). If you meant to render a collection of children, use an array instead.");return fn}function Ci(Ue,zt,un){if(Ue==null)return Ue;var ln=[],Di=0;return Dt(Ue,ln,"","",function(Zi){return zt.call(un,Zi,Di++)}),ln}function yi(Ue){if(Ue._status===-1){var zt=Ue._result;zt=zt(),zt.then(function(un){(Ue._status===0||Ue._status===-1)&&(Ue._status=1,Ue._result=un)},function(un){(Ue._status===0||Ue._status===-1)&&(Ue._status=2,Ue._result=un)}),Ue._status===-1&&(Ue._status=0,Ue._result=zt)}if(Ue._status===1)return Ue._result.default;throw Ue._result}var xi={current:null},$t={transition:null},Ei={ReactCurrentDispatcher:xi,ReactCurrentBatchConfig:$t,ReactCurrentOwner:di};function Kt(){throw Error("act(...) is not supported in production builds of React.")}return dr.Children={map:Ci,forEach:function(Ue,zt,un){Ci(Ue,function(){zt.apply(this,arguments)},un)},count:function(Ue){var zt=0;return Ci(Ue,function(){zt++}),zt},toArray:function(Ue){return Ci(Ue,function(zt){return zt})||[]},only:function(Ue){if(!Jt(Ue))throw Error("React.Children.only expected to receive a single React element child.");return Ue}},dr.Component=ce,dr.Fragment=y,dr.Profiler=C,dr.PureComponent=et,dr.StrictMode=b,dr.Suspense=U,dr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ei,dr.act=Kt,dr.cloneElement=function(Ue,zt,un){if(Ue==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Ue+".");var ln=Se({},Ue.props),Di=Ue.key,Zi=Ue.ref,fn=Ue._owner;if(zt!=null){if(zt.ref!==void 0&&(Zi=zt.ref,fn=di.current),zt.key!==void 0&&(Di=""+zt.key),Ue.type&&Ue.type.defaultProps)var Ln=Ue.type.defaultProps;for(Xi in zt)It.call(zt,Xi)&&!Bt.hasOwnProperty(Xi)&&(ln[Xi]=zt[Xi]===void 0&&Ln!==void 0?Ln[Xi]:zt[Xi])}var Xi=arguments.length-2;if(Xi===1)ln.children=un;else if(1<Xi){Ln=Array(Xi);for(var Hr=0;Hr<Xi;Hr++)Ln[Hr]=arguments[Hr+2];ln.children=Ln}return{$$typeof:u,type:Ue.type,key:Di,ref:Zi,props:ln,_owner:fn}},dr.createContext=function(Ue){return Ue={$$typeof:D,_currentValue:Ue,_currentValue2:Ue,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Ue.Provider={$$typeof:M,_context:Ue},Ue.Consumer=Ue},dr.createElement=Yt,dr.createFactory=function(Ue){var zt=Yt.bind(null,Ue);return zt.type=Ue,zt},dr.createRef=function(){return{current:null}},dr.forwardRef=function(Ue){return{$$typeof:r,render:Ue}},dr.isValidElement=Jt,dr.lazy=function(Ue){return{$$typeof:Q,_payload:{_status:-1,_result:Ue},_init:yi}},dr.memo=function(Ue,zt){return{$$typeof:G,type:Ue,compare:zt===void 0?null:zt}},dr.startTransition=function(Ue){var zt=$t.transition;$t.transition={};try{Ue()}finally{$t.transition=zt}},dr.unstable_act=Kt,dr.useCallback=function(Ue,zt){return xi.current.useCallback(Ue,zt)},dr.useContext=function(Ue){return xi.current.useContext(Ue)},dr.useDebugValue=function(){},dr.useDeferredValue=function(Ue){return xi.current.useDeferredValue(Ue)},dr.useEffect=function(Ue,zt){return xi.current.useEffect(Ue,zt)},dr.useId=function(){return xi.current.useId()},dr.useImperativeHandle=function(Ue,zt,un){return xi.current.useImperativeHandle(Ue,zt,un)},dr.useInsertionEffect=function(Ue,zt){return xi.current.useInsertionEffect(Ue,zt)},dr.useLayoutEffect=function(Ue,zt){return xi.current.useLayoutEffect(Ue,zt)},dr.useMemo=function(Ue,zt){return xi.current.useMemo(Ue,zt)},dr.useReducer=function(Ue,zt,un){return xi.current.useReducer(Ue,zt,un)},dr.useRef=function(Ue){return xi.current.useRef(Ue)},dr.useState=function(Ue){return xi.current.useState(Ue)},dr.useSyncExternalStore=function(Ue,zt,un){return xi.current.useSyncExternalStore(Ue,zt,un)},dr.useTransition=function(){return xi.current.useTransition()},dr.version="18.3.1",dr}var j2;function fv(){return j2||(j2=1,tx.exports=vP()),tx.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V2;function wP(){if(V2)return fg;V2=1;var u=fv(),p=Symbol.for("react.element"),y=Symbol.for("react.fragment"),b=Object.prototype.hasOwnProperty,C=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,M={key:!0,ref:!0,__self:!0,__source:!0};function D(r,U,G){var Q,se={},de=null,Pe=null;G!==void 0&&(de=""+G),U.key!==void 0&&(de=""+U.key),U.ref!==void 0&&(Pe=U.ref);for(Q in U)b.call(U,Q)&&!M.hasOwnProperty(Q)&&(se[Q]=U[Q]);if(r&&r.defaultProps)for(Q in U=r.defaultProps,U)se[Q]===void 0&&(se[Q]=U[Q]);return{$$typeof:p,type:r,key:de,ref:Pe,props:se,_owner:C.current}}return fg.Fragment=y,fg.jsx=D,fg.jsxs=D,fg}var U2;function bP(){return U2||(U2=1,ex.exports=wP()),ex.exports}var V=bP(),H_={},ix={exports:{}},qa={},nx={exports:{}},rx={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G2;function TP(){return G2||(G2=1,function(u){function p($t,Ei){var Kt=$t.length;$t.push(Ei);e:for(;0<Kt;){var Ue=Kt-1>>>1,zt=$t[Ue];if(0<C(zt,Ei))$t[Ue]=Ei,$t[Kt]=zt,Kt=Ue;else break e}}function y($t){return $t.length===0?null:$t[0]}function b($t){if($t.length===0)return null;var Ei=$t[0],Kt=$t.pop();if(Kt!==Ei){$t[0]=Kt;e:for(var Ue=0,zt=$t.length,un=zt>>>1;Ue<un;){var ln=2*(Ue+1)-1,Di=$t[ln],Zi=ln+1,fn=$t[Zi];if(0>C(Di,Kt))Zi<zt&&0>C(fn,Di)?($t[Ue]=fn,$t[Zi]=Kt,Ue=Zi):($t[Ue]=Di,$t[ln]=Kt,Ue=ln);else if(Zi<zt&&0>C(fn,Kt))$t[Ue]=fn,$t[Zi]=Kt,Ue=Zi;else break e}}return Ei}function C($t,Ei){var Kt=$t.sortIndex-Ei.sortIndex;return Kt!==0?Kt:$t.id-Ei.id}if(typeof performance=="object"&&typeof performance.now=="function"){var M=performance;u.unstable_now=function(){return M.now()}}else{var D=Date,r=D.now();u.unstable_now=function(){return D.now()-r}}var U=[],G=[],Q=1,se=null,de=3,Pe=!1,Se=!1,ve=!1,ce=typeof setTimeout=="function"?setTimeout:null,ze=typeof clearTimeout=="function"?clearTimeout:null,et=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function pt($t){for(var Ei=y(G);Ei!==null;){if(Ei.callback===null)b(G);else if(Ei.startTime<=$t)b(G),Ei.sortIndex=Ei.expirationTime,p(U,Ei);else break;Ei=y(G)}}function Tt($t){if(ve=!1,pt($t),!Se)if(y(U)!==null)Se=!0,yi(It);else{var Ei=y(G);Ei!==null&&xi(Tt,Ei.startTime-$t)}}function It($t,Ei){Se=!1,ve&&(ve=!1,ze(Yt),Yt=-1),Pe=!0;var Kt=de;try{for(pt(Ei),se=y(U);se!==null&&(!(se.expirationTime>Ei)||$t&&!Ht());){var Ue=se.callback;if(typeof Ue=="function"){se.callback=null,de=se.priorityLevel;var zt=Ue(se.expirationTime<=Ei);Ei=u.unstable_now(),typeof zt=="function"?se.callback=zt:se===y(U)&&b(U),pt(Ei)}else b(U);se=y(U)}if(se!==null)var un=!0;else{var ln=y(G);ln!==null&&xi(Tt,ln.startTime-Ei),un=!1}return un}finally{se=null,de=Kt,Pe=!1}}var di=!1,Bt=null,Yt=-1,vt=5,Jt=-1;function Ht(){return!(u.unstable_now()-Jt<vt)}function Nt(){if(Bt!==null){var $t=u.unstable_now();Jt=$t;var Ei=!0;try{Ei=Bt(!0,$t)}finally{Ei?Li():(di=!1,Bt=null)}}else di=!1}var Li;if(typeof et=="function")Li=function(){et(Nt)};else if(typeof MessageChannel<"u"){var Dt=new MessageChannel,Ci=Dt.port2;Dt.port1.onmessage=Nt,Li=function(){Ci.postMessage(null)}}else Li=function(){ce(Nt,0)};function yi($t){Bt=$t,di||(di=!0,Li())}function xi($t,Ei){Yt=ce(function(){$t(u.unstable_now())},Ei)}u.unstable_IdlePriority=5,u.unstable_ImmediatePriority=1,u.unstable_LowPriority=4,u.unstable_NormalPriority=3,u.unstable_Profiling=null,u.unstable_UserBlockingPriority=2,u.unstable_cancelCallback=function($t){$t.callback=null},u.unstable_continueExecution=function(){Se||Pe||(Se=!0,yi(It))},u.unstable_forceFrameRate=function($t){0>$t||125<$t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):vt=0<$t?Math.floor(1e3/$t):5},u.unstable_getCurrentPriorityLevel=function(){return de},u.unstable_getFirstCallbackNode=function(){return y(U)},u.unstable_next=function($t){switch(de){case 1:case 2:case 3:var Ei=3;break;default:Ei=de}var Kt=de;de=Ei;try{return $t()}finally{de=Kt}},u.unstable_pauseExecution=function(){},u.unstable_requestPaint=function(){},u.unstable_runWithPriority=function($t,Ei){switch($t){case 1:case 2:case 3:case 4:case 5:break;default:$t=3}var Kt=de;de=$t;try{return Ei()}finally{de=Kt}},u.unstable_scheduleCallback=function($t,Ei,Kt){var Ue=u.unstable_now();switch(typeof Kt=="object"&&Kt!==null?(Kt=Kt.delay,Kt=typeof Kt=="number"&&0<Kt?Ue+Kt:Ue):Kt=Ue,$t){case 1:var zt=-1;break;case 2:zt=250;break;case 5:zt=1073741823;break;case 4:zt=1e4;break;default:zt=5e3}return zt=Kt+zt,$t={id:Q++,callback:Ei,priorityLevel:$t,startTime:Kt,expirationTime:zt,sortIndex:-1},Kt>Ue?($t.sortIndex=Kt,p(G,$t),y(U)===null&&$t===y(G)&&(ve?(ze(Yt),Yt=-1):ve=!0,xi(Tt,Kt-Ue))):($t.sortIndex=zt,p(U,$t),Se||Pe||(Se=!0,yi(It))),$t},u.unstable_shouldYield=Ht,u.unstable_wrapCallback=function($t){var Ei=de;return function(){var Kt=de;de=Ei;try{return $t.apply(this,arguments)}finally{de=Kt}}}}(rx)),rx}var $2;function SP(){return $2||($2=1,nx.exports=TP()),nx.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H2;function EP(){if(H2)return qa;H2=1;var u=fv(),p=SP();function y(f){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+f,E=1;E<arguments.length;E++)g+="&args[]="+encodeURIComponent(arguments[E]);return"Minified React error #"+f+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var b=new Set,C={};function M(f,g){D(f,g),D(f+"Capture",g)}function D(f,g){for(C[f]=g,f=0;f<g.length;f++)b.add(g[f])}var r=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),U=Object.prototype.hasOwnProperty,G=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Q={},se={};function de(f){return U.call(se,f)?!0:U.call(Q,f)?!1:G.test(f)?se[f]=!0:(Q[f]=!0,!1)}function Pe(f,g,E,z){if(E!==null&&E.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return z?!1:E!==null?!E.acceptsBooleans:(f=f.toLowerCase().slice(0,5),f!=="data-"&&f!=="aria-");default:return!1}}function Se(f,g,E,z){if(g===null||typeof g>"u"||Pe(f,g,E,z))return!0;if(z)return!1;if(E!==null)switch(E.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function ve(f,g,E,z,$,K,_e){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=z,this.attributeNamespace=$,this.mustUseProperty=E,this.propertyName=f,this.type=g,this.sanitizeURL=K,this.removeEmptyString=_e}var ce={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(f){ce[f]=new ve(f,0,!1,f,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(f){var g=f[0];ce[g]=new ve(g,1,!1,f[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(f){ce[f]=new ve(f,2,!1,f.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(f){ce[f]=new ve(f,2,!1,f,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(f){ce[f]=new ve(f,3,!1,f.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(f){ce[f]=new ve(f,3,!0,f,null,!1,!1)}),["capture","download"].forEach(function(f){ce[f]=new ve(f,4,!1,f,null,!1,!1)}),["cols","rows","size","span"].forEach(function(f){ce[f]=new ve(f,6,!1,f,null,!1,!1)}),["rowSpan","start"].forEach(function(f){ce[f]=new ve(f,5,!1,f.toLowerCase(),null,!1,!1)});var ze=/[\-:]([a-z])/g;function et(f){return f[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(f){var g=f.replace(ze,et);ce[g]=new ve(g,1,!1,f,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(f){var g=f.replace(ze,et);ce[g]=new ve(g,1,!1,f,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(f){var g=f.replace(ze,et);ce[g]=new ve(g,1,!1,f,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(f){ce[f]=new ve(f,1,!1,f.toLowerCase(),null,!1,!1)}),ce.xlinkHref=new ve("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(f){ce[f]=new ve(f,1,!1,f.toLowerCase(),null,!0,!0)});function pt(f,g,E,z){var $=ce.hasOwnProperty(g)?ce[g]:null;($!==null?$.type!==0:z||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(Se(g,E,$,z)&&(E=null),z||$===null?de(g)&&(E===null?f.removeAttribute(g):f.setAttribute(g,""+E)):$.mustUseProperty?f[$.propertyName]=E===null?$.type===3?!1:"":E:(g=$.attributeName,z=$.attributeNamespace,E===null?f.removeAttribute(g):($=$.type,E=$===3||$===4&&E===!0?"":""+E,z?f.setAttributeNS(z,g,E):f.setAttribute(g,E))))}var Tt=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,It=Symbol.for("react.element"),di=Symbol.for("react.portal"),Bt=Symbol.for("react.fragment"),Yt=Symbol.for("react.strict_mode"),vt=Symbol.for("react.profiler"),Jt=Symbol.for("react.provider"),Ht=Symbol.for("react.context"),Nt=Symbol.for("react.forward_ref"),Li=Symbol.for("react.suspense"),Dt=Symbol.for("react.suspense_list"),Ci=Symbol.for("react.memo"),yi=Symbol.for("react.lazy"),xi=Symbol.for("react.offscreen"),$t=Symbol.iterator;function Ei(f){return f===null||typeof f!="object"?null:(f=$t&&f[$t]||f["@@iterator"],typeof f=="function"?f:null)}var Kt=Object.assign,Ue;function zt(f){if(Ue===void 0)try{throw Error()}catch(E){var g=E.stack.trim().match(/\n( *(at )?)/);Ue=g&&g[1]||""}return`
`+Ue+f}var un=!1;function ln(f,g){if(!f||un)return"";un=!0;var E=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(bt){var z=bt}Reflect.construct(f,[],g)}else{try{g.call()}catch(bt){z=bt}f.call(g.prototype)}else{try{throw Error()}catch(bt){z=bt}f()}}catch(bt){if(bt&&z&&typeof bt.stack=="string"){for(var $=bt.stack.split(`
`),K=z.stack.split(`
`),_e=$.length-1,Ve=K.length-1;1<=_e&&0<=Ve&&$[_e]!==K[Ve];)Ve--;for(;1<=_e&&0<=Ve;_e--,Ve--)if($[_e]!==K[Ve]){if(_e!==1||Ve!==1)do if(_e--,Ve--,0>Ve||$[_e]!==K[Ve]){var Ye=`
`+$[_e].replace(" at new "," at ");return f.displayName&&Ye.includes("<anonymous>")&&(Ye=Ye.replace("<anonymous>",f.displayName)),Ye}while(1<=_e&&0<=Ve);break}}}finally{un=!1,Error.prepareStackTrace=E}return(f=f?f.displayName||f.name:"")?zt(f):""}function Di(f){switch(f.tag){case 5:return zt(f.type);case 16:return zt("Lazy");case 13:return zt("Suspense");case 19:return zt("SuspenseList");case 0:case 2:case 15:return f=ln(f.type,!1),f;case 11:return f=ln(f.type.render,!1),f;case 1:return f=ln(f.type,!0),f;default:return""}}function Zi(f){if(f==null)return null;if(typeof f=="function")return f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case Bt:return"Fragment";case di:return"Portal";case vt:return"Profiler";case Yt:return"StrictMode";case Li:return"Suspense";case Dt:return"SuspenseList"}if(typeof f=="object")switch(f.$$typeof){case Ht:return(f.displayName||"Context")+".Consumer";case Jt:return(f._context.displayName||"Context")+".Provider";case Nt:var g=f.render;return f=f.displayName,f||(f=g.displayName||g.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case Ci:return g=f.displayName||null,g!==null?g:Zi(f.type)||"Memo";case yi:g=f._payload,f=f._init;try{return Zi(f(g))}catch{}}return null}function fn(f){var g=f.type;switch(f.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return f=g.render,f=f.displayName||f.name||"",g.displayName||(f!==""?"ForwardRef("+f+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Zi(g);case 8:return g===Yt?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function Ln(f){switch(typeof f){case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function Xi(f){var g=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Hr(f){var g=Xi(f)?"checked":"value",E=Object.getOwnPropertyDescriptor(f.constructor.prototype,g),z=""+f[g];if(!f.hasOwnProperty(g)&&typeof E<"u"&&typeof E.get=="function"&&typeof E.set=="function"){var $=E.get,K=E.set;return Object.defineProperty(f,g,{configurable:!0,get:function(){return $.call(this)},set:function(_e){z=""+_e,K.call(this,_e)}}),Object.defineProperty(f,g,{enumerable:E.enumerable}),{getValue:function(){return z},setValue:function(_e){z=""+_e},stopTracking:function(){f._valueTracker=null,delete f[g]}}}}function js(f){f._valueTracker||(f._valueTracker=Hr(f))}function Rs(f){if(!f)return!1;var g=f._valueTracker;if(!g)return!0;var E=g.getValue(),z="";return f&&(z=Xi(f)?f.checked?"true":"false":f.value),f=z,f!==E?(g.setValue(f),!0):!1}function xr(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}function _a(f,g){var E=g.checked;return Kt({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:E??f._wrapperState.initialChecked})}function Go(f,g){var E=g.defaultValue==null?"":g.defaultValue,z=g.checked!=null?g.checked:g.defaultChecked;E=Ln(g.value!=null?g.value:E),f._wrapperState={initialChecked:z,initialValue:E,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function ls(f,g){g=g.checked,g!=null&&pt(f,"checked",g,!1)}function ia(f,g){ls(f,g);var E=Ln(g.value),z=g.type;if(E!=null)z==="number"?(E===0&&f.value===""||f.value!=E)&&(f.value=""+E):f.value!==""+E&&(f.value=""+E);else if(z==="submit"||z==="reset"){f.removeAttribute("value");return}g.hasOwnProperty("value")?vs(f,g.type,E):g.hasOwnProperty("defaultValue")&&vs(f,g.type,Ln(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(f.defaultChecked=!!g.defaultChecked)}function pu(f,g,E){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var z=g.type;if(!(z!=="submit"&&z!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+f._wrapperState.initialValue,E||g===f.value||(f.value=g),f.defaultValue=g}E=f.name,E!==""&&(f.name=""),f.defaultChecked=!!f._wrapperState.initialChecked,E!==""&&(f.name=E)}function vs(f,g,E){(g!=="number"||xr(f.ownerDocument)!==f)&&(E==null?f.defaultValue=""+f._wrapperState.initialValue:f.defaultValue!==""+E&&(f.defaultValue=""+E))}var ws=Array.isArray;function ko(f,g,E,z){if(f=f.options,g){g={};for(var $=0;$<E.length;$++)g["$"+E[$]]=!0;for(E=0;E<f.length;E++)$=g.hasOwnProperty("$"+f[E].value),f[E].selected!==$&&(f[E].selected=$),$&&z&&(f[E].defaultSelected=!0)}else{for(E=""+Ln(E),g=null,$=0;$<f.length;$++){if(f[$].value===E){f[$].selected=!0,z&&(f[$].defaultSelected=!0);return}g!==null||f[$].disabled||(g=f[$])}g!==null&&(g.selected=!0)}}function ya(f,g){if(g.dangerouslySetInnerHTML!=null)throw Error(y(91));return Kt({},g,{value:void 0,defaultValue:void 0,children:""+f._wrapperState.initialValue})}function Ja(f,g){var E=g.value;if(E==null){if(E=g.children,g=g.defaultValue,E!=null){if(g!=null)throw Error(y(92));if(ws(E)){if(1<E.length)throw Error(y(93));E=E[0]}g=E}g==null&&(g=""),E=g}f._wrapperState={initialValue:Ln(E)}}function ks(f,g){var E=Ln(g.value),z=Ln(g.defaultValue);E!=null&&(E=""+E,E!==f.value&&(f.value=E),g.defaultValue==null&&f.defaultValue!==E&&(f.defaultValue=E)),z!=null&&(f.defaultValue=""+z)}function gc(f){var g=f.textContent;g===f._wrapperState.initialValue&&g!==""&&g!==null&&(f.value=g)}function _c(f){switch(f){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Vs(f,g){return f==null||f==="http://www.w3.org/1999/xhtml"?_c(g):f==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":f}var Al,xa=function(f){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,E,z,$){MSApp.execUnsafeLocalFunction(function(){return f(g,E,z,$)})}:f}(function(f,g){if(f.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in f)f.innerHTML=g;else{for(Al=Al||document.createElement("div"),Al.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=Al.firstChild;f.firstChild;)f.removeChild(f.firstChild);for(;g.firstChild;)f.appendChild(g.firstChild)}});function va(f,g){if(g){var E=f.firstChild;if(E&&E===f.lastChild&&E.nodeType===3){E.nodeValue=g;return}}f.textContent=g}var Wr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$o=["Webkit","ms","Moz","O"];Object.keys(Wr).forEach(function(f){$o.forEach(function(g){g=g+f.charAt(0).toUpperCase()+f.substring(1),Wr[g]=Wr[f]})});function Il(f,g,E){return g==null||typeof g=="boolean"||g===""?"":E||typeof g!="number"||g===0||Wr.hasOwnProperty(f)&&Wr[f]?(""+g).trim():g+"px"}function Qa(f,g){f=f.style;for(var E in g)if(g.hasOwnProperty(E)){var z=E.indexOf("--")===0,$=Il(E,g[E],z);E==="float"&&(E="cssFloat"),z?f.setProperty(E,$):f[E]=$}}var yc=Kt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function wa(f,g){if(g){if(yc[f]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(y(137,f));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(y(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(y(61))}if(g.style!=null&&typeof g.style!="object")throw Error(y(62))}}function Pl(f,g){if(f.indexOf("-")===-1)return typeof g.is=="string";switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zn=null;function ba(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var Ml=null,cs=null,Rl=null;function hh(f){if(f=kh(f)){if(typeof Ml!="function")throw Error(y(280));var g=f.stateNode;g&&(g=Bc(g),Ml(f.stateNode,f.type,g))}}function kl(f){cs?Rl?Rl.push(f):Rl=[f]:cs=f}function Rt(){if(cs){var f=cs,g=Rl;if(Rl=cs=null,hh(f),g)for(f=0;f<g.length;f++)hh(g[f])}}function Ta(f,g){return f(g)}function md(){}var xc=!1;function _n(f,g,E){if(xc)return f(g,E);xc=!0;try{return Ta(f,g,E)}finally{xc=!1,(cs!==null||Rl!==null)&&(md(),Rt())}}function qe(f,g){var E=f.stateNode;if(E===null)return null;var z=Bc(E);if(z===null)return null;E=z[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(z=!z.disabled)||(f=f.type,z=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!z;break e;default:f=!1}if(f)return null;if(E&&typeof E!="function")throw Error(y(231,g,typeof E));return E}var te=!1;if(r)try{var ne={};Object.defineProperty(ne,"passive",{get:function(){te=!0}}),window.addEventListener("test",ne,ne),window.removeEventListener("test",ne,ne)}catch{te=!1}function ge(f,g,E,z,$,K,_e,Ve,Ye){var bt=Array.prototype.slice.call(arguments,3);try{g.apply(E,bt)}catch(li){this.onError(li)}}var Ie=!1,we=null,De=!1,$e=null,Le={onError:function(f){Ie=!0,we=f}};function He(f,g,E,z,$,K,_e,Ve,Ye){Ie=!1,we=null,ge.apply(Le,arguments)}function lt(f,g,E,z,$,K,_e,Ve,Ye){if(He.apply(this,arguments),Ie){if(Ie){var bt=we;Ie=!1,we=null}else throw Error(y(198));De||(De=!0,$e=bt)}}function Ze(f){var g=f,E=f;if(f.alternate)for(;g.return;)g=g.return;else{f=g;do g=f,(g.flags&4098)!==0&&(E=g.return),f=g.return;while(f)}return g.tag===3?E:null}function Mt(f){if(f.tag===13){var g=f.memoizedState;if(g===null&&(f=f.alternate,f!==null&&(g=f.memoizedState)),g!==null)return g.dehydrated}return null}function ei(f){if(Ze(f)!==f)throw Error(y(188))}function ri(f){var g=f.alternate;if(!g){if(g=Ze(f),g===null)throw Error(y(188));return g!==f?null:f}for(var E=f,z=g;;){var $=E.return;if($===null)break;var K=$.alternate;if(K===null){if(z=$.return,z!==null){E=z;continue}break}if($.child===K.child){for(K=$.child;K;){if(K===E)return ei($),f;if(K===z)return ei($),g;K=K.sibling}throw Error(y(188))}if(E.return!==z.return)E=$,z=K;else{for(var _e=!1,Ve=$.child;Ve;){if(Ve===E){_e=!0,E=$,z=K;break}if(Ve===z){_e=!0,z=$,E=K;break}Ve=Ve.sibling}if(!_e){for(Ve=K.child;Ve;){if(Ve===E){_e=!0,E=K,z=$;break}if(Ve===z){_e=!0,z=K,E=$;break}Ve=Ve.sibling}if(!_e)throw Error(y(189))}}if(E.alternate!==z)throw Error(y(190))}if(E.tag!==3)throw Error(y(188));return E.stateNode.current===E?f:g}function Si(f){return f=ri(f),f!==null?Ai(f):null}function Ai(f){if(f.tag===5||f.tag===6)return f;for(f=f.child;f!==null;){var g=Ai(f);if(g!==null)return g;f=f.sibling}return null}var Pi=p.unstable_scheduleCallback,Hi=p.unstable_cancelCallback,zi=p.unstable_shouldYield,Bn=p.unstable_requestPaint,nn=p.unstable_now,tr=p.unstable_getCurrentPriorityLevel,Tn=p.unstable_ImmediatePriority,xn=p.unstable_UserBlockingPriority,fr=p.unstable_NormalPriority,gr=p.unstable_LowPriority,lr=p.unstable_IdlePriority,Nr=null,Lr=null;function Ds(f){if(Lr&&typeof Lr.onCommitFiberRoot=="function")try{Lr.onCommitFiberRoot(Nr,f,void 0,(f.current.flags&128)===128)}catch{}}var to=Math.clz32?Math.clz32:gd,us=Math.log,Dl=Math.LN2;function gd(f){return f>>>=0,f===0?32:31-(us(f)/Dl|0)|0}var Ll=64,zl=4194304;function Fl(f){switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return f&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return f}}function vc(f,g){var E=f.pendingLanes;if(E===0)return 0;var z=0,$=f.suspendedLanes,K=f.pingedLanes,_e=E&268435455;if(_e!==0){var Ve=_e&~$;Ve!==0?z=Fl(Ve):(K&=_e,K!==0&&(z=Fl(K)))}else _e=E&~$,_e!==0?z=Fl(_e):K!==0&&(z=Fl(K));if(z===0)return 0;if(g!==0&&g!==z&&(g&$)===0&&($=z&-z,K=g&-g,$>=K||$===16&&(K&4194240)!==0))return g;if((z&4)!==0&&(z|=E&16),g=f.entangledLanes,g!==0)for(f=f.entanglements,g&=z;0<g;)E=31-to(g),$=1<<E,z|=f[E],g&=~$;return z}function wc(f,g){switch(f){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dh(f,g){for(var E=f.suspendedLanes,z=f.pingedLanes,$=f.expirationTimes,K=f.pendingLanes;0<K;){var _e=31-to(K),Ve=1<<_e,Ye=$[_e];Ye===-1?((Ve&E)===0||(Ve&z)!==0)&&($[_e]=wc(Ve,g)):Ye<=g&&(f.expiredLanes|=Ve),K&=~Ve}}function mu(f){return f=f.pendingLanes&-1073741825,f!==0?f:f&1073741824?1073741824:0}function Ho(){var f=Ll;return Ll<<=1,(Ll&4194240)===0&&(Ll=64),f}function io(f){for(var g=[],E=0;31>E;E++)g.push(f);return g}function Us(f,g,E){f.pendingLanes|=g,g!==536870912&&(f.suspendedLanes=0,f.pingedLanes=0),f=f.eventTimes,g=31-to(g),f[g]=E}function el(f,g){var E=f.pendingLanes&~g;f.pendingLanes=g,f.suspendedLanes=0,f.pingedLanes=0,f.expiredLanes&=g,f.mutableReadLanes&=g,f.entangledLanes&=g,g=f.entanglements;var z=f.eventTimes;for(f=f.expirationTimes;0<E;){var $=31-to(E),K=1<<$;g[$]=0,z[$]=-1,f[$]=-1,E&=~K}}function Do(f,g){var E=f.entangledLanes|=g;for(f=f.entanglements;E;){var z=31-to(E),$=1<<z;$&g|f[z]&g&&(f[z]|=g),E&=~$}}var Xn=0;function gu(f){return f&=-f,1<f?4<f?(f&268435455)!==0?16:536870912:4:1}var na,bc,Ol,Tc,_d,fh=!1,bs=[],po=null,Wo=null,Lo=null,_u=new Map,yu=new Map,qo=[],pn="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ph(f,g){switch(f){case"focusin":case"focusout":po=null;break;case"dragenter":case"dragleave":Wo=null;break;case"mouseover":case"mouseout":Lo=null;break;case"pointerover":case"pointerout":_u.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":yu.delete(g.pointerId)}}function Sa(f,g,E,z,$,K){return f===null||f.nativeEvent!==K?(f={blockedOn:g,domEventName:E,eventSystemFlags:z,nativeEvent:K,targetContainers:[$]},g!==null&&(g=kh(g),g!==null&&bc(g)),f):(f.eventSystemFlags|=z,g=f.targetContainers,$!==null&&g.indexOf($)===-1&&g.push($),f)}function mh(f,g,E,z,$){switch(g){case"focusin":return po=Sa(po,f,g,E,z,$),!0;case"dragenter":return Wo=Sa(Wo,f,g,E,z,$),!0;case"mouseover":return Lo=Sa(Lo,f,g,E,z,$),!0;case"pointerover":var K=$.pointerId;return _u.set(K,Sa(_u.get(K)||null,f,g,E,z,$)),!0;case"gotpointercapture":return K=$.pointerId,yu.set(K,Sa(yu.get(K)||null,f,g,E,z,$)),!0}return!1}function Ep(f){var g=Nc(f.target);if(g!==null){var E=Ze(g);if(E!==null){if(g=E.tag,g===13){if(g=Mt(E),g!==null){f.blockedOn=g,_d(f.priority,function(){Ol(E)});return}}else if(g===3&&E.stateNode.current.memoizedState.isDehydrated){f.blockedOn=E.tag===3?E.stateNode.containerInfo:null;return}}}f.blockedOn=null}function Nl(f){if(f.blockedOn!==null)return!1;for(var g=f.targetContainers;0<g.length;){var E=Cc(f.domEventName,f.eventSystemFlags,g[0],f.nativeEvent);if(E===null){E=f.nativeEvent;var z=new E.constructor(E.type,E);Zn=z,E.target.dispatchEvent(z),Zn=null}else return g=kh(E),g!==null&&bc(g),f.blockedOn=E,!1;g.shift()}return!0}function Bl(f,g,E){Nl(f)&&E.delete(g)}function jl(){fh=!1,po!==null&&Nl(po)&&(po=null),Wo!==null&&Nl(Wo)&&(Wo=null),Lo!==null&&Nl(Lo)&&(Lo=null),_u.forEach(Bl),yu.forEach(Bl)}function Sc(f,g){f.blockedOn===g&&(f.blockedOn=null,fh||(fh=!0,p.unstable_scheduleCallback(p.unstable_NormalPriority,jl)))}function Ec(f){function g($){return Sc($,f)}if(0<bs.length){Sc(bs[0],f);for(var E=1;E<bs.length;E++){var z=bs[E];z.blockedOn===f&&(z.blockedOn=null)}}for(po!==null&&Sc(po,f),Wo!==null&&Sc(Wo,f),Lo!==null&&Sc(Lo,f),_u.forEach(g),yu.forEach(g),E=0;E<qo.length;E++)z=qo[E],z.blockedOn===f&&(z.blockedOn=null);for(;0<qo.length&&(E=qo[0],E.blockedOn===null);)Ep(E),E.blockedOn===null&&qo.shift()}var Zo=Tt.ReactCurrentBatchConfig,gh=!0;function tl(f,g,E,z){var $=Xn,K=Zo.transition;Zo.transition=null;try{Xn=1,xu(f,g,E,z)}finally{Xn=$,Zo.transition=K}}function yd(f,g,E,z){var $=Xn,K=Zo.transition;Zo.transition=null;try{Xn=4,xu(f,g,E,z)}finally{Xn=$,Zo.transition=K}}function xu(f,g,E,z){if(gh){var $=Cc(f,g,E,z);if($===null)Id(f,g,z,mo,E),ph(f,z);else if(mh($,f,g,E,z))z.stopPropagation();else if(ph(f,z),g&4&&-1<pn.indexOf(f)){for(;$!==null;){var K=kh($);if(K!==null&&na(K),K=Cc(f,g,E,z),K===null&&Id(f,g,z,mo,E),K===$)break;$=K}$!==null&&z.stopPropagation()}else Id(f,g,z,null,E)}}var mo=null;function Cc(f,g,E,z){if(mo=null,f=ba(z),f=Nc(f),f!==null)if(g=Ze(f),g===null)f=null;else if(E=g.tag,E===13){if(f=Mt(g),f!==null)return f;f=null}else if(E===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;f=null}else g!==f&&(f=null);return mo=f,null}function Vl(f){switch(f){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(tr()){case Tn:return 1;case xn:return 4;case fr:case gr:return 16;case lr:return 536870912;default:return 16}default:return 16}}var ra=null,_h=null,Ac=null;function Ul(){if(Ac)return Ac;var f,g=_h,E=g.length,z,$="value"in ra?ra.value:ra.textContent,K=$.length;for(f=0;f<E&&g[f]===$[f];f++);var _e=E-f;for(z=1;z<=_e&&g[E-z]===$[K-z];z++);return Ac=$.slice(f,1<z?1-z:void 0)}function Ls(f){var g=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&g===13&&(f=13)):f=g,f===10&&(f=13),32<=f||f===13?f:0}function vu(){return!0}function Ic(){return!1}function hs(f){function g(E,z,$,K,_e){this._reactName=E,this._targetInst=$,this.type=z,this.nativeEvent=K,this.target=_e,this.currentTarget=null;for(var Ve in f)f.hasOwnProperty(Ve)&&(E=f[Ve],this[Ve]=E?E(K):K[Ve]);return this.isDefaultPrevented=(K.defaultPrevented!=null?K.defaultPrevented:K.returnValue===!1)?vu:Ic,this.isPropagationStopped=Ic,this}return Kt(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var E=this.nativeEvent;E&&(E.preventDefault?E.preventDefault():typeof E.returnValue!="unknown"&&(E.returnValue=!1),this.isDefaultPrevented=vu)},stopPropagation:function(){var E=this.nativeEvent;E&&(E.stopPropagation?E.stopPropagation():typeof E.cancelBubble!="unknown"&&(E.cancelBubble=!0),this.isPropagationStopped=vu)},persist:function(){},isPersistent:vu}),g}var mn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zo=hs(mn),yh=Kt({},mn,{view:0,detail:0}),Ef=hs(yh),gi,wu,il,Ea=Kt({},yh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Gl,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==il&&(il&&f.type==="mousemove"?(gi=f.screenX-il.screenX,wu=f.screenY-il.screenY):wu=gi=0,il=f),gi)},movementY:function(f){return"movementY"in f?f.movementY:wu}}),go=hs(Ea),Cf=Kt({},Ea,{dataTransfer:0}),bu=hs(Cf),oi=Kt({},yh,{relatedTarget:0}),An=hs(oi),Sn=Kt({},mn,{animationName:0,elapsedTime:0,pseudoElement:0}),_o=hs(Sn),nl=Kt({},mn,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),In=hs(nl),xd=Kt({},mn,{data:0}),Tu=hs(xd),xh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Gs={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sm(f){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(f):(f=zr[f])?!!g[f]:!1}function Gl(){return Sm}var $l=Kt({},yh,{key:function(f){if(f.key){var g=xh[f.key]||f.key;if(g!=="Unidentified")return g}return f.type==="keypress"?(f=Ls(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?Gs[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Gl,charCode:function(f){return f.type==="keypress"?Ls(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?Ls(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),vh=hs($l),vd=Kt({},Ea,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Su=hs(vd),wd=Kt({},yh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Gl}),$s=hs(wd),rl=Kt({},mn,{propertyName:0,elapsedTime:0,pseudoElement:0}),no=hs(rl),Pc=Kt({},Ea,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),Wi=hs(Pc),Xt=[9,13,27,32],yo=r&&"CompositionEvent"in window,vi=null;r&&"documentMode"in document&&(vi=document.documentMode);var kr=r&&"TextEvent"in window&&!vi,Eu=r&&(!yo||vi&&8<vi&&11>=vi),mi=" ",Mc=!1;function Rc(f,g){switch(f){case"keyup":return Xt.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sl(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var kc=!1;function Xo(f,g){switch(f){case"compositionend":return sl(g);case"keypress":return g.which!==32?null:(Mc=!0,mi);case"textInput":return f=g.data,f===mi&&Mc?null:f;default:return null}}function Hs(f,g){if(kc)return f==="compositionend"||!yo&&Rc(f,g)?(f=Ul(),Ac=_h=ra=null,kc=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Eu&&g.locale!=="ko"?null:g.data;default:return null}}var wh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qr(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g==="input"?!!wh[f.type]:g==="textarea"}function bd(f,g,E,z){kl(z),g=Oc(g,"onChange"),0<g.length&&(E=new zo("onChange","change",null,E,z),f.push({event:E,listeners:g}))}var xo=null,Zr=null;function bh(f){Mf(f,0)}function Td(f){var g=Kl(f);if(Rs(g))return f}function Em(f,g){if(f==="change")return g}var ol=!1;if(r){var Hl;if(r){var al="oninput"in document;if(!al){var Dc=document.createElement("div");Dc.setAttribute("oninput","return;"),al=typeof Dc.oninput=="function"}Hl=al}else Hl=!1;ol=Hl&&(!document.documentMode||9<document.documentMode)}function Af(){xo&&(xo.detachEvent("onpropertychange",Th),Zr=xo=null)}function Th(f){if(f.propertyName==="value"&&Td(Zr)){var g=[];bd(g,Zr,f,ba(f)),_n(bh,g)}}function If(f,g,E){f==="focusin"?(Af(),xo=g,Zr=E,xo.attachEvent("onpropertychange",Th)):f==="focusout"&&Af()}function ll(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return Td(Zr)}function Cm(f,g){if(f==="click")return Td(g)}function Am(f,g){if(f==="input"||f==="change")return Td(g)}function Cp(f,g){return f===g&&(f!==0||1/f===1/g)||f!==f&&g!==g}var Yo=typeof Object.is=="function"?Object.is:Cp;function sa(f,g){if(Yo(f,g))return!0;if(typeof f!="object"||f===null||typeof g!="object"||g===null)return!1;var E=Object.keys(f),z=Object.keys(g);if(E.length!==z.length)return!1;for(z=0;z<E.length;z++){var $=E[z];if(!U.call(g,$)||!Yo(f[$],g[$]))return!1}return!0}function Sd(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function Pf(f,g){var E=Sd(f);f=0;for(var z;E;){if(E.nodeType===3){if(z=f+E.textContent.length,f<=g&&z>=g)return{node:E,offset:g-f};f=z}e:{for(;E;){if(E.nextSibling){E=E.nextSibling;break e}E=E.parentNode}E=void 0}E=Sd(E)}}function Sh(f,g){return f&&g?f===g?!0:f&&f.nodeType===3?!1:g&&g.nodeType===3?Sh(f,g.parentNode):"contains"in f?f.contains(g):f.compareDocumentPosition?!!(f.compareDocumentPosition(g)&16):!1:!1}function Ed(){for(var f=window,g=xr();g instanceof f.HTMLIFrameElement;){try{var E=typeof g.contentWindow.location.href=="string"}catch{E=!1}if(E)f=g.contentWindow;else break;g=xr(f.document)}return g}function Eh(f){var g=f&&f.nodeName&&f.nodeName.toLowerCase();return g&&(g==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||g==="textarea"||f.contentEditable==="true")}function zs(f){var g=Ed(),E=f.focusedElem,z=f.selectionRange;if(g!==E&&E&&E.ownerDocument&&Sh(E.ownerDocument.documentElement,E)){if(z!==null&&Eh(E)){if(g=z.start,f=z.end,f===void 0&&(f=g),"selectionStart"in E)E.selectionStart=g,E.selectionEnd=Math.min(f,E.value.length);else if(f=(g=E.ownerDocument||document)&&g.defaultView||window,f.getSelection){f=f.getSelection();var $=E.textContent.length,K=Math.min(z.start,$);z=z.end===void 0?K:Math.min(z.end,$),!f.extend&&K>z&&($=z,z=K,K=$),$=Pf(E,K);var _e=Pf(E,z);$&&_e&&(f.rangeCount!==1||f.anchorNode!==$.node||f.anchorOffset!==$.offset||f.focusNode!==_e.node||f.focusOffset!==_e.offset)&&(g=g.createRange(),g.setStart($.node,$.offset),f.removeAllRanges(),K>z?(f.addRange(g),f.extend(_e.node,_e.offset)):(g.setEnd(_e.node,_e.offset),f.addRange(g)))}}for(g=[],f=E;f=f.parentNode;)f.nodeType===1&&g.push({element:f,left:f.scrollLeft,top:f.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<g.length;E++)f=g[E],f.element.scrollLeft=f.left,f.element.scrollTop=f.top}}var Ch=r&&"documentMode"in document&&11>=document.documentMode,Wl=null,Ah=null,Ca=null,ql=!1;function Cd(f,g,E){var z=E.window===E?E.document:E.nodeType===9?E:E.ownerDocument;ql||Wl==null||Wl!==xr(z)||(z=Wl,"selectionStart"in z&&Eh(z)?z={start:z.selectionStart,end:z.selectionEnd}:(z=(z.ownerDocument&&z.ownerDocument.defaultView||window).getSelection(),z={anchorNode:z.anchorNode,anchorOffset:z.anchorOffset,focusNode:z.focusNode,focusOffset:z.focusOffset}),Ca&&sa(Ca,z)||(Ca=z,z=Oc(Ah,"onSelect"),0<z.length&&(g=new zo("onSelect","select",null,g,E),f.push({event:g,listeners:z}),g.target=Wl)))}function Lc(f,g){var E={};return E[f.toLowerCase()]=g.toLowerCase(),E["Webkit"+f]="webkit"+g,E["Moz"+f]="moz"+g,E}var Ts={animationend:Lc("Animation","AnimationEnd"),animationiteration:Lc("Animation","AnimationIteration"),animationstart:Lc("Animation","AnimationStart"),transitionend:Lc("Transition","TransitionEnd")},Cu={},Lt={};r&&(Lt=document.createElement("div").style,"AnimationEvent"in window||(delete Ts.animationend.animation,delete Ts.animationiteration.animation,delete Ts.animationstart.animation),"TransitionEvent"in window||delete Ts.transitionend.transition);function Au(f){if(Cu[f])return Cu[f];if(!Ts[f])return f;var g=Ts[f],E;for(E in g)if(g.hasOwnProperty(E)&&E in Lt)return Cu[f]=g[E];return f}var zc=Au("animationend"),Fc=Au("animationiteration"),Iu=Au("animationstart"),Pu=Au("transitionend"),oa=new Map,Ih="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ds(f,g){oa.set(f,g),M(g,[f])}for(var en=0;en<Ih.length;en++){var Zl=Ih[en],Im=Zl.toLowerCase(),Pm=Zl[0].toUpperCase()+Zl.slice(1);ds(Im,"on"+Pm)}ds(zc,"onAnimationEnd"),ds(Fc,"onAnimationIteration"),ds(Iu,"onAnimationStart"),ds("dblclick","onDoubleClick"),ds("focusin","onFocus"),ds("focusout","onBlur"),ds(Pu,"onTransitionEnd"),D("onMouseEnter",["mouseout","mouseover"]),D("onMouseLeave",["mouseout","mouseover"]),D("onPointerEnter",["pointerout","pointerover"]),D("onPointerLeave",["pointerout","pointerover"]),M("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),M("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),M("onBeforeInput",["compositionend","keypress","textInput","paste"]),M("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),M("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),M("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mm=new Set("cancel close invalid load scroll toggle".split(" ").concat(Xl));function cr(f,g,E){var z=f.type||"unknown-event";f.currentTarget=E,lt(z,g,void 0,f),f.currentTarget=null}function Mf(f,g){g=(g&4)!==0;for(var E=0;E<f.length;E++){var z=f[E],$=z.event;z=z.listeners;e:{var K=void 0;if(g)for(var _e=z.length-1;0<=_e;_e--){var Ve=z[_e],Ye=Ve.instance,bt=Ve.currentTarget;if(Ve=Ve.listener,Ye!==K&&$.isPropagationStopped())break e;cr($,Ve,bt),K=Ye}else for(_e=0;_e<z.length;_e++){if(Ve=z[_e],Ye=Ve.instance,bt=Ve.currentTarget,Ve=Ve.listener,Ye!==K&&$.isPropagationStopped())break e;cr($,Ve,bt),K=Ye}}}if(De)throw f=$e,De=!1,$e=null,f}function Ir(f,g){var E=g[Ra];E===void 0&&(E=g[Ra]=new Set);var z=f+"__bubble";E.has(z)||(Ap(g,f,2,!1),E.add(z))}function Rf(f,g,E){var z=0;g&&(z|=4),Ap(E,f,z,g)}var Ad="_reactListening"+Math.random().toString(36).slice(2);function Ph(f){if(!f[Ad]){f[Ad]=!0,b.forEach(function(E){E!=="selectionchange"&&(Mm.has(E)||Rf(E,!1,f),Rf(E,!0,f))});var g=f.nodeType===9?f:f.ownerDocument;g===null||g[Ad]||(g[Ad]=!0,Rf("selectionchange",!1,g))}}function Ap(f,g,E,z){switch(Vl(g)){case 1:var $=tl;break;case 4:$=yd;break;default:$=xu}E=$.bind(null,g,E,f),$=void 0,!te||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||($=!0),z?$!==void 0?f.addEventListener(g,E,{capture:!0,passive:$}):f.addEventListener(g,E,!0):$!==void 0?f.addEventListener(g,E,{passive:$}):f.addEventListener(g,E,!1)}function Id(f,g,E,z,$){var K=z;if((g&1)===0&&(g&2)===0&&z!==null)e:for(;;){if(z===null)return;var _e=z.tag;if(_e===3||_e===4){var Ve=z.stateNode.containerInfo;if(Ve===$||Ve.nodeType===8&&Ve.parentNode===$)break;if(_e===4)for(_e=z.return;_e!==null;){var Ye=_e.tag;if((Ye===3||Ye===4)&&(Ye=_e.stateNode.containerInfo,Ye===$||Ye.nodeType===8&&Ye.parentNode===$))return;_e=_e.return}for(;Ve!==null;){if(_e=Nc(Ve),_e===null)return;if(Ye=_e.tag,Ye===5||Ye===6){z=K=_e;continue e}Ve=Ve.parentNode}}z=z.return}_n(function(){var bt=K,li=ba(E),ci=[];e:{var si=oa.get(f);if(si!==void 0){var ki=zo,ji=f;switch(f){case"keypress":if(Ls(E)===0)break e;case"keydown":case"keyup":ki=vh;break;case"focusin":ji="focus",ki=An;break;case"focusout":ji="blur",ki=An;break;case"beforeblur":case"afterblur":ki=An;break;case"click":if(E.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ki=go;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ki=bu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ki=$s;break;case zc:case Fc:case Iu:ki=_o;break;case Pu:ki=no;break;case"scroll":ki=Ef;break;case"wheel":ki=Wi;break;case"copy":case"cut":case"paste":ki=In;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ki=Su}var $i=(g&4)!==0,rs=!$i&&f==="scroll",dt=$i?si!==null?si+"Capture":null:si;$i=[];for(var at=bt,_t;at!==null;){_t=at;var pi=_t.stateNode;if(_t.tag===5&&pi!==null&&(_t=pi,dt!==null&&(pi=qe(at,dt),pi!=null&&$i.push(Mh(at,pi,_t)))),rs)break;at=at.return}0<$i.length&&(si=new ki(si,ji,null,E,li),ci.push({event:si,listeners:$i}))}}if((g&7)===0){e:{if(si=f==="mouseover"||f==="pointerover",ki=f==="mouseout"||f==="pointerout",si&&E!==Zn&&(ji=E.relatedTarget||E.fromElement)&&(Nc(ji)||ji[Ma]))break e;if((ki||si)&&(si=li.window===li?li:(si=li.ownerDocument)?si.defaultView||si.parentWindow:window,ki?(ji=E.relatedTarget||E.toElement,ki=bt,ji=ji?Nc(ji):null,ji!==null&&(rs=Ze(ji),ji!==rs||ji.tag!==5&&ji.tag!==6)&&(ji=null)):(ki=null,ji=bt),ki!==ji)){if($i=go,pi="onMouseLeave",dt="onMouseEnter",at="mouse",(f==="pointerout"||f==="pointerover")&&($i=Su,pi="onPointerLeave",dt="onPointerEnter",at="pointer"),rs=ki==null?si:Kl(ki),_t=ji==null?si:Kl(ji),si=new $i(pi,at+"leave",ki,E,li),si.target=rs,si.relatedTarget=_t,pi=null,Nc(li)===bt&&($i=new $i(dt,at+"enter",ji,E,li),$i.target=_t,$i.relatedTarget=rs,pi=$i),rs=pi,ki&&ji)t:{for($i=ki,dt=ji,at=0,_t=$i;_t;_t=Mu(_t))at++;for(_t=0,pi=dt;pi;pi=Mu(pi))_t++;for(;0<at-_t;)$i=Mu($i),at--;for(;0<_t-at;)dt=Mu(dt),_t--;for(;at--;){if($i===dt||dt!==null&&$i===dt.alternate)break t;$i=Mu($i),dt=Mu(dt)}$i=null}else $i=null;ki!==null&&kf(ci,si,ki,$i,!1),ji!==null&&rs!==null&&kf(ci,rs,ji,$i,!0)}}e:{if(si=bt?Kl(bt):window,ki=si.nodeName&&si.nodeName.toLowerCase(),ki==="select"||ki==="input"&&si.type==="file")var Qi=Em;else if(qr(si))if(ol)Qi=Am;else{Qi=ll;var tn=If}else(ki=si.nodeName)&&ki.toLowerCase()==="input"&&(si.type==="checkbox"||si.type==="radio")&&(Qi=Cm);if(Qi&&(Qi=Qi(f,bt))){bd(ci,Qi,E,li);break e}tn&&tn(f,si,bt),f==="focusout"&&(tn=si._wrapperState)&&tn.controlled&&si.type==="number"&&vs(si,"number",si.value)}switch(tn=bt?Kl(bt):window,f){case"focusin":(qr(tn)||tn.contentEditable==="true")&&(Wl=tn,Ah=bt,Ca=null);break;case"focusout":Ca=Ah=Wl=null;break;case"mousedown":ql=!0;break;case"contextmenu":case"mouseup":case"dragend":ql=!1,Cd(ci,E,li);break;case"selectionchange":if(Ch)break;case"keydown":case"keyup":Cd(ci,E,li)}var dn;if(yo)e:{switch(f){case"compositionstart":var bn="onCompositionStart";break e;case"compositionend":bn="onCompositionEnd";break e;case"compositionupdate":bn="onCompositionUpdate";break e}bn=void 0}else kc?Rc(f,E)&&(bn="onCompositionEnd"):f==="keydown"&&E.keyCode===229&&(bn="onCompositionStart");bn&&(Eu&&E.locale!=="ko"&&(kc||bn!=="onCompositionStart"?bn==="onCompositionEnd"&&kc&&(dn=Ul()):(ra=li,_h="value"in ra?ra.value:ra.textContent,kc=!0)),tn=Oc(bt,bn),0<tn.length&&(bn=new Tu(bn,f,null,E,li),ci.push({event:bn,listeners:tn}),dn?bn.data=dn:(dn=sl(E),dn!==null&&(bn.data=dn)))),(dn=kr?Xo(f,E):Hs(f,E))&&(bt=Oc(bt,"onBeforeInput"),0<bt.length&&(li=new Tu("onBeforeInput","beforeinput",null,E,li),ci.push({event:li,listeners:bt}),li.data=dn))}Mf(ci,g)})}function Mh(f,g,E){return{instance:f,listener:g,currentTarget:E}}function Oc(f,g){for(var E=g+"Capture",z=[];f!==null;){var $=f,K=$.stateNode;$.tag===5&&K!==null&&($=K,K=qe(f,E),K!=null&&z.unshift(Mh(f,K,$)),K=qe(f,g),K!=null&&z.push(Mh(f,K,$))),f=f.return}return z}function Mu(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5);return f||null}function kf(f,g,E,z,$){for(var K=g._reactName,_e=[];E!==null&&E!==z;){var Ve=E,Ye=Ve.alternate,bt=Ve.stateNode;if(Ye!==null&&Ye===z)break;Ve.tag===5&&bt!==null&&(Ve=bt,$?(Ye=qe(E,K),Ye!=null&&_e.unshift(Mh(E,Ye,Ve))):$||(Ye=qe(E,K),Ye!=null&&_e.push(Mh(E,Ye,Ve)))),E=E.return}_e.length!==0&&f.push({event:g,listeners:_e})}var Df=/\r\n?/g,Pd=/\u0000|\uFFFD/g;function Md(f){return(typeof f=="string"?f:""+f).replace(Df,`
`).replace(Pd,"")}function Aa(f,g,E){if(g=Md(g),Md(f)!==g&&E)throw Error(y(425))}function cl(){}var Ru=null,ku=null;function Yl(f,g){return f==="textarea"||f==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Rd=typeof setTimeout=="function"?setTimeout:void 0,Lf=typeof clearTimeout=="function"?clearTimeout:void 0,zf=typeof Promise=="function"?Promise:void 0,Du=typeof queueMicrotask=="function"?queueMicrotask:typeof zf<"u"?function(f){return zf.resolve(null).then(f).catch(kd)}:Rd;function kd(f){setTimeout(function(){throw f})}function Lu(f,g){var E=g,z=0;do{var $=E.nextSibling;if(f.removeChild(E),$&&$.nodeType===8)if(E=$.data,E==="/$"){if(z===0){f.removeChild($),Ec(g);return}z--}else E!=="$"&&E!=="$?"&&E!=="$!"||z++;E=$}while(E);Ec(g)}function Ia(f){for(;f!=null;f=f.nextSibling){var g=f.nodeType;if(g===1||g===3)break;if(g===8){if(g=f.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return f}function Rh(f){f=f.previousSibling;for(var g=0;f;){if(f.nodeType===8){var E=f.data;if(E==="$"||E==="$!"||E==="$?"){if(g===0)return f;g--}else E==="/$"&&g++}f=f.previousSibling}return null}var Pa=Math.random().toString(36).slice(2),aa="__reactFiber$"+Pa,zu="__reactProps$"+Pa,Ma="__reactContainer$"+Pa,Ra="__reactEvents$"+Pa,Ip="__reactListeners$"+Pa,Pp="__reactHandles$"+Pa;function Nc(f){var g=f[aa];if(g)return g;for(var E=f.parentNode;E;){if(g=E[Ma]||E[aa]){if(E=g.alternate,g.child!==null||E!==null&&E.child!==null)for(f=Rh(f);f!==null;){if(E=f[aa])return E;f=Rh(f)}return g}f=E,E=f.parentNode}return null}function kh(f){return f=f[aa]||f[Ma],!f||f.tag!==5&&f.tag!==6&&f.tag!==13&&f.tag!==3?null:f}function Kl(f){if(f.tag===5||f.tag===6)return f.stateNode;throw Error(y(33))}function Bc(f){return f[zu]||null}var Fu=[],Fo=-1;function ka(f){return{current:f}}function Pr(f){0>Fo||(f.current=Fu[Fo],Fu[Fo]=null,Fo--)}function Mr(f,g){Fo++,Fu[Fo]=f.current,f.current=g}var vo={},Vr=ka(vo),ro=ka(!1),fs=vo;function ul(f,g){var E=f.type.contextTypes;if(!E)return vo;var z=f.stateNode;if(z&&z.__reactInternalMemoizedUnmaskedChildContext===g)return z.__reactInternalMemoizedMaskedChildContext;var $={},K;for(K in E)$[K]=g[K];return z&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=g,f.__reactInternalMemoizedMaskedChildContext=$),$}function Ss(f){return f=f.childContextTypes,f!=null}function jc(){Pr(ro),Pr(Vr)}function Dd(f,g,E){if(Vr.current!==vo)throw Error(y(168));Mr(Vr,g),Mr(ro,E)}function Ld(f,g,E){var z=f.stateNode;if(g=g.childContextTypes,typeof z.getChildContext!="function")return E;z=z.getChildContext();for(var $ in z)if(!($ in g))throw Error(y(108,fn(f)||"Unknown",$));return Kt({},E,z)}function Vc(f){return f=(f=f.stateNode)&&f.__reactInternalMemoizedMergedChildContext||vo,fs=Vr.current,Mr(Vr,f),Mr(ro,ro.current),!0}function Ou(f,g,E){var z=f.stateNode;if(!z)throw Error(y(169));E?(f=Ld(f,g,fs),z.__reactInternalMemoizedMergedChildContext=f,Pr(ro),Pr(Vr),Mr(Vr,f)):Pr(ro),Mr(ro,E)}var wo=null,Nu=!1,Uc=!1;function Ff(f){wo===null?wo=[f]:wo.push(f)}function Mp(f){Nu=!0,Ff(f)}function bo(){if(!Uc&&wo!==null){Uc=!0;var f=0,g=Xn;try{var E=wo;for(Xn=1;f<E.length;f++){var z=E[f];do z=z(!0);while(z!==null)}wo=null,Nu=!1}catch($){throw wo!==null&&(wo=wo.slice(f+1)),Pi(Tn,bo),$}finally{Xn=g,Uc=!1}}return null}var Gc=[],Bu=0,zd=null,Fd=0,so=[],Ko=0,Da=null,la=1,La="";function Oo(f,g){Gc[Bu++]=Fd,Gc[Bu++]=zd,zd=f,Fd=g}function Od(f,g,E){so[Ko++]=la,so[Ko++]=La,so[Ko++]=Da,Da=f;var z=la;f=La;var $=32-to(z)-1;z&=~(1<<$),E+=1;var K=32-to(g)+$;if(30<K){var _e=$-$%5;K=(z&(1<<_e)-1).toString(32),z>>=_e,$-=_e,la=1<<32-to(g)+$|E<<$|z,La=K+f}else la=1<<K|E<<$|z,La=f}function Dh(f){f.return!==null&&(Oo(f,1),Od(f,1,0))}function Nd(f){for(;f===zd;)zd=Gc[--Bu],Gc[Bu]=null,Fd=Gc[--Bu],Gc[Bu]=null;for(;f===Da;)Da=so[--Ko],so[Ko]=null,La=so[--Ko],so[Ko]=null,la=so[--Ko],so[Ko]=null}var Qr=null,ps=null,Dr=!1,Es=null;function Lh(f,g){var E=Ur(5,null,null,0);E.elementType="DELETED",E.stateNode=g,E.return=f,g=f.deletions,g===null?(f.deletions=[E],f.flags|=16):g.push(E)}function ju(f,g){switch(f.tag){case 5:var E=f.type;return g=g.nodeType!==1||E.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(f.stateNode=g,Qr=f,ps=Ia(g.firstChild),!0):!1;case 6:return g=f.pendingProps===""||g.nodeType!==3?null:g,g!==null?(f.stateNode=g,Qr=f,ps=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(E=Da!==null?{id:la,overflow:La}:null,f.memoizedState={dehydrated:g,treeContext:E,retryLane:1073741824},E=Ur(18,null,null,0),E.stateNode=g,E.return=f,f.child=E,Qr=f,ps=null,!0):!1;default:return!1}}function zh(f){return(f.mode&1)!==0&&(f.flags&128)===0}function Fh(f){if(Dr){var g=ps;if(g){var E=g;if(!ju(f,g)){if(zh(f))throw Error(y(418));g=Ia(E.nextSibling);var z=Qr;g&&ju(f,g)?Lh(z,E):(f.flags=f.flags&-4097|2,Dr=!1,Qr=f)}}else{if(zh(f))throw Error(y(418));f.flags=f.flags&-4097|2,Dr=!1,Qr=f}}}function Vu(f){for(f=f.return;f!==null&&f.tag!==5&&f.tag!==3&&f.tag!==13;)f=f.return;Qr=f}function Jl(f){if(f!==Qr)return!1;if(!Dr)return Vu(f),Dr=!0,!1;var g;if((g=f.tag!==3)&&!(g=f.tag!==5)&&(g=f.type,g=g!=="head"&&g!=="body"&&!Yl(f.type,f.memoizedProps)),g&&(g=ps)){if(zh(f))throw Of(),Error(y(418));for(;g;)Lh(f,g),g=Ia(g.nextSibling)}if(Vu(f),f.tag===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(y(317));e:{for(f=f.nextSibling,g=0;f;){if(f.nodeType===8){var E=f.data;if(E==="/$"){if(g===0){ps=Ia(f.nextSibling);break e}g--}else E!=="$"&&E!=="$!"&&E!=="$?"||g++}f=f.nextSibling}ps=null}}else ps=Qr?Ia(f.stateNode.nextSibling):null;return!0}function Of(){for(var f=ps;f;)f=Ia(f.nextSibling)}function $c(){ps=Qr=null,Dr=!1}function To(f){Es===null?Es=[f]:Es.push(f)}var Rm=Tt.ReactCurrentBatchConfig;function Oh(f,g,E){if(f=E.ref,f!==null&&typeof f!="function"&&typeof f!="object"){if(E._owner){if(E=E._owner,E){if(E.tag!==1)throw Error(y(309));var z=E.stateNode}if(!z)throw Error(y(147,f));var $=z,K=""+f;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===K?g.ref:(g=function(_e){var Ve=$.refs;_e===null?delete Ve[K]:Ve[K]=_e},g._stringRef=K,g)}if(typeof f!="string")throw Error(y(284));if(!E._owner)throw Error(y(290,f))}return f}function Uu(f,g){throw f=Object.prototype.toString.call(g),Error(y(31,f==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":f))}function Rp(f){var g=f._init;return g(f._payload)}function Hc(f){function g(dt,at){if(f){var _t=dt.deletions;_t===null?(dt.deletions=[at],dt.flags|=16):_t.push(at)}}function E(dt,at){if(!f)return null;for(;at!==null;)g(dt,at),at=at.sibling;return null}function z(dt,at){for(dt=new Map;at!==null;)at.key!==null?dt.set(at.key,at):dt.set(at.index,at),at=at.sibling;return dt}function $(dt,at){return dt=ho(dt,at),dt.index=0,dt.sibling=null,dt}function K(dt,at,_t){return dt.index=_t,f?(_t=dt.alternate,_t!==null?(_t=_t.index,_t<at?(dt.flags|=2,at):_t):(dt.flags|=2,at)):(dt.flags|=1048576,at)}function _e(dt){return f&&dt.alternate===null&&(dt.flags|=2),dt}function Ve(dt,at,_t,pi){return at===null||at.tag!==6?(at=ed(_t,dt.mode,pi),at.return=dt,at):(at=$(at,_t),at.return=dt,at)}function Ye(dt,at,_t,pi){var Qi=_t.type;return Qi===Bt?li(dt,at,_t.props.children,pi,_t.key):at!==null&&(at.elementType===Qi||typeof Qi=="object"&&Qi!==null&&Qi.$$typeof===yi&&Rp(Qi)===at.type)?(pi=$(at,_t.props),pi.ref=Oh(dt,at,_t),pi.return=dt,pi):(pi=Ao(_t.type,_t.key,_t.props,null,dt.mode,pi),pi.ref=Oh(dt,at,_t),pi.return=dt,pi)}function bt(dt,at,_t,pi){return at===null||at.tag!==4||at.stateNode.containerInfo!==_t.containerInfo||at.stateNode.implementation!==_t.implementation?(at=cc(_t,dt.mode,pi),at.return=dt,at):(at=$(at,_t.children||[]),at.return=dt,at)}function li(dt,at,_t,pi,Qi){return at===null||at.tag!==7?(at=Io(_t,dt.mode,pi,Qi),at.return=dt,at):(at=$(at,_t),at.return=dt,at)}function ci(dt,at,_t){if(typeof at=="string"&&at!==""||typeof at=="number")return at=ed(""+at,dt.mode,_t),at.return=dt,at;if(typeof at=="object"&&at!==null){switch(at.$$typeof){case It:return _t=Ao(at.type,at.key,at.props,null,dt.mode,_t),_t.ref=Oh(dt,null,at),_t.return=dt,_t;case di:return at=cc(at,dt.mode,_t),at.return=dt,at;case yi:var pi=at._init;return ci(dt,pi(at._payload),_t)}if(ws(at)||Ei(at))return at=Io(at,dt.mode,_t,null),at.return=dt,at;Uu(dt,at)}return null}function si(dt,at,_t,pi){var Qi=at!==null?at.key:null;if(typeof _t=="string"&&_t!==""||typeof _t=="number")return Qi!==null?null:Ve(dt,at,""+_t,pi);if(typeof _t=="object"&&_t!==null){switch(_t.$$typeof){case It:return _t.key===Qi?Ye(dt,at,_t,pi):null;case di:return _t.key===Qi?bt(dt,at,_t,pi):null;case yi:return Qi=_t._init,si(dt,at,Qi(_t._payload),pi)}if(ws(_t)||Ei(_t))return Qi!==null?null:li(dt,at,_t,pi,null);Uu(dt,_t)}return null}function ki(dt,at,_t,pi,Qi){if(typeof pi=="string"&&pi!==""||typeof pi=="number")return dt=dt.get(_t)||null,Ve(at,dt,""+pi,Qi);if(typeof pi=="object"&&pi!==null){switch(pi.$$typeof){case It:return dt=dt.get(pi.key===null?_t:pi.key)||null,Ye(at,dt,pi,Qi);case di:return dt=dt.get(pi.key===null?_t:pi.key)||null,bt(at,dt,pi,Qi);case yi:var tn=pi._init;return ki(dt,at,_t,tn(pi._payload),Qi)}if(ws(pi)||Ei(pi))return dt=dt.get(_t)||null,li(at,dt,pi,Qi,null);Uu(at,pi)}return null}function ji(dt,at,_t,pi){for(var Qi=null,tn=null,dn=at,bn=at=0,Fs=null;dn!==null&&bn<_t.length;bn++){dn.index>bn?(Fs=dn,dn=null):Fs=dn.sibling;var Tr=si(dt,dn,_t[bn],pi);if(Tr===null){dn===null&&(dn=Fs);break}f&&dn&&Tr.alternate===null&&g(dt,dn),at=K(Tr,at,bn),tn===null?Qi=Tr:tn.sibling=Tr,tn=Tr,dn=Fs}if(bn===_t.length)return E(dt,dn),Dr&&Oo(dt,bn),Qi;if(dn===null){for(;bn<_t.length;bn++)dn=ci(dt,_t[bn],pi),dn!==null&&(at=K(dn,at,bn),tn===null?Qi=dn:tn.sibling=dn,tn=dn);return Dr&&Oo(dt,bn),Qi}for(dn=z(dt,dn);bn<_t.length;bn++)Fs=ki(dn,dt,bn,_t[bn],pi),Fs!==null&&(f&&Fs.alternate!==null&&dn.delete(Fs.key===null?bn:Fs.key),at=K(Fs,at,bn),tn===null?Qi=Fs:tn.sibling=Fs,tn=Fs);return f&&dn.forEach(function(nh){return g(dt,nh)}),Dr&&Oo(dt,bn),Qi}function $i(dt,at,_t,pi){var Qi=Ei(_t);if(typeof Qi!="function")throw Error(y(150));if(_t=Qi.call(_t),_t==null)throw Error(y(151));for(var tn=Qi=null,dn=at,bn=at=0,Fs=null,Tr=_t.next();dn!==null&&!Tr.done;bn++,Tr=_t.next()){dn.index>bn?(Fs=dn,dn=null):Fs=dn.sibling;var nh=si(dt,dn,Tr.value,pi);if(nh===null){dn===null&&(dn=Fs);break}f&&dn&&nh.alternate===null&&g(dt,dn),at=K(nh,at,bn),tn===null?Qi=nh:tn.sibling=nh,tn=nh,dn=Fs}if(Tr.done)return E(dt,dn),Dr&&Oo(dt,bn),Qi;if(dn===null){for(;!Tr.done;bn++,Tr=_t.next())Tr=ci(dt,Tr.value,pi),Tr!==null&&(at=K(Tr,at,bn),tn===null?Qi=Tr:tn.sibling=Tr,tn=Tr);return Dr&&Oo(dt,bn),Qi}for(dn=z(dt,dn);!Tr.done;bn++,Tr=_t.next())Tr=ki(dn,dt,bn,Tr.value,pi),Tr!==null&&(f&&Tr.alternate!==null&&dn.delete(Tr.key===null?bn:Tr.key),at=K(Tr,at,bn),tn===null?Qi=Tr:tn.sibling=Tr,tn=Tr);return f&&dn.forEach(function(Uy){return g(dt,Uy)}),Dr&&Oo(dt,bn),Qi}function rs(dt,at,_t,pi){if(typeof _t=="object"&&_t!==null&&_t.type===Bt&&_t.key===null&&(_t=_t.props.children),typeof _t=="object"&&_t!==null){switch(_t.$$typeof){case It:e:{for(var Qi=_t.key,tn=at;tn!==null;){if(tn.key===Qi){if(Qi=_t.type,Qi===Bt){if(tn.tag===7){E(dt,tn.sibling),at=$(tn,_t.props.children),at.return=dt,dt=at;break e}}else if(tn.elementType===Qi||typeof Qi=="object"&&Qi!==null&&Qi.$$typeof===yi&&Rp(Qi)===tn.type){E(dt,tn.sibling),at=$(tn,_t.props),at.ref=Oh(dt,tn,_t),at.return=dt,dt=at;break e}E(dt,tn);break}else g(dt,tn);tn=tn.sibling}_t.type===Bt?(at=Io(_t.props.children,dt.mode,pi,_t.key),at.return=dt,dt=at):(pi=Ao(_t.type,_t.key,_t.props,null,dt.mode,pi),pi.ref=Oh(dt,at,_t),pi.return=dt,dt=pi)}return _e(dt);case di:e:{for(tn=_t.key;at!==null;){if(at.key===tn)if(at.tag===4&&at.stateNode.containerInfo===_t.containerInfo&&at.stateNode.implementation===_t.implementation){E(dt,at.sibling),at=$(at,_t.children||[]),at.return=dt,dt=at;break e}else{E(dt,at);break}else g(dt,at);at=at.sibling}at=cc(_t,dt.mode,pi),at.return=dt,dt=at}return _e(dt);case yi:return tn=_t._init,rs(dt,at,tn(_t._payload),pi)}if(ws(_t))return ji(dt,at,_t,pi);if(Ei(_t))return $i(dt,at,_t,pi);Uu(dt,_t)}return typeof _t=="string"&&_t!==""||typeof _t=="number"?(_t=""+_t,at!==null&&at.tag===6?(E(dt,at.sibling),at=$(at,_t),at.return=dt,dt=at):(E(dt,at),at=ed(_t,dt.mode,pi),at.return=dt,dt=at),_e(dt)):E(dt,at)}return rs}var hl=Hc(!0),za=Hc(!1),Ql=ka(null),ec=null,Wc=null,tc=null;function ic(){tc=Wc=ec=null}function Gu(f){var g=Ql.current;Pr(Ql),f._currentValue=g}function Nh(f,g,E){for(;f!==null;){var z=f.alternate;if((f.childLanes&g)!==g?(f.childLanes|=g,z!==null&&(z.childLanes|=g)):z!==null&&(z.childLanes&g)!==g&&(z.childLanes|=g),f===E)break;f=f.return}}function nc(f,g){ec=f,tc=Wc=null,f=f.dependencies,f!==null&&f.firstContext!==null&&((f.lanes&g)!==0&&(qs=!0),f.firstContext=null)}function es(f){var g=f._currentValue;if(tc!==f)if(f={context:f,memoizedValue:g,next:null},Wc===null){if(ec===null)throw Error(y(308));Wc=f,ec.dependencies={lanes:0,firstContext:f}}else Wc=Wc.next=f;return g}var oo=null;function qt(f){oo===null?oo=[f]:oo.push(f)}function Nf(f,g,E,z){var $=g.interleaved;return $===null?(E.next=E,qt(g)):(E.next=$.next,$.next=E),g.interleaved=E,Fa(f,z)}function Fa(f,g){f.lanes|=g;var E=f.alternate;for(E!==null&&(E.lanes|=g),E=f,f=f.return;f!==null;)f.childLanes|=g,E=f.alternate,E!==null&&(E.childLanes|=g),E=f,f=f.return;return E.tag===3?E.stateNode:null}var ao=!1;function Oa(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fi(f,g){f=f.updateQueue,g.updateQueue===f&&(g.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,effects:f.effects})}function No(f,g){return{eventTime:f,lane:g,tag:0,payload:null,callback:null,next:null}}function rc(f,g,E){var z=f.updateQueue;if(z===null)return null;if(z=z.shared,(W&2)!==0){var $=z.pending;return $===null?g.next=g:(g.next=$.next,$.next=g),z.pending=g,Fa(f,E)}return $=z.interleaved,$===null?(g.next=g,qt(z)):(g.next=$.next,$.next=g),z.interleaved=g,Fa(f,E)}function Bd(f,g,E){if(g=g.updateQueue,g!==null&&(g=g.shared,(E&4194240)!==0)){var z=g.lanes;z&=f.pendingLanes,E|=z,g.lanes=E,Do(f,E)}}function jd(f,g){var E=f.updateQueue,z=f.alternate;if(z!==null&&(z=z.updateQueue,E===z)){var $=null,K=null;if(E=E.firstBaseUpdate,E!==null){do{var _e={eventTime:E.eventTime,lane:E.lane,tag:E.tag,payload:E.payload,callback:E.callback,next:null};K===null?$=K=_e:K=K.next=_e,E=E.next}while(E!==null);K===null?$=K=g:K=K.next=g}else $=K=g;E={baseState:z.baseState,firstBaseUpdate:$,lastBaseUpdate:K,shared:z.shared,effects:z.effects},f.updateQueue=E;return}f=E.lastBaseUpdate,f===null?E.firstBaseUpdate=g:f.next=g,E.lastBaseUpdate=g}function Bh(f,g,E,z){var $=f.updateQueue;ao=!1;var K=$.firstBaseUpdate,_e=$.lastBaseUpdate,Ve=$.shared.pending;if(Ve!==null){$.shared.pending=null;var Ye=Ve,bt=Ye.next;Ye.next=null,_e===null?K=bt:_e.next=bt,_e=Ye;var li=f.alternate;li!==null&&(li=li.updateQueue,Ve=li.lastBaseUpdate,Ve!==_e&&(Ve===null?li.firstBaseUpdate=bt:Ve.next=bt,li.lastBaseUpdate=Ye))}if(K!==null){var ci=$.baseState;_e=0,li=bt=Ye=null,Ve=K;do{var si=Ve.lane,ki=Ve.eventTime;if((z&si)===si){li!==null&&(li=li.next={eventTime:ki,lane:0,tag:Ve.tag,payload:Ve.payload,callback:Ve.callback,next:null});e:{var ji=f,$i=Ve;switch(si=g,ki=E,$i.tag){case 1:if(ji=$i.payload,typeof ji=="function"){ci=ji.call(ki,ci,si);break e}ci=ji;break e;case 3:ji.flags=ji.flags&-65537|128;case 0:if(ji=$i.payload,si=typeof ji=="function"?ji.call(ki,ci,si):ji,si==null)break e;ci=Kt({},ci,si);break e;case 2:ao=!0}}Ve.callback!==null&&Ve.lane!==0&&(f.flags|=64,si=$.effects,si===null?$.effects=[Ve]:si.push(Ve))}else ki={eventTime:ki,lane:si,tag:Ve.tag,payload:Ve.payload,callback:Ve.callback,next:null},li===null?(bt=li=ki,Ye=ci):li=li.next=ki,_e|=si;if(Ve=Ve.next,Ve===null){if(Ve=$.shared.pending,Ve===null)break;si=Ve,Ve=si.next,si.next=null,$.lastBaseUpdate=si,$.shared.pending=null}}while(!0);if(li===null&&(Ye=ci),$.baseState=Ye,$.firstBaseUpdate=bt,$.lastBaseUpdate=li,g=$.shared.interleaved,g!==null){$=g;do _e|=$.lane,$=$.next;while($!==g)}else K===null&&($.shared.lanes=0);xe|=_e,f.lanes=_e,f.memoizedState=ci}}function kp(f,g,E){if(f=g.effects,g.effects=null,f!==null)for(g=0;g<f.length;g++){var z=f[g],$=z.callback;if($!==null){if(z.callback=null,z=E,typeof $!="function")throw Error(y(191,$));$.call(z)}}}var $u={},Na=ka($u),jh=ka($u),Cs=ka($u);function dl(f){if(f===$u)throw Error(y(174));return f}function As(f,g){switch(Mr(Cs,g),Mr(jh,f),Mr(Na,$u),f=g.nodeType,f){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:Vs(null,"");break;default:f=f===8?g.parentNode:g,g=f.namespaceURI||null,f=f.tagName,g=Vs(g,f)}Pr(Na),Mr(Na,g)}function So(){Pr(Na),Pr(jh),Pr(Cs)}function sc(f){dl(Cs.current);var g=dl(Na.current),E=Vs(g,f.type);g!==E&&(Mr(jh,f),Mr(Na,E))}function Hu(f){jh.current===f&&(Pr(Na),Pr(jh))}var Rr=ka(0);function fl(f){for(var g=f;g!==null;){if(g.tag===13){var E=g.memoizedState;if(E!==null&&(E=E.dehydrated,E===null||E.data==="$?"||E.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var Vd=[];function ca(){for(var f=0;f<Vd.length;f++)Vd[f]._workInProgressVersionPrimary=null;Vd.length=0}var Pn=Tt.ReactCurrentDispatcher,qc=Tt.ReactCurrentBatchConfig,Eo=0,Fr=null,ts=null,ms=null,Ud=!1,Ba=!1,ua=0,wt=0;function kt(){throw Error(y(321))}function pl(f,g){if(g===null)return!1;for(var E=0;E<g.length&&E<f.length;E++)if(!Yo(f[E],g[E]))return!1;return!0}function ur(f,g,E,z,$,K){if(Eo=K,Fr=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,Pn.current=f===null||f.memoizedState===null?$h:Yd,f=E(z,$),Ba){K=0;do{if(Ba=!1,ua=0,25<=K)throw Error(y(301));K+=1,ms=ts=null,g.updateQueue=null,Pn.current=Yu,f=E(z,$)}while(Ba)}if(Pn.current=da,g=ts!==null&&ts.next!==null,Eo=0,ms=ts=Fr=null,Ud=!1,g)throw Error(y(300));return f}function je(){var f=ua!==0;return ua=0,f}function is(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ms===null?Fr.memoizedState=ms=f:ms=ms.next=f,ms}function lo(){if(ts===null){var f=Fr.alternate;f=f!==null?f.memoizedState:null}else f=ts.next;var g=ms===null?Fr.memoizedState:ms.next;if(g!==null)ms=g,ts=f;else{if(f===null)throw Error(y(310));ts=f,f={memoizedState:ts.memoizedState,baseState:ts.baseState,baseQueue:ts.baseQueue,queue:ts.queue,next:null},ms===null?Fr.memoizedState=ms=f:ms=ms.next=f}return ms}function oc(f,g){return typeof g=="function"?g(f):g}function Vh(f){var g=lo(),E=g.queue;if(E===null)throw Error(y(311));E.lastRenderedReducer=f;var z=ts,$=z.baseQueue,K=E.pending;if(K!==null){if($!==null){var _e=$.next;$.next=K.next,K.next=_e}z.baseQueue=$=K,E.pending=null}if($!==null){K=$.next,z=z.baseState;var Ve=_e=null,Ye=null,bt=K;do{var li=bt.lane;if((Eo&li)===li)Ye!==null&&(Ye=Ye.next={lane:0,action:bt.action,hasEagerState:bt.hasEagerState,eagerState:bt.eagerState,next:null}),z=bt.hasEagerState?bt.eagerState:f(z,bt.action);else{var ci={lane:li,action:bt.action,hasEagerState:bt.hasEagerState,eagerState:bt.eagerState,next:null};Ye===null?(Ve=Ye=ci,_e=z):Ye=Ye.next=ci,Fr.lanes|=li,xe|=li}bt=bt.next}while(bt!==null&&bt!==K);Ye===null?_e=z:Ye.next=Ve,Yo(z,g.memoizedState)||(qs=!0),g.memoizedState=z,g.baseState=_e,g.baseQueue=Ye,E.lastRenderedState=z}if(f=E.interleaved,f!==null){$=f;do K=$.lane,Fr.lanes|=K,xe|=K,$=$.next;while($!==f)}else $===null&&(E.lanes=0);return[g.memoizedState,E.dispatch]}function Gd(f){var g=lo(),E=g.queue;if(E===null)throw Error(y(311));E.lastRenderedReducer=f;var z=E.dispatch,$=E.pending,K=g.memoizedState;if($!==null){E.pending=null;var _e=$=$.next;do K=f(K,_e.action),_e=_e.next;while(_e!==$);Yo(K,g.memoizedState)||(qs=!0),g.memoizedState=K,g.baseQueue===null&&(g.baseState=K),E.lastRenderedState=K}return[K,z]}function Bf(){}function Zc(f,g){var E=Fr,z=lo(),$=g(),K=!Yo(z.memoizedState,$);if(K&&(z.memoizedState=$,qs=!0),z=z.queue,Va(jf.bind(null,E,z,f),[f]),z.getSnapshot!==g||K||ms!==null&&ms.memoizedState.tag&1){if(E.flags|=2048,Wu(9,Lp.bind(null,E,z,$,g),void 0,null),Y===null)throw Error(y(349));(Eo&30)!==0||Dp(E,g,$)}return $}function Dp(f,g,E){f.flags|=16384,f={getSnapshot:g,value:E},g=Fr.updateQueue,g===null?(g={lastEffect:null,stores:null},Fr.updateQueue=g,g.stores=[f]):(E=g.stores,E===null?g.stores=[f]:E.push(f))}function Lp(f,g,E,z){g.value=E,g.getSnapshot=z,Uh(g)&&$d(f)}function jf(f,g,E){return E(function(){Uh(g)&&$d(f)})}function Uh(f){var g=f.getSnapshot;f=f.value;try{var E=g();return!Yo(f,E)}catch{return!0}}function $d(f){var g=Fa(f,1);g!==null&&Ot(g,f,1,-1)}function Hd(f){var g=is();return typeof f=="function"&&(f=f()),g.memoizedState=g.baseState=f,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:oc,lastRenderedState:f},g.queue=f,f=f.dispatch=Zd.bind(null,Fr,f),[g.memoizedState,f]}function Wu(f,g,E,z){return f={tag:f,create:g,destroy:E,deps:z,next:null},g=Fr.updateQueue,g===null?(g={lastEffect:null,stores:null},Fr.updateQueue=g,g.lastEffect=f.next=f):(E=g.lastEffect,E===null?g.lastEffect=f.next=f:(z=E.next,E.next=f,f.next=z,g.lastEffect=f)),f}function Gh(){return lo().memoizedState}function ac(f,g,E,z){var $=is();Fr.flags|=f,$.memoizedState=Wu(1|g,E,void 0,z===void 0?null:z)}function ja(f,g,E,z){var $=lo();z=z===void 0?null:z;var K=void 0;if(ts!==null){var _e=ts.memoizedState;if(K=_e.destroy,z!==null&&pl(z,_e.deps)){$.memoizedState=Wu(g,E,K,z);return}}Fr.flags|=f,$.memoizedState=Wu(1|g,E,K,z)}function Wd(f,g){return ac(8390656,8,f,g)}function Va(f,g){return ja(2048,8,f,g)}function Is(f,g){return ja(4,2,f,g)}function zp(f,g){return ja(4,4,f,g)}function qu(f,g){if(typeof g=="function")return f=f(),g(f),function(){g(null)};if(g!=null)return f=f(),g.current=f,function(){g.current=null}}function Yn(f,g,E){return E=E!=null?E.concat([f]):null,ja(4,4,qu.bind(null,g,f),E)}function hn(){}function qd(f,g){var E=lo();g=g===void 0?null:g;var z=E.memoizedState;return z!==null&&g!==null&&pl(g,z[1])?z[0]:(E.memoizedState=[f,g],f)}function Ua(f,g){var E=lo();g=g===void 0?null:g;var z=E.memoizedState;return z!==null&&g!==null&&pl(g,z[1])?z[0]:(f=f(),E.memoizedState=[f,g],f)}function Zu(f,g,E){return(Eo&21)===0?(f.baseState&&(f.baseState=!1,qs=!0),f.memoizedState=E):(Yo(E,g)||(E=Ho(),Fr.lanes|=E,xe|=E,f.baseState=!0),g)}function Xu(f,g){var E=Xn;Xn=E!==0&&4>E?E:4,f(!0);var z=qc.transition;qc.transition={};try{f(!1),g()}finally{Xn=E,qc.transition=z}}function ml(){return lo().memoizedState}function Vf(f,g,E){var z=Wt(f);if(E={lane:z,action:E,hasEagerState:!1,eagerState:null,next:null},Xc(f))Xd(g,E);else if(E=Nf(f,g,E,z),E!==null){var $=jt();Ot(E,f,z,$),ha(E,g,z)}}function Zd(f,g,E){var z=Wt(f),$={lane:z,action:E,hasEagerState:!1,eagerState:null,next:null};if(Xc(f))Xd(g,$);else{var K=f.alternate;if(f.lanes===0&&(K===null||K.lanes===0)&&(K=g.lastRenderedReducer,K!==null))try{var _e=g.lastRenderedState,Ve=K(_e,E);if($.hasEagerState=!0,$.eagerState=Ve,Yo(Ve,_e)){var Ye=g.interleaved;Ye===null?($.next=$,qt(g)):($.next=Ye.next,Ye.next=$),g.interleaved=$;return}}catch{}finally{}E=Nf(f,g,$,z),E!==null&&($=jt(),Ot(E,f,z,$),ha(E,g,z))}}function Xc(f){var g=f.alternate;return f===Fr||g!==null&&g===Fr}function Xd(f,g){Ba=Ud=!0;var E=f.pending;E===null?g.next=g:(g.next=E.next,E.next=g),f.pending=g}function ha(f,g,E){if((E&4194240)!==0){var z=g.lanes;z&=f.pendingLanes,E|=z,g.lanes=E,Do(f,E)}}var da={readContext:es,useCallback:kt,useContext:kt,useEffect:kt,useImperativeHandle:kt,useInsertionEffect:kt,useLayoutEffect:kt,useMemo:kt,useReducer:kt,useRef:kt,useState:kt,useDebugValue:kt,useDeferredValue:kt,useTransition:kt,useMutableSource:kt,useSyncExternalStore:kt,useId:kt,unstable_isNewReconciler:!1},$h={readContext:es,useCallback:function(f,g){return is().memoizedState=[f,g===void 0?null:g],f},useContext:es,useEffect:Wd,useImperativeHandle:function(f,g,E){return E=E!=null?E.concat([f]):null,ac(4194308,4,qu.bind(null,g,f),E)},useLayoutEffect:function(f,g){return ac(4194308,4,f,g)},useInsertionEffect:function(f,g){return ac(4,2,f,g)},useMemo:function(f,g){var E=is();return g=g===void 0?null:g,f=f(),E.memoizedState=[f,g],f},useReducer:function(f,g,E){var z=is();return g=E!==void 0?E(g):g,z.memoizedState=z.baseState=g,f={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:g},z.queue=f,f=f.dispatch=Vf.bind(null,Fr,f),[z.memoizedState,f]},useRef:function(f){var g=is();return f={current:f},g.memoizedState=f},useState:Hd,useDebugValue:hn,useDeferredValue:function(f){return is().memoizedState=f},useTransition:function(){var f=Hd(!1),g=f[0];return f=Xu.bind(null,f[1]),is().memoizedState=f,[g,f]},useMutableSource:function(){},useSyncExternalStore:function(f,g,E){var z=Fr,$=is();if(Dr){if(E===void 0)throw Error(y(407));E=E()}else{if(E=g(),Y===null)throw Error(y(349));(Eo&30)!==0||Dp(z,g,E)}$.memoizedState=E;var K={value:E,getSnapshot:g};return $.queue=K,Wd(jf.bind(null,z,K,f),[f]),z.flags|=2048,Wu(9,Lp.bind(null,z,K,E,g),void 0,null),E},useId:function(){var f=is(),g=Y.identifierPrefix;if(Dr){var E=La,z=la;E=(z&~(1<<32-to(z)-1)).toString(32)+E,g=":"+g+"R"+E,E=ua++,0<E&&(g+="H"+E.toString(32)),g+=":"}else E=wt++,g=":"+g+"r"+E.toString(32)+":";return f.memoizedState=g},unstable_isNewReconciler:!1},Yd={readContext:es,useCallback:qd,useContext:es,useEffect:Va,useImperativeHandle:Yn,useInsertionEffect:Is,useLayoutEffect:zp,useMemo:Ua,useReducer:Vh,useRef:Gh,useState:function(){return Vh(oc)},useDebugValue:hn,useDeferredValue:function(f){var g=lo();return Zu(g,ts.memoizedState,f)},useTransition:function(){var f=Vh(oc)[0],g=lo().memoizedState;return[f,g]},useMutableSource:Bf,useSyncExternalStore:Zc,useId:ml,unstable_isNewReconciler:!1},Yu={readContext:es,useCallback:qd,useContext:es,useEffect:Va,useImperativeHandle:Yn,useInsertionEffect:Is,useLayoutEffect:zp,useMemo:Ua,useReducer:Gd,useRef:Gh,useState:function(){return Gd(oc)},useDebugValue:hn,useDeferredValue:function(f){var g=lo();return ts===null?g.memoizedState=f:Zu(g,ts.memoizedState,f)},useTransition:function(){var f=Gd(oc)[0],g=lo().memoizedState;return[f,g]},useMutableSource:Bf,useSyncExternalStore:Zc,useId:ml,unstable_isNewReconciler:!1};function Ws(f,g){if(f&&f.defaultProps){g=Kt({},g),f=f.defaultProps;for(var E in f)g[E]===void 0&&(g[E]=f[E]);return g}return g}function Xr(f,g,E,z){g=f.memoizedState,E=E(z,g),E=E==null?g:Kt({},g,E),f.memoizedState=E,f.lanes===0&&(f.updateQueue.baseState=E)}var gl={isMounted:function(f){return(f=f._reactInternals)?Ze(f)===f:!1},enqueueSetState:function(f,g,E){f=f._reactInternals;var z=jt(),$=Wt(f),K=No(z,$);K.payload=g,E!=null&&(K.callback=E),g=rc(f,K,$),g!==null&&(Ot(g,f,$,z),Bd(g,f,$))},enqueueReplaceState:function(f,g,E){f=f._reactInternals;var z=jt(),$=Wt(f),K=No(z,$);K.tag=1,K.payload=g,E!=null&&(K.callback=E),g=rc(f,K,$),g!==null&&(Ot(g,f,$,z),Bd(g,f,$))},enqueueForceUpdate:function(f,g){f=f._reactInternals;var E=jt(),z=Wt(f),$=No(E,z);$.tag=2,g!=null&&($.callback=g),g=rc(f,$,z),g!==null&&(Ot(g,f,z,E),Bd(g,f,z))}};function _l(f,g,E,z,$,K,_e){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(z,K,_e):g.prototype&&g.prototype.isPureReactComponent?!sa(E,z)||!sa($,K):!0}function Kd(f,g,E){var z=!1,$=vo,K=g.contextType;return typeof K=="object"&&K!==null?K=es(K):($=Ss(g)?fs:Vr.current,z=g.contextTypes,K=(z=z!=null)?ul(f,$):vo),g=new g(E,K),f.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=gl,f.stateNode=g,g._reactInternals=f,z&&(f=f.stateNode,f.__reactInternalMemoizedUnmaskedChildContext=$,f.__reactInternalMemoizedMaskedChildContext=K),g}function Hh(f,g,E,z){f=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(E,z),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(E,z),g.state!==f&&gl.enqueueReplaceState(g,g.state,null)}function Wh(f,g,E,z){var $=f.stateNode;$.props=E,$.state=f.memoizedState,$.refs={},Oa(f);var K=g.contextType;typeof K=="object"&&K!==null?$.context=es(K):(K=Ss(g)?fs:Vr.current,$.context=ul(f,K)),$.state=f.memoizedState,K=g.getDerivedStateFromProps,typeof K=="function"&&(Xr(f,g,K,E),$.state=f.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof $.getSnapshotBeforeUpdate=="function"||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(g=$.state,typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount(),g!==$.state&&gl.enqueueReplaceState($,$.state,null),Bh(f,E,$,z),$.state=f.memoizedState),typeof $.componentDidMount=="function"&&(f.flags|=4194308)}function Ga(f,g){try{var E="",z=g;do E+=Di(z),z=z.return;while(z);var $=E}catch(K){$=`
Error generating stack: `+K.message+`
`+K.stack}return{value:f,source:g,stack:$,digest:null}}function Yr(f,g,E){return{value:f,source:null,stack:E??null,digest:g??null}}function Yc(f,g){try{console.error(g.value)}catch(E){setTimeout(function(){throw E})}}var Uf=typeof WeakMap=="function"?WeakMap:Map;function Jd(f,g,E){E=No(-1,E),E.tag=3,E.payload={element:null};var z=g.value;return E.callback=function(){ht||(ht=!0,Be=z),Yc(f,g)},E}function yl(f,g,E){E=No(-1,E),E.tag=3;var z=f.type.getDerivedStateFromError;if(typeof z=="function"){var $=g.value;E.payload=function(){return z($)},E.callback=function(){Yc(f,g)}}var K=f.stateNode;return K!==null&&typeof K.componentDidCatch=="function"&&(E.callback=function(){Yc(f,g),typeof z!="function"&&(Xe===null?Xe=new Set([this]):Xe.add(this));var _e=g.stack;this.componentDidCatch(g.value,{componentStack:_e!==null?_e:""})}),E}function Ku(f,g,E){var z=f.pingCache;if(z===null){z=f.pingCache=new Uf;var $=new Set;z.set(g,$)}else $=z.get(g),$===void 0&&($=new Set,z.set(g,$));$.has(E)||($.add(E),f=vr.bind(null,f,g,E),g.then(f,f))}function Qd(f){do{var g;if((g=f.tag===13)&&(g=f.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return f;f=f.return}while(f!==null);return null}function qh(f,g,E,z,$){return(f.mode&1)===0?(f===g?f.flags|=65536:(f.flags|=128,E.flags|=131072,E.flags&=-52805,E.tag===1&&(E.alternate===null?E.tag=17:(g=No(-1,1),g.tag=2,rc(E,g,1))),E.lanes|=1),f):(f.flags|=65536,f.lanes=$,f)}var Kc=Tt.ReactCurrentOwner,qs=!1;function gs(f,g,E,z){g.child=f===null?za(g,null,E,z):hl(g,f.child,E,z)}function Jc(f,g,E,z,$){E=E.render;var K=g.ref;return nc(g,$),z=ur(f,g,E,z,K,$),E=je(),f!==null&&!qs?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~$,Vn(f,g,$)):(Dr&&E&&Dh(g),g.flags|=1,gs(f,g,z,$),g.child)}function Ju(f,g,E,z,$){if(f===null){var K=E.type;return typeof K=="function"&&!Co(K)&&K.defaultProps===void 0&&E.compare===null&&E.defaultProps===void 0?(g.tag=15,g.type=K,ef(f,g,K,z,$)):(f=Ao(E.type,null,z,g,g.mode,$),f.ref=g.ref,f.return=g,g.child=f)}if(K=f.child,(f.lanes&$)===0){var _e=K.memoizedProps;if(E=E.compare,E=E!==null?E:sa,E(_e,z)&&f.ref===g.ref)return Vn(f,g,$)}return g.flags|=1,f=ho(K,z),f.ref=g.ref,f.return=g,g.child=f}function ef(f,g,E,z,$){if(f!==null){var K=f.memoizedProps;if(sa(K,z)&&f.ref===g.ref)if(qs=!1,g.pendingProps=z=K,(f.lanes&$)!==0)(f.flags&131072)!==0&&(qs=!0);else return g.lanes=f.lanes,Vn(f,g,$)}return Qu(f,g,E,z,$)}function Zh(f,g,E){var z=g.pendingProps,$=z.children,K=f!==null?f.memoizedState:null;if(z.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Mr(pe,ue),ue|=E;else{if((E&1073741824)===0)return f=K!==null?K.baseLanes|E:E,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:f,cachePool:null,transitions:null},g.updateQueue=null,Mr(pe,ue),ue|=f,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},z=K!==null?K.baseLanes:E,Mr(pe,ue),ue|=z}else K!==null?(z=K.baseLanes|E,g.memoizedState=null):z=E,Mr(pe,ue),ue|=z;return gs(f,g,$,E),g.child}function Gf(f,g){var E=g.ref;(f===null&&E!==null||f!==null&&f.ref!==E)&&(g.flags|=512,g.flags|=2097152)}function Qu(f,g,E,z,$){var K=Ss(E)?fs:Vr.current;return K=ul(g,K),nc(g,$),E=ur(f,g,E,z,K,$),z=je(),f!==null&&!qs?(g.updateQueue=f.updateQueue,g.flags&=-2053,f.lanes&=~$,Vn(f,g,$)):(Dr&&z&&Dh(g),g.flags|=1,gs(f,g,E,$),g.child)}function $f(f,g,E,z,$){if(Ss(E)){var K=!0;Vc(g)}else K=!1;if(nc(g,$),g.stateNode===null)Qc(f,g),Kd(g,E,z),Wh(g,E,z,$),z=!0;else if(f===null){var _e=g.stateNode,Ve=g.memoizedProps;_e.props=Ve;var Ye=_e.context,bt=E.contextType;typeof bt=="object"&&bt!==null?bt=es(bt):(bt=Ss(E)?fs:Vr.current,bt=ul(g,bt));var li=E.getDerivedStateFromProps,ci=typeof li=="function"||typeof _e.getSnapshotBeforeUpdate=="function";ci||typeof _e.UNSAFE_componentWillReceiveProps!="function"&&typeof _e.componentWillReceiveProps!="function"||(Ve!==z||Ye!==bt)&&Hh(g,_e,z,bt),ao=!1;var si=g.memoizedState;_e.state=si,Bh(g,z,_e,$),Ye=g.memoizedState,Ve!==z||si!==Ye||ro.current||ao?(typeof li=="function"&&(Xr(g,E,li,z),Ye=g.memoizedState),(Ve=ao||_l(g,E,Ve,z,si,Ye,bt))?(ci||typeof _e.UNSAFE_componentWillMount!="function"&&typeof _e.componentWillMount!="function"||(typeof _e.componentWillMount=="function"&&_e.componentWillMount(),typeof _e.UNSAFE_componentWillMount=="function"&&_e.UNSAFE_componentWillMount()),typeof _e.componentDidMount=="function"&&(g.flags|=4194308)):(typeof _e.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=z,g.memoizedState=Ye),_e.props=z,_e.state=Ye,_e.context=bt,z=Ve):(typeof _e.componentDidMount=="function"&&(g.flags|=4194308),z=!1)}else{_e=g.stateNode,fi(f,g),Ve=g.memoizedProps,bt=g.type===g.elementType?Ve:Ws(g.type,Ve),_e.props=bt,ci=g.pendingProps,si=_e.context,Ye=E.contextType,typeof Ye=="object"&&Ye!==null?Ye=es(Ye):(Ye=Ss(E)?fs:Vr.current,Ye=ul(g,Ye));var ki=E.getDerivedStateFromProps;(li=typeof ki=="function"||typeof _e.getSnapshotBeforeUpdate=="function")||typeof _e.UNSAFE_componentWillReceiveProps!="function"&&typeof _e.componentWillReceiveProps!="function"||(Ve!==ci||si!==Ye)&&Hh(g,_e,z,Ye),ao=!1,si=g.memoizedState,_e.state=si,Bh(g,z,_e,$);var ji=g.memoizedState;Ve!==ci||si!==ji||ro.current||ao?(typeof ki=="function"&&(Xr(g,E,ki,z),ji=g.memoizedState),(bt=ao||_l(g,E,bt,z,si,ji,Ye)||!1)?(li||typeof _e.UNSAFE_componentWillUpdate!="function"&&typeof _e.componentWillUpdate!="function"||(typeof _e.componentWillUpdate=="function"&&_e.componentWillUpdate(z,ji,Ye),typeof _e.UNSAFE_componentWillUpdate=="function"&&_e.UNSAFE_componentWillUpdate(z,ji,Ye)),typeof _e.componentDidUpdate=="function"&&(g.flags|=4),typeof _e.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof _e.componentDidUpdate!="function"||Ve===f.memoizedProps&&si===f.memoizedState||(g.flags|=4),typeof _e.getSnapshotBeforeUpdate!="function"||Ve===f.memoizedProps&&si===f.memoizedState||(g.flags|=1024),g.memoizedProps=z,g.memoizedState=ji),_e.props=z,_e.state=ji,_e.context=Ye,z=bt):(typeof _e.componentDidUpdate!="function"||Ve===f.memoizedProps&&si===f.memoizedState||(g.flags|=4),typeof _e.getSnapshotBeforeUpdate!="function"||Ve===f.memoizedProps&&si===f.memoizedState||(g.flags|=1024),z=!1)}return tf(f,g,E,z,K,$)}function tf(f,g,E,z,$,K){Gf(f,g);var _e=(g.flags&128)!==0;if(!z&&!_e)return $&&Ou(g,E,!1),Vn(f,g,K);z=g.stateNode,Kc.current=g;var Ve=_e&&typeof E.getDerivedStateFromError!="function"?null:z.render();return g.flags|=1,f!==null&&_e?(g.child=hl(g,f.child,null,K),g.child=hl(g,null,Ve,K)):gs(f,g,Ve,K),g.memoizedState=z.state,$&&Ou(g,E,!0),g.child}function Hf(f){var g=f.stateNode;g.pendingContext?Dd(f,g.pendingContext,g.pendingContext!==g.context):g.context&&Dd(f,g.context,!1),As(f,g.containerInfo)}function Wf(f,g,E,z,$){return $c(),To($),g.flags|=256,gs(f,g,E,z),g.child}var Xh={dehydrated:null,treeContext:null,retryLane:0};function nf(f){return{baseLanes:f,cachePool:null,transitions:null}}function qf(f,g,E){var z=g.pendingProps,$=Rr.current,K=!1,_e=(g.flags&128)!==0,Ve;if((Ve=_e)||(Ve=f!==null&&f.memoizedState===null?!1:($&2)!==0),Ve?(K=!0,g.flags&=-129):(f===null||f.memoizedState!==null)&&($|=1),Mr(Rr,$&1),f===null)return Fh(g),f=g.memoizedState,f!==null&&(f=f.dehydrated,f!==null)?((g.mode&1)===0?g.lanes=1:f.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(_e=z.children,f=z.fallback,K?(z=g.mode,K=g.child,_e={mode:"hidden",children:_e},(z&1)===0&&K!==null?(K.childLanes=0,K.pendingProps=_e):K=lc(_e,z,0,null),f=Io(f,z,E,null),K.return=g,f.return=g,K.sibling=f,g.child=K,g.child.memoizedState=nf(E),g.memoizedState=Xh,f):rf(g,_e));if($=f.memoizedState,$!==null&&(Ve=$.dehydrated,Ve!==null))return Fp(f,g,_e,z,Ve,$,E);if(K){K=z.fallback,_e=g.mode,$=f.child,Ve=$.sibling;var Ye={mode:"hidden",children:z.children};return(_e&1)===0&&g.child!==$?(z=g.child,z.childLanes=0,z.pendingProps=Ye,g.deletions=null):(z=ho($,Ye),z.subtreeFlags=$.subtreeFlags&14680064),Ve!==null?K=ho(Ve,K):(K=Io(K,_e,E,null),K.flags|=2),K.return=g,z.return=g,z.sibling=K,g.child=z,z=K,K=g.child,_e=f.child.memoizedState,_e=_e===null?nf(E):{baseLanes:_e.baseLanes|E,cachePool:null,transitions:_e.transitions},K.memoizedState=_e,K.childLanes=f.childLanes&~E,g.memoizedState=Xh,z}return K=f.child,f=K.sibling,z=ho(K,{mode:"visible",children:z.children}),(g.mode&1)===0&&(z.lanes=E),z.return=g,z.sibling=null,f!==null&&(E=g.deletions,E===null?(g.deletions=[f],g.flags|=16):E.push(f)),g.child=z,g.memoizedState=null,z}function rf(f,g){return g=lc({mode:"visible",children:g},f.mode,0,null),g.return=f,f.child=g}function Yh(f,g,E,z){return z!==null&&To(z),hl(g,f.child,null,E),f=rf(g,g.pendingProps.children),f.flags|=2,g.memoizedState=null,f}function Fp(f,g,E,z,$,K,_e){if(E)return g.flags&256?(g.flags&=-257,z=Yr(Error(y(422))),Yh(f,g,_e,z)):g.memoizedState!==null?(g.child=f.child,g.flags|=128,null):(K=z.fallback,$=g.mode,z=lc({mode:"visible",children:z.children},$,0,null),K=Io(K,$,_e,null),K.flags|=2,z.return=g,K.return=g,z.sibling=K,g.child=z,(g.mode&1)!==0&&hl(g,f.child,null,_e),g.child.memoizedState=nf(_e),g.memoizedState=Xh,K);if((g.mode&1)===0)return Yh(f,g,_e,null);if($.data==="$!"){if(z=$.nextSibling&&$.nextSibling.dataset,z)var Ve=z.dgst;return z=Ve,K=Error(y(419)),z=Yr(K,z,void 0),Yh(f,g,_e,z)}if(Ve=(_e&f.childLanes)!==0,qs||Ve){if(z=Y,z!==null){switch(_e&-_e){case 4:$=2;break;case 16:$=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:$=32;break;case 536870912:$=268435456;break;default:$=0}$=($&(z.suspendedLanes|_e))!==0?0:$,$!==0&&$!==K.retryLane&&(K.retryLane=$,Fa(f,$),Ot(z,f,$,-1))}return Gn(),z=Yr(Error(y(421))),Yh(f,g,_e,z)}return $.data==="$?"?(g.flags|=128,g.child=f.child,g=ir.bind(null,f),$._reactRetry=g,null):(f=K.treeContext,ps=Ia($.nextSibling),Qr=g,Dr=!0,Es=null,f!==null&&(so[Ko++]=la,so[Ko++]=La,so[Ko++]=Da,la=f.id,La=f.overflow,Da=g),g=rf(g,z.children),g.flags|=4096,g)}function Zf(f,g,E){f.lanes|=g;var z=f.alternate;z!==null&&(z.lanes|=g),Nh(f.return,g,E)}function Xf(f,g,E,z,$){var K=f.memoizedState;K===null?f.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:z,tail:E,tailMode:$}:(K.isBackwards=g,K.rendering=null,K.renderingStartTime=0,K.last=z,K.tail=E,K.tailMode=$)}function Op(f,g,E){var z=g.pendingProps,$=z.revealOrder,K=z.tail;if(gs(f,g,z.children,E),z=Rr.current,(z&2)!==0)z=z&1|2,g.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=g.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&Zf(f,E,g);else if(f.tag===19)Zf(f,E,g);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===g)break e;for(;f.sibling===null;){if(f.return===null||f.return===g)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}z&=1}if(Mr(Rr,z),(g.mode&1)===0)g.memoizedState=null;else switch($){case"forwards":for(E=g.child,$=null;E!==null;)f=E.alternate,f!==null&&fl(f)===null&&($=E),E=E.sibling;E=$,E===null?($=g.child,g.child=null):($=E.sibling,E.sibling=null),Xf(g,!1,$,E,K);break;case"backwards":for(E=null,$=g.child,g.child=null;$!==null;){if(f=$.alternate,f!==null&&fl(f)===null){g.child=$;break}f=$.sibling,$.sibling=E,E=$,$=f}Xf(g,!0,E,null,K);break;case"together":Xf(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function Qc(f,g){(g.mode&1)===0&&f!==null&&(f.alternate=null,g.alternate=null,g.flags|=2)}function Vn(f,g,E){if(f!==null&&(g.dependencies=f.dependencies),xe|=g.lanes,(E&g.childLanes)===0)return null;if(f!==null&&g.child!==f.child)throw Error(y(153));if(g.child!==null){for(f=g.child,E=ho(f,f.pendingProps),g.child=E,E.return=g;f.sibling!==null;)f=f.sibling,E=E.sibling=ho(f,f.pendingProps),E.return=g;E.sibling=null}return g.child}function Np(f,g,E){switch(g.tag){case 3:Hf(g),$c();break;case 5:sc(g);break;case 1:Ss(g.type)&&Vc(g);break;case 4:As(g,g.stateNode.containerInfo);break;case 10:var z=g.type._context,$=g.memoizedProps.value;Mr(Ql,z._currentValue),z._currentValue=$;break;case 13:if(z=g.memoizedState,z!==null)return z.dehydrated!==null?(Mr(Rr,Rr.current&1),g.flags|=128,null):(E&g.child.childLanes)!==0?qf(f,g,E):(Mr(Rr,Rr.current&1),f=Vn(f,g,E),f!==null?f.sibling:null);Mr(Rr,Rr.current&1);break;case 19:if(z=(E&g.childLanes)!==0,(f.flags&128)!==0){if(z)return Op(f,g,E);g.flags|=128}if($=g.memoizedState,$!==null&&($.rendering=null,$.tail=null,$.lastEffect=null),Mr(Rr,Rr.current),z)break;return null;case 22:case 23:return g.lanes=0,Zh(f,g,E)}return Vn(f,g,E)}var Kh,Jh,Yf,eh;Kh=function(f,g){for(var E=g.child;E!==null;){if(E.tag===5||E.tag===6)f.appendChild(E.stateNode);else if(E.tag!==4&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===g)break;for(;E.sibling===null;){if(E.return===null||E.return===g)return;E=E.return}E.sibling.return=E.return,E=E.sibling}},Jh=function(){},Yf=function(f,g,E,z){var $=f.memoizedProps;if($!==z){f=g.stateNode,dl(Na.current);var K=null;switch(E){case"input":$=_a(f,$),z=_a(f,z),K=[];break;case"select":$=Kt({},$,{value:void 0}),z=Kt({},z,{value:void 0}),K=[];break;case"textarea":$=ya(f,$),z=ya(f,z),K=[];break;default:typeof $.onClick!="function"&&typeof z.onClick=="function"&&(f.onclick=cl)}wa(E,z);var _e;E=null;for(bt in $)if(!z.hasOwnProperty(bt)&&$.hasOwnProperty(bt)&&$[bt]!=null)if(bt==="style"){var Ve=$[bt];for(_e in Ve)Ve.hasOwnProperty(_e)&&(E||(E={}),E[_e]="")}else bt!=="dangerouslySetInnerHTML"&&bt!=="children"&&bt!=="suppressContentEditableWarning"&&bt!=="suppressHydrationWarning"&&bt!=="autoFocus"&&(C.hasOwnProperty(bt)?K||(K=[]):(K=K||[]).push(bt,null));for(bt in z){var Ye=z[bt];if(Ve=$!=null?$[bt]:void 0,z.hasOwnProperty(bt)&&Ye!==Ve&&(Ye!=null||Ve!=null))if(bt==="style")if(Ve){for(_e in Ve)!Ve.hasOwnProperty(_e)||Ye&&Ye.hasOwnProperty(_e)||(E||(E={}),E[_e]="");for(_e in Ye)Ye.hasOwnProperty(_e)&&Ve[_e]!==Ye[_e]&&(E||(E={}),E[_e]=Ye[_e])}else E||(K||(K=[]),K.push(bt,E)),E=Ye;else bt==="dangerouslySetInnerHTML"?(Ye=Ye?Ye.__html:void 0,Ve=Ve?Ve.__html:void 0,Ye!=null&&Ve!==Ye&&(K=K||[]).push(bt,Ye)):bt==="children"?typeof Ye!="string"&&typeof Ye!="number"||(K=K||[]).push(bt,""+Ye):bt!=="suppressContentEditableWarning"&&bt!=="suppressHydrationWarning"&&(C.hasOwnProperty(bt)?(Ye!=null&&bt==="onScroll"&&Ir("scroll",f),K||Ve===Ye||(K=[])):(K=K||[]).push(bt,Ye))}E&&(K=K||[]).push("style",E);var bt=K;(g.updateQueue=bt)&&(g.flags|=4)}},eh=function(f,g,E,z){E!==z&&(g.flags|=4)};function eu(f,g){if(!Dr)switch(f.tailMode){case"hidden":g=f.tail;for(var E=null;g!==null;)g.alternate!==null&&(E=g),g=g.sibling;E===null?f.tail=null:E.sibling=null;break;case"collapsed":E=f.tail;for(var z=null;E!==null;)E.alternate!==null&&(z=E),E=E.sibling;z===null?g||f.tail===null?f.tail=null:f.tail.sibling=null:z.sibling=null}}function _s(f){var g=f.alternate!==null&&f.alternate.child===f.child,E=0,z=0;if(g)for(var $=f.child;$!==null;)E|=$.lanes|$.childLanes,z|=$.subtreeFlags&14680064,z|=$.flags&14680064,$.return=f,$=$.sibling;else for($=f.child;$!==null;)E|=$.lanes|$.childLanes,z|=$.subtreeFlags,z|=$.flags,$.return=f,$=$.sibling;return f.subtreeFlags|=z,f.childLanes=E,g}function Qh(f,g,E){var z=g.pendingProps;switch(Nd(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _s(g),null;case 1:return Ss(g.type)&&jc(),_s(g),null;case 3:return z=g.stateNode,So(),Pr(ro),Pr(Vr),ca(),z.pendingContext&&(z.context=z.pendingContext,z.pendingContext=null),(f===null||f.child===null)&&(Jl(g)?g.flags|=4:f===null||f.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Es!==null&&(wi(Es),Es=null))),Jh(f,g),_s(g),null;case 5:Hu(g);var $=dl(Cs.current);if(E=g.type,f!==null&&g.stateNode!=null)Yf(f,g,E,z,$),f.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!z){if(g.stateNode===null)throw Error(y(166));return _s(g),null}if(f=dl(Na.current),Jl(g)){z=g.stateNode,E=g.type;var K=g.memoizedProps;switch(z[aa]=g,z[zu]=K,f=(g.mode&1)!==0,E){case"dialog":Ir("cancel",z),Ir("close",z);break;case"iframe":case"object":case"embed":Ir("load",z);break;case"video":case"audio":for($=0;$<Xl.length;$++)Ir(Xl[$],z);break;case"source":Ir("error",z);break;case"img":case"image":case"link":Ir("error",z),Ir("load",z);break;case"details":Ir("toggle",z);break;case"input":Go(z,K),Ir("invalid",z);break;case"select":z._wrapperState={wasMultiple:!!K.multiple},Ir("invalid",z);break;case"textarea":Ja(z,K),Ir("invalid",z)}wa(E,K),$=null;for(var _e in K)if(K.hasOwnProperty(_e)){var Ve=K[_e];_e==="children"?typeof Ve=="string"?z.textContent!==Ve&&(K.suppressHydrationWarning!==!0&&Aa(z.textContent,Ve,f),$=["children",Ve]):typeof Ve=="number"&&z.textContent!==""+Ve&&(K.suppressHydrationWarning!==!0&&Aa(z.textContent,Ve,f),$=["children",""+Ve]):C.hasOwnProperty(_e)&&Ve!=null&&_e==="onScroll"&&Ir("scroll",z)}switch(E){case"input":js(z),pu(z,K,!0);break;case"textarea":js(z),gc(z);break;case"select":case"option":break;default:typeof K.onClick=="function"&&(z.onclick=cl)}z=$,g.updateQueue=z,z!==null&&(g.flags|=4)}else{_e=$.nodeType===9?$:$.ownerDocument,f==="http://www.w3.org/1999/xhtml"&&(f=_c(E)),f==="http://www.w3.org/1999/xhtml"?E==="script"?(f=_e.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild)):typeof z.is=="string"?f=_e.createElement(E,{is:z.is}):(f=_e.createElement(E),E==="select"&&(_e=f,z.multiple?_e.multiple=!0:z.size&&(_e.size=z.size))):f=_e.createElementNS(f,E),f[aa]=g,f[zu]=z,Kh(f,g,!1,!1),g.stateNode=f;e:{switch(_e=Pl(E,z),E){case"dialog":Ir("cancel",f),Ir("close",f),$=z;break;case"iframe":case"object":case"embed":Ir("load",f),$=z;break;case"video":case"audio":for($=0;$<Xl.length;$++)Ir(Xl[$],f);$=z;break;case"source":Ir("error",f),$=z;break;case"img":case"image":case"link":Ir("error",f),Ir("load",f),$=z;break;case"details":Ir("toggle",f),$=z;break;case"input":Go(f,z),$=_a(f,z),Ir("invalid",f);break;case"option":$=z;break;case"select":f._wrapperState={wasMultiple:!!z.multiple},$=Kt({},z,{value:void 0}),Ir("invalid",f);break;case"textarea":Ja(f,z),$=ya(f,z),Ir("invalid",f);break;default:$=z}wa(E,$),Ve=$;for(K in Ve)if(Ve.hasOwnProperty(K)){var Ye=Ve[K];K==="style"?Qa(f,Ye):K==="dangerouslySetInnerHTML"?(Ye=Ye?Ye.__html:void 0,Ye!=null&&xa(f,Ye)):K==="children"?typeof Ye=="string"?(E!=="textarea"||Ye!=="")&&va(f,Ye):typeof Ye=="number"&&va(f,""+Ye):K!=="suppressContentEditableWarning"&&K!=="suppressHydrationWarning"&&K!=="autoFocus"&&(C.hasOwnProperty(K)?Ye!=null&&K==="onScroll"&&Ir("scroll",f):Ye!=null&&pt(f,K,Ye,_e))}switch(E){case"input":js(f),pu(f,z,!1);break;case"textarea":js(f),gc(f);break;case"option":z.value!=null&&f.setAttribute("value",""+Ln(z.value));break;case"select":f.multiple=!!z.multiple,K=z.value,K!=null?ko(f,!!z.multiple,K,!1):z.defaultValue!=null&&ko(f,!!z.multiple,z.defaultValue,!0);break;default:typeof $.onClick=="function"&&(f.onclick=cl)}switch(E){case"button":case"input":case"select":case"textarea":z=!!z.autoFocus;break e;case"img":z=!0;break e;default:z=!1}}z&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return _s(g),null;case 6:if(f&&g.stateNode!=null)eh(f,g,f.memoizedProps,z);else{if(typeof z!="string"&&g.stateNode===null)throw Error(y(166));if(E=dl(Cs.current),dl(Na.current),Jl(g)){if(z=g.stateNode,E=g.memoizedProps,z[aa]=g,(K=z.nodeValue!==E)&&(f=Qr,f!==null))switch(f.tag){case 3:Aa(z.nodeValue,E,(f.mode&1)!==0);break;case 5:f.memoizedProps.suppressHydrationWarning!==!0&&Aa(z.nodeValue,E,(f.mode&1)!==0)}K&&(g.flags|=4)}else z=(E.nodeType===9?E:E.ownerDocument).createTextNode(z),z[aa]=g,g.stateNode=z}return _s(g),null;case 13:if(Pr(Rr),z=g.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(Dr&&ps!==null&&(g.mode&1)!==0&&(g.flags&128)===0)Of(),$c(),g.flags|=98560,K=!1;else if(K=Jl(g),z!==null&&z.dehydrated!==null){if(f===null){if(!K)throw Error(y(318));if(K=g.memoizedState,K=K!==null?K.dehydrated:null,!K)throw Error(y(317));K[aa]=g}else $c(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;_s(g),K=!1}else Es!==null&&(wi(Es),Es=null),K=!0;if(!K)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=E,g):(z=z!==null,z!==(f!==null&&f.memoizedState!==null)&&z&&(g.child.flags|=8192,(g.mode&1)!==0&&(f===null||(Rr.current&1)!==0?be===0&&(be=3):Gn())),g.updateQueue!==null&&(g.flags|=4),_s(g),null);case 4:return So(),Jh(f,g),f===null&&Ph(g.stateNode.containerInfo),_s(g),null;case 10:return Gu(g.type._context),_s(g),null;case 17:return Ss(g.type)&&jc(),_s(g),null;case 19:if(Pr(Rr),K=g.memoizedState,K===null)return _s(g),null;if(z=(g.flags&128)!==0,_e=K.rendering,_e===null)if(z)eu(K,!1);else{if(be!==0||f!==null&&(f.flags&128)!==0)for(f=g.child;f!==null;){if(_e=fl(f),_e!==null){for(g.flags|=128,eu(K,!1),z=_e.updateQueue,z!==null&&(g.updateQueue=z,g.flags|=4),g.subtreeFlags=0,z=E,E=g.child;E!==null;)K=E,f=z,K.flags&=14680066,_e=K.alternate,_e===null?(K.childLanes=0,K.lanes=f,K.child=null,K.subtreeFlags=0,K.memoizedProps=null,K.memoizedState=null,K.updateQueue=null,K.dependencies=null,K.stateNode=null):(K.childLanes=_e.childLanes,K.lanes=_e.lanes,K.child=_e.child,K.subtreeFlags=0,K.deletions=null,K.memoizedProps=_e.memoizedProps,K.memoizedState=_e.memoizedState,K.updateQueue=_e.updateQueue,K.type=_e.type,f=_e.dependencies,K.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),E=E.sibling;return Mr(Rr,Rr.current&1|2),g.child}f=f.sibling}K.tail!==null&&nn()>nt&&(g.flags|=128,z=!0,eu(K,!1),g.lanes=4194304)}else{if(!z)if(f=fl(_e),f!==null){if(g.flags|=128,z=!0,E=f.updateQueue,E!==null&&(g.updateQueue=E,g.flags|=4),eu(K,!0),K.tail===null&&K.tailMode==="hidden"&&!_e.alternate&&!Dr)return _s(g),null}else 2*nn()-K.renderingStartTime>nt&&E!==1073741824&&(g.flags|=128,z=!0,eu(K,!1),g.lanes=4194304);K.isBackwards?(_e.sibling=g.child,g.child=_e):(E=K.last,E!==null?E.sibling=_e:g.child=_e,K.last=_e)}return K.tail!==null?(g=K.tail,K.rendering=g,K.tail=g.sibling,K.renderingStartTime=nn(),g.sibling=null,E=Rr.current,Mr(Rr,z?E&1|2:E&1),g):(_s(g),null);case 22:case 23:return _r(),z=g.memoizedState!==null,f!==null&&f.memoizedState!==null!==z&&(g.flags|=8192),z&&(g.mode&1)!==0?(ue&1073741824)!==0&&(_s(g),g.subtreeFlags&6&&(g.flags|=8192)):_s(g),null;case 24:return null;case 25:return null}throw Error(y(156,g.tag))}function xl(f,g){switch(Nd(g),g.tag){case 1:return Ss(g.type)&&jc(),f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 3:return So(),Pr(ro),Pr(Vr),ca(),f=g.flags,(f&65536)!==0&&(f&128)===0?(g.flags=f&-65537|128,g):null;case 5:return Hu(g),null;case 13:if(Pr(Rr),f=g.memoizedState,f!==null&&f.dehydrated!==null){if(g.alternate===null)throw Error(y(340));$c()}return f=g.flags,f&65536?(g.flags=f&-65537|128,g):null;case 19:return Pr(Rr),null;case 4:return So(),null;case 10:return Gu(g.type._context),null;case 22:case 23:return _r(),null;case 24:return null;default:return null}}var tu=!1,zn=!1,$a=typeof WeakSet=="function"?WeakSet:Set,Ri=null;function vl(f,g){var E=f.ref;if(E!==null)if(typeof E=="function")try{E(null)}catch(z){Fi(f,g,z)}else E.current=null}function sf(f,g,E){try{E()}catch(z){Fi(f,g,z)}}var Bp=!1;function th(f,g){if(Ru=gh,f=Ed(),Eh(f)){if("selectionStart"in f)var E={start:f.selectionStart,end:f.selectionEnd};else e:{E=(E=f.ownerDocument)&&E.defaultView||window;var z=E.getSelection&&E.getSelection();if(z&&z.rangeCount!==0){E=z.anchorNode;var $=z.anchorOffset,K=z.focusNode;z=z.focusOffset;try{E.nodeType,K.nodeType}catch{E=null;break e}var _e=0,Ve=-1,Ye=-1,bt=0,li=0,ci=f,si=null;t:for(;;){for(var ki;ci!==E||$!==0&&ci.nodeType!==3||(Ve=_e+$),ci!==K||z!==0&&ci.nodeType!==3||(Ye=_e+z),ci.nodeType===3&&(_e+=ci.nodeValue.length),(ki=ci.firstChild)!==null;)si=ci,ci=ki;for(;;){if(ci===f)break t;if(si===E&&++bt===$&&(Ve=_e),si===K&&++li===z&&(Ye=_e),(ki=ci.nextSibling)!==null)break;ci=si,si=ci.parentNode}ci=ki}E=Ve===-1||Ye===-1?null:{start:Ve,end:Ye}}else E=null}E=E||{start:0,end:0}}else E=null;for(ku={focusedElem:f,selectionRange:E},gh=!1,Ri=g;Ri!==null;)if(g=Ri,f=g.child,(g.subtreeFlags&1028)!==0&&f!==null)f.return=g,Ri=f;else for(;Ri!==null;){g=Ri;try{var ji=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(ji!==null){var $i=ji.memoizedProps,rs=ji.memoizedState,dt=g.stateNode,at=dt.getSnapshotBeforeUpdate(g.elementType===g.type?$i:Ws(g.type,$i),rs);dt.__reactInternalSnapshotBeforeUpdate=at}break;case 3:var _t=g.stateNode.containerInfo;_t.nodeType===1?_t.textContent="":_t.nodeType===9&&_t.documentElement&&_t.removeChild(_t.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(y(163))}}catch(pi){Fi(g,g.return,pi)}if(f=g.sibling,f!==null){f.return=g.return,Ri=f;break}Ri=g.return}return ji=Bp,Bp=!1,ji}function iu(f,g,E){var z=g.updateQueue;if(z=z!==null?z.lastEffect:null,z!==null){var $=z=z.next;do{if(($.tag&f)===f){var K=$.destroy;$.destroy=void 0,K!==void 0&&sf(g,E,K)}$=$.next}while($!==z)}}function Bo(f,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var E=g=g.next;do{if((E.tag&f)===f){var z=E.create;E.destroy=z()}E=E.next}while(E!==g)}}function nu(f){var g=f.ref;if(g!==null){var E=f.stateNode;switch(f.tag){case 5:f=E;break;default:f=E}typeof g=="function"?g(f):g.current=f}}function of(f){var g=f.alternate;g!==null&&(f.alternate=null,of(g)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(g=f.stateNode,g!==null&&(delete g[aa],delete g[zu],delete g[Ra],delete g[Ip],delete g[Pp])),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}function ih(f){return f.tag===5||f.tag===3||f.tag===4}function ru(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||ih(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function fa(f,g,E){var z=f.tag;if(z===5||z===6)f=f.stateNode,g?E.nodeType===8?E.parentNode.insertBefore(f,g):E.insertBefore(f,g):(E.nodeType===8?(g=E.parentNode,g.insertBefore(f,E)):(g=E,g.appendChild(f)),E=E._reactRootContainer,E!=null||g.onclick!==null||(g.onclick=cl));else if(z!==4&&(f=f.child,f!==null))for(fa(f,g,E),f=f.sibling;f!==null;)fa(f,g,E),f=f.sibling}function jo(f,g,E){var z=f.tag;if(z===5||z===6)f=f.stateNode,g?E.insertBefore(f,g):E.appendChild(f);else if(z!==4&&(f=f.child,f!==null))for(jo(f,g,E),f=f.sibling;f!==null;)jo(f,g,E),f=f.sibling}var Er=null,Zs=!1;function l(f,g,E){for(E=E.child;E!==null;)t(f,g,E),E=E.sibling}function t(f,g,E){if(Lr&&typeof Lr.onCommitFiberUnmount=="function")try{Lr.onCommitFiberUnmount(Nr,E)}catch{}switch(E.tag){case 5:zn||vl(E,g);case 6:var z=Er,$=Zs;Er=null,l(f,g,E),Er=z,Zs=$,Er!==null&&(Zs?(f=Er,E=E.stateNode,f.nodeType===8?f.parentNode.removeChild(E):f.removeChild(E)):Er.removeChild(E.stateNode));break;case 18:Er!==null&&(Zs?(f=Er,E=E.stateNode,f.nodeType===8?Lu(f.parentNode,E):f.nodeType===1&&Lu(f,E),Ec(f)):Lu(Er,E.stateNode));break;case 4:z=Er,$=Zs,Er=E.stateNode.containerInfo,Zs=!0,l(f,g,E),Er=z,Zs=$;break;case 0:case 11:case 14:case 15:if(!zn&&(z=E.updateQueue,z!==null&&(z=z.lastEffect,z!==null))){$=z=z.next;do{var K=$,_e=K.destroy;K=K.tag,_e!==void 0&&((K&2)!==0||(K&4)!==0)&&sf(E,g,_e),$=$.next}while($!==z)}l(f,g,E);break;case 1:if(!zn&&(vl(E,g),z=E.stateNode,typeof z.componentWillUnmount=="function"))try{z.props=E.memoizedProps,z.state=E.memoizedState,z.componentWillUnmount()}catch(Ve){Fi(E,g,Ve)}l(f,g,E);break;case 21:l(f,g,E);break;case 22:E.mode&1?(zn=(z=zn)||E.memoizedState!==null,l(f,g,E),zn=z):l(f,g,E);break;default:l(f,g,E)}}function s(f){var g=f.updateQueue;if(g!==null){f.updateQueue=null;var E=f.stateNode;E===null&&(E=f.stateNode=new $a),g.forEach(function(z){var $=vn.bind(null,f,z);E.has(z)||(E.add(z),z.then($,$))})}}function c(f,g){var E=g.deletions;if(E!==null)for(var z=0;z<E.length;z++){var $=E[z];try{var K=f,_e=g,Ve=_e;e:for(;Ve!==null;){switch(Ve.tag){case 5:Er=Ve.stateNode,Zs=!1;break e;case 3:Er=Ve.stateNode.containerInfo,Zs=!0;break e;case 4:Er=Ve.stateNode.containerInfo,Zs=!0;break e}Ve=Ve.return}if(Er===null)throw Error(y(160));t(K,_e,$),Er=null,Zs=!1;var Ye=$.alternate;Ye!==null&&(Ye.return=null),$.return=null}catch(bt){Fi($,g,bt)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)m(g,f),g=g.sibling}function m(f,g){var E=f.alternate,z=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:if(c(g,f),_(f),z&4){try{iu(3,f,f.return),Bo(3,f)}catch($i){Fi(f,f.return,$i)}try{iu(5,f,f.return)}catch($i){Fi(f,f.return,$i)}}break;case 1:c(g,f),_(f),z&512&&E!==null&&vl(E,E.return);break;case 5:if(c(g,f),_(f),z&512&&E!==null&&vl(E,E.return),f.flags&32){var $=f.stateNode;try{va($,"")}catch($i){Fi(f,f.return,$i)}}if(z&4&&($=f.stateNode,$!=null)){var K=f.memoizedProps,_e=E!==null?E.memoizedProps:K,Ve=f.type,Ye=f.updateQueue;if(f.updateQueue=null,Ye!==null)try{Ve==="input"&&K.type==="radio"&&K.name!=null&&ls($,K),Pl(Ve,_e);var bt=Pl(Ve,K);for(_e=0;_e<Ye.length;_e+=2){var li=Ye[_e],ci=Ye[_e+1];li==="style"?Qa($,ci):li==="dangerouslySetInnerHTML"?xa($,ci):li==="children"?va($,ci):pt($,li,ci,bt)}switch(Ve){case"input":ia($,K);break;case"textarea":ks($,K);break;case"select":var si=$._wrapperState.wasMultiple;$._wrapperState.wasMultiple=!!K.multiple;var ki=K.value;ki!=null?ko($,!!K.multiple,ki,!1):si!==!!K.multiple&&(K.defaultValue!=null?ko($,!!K.multiple,K.defaultValue,!0):ko($,!!K.multiple,K.multiple?[]:"",!1))}$[zu]=K}catch($i){Fi(f,f.return,$i)}}break;case 6:if(c(g,f),_(f),z&4){if(f.stateNode===null)throw Error(y(162));$=f.stateNode,K=f.memoizedProps;try{$.nodeValue=K}catch($i){Fi(f,f.return,$i)}}break;case 3:if(c(g,f),_(f),z&4&&E!==null&&E.memoizedState.isDehydrated)try{Ec(g.containerInfo)}catch($i){Fi(f,f.return,$i)}break;case 4:c(g,f),_(f);break;case 13:c(g,f),_(f),$=f.child,$.flags&8192&&(K=$.memoizedState!==null,$.stateNode.isHidden=K,!K||$.alternate!==null&&$.alternate.memoizedState!==null||(Ge=nn())),z&4&&s(f);break;case 22:if(li=E!==null&&E.memoizedState!==null,f.mode&1?(zn=(bt=zn)||li,c(g,f),zn=bt):c(g,f),_(f),z&8192){if(bt=f.memoizedState!==null,(f.stateNode.isHidden=bt)&&!li&&(f.mode&1)!==0)for(Ri=f,li=f.child;li!==null;){for(ci=Ri=li;Ri!==null;){switch(si=Ri,ki=si.child,si.tag){case 0:case 11:case 14:case 15:iu(4,si,si.return);break;case 1:vl(si,si.return);var ji=si.stateNode;if(typeof ji.componentWillUnmount=="function"){z=si,E=si.return;try{g=z,ji.props=g.memoizedProps,ji.state=g.memoizedState,ji.componentWillUnmount()}catch($i){Fi(z,E,$i)}}break;case 5:vl(si,si.return);break;case 22:if(si.memoizedState!==null){k(ci);continue}}ki!==null?(ki.return=si,Ri=ki):k(ci)}li=li.sibling}e:for(li=null,ci=f;;){if(ci.tag===5){if(li===null){li=ci;try{$=ci.stateNode,bt?(K=$.style,typeof K.setProperty=="function"?K.setProperty("display","none","important"):K.display="none"):(Ve=ci.stateNode,Ye=ci.memoizedProps.style,_e=Ye!=null&&Ye.hasOwnProperty("display")?Ye.display:null,Ve.style.display=Il("display",_e))}catch($i){Fi(f,f.return,$i)}}}else if(ci.tag===6){if(li===null)try{ci.stateNode.nodeValue=bt?"":ci.memoizedProps}catch($i){Fi(f,f.return,$i)}}else if((ci.tag!==22&&ci.tag!==23||ci.memoizedState===null||ci===f)&&ci.child!==null){ci.child.return=ci,ci=ci.child;continue}if(ci===f)break e;for(;ci.sibling===null;){if(ci.return===null||ci.return===f)break e;li===ci&&(li=null),ci=ci.return}li===ci&&(li=null),ci.sibling.return=ci.return,ci=ci.sibling}}break;case 19:c(g,f),_(f),z&4&&s(f);break;case 21:break;default:c(g,f),_(f)}}function _(f){var g=f.flags;if(g&2){try{e:{for(var E=f.return;E!==null;){if(ih(E)){var z=E;break e}E=E.return}throw Error(y(160))}switch(z.tag){case 5:var $=z.stateNode;z.flags&32&&(va($,""),z.flags&=-33);var K=ru(f);jo(f,K,$);break;case 3:case 4:var _e=z.stateNode.containerInfo,Ve=ru(f);fa(f,Ve,_e);break;default:throw Error(y(161))}}catch(Ye){Fi(f,f.return,Ye)}f.flags&=-3}g&4096&&(f.flags&=-4097)}function v(f,g,E){Ri=f,S(f)}function S(f,g,E){for(var z=(f.mode&1)!==0;Ri!==null;){var $=Ri,K=$.child;if($.tag===22&&z){var _e=$.memoizedState!==null||tu;if(!_e){var Ve=$.alternate,Ye=Ve!==null&&Ve.memoizedState!==null||zn;Ve=tu;var bt=zn;if(tu=_e,(zn=Ye)&&!bt)for(Ri=$;Ri!==null;)_e=Ri,Ye=_e.child,_e.tag===22&&_e.memoizedState!==null?L($):Ye!==null?(Ye.return=_e,Ri=Ye):L($);for(;K!==null;)Ri=K,S(K),K=K.sibling;Ri=$,tu=Ve,zn=bt}A(f)}else($.subtreeFlags&8772)!==0&&K!==null?(K.return=$,Ri=K):A(f)}}function A(f){for(;Ri!==null;){var g=Ri;if((g.flags&8772)!==0){var E=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:zn||Bo(5,g);break;case 1:var z=g.stateNode;if(g.flags&4&&!zn)if(E===null)z.componentDidMount();else{var $=g.elementType===g.type?E.memoizedProps:Ws(g.type,E.memoizedProps);z.componentDidUpdate($,E.memoizedState,z.__reactInternalSnapshotBeforeUpdate)}var K=g.updateQueue;K!==null&&kp(g,K,z);break;case 3:var _e=g.updateQueue;if(_e!==null){if(E=null,g.child!==null)switch(g.child.tag){case 5:E=g.child.stateNode;break;case 1:E=g.child.stateNode}kp(g,_e,E)}break;case 5:var Ve=g.stateNode;if(E===null&&g.flags&4){E=Ve;var Ye=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Ye.autoFocus&&E.focus();break;case"img":Ye.src&&(E.src=Ye.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var bt=g.alternate;if(bt!==null){var li=bt.memoizedState;if(li!==null){var ci=li.dehydrated;ci!==null&&Ec(ci)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(y(163))}zn||g.flags&512&&nu(g)}catch(si){Fi(g,g.return,si)}}if(g===f){Ri=null;break}if(E=g.sibling,E!==null){E.return=g.return,Ri=E;break}Ri=g.return}}function k(f){for(;Ri!==null;){var g=Ri;if(g===f){Ri=null;break}var E=g.sibling;if(E!==null){E.return=g.return,Ri=E;break}Ri=g.return}}function L(f){for(;Ri!==null;){var g=Ri;try{switch(g.tag){case 0:case 11:case 15:var E=g.return;try{Bo(4,g)}catch(Ye){Fi(g,E,Ye)}break;case 1:var z=g.stateNode;if(typeof z.componentDidMount=="function"){var $=g.return;try{z.componentDidMount()}catch(Ye){Fi(g,$,Ye)}}var K=g.return;try{nu(g)}catch(Ye){Fi(g,K,Ye)}break;case 5:var _e=g.return;try{nu(g)}catch(Ye){Fi(g,_e,Ye)}}}catch(Ye){Fi(g,g.return,Ye)}if(g===f){Ri=null;break}var Ve=g.sibling;if(Ve!==null){Ve.return=g.return,Ri=Ve;break}Ri=g.return}}var B=Math.ceil,O=Tt.ReactCurrentDispatcher,j=Tt.ReactCurrentOwner,X=Tt.ReactCurrentBatchConfig,W=0,Y=null,J=null,ie=0,ue=0,pe=ka(0),be=0,Te=null,xe=0,me=0,Ee=0,Ae=null,Oe=null,Ge=0,nt=1/0,it=null,ht=!1,Be=null,Xe=null,ke=!1,st=null,We=0,ut=0,Et=null,ot=-1,yt=0;function jt(){return(W&6)!==0?nn():ot!==-1?ot:ot=nn()}function Wt(f){return(f.mode&1)===0?1:(W&2)!==0&&ie!==0?ie&-ie:Rm.transition!==null?(yt===0&&(yt=Ho()),yt):(f=Xn,f!==0||(f=window.event,f=f===void 0?16:Vl(f.type)),f)}function Ot(f,g,E,z){if(50<ut)throw ut=0,Et=null,Error(y(185));Us(f,E,z),((W&2)===0||f!==Y)&&(f===Y&&((W&2)===0&&(me|=E),be===4&&cn(f,ie)),Zt(f,z),E===1&&W===0&&(g.mode&1)===0&&(nt=nn()+500,Nu&&bo()))}function Zt(f,g){var E=f.callbackNode;dh(f,g);var z=vc(f,f===Y?ie:0);if(z===0)E!==null&&Hi(E),f.callbackNode=null,f.callbackPriority=0;else if(g=z&-z,f.callbackPriority!==g){if(E!=null&&Hi(E),g===1)f.tag===0?Mp(Un.bind(null,f)):Ff(Un.bind(null,f)),Du(function(){(W&6)===0&&bo()}),E=null;else{switch(gu(z)){case 1:E=Tn;break;case 4:E=xn;break;case 16:E=fr;break;case 536870912:E=lr;break;default:E=fr}E=Xs(E,ai.bind(null,f))}f.callbackPriority=g,f.callbackNode=E}}function ai(f,g){if(ot=-1,yt=0,(W&6)!==0)throw Error(y(327));var E=f.callbackNode;if(Mn()&&f.callbackNode!==E)return null;var z=vc(f,f===Y?ie:0);if(z===0)return null;if((z&30)!==0||(z&f.expiredLanes)!==0||g)g=Cr(f,z);else{g=z;var $=W;W|=2;var K=Yi();(Y!==f||ie!==g)&&(it=null,nt=nn()+500,Ii(f,g));do try{wn();break}catch(Ve){Bi(f,Ve)}while(!0);ic(),O.current=K,W=$,J!==null?g=0:(Y=null,ie=0,g=be)}if(g!==0){if(g===2&&($=mu(f),$!==0&&(z=$,g=ui(f,$))),g===1)throw E=Te,Ii(f,0),cn(f,z),Zt(f,nn()),E;if(g===6)cn(f,z);else{if($=f.current.alternate,(z&30)===0&&!Ni($)&&(g=Cr(f,z),g===2&&(K=mu(f),K!==0&&(z=K,g=ui(f,K))),g===1))throw E=Te,Ii(f,0),cn(f,z),Zt(f,nn()),E;switch(f.finishedWork=$,f.finishedLanes=z,g){case 0:case 1:throw Error(y(345));case 2:mr(f,Oe,it);break;case 3:if(cn(f,z),(z&130023424)===z&&(g=Ge+500-nn(),10<g)){if(vc(f,0)!==0)break;if($=f.suspendedLanes,($&z)!==z){jt(),f.pingedLanes|=f.suspendedLanes&$;break}f.timeoutHandle=Rd(mr.bind(null,f,Oe,it),g);break}mr(f,Oe,it);break;case 4:if(cn(f,z),(z&4194240)===z)break;for(g=f.eventTimes,$=-1;0<z;){var _e=31-to(z);K=1<<_e,_e=g[_e],_e>$&&($=_e),z&=~K}if(z=$,z=nn()-z,z=(120>z?120:480>z?480:1080>z?1080:1920>z?1920:3e3>z?3e3:4320>z?4320:1960*B(z/1960))-z,10<z){f.timeoutHandle=Rd(mr.bind(null,f,Oe,it),z);break}mr(f,Oe,it);break;case 5:mr(f,Oe,it);break;default:throw Error(y(329))}}}return Zt(f,nn()),f.callbackNode===E?ai.bind(null,f):null}function ui(f,g){var E=Ae;return f.current.memoizedState.isDehydrated&&(Ii(f,g).flags|=256),f=Cr(f,g),f!==2&&(g=Oe,Oe=E,g!==null&&wi(g)),f}function wi(f){Oe===null?Oe=f:Oe.push.apply(Oe,f)}function Ni(f){for(var g=f;;){if(g.flags&16384){var E=g.updateQueue;if(E!==null&&(E=E.stores,E!==null))for(var z=0;z<E.length;z++){var $=E[z],K=$.getSnapshot;$=$.value;try{if(!Yo(K(),$))return!1}catch{return!1}}}if(E=g.child,g.subtreeFlags&16384&&E!==null)E.return=g,g=E;else{if(g===f)break;for(;g.sibling===null;){if(g.return===null||g.return===f)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function cn(f,g){for(g&=~Ee,g&=~me,f.suspendedLanes|=g,f.pingedLanes&=~g,f=f.expirationTimes;0<g;){var E=31-to(g),z=1<<E;f[E]=-1,g&=~z}}function Un(f){if((W&6)!==0)throw Error(y(327));Mn();var g=vc(f,0);if((g&1)===0)return Zt(f,nn()),null;var E=Cr(f,g);if(f.tag!==0&&E===2){var z=mu(f);z!==0&&(g=z,E=ui(f,z))}if(E===1)throw E=Te,Ii(f,0),cn(f,g),Zt(f,nn()),E;if(E===6)throw Error(y(345));return f.finishedWork=f.current.alternate,f.finishedLanes=g,mr(f,Oe,it),Zt(f,nn()),null}function En(f,g){var E=W;W|=1;try{return f(g)}finally{W=E,W===0&&(nt=nn()+500,Nu&&bo())}}function yn(f){st!==null&&st.tag===0&&(W&6)===0&&Mn();var g=W;W|=1;var E=X.transition,z=Xn;try{if(X.transition=null,Xn=1,f)return f()}finally{Xn=z,X.transition=E,W=g,(W&6)===0&&bo()}}function _r(){ue=pe.current,Pr(pe)}function Ii(f,g){f.finishedWork=null,f.finishedLanes=0;var E=f.timeoutHandle;if(E!==-1&&(f.timeoutHandle=-1,Lf(E)),J!==null)for(E=J.return;E!==null;){var z=E;switch(Nd(z),z.tag){case 1:z=z.type.childContextTypes,z!=null&&jc();break;case 3:So(),Pr(ro),Pr(Vr),ca();break;case 5:Hu(z);break;case 4:So();break;case 13:Pr(Rr);break;case 19:Pr(Rr);break;case 10:Gu(z.type._context);break;case 22:case 23:_r()}E=E.return}if(Y=f,J=f=ho(f.current,null),ie=ue=g,be=0,Te=null,Ee=me=xe=0,Oe=Ae=null,oo!==null){for(g=0;g<oo.length;g++)if(E=oo[g],z=E.interleaved,z!==null){E.interleaved=null;var $=z.next,K=E.pending;if(K!==null){var _e=K.next;K.next=$,z.next=_e}E.pending=z}oo=null}return f}function Bi(f,g){do{var E=J;try{if(ic(),Pn.current=da,Ud){for(var z=Fr.memoizedState;z!==null;){var $=z.queue;$!==null&&($.pending=null),z=z.next}Ud=!1}if(Eo=0,ms=ts=Fr=null,Ba=!1,ua=0,j.current=null,E===null||E.return===null){be=1,Te=g,J=null;break}e:{var K=f,_e=E.return,Ve=E,Ye=g;if(g=ie,Ve.flags|=32768,Ye!==null&&typeof Ye=="object"&&typeof Ye.then=="function"){var bt=Ye,li=Ve,ci=li.tag;if((li.mode&1)===0&&(ci===0||ci===11||ci===15)){var si=li.alternate;si?(li.updateQueue=si.updateQueue,li.memoizedState=si.memoizedState,li.lanes=si.lanes):(li.updateQueue=null,li.memoizedState=null)}var ki=Qd(_e);if(ki!==null){ki.flags&=-257,qh(ki,_e,Ve,K,g),ki.mode&1&&Ku(K,bt,g),g=ki,Ye=bt;var ji=g.updateQueue;if(ji===null){var $i=new Set;$i.add(Ye),g.updateQueue=$i}else ji.add(Ye);break e}else{if((g&1)===0){Ku(K,bt,g),Gn();break e}Ye=Error(y(426))}}else if(Dr&&Ve.mode&1){var rs=Qd(_e);if(rs!==null){(rs.flags&65536)===0&&(rs.flags|=256),qh(rs,_e,Ve,K,g),To(Ga(Ye,Ve));break e}}K=Ye=Ga(Ye,Ve),be!==4&&(be=2),Ae===null?Ae=[K]:Ae.push(K),K=_e;do{switch(K.tag){case 3:K.flags|=65536,g&=-g,K.lanes|=g;var dt=Jd(K,Ye,g);jd(K,dt);break e;case 1:Ve=Ye;var at=K.type,_t=K.stateNode;if((K.flags&128)===0&&(typeof at.getDerivedStateFromError=="function"||_t!==null&&typeof _t.componentDidCatch=="function"&&(Xe===null||!Xe.has(_t)))){K.flags|=65536,g&=-g,K.lanes|=g;var pi=yl(K,Ve,g);jd(K,pi);break e}}K=K.return}while(K!==null)}an(E)}catch(Qi){g=Qi,J===E&&E!==null&&(J=E=E.return);continue}break}while(!0)}function Yi(){var f=O.current;return O.current=da,f===null?da:f}function Gn(){(be===0||be===3||be===2)&&(be=4),Y===null||(xe&268435455)===0&&(me&268435455)===0||cn(Y,ie)}function Cr(f,g){var E=W;W|=2;var z=Yi();(Y!==f||ie!==g)&&(it=null,Ii(f,g));do try{Hn();break}catch($){Bi(f,$)}while(!0);if(ic(),W=E,O.current=z,J!==null)throw Error(y(261));return Y=null,ie=0,be}function Hn(){for(;J!==null;)pr(J)}function wn(){for(;J!==null&&!zi();)pr(J)}function pr(f){var g=co(f.alternate,f,ue);f.memoizedProps=f.pendingProps,g===null?an(f):J=g,j.current=null}function an(f){var g=f;do{var E=g.alternate;if(f=g.return,(g.flags&32768)===0){if(E=Qh(E,g,ue),E!==null){J=E;return}}else{if(E=xl(E,g),E!==null){E.flags&=32767,J=E;return}if(f!==null)f.flags|=32768,f.subtreeFlags=0,f.deletions=null;else{be=6,J=null;return}}if(g=g.sibling,g!==null){J=g;return}J=g=f}while(g!==null);be===0&&(be=5)}function mr(f,g,E){var z=Xn,$=X.transition;try{X.transition=null,Xn=1,Kn(f,g,E,z)}finally{X.transition=$,Xn=z}return null}function Kn(f,g,E,z){do Mn();while(st!==null);if((W&6)!==0)throw Error(y(327));E=f.finishedWork;var $=f.finishedLanes;if(E===null)return null;if(f.finishedWork=null,f.finishedLanes=0,E===f.current)throw Error(y(177));f.callbackNode=null,f.callbackPriority=0;var K=E.lanes|E.childLanes;if(el(f,K),f===Y&&(J=Y=null,ie=0),(E.subtreeFlags&2064)===0&&(E.flags&2064)===0||ke||(ke=!0,Xs(fr,function(){return Mn(),null})),K=(E.flags&15990)!==0,(E.subtreeFlags&15990)!==0||K){K=X.transition,X.transition=null;var _e=Xn;Xn=1;var Ve=W;W|=4,j.current=null,th(f,E),m(E,f),zs(ku),gh=!!Ru,ku=Ru=null,f.current=E,v(E),Bn(),W=Ve,Xn=_e,X.transition=K}else f.current=E;if(ke&&(ke=!1,st=f,We=$),K=f.pendingLanes,K===0&&(Xe=null),Ds(E.stateNode),Zt(f,nn()),g!==null)for(z=f.onRecoverableError,E=0;E<g.length;E++)$=g[E],z($.value,{componentStack:$.stack,digest:$.digest});if(ht)throw ht=!1,f=Be,Be=null,f;return(We&1)!==0&&f.tag!==0&&Mn(),K=f.pendingLanes,(K&1)!==0?f===Et?ut++:(ut=0,Et=f):ut=0,bo(),null}function Mn(){if(st!==null){var f=gu(We),g=X.transition,E=Xn;try{if(X.transition=null,Xn=16>f?16:f,st===null)var z=!1;else{if(f=st,st=null,We=0,(W&6)!==0)throw Error(y(331));var $=W;for(W|=4,Ri=f.current;Ri!==null;){var K=Ri,_e=K.child;if((Ri.flags&16)!==0){var Ve=K.deletions;if(Ve!==null){for(var Ye=0;Ye<Ve.length;Ye++){var bt=Ve[Ye];for(Ri=bt;Ri!==null;){var li=Ri;switch(li.tag){case 0:case 11:case 15:iu(8,li,K)}var ci=li.child;if(ci!==null)ci.return=li,Ri=ci;else for(;Ri!==null;){li=Ri;var si=li.sibling,ki=li.return;if(of(li),li===bt){Ri=null;break}if(si!==null){si.return=ki,Ri=si;break}Ri=ki}}}var ji=K.alternate;if(ji!==null){var $i=ji.child;if($i!==null){ji.child=null;do{var rs=$i.sibling;$i.sibling=null,$i=rs}while($i!==null)}}Ri=K}}if((K.subtreeFlags&2064)!==0&&_e!==null)_e.return=K,Ri=_e;else e:for(;Ri!==null;){if(K=Ri,(K.flags&2048)!==0)switch(K.tag){case 0:case 11:case 15:iu(9,K,K.return)}var dt=K.sibling;if(dt!==null){dt.return=K.return,Ri=dt;break e}Ri=K.return}}var at=f.current;for(Ri=at;Ri!==null;){_e=Ri;var _t=_e.child;if((_e.subtreeFlags&2064)!==0&&_t!==null)_t.return=_e,Ri=_t;else e:for(_e=at;Ri!==null;){if(Ve=Ri,(Ve.flags&2048)!==0)try{switch(Ve.tag){case 0:case 11:case 15:Bo(9,Ve)}}catch(Qi){Fi(Ve,Ve.return,Qi)}if(Ve===_e){Ri=null;break e}var pi=Ve.sibling;if(pi!==null){pi.return=Ve.return,Ri=pi;break e}Ri=Ve.return}}if(W=$,bo(),Lr&&typeof Lr.onPostCommitFiberRoot=="function")try{Lr.onPostCommitFiberRoot(Nr,f)}catch{}z=!0}return z}finally{Xn=E,X.transition=g}}return!1}function Wn(f,g,E){g=Ga(E,g),g=Jd(f,g,1),f=rc(f,g,1),g=jt(),f!==null&&(Us(f,1,g),Zt(f,g))}function Fi(f,g,E){if(f.tag===3)Wn(f,f,E);else for(;g!==null;){if(g.tag===3){Wn(g,f,E);break}else if(g.tag===1){var z=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof z.componentDidCatch=="function"&&(Xe===null||!Xe.has(z))){f=Ga(E,f),f=yl(g,f,1),g=rc(g,f,1),f=jt(),g!==null&&(Us(g,1,f),Zt(g,f));break}}g=g.return}}function vr(f,g,E){var z=f.pingCache;z!==null&&z.delete(g),g=jt(),f.pingedLanes|=f.suspendedLanes&E,Y===f&&(ie&E)===E&&(be===4||be===3&&(ie&130023424)===ie&&500>nn()-Ge?Ii(f,0):Ee|=E),Zt(f,g)}function ns(f,g){g===0&&((f.mode&1)===0?g=1:(g=zl,zl<<=1,(zl&130023424)===0&&(zl=4194304)));var E=jt();f=Fa(f,g),f!==null&&(Us(f,g,E),Zt(f,E))}function ir(f){var g=f.memoizedState,E=0;g!==null&&(E=g.retryLane),ns(f,E)}function vn(f,g){var E=0;switch(f.tag){case 13:var z=f.stateNode,$=f.memoizedState;$!==null&&(E=$.retryLane);break;case 19:z=f.stateNode;break;default:throw Error(y(314))}z!==null&&z.delete(g),ns(f,E)}var co;co=function(f,g,E){if(f!==null)if(f.memoizedProps!==g.pendingProps||ro.current)qs=!0;else{if((f.lanes&E)===0&&(g.flags&128)===0)return qs=!1,Np(f,g,E);qs=(f.flags&131072)!==0}else qs=!1,Dr&&(g.flags&1048576)!==0&&Od(g,Fd,g.index);switch(g.lanes=0,g.tag){case 2:var z=g.type;Qc(f,g),f=g.pendingProps;var $=ul(g,Vr.current);nc(g,E),$=ur(null,g,z,f,$,E);var K=je();return g.flags|=1,typeof $=="object"&&$!==null&&typeof $.render=="function"&&$.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Ss(z)?(K=!0,Vc(g)):K=!1,g.memoizedState=$.state!==null&&$.state!==void 0?$.state:null,Oa(g),$.updater=gl,g.stateNode=$,$._reactInternals=g,Wh(g,z,f,E),g=tf(null,g,z,!0,K,E)):(g.tag=0,Dr&&K&&Dh(g),gs(null,g,$,E),g=g.child),g;case 16:z=g.elementType;e:{switch(Qc(f,g),f=g.pendingProps,$=z._init,z=$(z._payload),g.type=z,$=g.tag=uo(z),f=Ws(z,f),$){case 0:g=Qu(null,g,z,f,E);break e;case 1:g=$f(null,g,z,f,E);break e;case 11:g=Jc(null,g,z,f,E);break e;case 14:g=Ju(null,g,z,Ws(z.type,f),E);break e}throw Error(y(306,z,""))}return g;case 0:return z=g.type,$=g.pendingProps,$=g.elementType===z?$:Ws(z,$),Qu(f,g,z,$,E);case 1:return z=g.type,$=g.pendingProps,$=g.elementType===z?$:Ws(z,$),$f(f,g,z,$,E);case 3:e:{if(Hf(g),f===null)throw Error(y(387));z=g.pendingProps,K=g.memoizedState,$=K.element,fi(f,g),Bh(g,z,null,E);var _e=g.memoizedState;if(z=_e.element,K.isDehydrated)if(K={element:z,isDehydrated:!1,cache:_e.cache,pendingSuspenseBoundaries:_e.pendingSuspenseBoundaries,transitions:_e.transitions},g.updateQueue.baseState=K,g.memoizedState=K,g.flags&256){$=Ga(Error(y(423)),g),g=Wf(f,g,z,E,$);break e}else if(z!==$){$=Ga(Error(y(424)),g),g=Wf(f,g,z,E,$);break e}else for(ps=Ia(g.stateNode.containerInfo.firstChild),Qr=g,Dr=!0,Es=null,E=za(g,null,z,E),g.child=E;E;)E.flags=E.flags&-3|4096,E=E.sibling;else{if($c(),z===$){g=Vn(f,g,E);break e}gs(f,g,z,E)}g=g.child}return g;case 5:return sc(g),f===null&&Fh(g),z=g.type,$=g.pendingProps,K=f!==null?f.memoizedProps:null,_e=$.children,Yl(z,$)?_e=null:K!==null&&Yl(z,K)&&(g.flags|=32),Gf(f,g),gs(f,g,_e,E),g.child;case 6:return f===null&&Fh(g),null;case 13:return qf(f,g,E);case 4:return As(g,g.stateNode.containerInfo),z=g.pendingProps,f===null?g.child=hl(g,null,z,E):gs(f,g,z,E),g.child;case 11:return z=g.type,$=g.pendingProps,$=g.elementType===z?$:Ws(z,$),Jc(f,g,z,$,E);case 7:return gs(f,g,g.pendingProps,E),g.child;case 8:return gs(f,g,g.pendingProps.children,E),g.child;case 12:return gs(f,g,g.pendingProps.children,E),g.child;case 10:e:{if(z=g.type._context,$=g.pendingProps,K=g.memoizedProps,_e=$.value,Mr(Ql,z._currentValue),z._currentValue=_e,K!==null)if(Yo(K.value,_e)){if(K.children===$.children&&!ro.current){g=Vn(f,g,E);break e}}else for(K=g.child,K!==null&&(K.return=g);K!==null;){var Ve=K.dependencies;if(Ve!==null){_e=K.child;for(var Ye=Ve.firstContext;Ye!==null;){if(Ye.context===z){if(K.tag===1){Ye=No(-1,E&-E),Ye.tag=2;var bt=K.updateQueue;if(bt!==null){bt=bt.shared;var li=bt.pending;li===null?Ye.next=Ye:(Ye.next=li.next,li.next=Ye),bt.pending=Ye}}K.lanes|=E,Ye=K.alternate,Ye!==null&&(Ye.lanes|=E),Nh(K.return,E,g),Ve.lanes|=E;break}Ye=Ye.next}}else if(K.tag===10)_e=K.type===g.type?null:K.child;else if(K.tag===18){if(_e=K.return,_e===null)throw Error(y(341));_e.lanes|=E,Ve=_e.alternate,Ve!==null&&(Ve.lanes|=E),Nh(_e,E,g),_e=K.sibling}else _e=K.child;if(_e!==null)_e.return=K;else for(_e=K;_e!==null;){if(_e===g){_e=null;break}if(K=_e.sibling,K!==null){K.return=_e.return,_e=K;break}_e=_e.return}K=_e}gs(f,g,$.children,E),g=g.child}return g;case 9:return $=g.type,z=g.pendingProps.children,nc(g,E),$=es($),z=z($),g.flags|=1,gs(f,g,z,E),g.child;case 14:return z=g.type,$=Ws(z,g.pendingProps),$=Ws(z.type,$),Ju(f,g,z,$,E);case 15:return ef(f,g,g.type,g.pendingProps,E);case 17:return z=g.type,$=g.pendingProps,$=g.elementType===z?$:Ws(z,$),Qc(f,g),g.tag=1,Ss(z)?(f=!0,Vc(g)):f=!1,nc(g,E),Kd(g,z,$),Wh(g,z,$,E),tf(null,g,z,!0,f,E);case 19:return Op(f,g,E);case 22:return Zh(f,g,E)}throw Error(y(156,g.tag))};function Xs(f,g){return Pi(f,g)}function Vo(f,g,E,z){this.tag=f,this.key=E,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=z,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ur(f,g,E,z){return new Vo(f,g,E,z)}function Co(f){return f=f.prototype,!(!f||!f.isReactComponent)}function uo(f){if(typeof f=="function")return Co(f)?1:0;if(f!=null){if(f=f.$$typeof,f===Nt)return 11;if(f===Ci)return 14}return 2}function ho(f,g){var E=f.alternate;return E===null?(E=Ur(f.tag,g,f.key,f.mode),E.elementType=f.elementType,E.type=f.type,E.stateNode=f.stateNode,E.alternate=f,f.alternate=E):(E.pendingProps=g,E.type=f.type,E.flags=0,E.subtreeFlags=0,E.deletions=null),E.flags=f.flags&14680064,E.childLanes=f.childLanes,E.lanes=f.lanes,E.child=f.child,E.memoizedProps=f.memoizedProps,E.memoizedState=f.memoizedState,E.updateQueue=f.updateQueue,g=f.dependencies,E.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},E.sibling=f.sibling,E.index=f.index,E.ref=f.ref,E}function Ao(f,g,E,z,$,K){var _e=2;if(z=f,typeof f=="function")Co(f)&&(_e=1);else if(typeof f=="string")_e=5;else e:switch(f){case Bt:return Io(E.children,$,K,g);case Yt:_e=8,$|=8;break;case vt:return f=Ur(12,E,g,$|2),f.elementType=vt,f.lanes=K,f;case Li:return f=Ur(13,E,g,$),f.elementType=Li,f.lanes=K,f;case Dt:return f=Ur(19,E,g,$),f.elementType=Dt,f.lanes=K,f;case xi:return lc(E,$,K,g);default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case Jt:_e=10;break e;case Ht:_e=9;break e;case Nt:_e=11;break e;case Ci:_e=14;break e;case yi:_e=16,z=null;break e}throw Error(y(130,f==null?f:typeof f,""))}return g=Ur(_e,E,g,$),g.elementType=f,g.type=z,g.lanes=K,g}function Io(f,g,E,z){return f=Ur(7,f,z,g),f.lanes=E,f}function lc(f,g,E,z){return f=Ur(22,f,z,g),f.elementType=xi,f.lanes=E,f.stateNode={isHidden:!1},f}function ed(f,g,E){return f=Ur(6,f,null,g),f.lanes=E,f}function cc(f,g,E){return g=Ur(4,f.children!==null?f.children:[],f.key,g),g.lanes=E,g.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},g}function Kf(f,g,E,z,$){this.tag=g,this.containerInfo=f,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=io(0),this.expirationTimes=io(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=io(0),this.identifierPrefix=z,this.onRecoverableError=$,this.mutableSourceEagerHydrationData=null}function su(f,g,E,z,$,K,_e,Ve,Ye){return f=new Kf(f,g,E,Ve,Ye),g===1?(g=1,K===!0&&(g|=8)):g=0,K=Ur(3,null,null,g),f.current=K,K.stateNode=f,K.memoizedState={element:z,isDehydrated:E,cache:null,transitions:null,pendingSuspenseBoundaries:null},Oa(K),f}function af(f,g,E){var z=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:di,key:z==null?null:""+z,children:f,containerInfo:g,implementation:E}}function td(f){if(!f)return vo;f=f._reactInternals;e:{if(Ze(f)!==f||f.tag!==1)throw Error(y(170));var g=f;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Ss(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(y(171))}if(f.tag===1){var E=f.type;if(Ss(E))return Ld(f,E,g)}return g}function pa(f,g,E,z,$,K,_e,Ve,Ye){return f=su(E,z,!0,f,$,K,_e,Ve,Ye),f.context=td(null),E=f.current,z=jt(),$=Wt(E),K=No(z,$),K.callback=g??null,rc(E,K,$),f.current.lanes=$,Us(f,$,z),Zt(f,z),f}function wl(f,g,E,z){var $=g.current,K=jt(),_e=Wt($);return E=td(E),g.context===null?g.context=E:g.pendingContext=E,g=No(K,_e),g.payload={element:f},z=z===void 0?null:z,z!==null&&(g.callback=z),f=rc($,g,_e),f!==null&&(Ot(f,$,_e,K),Bd(f,$,_e)),_e}function Ha(f){if(f=f.current,!f.child)return null;switch(f.child.tag){case 5:return f.child.stateNode;default:return f.child.stateNode}}function bl(f,g){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var E=f.retryLane;f.retryLane=E!==0&&E<g?E:g}}function Jf(f,g){bl(f,g),(f=f.alternate)&&bl(f,g)}function lf(){return null}var Qf=typeof reportError=="function"?reportError:function(f){console.error(f)};function jp(f){this._internalRoot=f}ep.prototype.render=jp.prototype.render=function(f){var g=this._internalRoot;if(g===null)throw Error(y(409));wl(f,g,null,null)},ep.prototype.unmount=jp.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var g=f.containerInfo;yn(function(){wl(null,f,null,null)}),g[Ma]=null}};function ep(f){this._internalRoot=f}ep.prototype.unstable_scheduleHydration=function(f){if(f){var g=Tc();f={blockedOn:null,target:f,priority:g};for(var E=0;E<qo.length&&g!==0&&g<qo[E].priority;E++);qo.splice(E,0,f),E===0&&Ep(f)}};function Vp(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function tp(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11&&(f.nodeType!==8||f.nodeValue!==" react-mount-point-unstable "))}function km(){}function id(f,g,E,z,$){if($){if(typeof z=="function"){var K=z;z=function(){var bt=Ha(_e);K.call(bt)}}var _e=pa(g,z,f,0,null,!1,!1,"",km);return f._reactRootContainer=_e,f[Ma]=_e.current,Ph(f.nodeType===8?f.parentNode:f),yn(),_e}for(;$=f.lastChild;)f.removeChild($);if(typeof z=="function"){var Ve=z;z=function(){var bt=Ha(Ye);Ve.call(bt)}}var Ye=su(f,0,!1,null,null,!1,!1,"",km);return f._reactRootContainer=Ye,f[Ma]=Ye.current,Ph(f.nodeType===8?f.parentNode:f),yn(function(){wl(g,Ye,E,z)}),Ye}function ip(f,g,E,z,$){var K=E._reactRootContainer;if(K){var _e=K;if(typeof $=="function"){var Ve=$;$=function(){var Ye=Ha(_e);Ve.call(Ye)}}wl(g,_e,f,$)}else _e=id(E,g,f,$,z);return Ha(_e)}na=function(f){switch(f.tag){case 3:var g=f.stateNode;if(g.current.memoizedState.isDehydrated){var E=Fl(g.pendingLanes);E!==0&&(Do(g,E|1),Zt(g,nn()),(W&6)===0&&(nt=nn()+500,bo()))}break;case 13:yn(function(){var z=Fa(f,1);if(z!==null){var $=jt();Ot(z,f,1,$)}}),Jf(f,1)}},bc=function(f){if(f.tag===13){var g=Fa(f,134217728);if(g!==null){var E=jt();Ot(g,f,134217728,E)}Jf(f,134217728)}},Ol=function(f){if(f.tag===13){var g=Wt(f),E=Fa(f,g);if(E!==null){var z=jt();Ot(E,f,g,z)}Jf(f,g)}},Tc=function(){return Xn},_d=function(f,g){var E=Xn;try{return Xn=f,g()}finally{Xn=E}},Ml=function(f,g,E){switch(g){case"input":if(ia(f,E),g=E.name,E.type==="radio"&&g!=null){for(E=f;E.parentNode;)E=E.parentNode;for(E=E.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<E.length;g++){var z=E[g];if(z!==f&&z.form===f.form){var $=Bc(z);if(!$)throw Error(y(90));Rs(z),ia(z,$)}}}break;case"textarea":ks(f,E);break;case"select":g=E.value,g!=null&&ko(f,!!E.multiple,g,!1)}},Ta=En,md=yn;var Ys={usingClientEntryPoint:!1,Events:[kh,Kl,Bc,kl,Rt,En]},uc={findFiberByHostInstance:Nc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Vy={bundleType:uc.bundleType,version:uc.version,rendererPackageName:uc.rendererPackageName,rendererConfig:uc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Tt.ReactCurrentDispatcher,findHostInstanceByFiber:function(f){return f=Si(f),f===null?null:f.stateNode},findFiberByHostInstance:uc.findFiberByHostInstance||lf,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Up=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Up.isDisabled&&Up.supportsFiber)try{Nr=Up.inject(Vy),Lr=Up}catch{}}return qa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ys,qa.createPortal=function(f,g){var E=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Vp(g))throw Error(y(200));return af(f,g,null,E)},qa.createRoot=function(f,g){if(!Vp(f))throw Error(y(299));var E=!1,z="",$=Qf;return g!=null&&(g.unstable_strictMode===!0&&(E=!0),g.identifierPrefix!==void 0&&(z=g.identifierPrefix),g.onRecoverableError!==void 0&&($=g.onRecoverableError)),g=su(f,1,!1,null,null,E,!1,z,$),f[Ma]=g.current,Ph(f.nodeType===8?f.parentNode:f),new jp(g)},qa.findDOMNode=function(f){if(f==null)return null;if(f.nodeType===1)return f;var g=f._reactInternals;if(g===void 0)throw typeof f.render=="function"?Error(y(188)):(f=Object.keys(f).join(","),Error(y(268,f)));return f=Si(g),f=f===null?null:f.stateNode,f},qa.flushSync=function(f){return yn(f)},qa.hydrate=function(f,g,E){if(!tp(g))throw Error(y(200));return ip(null,f,g,!0,E)},qa.hydrateRoot=function(f,g,E){if(!Vp(f))throw Error(y(405));var z=E!=null&&E.hydratedSources||null,$=!1,K="",_e=Qf;if(E!=null&&(E.unstable_strictMode===!0&&($=!0),E.identifierPrefix!==void 0&&(K=E.identifierPrefix),E.onRecoverableError!==void 0&&(_e=E.onRecoverableError)),g=pa(g,null,f,1,E??null,$,!1,K,_e),f[Ma]=g.current,Ph(f),z)for(f=0;f<z.length;f++)E=z[f],$=E._getVersion,$=$(E._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[E,$]:g.mutableSourceEagerHydrationData.push(E,$);return new ep(g)},qa.render=function(f,g,E){if(!tp(g))throw Error(y(200));return ip(null,f,g,!1,E)},qa.unmountComponentAtNode=function(f){if(!tp(f))throw Error(y(40));return f._reactRootContainer?(yn(function(){ip(null,null,f,!1,function(){f._reactRootContainer=null,f[Ma]=null})}),!0):!1},qa.unstable_batchedUpdates=En,qa.unstable_renderSubtreeIntoContainer=function(f,g,E,z){if(!tp(E))throw Error(y(200));if(f==null||f._reactInternals===void 0)throw Error(y(38));return ip(f,g,E,!1,z)},qa.version="18.3.1-next-f1338f8080-20240426",qa}var W2;function CP(){if(W2)return ix.exports;W2=1;function u(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(u)}catch(p){console.error(p)}}return u(),ix.exports=EP(),ix.exports}var q2;function AP(){if(q2)return H_;q2=1;var u=CP();return H_.createRoot=u.createRoot,H_.hydrateRoot=u.hydrateRoot,H_}var IP=AP(),Fe=fv();const Eg=l3(Fe);/**
 * react-router v7.7.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Z2="popstate";function PP(u={}){function p(C,M){let{pathname:D="/",search:r="",hash:U=""}=wp(C.location.hash.substring(1));return!D.startsWith("/")&&!D.startsWith(".")&&(D="/"+D),Lx("",{pathname:D,search:r,hash:U},M.state&&M.state.usr||null,M.state&&M.state.key||"default")}function y(C,M){let D=C.document.querySelector("base"),r="";if(D&&D.getAttribute("href")){let U=C.location.href,G=U.indexOf("#");r=G===-1?U:U.slice(0,G)}return r+"#"+(typeof M=="string"?M:kg(M))}function b(C,M){pc(C.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(M)})`)}return RP(p,y,b,u)}function os(u,p){if(u===!1||u===null||typeof u>"u")throw new Error(p)}function pc(u,p){if(!u){typeof console<"u"&&console.warn(p);try{throw new Error(p)}catch{}}}function MP(){return Math.random().toString(36).substring(2,10)}function X2(u,p){return{usr:u.state,key:u.key,idx:p}}function Lx(u,p,y=null,b){return{pathname:typeof u=="string"?u:u.pathname,search:"",hash:"",...typeof p=="string"?wp(p):p,state:y,key:p&&p.key||b||MP()}}function kg({pathname:u="/",search:p="",hash:y=""}){return p&&p!=="?"&&(u+=p.charAt(0)==="?"?p:"?"+p),y&&y!=="#"&&(u+=y.charAt(0)==="#"?y:"#"+y),u}function wp(u){let p={};if(u){let y=u.indexOf("#");y>=0&&(p.hash=u.substring(y),u=u.substring(0,y));let b=u.indexOf("?");b>=0&&(p.search=u.substring(b),u=u.substring(0,b)),u&&(p.pathname=u)}return p}function RP(u,p,y,b={}){let{window:C=document.defaultView,v5Compat:M=!1}=b,D=C.history,r="POP",U=null,G=Q();G==null&&(G=0,D.replaceState({...D.state,idx:G},""));function Q(){return(D.state||{idx:null}).idx}function se(){r="POP";let ce=Q(),ze=ce==null?null:ce-G;G=ce,U&&U({action:r,location:ve.location,delta:ze})}function de(ce,ze){r="PUSH";let et=Lx(ve.location,ce,ze);y&&y(et,ce),G=Q()+1;let pt=X2(et,G),Tt=ve.createHref(et);try{D.pushState(pt,"",Tt)}catch(It){if(It instanceof DOMException&&It.name==="DataCloneError")throw It;C.location.assign(Tt)}M&&U&&U({action:r,location:ve.location,delta:1})}function Pe(ce,ze){r="REPLACE";let et=Lx(ve.location,ce,ze);y&&y(et,ce),G=Q();let pt=X2(et,G),Tt=ve.createHref(et);D.replaceState(pt,"",Tt),M&&U&&U({action:r,location:ve.location,delta:0})}function Se(ce){return kP(ce)}let ve={get action(){return r},get location(){return u(C,D)},listen(ce){if(U)throw new Error("A history only accepts one active listener");return C.addEventListener(Z2,se),U=ce,()=>{C.removeEventListener(Z2,se),U=null}},createHref(ce){return p(C,ce)},createURL:Se,encodeLocation(ce){let ze=Se(ce);return{pathname:ze.pathname,search:ze.search,hash:ze.hash}},push:de,replace:Pe,go(ce){return D.go(ce)}};return ve}function kP(u,p=!1){let y="http://localhost";typeof window<"u"&&(y=window.location.origin!=="null"?window.location.origin:window.location.href),os(y,"No window.location.(origin|href) available to create URL");let b=typeof u=="string"?u:kg(u);return b=b.replace(/ $/,"%20"),!p&&b.startsWith("//")&&(b=y+b),new URL(b,y)}function c3(u,p,y="/"){return DP(u,p,y,!1)}function DP(u,p,y,b){let C=typeof p=="string"?wp(p):p,M=cd(C.pathname||"/",y);if(M==null)return null;let D=u3(u);LP(D);let r=null;for(let U=0;r==null&&U<D.length;++U){let G=HP(M);r=GP(D[U],G,b)}return r}function u3(u,p=[],y=[],b=""){let C=(M,D,r)=>{let U={relativePath:r===void 0?M.path||"":r,caseSensitive:M.caseSensitive===!0,childrenIndex:D,route:M};U.relativePath.startsWith("/")&&(os(U.relativePath.startsWith(b),`Absolute route path "${U.relativePath}" nested under path "${b}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),U.relativePath=U.relativePath.slice(b.length));let G=od([b,U.relativePath]),Q=y.concat(U);M.children&&M.children.length>0&&(os(M.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${G}".`),u3(M.children,p,Q,G)),!(M.path==null&&!M.index)&&p.push({path:G,score:VP(G,M.index),routesMeta:Q})};return u.forEach((M,D)=>{var r;if(M.path===""||!((r=M.path)!=null&&r.includes("?")))C(M,D);else for(let U of h3(M.path))C(M,D,U)}),p}function h3(u){let p=u.split("/");if(p.length===0)return[];let[y,...b]=p,C=y.endsWith("?"),M=y.replace(/\?$/,"");if(b.length===0)return C?[M,""]:[M];let D=h3(b.join("/")),r=[];return r.push(...D.map(U=>U===""?M:[M,U].join("/"))),C&&r.push(...D),r.map(U=>u.startsWith("/")&&U===""?"/":U)}function LP(u){u.sort((p,y)=>p.score!==y.score?y.score-p.score:UP(p.routesMeta.map(b=>b.childrenIndex),y.routesMeta.map(b=>b.childrenIndex)))}var zP=/^:[\w-]+$/,FP=3,OP=2,NP=1,BP=10,jP=-2,Y2=u=>u==="*";function VP(u,p){let y=u.split("/"),b=y.length;return y.some(Y2)&&(b+=jP),p&&(b+=OP),y.filter(C=>!Y2(C)).reduce((C,M)=>C+(zP.test(M)?FP:M===""?NP:BP),b)}function UP(u,p){return u.length===p.length&&u.slice(0,-1).every((b,C)=>b===p[C])?u[u.length-1]-p[p.length-1]:0}function GP(u,p,y=!1){let{routesMeta:b}=u,C={},M="/",D=[];for(let r=0;r<b.length;++r){let U=b[r],G=r===b.length-1,Q=M==="/"?p:p.slice(M.length)||"/",se=hy({path:U.relativePath,caseSensitive:U.caseSensitive,end:G},Q),de=U.route;if(!se&&G&&y&&!b[b.length-1].route.index&&(se=hy({path:U.relativePath,caseSensitive:U.caseSensitive,end:!1},Q)),!se)return null;Object.assign(C,se.params),D.push({params:C,pathname:od([M,se.pathname]),pathnameBase:XP(od([M,se.pathnameBase])),route:de}),se.pathnameBase!=="/"&&(M=od([M,se.pathnameBase]))}return D}function hy(u,p){typeof u=="string"&&(u={path:u,caseSensitive:!1,end:!0});let[y,b]=$P(u.path,u.caseSensitive,u.end),C=p.match(y);if(!C)return null;let M=C[0],D=M.replace(/(.)\/+$/,"$1"),r=C.slice(1);return{params:b.reduce((G,{paramName:Q,isOptional:se},de)=>{if(Q==="*"){let Se=r[de]||"";D=M.slice(0,M.length-Se.length).replace(/(.)\/+$/,"$1")}const Pe=r[de];return se&&!Pe?G[Q]=void 0:G[Q]=(Pe||"").replace(/%2F/g,"/"),G},{}),pathname:M,pathnameBase:D,pattern:u}}function $P(u,p=!1,y=!0){pc(u==="*"||!u.endsWith("*")||u.endsWith("/*"),`Route path "${u}" will be treated as if it were "${u.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${u.replace(/\*$/,"/*")}".`);let b=[],C="^"+u.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(D,r,U)=>(b.push({paramName:r,isOptional:U!=null}),U?"/?([^\\/]+)?":"/([^\\/]+)"));return u.endsWith("*")?(b.push({paramName:"*"}),C+=u==="*"||u==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):y?C+="\\/*$":u!==""&&u!=="/"&&(C+="(?:(?=\\/|$))"),[new RegExp(C,p?void 0:"i"),b]}function HP(u){try{return u.split("/").map(p=>decodeURIComponent(p).replace(/\//g,"%2F")).join("/")}catch(p){return pc(!1,`The URL path "${u}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${p}).`),u}}function cd(u,p){if(p==="/")return u;if(!u.toLowerCase().startsWith(p.toLowerCase()))return null;let y=p.endsWith("/")?p.length-1:p.length,b=u.charAt(y);return b&&b!=="/"?null:u.slice(y)||"/"}function WP(u,p="/"){let{pathname:y,search:b="",hash:C=""}=typeof u=="string"?wp(u):u;return{pathname:y?y.startsWith("/")?y:qP(y,p):p,search:YP(b),hash:KP(C)}}function qP(u,p){let y=p.replace(/\/+$/,"").split("/");return u.split("/").forEach(C=>{C===".."?y.length>1&&y.pop():C!=="."&&y.push(C)}),y.length>1?y.join("/"):"/"}function sx(u,p,y,b){return`Cannot include a '${u}' character in a manually specified \`to.${p}\` field [${JSON.stringify(b)}].  Please separate it out to the \`to.${y}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function ZP(u){return u.filter((p,y)=>y===0||p.route.path&&p.route.path.length>0)}function pv(u){let p=ZP(u);return p.map((y,b)=>b===p.length-1?y.pathname:y.pathnameBase)}function mv(u,p,y,b=!1){let C;typeof u=="string"?C=wp(u):(C={...u},os(!C.pathname||!C.pathname.includes("?"),sx("?","pathname","search",C)),os(!C.pathname||!C.pathname.includes("#"),sx("#","pathname","hash",C)),os(!C.search||!C.search.includes("#"),sx("#","search","hash",C)));let M=u===""||C.pathname==="",D=M?"/":C.pathname,r;if(D==null)r=y;else{let se=p.length-1;if(!b&&D.startsWith("..")){let de=D.split("/");for(;de[0]==="..";)de.shift(),se-=1;C.pathname=de.join("/")}r=se>=0?p[se]:"/"}let U=WP(C,r),G=D&&D!=="/"&&D.endsWith("/"),Q=(M||D===".")&&y.endsWith("/");return!U.pathname.endsWith("/")&&(G||Q)&&(U.pathname+="/"),U}var od=u=>u.join("/").replace(/\/\/+/g,"/"),XP=u=>u.replace(/\/+$/,"").replace(/^\/*/,"/"),YP=u=>!u||u==="?"?"":u.startsWith("?")?u:"?"+u,KP=u=>!u||u==="#"?"":u.startsWith("#")?u:"#"+u;function JP(u){return u!=null&&typeof u.status=="number"&&typeof u.statusText=="string"&&typeof u.internal=="boolean"&&"data"in u}var d3=["POST","PUT","PATCH","DELETE"];new Set(d3);var QP=["GET",...d3];new Set(QP);var _m=Fe.createContext(null);_m.displayName="DataRouter";var Sy=Fe.createContext(null);Sy.displayName="DataRouterState";Fe.createContext(!1);var f3=Fe.createContext({isTransitioning:!1});f3.displayName="ViewTransition";var eM=Fe.createContext(new Map);eM.displayName="Fetchers";var tM=Fe.createContext(null);tM.displayName="Await";var hu=Fe.createContext(null);hu.displayName="Navigation";var Ug=Fe.createContext(null);Ug.displayName="Location";var du=Fe.createContext({outlet:null,matches:[],isDataRoute:!1});du.displayName="Route";var gv=Fe.createContext(null);gv.displayName="RouteError";function iM(u,{relative:p}={}){os(ym(),"useHref() may be used only in the context of a <Router> component.");let{basename:y,navigator:b}=Fe.useContext(hu),{hash:C,pathname:M,search:D}=Gg(u,{relative:p}),r=M;return y!=="/"&&(r=M==="/"?y:od([y,M])),b.createHref({pathname:r,search:D,hash:C})}function ym(){return Fe.useContext(Ug)!=null}function Ka(){return os(ym(),"useLocation() may be used only in the context of a <Router> component."),Fe.useContext(Ug).location}var p3="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function m3(u){Fe.useContext(hu).static||Fe.useLayoutEffect(u)}function mc(){let{isDataRoute:u}=Fe.useContext(du);return u?gM():nM()}function nM(){os(ym(),"useNavigate() may be used only in the context of a <Router> component.");let u=Fe.useContext(_m),{basename:p,navigator:y}=Fe.useContext(hu),{matches:b}=Fe.useContext(du),{pathname:C}=Ka(),M=JSON.stringify(pv(b)),D=Fe.useRef(!1);return m3(()=>{D.current=!0}),Fe.useCallback((U,G={})=>{if(pc(D.current,p3),!D.current)return;if(typeof U=="number"){y.go(U);return}let Q=mv(U,JSON.parse(M),C,G.relative==="path");u==null&&p!=="/"&&(Q.pathname=Q.pathname==="/"?p:od([p,Q.pathname])),(G.replace?y.replace:y.push)(Q,G.state,G)},[p,y,M,C,u])}Fe.createContext(null);function rM(){let{matches:u}=Fe.useContext(du),p=u[u.length-1];return p?p.params:{}}function Gg(u,{relative:p}={}){let{matches:y}=Fe.useContext(du),{pathname:b}=Ka(),C=JSON.stringify(pv(y));return Fe.useMemo(()=>mv(u,JSON.parse(C),b,p==="path"),[u,C,b,p])}function sM(u,p){return g3(u,p)}function g3(u,p,y,b){var ze;os(ym(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:C}=Fe.useContext(hu),{matches:M}=Fe.useContext(du),D=M[M.length-1],r=D?D.params:{},U=D?D.pathname:"/",G=D?D.pathnameBase:"/",Q=D&&D.route;{let et=Q&&Q.path||"";_3(U,!Q||et.endsWith("*")||et.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${U}" (under <Route path="${et}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${et}"> to <Route path="${et==="/"?"*":`${et}/*`}">.`)}let se=Ka(),de;if(p){let et=typeof p=="string"?wp(p):p;os(G==="/"||((ze=et.pathname)==null?void 0:ze.startsWith(G)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${G}" but pathname "${et.pathname}" was given in the \`location\` prop.`),de=et}else de=se;let Pe=de.pathname||"/",Se=Pe;if(G!=="/"){let et=G.replace(/^\//,"").split("/");Se="/"+Pe.replace(/^\//,"").split("/").slice(et.length).join("/")}let ve=c3(u,{pathname:Se});pc(Q||ve!=null,`No routes matched location "${de.pathname}${de.search}${de.hash}" `),pc(ve==null||ve[ve.length-1].route.element!==void 0||ve[ve.length-1].route.Component!==void 0||ve[ve.length-1].route.lazy!==void 0,`Matched leaf route at location "${de.pathname}${de.search}${de.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let ce=uM(ve&&ve.map(et=>Object.assign({},et,{params:Object.assign({},r,et.params),pathname:od([G,C.encodeLocation?C.encodeLocation(et.pathname).pathname:et.pathname]),pathnameBase:et.pathnameBase==="/"?G:od([G,C.encodeLocation?C.encodeLocation(et.pathnameBase).pathname:et.pathnameBase])})),M,y,b);return p&&ce?Fe.createElement(Ug.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...de},navigationType:"POP"}},ce):ce}function oM(){let u=mM(),p=JP(u)?`${u.status} ${u.statusText}`:u instanceof Error?u.message:JSON.stringify(u),y=u instanceof Error?u.stack:null,b="rgba(200,200,200, 0.5)",C={padding:"0.5rem",backgroundColor:b},M={padding:"2px 4px",backgroundColor:b},D=null;return console.error("Error handled by React Router default ErrorBoundary:",u),D=Fe.createElement(Fe.Fragment,null,Fe.createElement("p",null," Hey developer "),Fe.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Fe.createElement("code",{style:M},"ErrorBoundary")," or"," ",Fe.createElement("code",{style:M},"errorElement")," prop on your route.")),Fe.createElement(Fe.Fragment,null,Fe.createElement("h2",null,"Unexpected Application Error!"),Fe.createElement("h3",{style:{fontStyle:"italic"}},p),y?Fe.createElement("pre",{style:C},y):null,D)}var aM=Fe.createElement(oM,null),lM=class extends Fe.Component{constructor(u){super(u),this.state={location:u.location,revalidation:u.revalidation,error:u.error}}static getDerivedStateFromError(u){return{error:u}}static getDerivedStateFromProps(u,p){return p.location!==u.location||p.revalidation!=="idle"&&u.revalidation==="idle"?{error:u.error,location:u.location,revalidation:u.revalidation}:{error:u.error!==void 0?u.error:p.error,location:p.location,revalidation:u.revalidation||p.revalidation}}componentDidCatch(u,p){console.error("React Router caught the following error during render",u,p)}render(){return this.state.error!==void 0?Fe.createElement(du.Provider,{value:this.props.routeContext},Fe.createElement(gv.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function cM({routeContext:u,match:p,children:y}){let b=Fe.useContext(_m);return b&&b.static&&b.staticContext&&(p.route.errorElement||p.route.ErrorBoundary)&&(b.staticContext._deepestRenderedBoundaryId=p.route.id),Fe.createElement(du.Provider,{value:u},y)}function uM(u,p=[],y=null,b=null){if(u==null){if(!y)return null;if(y.errors)u=y.matches;else if(p.length===0&&!y.initialized&&y.matches.length>0)u=y.matches;else return null}let C=u,M=y==null?void 0:y.errors;if(M!=null){let U=C.findIndex(G=>G.route.id&&(M==null?void 0:M[G.route.id])!==void 0);os(U>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(M).join(",")}`),C=C.slice(0,Math.min(C.length,U+1))}let D=!1,r=-1;if(y)for(let U=0;U<C.length;U++){let G=C[U];if((G.route.HydrateFallback||G.route.hydrateFallbackElement)&&(r=U),G.route.id){let{loaderData:Q,errors:se}=y,de=G.route.loader&&!Q.hasOwnProperty(G.route.id)&&(!se||se[G.route.id]===void 0);if(G.route.lazy||de){D=!0,r>=0?C=C.slice(0,r+1):C=[C[0]];break}}}return C.reduceRight((U,G,Q)=>{let se,de=!1,Pe=null,Se=null;y&&(se=M&&G.route.id?M[G.route.id]:void 0,Pe=G.route.errorElement||aM,D&&(r<0&&Q===0?(_3("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),de=!0,Se=null):r===Q&&(de=!0,Se=G.route.hydrateFallbackElement||null)));let ve=p.concat(C.slice(0,Q+1)),ce=()=>{let ze;return se?ze=Pe:de?ze=Se:G.route.Component?ze=Fe.createElement(G.route.Component,null):G.route.element?ze=G.route.element:ze=U,Fe.createElement(cM,{match:G,routeContext:{outlet:U,matches:ve,isDataRoute:y!=null},children:ze})};return y&&(G.route.ErrorBoundary||G.route.errorElement||Q===0)?Fe.createElement(lM,{location:y.location,revalidation:y.revalidation,component:Pe,error:se,children:ce(),routeContext:{outlet:null,matches:ve,isDataRoute:!0}}):ce()},null)}function _v(u){return`${u} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function hM(u){let p=Fe.useContext(_m);return os(p,_v(u)),p}function dM(u){let p=Fe.useContext(Sy);return os(p,_v(u)),p}function fM(u){let p=Fe.useContext(du);return os(p,_v(u)),p}function yv(u){let p=fM(u),y=p.matches[p.matches.length-1];return os(y.route.id,`${u} can only be used on routes that contain a unique "id"`),y.route.id}function pM(){return yv("useRouteId")}function mM(){var b;let u=Fe.useContext(gv),p=dM("useRouteError"),y=yv("useRouteError");return u!==void 0?u:(b=p.errors)==null?void 0:b[y]}function gM(){let{router:u}=hM("useNavigate"),p=yv("useNavigate"),y=Fe.useRef(!1);return m3(()=>{y.current=!0}),Fe.useCallback(async(C,M={})=>{pc(y.current,p3),y.current&&(typeof C=="number"?u.navigate(C):await u.navigate(C,{fromRouteId:p,...M}))},[u,p])}var K2={};function _3(u,p,y){!p&&!K2[u]&&(K2[u]=!0,pc(!1,y))}Fe.memo(_M);function _M({routes:u,future:p,state:y}){return g3(u,void 0,y,p)}function Dg({to:u,replace:p,state:y,relative:b}){os(ym(),"<Navigate> may be used only in the context of a <Router> component.");let{static:C}=Fe.useContext(hu);pc(!C,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:M}=Fe.useContext(du),{pathname:D}=Ka(),r=mc(),U=mv(u,pv(M),D,b==="path"),G=JSON.stringify(U);return Fe.useEffect(()=>{r(JSON.parse(G),{replace:p,state:y,relative:b})},[r,G,b,p,y]),null}function Ns(u){os(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function yM({basename:u="/",children:p=null,location:y,navigationType:b="POP",navigator:C,static:M=!1}){os(!ym(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let D=u.replace(/^\/*/,"/"),r=Fe.useMemo(()=>({basename:D,navigator:C,static:M,future:{}}),[D,C,M]);typeof y=="string"&&(y=wp(y));let{pathname:U="/",search:G="",hash:Q="",state:se=null,key:de="default"}=y,Pe=Fe.useMemo(()=>{let Se=cd(U,D);return Se==null?null:{location:{pathname:Se,search:G,hash:Q,state:se,key:de},navigationType:b}},[D,U,G,Q,se,de,b]);return pc(Pe!=null,`<Router basename="${D}"> is not able to match the URL "${U}${G}${Q}" because it does not start with the basename, so the <Router> won't render anything.`),Pe==null?null:Fe.createElement(hu.Provider,{value:r},Fe.createElement(Ug.Provider,{children:p,value:Pe}))}function J2({children:u,location:p}){return sM(zx(u),p)}function zx(u,p=[]){let y=[];return Fe.Children.forEach(u,(b,C)=>{if(!Fe.isValidElement(b))return;let M=[...p,C];if(b.type===Fe.Fragment){y.push.apply(y,zx(b.props.children,M));return}os(b.type===Ns,`[${typeof b.type=="string"?b.type:b.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),os(!b.props.index||!b.props.children,"An index route cannot have child routes.");let D={id:b.props.id||M.join("-"),caseSensitive:b.props.caseSensitive,element:b.props.element,Component:b.props.Component,index:b.props.index,path:b.props.path,loader:b.props.loader,action:b.props.action,hydrateFallbackElement:b.props.hydrateFallbackElement,HydrateFallback:b.props.HydrateFallback,errorElement:b.props.errorElement,ErrorBoundary:b.props.ErrorBoundary,hasErrorBoundary:b.props.hasErrorBoundary===!0||b.props.ErrorBoundary!=null||b.props.errorElement!=null,shouldRevalidate:b.props.shouldRevalidate,handle:b.props.handle,lazy:b.props.lazy};b.props.children&&(D.children=zx(b.props.children,M)),y.push(D)}),y}var ey="get",ty="application/x-www-form-urlencoded";function Ey(u){return u!=null&&typeof u.tagName=="string"}function xM(u){return Ey(u)&&u.tagName.toLowerCase()==="button"}function vM(u){return Ey(u)&&u.tagName.toLowerCase()==="form"}function wM(u){return Ey(u)&&u.tagName.toLowerCase()==="input"}function bM(u){return!!(u.metaKey||u.altKey||u.ctrlKey||u.shiftKey)}function TM(u,p){return u.button===0&&(!p||p==="_self")&&!bM(u)}var W_=null;function SM(){if(W_===null)try{new FormData(document.createElement("form"),0),W_=!1}catch{W_=!0}return W_}var EM=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function ox(u){return u!=null&&!EM.has(u)?(pc(!1,`"${u}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${ty}"`),null):u}function CM(u,p){let y,b,C,M,D;if(vM(u)){let r=u.getAttribute("action");b=r?cd(r,p):null,y=u.getAttribute("method")||ey,C=ox(u.getAttribute("enctype"))||ty,M=new FormData(u)}else if(xM(u)||wM(u)&&(u.type==="submit"||u.type==="image")){let r=u.form;if(r==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let U=u.getAttribute("formaction")||r.getAttribute("action");if(b=U?cd(U,p):null,y=u.getAttribute("formmethod")||r.getAttribute("method")||ey,C=ox(u.getAttribute("formenctype"))||ox(r.getAttribute("enctype"))||ty,M=new FormData(r,u),!SM()){let{name:G,type:Q,value:se}=u;if(Q==="image"){let de=G?`${G}.`:"";M.append(`${de}x`,"0"),M.append(`${de}y`,"0")}else G&&M.append(G,se)}}else{if(Ey(u))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');y=ey,b=null,C=ty,D=u}return M&&C==="text/plain"&&(D=M,M=void 0),{action:b,method:y.toLowerCase(),encType:C,formData:M,body:D}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function xv(u,p){if(u===!1||u===null||typeof u>"u")throw new Error(p)}function AM(u,p,y){let b=typeof u=="string"?new URL(u,typeof window>"u"?"server://singlefetch/":window.location.origin):u;return b.pathname==="/"?b.pathname=`_root.${y}`:p&&cd(b.pathname,p)==="/"?b.pathname=`${p.replace(/\/$/,"")}/_root.${y}`:b.pathname=`${b.pathname.replace(/\/$/,"")}.${y}`,b}async function IM(u,p){if(u.id in p)return p[u.id];try{let y=await import(u.module);return p[u.id]=y,y}catch(y){return console.error(`Error loading route module \`${u.module}\`, reloading page...`),console.error(y),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function PM(u){return u==null?!1:u.href==null?u.rel==="preload"&&typeof u.imageSrcSet=="string"&&typeof u.imageSizes=="string":typeof u.rel=="string"&&typeof u.href=="string"}async function MM(u,p,y){let b=await Promise.all(u.map(async C=>{let M=p.routes[C.route.id];if(M){let D=await IM(M,y);return D.links?D.links():[]}return[]}));return LM(b.flat(1).filter(PM).filter(C=>C.rel==="stylesheet"||C.rel==="preload").map(C=>C.rel==="stylesheet"?{...C,rel:"prefetch",as:"style"}:{...C,rel:"prefetch"}))}function Q2(u,p,y,b,C,M){let D=(U,G)=>y[G]?U.route.id!==y[G].route.id:!0,r=(U,G)=>{var Q;return y[G].pathname!==U.pathname||((Q=y[G].route.path)==null?void 0:Q.endsWith("*"))&&y[G].params["*"]!==U.params["*"]};return M==="assets"?p.filter((U,G)=>D(U,G)||r(U,G)):M==="data"?p.filter((U,G)=>{var se;let Q=b.routes[U.route.id];if(!Q||!Q.hasLoader)return!1;if(D(U,G)||r(U,G))return!0;if(U.route.shouldRevalidate){let de=U.route.shouldRevalidate({currentUrl:new URL(C.pathname+C.search+C.hash,window.origin),currentParams:((se=y[0])==null?void 0:se.params)||{},nextUrl:new URL(u,window.origin),nextParams:U.params,defaultShouldRevalidate:!0});if(typeof de=="boolean")return de}return!0}):[]}function RM(u,p,{includeHydrateFallback:y}={}){return kM(u.map(b=>{let C=p.routes[b.route.id];if(!C)return[];let M=[C.module];return C.clientActionModule&&(M=M.concat(C.clientActionModule)),C.clientLoaderModule&&(M=M.concat(C.clientLoaderModule)),y&&C.hydrateFallbackModule&&(M=M.concat(C.hydrateFallbackModule)),C.imports&&(M=M.concat(C.imports)),M}).flat(1))}function kM(u){return[...new Set(u)]}function DM(u){let p={},y=Object.keys(u).sort();for(let b of y)p[b]=u[b];return p}function LM(u,p){let y=new Set;return new Set(p),u.reduce((b,C)=>{let M=JSON.stringify(DM(C));return y.has(M)||(y.add(M),b.push({key:M,link:C})),b},[])}function y3(){let u=Fe.useContext(_m);return xv(u,"You must render this element inside a <DataRouterContext.Provider> element"),u}function zM(){let u=Fe.useContext(Sy);return xv(u,"You must render this element inside a <DataRouterStateContext.Provider> element"),u}var vv=Fe.createContext(void 0);vv.displayName="FrameworkContext";function x3(){let u=Fe.useContext(vv);return xv(u,"You must render this element inside a <HydratedRouter> element"),u}function FM(u,p){let y=Fe.useContext(vv),[b,C]=Fe.useState(!1),[M,D]=Fe.useState(!1),{onFocus:r,onBlur:U,onMouseEnter:G,onMouseLeave:Q,onTouchStart:se}=p,de=Fe.useRef(null);Fe.useEffect(()=>{if(u==="render"&&D(!0),u==="viewport"){let ve=ze=>{ze.forEach(et=>{D(et.isIntersecting)})},ce=new IntersectionObserver(ve,{threshold:.5});return de.current&&ce.observe(de.current),()=>{ce.disconnect()}}},[u]),Fe.useEffect(()=>{if(b){let ve=setTimeout(()=>{D(!0)},100);return()=>{clearTimeout(ve)}}},[b]);let Pe=()=>{C(!0)},Se=()=>{C(!1),D(!1)};return y?u!=="intent"?[M,de,{}]:[M,de,{onFocus:pg(r,Pe),onBlur:pg(U,Se),onMouseEnter:pg(G,Pe),onMouseLeave:pg(Q,Se),onTouchStart:pg(se,Pe)}]:[!1,de,{}]}function pg(u,p){return y=>{u&&u(y),y.defaultPrevented||p(y)}}function OM({page:u,...p}){let{router:y}=y3(),b=Fe.useMemo(()=>c3(y.routes,u,y.basename),[y.routes,u,y.basename]);return b?Fe.createElement(BM,{page:u,matches:b,...p}):null}function NM(u){let{manifest:p,routeModules:y}=x3(),[b,C]=Fe.useState([]);return Fe.useEffect(()=>{let M=!1;return MM(u,p,y).then(D=>{M||C(D)}),()=>{M=!0}},[u,p,y]),b}function BM({page:u,matches:p,...y}){let b=Ka(),{manifest:C,routeModules:M}=x3(),{basename:D}=y3(),{loaderData:r,matches:U}=zM(),G=Fe.useMemo(()=>Q2(u,p,U,C,b,"data"),[u,p,U,C,b]),Q=Fe.useMemo(()=>Q2(u,p,U,C,b,"assets"),[u,p,U,C,b]),se=Fe.useMemo(()=>{if(u===b.pathname+b.search+b.hash)return[];let Se=new Set,ve=!1;if(p.forEach(ze=>{var pt;let et=C.routes[ze.route.id];!et||!et.hasLoader||(!G.some(Tt=>Tt.route.id===ze.route.id)&&ze.route.id in r&&((pt=M[ze.route.id])!=null&&pt.shouldRevalidate)||et.hasClientLoader?ve=!0:Se.add(ze.route.id))}),Se.size===0)return[];let ce=AM(u,D,"data");return ve&&Se.size>0&&ce.searchParams.set("_routes",p.filter(ze=>Se.has(ze.route.id)).map(ze=>ze.route.id).join(",")),[ce.pathname+ce.search]},[D,r,b,C,G,p,u,M]),de=Fe.useMemo(()=>RM(Q,C),[Q,C]),Pe=NM(Q);return Fe.createElement(Fe.Fragment,null,se.map(Se=>Fe.createElement("link",{key:Se,rel:"prefetch",as:"fetch",href:Se,...y})),de.map(Se=>Fe.createElement("link",{key:Se,rel:"modulepreload",href:Se,...y})),Pe.map(({key:Se,link:ve})=>Fe.createElement("link",{key:Se,...ve})))}function jM(...u){return p=>{u.forEach(y=>{typeof y=="function"?y(p):y!=null&&(y.current=p)})}}var v3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{v3&&(window.__reactRouterVersion="7.7.1")}catch{}function VM({basename:u,children:p,window:y}){let b=Fe.useRef();b.current==null&&(b.current=PP({window:y,v5Compat:!0}));let C=b.current,[M,D]=Fe.useState({action:C.action,location:C.location}),r=Fe.useCallback(U=>{Fe.startTransition(()=>D(U))},[D]);return Fe.useLayoutEffect(()=>C.listen(r),[C,r]),Fe.createElement(yM,{basename:u,children:p,location:M.location,navigationType:M.action,navigator:C})}var w3=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,b3=Fe.forwardRef(function({onClick:p,discover:y="render",prefetch:b="none",relative:C,reloadDocument:M,replace:D,state:r,target:U,to:G,preventScrollReset:Q,viewTransition:se,...de},Pe){let{basename:Se}=Fe.useContext(hu),ve=typeof G=="string"&&w3.test(G),ce,ze=!1;if(typeof G=="string"&&ve&&(ce=G,v3))try{let vt=new URL(window.location.href),Jt=G.startsWith("//")?new URL(vt.protocol+G):new URL(G),Ht=cd(Jt.pathname,Se);Jt.origin===vt.origin&&Ht!=null?G=Ht+Jt.search+Jt.hash:ze=!0}catch{pc(!1,`<Link to="${G}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let et=iM(G,{relative:C}),[pt,Tt,It]=FM(b,de),di=HM(G,{replace:D,state:r,target:U,preventScrollReset:Q,relative:C,viewTransition:se});function Bt(vt){p&&p(vt),vt.defaultPrevented||di(vt)}let Yt=Fe.createElement("a",{...de,...It,href:ce||et,onClick:ze||M?p:Bt,ref:jM(Pe,Tt),target:U,"data-discover":!ve&&y==="render"?"true":void 0});return pt&&!ve?Fe.createElement(Fe.Fragment,null,Yt,Fe.createElement(OM,{page:et})):Yt});b3.displayName="Link";var UM=Fe.forwardRef(function({"aria-current":p="page",caseSensitive:y=!1,className:b="",end:C=!1,style:M,to:D,viewTransition:r,children:U,...G},Q){let se=Gg(D,{relative:G.relative}),de=Ka(),Pe=Fe.useContext(Sy),{navigator:Se,basename:ve}=Fe.useContext(hu),ce=Pe!=null&&YM(se)&&r===!0,ze=Se.encodeLocation?Se.encodeLocation(se).pathname:se.pathname,et=de.pathname,pt=Pe&&Pe.navigation&&Pe.navigation.location?Pe.navigation.location.pathname:null;y||(et=et.toLowerCase(),pt=pt?pt.toLowerCase():null,ze=ze.toLowerCase()),pt&&ve&&(pt=cd(pt,ve)||pt);const Tt=ze!=="/"&&ze.endsWith("/")?ze.length-1:ze.length;let It=et===ze||!C&&et.startsWith(ze)&&et.charAt(Tt)==="/",di=pt!=null&&(pt===ze||!C&&pt.startsWith(ze)&&pt.charAt(ze.length)==="/"),Bt={isActive:It,isPending:di,isTransitioning:ce},Yt=It?p:void 0,vt;typeof b=="function"?vt=b(Bt):vt=[b,It?"active":null,di?"pending":null,ce?"transitioning":null].filter(Boolean).join(" ");let Jt=typeof M=="function"?M(Bt):M;return Fe.createElement(b3,{...G,"aria-current":Yt,className:vt,ref:Q,style:Jt,to:D,viewTransition:r},typeof U=="function"?U(Bt):U)});UM.displayName="NavLink";var GM=Fe.forwardRef(({discover:u="render",fetcherKey:p,navigate:y,reloadDocument:b,replace:C,state:M,method:D=ey,action:r,onSubmit:U,relative:G,preventScrollReset:Q,viewTransition:se,...de},Pe)=>{let Se=ZM(),ve=XM(r,{relative:G}),ce=D.toLowerCase()==="get"?"get":"post",ze=typeof r=="string"&&w3.test(r),et=pt=>{if(U&&U(pt),pt.defaultPrevented)return;pt.preventDefault();let Tt=pt.nativeEvent.submitter,It=(Tt==null?void 0:Tt.getAttribute("formmethod"))||D;Se(Tt||pt.currentTarget,{fetcherKey:p,method:It,navigate:y,replace:C,state:M,relative:G,preventScrollReset:Q,viewTransition:se})};return Fe.createElement("form",{ref:Pe,method:ce,action:ve,onSubmit:b?U:et,...de,"data-discover":!ze&&u==="render"?"true":void 0})});GM.displayName="Form";function $M(u){return`${u} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function T3(u){let p=Fe.useContext(_m);return os(p,$M(u)),p}function HM(u,{target:p,replace:y,state:b,preventScrollReset:C,relative:M,viewTransition:D}={}){let r=mc(),U=Ka(),G=Gg(u,{relative:M});return Fe.useCallback(Q=>{if(TM(Q,p)){Q.preventDefault();let se=y!==void 0?y:kg(U)===kg(G);r(u,{replace:se,state:b,preventScrollReset:C,relative:M,viewTransition:D})}},[U,r,G,y,b,p,u,C,M,D])}var WM=0,qM=()=>`__${String(++WM)}__`;function ZM(){let{router:u}=T3("useSubmit"),{basename:p}=Fe.useContext(hu),y=pM();return Fe.useCallback(async(b,C={})=>{let{action:M,method:D,encType:r,formData:U,body:G}=CM(b,p);if(C.navigate===!1){let Q=C.fetcherKey||qM();await u.fetch(Q,y,C.action||M,{preventScrollReset:C.preventScrollReset,formData:U,body:G,formMethod:C.method||D,formEncType:C.encType||r,flushSync:C.flushSync})}else await u.navigate(C.action||M,{preventScrollReset:C.preventScrollReset,formData:U,body:G,formMethod:C.method||D,formEncType:C.encType||r,replace:C.replace,state:C.state,fromRouteId:y,flushSync:C.flushSync,viewTransition:C.viewTransition})},[u,p,y])}function XM(u,{relative:p}={}){let{basename:y}=Fe.useContext(hu),b=Fe.useContext(du);os(b,"useFormAction must be used inside a RouteContext");let[C]=b.matches.slice(-1),M={...Gg(u||".",{relative:p})},D=Ka();if(u==null){M.search=D.search;let r=new URLSearchParams(M.search),U=r.getAll("index");if(U.some(Q=>Q==="")){r.delete("index"),U.filter(se=>se).forEach(se=>r.append("index",se));let Q=r.toString();M.search=Q?`?${Q}`:""}}return(!u||u===".")&&C.route.index&&(M.search=M.search?M.search.replace(/^\?/,"?index&"):"?index"),y!=="/"&&(M.pathname=M.pathname==="/"?y:od([y,M.pathname])),kg(M)}function YM(u,{relative:p}={}){let y=Fe.useContext(f3);os(y!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:b}=T3("useViewTransitionState"),C=Gg(u,{relative:p});if(!y.isTransitioning)return!1;let M=cd(y.currentLocation.pathname,b)||y.currentLocation.pathname,D=cd(y.nextLocation.pathname,b)||y.nextLocation.pathname;return hy(C.pathname,D)!=null||hy(C.pathname,M)!=null}var eT={},KM="@vercel/analytics",JM="1.5.0",QM=()=>{window.va||(window.va=function(...p){(window.vaq=window.vaq||[]).push(p)})};function S3(){return typeof window<"u"}function E3(){try{const u="production"}catch{}return"production"}function e5(u="auto"){if(u==="auto"){window.vam=E3();return}window.vam=u}function t5(){return(S3()?window.vam:E3())||"production"}function Fx(){return t5()==="development"}function i5(u){return u.scriptSrc?u.scriptSrc:Fx()?"https://va.vercel-scripts.com/v1/script.debug.js":u.basePath?`${u.basePath}/insights/script.js`:"/_vercel/insights/script.js"}function n5(u={debug:!0}){var p;if(!S3())return;e5(u.mode),QM(),u.beforeSend&&((p=window.va)==null||p.call(window,"beforeSend",u.beforeSend));const y=i5(u);if(document.head.querySelector(`script[src*="${y}"]`))return;const b=document.createElement("script");b.src=y,b.defer=!0,b.dataset.sdkn=KM+(u.framework?`/${u.framework}`:""),b.dataset.sdkv=JM,u.disableAutoTrack&&(b.dataset.disableAutoTrack="1"),u.endpoint?b.dataset.endpoint=u.endpoint:u.basePath&&(b.dataset.endpoint=`${u.basePath}/insights`),u.dsn&&(b.dataset.dsn=u.dsn),b.onerror=()=>{const C=Fx()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${y}. ${C}`)},Fx()&&u.debug===!1&&(b.dataset.debug="false"),document.head.appendChild(b)}function r5({route:u,path:p}){var y;(y=window.va)==null||y.call(window,"pageview",{route:u,path:p})}function s5(){if(!(typeof process>"u"||typeof eT>"u"))return eT.REACT_APP_VERCEL_OBSERVABILITY_BASEPATH}function o5(u){return Fe.useEffect(()=>{var p;u.beforeSend&&((p=window.va)==null||p.call(window,"beforeSend",u.beforeSend))},[u.beforeSend]),Fe.useEffect(()=>{n5({framework:u.framework||"react",basePath:u.basePath??s5(),...u.route!==void 0&&{disableAutoTrack:!0},...u})},[]),Fe.useEffect(()=>{u.route&&u.path&&r5({route:u.route,path:u.path})},[u.route,u.path]),null}const vg={},tT=(u,p)=>u.unstable_is?u.unstable_is(p):p===u,iT=u=>"init"in u,ax=u=>!!u.write,nT=u=>"v"in u||"e"in u,q_=u=>{if("e"in u)throw u.e;if((vg?"production":void 0)!=="production"&&!("v"in u))throw new Error("[Bug] atom state is not initialized");return u.v},dy=new WeakMap,rT=u=>{var p;return fy(u)&&!!((p=dy.get(u))!=null&&p[0])},a5=u=>{const p=dy.get(u);p!=null&&p[0]&&(p[0]=!1,p[1].forEach(y=>y()))},C3=(u,p)=>{let y=dy.get(u);if(!y){y=[!0,new Set],dy.set(u,y);const b=()=>{y[0]=!1};u.then(b,b)}y[1].add(p)},fy=u=>typeof(u==null?void 0:u.then)=="function",A3=(u,p,y)=>{y.p.has(u)||(y.p.add(u),p.then(()=>{y.p.delete(u)},()=>{y.p.delete(u)}))},lx=(u,p,y)=>{const b=y(u),C="v"in b,M=b.v;if(fy(p))for(const D of b.d.keys())A3(u,p,y(D));b.v=p,delete b.e,(!C||!Object.is(M,b.v))&&(++b.n,fy(M)&&a5(M))},sT=(u,p,y)=>{var b;const C=new Set;for(const M of((b=y.get(u))==null?void 0:b.t)||[])y.has(M)&&C.add(M);for(const M of p.p)C.add(M);return C},l5=()=>{const u=new Set,p=()=>{u.forEach(y=>y())};return p.add=y=>(u.add(y),()=>{u.delete(y)}),p},cx=()=>{const u={},p=new WeakMap,y=b=>{var C,M;(C=p.get(u))==null||C.forEach(D=>D(b)),(M=p.get(b))==null||M.forEach(D=>D())};return y.add=(b,C)=>{const M=b||u,D=(p.has(M)?p:p.set(M,new Set)).get(M);return D.add(C),()=>{D==null||D.delete(C),D.size||p.delete(M)}},y},c5=u=>(u.c||(u.c=cx()),u.m||(u.m=cx()),u.u||(u.u=cx()),u.f||(u.f=l5()),u),u5=Symbol(),h5=(u=new WeakMap,p=new WeakMap,y=new WeakMap,b=new Set,C=new Set,M=new Set,D={},r=(de,...Pe)=>de.read(...Pe),U=(de,...Pe)=>de.write(...Pe),G=(de,Pe)=>{var Se;return(Se=de.unstable_onInit)==null?void 0:Se.call(de,Pe)},Q=(de,Pe)=>{var Se;return(Se=de.onMount)==null?void 0:Se.call(de,Pe)},...se)=>{const de=se[0]||(Bt=>{if((vg?"production":void 0)!=="production"&&!Bt)throw new Error("Atom is undefined or null");let Yt=u.get(Bt);return Yt||(Yt={d:new Map,p:new Set,n:0},u.set(Bt,Yt),G==null||G(Bt,di)),Yt}),Pe=se[1]||(()=>{const Bt=[],Yt=vt=>{try{vt()}catch(Jt){Bt.push(Jt)}};do{D.f&&Yt(D.f);const vt=new Set,Jt=vt.add.bind(vt);b.forEach(Ht=>{var Nt;return(Nt=p.get(Ht))==null?void 0:Nt.l.forEach(Jt)}),b.clear(),M.forEach(Jt),M.clear(),C.forEach(Jt),C.clear(),vt.forEach(Yt),b.size&&Se()}while(b.size||M.size||C.size);if(Bt.length)throw new AggregateError(Bt)}),Se=se[2]||(()=>{const Bt=[],Yt=new WeakSet,vt=new WeakSet,Jt=Array.from(b);for(;Jt.length;){const Ht=Jt[Jt.length-1],Nt=de(Ht);if(vt.has(Ht)){Jt.pop();continue}if(Yt.has(Ht)){if(y.get(Ht)===Nt.n)Bt.push([Ht,Nt]);else if((vg?"production":void 0)!=="production"&&y.has(Ht))throw new Error("[Bug] invalidated atom exists");vt.add(Ht),Jt.pop();continue}Yt.add(Ht);for(const Li of sT(Ht,Nt,p))Yt.has(Li)||Jt.push(Li)}for(let Ht=Bt.length-1;Ht>=0;--Ht){const[Nt,Li]=Bt[Ht];let Dt=!1;for(const Ci of Li.d.keys())if(Ci!==Nt&&b.has(Ci)){Dt=!0;break}Dt&&(ve(Nt),et(Nt)),y.delete(Nt)}}),ve=se[3]||(Bt=>{var Yt;const vt=de(Bt);if(nT(vt)&&(p.has(Bt)&&y.get(Bt)!==vt.n||Array.from(vt.d).every(([xi,$t])=>ve(xi).n===$t)))return vt;vt.d.clear();let Jt=!0;const Ht=()=>{p.has(Bt)&&(et(Bt),Se(),Pe())},Nt=xi=>{var $t;if(tT(Bt,xi)){const Kt=de(xi);if(!nT(Kt))if(iT(xi))lx(xi,xi.init,de);else throw new Error("no atom init");return q_(Kt)}const Ei=ve(xi);try{return q_(Ei)}finally{vt.d.set(xi,Ei.n),rT(vt.v)&&A3(Bt,vt.v,Ei),($t=p.get(xi))==null||$t.t.add(Bt),Jt||Ht()}};let Li,Dt;const Ci={get signal(){return Li||(Li=new AbortController),Li.signal},get setSelf(){return(vg?"production":void 0)!=="production"&&!ax(Bt)&&console.warn("setSelf function cannot be used with read-only atom"),!Dt&&ax(Bt)&&(Dt=(...xi)=>{if((vg?"production":void 0)!=="production"&&Jt&&console.warn("setSelf function cannot be called in sync"),!Jt)try{return ze(Bt,...xi)}finally{Se(),Pe()}}),Dt}},yi=vt.n;try{const xi=r(Bt,Nt,Ci);return lx(Bt,xi,de),fy(xi)&&(C3(xi,()=>Li==null?void 0:Li.abort()),xi.then(Ht,Ht)),vt}catch(xi){return delete vt.v,vt.e=xi,++vt.n,vt}finally{Jt=!1,yi!==vt.n&&y.get(Bt)===yi&&(y.set(Bt,vt.n),b.add(Bt),(Yt=D.c)==null||Yt.call(D,Bt))}}),ce=se[4]||(Bt=>{const Yt=[Bt];for(;Yt.length;){const vt=Yt.pop(),Jt=de(vt);for(const Ht of sT(vt,Jt,p)){const Nt=de(Ht);y.set(Ht,Nt.n),Yt.push(Ht)}}}),ze=se[5]||((Bt,...Yt)=>{let vt=!0;const Jt=Nt=>q_(ve(Nt)),Ht=(Nt,...Li)=>{var Dt;const Ci=de(Nt);try{if(tT(Bt,Nt)){if(!iT(Nt))throw new Error("atom not writable");const yi=Ci.n,xi=Li[0];lx(Nt,xi,de),et(Nt),yi!==Ci.n&&(b.add(Nt),(Dt=D.c)==null||Dt.call(D,Nt),ce(Nt));return}else return ze(Nt,...Li)}finally{vt||(Se(),Pe())}};try{return U(Bt,Jt,Ht,...Yt)}finally{vt=!1}}),et=se[6]||(Bt=>{var Yt;const vt=de(Bt),Jt=p.get(Bt);if(Jt&&!rT(vt.v)){for(const[Ht,Nt]of vt.d)if(!Jt.d.has(Ht)){const Li=de(Ht);pt(Ht).t.add(Bt),Jt.d.add(Ht),Nt!==Li.n&&(b.add(Ht),(Yt=D.c)==null||Yt.call(D,Ht),ce(Ht))}for(const Ht of Jt.d||[])if(!vt.d.has(Ht)){Jt.d.delete(Ht);const Nt=Tt(Ht);Nt==null||Nt.t.delete(Bt)}}}),pt=se[7]||(Bt=>{var Yt;const vt=de(Bt);let Jt=p.get(Bt);if(!Jt){ve(Bt);for(const Ht of vt.d.keys())pt(Ht).t.add(Bt);if(Jt={l:new Set,d:new Set(vt.d.keys()),t:new Set},p.set(Bt,Jt),(Yt=D.m)==null||Yt.call(D,Bt),ax(Bt)){const Ht=()=>{let Nt=!0;const Li=(...Dt)=>{try{return ze(Bt,...Dt)}finally{Nt||(Se(),Pe())}};try{const Dt=Q(Bt,Li);Dt&&(Jt.u=()=>{Nt=!0;try{Dt()}finally{Nt=!1}})}finally{Nt=!1}};C.add(Ht)}}return Jt}),Tt=se[8]||(Bt=>{var Yt;const vt=de(Bt);let Jt=p.get(Bt);if(Jt&&!Jt.l.size&&!Array.from(Jt.t).some(Ht=>{var Nt;return(Nt=p.get(Ht))==null?void 0:Nt.d.has(Bt)})){Jt.u&&M.add(Jt.u),Jt=void 0,p.delete(Bt),(Yt=D.u)==null||Yt.call(D,Bt);for(const Ht of vt.d.keys()){const Nt=Tt(Ht);Nt==null||Nt.t.delete(Bt)}return}return Jt}),It=[u,p,y,b,C,M,D,r,U,G,Q,de,Pe,Se,ve,ce,ze,et,pt,Tt],di={get:Bt=>q_(ve(Bt)),set:(Bt,...Yt)=>{try{return ze(Bt,...Yt)}finally{Se(),Pe()}},sub:(Bt,Yt)=>{const Jt=pt(Bt).l;return Jt.add(Yt),Pe(),()=>{Jt.delete(Yt),Tt(Bt),Pe()}}};return Object.defineProperty(di,u5,{value:It}),di},I3=h5,d5=c5,oT=C3,wv={};let f5=0;function yr(u,p){const y=`atom${++f5}`,b={toString(){return(wv?"production":void 0)!=="production"&&this.debugLabel?y+":"+this.debugLabel:y}};return typeof u=="function"?b.read=u:(b.init=u,b.read=p5,b.write=m5),p&&(b.write=p),b}function p5(u){return u(this)}function m5(u,p,y){return p(this,typeof y=="function"?y(u(this)):y)}const g5=()=>{let u=0;const p=d5({}),y=new WeakMap,b=new WeakMap,C=I3(y,b,void 0,void 0,void 0,void 0,p,void 0,(r,U,G,...Q)=>u?G(r,...Q):r.write(U,G,...Q)),M=new Set;return p.m.add(void 0,r=>{M.add(r);const U=y.get(r);U.m=b.get(r)}),p.u.add(void 0,r=>{M.delete(r);const U=y.get(r);delete U.m}),Object.assign(C,{dev4_get_internal_weak_map:()=>(console.log("Deprecated: Use devstore from the devtools library"),y),dev4_get_mounted_atoms:()=>M,dev4_restore_atoms:r=>{const U={read:()=>null,write:(G,Q)=>{++u;try{for(const[se,de]of r)"init"in se&&Q(se,de)}finally{--u}}};C.set(U)}})};function _5(){return(wv?"production":void 0)!=="production"?g5():I3()}let mg;function y5(){return mg||(mg=_5(),(wv?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=mg),globalThis.__JOTAI_DEFAULT_STORE__!==mg&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),mg}const bv={},x5=Symbol((bv?"production":void 0)!=="production"?"RESET":""),P3=u=>typeof(u==null?void 0:u.then)=="function";function v5(u=()=>{try{return window.localStorage}catch(y){(bv?"production":void 0)!=="production"&&typeof window<"u"&&console.warn(y);return}},p){var y;let b,C;const M={getItem:(U,G)=>{var Q,se;const de=Se=>{if(Se=Se||"",b!==Se){try{C=JSON.parse(Se,p==null?void 0:p.reviver)}catch{return G}b=Se}return C},Pe=(se=(Q=u())==null?void 0:Q.getItem(U))!=null?se:null;return P3(Pe)?Pe.then(de):de(Pe)},setItem:(U,G)=>{var Q;return(Q=u())==null?void 0:Q.setItem(U,JSON.stringify(G,void 0))},removeItem:U=>{var G;return(G=u())==null?void 0:G.removeItem(U)}},D=U=>(G,Q,se)=>U(G,de=>{let Pe;try{Pe=JSON.parse(de||"")}catch{Pe=se}Q(Pe)});let r;try{r=(y=u())==null?void 0:y.subscribe}catch{}return!r&&typeof window<"u"&&typeof window.addEventListener=="function"&&window.Storage&&(r=(U,G)=>{if(!(u()instanceof window.Storage))return()=>{};const Q=se=>{se.storageArea===u()&&se.key===U&&G(se.newValue)};return window.addEventListener("storage",Q),()=>{window.removeEventListener("storage",Q)}}),r&&(M.subscribe=D(r)),M}const w5=v5();function bf(u,p,y=w5,b){const C=yr(p);return(bv?"production":void 0)!=="production"&&(C.debugPrivate=!0),C.onMount=D=>{D(y.getItem(u,p));let r;return y.subscribe&&(r=y.subscribe(u,D,p)),r},yr(D=>D(C),(D,r,U)=>{const G=typeof U=="function"?U(D(C)):U;return G===x5?(r(C,p),y.removeItem(u)):P3(G)?G.then(Q=>(r(C,Q),y.setItem(u,Q))):(r(C,G),y.setItem(u,G))})}const b5={},T5=Fe.createContext(void 0);function M3(u){return Fe.useContext(T5)||y5()}const Ox=u=>typeof(u==null?void 0:u.then)=="function",Nx=u=>{u.status||(u.status="pending",u.then(p=>{u.status="fulfilled",u.value=p},p=>{u.status="rejected",u.reason=p}))},S5=Eg.use||(u=>{if(u.status==="pending")throw u;if(u.status==="fulfilled")return u.value;throw u.status==="rejected"?u.reason:(Nx(u),u)}),ux=new WeakMap,aT=(u,p)=>{let y=ux.get(u);return y||(y=new Promise((b,C)=>{let M=u;const D=G=>Q=>{M===G&&b(Q)},r=G=>Q=>{M===G&&C(Q)},U=()=>{try{const G=p();Ox(G)?(ux.set(G,y),M=G,G.then(D(G),r(G)),oT(G,U)):b(G)}catch(G){C(G)}};u.then(D(u),r(u)),oT(u,U)}),ux.set(u,y)),y};function E5(u,p){const{delay:y,unstable_promiseStatus:b=!Eg.use}={},C=M3(),[[M,D,r],U]=Fe.useReducer(Q=>{const se=C.get(u);return Object.is(Q[0],se)&&Q[1]===C&&Q[2]===u?Q:[se,C,u]},void 0,()=>[C.get(u),C,u]);let G=M;if((D!==C||r!==u)&&(U(),G=C.get(u)),Fe.useEffect(()=>{const Q=C.sub(u,()=>{if(b)try{const se=C.get(u);Ox(se)&&Nx(aT(se,()=>C.get(u)))}catch{}if(typeof y=="number"){setTimeout(U,y);return}U()});return U(),Q},[C,u,y,b]),Fe.useDebugValue(G),Ox(G)){const Q=aT(G,()=>C.get(u));return b&&Nx(Q),S5(Q)}return G}function C5(u,p){const y=M3();return Fe.useCallback((...C)=>{if((b5?"production":void 0)!=="production"&&!("write"in u))throw new Error("not writable atom");return y.set(u,...C)},[y,u])}function Nn(u,p){return[E5(u),C5(u)]}const A5=bf("bg-kind","mini-grid"),I5=bf("theme","light"),P5=({children:u})=>{let p="";const[y]=Nn(A5);switch(y){case"grid":p=" dark:bg-grid-white/[0.2] bg-grid-black/[0.2]";break;case"mini-grid":p="dark:bg-grid-small-white/[0.2] bg-grid-small-black/[0.3] ";break;case"dot":p="dark:bg-dot-white/[0.2] bg-dot-black/[0.4] ";break;default:p="dark:bg-grid-white/[0.2] bg-grid-black/[0.2]";break}return V.jsx("div",{className:`relative h-full w-full bg-white dark:bg-black ${p} relative flex items-center justify-center`,children:u})};let M5={data:""},R5=u=>typeof window=="object"?((u?u.querySelector("#_goober"):window._goober)||Object.assign((u||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:u||M5,k5=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,D5=/\/\*[^]*?\*\/|  +/g,lT=/\n+/g,xf=(u,p)=>{let y="",b="",C="";for(let M in u){let D=u[M];M[0]=="@"?M[1]=="i"?y=M+" "+D+";":b+=M[1]=="f"?xf(D,M):M+"{"+xf(D,M[1]=="k"?"":p)+"}":typeof D=="object"?b+=xf(D,p?p.replace(/([^,])+/g,r=>M.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,U=>/&/.test(U)?U.replace(/&/g,r):r?r+" "+U:U)):M):D!=null&&(M=/^--/.test(M)?M:M.replace(/[A-Z]/g,"-$&").toLowerCase(),C+=xf.p?xf.p(M,D):M+":"+D+";")}return y+(p&&C?p+"{"+C+"}":C)+b},rd={},R3=u=>{if(typeof u=="object"){let p="";for(let y in u)p+=y+R3(u[y]);return p}return u},L5=(u,p,y,b,C)=>{let M=R3(u),D=rd[M]||(rd[M]=(U=>{let G=0,Q=11;for(;G<U.length;)Q=101*Q+U.charCodeAt(G++)>>>0;return"go"+Q})(M));if(!rd[D]){let U=M!==u?u:(G=>{let Q,se,de=[{}];for(;Q=k5.exec(G.replace(D5,""));)Q[4]?de.shift():Q[3]?(se=Q[3].replace(lT," ").trim(),de.unshift(de[0][se]=de[0][se]||{})):de[0][Q[1]]=Q[2].replace(lT," ").trim();return de[0]})(u);rd[D]=xf(C?{["@keyframes "+D]:U}:U,y?"":"."+D)}let r=y&&rd.g?rd.g:null;return y&&(rd.g=rd[D]),((U,G,Q,se)=>{se?G.data=G.data.replace(se,U):G.data.indexOf(U)===-1&&(G.data=Q?U+G.data:G.data+U)})(rd[D],p,b,r),D},z5=(u,p,y)=>u.reduce((b,C,M)=>{let D=p[M];if(D&&D.call){let r=D(y),U=r&&r.props&&r.props.className||/^go/.test(r)&&r;D=U?"."+U:r&&typeof r=="object"?r.props?"":xf(r,""):r===!1?"":r}return b+C+(D??"")},"");function Cy(u){let p=this||{},y=u.call?u(p.p):u;return L5(y.unshift?y.raw?z5(y,[].slice.call(arguments,1),p.p):y.reduce((b,C)=>Object.assign(b,C&&C.call?C(p.p):C),{}):y,R5(p.target),p.g,p.o,p.k)}let k3,Bx,jx;Cy.bind({g:1});let ud=Cy.bind({k:1});function F5(u,p,y,b){xf.p=p,k3=u,Bx=y,jx=b}function Tf(u,p){let y=this||{};return function(){let b=arguments;function C(M,D){let r=Object.assign({},M),U=r.className||C.className;y.p=Object.assign({theme:Bx&&Bx()},r),y.o=/ *go\d+/.test(U),r.className=Cy.apply(y,b)+(U?" "+U:"");let G=u;return u[0]&&(G=r.as||u,delete r.as),jx&&G[0]&&jx(r),k3(G,r)}return C}}var O5=u=>typeof u=="function",py=(u,p)=>O5(u)?u(p):u,N5=(()=>{let u=0;return()=>(++u).toString()})(),D3=(()=>{let u;return()=>{if(u===void 0&&typeof window<"u"){let p=matchMedia("(prefers-reduced-motion: reduce)");u=!p||p.matches}return u}})(),B5=20,L3=(u,p)=>{switch(p.type){case 0:return{...u,toasts:[p.toast,...u.toasts].slice(0,B5)};case 1:return{...u,toasts:u.toasts.map(M=>M.id===p.toast.id?{...M,...p.toast}:M)};case 2:let{toast:y}=p;return L3(u,{type:u.toasts.find(M=>M.id===y.id)?1:0,toast:y});case 3:let{toastId:b}=p;return{...u,toasts:u.toasts.map(M=>M.id===b||b===void 0?{...M,dismissed:!0,visible:!1}:M)};case 4:return p.toastId===void 0?{...u,toasts:[]}:{...u,toasts:u.toasts.filter(M=>M.id!==p.toastId)};case 5:return{...u,pausedAt:p.time};case 6:let C=p.time-(u.pausedAt||0);return{...u,pausedAt:void 0,toasts:u.toasts.map(M=>({...M,pauseDuration:M.pauseDuration+C}))}}},iy=[],mp={toasts:[],pausedAt:void 0},bp=u=>{mp=L3(mp,u),iy.forEach(p=>{p(mp)})},j5={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},V5=(u={})=>{let[p,y]=Fe.useState(mp),b=Fe.useRef(mp);Fe.useEffect(()=>(b.current!==mp&&y(mp),iy.push(y),()=>{let M=iy.indexOf(y);M>-1&&iy.splice(M,1)}),[]);let C=p.toasts.map(M=>{var D,r,U;return{...u,...u[M.type],...M,removeDelay:M.removeDelay||((D=u[M.type])==null?void 0:D.removeDelay)||(u==null?void 0:u.removeDelay),duration:M.duration||((r=u[M.type])==null?void 0:r.duration)||(u==null?void 0:u.duration)||j5[M.type],style:{...u.style,...(U=u[M.type])==null?void 0:U.style,...M.style}}});return{...p,toasts:C}},U5=(u,p="blank",y)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:p,ariaProps:{role:"status","aria-live":"polite"},message:u,pauseDuration:0,...y,id:(y==null?void 0:y.id)||N5()}),$g=u=>(p,y)=>{let b=U5(p,u,y);return bp({type:2,toast:b}),b.id},ga=(u,p)=>$g("blank")(u,p);ga.error=$g("error");ga.success=$g("success");ga.loading=$g("loading");ga.custom=$g("custom");ga.dismiss=u=>{bp({type:3,toastId:u})};ga.remove=u=>bp({type:4,toastId:u});ga.promise=(u,p,y)=>{let b=ga.loading(p.loading,{...y,...y==null?void 0:y.loading});return typeof u=="function"&&(u=u()),u.then(C=>{let M=p.success?py(p.success,C):void 0;return M?ga.success(M,{id:b,...y,...y==null?void 0:y.success}):ga.dismiss(b),C}).catch(C=>{let M=p.error?py(p.error,C):void 0;M?ga.error(M,{id:b,...y,...y==null?void 0:y.error}):ga.dismiss(b)}),u};var G5=(u,p)=>{bp({type:1,toast:{id:u,height:p}})},$5=()=>{bp({type:5,time:Date.now()})},Cg=new Map,H5=1e3,W5=(u,p=H5)=>{if(Cg.has(u))return;let y=setTimeout(()=>{Cg.delete(u),bp({type:4,toastId:u})},p);Cg.set(u,y)},q5=u=>{let{toasts:p,pausedAt:y}=V5(u);Fe.useEffect(()=>{if(y)return;let M=Date.now(),D=p.map(r=>{if(r.duration===1/0)return;let U=(r.duration||0)+r.pauseDuration-(M-r.createdAt);if(U<0){r.visible&&ga.dismiss(r.id);return}return setTimeout(()=>ga.dismiss(r.id),U)});return()=>{D.forEach(r=>r&&clearTimeout(r))}},[p,y]);let b=Fe.useCallback(()=>{y&&bp({type:6,time:Date.now()})},[y]),C=Fe.useCallback((M,D)=>{let{reverseOrder:r=!1,gutter:U=8,defaultPosition:G}=D||{},Q=p.filter(Pe=>(Pe.position||G)===(M.position||G)&&Pe.height),se=Q.findIndex(Pe=>Pe.id===M.id),de=Q.filter((Pe,Se)=>Se<se&&Pe.visible).length;return Q.filter(Pe=>Pe.visible).slice(...r?[de+1]:[0,de]).reduce((Pe,Se)=>Pe+(Se.height||0)+U,0)},[p]);return Fe.useEffect(()=>{p.forEach(M=>{if(M.dismissed)W5(M.id,M.removeDelay);else{let D=Cg.get(M.id);D&&(clearTimeout(D),Cg.delete(M.id))}})},[p]),{toasts:p,handlers:{updateHeight:G5,startPause:$5,endPause:b,calculateOffset:C}}},Z5=ud`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,X5=ud`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Y5=ud`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,K5=Tf("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${u=>u.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Z5} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${X5} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${u=>u.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Y5} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,J5=ud`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Q5=Tf("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${u=>u.secondary||"#e0e0e0"};
  border-right-color: ${u=>u.primary||"#616161"};
  animation: ${J5} 1s linear infinite;
`,eR=ud`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,tR=ud`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,iR=Tf("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${u=>u.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${eR} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${tR} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${u=>u.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,nR=Tf("div")`
  position: absolute;
`,rR=Tf("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,sR=ud`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,oR=Tf("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${sR} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,aR=({toast:u})=>{let{icon:p,type:y,iconTheme:b}=u;return p!==void 0?typeof p=="string"?Fe.createElement(oR,null,p):p:y==="blank"?null:Fe.createElement(rR,null,Fe.createElement(Q5,{...b}),y!=="loading"&&Fe.createElement(nR,null,y==="error"?Fe.createElement(K5,{...b}):Fe.createElement(iR,{...b})))},lR=u=>`
0% {transform: translate3d(0,${u*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,cR=u=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${u*-150}%,-1px) scale(.6); opacity:0;}
`,uR="0%{opacity:0;} 100%{opacity:1;}",hR="0%{opacity:1;} 100%{opacity:0;}",dR=Tf("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,fR=Tf("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,pR=(u,p)=>{let y=u.includes("top")?1:-1,[b,C]=D3()?[uR,hR]:[lR(y),cR(y)];return{animation:p?`${ud(b)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${ud(C)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},mR=Fe.memo(({toast:u,position:p,style:y,children:b})=>{let C=u.height?pR(u.position||p||"top-center",u.visible):{opacity:0},M=Fe.createElement(aR,{toast:u}),D=Fe.createElement(fR,{...u.ariaProps},py(u.message,u));return Fe.createElement(dR,{className:u.className,style:{...C,...y,...u.style}},typeof b=="function"?b({icon:M,message:D}):Fe.createElement(Fe.Fragment,null,M,D))});F5(Fe.createElement);var gR=({id:u,className:p,style:y,onHeightUpdate:b,children:C})=>{let M=Fe.useCallback(D=>{if(D){let r=()=>{let U=D.getBoundingClientRect().height;b(u,U)};r(),new MutationObserver(r).observe(D,{subtree:!0,childList:!0,characterData:!0})}},[u,b]);return Fe.createElement("div",{ref:M,className:p,style:y},C)},_R=(u,p)=>{let y=u.includes("top"),b=y?{top:0}:{bottom:0},C=u.includes("center")?{justifyContent:"center"}:u.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:D3()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${p*(y?1:-1)}px)`,...b,...C}},yR=Cy`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Z_=16,cT=({reverseOrder:u,position:p="top-center",toastOptions:y,gutter:b,children:C,containerStyle:M,containerClassName:D})=>{let{toasts:r,handlers:U}=q5(y);return Fe.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:Z_,left:Z_,right:Z_,bottom:Z_,pointerEvents:"none",...M},className:D,onMouseEnter:U.startPause,onMouseLeave:U.endPause},r.map(G=>{let Q=G.position||p,se=U.calculateOffset(G,{reverseOrder:u,gutter:b,defaultPosition:p}),de=_R(Q,se);return Fe.createElement(gR,{id:G.id,key:G.id,onHeightUpdate:U.updateHeight,className:G.visible?yR:"",style:de},G.type==="custom"?py(G.message,G):C?C(G):Fe.createElement(mR,{toast:G,position:Q}))}))},Dn=ga;function z3(u){var p,y,b="";if(typeof u=="string"||typeof u=="number")b+=u;else if(typeof u=="object")if(Array.isArray(u)){var C=u.length;for(p=0;p<C;p++)u[p]&&(y=z3(u[p]))&&(b&&(b+=" "),b+=y)}else for(y in u)u[y]&&(b&&(b+=" "),b+=y);return b}function F3(){for(var u,p,y=0,b="",C=arguments.length;y<C;y++)(u=arguments[y])&&(p=z3(u))&&(b&&(b+=" "),b+=p);return b}const Tv="-",xR=u=>{const p=wR(u),{conflictingClassGroups:y,conflictingClassGroupModifiers:b}=u;return{getClassGroupId:D=>{const r=D.split(Tv);return r[0]===""&&r.length!==1&&r.shift(),O3(r,p)||vR(D)},getConflictingClassGroupIds:(D,r)=>{const U=y[D]||[];return r&&b[D]?[...U,...b[D]]:U}}},O3=(u,p)=>{var D;if(u.length===0)return p.classGroupId;const y=u[0],b=p.nextPart.get(y),C=b?O3(u.slice(1),b):void 0;if(C)return C;if(p.validators.length===0)return;const M=u.join(Tv);return(D=p.validators.find(({validator:r})=>r(M)))==null?void 0:D.classGroupId},uT=/^\[(.+)\]$/,vR=u=>{if(uT.test(u)){const p=uT.exec(u)[1],y=p==null?void 0:p.substring(0,p.indexOf(":"));if(y)return"arbitrary.."+y}},wR=u=>{const{theme:p,prefix:y}=u,b={nextPart:new Map,validators:[]};return TR(Object.entries(u.classGroups),y).forEach(([M,D])=>{Vx(D,b,M,p)}),b},Vx=(u,p,y,b)=>{u.forEach(C=>{if(typeof C=="string"){const M=C===""?p:hT(p,C);M.classGroupId=y;return}if(typeof C=="function"){if(bR(C)){Vx(C(b),p,y,b);return}p.validators.push({validator:C,classGroupId:y});return}Object.entries(C).forEach(([M,D])=>{Vx(D,hT(p,M),y,b)})})},hT=(u,p)=>{let y=u;return p.split(Tv).forEach(b=>{y.nextPart.has(b)||y.nextPart.set(b,{nextPart:new Map,validators:[]}),y=y.nextPart.get(b)}),y},bR=u=>u.isThemeGetter,TR=(u,p)=>p?u.map(([y,b])=>{const C=b.map(M=>typeof M=="string"?p+M:typeof M=="object"?Object.fromEntries(Object.entries(M).map(([D,r])=>[p+D,r])):M);return[y,C]}):u,SR=u=>{if(u<1)return{get:()=>{},set:()=>{}};let p=0,y=new Map,b=new Map;const C=(M,D)=>{y.set(M,D),p++,p>u&&(p=0,b=y,y=new Map)};return{get(M){let D=y.get(M);if(D!==void 0)return D;if((D=b.get(M))!==void 0)return C(M,D),D},set(M,D){y.has(M)?y.set(M,D):C(M,D)}}},N3="!",ER=u=>{const{separator:p,experimentalParseClassName:y}=u,b=p.length===1,C=p[0],M=p.length,D=r=>{const U=[];let G=0,Q=0,se;for(let ce=0;ce<r.length;ce++){let ze=r[ce];if(G===0){if(ze===C&&(b||r.slice(ce,ce+M)===p)){U.push(r.slice(Q,ce)),Q=ce+M;continue}if(ze==="/"){se=ce;continue}}ze==="["?G++:ze==="]"&&G--}const de=U.length===0?r:r.substring(Q),Pe=de.startsWith(N3),Se=Pe?de.substring(1):de,ve=se&&se>Q?se-Q:void 0;return{modifiers:U,hasImportantModifier:Pe,baseClassName:Se,maybePostfixModifierPosition:ve}};return y?r=>y({className:r,parseClassName:D}):D},CR=u=>{if(u.length<=1)return u;const p=[];let y=[];return u.forEach(b=>{b[0]==="["?(p.push(...y.sort(),b),y=[]):y.push(b)}),p.push(...y.sort()),p},AR=u=>({cache:SR(u.cacheSize),parseClassName:ER(u),...xR(u)}),IR=/\s+/,PR=(u,p)=>{const{parseClassName:y,getClassGroupId:b,getConflictingClassGroupIds:C}=p,M=[],D=u.trim().split(IR);let r="";for(let U=D.length-1;U>=0;U-=1){const G=D[U],{modifiers:Q,hasImportantModifier:se,baseClassName:de,maybePostfixModifierPosition:Pe}=y(G);let Se=!!Pe,ve=b(Se?de.substring(0,Pe):de);if(!ve){if(!Se){r=G+(r.length>0?" "+r:r);continue}if(ve=b(de),!ve){r=G+(r.length>0?" "+r:r);continue}Se=!1}const ce=CR(Q).join(":"),ze=se?ce+N3:ce,et=ze+ve;if(M.includes(et))continue;M.push(et);const pt=C(ve,Se);for(let Tt=0;Tt<pt.length;++Tt){const It=pt[Tt];M.push(ze+It)}r=G+(r.length>0?" "+r:r)}return r};function MR(){let u=0,p,y,b="";for(;u<arguments.length;)(p=arguments[u++])&&(y=B3(p))&&(b&&(b+=" "),b+=y);return b}const B3=u=>{if(typeof u=="string")return u;let p,y="";for(let b=0;b<u.length;b++)u[b]&&(p=B3(u[b]))&&(y&&(y+=" "),y+=p);return y};function RR(u,...p){let y,b,C,M=D;function D(U){const G=p.reduce((Q,se)=>se(Q),u());return y=AR(G),b=y.cache.get,C=y.cache.set,M=r,r(U)}function r(U){const G=b(U);if(G)return G;const Q=PR(U,y);return C(U,Q),Q}return function(){return M(MR.apply(null,arguments))}}const Jr=u=>{const p=y=>y[u]||[];return p.isThemeGetter=!0,p},j3=/^\[(?:([a-z-]+):)?(.+)\]$/i,kR=/^\d+\/\d+$/,DR=new Set(["px","full","screen"]),LR=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,zR=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,FR=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,OR=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,NR=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,sd=u=>hm(u)||DR.has(u)||kR.test(u),gf=u=>xm(u,"length",WR),hm=u=>!!u&&!Number.isNaN(Number(u)),hx=u=>xm(u,"number",hm),gg=u=>!!u&&Number.isInteger(Number(u)),BR=u=>u.endsWith("%")&&hm(u.slice(0,-1)),er=u=>j3.test(u),_f=u=>LR.test(u),jR=new Set(["length","size","percentage"]),VR=u=>xm(u,jR,V3),UR=u=>xm(u,"position",V3),GR=new Set(["image","url"]),$R=u=>xm(u,GR,ZR),HR=u=>xm(u,"",qR),_g=()=>!0,xm=(u,p,y)=>{const b=j3.exec(u);return b?b[1]?typeof p=="string"?b[1]===p:p.has(b[1]):y(b[2]):!1},WR=u=>zR.test(u)&&!FR.test(u),V3=()=>!1,qR=u=>OR.test(u),ZR=u=>NR.test(u),XR=()=>{const u=Jr("colors"),p=Jr("spacing"),y=Jr("blur"),b=Jr("brightness"),C=Jr("borderColor"),M=Jr("borderRadius"),D=Jr("borderSpacing"),r=Jr("borderWidth"),U=Jr("contrast"),G=Jr("grayscale"),Q=Jr("hueRotate"),se=Jr("invert"),de=Jr("gap"),Pe=Jr("gradientColorStops"),Se=Jr("gradientColorStopPositions"),ve=Jr("inset"),ce=Jr("margin"),ze=Jr("opacity"),et=Jr("padding"),pt=Jr("saturate"),Tt=Jr("scale"),It=Jr("sepia"),di=Jr("skew"),Bt=Jr("space"),Yt=Jr("translate"),vt=()=>["auto","contain","none"],Jt=()=>["auto","hidden","clip","visible","scroll"],Ht=()=>["auto",er,p],Nt=()=>[er,p],Li=()=>["",sd,gf],Dt=()=>["auto",hm,er],Ci=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],yi=()=>["solid","dashed","dotted","double","none"],xi=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],$t=()=>["start","end","center","between","around","evenly","stretch"],Ei=()=>["","0",er],Kt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Ue=()=>[hm,er];return{cacheSize:500,separator:":",theme:{colors:[_g],spacing:[sd,gf],blur:["none","",_f,er],brightness:Ue(),borderColor:[u],borderRadius:["none","","full",_f,er],borderSpacing:Nt(),borderWidth:Li(),contrast:Ue(),grayscale:Ei(),hueRotate:Ue(),invert:Ei(),gap:Nt(),gradientColorStops:[u],gradientColorStopPositions:[BR,gf],inset:Ht(),margin:Ht(),opacity:Ue(),padding:Nt(),saturate:Ue(),scale:Ue(),sepia:Ei(),skew:Ue(),space:Nt(),translate:Nt()},classGroups:{aspect:[{aspect:["auto","square","video",er]}],container:["container"],columns:[{columns:[_f]}],"break-after":[{"break-after":Kt()}],"break-before":[{"break-before":Kt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Ci(),er]}],overflow:[{overflow:Jt()}],"overflow-x":[{"overflow-x":Jt()}],"overflow-y":[{"overflow-y":Jt()}],overscroll:[{overscroll:vt()}],"overscroll-x":[{"overscroll-x":vt()}],"overscroll-y":[{"overscroll-y":vt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[ve]}],"inset-x":[{"inset-x":[ve]}],"inset-y":[{"inset-y":[ve]}],start:[{start:[ve]}],end:[{end:[ve]}],top:[{top:[ve]}],right:[{right:[ve]}],bottom:[{bottom:[ve]}],left:[{left:[ve]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",gg,er]}],basis:[{basis:Ht()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",er]}],grow:[{grow:Ei()}],shrink:[{shrink:Ei()}],order:[{order:["first","last","none",gg,er]}],"grid-cols":[{"grid-cols":[_g]}],"col-start-end":[{col:["auto",{span:["full",gg,er]},er]}],"col-start":[{"col-start":Dt()}],"col-end":[{"col-end":Dt()}],"grid-rows":[{"grid-rows":[_g]}],"row-start-end":[{row:["auto",{span:[gg,er]},er]}],"row-start":[{"row-start":Dt()}],"row-end":[{"row-end":Dt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",er]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",er]}],gap:[{gap:[de]}],"gap-x":[{"gap-x":[de]}],"gap-y":[{"gap-y":[de]}],"justify-content":[{justify:["normal",...$t()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...$t(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...$t(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[et]}],px:[{px:[et]}],py:[{py:[et]}],ps:[{ps:[et]}],pe:[{pe:[et]}],pt:[{pt:[et]}],pr:[{pr:[et]}],pb:[{pb:[et]}],pl:[{pl:[et]}],m:[{m:[ce]}],mx:[{mx:[ce]}],my:[{my:[ce]}],ms:[{ms:[ce]}],me:[{me:[ce]}],mt:[{mt:[ce]}],mr:[{mr:[ce]}],mb:[{mb:[ce]}],ml:[{ml:[ce]}],"space-x":[{"space-x":[Bt]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Bt]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",er,p]}],"min-w":[{"min-w":[er,p,"min","max","fit"]}],"max-w":[{"max-w":[er,p,"none","full","min","max","fit","prose",{screen:[_f]},_f]}],h:[{h:[er,p,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[er,p,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[er,p,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[er,p,"auto","min","max","fit"]}],"font-size":[{text:["base",_f,gf]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",hx]}],"font-family":[{font:[_g]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",er]}],"line-clamp":[{"line-clamp":["none",hm,hx]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",sd,er]}],"list-image":[{"list-image":["none",er]}],"list-style-type":[{list:["none","disc","decimal",er]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[u]}],"placeholder-opacity":[{"placeholder-opacity":[ze]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[u]}],"text-opacity":[{"text-opacity":[ze]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...yi(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",sd,gf]}],"underline-offset":[{"underline-offset":["auto",sd,er]}],"text-decoration-color":[{decoration:[u]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Nt()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",er]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",er]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[ze]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Ci(),UR]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",VR]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},$R]}],"bg-color":[{bg:[u]}],"gradient-from-pos":[{from:[Se]}],"gradient-via-pos":[{via:[Se]}],"gradient-to-pos":[{to:[Se]}],"gradient-from":[{from:[Pe]}],"gradient-via":[{via:[Pe]}],"gradient-to":[{to:[Pe]}],rounded:[{rounded:[M]}],"rounded-s":[{"rounded-s":[M]}],"rounded-e":[{"rounded-e":[M]}],"rounded-t":[{"rounded-t":[M]}],"rounded-r":[{"rounded-r":[M]}],"rounded-b":[{"rounded-b":[M]}],"rounded-l":[{"rounded-l":[M]}],"rounded-ss":[{"rounded-ss":[M]}],"rounded-se":[{"rounded-se":[M]}],"rounded-ee":[{"rounded-ee":[M]}],"rounded-es":[{"rounded-es":[M]}],"rounded-tl":[{"rounded-tl":[M]}],"rounded-tr":[{"rounded-tr":[M]}],"rounded-br":[{"rounded-br":[M]}],"rounded-bl":[{"rounded-bl":[M]}],"border-w":[{border:[r]}],"border-w-x":[{"border-x":[r]}],"border-w-y":[{"border-y":[r]}],"border-w-s":[{"border-s":[r]}],"border-w-e":[{"border-e":[r]}],"border-w-t":[{"border-t":[r]}],"border-w-r":[{"border-r":[r]}],"border-w-b":[{"border-b":[r]}],"border-w-l":[{"border-l":[r]}],"border-opacity":[{"border-opacity":[ze]}],"border-style":[{border:[...yi(),"hidden"]}],"divide-x":[{"divide-x":[r]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[r]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[ze]}],"divide-style":[{divide:yi()}],"border-color":[{border:[C]}],"border-color-x":[{"border-x":[C]}],"border-color-y":[{"border-y":[C]}],"border-color-s":[{"border-s":[C]}],"border-color-e":[{"border-e":[C]}],"border-color-t":[{"border-t":[C]}],"border-color-r":[{"border-r":[C]}],"border-color-b":[{"border-b":[C]}],"border-color-l":[{"border-l":[C]}],"divide-color":[{divide:[C]}],"outline-style":[{outline:["",...yi()]}],"outline-offset":[{"outline-offset":[sd,er]}],"outline-w":[{outline:[sd,gf]}],"outline-color":[{outline:[u]}],"ring-w":[{ring:Li()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[u]}],"ring-opacity":[{"ring-opacity":[ze]}],"ring-offset-w":[{"ring-offset":[sd,gf]}],"ring-offset-color":[{"ring-offset":[u]}],shadow:[{shadow:["","inner","none",_f,HR]}],"shadow-color":[{shadow:[_g]}],opacity:[{opacity:[ze]}],"mix-blend":[{"mix-blend":[...xi(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":xi()}],filter:[{filter:["","none"]}],blur:[{blur:[y]}],brightness:[{brightness:[b]}],contrast:[{contrast:[U]}],"drop-shadow":[{"drop-shadow":["","none",_f,er]}],grayscale:[{grayscale:[G]}],"hue-rotate":[{"hue-rotate":[Q]}],invert:[{invert:[se]}],saturate:[{saturate:[pt]}],sepia:[{sepia:[It]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[y]}],"backdrop-brightness":[{"backdrop-brightness":[b]}],"backdrop-contrast":[{"backdrop-contrast":[U]}],"backdrop-grayscale":[{"backdrop-grayscale":[G]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Q]}],"backdrop-invert":[{"backdrop-invert":[se]}],"backdrop-opacity":[{"backdrop-opacity":[ze]}],"backdrop-saturate":[{"backdrop-saturate":[pt]}],"backdrop-sepia":[{"backdrop-sepia":[It]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[D]}],"border-spacing-x":[{"border-spacing-x":[D]}],"border-spacing-y":[{"border-spacing-y":[D]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",er]}],duration:[{duration:Ue()}],ease:[{ease:["linear","in","out","in-out",er]}],delay:[{delay:Ue()}],animate:[{animate:["none","spin","ping","pulse","bounce",er]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Tt]}],"scale-x":[{"scale-x":[Tt]}],"scale-y":[{"scale-y":[Tt]}],rotate:[{rotate:[gg,er]}],"translate-x":[{"translate-x":[Yt]}],"translate-y":[{"translate-y":[Yt]}],"skew-x":[{"skew-x":[di]}],"skew-y":[{"skew-y":[di]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",er]}],accent:[{accent:["auto",u]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",er]}],"caret-color":[{caret:[u]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Nt()}],"scroll-mx":[{"scroll-mx":Nt()}],"scroll-my":[{"scroll-my":Nt()}],"scroll-ms":[{"scroll-ms":Nt()}],"scroll-me":[{"scroll-me":Nt()}],"scroll-mt":[{"scroll-mt":Nt()}],"scroll-mr":[{"scroll-mr":Nt()}],"scroll-mb":[{"scroll-mb":Nt()}],"scroll-ml":[{"scroll-ml":Nt()}],"scroll-p":[{"scroll-p":Nt()}],"scroll-px":[{"scroll-px":Nt()}],"scroll-py":[{"scroll-py":Nt()}],"scroll-ps":[{"scroll-ps":Nt()}],"scroll-pe":[{"scroll-pe":Nt()}],"scroll-pt":[{"scroll-pt":Nt()}],"scroll-pr":[{"scroll-pr":Nt()}],"scroll-pb":[{"scroll-pb":Nt()}],"scroll-pl":[{"scroll-pl":Nt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",er]}],fill:[{fill:[u,"none"]}],"stroke-w":[{stroke:[sd,gf,hx]}],stroke:[{stroke:[u,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},YR=RR(XR);function U3(...u){return YR(F3(u))}const KR=F3,JR=(u,p)=>y=>KR(u,y==null?void 0:y.class,y==null?void 0:y.className),Sv=Fe.createContext({});function Hg(u){const p=Fe.useRef(null);return p.current===null&&(p.current=u()),p.current}const Ay=Fe.createContext(null),Wg=Fe.createContext({transformPagePoint:u=>u,isStatic:!1,reducedMotion:"never"});class QR extends Fe.Component{getSnapshotBeforeUpdate(p){const y=this.props.childRef.current;if(y&&p.isPresent&&!this.props.isPresent){const b=this.props.sizeRef.current;b.height=y.offsetHeight||0,b.width=y.offsetWidth||0,b.top=y.offsetTop,b.left=y.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function ek({children:u,isPresent:p}){const y=Fe.useId(),b=Fe.useRef(null),C=Fe.useRef({width:0,height:0,top:0,left:0}),{nonce:M}=Fe.useContext(Wg);return Fe.useInsertionEffect(()=>{const{width:D,height:r,top:U,left:G}=C.current;if(p||!b.current||!D||!r)return;b.current.dataset.motionPopId=y;const Q=document.createElement("style");return M&&(Q.nonce=M),document.head.appendChild(Q),Q.sheet&&Q.sheet.insertRule(`
          [data-motion-pop-id="${y}"] {
            position: absolute !important;
            width: ${D}px !important;
            height: ${r}px !important;
            top: ${U}px !important;
            left: ${G}px !important;
          }
        `),()=>{document.head.removeChild(Q)}},[p]),V.jsx(QR,{isPresent:p,childRef:b,sizeRef:C,children:Fe.cloneElement(u,{ref:b})})}const tk=({children:u,initial:p,isPresent:y,onExitComplete:b,custom:C,presenceAffectsLayout:M,mode:D})=>{const r=Hg(ik),U=Fe.useId(),G=Fe.useCallback(se=>{r.set(se,!0);for(const de of r.values())if(!de)return;b&&b()},[r,b]),Q=Fe.useMemo(()=>({id:U,initial:p,isPresent:y,custom:C,onExitComplete:G,register:se=>(r.set(se,!1),()=>r.delete(se))}),M?[Math.random(),G]:[y,G]);return Fe.useMemo(()=>{r.forEach((se,de)=>r.set(de,!1))},[y]),Fe.useEffect(()=>{!y&&!r.size&&b&&b()},[y]),D==="popLayout"&&(u=V.jsx(ek,{isPresent:y,children:u})),V.jsx(Ay.Provider,{value:Q,children:u})};function ik(){return new Map}function G3(u=!0){const p=Fe.useContext(Ay);if(p===null)return[!0,null];const{isPresent:y,onExitComplete:b,register:C}=p,M=Fe.useId();Fe.useEffect(()=>{u&&C(M)},[u]);const D=Fe.useCallback(()=>u&&b&&b(M),[M,b,u]);return!y&&b?[!1,D]:[!0]}const X_=u=>u.key||"";function dT(u){const p=[];return Fe.Children.forEach(u,y=>{Fe.isValidElement(y)&&p.push(y)}),p}const Ev=typeof window<"u",Iy=Ev?Fe.useLayoutEffect:Fe.useEffect,Lg=({children:u,custom:p,initial:y=!0,onExitComplete:b,presenceAffectsLayout:C=!0,mode:M="sync",propagate:D=!1})=>{const[r,U]=G3(D),G=Fe.useMemo(()=>dT(u),[u]),Q=D&&!r?[]:G.map(X_),se=Fe.useRef(!0),de=Fe.useRef(G),Pe=Hg(()=>new Map),[Se,ve]=Fe.useState(G),[ce,ze]=Fe.useState(G);Iy(()=>{se.current=!1,de.current=G;for(let Tt=0;Tt<ce.length;Tt++){const It=X_(ce[Tt]);Q.includes(It)?Pe.delete(It):Pe.get(It)!==!0&&Pe.set(It,!1)}},[ce,Q.length,Q.join("-")]);const et=[];if(G!==Se){let Tt=[...G];for(let It=0;It<ce.length;It++){const di=ce[It],Bt=X_(di);Q.includes(Bt)||(Tt.splice(It,0,di),et.push(di))}M==="wait"&&et.length&&(Tt=et),ze(dT(Tt)),ve(G);return}const{forceRender:pt}=Fe.useContext(Sv);return V.jsx(V.Fragment,{children:ce.map(Tt=>{const It=X_(Tt),di=D&&!r?!1:G===ce||Q.includes(It),Bt=()=>{if(Pe.has(It))Pe.set(It,!0);else return;let Yt=!0;Pe.forEach(vt=>{vt||(Yt=!1)}),Yt&&(pt==null||pt(),ze(de.current),D&&(U==null||U()),b&&b())};return V.jsx(tk,{isPresent:di,initial:!se.current||y?void 0:!1,custom:di?void 0:p,presenceAffectsLayout:C,mode:M,onExitComplete:di?void 0:Bt,children:Tt},It)})})},El=u=>u;let $3=El;function Cv(u){let p;return()=>(p===void 0&&(p=u()),p)}const dm=(u,p,y)=>{const b=p-u;return b===0?1:(y-u)/b},ad=u=>u*1e3,ld=u=>u/1e3,nk={useManualTiming:!1};function rk(u){let p=new Set,y=new Set,b=!1,C=!1;const M=new WeakSet;let D={delta:0,timestamp:0,isProcessing:!1};function r(G){M.has(G)&&(U.schedule(G),u()),G(D)}const U={schedule:(G,Q=!1,se=!1)=>{const Pe=se&&b?p:y;return Q&&M.add(G),Pe.has(G)||Pe.add(G),G},cancel:G=>{y.delete(G),M.delete(G)},process:G=>{if(D=G,b){C=!0;return}b=!0,[p,y]=[y,p],p.forEach(r),p.clear(),b=!1,C&&(C=!1,U.process(G))}};return U}const Y_=["read","resolveKeyframes","update","preRender","render","postRender"],sk=40;function H3(u,p){let y=!1,b=!0;const C={delta:0,timestamp:0,isProcessing:!1},M=()=>y=!0,D=Y_.reduce((ze,et)=>(ze[et]=rk(M),ze),{}),{read:r,resolveKeyframes:U,update:G,preRender:Q,render:se,postRender:de}=D,Pe=()=>{const ze=performance.now();y=!1,C.delta=b?1e3/60:Math.max(Math.min(ze-C.timestamp,sk),1),C.timestamp=ze,C.isProcessing=!0,r.process(C),U.process(C),G.process(C),Q.process(C),se.process(C),de.process(C),C.isProcessing=!1,y&&p&&(b=!1,u(Pe))},Se=()=>{y=!0,b=!0,C.isProcessing||u(Pe)};return{schedule:Y_.reduce((ze,et)=>{const pt=D[et];return ze[et]=(Tt,It=!1,di=!1)=>(y||Se(),pt.schedule(Tt,It,di)),ze},{}),cancel:ze=>{for(let et=0;et<Y_.length;et++)D[Y_[et]].cancel(ze)},state:C,steps:D}}const{schedule:jr,cancel:hd,state:Mo,steps:dx}=H3(typeof requestAnimationFrame<"u"?requestAnimationFrame:El,!0),W3=Fe.createContext({strict:!1}),fT={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},fm={};for(const u in fT)fm[u]={isEnabled:p=>fT[u].some(y=>!!p[y])};function ok(u){for(const p in u)fm[p]={...fm[p],...u[p]}}const ak=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function my(u){return u.startsWith("while")||u.startsWith("drag")&&u!=="draggable"||u.startsWith("layout")||u.startsWith("onTap")||u.startsWith("onPan")||u.startsWith("onLayout")||ak.has(u)}let q3=u=>!my(u);function lk(u){u&&(q3=p=>p.startsWith("on")?!my(p):u(p))}try{lk(require("@emotion/is-prop-valid").default)}catch{}function ck(u,p,y){const b={};for(const C in u)C==="values"&&typeof u.values=="object"||(q3(C)||y===!0&&my(C)||!p&&!my(C)||u.draggable&&C.startsWith("onDrag"))&&(b[C]=u[C]);return b}function uk(u){if(typeof Proxy>"u")return u;const p=new Map,y=(...b)=>u(...b);return new Proxy(y,{get:(b,C)=>C==="create"?u:(p.has(C)||p.set(C,u(C)),p.get(C))})}const Py=Fe.createContext({});function zg(u){return typeof u=="string"||Array.isArray(u)}function My(u){return u!==null&&typeof u=="object"&&typeof u.start=="function"}const Av=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Iv=["initial",...Av];function Ry(u){return My(u.animate)||Iv.some(p=>zg(u[p]))}function Z3(u){return!!(Ry(u)||u.variants)}function hk(u,p){if(Ry(u)){const{initial:y,animate:b}=u;return{initial:y===!1||zg(y)?y:void 0,animate:zg(b)?b:void 0}}return u.inherit!==!1?p:{}}function dk(u){const{initial:p,animate:y}=hk(u,Fe.useContext(Py));return Fe.useMemo(()=>({initial:p,animate:y}),[pT(p),pT(y)])}function pT(u){return Array.isArray(u)?u.join(" "):u}const fk=Symbol.for("motionComponentSymbol");function om(u){return u&&typeof u=="object"&&Object.prototype.hasOwnProperty.call(u,"current")}function pk(u,p,y){return Fe.useCallback(b=>{b&&u.onMount&&u.onMount(b),p&&(b?p.mount(b):p.unmount()),y&&(typeof y=="function"?y(b):om(y)&&(y.current=b))},[p])}const Pv=u=>u.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),mk="framerAppearId",X3="data-"+Pv(mk),{schedule:Mv}=H3(queueMicrotask,!1),Y3=Fe.createContext({});function gk(u,p,y,b,C){var M,D;const{visualElement:r}=Fe.useContext(Py),U=Fe.useContext(W3),G=Fe.useContext(Ay),Q=Fe.useContext(Wg).reducedMotion,se=Fe.useRef(null);b=b||U.renderer,!se.current&&b&&(se.current=b(u,{visualState:p,parent:r,props:y,presenceContext:G,blockInitialAnimation:G?G.initial===!1:!1,reducedMotionConfig:Q}));const de=se.current,Pe=Fe.useContext(Y3);de&&!de.projection&&C&&(de.type==="html"||de.type==="svg")&&_k(se.current,y,C,Pe);const Se=Fe.useRef(!1);Fe.useInsertionEffect(()=>{de&&Se.current&&de.update(y,G)});const ve=y[X3],ce=Fe.useRef(!!ve&&!(!((M=window.MotionHandoffIsComplete)===null||M===void 0)&&M.call(window,ve))&&((D=window.MotionHasOptimisedAnimation)===null||D===void 0?void 0:D.call(window,ve)));return Iy(()=>{de&&(Se.current=!0,window.MotionIsMounted=!0,de.updateFeatures(),Mv.render(de.render),ce.current&&de.animationState&&de.animationState.animateChanges())}),Fe.useEffect(()=>{de&&(!ce.current&&de.animationState&&de.animationState.animateChanges(),ce.current&&(queueMicrotask(()=>{var ze;(ze=window.MotionHandoffMarkAsComplete)===null||ze===void 0||ze.call(window,ve)}),ce.current=!1))}),de}function _k(u,p,y,b){const{layoutId:C,layout:M,drag:D,dragConstraints:r,layoutScroll:U,layoutRoot:G}=p;u.projection=new y(u.latestValues,p["data-framer-portal-id"]?void 0:K3(u.parent)),u.projection.setOptions({layoutId:C,layout:M,alwaysMeasureLayout:!!D||r&&om(r),visualElement:u,animationType:typeof M=="string"?M:"both",initialPromotionConfig:b,layoutScroll:U,layoutRoot:G})}function K3(u){if(u)return u.options.allowProjection!==!1?u.projection:K3(u.parent)}function yk({preloadedFeatures:u,createVisualElement:p,useRender:y,useVisualState:b,Component:C}){var M,D;u&&ok(u);function r(G,Q){let se;const de={...Fe.useContext(Wg),...G,layoutId:xk(G)},{isStatic:Pe}=de,Se=dk(G),ve=b(G,Pe);if(!Pe&&Ev){vk();const ce=wk(de);se=ce.MeasureLayout,Se.visualElement=gk(C,ve,de,p,ce.ProjectionNode)}return V.jsxs(Py.Provider,{value:Se,children:[se&&Se.visualElement?V.jsx(se,{visualElement:Se.visualElement,...de}):null,y(C,G,pk(ve,Se.visualElement,Q),ve,Pe,Se.visualElement)]})}r.displayName=`motion.${typeof C=="string"?C:`create(${(D=(M=C.displayName)!==null&&M!==void 0?M:C.name)!==null&&D!==void 0?D:""})`}`;const U=Fe.forwardRef(r);return U[fk]=C,U}function xk({layoutId:u}){const p=Fe.useContext(Sv).id;return p&&u!==void 0?p+"-"+u:u}function vk(u,p){Fe.useContext(W3).strict}function wk(u){const{drag:p,layout:y}=fm;if(!p&&!y)return{};const b={...p,...y};return{MeasureLayout:p!=null&&p.isEnabled(u)||y!=null&&y.isEnabled(u)?b.MeasureLayout:void 0,ProjectionNode:b.ProjectionNode}}const bk=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Rv(u){return typeof u!="string"||u.includes("-")?!1:!!(bk.indexOf(u)>-1||/[A-Z]/u.test(u))}function mT(u){const p=[{},{}];return u==null||u.values.forEach((y,b)=>{p[0][b]=y.get(),p[1][b]=y.getVelocity()}),p}function kv(u,p,y,b){if(typeof p=="function"){const[C,M]=mT(b);p=p(y!==void 0?y:u.custom,C,M)}if(typeof p=="string"&&(p=u.variants&&u.variants[p]),typeof p=="function"){const[C,M]=mT(b);p=p(y!==void 0?y:u.custom,C,M)}return p}const Ux=u=>Array.isArray(u),Tk=u=>!!(u&&typeof u=="object"&&u.mix&&u.toValue),Sk=u=>Ux(u)?u[u.length-1]||0:u,Ro=u=>!!(u&&u.getVelocity);function ny(u){const p=Ro(u)?u.get():u;return Tk(p)?p.toValue():p}function Ek({scrapeMotionValuesFromProps:u,createRenderState:p,onUpdate:y},b,C,M){const D={latestValues:Ck(b,C,M,u),renderState:p()};return y&&(D.onMount=r=>y({props:b,current:r,...D}),D.onUpdate=r=>y(r)),D}const J3=u=>(p,y)=>{const b=Fe.useContext(Py),C=Fe.useContext(Ay),M=()=>Ek(u,p,b,C);return y?M():Hg(M)};function Ck(u,p,y,b){const C={},M=b(u,{});for(const de in M)C[de]=ny(M[de]);let{initial:D,animate:r}=u;const U=Ry(u),G=Z3(u);p&&G&&!U&&u.inherit!==!1&&(D===void 0&&(D=p.initial),r===void 0&&(r=p.animate));let Q=y?y.initial===!1:!1;Q=Q||D===!1;const se=Q?r:D;if(se&&typeof se!="boolean"&&!My(se)){const de=Array.isArray(se)?se:[se];for(let Pe=0;Pe<de.length;Pe++){const Se=kv(u,de[Pe]);if(Se){const{transitionEnd:ve,transition:ce,...ze}=Se;for(const et in ze){let pt=ze[et];if(Array.isArray(pt)){const Tt=Q?pt.length-1:0;pt=pt[Tt]}pt!==null&&(C[et]=pt)}for(const et in ve)C[et]=ve[et]}}}return C}const vm=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Tp=new Set(vm),Q3=u=>p=>typeof p=="string"&&p.startsWith(u),eE=Q3("--"),Ak=Q3("var(--"),Dv=u=>Ak(u)?Ik.test(u.split("/*")[0].trim()):!1,Ik=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,tE=(u,p)=>p&&typeof u=="number"?p.transform(u):u,dd=(u,p,y)=>y>p?p:y<u?u:y,wm={test:u=>typeof u=="number",parse:parseFloat,transform:u=>u},Fg={...wm,transform:u=>dd(0,1,u)},K_={...wm,default:1},qg=u=>({test:p=>typeof p=="string"&&p.endsWith(u)&&p.split(" ").length===1,parse:parseFloat,transform:p=>`${p}${u}`}),yf=qg("deg"),lh=qg("%"),Cn=qg("px"),Pk=qg("vh"),Mk=qg("vw"),gT={...lh,parse:u=>lh.parse(u)/100,transform:u=>lh.transform(u*100)},Rk={borderWidth:Cn,borderTopWidth:Cn,borderRightWidth:Cn,borderBottomWidth:Cn,borderLeftWidth:Cn,borderRadius:Cn,radius:Cn,borderTopLeftRadius:Cn,borderTopRightRadius:Cn,borderBottomRightRadius:Cn,borderBottomLeftRadius:Cn,width:Cn,maxWidth:Cn,height:Cn,maxHeight:Cn,top:Cn,right:Cn,bottom:Cn,left:Cn,padding:Cn,paddingTop:Cn,paddingRight:Cn,paddingBottom:Cn,paddingLeft:Cn,margin:Cn,marginTop:Cn,marginRight:Cn,marginBottom:Cn,marginLeft:Cn,backgroundPositionX:Cn,backgroundPositionY:Cn},kk={rotate:yf,rotateX:yf,rotateY:yf,rotateZ:yf,scale:K_,scaleX:K_,scaleY:K_,scaleZ:K_,skew:yf,skewX:yf,skewY:yf,distance:Cn,translateX:Cn,translateY:Cn,translateZ:Cn,x:Cn,y:Cn,z:Cn,perspective:Cn,transformPerspective:Cn,opacity:Fg,originX:gT,originY:gT,originZ:Cn},_T={...wm,transform:Math.round},Lv={...Rk,...kk,zIndex:_T,size:Cn,fillOpacity:Fg,strokeOpacity:Fg,numOctaves:_T},Dk={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Lk=vm.length;function zk(u,p,y){let b="",C=!0;for(let M=0;M<Lk;M++){const D=vm[M],r=u[D];if(r===void 0)continue;let U=!0;if(typeof r=="number"?U=r===(D.startsWith("scale")?1:0):U=parseFloat(r)===0,!U||y){const G=tE(r,Lv[D]);if(!U){C=!1;const Q=Dk[D]||D;b+=`${Q}(${G}) `}y&&(p[D]=G)}}return b=b.trim(),y?b=y(p,C?"":b):C&&(b="none"),b}function zv(u,p,y){const{style:b,vars:C,transformOrigin:M}=u;let D=!1,r=!1;for(const U in p){const G=p[U];if(Tp.has(U)){D=!0;continue}else if(eE(U)){C[U]=G;continue}else{const Q=tE(G,Lv[U]);U.startsWith("origin")?(r=!0,M[U]=Q):b[U]=Q}}if(p.transform||(D||y?b.transform=zk(p,u.transform,y):b.transform&&(b.transform="none")),r){const{originX:U="50%",originY:G="50%",originZ:Q=0}=M;b.transformOrigin=`${U} ${G} ${Q}`}}const Fk={offset:"stroke-dashoffset",array:"stroke-dasharray"},Ok={offset:"strokeDashoffset",array:"strokeDasharray"};function Nk(u,p,y=1,b=0,C=!0){u.pathLength=1;const M=C?Fk:Ok;u[M.offset]=Cn.transform(-b);const D=Cn.transform(p),r=Cn.transform(y);u[M.array]=`${D} ${r}`}function yT(u,p,y){return typeof u=="string"?u:Cn.transform(p+y*u)}function Bk(u,p,y){const b=yT(p,u.x,u.width),C=yT(y,u.y,u.height);return`${b} ${C}`}function Fv(u,{attrX:p,attrY:y,attrScale:b,originX:C,originY:M,pathLength:D,pathSpacing:r=1,pathOffset:U=0,...G},Q,se){if(zv(u,G,se),Q){u.style.viewBox&&(u.attrs.viewBox=u.style.viewBox);return}u.attrs=u.style,u.style={};const{attrs:de,style:Pe,dimensions:Se}=u;de.transform&&(Se&&(Pe.transform=de.transform),delete de.transform),Se&&(C!==void 0||M!==void 0||Pe.transform)&&(Pe.transformOrigin=Bk(Se,C!==void 0?C:.5,M!==void 0?M:.5)),p!==void 0&&(de.x=p),y!==void 0&&(de.y=y),b!==void 0&&(de.scale=b),D!==void 0&&Nk(de,D,r,U,!1)}const Ov=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),iE=()=>({...Ov(),attrs:{}}),Nv=u=>typeof u=="string"&&u.toLowerCase()==="svg";function nE(u,{style:p,vars:y},b,C){Object.assign(u.style,p,C&&C.getProjectionStyles(b));for(const M in y)u.style.setProperty(M,y[M])}const rE=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function sE(u,p,y,b){nE(u,p,void 0,b);for(const C in p.attrs)u.setAttribute(rE.has(C)?C:Pv(C),p.attrs[C])}const gy={};function jk(u){Object.assign(gy,u)}function oE(u,{layout:p,layoutId:y}){return Tp.has(u)||u.startsWith("origin")||(p||y!==void 0)&&(!!gy[u]||u==="opacity")}function Bv(u,p,y){var b;const{style:C}=u,M={};for(const D in C)(Ro(C[D])||p.style&&Ro(p.style[D])||oE(D,u)||((b=y==null?void 0:y.getValue(D))===null||b===void 0?void 0:b.liveStyle)!==void 0)&&(M[D]=C[D]);return M}function aE(u,p,y){const b=Bv(u,p,y);for(const C in u)if(Ro(u[C])||Ro(p[C])){const M=vm.indexOf(C)!==-1?"attr"+C.charAt(0).toUpperCase()+C.substring(1):C;b[M]=u[C]}return b}function Vk(u,p){try{p.dimensions=typeof u.getBBox=="function"?u.getBBox():u.getBoundingClientRect()}catch{p.dimensions={x:0,y:0,width:0,height:0}}}const xT=["x","y","width","height","cx","cy","r"],Uk={useVisualState:J3({scrapeMotionValuesFromProps:aE,createRenderState:iE,onUpdate:({props:u,prevProps:p,current:y,renderState:b,latestValues:C})=>{if(!y)return;let M=!!u.drag;if(!M){for(const r in C)if(Tp.has(r)){M=!0;break}}if(!M)return;let D=!p;if(p)for(let r=0;r<xT.length;r++){const U=xT[r];u[U]!==p[U]&&(D=!0)}D&&jr.read(()=>{Vk(y,b),jr.render(()=>{Fv(b,C,Nv(y.tagName),u.transformTemplate),sE(y,b)})})}})},Gk={useVisualState:J3({scrapeMotionValuesFromProps:Bv,createRenderState:Ov})};function lE(u,p,y){for(const b in p)!Ro(p[b])&&!oE(b,y)&&(u[b]=p[b])}function $k({transformTemplate:u},p){return Fe.useMemo(()=>{const y=Ov();return zv(y,p,u),Object.assign({},y.vars,y.style)},[p])}function Hk(u,p){const y=u.style||{},b={};return lE(b,y,u),Object.assign(b,$k(u,p)),b}function Wk(u,p){const y={},b=Hk(u,p);return u.drag&&u.dragListener!==!1&&(y.draggable=!1,b.userSelect=b.WebkitUserSelect=b.WebkitTouchCallout="none",b.touchAction=u.drag===!0?"none":`pan-${u.drag==="x"?"y":"x"}`),u.tabIndex===void 0&&(u.onTap||u.onTapStart||u.whileTap)&&(y.tabIndex=0),y.style=b,y}function qk(u,p,y,b){const C=Fe.useMemo(()=>{const M=iE();return Fv(M,p,Nv(b),u.transformTemplate),{...M.attrs,style:{...M.style}}},[p]);if(u.style){const M={};lE(M,u.style,u),C.style={...M,...C.style}}return C}function Zk(u=!1){return(y,b,C,{latestValues:M},D)=>{const U=(Rv(y)?qk:Wk)(b,M,D,y),G=ck(b,typeof y=="string",u),Q=y!==Fe.Fragment?{...G,...U,ref:C}:{},{children:se}=b,de=Fe.useMemo(()=>Ro(se)?se.get():se,[se]);return Fe.createElement(y,{...Q,children:de})}}function Xk(u,p){return function(b,{forwardMotionProps:C}={forwardMotionProps:!1}){const D={...Rv(b)?Uk:Gk,preloadedFeatures:u,useRender:Zk(C),createVisualElement:p,Component:b};return yk(D)}}function cE(u,p){if(!Array.isArray(p))return!1;const y=p.length;if(y!==u.length)return!1;for(let b=0;b<y;b++)if(p[b]!==u[b])return!1;return!0}function ky(u,p,y){const b=u.getProps();return kv(b,p,y!==void 0?y:b.custom,u)}const Yk=Cv(()=>window.ScrollTimeline!==void 0);class Kk{constructor(p){this.stop=()=>this.runAll("stop"),this.animations=p.filter(Boolean)}get finished(){return Promise.all(this.animations.map(p=>"finished"in p?p.finished:p))}getAll(p){return this.animations[0][p]}setAll(p,y){for(let b=0;b<this.animations.length;b++)this.animations[b][p]=y}attachTimeline(p,y){const b=this.animations.map(C=>{if(Yk()&&C.attachTimeline)return C.attachTimeline(p);if(typeof y=="function")return y(C)});return()=>{b.forEach((C,M)=>{C&&C(),this.animations[M].stop()})}}get time(){return this.getAll("time")}set time(p){this.setAll("time",p)}get speed(){return this.getAll("speed")}set speed(p){this.setAll("speed",p)}get startTime(){return this.getAll("startTime")}get duration(){let p=0;for(let y=0;y<this.animations.length;y++)p=Math.max(p,this.animations[y].duration);return p}runAll(p){this.animations.forEach(y=>y[p]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class Jk extends Kk{then(p,y){return Promise.all(this.animations).then(p).catch(y)}}function jv(u,p){return u?u[p]||u.default||u:void 0}const Gx=2e4;function uE(u){let p=0;const y=50;let b=u.next(p);for(;!b.done&&p<Gx;)p+=y,b=u.next(p);return p>=Gx?1/0:p}function Vv(u){return typeof u=="function"}function vT(u,p){u.timeline=p,u.onfinish=null}const Uv=u=>Array.isArray(u)&&typeof u[0]=="number",Qk={linearEasing:void 0};function eD(u,p){const y=Cv(u);return()=>{var b;return(b=Qk[p])!==null&&b!==void 0?b:y()}}const _y=eD(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),hE=(u,p,y=10)=>{let b="";const C=Math.max(Math.round(p/y),2);for(let M=0;M<C;M++)b+=u(dm(0,C-1,M))+", ";return`linear(${b.substring(0,b.length-2)})`};function dE(u){return!!(typeof u=="function"&&_y()||!u||typeof u=="string"&&(u in $x||_y())||Uv(u)||Array.isArray(u)&&u.every(dE))}const wg=([u,p,y,b])=>`cubic-bezier(${u}, ${p}, ${y}, ${b})`,$x={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:wg([0,.65,.55,1]),circOut:wg([.55,0,1,.45]),backIn:wg([.31,.01,.66,-.59]),backOut:wg([.33,1.53,.69,.99])};function fE(u,p){if(u)return typeof u=="function"&&_y()?hE(u,p):Uv(u)?wg(u):Array.isArray(u)?u.map(y=>fE(y,p)||$x.easeOut):$x[u]}const uu={x:!1,y:!1};function pE(){return uu.x||uu.y}function tD(u,p,y){var b;if(u instanceof Element)return[u];if(typeof u=="string"){let C=document;const M=(b=void 0)!==null&&b!==void 0?b:C.querySelectorAll(u);return M?Array.from(M):[]}return Array.from(u)}function mE(u,p){const y=tD(u),b=new AbortController,C={passive:!0,...p,signal:b.signal};return[y,C,()=>b.abort()]}function wT(u){return p=>{p.pointerType==="touch"||pE()||u(p)}}function iD(u,p,y={}){const[b,C,M]=mE(u,y),D=wT(r=>{const{target:U}=r,G=p(r);if(typeof G!="function"||!U)return;const Q=wT(se=>{G(se),U.removeEventListener("pointerleave",Q)});U.addEventListener("pointerleave",Q,C)});return b.forEach(r=>{r.addEventListener("pointerenter",D,C)}),M}const gE=(u,p)=>p?u===p?!0:gE(u,p.parentElement):!1,Gv=u=>u.pointerType==="mouse"?typeof u.button!="number"||u.button<=0:u.isPrimary!==!1,nD=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function rD(u){return nD.has(u.tagName)||u.tabIndex!==-1}const bg=new WeakSet;function bT(u){return p=>{p.key==="Enter"&&u(p)}}function fx(u,p){u.dispatchEvent(new PointerEvent("pointer"+p,{isPrimary:!0,bubbles:!0}))}const sD=(u,p)=>{const y=u.currentTarget;if(!y)return;const b=bT(()=>{if(bg.has(y))return;fx(y,"down");const C=bT(()=>{fx(y,"up")}),M=()=>fx(y,"cancel");y.addEventListener("keyup",C,p),y.addEventListener("blur",M,p)});y.addEventListener("keydown",b,p),y.addEventListener("blur",()=>y.removeEventListener("keydown",b),p)};function TT(u){return Gv(u)&&!pE()}function oD(u,p,y={}){const[b,C,M]=mE(u,y),D=r=>{const U=r.currentTarget;if(!TT(r)||bg.has(U))return;bg.add(U);const G=p(r),Q=(Pe,Se)=>{window.removeEventListener("pointerup",se),window.removeEventListener("pointercancel",de),!(!TT(Pe)||!bg.has(U))&&(bg.delete(U),typeof G=="function"&&G(Pe,{success:Se}))},se=Pe=>{Q(Pe,y.useGlobalTarget||gE(U,Pe.target))},de=Pe=>{Q(Pe,!1)};window.addEventListener("pointerup",se,C),window.addEventListener("pointercancel",de,C)};return b.forEach(r=>{!rD(r)&&r.getAttribute("tabindex")===null&&(r.tabIndex=0),(y.useGlobalTarget?window:r).addEventListener("pointerdown",D,C),r.addEventListener("focus",G=>sD(G,C),C)}),M}function aD(u){return u==="x"||u==="y"?uu[u]?null:(uu[u]=!0,()=>{uu[u]=!1}):uu.x||uu.y?null:(uu.x=uu.y=!0,()=>{uu.x=uu.y=!1})}const _E=new Set(["width","height","top","left","right","bottom",...vm]);let ry;function lD(){ry=void 0}const ch={now:()=>(ry===void 0&&ch.set(Mo.isProcessing||nk.useManualTiming?Mo.timestamp:performance.now()),ry),set:u=>{ry=u,queueMicrotask(lD)}};function $v(u,p){u.indexOf(p)===-1&&u.push(p)}function Hv(u,p){const y=u.indexOf(p);y>-1&&u.splice(y,1)}class Wv{constructor(){this.subscriptions=[]}add(p){return $v(this.subscriptions,p),()=>Hv(this.subscriptions,p)}notify(p,y,b){const C=this.subscriptions.length;if(C)if(C===1)this.subscriptions[0](p,y,b);else for(let M=0;M<C;M++){const D=this.subscriptions[M];D&&D(p,y,b)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function yE(u,p){return p?u*(1e3/p):0}const ST=30,cD=u=>!isNaN(parseFloat(u)),Ag={current:void 0};class uD{constructor(p,y={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(b,C=!0)=>{const M=ch.now();this.updatedAt!==M&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(b),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),C&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(p),this.owner=y.owner}setCurrent(p){this.current=p,this.updatedAt=ch.now(),this.canTrackVelocity===null&&p!==void 0&&(this.canTrackVelocity=cD(this.current))}setPrevFrameValue(p=this.current){this.prevFrameValue=p,this.prevUpdatedAt=this.updatedAt}onChange(p){return this.on("change",p)}on(p,y){this.events[p]||(this.events[p]=new Wv);const b=this.events[p].add(y);return p==="change"?()=>{b(),jr.read(()=>{this.events.change.getSize()||this.stop()})}:b}clearListeners(){for(const p in this.events)this.events[p].clear()}attach(p,y){this.passiveEffect=p,this.stopPassiveEffect=y}set(p,y=!0){!y||!this.passiveEffect?this.updateAndNotify(p,y):this.passiveEffect(p,this.updateAndNotify)}setWithVelocity(p,y,b){this.set(y),this.prev=void 0,this.prevFrameValue=p,this.prevUpdatedAt=this.updatedAt-b}jump(p,y=!0){this.updateAndNotify(p),this.prev=p,this.prevUpdatedAt=this.prevFrameValue=void 0,y&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return Ag.current&&Ag.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const p=ch.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||p-this.updatedAt>ST)return 0;const y=Math.min(this.updatedAt-this.prevUpdatedAt,ST);return yE(parseFloat(this.current)-parseFloat(this.prevFrameValue),y)}start(p){return this.stop(),new Promise(y=>{this.hasAnimated=!0,this.animation=p(y),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function pm(u,p){return new uD(u,p)}function hD(u,p,y){u.hasValue(p)?u.getValue(p).set(y):u.addValue(p,pm(y))}function dD(u,p){const y=ky(u,p);let{transitionEnd:b={},transition:C={},...M}=y||{};M={...M,...b};for(const D in M){const r=Sk(M[D]);hD(u,D,r)}}function fD(u){return!!(Ro(u)&&u.add)}function Hx(u,p){const y=u.getValue("willChange");if(fD(y))return y.add(p)}function xE(u){return u.props[X3]}const vE=(u,p,y)=>(((1-3*y+3*p)*u+(3*y-6*p))*u+3*p)*u,pD=1e-7,mD=12;function gD(u,p,y,b,C){let M,D,r=0;do D=p+(y-p)/2,M=vE(D,b,C)-u,M>0?y=D:p=D;while(Math.abs(M)>pD&&++r<mD);return D}function Zg(u,p,y,b){if(u===p&&y===b)return El;const C=M=>gD(M,0,1,u,y);return M=>M===0||M===1?M:vE(C(M),p,b)}const wE=u=>p=>p<=.5?u(2*p)/2:(2-u(2*(1-p)))/2,bE=u=>p=>1-u(1-p),TE=Zg(.33,1.53,.69,.99),qv=bE(TE),SE=wE(qv),EE=u=>(u*=2)<1?.5*qv(u):.5*(2-Math.pow(2,-10*(u-1))),Zv=u=>1-Math.sin(Math.acos(u)),CE=bE(Zv),AE=wE(Zv),IE=u=>/^0[^.\s]+$/u.test(u);function _D(u){return typeof u=="number"?u===0:u!==null?u==="none"||u==="0"||IE(u):!0}const Ig=u=>Math.round(u*1e5)/1e5,Xv=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function yD(u){return u==null}const xD=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Yv=(u,p)=>y=>!!(typeof y=="string"&&xD.test(y)&&y.startsWith(u)||p&&!yD(y)&&Object.prototype.hasOwnProperty.call(y,p)),PE=(u,p,y)=>b=>{if(typeof b!="string")return b;const[C,M,D,r]=b.match(Xv);return{[u]:parseFloat(C),[p]:parseFloat(M),[y]:parseFloat(D),alpha:r!==void 0?parseFloat(r):1}},vD=u=>dd(0,255,u),px={...wm,transform:u=>Math.round(vD(u))},gp={test:Yv("rgb","red"),parse:PE("red","green","blue"),transform:({red:u,green:p,blue:y,alpha:b=1})=>"rgba("+px.transform(u)+", "+px.transform(p)+", "+px.transform(y)+", "+Ig(Fg.transform(b))+")"};function wD(u){let p="",y="",b="",C="";return u.length>5?(p=u.substring(1,3),y=u.substring(3,5),b=u.substring(5,7),C=u.substring(7,9)):(p=u.substring(1,2),y=u.substring(2,3),b=u.substring(3,4),C=u.substring(4,5),p+=p,y+=y,b+=b,C+=C),{red:parseInt(p,16),green:parseInt(y,16),blue:parseInt(b,16),alpha:C?parseInt(C,16)/255:1}}const Wx={test:Yv("#"),parse:wD,transform:gp.transform},am={test:Yv("hsl","hue"),parse:PE("hue","saturation","lightness"),transform:({hue:u,saturation:p,lightness:y,alpha:b=1})=>"hsla("+Math.round(u)+", "+lh.transform(Ig(p))+", "+lh.transform(Ig(y))+", "+Ig(Fg.transform(b))+")"},ea={test:u=>gp.test(u)||Wx.test(u)||am.test(u),parse:u=>gp.test(u)?gp.parse(u):am.test(u)?am.parse(u):Wx.parse(u),transform:u=>typeof u=="string"?u:u.hasOwnProperty("red")?gp.transform(u):am.transform(u)},bD=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function TD(u){var p,y;return isNaN(u)&&typeof u=="string"&&(((p=u.match(Xv))===null||p===void 0?void 0:p.length)||0)+(((y=u.match(bD))===null||y===void 0?void 0:y.length)||0)>0}const ME="number",RE="color",SD="var",ED="var(",ET="${}",CD=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Og(u){const p=u.toString(),y=[],b={color:[],number:[],var:[]},C=[];let M=0;const r=p.replace(CD,U=>(ea.test(U)?(b.color.push(M),C.push(RE),y.push(ea.parse(U))):U.startsWith(ED)?(b.var.push(M),C.push(SD),y.push(U)):(b.number.push(M),C.push(ME),y.push(parseFloat(U))),++M,ET)).split(ET);return{values:y,split:r,indexes:b,types:C}}function kE(u){return Og(u).values}function DE(u){const{split:p,types:y}=Og(u),b=p.length;return C=>{let M="";for(let D=0;D<b;D++)if(M+=p[D],C[D]!==void 0){const r=y[D];r===ME?M+=Ig(C[D]):r===RE?M+=ea.transform(C[D]):M+=C[D]}return M}}const AD=u=>typeof u=="number"?0:u;function ID(u){const p=kE(u);return DE(u)(p.map(AD))}const wf={test:TD,parse:kE,createTransformer:DE,getAnimatableNone:ID},PD=new Set(["brightness","contrast","saturate","opacity"]);function MD(u){const[p,y]=u.slice(0,-1).split("(");if(p==="drop-shadow")return u;const[b]=y.match(Xv)||[];if(!b)return u;const C=y.replace(b,"");let M=PD.has(p)?1:0;return b!==y&&(M*=100),p+"("+M+C+")"}const RD=/\b([a-z-]*)\(.*?\)/gu,qx={...wf,getAnimatableNone:u=>{const p=u.match(RD);return p?p.map(MD).join(" "):u}},kD={...Lv,color:ea,backgroundColor:ea,outlineColor:ea,fill:ea,stroke:ea,borderColor:ea,borderTopColor:ea,borderRightColor:ea,borderBottomColor:ea,borderLeftColor:ea,filter:qx,WebkitFilter:qx},Kv=u=>kD[u];function LE(u,p){let y=Kv(u);return y!==qx&&(y=wf),y.getAnimatableNone?y.getAnimatableNone(p):void 0}const DD=new Set(["auto","none","0"]);function LD(u,p,y){let b=0,C;for(;b<u.length&&!C;){const M=u[b];typeof M=="string"&&!DD.has(M)&&Og(M).values.length&&(C=u[b]),b++}if(C&&y)for(const M of p)u[M]=LE(y,C)}const CT=u=>u===wm||u===Cn,AT=(u,p)=>parseFloat(u.split(", ")[p]),IT=(u,p)=>(y,{transform:b})=>{if(b==="none"||!b)return 0;const C=b.match(/^matrix3d\((.+)\)$/u);if(C)return AT(C[1],p);{const M=b.match(/^matrix\((.+)\)$/u);return M?AT(M[1],u):0}},zD=new Set(["x","y","z"]),FD=vm.filter(u=>!zD.has(u));function OD(u){const p=[];return FD.forEach(y=>{const b=u.getValue(y);b!==void 0&&(p.push([y,b.get()]),b.set(y.startsWith("scale")?1:0))}),p}const mm={width:({x:u},{paddingLeft:p="0",paddingRight:y="0"})=>u.max-u.min-parseFloat(p)-parseFloat(y),height:({y:u},{paddingTop:p="0",paddingBottom:y="0"})=>u.max-u.min-parseFloat(p)-parseFloat(y),top:(u,{top:p})=>parseFloat(p),left:(u,{left:p})=>parseFloat(p),bottom:({y:u},{top:p})=>parseFloat(p)+(u.max-u.min),right:({x:u},{left:p})=>parseFloat(p)+(u.max-u.min),x:IT(4,13),y:IT(5,14)};mm.translateX=mm.x;mm.translateY=mm.y;const yp=new Set;let Zx=!1,Xx=!1;function zE(){if(Xx){const u=Array.from(yp).filter(b=>b.needsMeasurement),p=new Set(u.map(b=>b.element)),y=new Map;p.forEach(b=>{const C=OD(b);C.length&&(y.set(b,C),b.render())}),u.forEach(b=>b.measureInitialState()),p.forEach(b=>{b.render();const C=y.get(b);C&&C.forEach(([M,D])=>{var r;(r=b.getValue(M))===null||r===void 0||r.set(D)})}),u.forEach(b=>b.measureEndState()),u.forEach(b=>{b.suspendedScrollY!==void 0&&window.scrollTo(0,b.suspendedScrollY)})}Xx=!1,Zx=!1,yp.forEach(u=>u.complete()),yp.clear()}function FE(){yp.forEach(u=>{u.readKeyframes(),u.needsMeasurement&&(Xx=!0)})}function ND(){FE(),zE()}class Jv{constructor(p,y,b,C,M,D=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...p],this.onComplete=y,this.name=b,this.motionValue=C,this.element=M,this.isAsync=D}scheduleResolve(){this.isScheduled=!0,this.isAsync?(yp.add(this),Zx||(Zx=!0,jr.read(FE),jr.resolveKeyframes(zE))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:p,name:y,element:b,motionValue:C}=this;for(let M=0;M<p.length;M++)if(p[M]===null)if(M===0){const D=C==null?void 0:C.get(),r=p[p.length-1];if(D!==void 0)p[0]=D;else if(b&&y){const U=b.readValue(y,r);U!=null&&(p[0]=U)}p[0]===void 0&&(p[0]=r),C&&D===void 0&&C.set(p[0])}else p[M]=p[M-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),yp.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,yp.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const OE=u=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(u),BD=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function jD(u){const p=BD.exec(u);if(!p)return[,];const[,y,b,C]=p;return[`--${y??b}`,C]}function NE(u,p,y=1){const[b,C]=jD(u);if(!b)return;const M=window.getComputedStyle(p).getPropertyValue(b);if(M){const D=M.trim();return OE(D)?parseFloat(D):D}return Dv(C)?NE(C,p,y+1):C}const BE=u=>p=>p.test(u),VD={test:u=>u==="auto",parse:u=>u},jE=[wm,Cn,lh,yf,Mk,Pk,VD],PT=u=>jE.find(BE(u));class VE extends Jv{constructor(p,y,b,C,M){super(p,y,b,C,M,!0)}readKeyframes(){const{unresolvedKeyframes:p,element:y,name:b}=this;if(!y||!y.current)return;super.readKeyframes();for(let U=0;U<p.length;U++){let G=p[U];if(typeof G=="string"&&(G=G.trim(),Dv(G))){const Q=NE(G,y.current);Q!==void 0&&(p[U]=Q),U===p.length-1&&(this.finalKeyframe=G)}}if(this.resolveNoneKeyframes(),!_E.has(b)||p.length!==2)return;const[C,M]=p,D=PT(C),r=PT(M);if(D!==r)if(CT(D)&&CT(r))for(let U=0;U<p.length;U++){const G=p[U];typeof G=="string"&&(p[U]=parseFloat(G))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:p,name:y}=this,b=[];for(let C=0;C<p.length;C++)_D(p[C])&&b.push(C);b.length&&LD(p,b,y)}measureInitialState(){const{element:p,unresolvedKeyframes:y,name:b}=this;if(!p||!p.current)return;b==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=mm[b](p.measureViewportBox(),window.getComputedStyle(p.current)),y[0]=this.measuredOrigin;const C=y[y.length-1];C!==void 0&&p.getValue(b,C).jump(C,!1)}measureEndState(){var p;const{element:y,name:b,unresolvedKeyframes:C}=this;if(!y||!y.current)return;const M=y.getValue(b);M&&M.jump(this.measuredOrigin,!1);const D=C.length-1,r=C[D];C[D]=mm[b](y.measureViewportBox(),window.getComputedStyle(y.current)),r!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=r),!((p=this.removedTransforms)===null||p===void 0)&&p.length&&this.removedTransforms.forEach(([U,G])=>{y.getValue(U).set(G)}),this.resolveNoneKeyframes()}}const MT=(u,p)=>p==="zIndex"?!1:!!(typeof u=="number"||Array.isArray(u)||typeof u=="string"&&(wf.test(u)||u==="0")&&!u.startsWith("url("));function UD(u){const p=u[0];if(u.length===1)return!0;for(let y=0;y<u.length;y++)if(u[y]!==p)return!0}function GD(u,p,y,b){const C=u[0];if(C===null)return!1;if(p==="display"||p==="visibility")return!0;const M=u[u.length-1],D=MT(C,p),r=MT(M,p);return!D||!r?!1:UD(u)||(y==="spring"||Vv(y))&&b}const $D=u=>u!==null;function Dy(u,{repeat:p,repeatType:y="loop"},b){const C=u.filter($D),M=p&&y!=="loop"&&p%2===1?0:C.length-1;return!M||b===void 0?C[M]:b}const HD=40;class UE{constructor({autoplay:p=!0,delay:y=0,type:b="keyframes",repeat:C=0,repeatDelay:M=0,repeatType:D="loop",...r}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=ch.now(),this.options={autoplay:p,delay:y,type:b,repeat:C,repeatDelay:M,repeatType:D,...r},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>HD?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&ND(),this._resolved}onKeyframesResolved(p,y){this.resolvedAt=ch.now(),this.hasAttemptedResolve=!0;const{name:b,type:C,velocity:M,delay:D,onComplete:r,onUpdate:U,isGenerator:G}=this.options;if(!G&&!GD(p,b,C,M))if(D)this.options.duration=0;else{U&&U(Dy(p,this.options,y)),r&&r(),this.resolveFinishedPromise();return}const Q=this.initPlayback(p,y);Q!==!1&&(this._resolved={keyframes:p,finalKeyframe:y,...Q},this.onPostResolved())}onPostResolved(){}then(p,y){return this.currentFinishedPromise.then(p,y)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(p=>{this.resolveFinishedPromise=p})}}const xs=(u,p,y)=>u+(p-u)*y;function mx(u,p,y){return y<0&&(y+=1),y>1&&(y-=1),y<1/6?u+(p-u)*6*y:y<1/2?p:y<2/3?u+(p-u)*(2/3-y)*6:u}function WD({hue:u,saturation:p,lightness:y,alpha:b}){u/=360,p/=100,y/=100;let C=0,M=0,D=0;if(!p)C=M=D=y;else{const r=y<.5?y*(1+p):y+p-y*p,U=2*y-r;C=mx(U,r,u+1/3),M=mx(U,r,u),D=mx(U,r,u-1/3)}return{red:Math.round(C*255),green:Math.round(M*255),blue:Math.round(D*255),alpha:b}}function yy(u,p){return y=>y>0?p:u}const gx=(u,p,y)=>{const b=u*u,C=y*(p*p-b)+b;return C<0?0:Math.sqrt(C)},qD=[Wx,gp,am],ZD=u=>qD.find(p=>p.test(u));function RT(u){const p=ZD(u);if(!p)return!1;let y=p.parse(u);return p===am&&(y=WD(y)),y}const kT=(u,p)=>{const y=RT(u),b=RT(p);if(!y||!b)return yy(u,p);const C={...y};return M=>(C.red=gx(y.red,b.red,M),C.green=gx(y.green,b.green,M),C.blue=gx(y.blue,b.blue,M),C.alpha=xs(y.alpha,b.alpha,M),gp.transform(C))},XD=(u,p)=>y=>p(u(y)),Xg=(...u)=>u.reduce(XD),Yx=new Set(["none","hidden"]);function YD(u,p){return Yx.has(u)?y=>y<=0?u:p:y=>y>=1?p:u}function KD(u,p){return y=>xs(u,p,y)}function Qv(u){return typeof u=="number"?KD:typeof u=="string"?Dv(u)?yy:ea.test(u)?kT:eL:Array.isArray(u)?GE:typeof u=="object"?ea.test(u)?kT:JD:yy}function GE(u,p){const y=[...u],b=y.length,C=u.map((M,D)=>Qv(M)(M,p[D]));return M=>{for(let D=0;D<b;D++)y[D]=C[D](M);return y}}function JD(u,p){const y={...u,...p},b={};for(const C in y)u[C]!==void 0&&p[C]!==void 0&&(b[C]=Qv(u[C])(u[C],p[C]));return C=>{for(const M in b)y[M]=b[M](C);return y}}function QD(u,p){var y;const b=[],C={color:0,var:0,number:0};for(let M=0;M<p.values.length;M++){const D=p.types[M],r=u.indexes[D][C[D]],U=(y=u.values[r])!==null&&y!==void 0?y:0;b[M]=U,C[D]++}return b}const eL=(u,p)=>{const y=wf.createTransformer(p),b=Og(u),C=Og(p);return b.indexes.var.length===C.indexes.var.length&&b.indexes.color.length===C.indexes.color.length&&b.indexes.number.length>=C.indexes.number.length?Yx.has(u)&&!C.values.length||Yx.has(p)&&!b.values.length?YD(u,p):Xg(GE(QD(b,C),C.values),y):yy(u,p)};function $E(u,p,y){return typeof u=="number"&&typeof p=="number"&&typeof y=="number"?xs(u,p,y):Qv(u)(u,p)}const tL=5;function HE(u,p,y){const b=Math.max(p-tL,0);return yE(y-u(b),p-b)}const Ms={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},_x=.001;function iL({duration:u=Ms.duration,bounce:p=Ms.bounce,velocity:y=Ms.velocity,mass:b=Ms.mass}){let C,M,D=1-p;D=dd(Ms.minDamping,Ms.maxDamping,D),u=dd(Ms.minDuration,Ms.maxDuration,ld(u)),D<1?(C=G=>{const Q=G*D,se=Q*u,de=Q-y,Pe=Kx(G,D),Se=Math.exp(-se);return _x-de/Pe*Se},M=G=>{const se=G*D*u,de=se*y+y,Pe=Math.pow(D,2)*Math.pow(G,2)*u,Se=Math.exp(-se),ve=Kx(Math.pow(G,2),D);return(-C(G)+_x>0?-1:1)*((de-Pe)*Se)/ve}):(C=G=>{const Q=Math.exp(-G*u),se=(G-y)*u+1;return-_x+Q*se},M=G=>{const Q=Math.exp(-G*u),se=(y-G)*(u*u);return Q*se});const r=5/u,U=rL(C,M,r);if(u=ad(u),isNaN(U))return{stiffness:Ms.stiffness,damping:Ms.damping,duration:u};{const G=Math.pow(U,2)*b;return{stiffness:G,damping:D*2*Math.sqrt(b*G),duration:u}}}const nL=12;function rL(u,p,y){let b=y;for(let C=1;C<nL;C++)b=b-u(b)/p(b);return b}function Kx(u,p){return u*Math.sqrt(1-p*p)}const sL=["duration","bounce"],oL=["stiffness","damping","mass"];function DT(u,p){return p.some(y=>u[y]!==void 0)}function aL(u){let p={velocity:Ms.velocity,stiffness:Ms.stiffness,damping:Ms.damping,mass:Ms.mass,isResolvedFromDuration:!1,...u};if(!DT(u,oL)&&DT(u,sL))if(u.visualDuration){const y=u.visualDuration,b=2*Math.PI/(y*1.2),C=b*b,M=2*dd(.05,1,1-(u.bounce||0))*Math.sqrt(C);p={...p,mass:Ms.mass,stiffness:C,damping:M}}else{const y=iL(u);p={...p,...y,mass:Ms.mass},p.isResolvedFromDuration=!0}return p}function WE(u=Ms.visualDuration,p=Ms.bounce){const y=typeof u!="object"?{visualDuration:u,keyframes:[0,1],bounce:p}:u;let{restSpeed:b,restDelta:C}=y;const M=y.keyframes[0],D=y.keyframes[y.keyframes.length-1],r={done:!1,value:M},{stiffness:U,damping:G,mass:Q,duration:se,velocity:de,isResolvedFromDuration:Pe}=aL({...y,velocity:-ld(y.velocity||0)}),Se=de||0,ve=G/(2*Math.sqrt(U*Q)),ce=D-M,ze=ld(Math.sqrt(U/Q)),et=Math.abs(ce)<5;b||(b=et?Ms.restSpeed.granular:Ms.restSpeed.default),C||(C=et?Ms.restDelta.granular:Ms.restDelta.default);let pt;if(ve<1){const It=Kx(ze,ve);pt=di=>{const Bt=Math.exp(-ve*ze*di);return D-Bt*((Se+ve*ze*ce)/It*Math.sin(It*di)+ce*Math.cos(It*di))}}else if(ve===1)pt=It=>D-Math.exp(-ze*It)*(ce+(Se+ze*ce)*It);else{const It=ze*Math.sqrt(ve*ve-1);pt=di=>{const Bt=Math.exp(-ve*ze*di),Yt=Math.min(It*di,300);return D-Bt*((Se+ve*ze*ce)*Math.sinh(Yt)+It*ce*Math.cosh(Yt))/It}}const Tt={calculatedDuration:Pe&&se||null,next:It=>{const di=pt(It);if(Pe)r.done=It>=se;else{let Bt=0;ve<1&&(Bt=It===0?ad(Se):HE(pt,It,di));const Yt=Math.abs(Bt)<=b,vt=Math.abs(D-di)<=C;r.done=Yt&&vt}return r.value=r.done?D:di,r},toString:()=>{const It=Math.min(uE(Tt),Gx),di=hE(Bt=>Tt.next(It*Bt).value,It,30);return It+"ms "+di}};return Tt}function LT({keyframes:u,velocity:p=0,power:y=.8,timeConstant:b=325,bounceDamping:C=10,bounceStiffness:M=500,modifyTarget:D,min:r,max:U,restDelta:G=.5,restSpeed:Q}){const se=u[0],de={done:!1,value:se},Pe=Yt=>r!==void 0&&Yt<r||U!==void 0&&Yt>U,Se=Yt=>r===void 0?U:U===void 0||Math.abs(r-Yt)<Math.abs(U-Yt)?r:U;let ve=y*p;const ce=se+ve,ze=D===void 0?ce:D(ce);ze!==ce&&(ve=ze-se);const et=Yt=>-ve*Math.exp(-Yt/b),pt=Yt=>ze+et(Yt),Tt=Yt=>{const vt=et(Yt),Jt=pt(Yt);de.done=Math.abs(vt)<=G,de.value=de.done?ze:Jt};let It,di;const Bt=Yt=>{Pe(de.value)&&(It=Yt,di=WE({keyframes:[de.value,Se(de.value)],velocity:HE(pt,Yt,de.value),damping:C,stiffness:M,restDelta:G,restSpeed:Q}))};return Bt(0),{calculatedDuration:null,next:Yt=>{let vt=!1;return!di&&It===void 0&&(vt=!0,Tt(Yt),Bt(Yt)),It!==void 0&&Yt>=It?di.next(Yt-It):(!vt&&Tt(Yt),de)}}}const lL=Zg(.42,0,1,1),cL=Zg(0,0,.58,1),qE=Zg(.42,0,.58,1),uL=u=>Array.isArray(u)&&typeof u[0]!="number",hL={linear:El,easeIn:lL,easeInOut:qE,easeOut:cL,circIn:Zv,circInOut:AE,circOut:CE,backIn:qv,backInOut:SE,backOut:TE,anticipate:EE},zT=u=>{if(Uv(u)){$3(u.length===4);const[p,y,b,C]=u;return Zg(p,y,b,C)}else if(typeof u=="string")return hL[u];return u};function dL(u,p,y){const b=[],C=y||$E,M=u.length-1;for(let D=0;D<M;D++){let r=C(u[D],u[D+1]);if(p){const U=Array.isArray(p)?p[D]||El:p;r=Xg(U,r)}b.push(r)}return b}function ZE(u,p,{clamp:y=!0,ease:b,mixer:C}={}){const M=u.length;if($3(M===p.length),M===1)return()=>p[0];if(M===2&&p[0]===p[1])return()=>p[1];const D=u[0]===u[1];u[0]>u[M-1]&&(u=[...u].reverse(),p=[...p].reverse());const r=dL(p,b,C),U=r.length,G=Q=>{if(D&&Q<u[0])return p[0];let se=0;if(U>1)for(;se<u.length-2&&!(Q<u[se+1]);se++);const de=dm(u[se],u[se+1],Q);return r[se](de)};return y?Q=>G(dd(u[0],u[M-1],Q)):G}function fL(u,p){const y=u[u.length-1];for(let b=1;b<=p;b++){const C=dm(0,p,b);u.push(xs(y,1,C))}}function pL(u){const p=[0];return fL(p,u.length-1),p}function mL(u,p){return u.map(y=>y*p)}function gL(u,p){return u.map(()=>p||qE).splice(0,u.length-1)}function xy({duration:u=300,keyframes:p,times:y,ease:b="easeInOut"}){const C=uL(b)?b.map(zT):zT(b),M={done:!1,value:p[0]},D=mL(y&&y.length===p.length?y:pL(p),u),r=ZE(D,p,{ease:Array.isArray(C)?C:gL(p,C)});return{calculatedDuration:u,next:U=>(M.value=r(U),M.done=U>=u,M)}}const _L=u=>{const p=({timestamp:y})=>u(y);return{start:()=>jr.update(p,!0),stop:()=>hd(p),now:()=>Mo.isProcessing?Mo.timestamp:ch.now()}},yL={decay:LT,inertia:LT,tween:xy,keyframes:xy,spring:WE},xL=u=>u/100;class Ly extends UE{constructor(p){super(p),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:U}=this.options;U&&U()};const{name:y,motionValue:b,element:C,keyframes:M}=this.options,D=(C==null?void 0:C.KeyframeResolver)||Jv,r=(U,G)=>this.onKeyframesResolved(U,G);this.resolver=new D(M,r,y,b,C),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(p){const{type:y="keyframes",repeat:b=0,repeatDelay:C=0,repeatType:M,velocity:D=0}=this.options,r=Vv(y)?y:yL[y]||xy;let U,G;r!==xy&&typeof p[0]!="number"&&(U=Xg(xL,$E(p[0],p[1])),p=[0,100]);const Q=r({...this.options,keyframes:p});M==="mirror"&&(G=r({...this.options,keyframes:[...p].reverse(),velocity:-D})),Q.calculatedDuration===null&&(Q.calculatedDuration=uE(Q));const{calculatedDuration:se}=Q,de=se+C,Pe=de*(b+1)-C;return{generator:Q,mirroredGenerator:G,mapPercentToKeyframes:U,calculatedDuration:se,resolvedDuration:de,totalDuration:Pe}}onPostResolved(){const{autoplay:p=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!p?this.pause():this.state=this.pendingPlayState}tick(p,y=!1){const{resolved:b}=this;if(!b){const{keyframes:Yt}=this.options;return{done:!0,value:Yt[Yt.length-1]}}const{finalKeyframe:C,generator:M,mirroredGenerator:D,mapPercentToKeyframes:r,keyframes:U,calculatedDuration:G,totalDuration:Q,resolvedDuration:se}=b;if(this.startTime===null)return M.next(0);const{delay:de,repeat:Pe,repeatType:Se,repeatDelay:ve,onUpdate:ce}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,p):this.speed<0&&(this.startTime=Math.min(p-Q/this.speed,this.startTime)),y?this.currentTime=p:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(p-this.startTime)*this.speed;const ze=this.currentTime-de*(this.speed>=0?1:-1),et=this.speed>=0?ze<0:ze>Q;this.currentTime=Math.max(ze,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=Q);let pt=this.currentTime,Tt=M;if(Pe){const Yt=Math.min(this.currentTime,Q)/se;let vt=Math.floor(Yt),Jt=Yt%1;!Jt&&Yt>=1&&(Jt=1),Jt===1&&vt--,vt=Math.min(vt,Pe+1),!!(vt%2)&&(Se==="reverse"?(Jt=1-Jt,ve&&(Jt-=ve/se)):Se==="mirror"&&(Tt=D)),pt=dd(0,1,Jt)*se}const It=et?{done:!1,value:U[0]}:Tt.next(pt);r&&(It.value=r(It.value));let{done:di}=It;!et&&G!==null&&(di=this.speed>=0?this.currentTime>=Q:this.currentTime<=0);const Bt=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&di);return Bt&&C!==void 0&&(It.value=Dy(U,this.options,C)),ce&&ce(It.value),Bt&&this.finish(),It}get duration(){const{resolved:p}=this;return p?ld(p.calculatedDuration):0}get time(){return ld(this.currentTime)}set time(p){p=ad(p),this.currentTime=p,this.holdTime!==null||this.speed===0?this.holdTime=p:this.driver&&(this.startTime=this.driver.now()-p/this.speed)}get speed(){return this.playbackSpeed}set speed(p){const y=this.playbackSpeed!==p;this.playbackSpeed=p,y&&(this.time=ld(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:p=_L,onPlay:y,startTime:b}=this.options;this.driver||(this.driver=p(M=>this.tick(M))),y&&y();const C=this.driver.now();this.holdTime!==null?this.startTime=C-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=C):this.startTime=b??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var p;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(p=this.currentTime)!==null&&p!==void 0?p:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:p}=this.options;p&&p()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(p){return this.startTime=0,this.tick(p,!0)}}function vL(u){return new Ly(u)}const wL=new Set(["opacity","clipPath","filter","transform"]);function bL(u,p,y,{delay:b=0,duration:C=300,repeat:M=0,repeatType:D="loop",ease:r="easeInOut",times:U}={}){const G={[p]:y};U&&(G.offset=U);const Q=fE(r,C);return Array.isArray(Q)&&(G.easing=Q),u.animate(G,{delay:b,duration:C,easing:Array.isArray(Q)?"linear":Q,fill:"both",iterations:M+1,direction:D==="reverse"?"alternate":"normal"})}const TL=Cv(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),vy=10,SL=2e4;function EL(u){return Vv(u.type)||u.type==="spring"||!dE(u.ease)}function CL(u,p){const y=new Ly({...p,keyframes:u,repeat:0,delay:0,isGenerator:!0});let b={done:!1,value:u[0]};const C=[];let M=0;for(;!b.done&&M<SL;)b=y.sample(M),C.push(b.value),M+=vy;return{times:void 0,keyframes:C,duration:M-vy,ease:"linear"}}const XE={anticipate:EE,backInOut:SE,circInOut:AE};function AL(u){return u in XE}class FT extends UE{constructor(p){super(p);const{name:y,motionValue:b,element:C,keyframes:M}=this.options;this.resolver=new VE(M,(D,r)=>this.onKeyframesResolved(D,r),y,b,C),this.resolver.scheduleResolve()}initPlayback(p,y){let{duration:b=300,times:C,ease:M,type:D,motionValue:r,name:U,startTime:G}=this.options;if(!r.owner||!r.owner.current)return!1;if(typeof M=="string"&&_y()&&AL(M)&&(M=XE[M]),EL(this.options)){const{onComplete:se,onUpdate:de,motionValue:Pe,element:Se,...ve}=this.options,ce=CL(p,ve);p=ce.keyframes,p.length===1&&(p[1]=p[0]),b=ce.duration,C=ce.times,M=ce.ease,D="keyframes"}const Q=bL(r.owner.current,U,p,{...this.options,duration:b,times:C,ease:M});return Q.startTime=G??this.calcStartTime(),this.pendingTimeline?(vT(Q,this.pendingTimeline),this.pendingTimeline=void 0):Q.onfinish=()=>{const{onComplete:se}=this.options;r.set(Dy(p,this.options,y)),se&&se(),this.cancel(),this.resolveFinishedPromise()},{animation:Q,duration:b,times:C,type:D,ease:M,keyframes:p}}get duration(){const{resolved:p}=this;if(!p)return 0;const{duration:y}=p;return ld(y)}get time(){const{resolved:p}=this;if(!p)return 0;const{animation:y}=p;return ld(y.currentTime||0)}set time(p){const{resolved:y}=this;if(!y)return;const{animation:b}=y;b.currentTime=ad(p)}get speed(){const{resolved:p}=this;if(!p)return 1;const{animation:y}=p;return y.playbackRate}set speed(p){const{resolved:y}=this;if(!y)return;const{animation:b}=y;b.playbackRate=p}get state(){const{resolved:p}=this;if(!p)return"idle";const{animation:y}=p;return y.playState}get startTime(){const{resolved:p}=this;if(!p)return null;const{animation:y}=p;return y.startTime}attachTimeline(p){if(!this._resolved)this.pendingTimeline=p;else{const{resolved:y}=this;if(!y)return El;const{animation:b}=y;vT(b,p)}return El}play(){if(this.isStopped)return;const{resolved:p}=this;if(!p)return;const{animation:y}=p;y.playState==="finished"&&this.updateFinishedPromise(),y.play()}pause(){const{resolved:p}=this;if(!p)return;const{animation:y}=p;y.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:p}=this;if(!p)return;const{animation:y,keyframes:b,duration:C,type:M,ease:D,times:r}=p;if(y.playState==="idle"||y.playState==="finished")return;if(this.time){const{motionValue:G,onUpdate:Q,onComplete:se,element:de,...Pe}=this.options,Se=new Ly({...Pe,keyframes:b,duration:C,type:M,ease:D,times:r,isGenerator:!0}),ve=ad(this.time);G.setWithVelocity(Se.sample(ve-vy).value,Se.sample(ve).value,vy)}const{onStop:U}=this.options;U&&U(),this.cancel()}complete(){const{resolved:p}=this;p&&p.animation.finish()}cancel(){const{resolved:p}=this;p&&p.animation.cancel()}static supports(p){const{motionValue:y,name:b,repeatDelay:C,repeatType:M,damping:D,type:r}=p;if(!y||!y.owner||!(y.owner.current instanceof HTMLElement))return!1;const{onUpdate:U,transformTemplate:G}=y.owner.getProps();return TL()&&b&&wL.has(b)&&!U&&!G&&!C&&M!=="mirror"&&D!==0&&r!=="inertia"}}const IL={type:"spring",stiffness:500,damping:25,restSpeed:10},PL=u=>({type:"spring",stiffness:550,damping:u===0?2*Math.sqrt(550):30,restSpeed:10}),ML={type:"keyframes",duration:.8},RL={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},kL=(u,{keyframes:p})=>p.length>2?ML:Tp.has(u)?u.startsWith("scale")?PL(p[1]):IL:RL;function DL({when:u,delay:p,delayChildren:y,staggerChildren:b,staggerDirection:C,repeat:M,repeatType:D,repeatDelay:r,from:U,elapsed:G,...Q}){return!!Object.keys(Q).length}const e1=(u,p,y,b={},C,M)=>D=>{const r=jv(b,u)||{},U=r.delay||b.delay||0;let{elapsed:G=0}=b;G=G-ad(U);let Q={keyframes:Array.isArray(y)?y:[null,y],ease:"easeOut",velocity:p.getVelocity(),...r,delay:-G,onUpdate:de=>{p.set(de),r.onUpdate&&r.onUpdate(de)},onComplete:()=>{D(),r.onComplete&&r.onComplete()},name:u,motionValue:p,element:M?void 0:C};DL(r)||(Q={...Q,...kL(u,Q)}),Q.duration&&(Q.duration=ad(Q.duration)),Q.repeatDelay&&(Q.repeatDelay=ad(Q.repeatDelay)),Q.from!==void 0&&(Q.keyframes[0]=Q.from);let se=!1;if((Q.type===!1||Q.duration===0&&!Q.repeatDelay)&&(Q.duration=0,Q.delay===0&&(se=!0)),se&&!M&&p.get()!==void 0){const de=Dy(Q.keyframes,r);if(de!==void 0)return jr.update(()=>{Q.onUpdate(de),Q.onComplete()}),new Jk([])}return!M&&FT.supports(Q)?new FT(Q):new Ly(Q)};function LL({protectedKeys:u,needsAnimating:p},y){const b=u.hasOwnProperty(y)&&p[y]!==!0;return p[y]=!1,b}function YE(u,p,{delay:y=0,transitionOverride:b,type:C}={}){var M;let{transition:D=u.getDefaultTransition(),transitionEnd:r,...U}=p;b&&(D=b);const G=[],Q=C&&u.animationState&&u.animationState.getState()[C];for(const se in U){const de=u.getValue(se,(M=u.latestValues[se])!==null&&M!==void 0?M:null),Pe=U[se];if(Pe===void 0||Q&&LL(Q,se))continue;const Se={delay:y,...jv(D||{},se)};let ve=!1;if(window.MotionHandoffAnimation){const ze=xE(u);if(ze){const et=window.MotionHandoffAnimation(ze,se,jr);et!==null&&(Se.startTime=et,ve=!0)}}Hx(u,se),de.start(e1(se,de,Pe,u.shouldReduceMotion&&_E.has(se)?{type:!1}:Se,u,ve));const ce=de.animation;ce&&G.push(ce)}return r&&Promise.all(G).then(()=>{jr.update(()=>{r&&dD(u,r)})}),G}function Jx(u,p,y={}){var b;const C=ky(u,p,y.type==="exit"?(b=u.presenceContext)===null||b===void 0?void 0:b.custom:void 0);let{transition:M=u.getDefaultTransition()||{}}=C||{};y.transitionOverride&&(M=y.transitionOverride);const D=C?()=>Promise.all(YE(u,C,y)):()=>Promise.resolve(),r=u.variantChildren&&u.variantChildren.size?(G=0)=>{const{delayChildren:Q=0,staggerChildren:se,staggerDirection:de}=M;return zL(u,p,Q+G,se,de,y)}:()=>Promise.resolve(),{when:U}=M;if(U){const[G,Q]=U==="beforeChildren"?[D,r]:[r,D];return G().then(()=>Q())}else return Promise.all([D(),r(y.delay)])}function zL(u,p,y=0,b=0,C=1,M){const D=[],r=(u.variantChildren.size-1)*b,U=C===1?(G=0)=>G*b:(G=0)=>r-G*b;return Array.from(u.variantChildren).sort(FL).forEach((G,Q)=>{G.notify("AnimationStart",p),D.push(Jx(G,p,{...M,delay:y+U(Q)}).then(()=>G.notify("AnimationComplete",p)))}),Promise.all(D)}function FL(u,p){return u.sortNodePosition(p)}function OL(u,p,y={}){u.notify("AnimationStart",p);let b;if(Array.isArray(p)){const C=p.map(M=>Jx(u,M,y));b=Promise.all(C)}else if(typeof p=="string")b=Jx(u,p,y);else{const C=typeof p=="function"?ky(u,p,y.custom):p;b=Promise.all(YE(u,C,y))}return b.then(()=>{u.notify("AnimationComplete",p)})}const NL=Iv.length;function KE(u){if(!u)return;if(!u.isControllingVariants){const y=u.parent?KE(u.parent)||{}:{};return u.props.initial!==void 0&&(y.initial=u.props.initial),y}const p={};for(let y=0;y<NL;y++){const b=Iv[y],C=u.props[b];(zg(C)||C===!1)&&(p[b]=C)}return p}const BL=[...Av].reverse(),jL=Av.length;function VL(u){return p=>Promise.all(p.map(({animation:y,options:b})=>OL(u,y,b)))}function UL(u){let p=VL(u),y=OT(),b=!0;const C=U=>(G,Q)=>{var se;const de=ky(u,Q,U==="exit"?(se=u.presenceContext)===null||se===void 0?void 0:se.custom:void 0);if(de){const{transition:Pe,transitionEnd:Se,...ve}=de;G={...G,...ve,...Se}}return G};function M(U){p=U(u)}function D(U){const{props:G}=u,Q=KE(u.parent)||{},se=[],de=new Set;let Pe={},Se=1/0;for(let ce=0;ce<jL;ce++){const ze=BL[ce],et=y[ze],pt=G[ze]!==void 0?G[ze]:Q[ze],Tt=zg(pt),It=ze===U?et.isActive:null;It===!1&&(Se=ce);let di=pt===Q[ze]&&pt!==G[ze]&&Tt;if(di&&b&&u.manuallyAnimateOnMount&&(di=!1),et.protectedKeys={...Pe},!et.isActive&&It===null||!pt&&!et.prevProp||My(pt)||typeof pt=="boolean")continue;const Bt=GL(et.prevProp,pt);let Yt=Bt||ze===U&&et.isActive&&!di&&Tt||ce>Se&&Tt,vt=!1;const Jt=Array.isArray(pt)?pt:[pt];let Ht=Jt.reduce(C(ze),{});It===!1&&(Ht={});const{prevResolvedValues:Nt={}}=et,Li={...Nt,...Ht},Dt=xi=>{Yt=!0,de.has(xi)&&(vt=!0,de.delete(xi)),et.needsAnimating[xi]=!0;const $t=u.getValue(xi);$t&&($t.liveStyle=!1)};for(const xi in Li){const $t=Ht[xi],Ei=Nt[xi];if(Pe.hasOwnProperty(xi))continue;let Kt=!1;Ux($t)&&Ux(Ei)?Kt=!cE($t,Ei):Kt=$t!==Ei,Kt?$t!=null?Dt(xi):de.add(xi):$t!==void 0&&de.has(xi)?Dt(xi):et.protectedKeys[xi]=!0}et.prevProp=pt,et.prevResolvedValues=Ht,et.isActive&&(Pe={...Pe,...Ht}),b&&u.blockInitialAnimation&&(Yt=!1),Yt&&(!(di&&Bt)||vt)&&se.push(...Jt.map(xi=>({animation:xi,options:{type:ze}})))}if(de.size){const ce={};de.forEach(ze=>{const et=u.getBaseTarget(ze),pt=u.getValue(ze);pt&&(pt.liveStyle=!0),ce[ze]=et??null}),se.push({animation:ce})}let ve=!!se.length;return b&&(G.initial===!1||G.initial===G.animate)&&!u.manuallyAnimateOnMount&&(ve=!1),b=!1,ve?p(se):Promise.resolve()}function r(U,G){var Q;if(y[U].isActive===G)return Promise.resolve();(Q=u.variantChildren)===null||Q===void 0||Q.forEach(de=>{var Pe;return(Pe=de.animationState)===null||Pe===void 0?void 0:Pe.setActive(U,G)}),y[U].isActive=G;const se=D(U);for(const de in y)y[de].protectedKeys={};return se}return{animateChanges:D,setActive:r,setAnimateFunction:M,getState:()=>y,reset:()=>{y=OT(),b=!0}}}function GL(u,p){return typeof p=="string"?p!==u:Array.isArray(p)?!cE(p,u):!1}function dp(u=!1){return{isActive:u,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function OT(){return{animate:dp(!0),whileInView:dp(),whileHover:dp(),whileTap:dp(),whileDrag:dp(),whileFocus:dp(),exit:dp()}}class Sf{constructor(p){this.isMounted=!1,this.node=p}update(){}}class $L extends Sf{constructor(p){super(p),p.animationState||(p.animationState=UL(p))}updateAnimationControlsSubscription(){const{animate:p}=this.node.getProps();My(p)&&(this.unmountControls=p.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:p}=this.node.getProps(),{animate:y}=this.node.prevProps||{};p!==y&&this.updateAnimationControlsSubscription()}unmount(){var p;this.node.animationState.reset(),(p=this.unmountControls)===null||p===void 0||p.call(this)}}let HL=0;class WL extends Sf{constructor(){super(...arguments),this.id=HL++}update(){if(!this.node.presenceContext)return;const{isPresent:p,onExitComplete:y}=this.node.presenceContext,{isPresent:b}=this.node.prevPresenceContext||{};if(!this.node.animationState||p===b)return;const C=this.node.animationState.setActive("exit",!p);y&&!p&&C.then(()=>y(this.id))}mount(){const{register:p}=this.node.presenceContext||{};p&&(this.unmount=p(this.id))}unmount(){}}const qL={animation:{Feature:$L},exit:{Feature:WL}};function Ng(u,p,y,b={passive:!0}){return u.addEventListener(p,y,b),()=>u.removeEventListener(p,y)}function Yg(u){return{point:{x:u.pageX,y:u.pageY}}}const ZL=u=>p=>Gv(p)&&u(p,Yg(p));function Pg(u,p,y,b){return Ng(u,p,ZL(y),b)}const NT=(u,p)=>Math.abs(u-p);function XL(u,p){const y=NT(u.x,p.x),b=NT(u.y,p.y);return Math.sqrt(y**2+b**2)}class JE{constructor(p,y,{transformPagePoint:b,contextWindow:C,dragSnapToOrigin:M=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const se=xx(this.lastMoveEventInfo,this.history),de=this.startEvent!==null,Pe=XL(se.offset,{x:0,y:0})>=3;if(!de&&!Pe)return;const{point:Se}=se,{timestamp:ve}=Mo;this.history.push({...Se,timestamp:ve});const{onStart:ce,onMove:ze}=this.handlers;de||(ce&&ce(this.lastMoveEvent,se),this.startEvent=this.lastMoveEvent),ze&&ze(this.lastMoveEvent,se)},this.handlePointerMove=(se,de)=>{this.lastMoveEvent=se,this.lastMoveEventInfo=yx(de,this.transformPagePoint),jr.update(this.updatePoint,!0)},this.handlePointerUp=(se,de)=>{this.end();const{onEnd:Pe,onSessionEnd:Se,resumeAnimation:ve}=this.handlers;if(this.dragSnapToOrigin&&ve&&ve(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const ce=xx(se.type==="pointercancel"?this.lastMoveEventInfo:yx(de,this.transformPagePoint),this.history);this.startEvent&&Pe&&Pe(se,ce),Se&&Se(se,ce)},!Gv(p))return;this.dragSnapToOrigin=M,this.handlers=y,this.transformPagePoint=b,this.contextWindow=C||window;const D=Yg(p),r=yx(D,this.transformPagePoint),{point:U}=r,{timestamp:G}=Mo;this.history=[{...U,timestamp:G}];const{onSessionStart:Q}=y;Q&&Q(p,xx(r,this.history)),this.removeListeners=Xg(Pg(this.contextWindow,"pointermove",this.handlePointerMove),Pg(this.contextWindow,"pointerup",this.handlePointerUp),Pg(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(p){this.handlers=p}end(){this.removeListeners&&this.removeListeners(),hd(this.updatePoint)}}function yx(u,p){return p?{point:p(u.point)}:u}function BT(u,p){return{x:u.x-p.x,y:u.y-p.y}}function xx({point:u},p){return{point:u,delta:BT(u,QE(p)),offset:BT(u,YL(p)),velocity:KL(p,.1)}}function YL(u){return u[0]}function QE(u){return u[u.length-1]}function KL(u,p){if(u.length<2)return{x:0,y:0};let y=u.length-1,b=null;const C=QE(u);for(;y>=0&&(b=u[y],!(C.timestamp-b.timestamp>ad(p)));)y--;if(!b)return{x:0,y:0};const M=ld(C.timestamp-b.timestamp);if(M===0)return{x:0,y:0};const D={x:(C.x-b.x)/M,y:(C.y-b.y)/M};return D.x===1/0&&(D.x=0),D.y===1/0&&(D.y=0),D}const eC=1e-4,JL=1-eC,QL=1+eC,tC=.01,ez=0-tC,tz=0+tC;function Cl(u){return u.max-u.min}function iz(u,p,y){return Math.abs(u-p)<=y}function jT(u,p,y,b=.5){u.origin=b,u.originPoint=xs(p.min,p.max,u.origin),u.scale=Cl(y)/Cl(p),u.translate=xs(y.min,y.max,u.origin)-u.originPoint,(u.scale>=JL&&u.scale<=QL||isNaN(u.scale))&&(u.scale=1),(u.translate>=ez&&u.translate<=tz||isNaN(u.translate))&&(u.translate=0)}function Mg(u,p,y,b){jT(u.x,p.x,y.x,b?b.originX:void 0),jT(u.y,p.y,y.y,b?b.originY:void 0)}function VT(u,p,y){u.min=y.min+p.min,u.max=u.min+Cl(p)}function nz(u,p,y){VT(u.x,p.x,y.x),VT(u.y,p.y,y.y)}function UT(u,p,y){u.min=p.min-y.min,u.max=u.min+Cl(p)}function Rg(u,p,y){UT(u.x,p.x,y.x),UT(u.y,p.y,y.y)}function rz(u,{min:p,max:y},b){return p!==void 0&&u<p?u=b?xs(p,u,b.min):Math.max(u,p):y!==void 0&&u>y&&(u=b?xs(y,u,b.max):Math.min(u,y)),u}function GT(u,p,y){return{min:p!==void 0?u.min+p:void 0,max:y!==void 0?u.max+y-(u.max-u.min):void 0}}function sz(u,{top:p,left:y,bottom:b,right:C}){return{x:GT(u.x,y,C),y:GT(u.y,p,b)}}function $T(u,p){let y=p.min-u.min,b=p.max-u.max;return p.max-p.min<u.max-u.min&&([y,b]=[b,y]),{min:y,max:b}}function oz(u,p){return{x:$T(u.x,p.x),y:$T(u.y,p.y)}}function az(u,p){let y=.5;const b=Cl(u),C=Cl(p);return C>b?y=dm(p.min,p.max-b,u.min):b>C&&(y=dm(u.min,u.max-C,p.min)),dd(0,1,y)}function lz(u,p){const y={};return p.min!==void 0&&(y.min=p.min-u.min),p.max!==void 0&&(y.max=p.max-u.min),y}const Qx=.35;function cz(u=Qx){return u===!1?u=0:u===!0&&(u=Qx),{x:HT(u,"left","right"),y:HT(u,"top","bottom")}}function HT(u,p,y){return{min:WT(u,p),max:WT(u,y)}}function WT(u,p){return typeof u=="number"?u:u[p]||0}const qT=()=>({translate:0,scale:1,origin:0,originPoint:0}),lm=()=>({x:qT(),y:qT()}),ZT=()=>({min:0,max:0}),Bs=()=>({x:ZT(),y:ZT()});function fc(u){return[u("x"),u("y")]}function iC({top:u,left:p,right:y,bottom:b}){return{x:{min:p,max:y},y:{min:u,max:b}}}function uz({x:u,y:p}){return{top:p.min,right:u.max,bottom:p.max,left:u.min}}function hz(u,p){if(!p)return u;const y=p({x:u.left,y:u.top}),b=p({x:u.right,y:u.bottom});return{top:y.y,left:y.x,bottom:b.y,right:b.x}}function vx(u){return u===void 0||u===1}function ev({scale:u,scaleX:p,scaleY:y}){return!vx(u)||!vx(p)||!vx(y)}function fp(u){return ev(u)||nC(u)||u.z||u.rotate||u.rotateX||u.rotateY||u.skewX||u.skewY}function nC(u){return XT(u.x)||XT(u.y)}function XT(u){return u&&u!=="0%"}function wy(u,p,y){const b=u-y,C=p*b;return y+C}function YT(u,p,y,b,C){return C!==void 0&&(u=wy(u,C,b)),wy(u,y,b)+p}function tv(u,p=0,y=1,b,C){u.min=YT(u.min,p,y,b,C),u.max=YT(u.max,p,y,b,C)}function rC(u,{x:p,y}){tv(u.x,p.translate,p.scale,p.originPoint),tv(u.y,y.translate,y.scale,y.originPoint)}const KT=.999999999999,JT=1.0000000000001;function dz(u,p,y,b=!1){const C=y.length;if(!C)return;p.x=p.y=1;let M,D;for(let r=0;r<C;r++){M=y[r],D=M.projectionDelta;const{visualElement:U}=M.options;U&&U.props.style&&U.props.style.display==="contents"||(b&&M.options.layoutScroll&&M.scroll&&M!==M.root&&um(u,{x:-M.scroll.offset.x,y:-M.scroll.offset.y}),D&&(p.x*=D.x.scale,p.y*=D.y.scale,rC(u,D)),b&&fp(M.latestValues)&&um(u,M.latestValues))}p.x<JT&&p.x>KT&&(p.x=1),p.y<JT&&p.y>KT&&(p.y=1)}function cm(u,p){u.min=u.min+p,u.max=u.max+p}function QT(u,p,y,b,C=.5){const M=xs(u.min,u.max,C);tv(u,p,y,M,b)}function um(u,p){QT(u.x,p.x,p.scaleX,p.scale,p.originX),QT(u.y,p.y,p.scaleY,p.scale,p.originY)}function sC(u,p){return iC(hz(u.getBoundingClientRect(),p))}function fz(u,p,y){const b=sC(u,y),{scroll:C}=p;return C&&(cm(b.x,C.offset.x),cm(b.y,C.offset.y)),b}const oC=({current:u})=>u?u.ownerDocument.defaultView:null,pz=new WeakMap;class mz{constructor(p){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Bs(),this.visualElement=p}start(p,{snapToCursor:y=!1}={}){const{presenceContext:b}=this.visualElement;if(b&&b.isPresent===!1)return;const C=Q=>{const{dragSnapToOrigin:se}=this.getProps();se?this.pauseAnimation():this.stopAnimation(),y&&this.snapToCursor(Yg(Q).point)},M=(Q,se)=>{const{drag:de,dragPropagation:Pe,onDragStart:Se}=this.getProps();if(de&&!Pe&&(this.openDragLock&&this.openDragLock(),this.openDragLock=aD(de),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),fc(ce=>{let ze=this.getAxisMotionValue(ce).get()||0;if(lh.test(ze)){const{projection:et}=this.visualElement;if(et&&et.layout){const pt=et.layout.layoutBox[ce];pt&&(ze=Cl(pt)*(parseFloat(ze)/100))}}this.originPoint[ce]=ze}),Se&&jr.postRender(()=>Se(Q,se)),Hx(this.visualElement,"transform");const{animationState:ve}=this.visualElement;ve&&ve.setActive("whileDrag",!0)},D=(Q,se)=>{const{dragPropagation:de,dragDirectionLock:Pe,onDirectionLock:Se,onDrag:ve}=this.getProps();if(!de&&!this.openDragLock)return;const{offset:ce}=se;if(Pe&&this.currentDirection===null){this.currentDirection=gz(ce),this.currentDirection!==null&&Se&&Se(this.currentDirection);return}this.updateAxis("x",se.point,ce),this.updateAxis("y",se.point,ce),this.visualElement.render(),ve&&ve(Q,se)},r=(Q,se)=>this.stop(Q,se),U=()=>fc(Q=>{var se;return this.getAnimationState(Q)==="paused"&&((se=this.getAxisMotionValue(Q).animation)===null||se===void 0?void 0:se.play())}),{dragSnapToOrigin:G}=this.getProps();this.panSession=new JE(p,{onSessionStart:C,onStart:M,onMove:D,onSessionEnd:r,resumeAnimation:U},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:G,contextWindow:oC(this.visualElement)})}stop(p,y){const b=this.isDragging;if(this.cancel(),!b)return;const{velocity:C}=y;this.startAnimation(C);const{onDragEnd:M}=this.getProps();M&&jr.postRender(()=>M(p,y))}cancel(){this.isDragging=!1;const{projection:p,animationState:y}=this.visualElement;p&&(p.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:b}=this.getProps();!b&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),y&&y.setActive("whileDrag",!1)}updateAxis(p,y,b){const{drag:C}=this.getProps();if(!b||!J_(p,C,this.currentDirection))return;const M=this.getAxisMotionValue(p);let D=this.originPoint[p]+b[p];this.constraints&&this.constraints[p]&&(D=rz(D,this.constraints[p],this.elastic[p])),M.set(D)}resolveConstraints(){var p;const{dragConstraints:y,dragElastic:b}=this.getProps(),C=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(p=this.visualElement.projection)===null||p===void 0?void 0:p.layout,M=this.constraints;y&&om(y)?this.constraints||(this.constraints=this.resolveRefConstraints()):y&&C?this.constraints=sz(C.layoutBox,y):this.constraints=!1,this.elastic=cz(b),M!==this.constraints&&C&&this.constraints&&!this.hasMutatedConstraints&&fc(D=>{this.constraints!==!1&&this.getAxisMotionValue(D)&&(this.constraints[D]=lz(C.layoutBox[D],this.constraints[D]))})}resolveRefConstraints(){const{dragConstraints:p,onMeasureDragConstraints:y}=this.getProps();if(!p||!om(p))return!1;const b=p.current,{projection:C}=this.visualElement;if(!C||!C.layout)return!1;const M=fz(b,C.root,this.visualElement.getTransformPagePoint());let D=oz(C.layout.layoutBox,M);if(y){const r=y(uz(D));this.hasMutatedConstraints=!!r,r&&(D=iC(r))}return D}startAnimation(p){const{drag:y,dragMomentum:b,dragElastic:C,dragTransition:M,dragSnapToOrigin:D,onDragTransitionEnd:r}=this.getProps(),U=this.constraints||{},G=fc(Q=>{if(!J_(Q,y,this.currentDirection))return;let se=U&&U[Q]||{};D&&(se={min:0,max:0});const de=C?200:1e6,Pe=C?40:1e7,Se={type:"inertia",velocity:b?p[Q]:0,bounceStiffness:de,bounceDamping:Pe,timeConstant:750,restDelta:1,restSpeed:10,...M,...se};return this.startAxisValueAnimation(Q,Se)});return Promise.all(G).then(r)}startAxisValueAnimation(p,y){const b=this.getAxisMotionValue(p);return Hx(this.visualElement,p),b.start(e1(p,b,0,y,this.visualElement,!1))}stopAnimation(){fc(p=>this.getAxisMotionValue(p).stop())}pauseAnimation(){fc(p=>{var y;return(y=this.getAxisMotionValue(p).animation)===null||y===void 0?void 0:y.pause()})}getAnimationState(p){var y;return(y=this.getAxisMotionValue(p).animation)===null||y===void 0?void 0:y.state}getAxisMotionValue(p){const y=`_drag${p.toUpperCase()}`,b=this.visualElement.getProps(),C=b[y];return C||this.visualElement.getValue(p,(b.initial?b.initial[p]:void 0)||0)}snapToCursor(p){fc(y=>{const{drag:b}=this.getProps();if(!J_(y,b,this.currentDirection))return;const{projection:C}=this.visualElement,M=this.getAxisMotionValue(y);if(C&&C.layout){const{min:D,max:r}=C.layout.layoutBox[y];M.set(p[y]-xs(D,r,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:p,dragConstraints:y}=this.getProps(),{projection:b}=this.visualElement;if(!om(y)||!b||!this.constraints)return;this.stopAnimation();const C={x:0,y:0};fc(D=>{const r=this.getAxisMotionValue(D);if(r&&this.constraints!==!1){const U=r.get();C[D]=az({min:U,max:U},this.constraints[D])}});const{transformTemplate:M}=this.visualElement.getProps();this.visualElement.current.style.transform=M?M({},""):"none",b.root&&b.root.updateScroll(),b.updateLayout(),this.resolveConstraints(),fc(D=>{if(!J_(D,p,null))return;const r=this.getAxisMotionValue(D),{min:U,max:G}=this.constraints[D];r.set(xs(U,G,C[D]))})}addListeners(){if(!this.visualElement.current)return;pz.set(this.visualElement,this);const p=this.visualElement.current,y=Pg(p,"pointerdown",U=>{const{drag:G,dragListener:Q=!0}=this.getProps();G&&Q&&this.start(U)}),b=()=>{const{dragConstraints:U}=this.getProps();om(U)&&U.current&&(this.constraints=this.resolveRefConstraints())},{projection:C}=this.visualElement,M=C.addEventListener("measure",b);C&&!C.layout&&(C.root&&C.root.updateScroll(),C.updateLayout()),jr.read(b);const D=Ng(window,"resize",()=>this.scalePositionWithinConstraints()),r=C.addEventListener("didUpdate",({delta:U,hasLayoutChanged:G})=>{this.isDragging&&G&&(fc(Q=>{const se=this.getAxisMotionValue(Q);se&&(this.originPoint[Q]+=U[Q].translate,se.set(se.get()+U[Q].translate))}),this.visualElement.render())});return()=>{D(),y(),M(),r&&r()}}getProps(){const p=this.visualElement.getProps(),{drag:y=!1,dragDirectionLock:b=!1,dragPropagation:C=!1,dragConstraints:M=!1,dragElastic:D=Qx,dragMomentum:r=!0}=p;return{...p,drag:y,dragDirectionLock:b,dragPropagation:C,dragConstraints:M,dragElastic:D,dragMomentum:r}}}function J_(u,p,y){return(p===!0||p===u)&&(y===null||y===u)}function gz(u,p=10){let y=null;return Math.abs(u.y)>p?y="y":Math.abs(u.x)>p&&(y="x"),y}class _z extends Sf{constructor(p){super(p),this.removeGroupControls=El,this.removeListeners=El,this.controls=new mz(p)}mount(){const{dragControls:p}=this.node.getProps();p&&(this.removeGroupControls=p.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||El}unmount(){this.removeGroupControls(),this.removeListeners()}}const eS=u=>(p,y)=>{u&&jr.postRender(()=>u(p,y))};class yz extends Sf{constructor(){super(...arguments),this.removePointerDownListener=El}onPointerDown(p){this.session=new JE(p,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:oC(this.node)})}createPanHandlers(){const{onPanSessionStart:p,onPanStart:y,onPan:b,onPanEnd:C}=this.node.getProps();return{onSessionStart:eS(p),onStart:eS(y),onMove:b,onEnd:(M,D)=>{delete this.session,C&&jr.postRender(()=>C(M,D))}}}mount(){this.removePointerDownListener=Pg(this.node.current,"pointerdown",p=>this.onPointerDown(p))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const sy={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function tS(u,p){return p.max===p.min?0:u/(p.max-p.min)*100}const yg={correct:(u,p)=>{if(!p.target)return u;if(typeof u=="string")if(Cn.test(u))u=parseFloat(u);else return u;const y=tS(u,p.target.x),b=tS(u,p.target.y);return`${y}% ${b}%`}},xz={correct:(u,{treeScale:p,projectionDelta:y})=>{const b=u,C=wf.parse(u);if(C.length>5)return b;const M=wf.createTransformer(u),D=typeof C[0]!="number"?1:0,r=y.x.scale*p.x,U=y.y.scale*p.y;C[0+D]/=r,C[1+D]/=U;const G=xs(r,U,.5);return typeof C[2+D]=="number"&&(C[2+D]/=G),typeof C[3+D]=="number"&&(C[3+D]/=G),M(C)}};class vz extends Fe.Component{componentDidMount(){const{visualElement:p,layoutGroup:y,switchLayoutGroup:b,layoutId:C}=this.props,{projection:M}=p;jk(wz),M&&(y.group&&y.group.add(M),b&&b.register&&C&&b.register(M),M.root.didUpdate(),M.addEventListener("animationComplete",()=>{this.safeToRemove()}),M.setOptions({...M.options,onExitComplete:()=>this.safeToRemove()})),sy.hasEverUpdated=!0}getSnapshotBeforeUpdate(p){const{layoutDependency:y,visualElement:b,drag:C,isPresent:M}=this.props,D=b.projection;return D&&(D.isPresent=M,C||p.layoutDependency!==y||y===void 0?D.willUpdate():this.safeToRemove(),p.isPresent!==M&&(M?D.promote():D.relegate()||jr.postRender(()=>{const r=D.getStack();(!r||!r.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:p}=this.props.visualElement;p&&(p.root.didUpdate(),Mv.postRender(()=>{!p.currentAnimation&&p.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:p,layoutGroup:y,switchLayoutGroup:b}=this.props,{projection:C}=p;C&&(C.scheduleCheckAfterUnmount(),y&&y.group&&y.group.remove(C),b&&b.deregister&&b.deregister(C))}safeToRemove(){const{safeToRemove:p}=this.props;p&&p()}render(){return null}}function aC(u){const[p,y]=G3(),b=Fe.useContext(Sv);return V.jsx(vz,{...u,layoutGroup:b,switchLayoutGroup:Fe.useContext(Y3),isPresent:p,safeToRemove:y})}const wz={borderRadius:{...yg,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:yg,borderTopRightRadius:yg,borderBottomLeftRadius:yg,borderBottomRightRadius:yg,boxShadow:xz};function bz(u,p,y){const b=Ro(u)?u:pm(u);return b.start(e1("",b,p,y)),b.animation}function Tz(u){return u instanceof SVGElement&&u.tagName!=="svg"}const Sz=(u,p)=>u.depth-p.depth;class Ez{constructor(){this.children=[],this.isDirty=!1}add(p){$v(this.children,p),this.isDirty=!0}remove(p){Hv(this.children,p),this.isDirty=!0}forEach(p){this.isDirty&&this.children.sort(Sz),this.isDirty=!1,this.children.forEach(p)}}function Cz(u,p){const y=ch.now(),b=({timestamp:C})=>{const M=C-y;M>=p&&(hd(b),u(M-p))};return jr.read(b,!0),()=>hd(b)}const lC=["TopLeft","TopRight","BottomLeft","BottomRight"],Az=lC.length,iS=u=>typeof u=="string"?parseFloat(u):u,nS=u=>typeof u=="number"||Cn.test(u);function Iz(u,p,y,b,C,M){C?(u.opacity=xs(0,y.opacity!==void 0?y.opacity:1,Pz(b)),u.opacityExit=xs(p.opacity!==void 0?p.opacity:1,0,Mz(b))):M&&(u.opacity=xs(p.opacity!==void 0?p.opacity:1,y.opacity!==void 0?y.opacity:1,b));for(let D=0;D<Az;D++){const r=`border${lC[D]}Radius`;let U=rS(p,r),G=rS(y,r);if(U===void 0&&G===void 0)continue;U||(U=0),G||(G=0),U===0||G===0||nS(U)===nS(G)?(u[r]=Math.max(xs(iS(U),iS(G),b),0),(lh.test(G)||lh.test(U))&&(u[r]+="%")):u[r]=G}(p.rotate||y.rotate)&&(u.rotate=xs(p.rotate||0,y.rotate||0,b))}function rS(u,p){return u[p]!==void 0?u[p]:u.borderRadius}const Pz=cC(0,.5,CE),Mz=cC(.5,.95,El);function cC(u,p,y){return b=>b<u?0:b>p?1:y(dm(u,p,b))}function sS(u,p){u.min=p.min,u.max=p.max}function dc(u,p){sS(u.x,p.x),sS(u.y,p.y)}function oS(u,p){u.translate=p.translate,u.scale=p.scale,u.originPoint=p.originPoint,u.origin=p.origin}function aS(u,p,y,b,C){return u-=p,u=wy(u,1/y,b),C!==void 0&&(u=wy(u,1/C,b)),u}function Rz(u,p=0,y=1,b=.5,C,M=u,D=u){if(lh.test(p)&&(p=parseFloat(p),p=xs(D.min,D.max,p/100)-D.min),typeof p!="number")return;let r=xs(M.min,M.max,b);u===M&&(r-=p),u.min=aS(u.min,p,y,r,C),u.max=aS(u.max,p,y,r,C)}function lS(u,p,[y,b,C],M,D){Rz(u,p[y],p[b],p[C],p.scale,M,D)}const kz=["x","scaleX","originX"],Dz=["y","scaleY","originY"];function cS(u,p,y,b){lS(u.x,p,kz,y?y.x:void 0,b?b.x:void 0),lS(u.y,p,Dz,y?y.y:void 0,b?b.y:void 0)}function uS(u){return u.translate===0&&u.scale===1}function uC(u){return uS(u.x)&&uS(u.y)}function hS(u,p){return u.min===p.min&&u.max===p.max}function Lz(u,p){return hS(u.x,p.x)&&hS(u.y,p.y)}function dS(u,p){return Math.round(u.min)===Math.round(p.min)&&Math.round(u.max)===Math.round(p.max)}function hC(u,p){return dS(u.x,p.x)&&dS(u.y,p.y)}function fS(u){return Cl(u.x)/Cl(u.y)}function pS(u,p){return u.translate===p.translate&&u.scale===p.scale&&u.originPoint===p.originPoint}class zz{constructor(){this.members=[]}add(p){$v(this.members,p),p.scheduleRender()}remove(p){if(Hv(this.members,p),p===this.prevLead&&(this.prevLead=void 0),p===this.lead){const y=this.members[this.members.length-1];y&&this.promote(y)}}relegate(p){const y=this.members.findIndex(C=>p===C);if(y===0)return!1;let b;for(let C=y;C>=0;C--){const M=this.members[C];if(M.isPresent!==!1){b=M;break}}return b?(this.promote(b),!0):!1}promote(p,y){const b=this.lead;if(p!==b&&(this.prevLead=b,this.lead=p,p.show(),b)){b.instance&&b.scheduleRender(),p.scheduleRender(),p.resumeFrom=b,y&&(p.resumeFrom.preserveOpacity=!0),b.snapshot&&(p.snapshot=b.snapshot,p.snapshot.latestValues=b.animationValues||b.latestValues),p.root&&p.root.isUpdating&&(p.isLayoutDirty=!0);const{crossfade:C}=p.options;C===!1&&b.hide()}}exitAnimationComplete(){this.members.forEach(p=>{const{options:y,resumingFrom:b}=p;y.onExitComplete&&y.onExitComplete(),b&&b.options.onExitComplete&&b.options.onExitComplete()})}scheduleRender(){this.members.forEach(p=>{p.instance&&p.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function Fz(u,p,y){let b="";const C=u.x.translate/p.x,M=u.y.translate/p.y,D=(y==null?void 0:y.z)||0;if((C||M||D)&&(b=`translate3d(${C}px, ${M}px, ${D}px) `),(p.x!==1||p.y!==1)&&(b+=`scale(${1/p.x}, ${1/p.y}) `),y){const{transformPerspective:G,rotate:Q,rotateX:se,rotateY:de,skewX:Pe,skewY:Se}=y;G&&(b=`perspective(${G}px) ${b}`),Q&&(b+=`rotate(${Q}deg) `),se&&(b+=`rotateX(${se}deg) `),de&&(b+=`rotateY(${de}deg) `),Pe&&(b+=`skewX(${Pe}deg) `),Se&&(b+=`skewY(${Se}deg) `)}const r=u.x.scale*p.x,U=u.y.scale*p.y;return(r!==1||U!==1)&&(b+=`scale(${r}, ${U})`),b||"none"}const pp={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Tg=typeof window<"u"&&window.MotionDebug!==void 0,wx=["","X","Y","Z"],Oz={visibility:"hidden"},mS=1e3;let Nz=0;function bx(u,p,y,b){const{latestValues:C}=p;C[u]&&(y[u]=C[u],p.setStaticValue(u,0),b&&(b[u]=0))}function dC(u){if(u.hasCheckedOptimisedAppear=!0,u.root===u)return;const{visualElement:p}=u.options;if(!p)return;const y=xE(p);if(window.MotionHasOptimisedAnimation(y,"transform")){const{layout:C,layoutId:M}=u.options;window.MotionCancelOptimisedAnimation(y,"transform",jr,!(C||M))}const{parent:b}=u;b&&!b.hasCheckedOptimisedAppear&&dC(b)}function fC({attachResizeListener:u,defaultParent:p,measureScroll:y,checkIsScrollRoot:b,resetTransform:C}){return class{constructor(D={},r=p==null?void 0:p()){this.id=Nz++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Tg&&(pp.totalNodes=pp.resolvedTargetDeltas=pp.recalculatedProjection=0),this.nodes.forEach(Vz),this.nodes.forEach(Wz),this.nodes.forEach(qz),this.nodes.forEach(Uz),Tg&&window.MotionDebug.record(pp)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=D,this.root=r?r.root||r:this,this.path=r?[...r.path,r]:[],this.parent=r,this.depth=r?r.depth+1:0;for(let U=0;U<this.path.length;U++)this.path[U].shouldResetTransform=!0;this.root===this&&(this.nodes=new Ez)}addEventListener(D,r){return this.eventHandlers.has(D)||this.eventHandlers.set(D,new Wv),this.eventHandlers.get(D).add(r)}notifyListeners(D,...r){const U=this.eventHandlers.get(D);U&&U.notify(...r)}hasListeners(D){return this.eventHandlers.has(D)}mount(D,r=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Tz(D),this.instance=D;const{layoutId:U,layout:G,visualElement:Q}=this.options;if(Q&&!Q.current&&Q.mount(D),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),r&&(G||U)&&(this.isLayoutDirty=!0),u){let se;const de=()=>this.root.updateBlockedByResize=!1;u(D,()=>{this.root.updateBlockedByResize=!0,se&&se(),se=Cz(de,250),sy.hasAnimatedSinceResize&&(sy.hasAnimatedSinceResize=!1,this.nodes.forEach(_S))})}U&&this.root.registerSharedNode(U,this),this.options.animate!==!1&&Q&&(U||G)&&this.addEventListener("didUpdate",({delta:se,hasLayoutChanged:de,hasRelativeTargetChanged:Pe,layout:Se})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const ve=this.options.transition||Q.getDefaultTransition()||Jz,{onLayoutAnimationStart:ce,onLayoutAnimationComplete:ze}=Q.getProps(),et=!this.targetLayout||!hC(this.targetLayout,Se)||Pe,pt=!de&&Pe;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||pt||de&&(et||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(se,pt);const Tt={...jv(ve,"layout"),onPlay:ce,onComplete:ze};(Q.shouldReduceMotion||this.options.layoutRoot)&&(Tt.delay=0,Tt.type=!1),this.startAnimation(Tt)}else de||_S(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=Se})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const D=this.getStack();D&&D.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,hd(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Zz),this.animationId++)}getTransformTemplate(){const{visualElement:D}=this.options;return D&&D.getProps().transformTemplate}willUpdate(D=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&dC(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let Q=0;Q<this.path.length;Q++){const se=this.path[Q];se.shouldResetTransform=!0,se.updateScroll("snapshot"),se.options.layoutRoot&&se.willUpdate(!1)}const{layoutId:r,layout:U}=this.options;if(r===void 0&&!U)return;const G=this.getTransformTemplate();this.prevTransformTemplateValue=G?G(this.latestValues,""):void 0,this.updateSnapshot(),D&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(gS);return}this.isUpdating||this.nodes.forEach($z),this.isUpdating=!1,this.nodes.forEach(Hz),this.nodes.forEach(Bz),this.nodes.forEach(jz),this.clearAllSnapshots();const r=ch.now();Mo.delta=dd(0,1e3/60,r-Mo.timestamp),Mo.timestamp=r,Mo.isProcessing=!0,dx.update.process(Mo),dx.preRender.process(Mo),dx.render.process(Mo),Mo.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Mv.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Gz),this.sharedNodes.forEach(Xz)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,jr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){jr.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let U=0;U<this.path.length;U++)this.path[U].updateScroll();const D=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Bs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:r}=this.options;r&&r.notify("LayoutMeasure",this.layout.layoutBox,D?D.layoutBox:void 0)}updateScroll(D="measure"){let r=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===D&&(r=!1),r){const U=b(this.instance);this.scroll={animationId:this.root.animationId,phase:D,isRoot:U,offset:y(this.instance),wasRoot:this.scroll?this.scroll.isRoot:U}}}resetTransform(){if(!C)return;const D=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,r=this.projectionDelta&&!uC(this.projectionDelta),U=this.getTransformTemplate(),G=U?U(this.latestValues,""):void 0,Q=G!==this.prevTransformTemplateValue;D&&(r||fp(this.latestValues)||Q)&&(C(this.instance,G),this.shouldResetTransform=!1,this.scheduleRender())}measure(D=!0){const r=this.measurePageBox();let U=this.removeElementScroll(r);return D&&(U=this.removeTransform(U)),Qz(U),{animationId:this.root.animationId,measuredBox:r,layoutBox:U,latestValues:{},source:this.id}}measurePageBox(){var D;const{visualElement:r}=this.options;if(!r)return Bs();const U=r.measureViewportBox();if(!(((D=this.scroll)===null||D===void 0?void 0:D.wasRoot)||this.path.some(e6))){const{scroll:Q}=this.root;Q&&(cm(U.x,Q.offset.x),cm(U.y,Q.offset.y))}return U}removeElementScroll(D){var r;const U=Bs();if(dc(U,D),!((r=this.scroll)===null||r===void 0)&&r.wasRoot)return U;for(let G=0;G<this.path.length;G++){const Q=this.path[G],{scroll:se,options:de}=Q;Q!==this.root&&se&&de.layoutScroll&&(se.wasRoot&&dc(U,D),cm(U.x,se.offset.x),cm(U.y,se.offset.y))}return U}applyTransform(D,r=!1){const U=Bs();dc(U,D);for(let G=0;G<this.path.length;G++){const Q=this.path[G];!r&&Q.options.layoutScroll&&Q.scroll&&Q!==Q.root&&um(U,{x:-Q.scroll.offset.x,y:-Q.scroll.offset.y}),fp(Q.latestValues)&&um(U,Q.latestValues)}return fp(this.latestValues)&&um(U,this.latestValues),U}removeTransform(D){const r=Bs();dc(r,D);for(let U=0;U<this.path.length;U++){const G=this.path[U];if(!G.instance||!fp(G.latestValues))continue;ev(G.latestValues)&&G.updateSnapshot();const Q=Bs(),se=G.measurePageBox();dc(Q,se),cS(r,G.latestValues,G.snapshot?G.snapshot.layoutBox:void 0,Q)}return fp(this.latestValues)&&cS(r,this.latestValues),r}setTargetDelta(D){this.targetDelta=D,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(D){this.options={...this.options,...D,crossfade:D.crossfade!==void 0?D.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Mo.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(D=!1){var r;const U=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=U.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=U.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=U.isSharedProjectionDirty);const G=!!this.resumingFrom||this!==U;if(!(D||G&&this.isSharedProjectionDirty||this.isProjectionDirty||!((r=this.parent)===null||r===void 0)&&r.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:se,layoutId:de}=this.options;if(!(!this.layout||!(se||de))){if(this.resolvedRelativeTargetAt=Mo.timestamp,!this.targetDelta&&!this.relativeTarget){const Pe=this.getClosestProjectingParent();Pe&&Pe.layout&&this.animationProgress!==1?(this.relativeParent=Pe,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Bs(),this.relativeTargetOrigin=Bs(),Rg(this.relativeTargetOrigin,this.layout.layoutBox,Pe.layout.layoutBox),dc(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Bs(),this.targetWithTransforms=Bs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),nz(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):dc(this.target,this.layout.layoutBox),rC(this.target,this.targetDelta)):dc(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const Pe=this.getClosestProjectingParent();Pe&&!!Pe.resumingFrom==!!this.resumingFrom&&!Pe.options.layoutScroll&&Pe.target&&this.animationProgress!==1?(this.relativeParent=Pe,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Bs(),this.relativeTargetOrigin=Bs(),Rg(this.relativeTargetOrigin,this.target,Pe.target),dc(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Tg&&pp.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||ev(this.parent.latestValues)||nC(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var D;const r=this.getLead(),U=!!this.resumingFrom||this!==r;let G=!0;if((this.isProjectionDirty||!((D=this.parent)===null||D===void 0)&&D.isProjectionDirty)&&(G=!1),U&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(G=!1),this.resolvedRelativeTargetAt===Mo.timestamp&&(G=!1),G)return;const{layout:Q,layoutId:se}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(Q||se))return;dc(this.layoutCorrected,this.layout.layoutBox);const de=this.treeScale.x,Pe=this.treeScale.y;dz(this.layoutCorrected,this.treeScale,this.path,U),r.layout&&!r.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(r.target=r.layout.layoutBox,r.targetWithTransforms=Bs());const{target:Se}=r;if(!Se){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(oS(this.prevProjectionDelta.x,this.projectionDelta.x),oS(this.prevProjectionDelta.y,this.projectionDelta.y)),Mg(this.projectionDelta,this.layoutCorrected,Se,this.latestValues),(this.treeScale.x!==de||this.treeScale.y!==Pe||!pS(this.projectionDelta.x,this.prevProjectionDelta.x)||!pS(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",Se)),Tg&&pp.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(D=!0){var r;if((r=this.options.visualElement)===null||r===void 0||r.scheduleRender(),D){const U=this.getStack();U&&U.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=lm(),this.projectionDelta=lm(),this.projectionDeltaWithTransform=lm()}setAnimationOrigin(D,r=!1){const U=this.snapshot,G=U?U.latestValues:{},Q={...this.latestValues},se=lm();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!r;const de=Bs(),Pe=U?U.source:void 0,Se=this.layout?this.layout.source:void 0,ve=Pe!==Se,ce=this.getStack(),ze=!ce||ce.members.length<=1,et=!!(ve&&!ze&&this.options.crossfade===!0&&!this.path.some(Kz));this.animationProgress=0;let pt;this.mixTargetDelta=Tt=>{const It=Tt/1e3;yS(se.x,D.x,It),yS(se.y,D.y,It),this.setTargetDelta(se),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Rg(de,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Yz(this.relativeTarget,this.relativeTargetOrigin,de,It),pt&&Lz(this.relativeTarget,pt)&&(this.isProjectionDirty=!1),pt||(pt=Bs()),dc(pt,this.relativeTarget)),ve&&(this.animationValues=Q,Iz(Q,G,this.latestValues,It,et,ze)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=It},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(D){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(hd(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=jr.update(()=>{sy.hasAnimatedSinceResize=!0,this.currentAnimation=bz(0,mS,{...D,onUpdate:r=>{this.mixTargetDelta(r),D.onUpdate&&D.onUpdate(r)},onComplete:()=>{D.onComplete&&D.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const D=this.getStack();D&&D.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(mS),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const D=this.getLead();let{targetWithTransforms:r,target:U,layout:G,latestValues:Q}=D;if(!(!r||!U||!G)){if(this!==D&&this.layout&&G&&pC(this.options.animationType,this.layout.layoutBox,G.layoutBox)){U=this.target||Bs();const se=Cl(this.layout.layoutBox.x);U.x.min=D.target.x.min,U.x.max=U.x.min+se;const de=Cl(this.layout.layoutBox.y);U.y.min=D.target.y.min,U.y.max=U.y.min+de}dc(r,U),um(r,Q),Mg(this.projectionDeltaWithTransform,this.layoutCorrected,r,Q)}}registerSharedNode(D,r){this.sharedNodes.has(D)||this.sharedNodes.set(D,new zz),this.sharedNodes.get(D).add(r);const G=r.options.initialPromotionConfig;r.promote({transition:G?G.transition:void 0,preserveFollowOpacity:G&&G.shouldPreserveFollowOpacity?G.shouldPreserveFollowOpacity(r):void 0})}isLead(){const D=this.getStack();return D?D.lead===this:!0}getLead(){var D;const{layoutId:r}=this.options;return r?((D=this.getStack())===null||D===void 0?void 0:D.lead)||this:this}getPrevLead(){var D;const{layoutId:r}=this.options;return r?(D=this.getStack())===null||D===void 0?void 0:D.prevLead:void 0}getStack(){const{layoutId:D}=this.options;if(D)return this.root.sharedNodes.get(D)}promote({needsReset:D,transition:r,preserveFollowOpacity:U}={}){const G=this.getStack();G&&G.promote(this,U),D&&(this.projectionDelta=void 0,this.needsReset=!0),r&&this.setOptions({transition:r})}relegate(){const D=this.getStack();return D?D.relegate(this):!1}resetSkewAndRotation(){const{visualElement:D}=this.options;if(!D)return;let r=!1;const{latestValues:U}=D;if((U.z||U.rotate||U.rotateX||U.rotateY||U.rotateZ||U.skewX||U.skewY)&&(r=!0),!r)return;const G={};U.z&&bx("z",D,G,this.animationValues);for(let Q=0;Q<wx.length;Q++)bx(`rotate${wx[Q]}`,D,G,this.animationValues),bx(`skew${wx[Q]}`,D,G,this.animationValues);D.render();for(const Q in G)D.setStaticValue(Q,G[Q]),this.animationValues&&(this.animationValues[Q]=G[Q]);D.scheduleRender()}getProjectionStyles(D){var r,U;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Oz;const G={visibility:""},Q=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,G.opacity="",G.pointerEvents=ny(D==null?void 0:D.pointerEvents)||"",G.transform=Q?Q(this.latestValues,""):"none",G;const se=this.getLead();if(!this.projectionDelta||!this.layout||!se.target){const ve={};return this.options.layoutId&&(ve.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,ve.pointerEvents=ny(D==null?void 0:D.pointerEvents)||""),this.hasProjected&&!fp(this.latestValues)&&(ve.transform=Q?Q({},""):"none",this.hasProjected=!1),ve}const de=se.animationValues||se.latestValues;this.applyTransformsToTarget(),G.transform=Fz(this.projectionDeltaWithTransform,this.treeScale,de),Q&&(G.transform=Q(de,G.transform));const{x:Pe,y:Se}=this.projectionDelta;G.transformOrigin=`${Pe.origin*100}% ${Se.origin*100}% 0`,se.animationValues?G.opacity=se===this?(U=(r=de.opacity)!==null&&r!==void 0?r:this.latestValues.opacity)!==null&&U!==void 0?U:1:this.preserveOpacity?this.latestValues.opacity:de.opacityExit:G.opacity=se===this?de.opacity!==void 0?de.opacity:"":de.opacityExit!==void 0?de.opacityExit:0;for(const ve in gy){if(de[ve]===void 0)continue;const{correct:ce,applyTo:ze}=gy[ve],et=G.transform==="none"?de[ve]:ce(de[ve],se);if(ze){const pt=ze.length;for(let Tt=0;Tt<pt;Tt++)G[ze[Tt]]=et}else G[ve]=et}return this.options.layoutId&&(G.pointerEvents=se===this?ny(D==null?void 0:D.pointerEvents)||"":"none"),G}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(D=>{var r;return(r=D.currentAnimation)===null||r===void 0?void 0:r.stop()}),this.root.nodes.forEach(gS),this.root.sharedNodes.clear()}}}function Bz(u){u.updateLayout()}function jz(u){var p;const y=((p=u.resumeFrom)===null||p===void 0?void 0:p.snapshot)||u.snapshot;if(u.isLead()&&u.layout&&y&&u.hasListeners("didUpdate")){const{layoutBox:b,measuredBox:C}=u.layout,{animationType:M}=u.options,D=y.source!==u.layout.source;M==="size"?fc(se=>{const de=D?y.measuredBox[se]:y.layoutBox[se],Pe=Cl(de);de.min=b[se].min,de.max=de.min+Pe}):pC(M,y.layoutBox,b)&&fc(se=>{const de=D?y.measuredBox[se]:y.layoutBox[se],Pe=Cl(b[se]);de.max=de.min+Pe,u.relativeTarget&&!u.currentAnimation&&(u.isProjectionDirty=!0,u.relativeTarget[se].max=u.relativeTarget[se].min+Pe)});const r=lm();Mg(r,b,y.layoutBox);const U=lm();D?Mg(U,u.applyTransform(C,!0),y.measuredBox):Mg(U,b,y.layoutBox);const G=!uC(r);let Q=!1;if(!u.resumeFrom){const se=u.getClosestProjectingParent();if(se&&!se.resumeFrom){const{snapshot:de,layout:Pe}=se;if(de&&Pe){const Se=Bs();Rg(Se,y.layoutBox,de.layoutBox);const ve=Bs();Rg(ve,b,Pe.layoutBox),hC(Se,ve)||(Q=!0),se.options.layoutRoot&&(u.relativeTarget=ve,u.relativeTargetOrigin=Se,u.relativeParent=se)}}}u.notifyListeners("didUpdate",{layout:b,snapshot:y,delta:U,layoutDelta:r,hasLayoutChanged:G,hasRelativeTargetChanged:Q})}else if(u.isLead()){const{onExitComplete:b}=u.options;b&&b()}u.options.transition=void 0}function Vz(u){Tg&&pp.totalNodes++,u.parent&&(u.isProjecting()||(u.isProjectionDirty=u.parent.isProjectionDirty),u.isSharedProjectionDirty||(u.isSharedProjectionDirty=!!(u.isProjectionDirty||u.parent.isProjectionDirty||u.parent.isSharedProjectionDirty)),u.isTransformDirty||(u.isTransformDirty=u.parent.isTransformDirty))}function Uz(u){u.isProjectionDirty=u.isSharedProjectionDirty=u.isTransformDirty=!1}function Gz(u){u.clearSnapshot()}function gS(u){u.clearMeasurements()}function $z(u){u.isLayoutDirty=!1}function Hz(u){const{visualElement:p}=u.options;p&&p.getProps().onBeforeLayoutMeasure&&p.notify("BeforeLayoutMeasure"),u.resetTransform()}function _S(u){u.finishAnimation(),u.targetDelta=u.relativeTarget=u.target=void 0,u.isProjectionDirty=!0}function Wz(u){u.resolveTargetDelta()}function qz(u){u.calcProjection()}function Zz(u){u.resetSkewAndRotation()}function Xz(u){u.removeLeadSnapshot()}function yS(u,p,y){u.translate=xs(p.translate,0,y),u.scale=xs(p.scale,1,y),u.origin=p.origin,u.originPoint=p.originPoint}function xS(u,p,y,b){u.min=xs(p.min,y.min,b),u.max=xs(p.max,y.max,b)}function Yz(u,p,y,b){xS(u.x,p.x,y.x,b),xS(u.y,p.y,y.y,b)}function Kz(u){return u.animationValues&&u.animationValues.opacityExit!==void 0}const Jz={duration:.45,ease:[.4,0,.1,1]},vS=u=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(u),wS=vS("applewebkit/")&&!vS("chrome/")?Math.round:El;function bS(u){u.min=wS(u.min),u.max=wS(u.max)}function Qz(u){bS(u.x),bS(u.y)}function pC(u,p,y){return u==="position"||u==="preserve-aspect"&&!iz(fS(p),fS(y),.2)}function e6(u){var p;return u!==u.root&&((p=u.scroll)===null||p===void 0?void 0:p.wasRoot)}const t6=fC({attachResizeListener:(u,p)=>Ng(u,"resize",p),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Tx={current:void 0},mC=fC({measureScroll:u=>({x:u.scrollLeft,y:u.scrollTop}),defaultParent:()=>{if(!Tx.current){const u=new t6({});u.mount(window),u.setOptions({layoutScroll:!0}),Tx.current=u}return Tx.current},resetTransform:(u,p)=>{u.style.transform=p!==void 0?p:"none"},checkIsScrollRoot:u=>window.getComputedStyle(u).position==="fixed"}),i6={pan:{Feature:yz},drag:{Feature:_z,ProjectionNode:mC,MeasureLayout:aC}};function TS(u,p,y){const{props:b}=u;u.animationState&&b.whileHover&&u.animationState.setActive("whileHover",y==="Start");const C="onHover"+y,M=b[C];M&&jr.postRender(()=>M(p,Yg(p)))}class n6 extends Sf{mount(){const{current:p}=this.node;p&&(this.unmount=iD(p,y=>(TS(this.node,y,"Start"),b=>TS(this.node,b,"End"))))}unmount(){}}class r6 extends Sf{constructor(){super(...arguments),this.isActive=!1}onFocus(){let p=!1;try{p=this.node.current.matches(":focus-visible")}catch{p=!0}!p||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Xg(Ng(this.node.current,"focus",()=>this.onFocus()),Ng(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function SS(u,p,y){const{props:b}=u;u.animationState&&b.whileTap&&u.animationState.setActive("whileTap",y==="Start");const C="onTap"+(y==="End"?"":y),M=b[C];M&&jr.postRender(()=>M(p,Yg(p)))}class s6 extends Sf{mount(){const{current:p}=this.node;p&&(this.unmount=oD(p,y=>(SS(this.node,y,"Start"),(b,{success:C})=>SS(this.node,b,C?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const iv=new WeakMap,Sx=new WeakMap,o6=u=>{const p=iv.get(u.target);p&&p(u)},a6=u=>{u.forEach(o6)};function l6({root:u,...p}){const y=u||document;Sx.has(y)||Sx.set(y,{});const b=Sx.get(y),C=JSON.stringify(p);return b[C]||(b[C]=new IntersectionObserver(a6,{root:u,...p})),b[C]}function c6(u,p,y){const b=l6(p);return iv.set(u,y),b.observe(u),()=>{iv.delete(u),b.unobserve(u)}}const u6={some:0,all:1};class h6 extends Sf{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:p={}}=this.node.getProps(),{root:y,margin:b,amount:C="some",once:M}=p,D={root:y?y.current:void 0,rootMargin:b,threshold:typeof C=="number"?C:u6[C]},r=U=>{const{isIntersecting:G}=U;if(this.isInView===G||(this.isInView=G,M&&!G&&this.hasEnteredView))return;G&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",G);const{onViewportEnter:Q,onViewportLeave:se}=this.node.getProps(),de=G?Q:se;de&&de(U)};return c6(this.node.current,D,r)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:p,prevProps:y}=this.node;["amount","margin","root"].some(d6(p,y))&&this.startObserver()}unmount(){}}function d6({viewport:u={}},{viewport:p={}}={}){return y=>u[y]!==p[y]}const f6={inView:{Feature:h6},tap:{Feature:s6},focus:{Feature:r6},hover:{Feature:n6}},p6={layout:{ProjectionNode:mC,MeasureLayout:aC}},nv={current:null},gC={current:!1};function m6(){if(gC.current=!0,!!Ev)if(window.matchMedia){const u=window.matchMedia("(prefers-reduced-motion)"),p=()=>nv.current=u.matches;u.addListener(p),p()}else nv.current=!1}const g6=[...jE,ea,wf],_6=u=>g6.find(BE(u)),ES=new WeakMap;function y6(u,p,y){for(const b in p){const C=p[b],M=y[b];if(Ro(C))u.addValue(b,C);else if(Ro(M))u.addValue(b,pm(C,{owner:u}));else if(M!==C)if(u.hasValue(b)){const D=u.getValue(b);D.liveStyle===!0?D.jump(C):D.hasAnimated||D.set(C)}else{const D=u.getStaticValue(b);u.addValue(b,pm(D!==void 0?D:C,{owner:u}))}}for(const b in y)p[b]===void 0&&u.removeValue(b);return p}const CS=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class x6{scrapeMotionValuesFromProps(p,y,b){return{}}constructor({parent:p,props:y,presenceContext:b,reducedMotionConfig:C,blockInitialAnimation:M,visualState:D},r={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Jv,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const Pe=ch.now();this.renderScheduledAt<Pe&&(this.renderScheduledAt=Pe,jr.render(this.render,!1,!0))};const{latestValues:U,renderState:G,onUpdate:Q}=D;this.onUpdate=Q,this.latestValues=U,this.baseTarget={...U},this.initialValues=y.initial?{...U}:{},this.renderState=G,this.parent=p,this.props=y,this.presenceContext=b,this.depth=p?p.depth+1:0,this.reducedMotionConfig=C,this.options=r,this.blockInitialAnimation=!!M,this.isControllingVariants=Ry(y),this.isVariantNode=Z3(y),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(p&&p.current);const{willChange:se,...de}=this.scrapeMotionValuesFromProps(y,{},this);for(const Pe in de){const Se=de[Pe];U[Pe]!==void 0&&Ro(Se)&&Se.set(U[Pe],!1)}}mount(p){this.current=p,ES.set(p,this),this.projection&&!this.projection.instance&&this.projection.mount(p),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((y,b)=>this.bindToMotionValue(b,y)),gC.current||m6(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:nv.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){ES.delete(this.current),this.projection&&this.projection.unmount(),hd(this.notifyUpdate),hd(this.render),this.valueSubscriptions.forEach(p=>p()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const p in this.events)this.events[p].clear();for(const p in this.features){const y=this.features[p];y&&(y.unmount(),y.isMounted=!1)}this.current=null}bindToMotionValue(p,y){this.valueSubscriptions.has(p)&&this.valueSubscriptions.get(p)();const b=Tp.has(p),C=y.on("change",r=>{this.latestValues[p]=r,this.props.onUpdate&&jr.preRender(this.notifyUpdate),b&&this.projection&&(this.projection.isTransformDirty=!0)}),M=y.on("renderRequest",this.scheduleRender);let D;window.MotionCheckAppearSync&&(D=window.MotionCheckAppearSync(this,p,y)),this.valueSubscriptions.set(p,()=>{C(),M(),D&&D(),y.owner&&y.stop()})}sortNodePosition(p){return!this.current||!this.sortInstanceNodePosition||this.type!==p.type?0:this.sortInstanceNodePosition(this.current,p.current)}updateFeatures(){let p="animation";for(p in fm){const y=fm[p];if(!y)continue;const{isEnabled:b,Feature:C}=y;if(!this.features[p]&&C&&b(this.props)&&(this.features[p]=new C(this)),this.features[p]){const M=this.features[p];M.isMounted?M.update():(M.mount(),M.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Bs()}getStaticValue(p){return this.latestValues[p]}setStaticValue(p,y){this.latestValues[p]=y}update(p,y){(p.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=p,this.prevPresenceContext=this.presenceContext,this.presenceContext=y;for(let b=0;b<CS.length;b++){const C=CS[b];this.propEventSubscriptions[C]&&(this.propEventSubscriptions[C](),delete this.propEventSubscriptions[C]);const M="on"+C,D=p[M];D&&(this.propEventSubscriptions[C]=this.on(C,D))}this.prevMotionValues=y6(this,this.scrapeMotionValuesFromProps(p,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(p){return this.props.variants?this.props.variants[p]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(p){const y=this.getClosestVariantNode();if(y)return y.variantChildren&&y.variantChildren.add(p),()=>y.variantChildren.delete(p)}addValue(p,y){const b=this.values.get(p);y!==b&&(b&&this.removeValue(p),this.bindToMotionValue(p,y),this.values.set(p,y),this.latestValues[p]=y.get())}removeValue(p){this.values.delete(p);const y=this.valueSubscriptions.get(p);y&&(y(),this.valueSubscriptions.delete(p)),delete this.latestValues[p],this.removeValueFromRenderState(p,this.renderState)}hasValue(p){return this.values.has(p)}getValue(p,y){if(this.props.values&&this.props.values[p])return this.props.values[p];let b=this.values.get(p);return b===void 0&&y!==void 0&&(b=pm(y===null?void 0:y,{owner:this}),this.addValue(p,b)),b}readValue(p,y){var b;let C=this.latestValues[p]!==void 0||!this.current?this.latestValues[p]:(b=this.getBaseTargetFromProps(this.props,p))!==null&&b!==void 0?b:this.readValueFromInstance(this.current,p,this.options);return C!=null&&(typeof C=="string"&&(OE(C)||IE(C))?C=parseFloat(C):!_6(C)&&wf.test(y)&&(C=LE(p,y)),this.setBaseTarget(p,Ro(C)?C.get():C)),Ro(C)?C.get():C}setBaseTarget(p,y){this.baseTarget[p]=y}getBaseTarget(p){var y;const{initial:b}=this.props;let C;if(typeof b=="string"||typeof b=="object"){const D=kv(this.props,b,(y=this.presenceContext)===null||y===void 0?void 0:y.custom);D&&(C=D[p])}if(b&&C!==void 0)return C;const M=this.getBaseTargetFromProps(this.props,p);return M!==void 0&&!Ro(M)?M:this.initialValues[p]!==void 0&&C===void 0?void 0:this.baseTarget[p]}on(p,y){return this.events[p]||(this.events[p]=new Wv),this.events[p].add(y)}notify(p,...y){this.events[p]&&this.events[p].notify(...y)}}class _C extends x6{constructor(){super(...arguments),this.KeyframeResolver=VE}sortInstanceNodePosition(p,y){return p.compareDocumentPosition(y)&2?1:-1}getBaseTargetFromProps(p,y){return p.style?p.style[y]:void 0}removeValueFromRenderState(p,{vars:y,style:b}){delete y[p],delete b[p]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:p}=this.props;Ro(p)&&(this.childSubscription=p.on("change",y=>{this.current&&(this.current.textContent=`${y}`)}))}}function v6(u){return window.getComputedStyle(u)}class w6 extends _C{constructor(){super(...arguments),this.type="html",this.renderInstance=nE}readValueFromInstance(p,y){if(Tp.has(y)){const b=Kv(y);return b&&b.default||0}else{const b=v6(p),C=(eE(y)?b.getPropertyValue(y):b[y])||0;return typeof C=="string"?C.trim():C}}measureInstanceViewportBox(p,{transformPagePoint:y}){return sC(p,y)}build(p,y,b){zv(p,y,b.transformTemplate)}scrapeMotionValuesFromProps(p,y,b){return Bv(p,y,b)}}class b6 extends _C{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Bs}getBaseTargetFromProps(p,y){return p[y]}readValueFromInstance(p,y){if(Tp.has(y)){const b=Kv(y);return b&&b.default||0}return y=rE.has(y)?y:Pv(y),p.getAttribute(y)}scrapeMotionValuesFromProps(p,y,b){return aE(p,y,b)}build(p,y,b){Fv(p,y,this.isSVGTag,b.transformTemplate)}renderInstance(p,y,b,C){sE(p,y,b,C)}mount(p){this.isSVGTag=Nv(p.tagName),super.mount(p)}}const T6=(u,p)=>Rv(u)?new b6(p):new w6(p,{allowProjection:u!==Fe.Fragment}),S6=Xk({...qL,...f6,...i6,...p6},T6),eo=uk(S6);function t1(u){const p=Hg(()=>pm(u)),{isStatic:y}=Fe.useContext(Wg);if(y){const[,b]=Fe.useState(u);Fe.useEffect(()=>p.on("change",b),[])}return p}function yC(u,p){const y=t1(p()),b=()=>y.set(p());return b(),Iy(()=>{const C=()=>jr.preRender(b,!1,!0),M=u.map(D=>D.on("change",C));return()=>{M.forEach(D=>D()),hd(b)}}),y}function AS(u){return typeof u=="number"?u:parseFloat(u)}function Ex(u,p={}){const{isStatic:y}=Fe.useContext(Wg),b=Fe.useRef(null),C=t1(Ro(u)?AS(u.get()):u),M=Fe.useRef(C.get()),D=Fe.useRef(()=>{}),r=()=>{const G=b.current;G&&G.time===0&&G.sample(Mo.delta),U(),b.current=vL({keyframes:[C.get(),M.current],velocity:C.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...p,onUpdate:D.current})},U=()=>{b.current&&b.current.stop()};return Fe.useInsertionEffect(()=>C.attach((G,Q)=>y?Q(G):(M.current=G,D.current=Q,jr.update(r),C.get()),U),[JSON.stringify(p)]),Iy(()=>{if(Ro(u))return u.on("change",G=>C.set(AS(G)))},[C]),C}const E6=u=>u&&typeof u=="object"&&u.mix,C6=u=>E6(u)?u.mix:void 0;function A6(...u){const p=!Array.isArray(u[0]),y=p?0:-1,b=u[0+y],C=u[1+y],M=u[2+y],D=u[3+y],r=ZE(C,M,{mixer:C6(M[0]),...D});return p?r(b):r}function I6(u){Ag.current=[],u();const p=yC(Ag.current,u);return Ag.current=void 0,p}function Q_(u,p,y,b){if(typeof u=="function")return I6(u);const C=typeof p=="function"?p:A6(p,y,b);return Array.isArray(u)?IS(u,C):IS([u],([M])=>C(M))}function IS(u,p){const y=Hg(()=>[]);return yC(u,()=>{y.length=0;const b=u.length;for(let C=0;C<b;C++)y[C]=u[C].get();return p(y)})}const xC=60,vC=140,P6=JR("mx-auto flex h-[58px] w-max items-end gap-2 rounded-2xl border p-2 dark:border-[#707070]"),wC=Eg.forwardRef(({className:u,children:p,magnification:y=xC,distance:b=vC,...C},M)=>{const D=t1(1/0),r=()=>Eg.Children.map(p,U=>Eg.cloneElement(U,{mouseX:D,magnification:y,distance:b}));return V.jsx(eo.div,{ref:M,onMouseMove:U=>D.set(U.pageX),onMouseLeave:()=>D.set(1/0),...C,className:U3(P6({className:u}),u),children:r()})});wC.displayName="Dock";const bC=({id:u,size:p,name:y,designation:b,magnification:C=xC,distance:M=vC,mouseX:D,className:r,children:U,onClick:G,...Q})=>{const se=Fe.useRef(null),de=Q_(D,Tt=>{var di;const It=((di=se.current)==null?void 0:di.getBoundingClientRect())??{x:0,width:0};return Tt-It.x-It.width/2}),Pe=Q_(de,[-M,0,M],[40,C,40]),Se=Ex(Pe,{mass:.1,stiffness:150,damping:12}),[ve,ce]=Fe.useState(null),ze={stiffness:300,damping:20},et=Ex(Q_(de,[-M,M],[-20,20]),ze),pt=Ex(Q_(de,[-M,M],[-15,15]),ze);return V.jsxs(eo.div,{ref:se,style:{width:Se},className:U3("flex aspect-square cursor-pointer items-center justify-center rounded-full relative group",r),onClick:G,onMouseEnter:()=>ce(u??null),onMouseLeave:()=>ce(null),...Q,children:[V.jsx(Lg,{mode:"popLayout",children:ve===u&&V.jsxs(eo.div,{initial:{opacity:0,y:20,scale:.6},animate:{opacity:1,y:0,scale:1,transition:{type:"spring",stiffness:260,damping:10}},exit:{opacity:0,y:20,scale:.6},style:{translateX:et,rotate:pt,whiteSpace:"nowrap"},className:"absolute -left-1/2 -top-16 z-50 flex translate-x-1/2 flex-col items-center justify-center rounded-md bg-gray-50 px-4 py-2 text-xs",children:[V.jsx("div",{className:"absolute inset-x-10 -bottom-px z-30 h-px w-1/5 bg-gradient-to-r from-transparent via-emerald-500 to-transparent "}),V.jsx("div",{className:"absolute -bottom-px left-10 z-30 h-px w-2/5 bg-gradient-to-r from-transparent via-sky-500 to-transparent "}),V.jsx("div",{className:"relative z-30 text-base font-bold text-blacks",children:y}),V.jsx("div",{className:"text-xs text-black",children:b})]})}),U]})};bC.displayName="DockIcon";const as=bf("authState",{isAuthenticated:!1,user:null,accessToken:null,refreshToken:null,loading:!1,error:null}),M6=yr({username:"",password:""}),R6=yr({username:"",password:""}),TC=yr(u=>u(as).loading,(u,p,y)=>{const b=u(as);p(as,{...b,loading:y})}),SC=yr(u=>u(as).error,(u,p,y)=>{const b=u(as);p(as,{...b,error:y})});yr(u=>u(as).user,(u,p,y)=>{const b=u(as);p(as,{...b,user:y,isAuthenticated:!!y})});yr(u=>u(as).accessToken,(u,p,y)=>{const b=u(as);p(as,{...b,accessToken:y})});const EC=yr(null,(u,p)=>{p(as,{isAuthenticated:!1,user:null,accessToken:null,refreshToken:null,loading:!1,error:null}),localStorage.removeItem("authState")}),CC=yr(null,(u,p,y)=>{p(as,{isAuthenticated:!0,user:y.user,accessToken:y.accessToken,refreshToken:y.refreshToken,loading:!1,error:null})}),i1=yr(null,(u,p,y)=>{const b=u(as);b.user&&p(as,{...b,user:{...b.user,...y}})}),k6=yr(u=>{const p=u(as).user;return(p==null?void 0:p.isInitialized)??!1});function AC(u,p){return function(){return u.apply(p,arguments)}}const{toString:D6}=Object.prototype,{getPrototypeOf:n1}=Object,{iterator:zy,toStringTag:IC}=Symbol,Fy=(u=>p=>{const y=D6.call(p);return u[y]||(u[y]=y.slice(8,-1).toLowerCase())})(Object.create(null)),fu=u=>(u=u.toLowerCase(),p=>Fy(p)===u),Oy=u=>p=>typeof p===u,{isArray:bm}=Array,Bg=Oy("undefined");function Kg(u){return u!==null&&!Bg(u)&&u.constructor!==null&&!Bg(u.constructor)&&Xa(u.constructor.isBuffer)&&u.constructor.isBuffer(u)}const PC=fu("ArrayBuffer");function L6(u){let p;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?p=ArrayBuffer.isView(u):p=u&&u.buffer&&PC(u.buffer),p}const z6=Oy("string"),Xa=Oy("function"),MC=Oy("number"),Jg=u=>u!==null&&typeof u=="object",F6=u=>u===!0||u===!1,oy=u=>{if(Fy(u)!=="object")return!1;const p=n1(u);return(p===null||p===Object.prototype||Object.getPrototypeOf(p)===null)&&!(IC in u)&&!(zy in u)},O6=u=>{if(!Jg(u)||Kg(u))return!1;try{return Object.keys(u).length===0&&Object.getPrototypeOf(u)===Object.prototype}catch{return!1}},N6=fu("Date"),B6=fu("File"),j6=fu("Blob"),V6=fu("FileList"),U6=u=>Jg(u)&&Xa(u.pipe),G6=u=>{let p;return u&&(typeof FormData=="function"&&u instanceof FormData||Xa(u.append)&&((p=Fy(u))==="formdata"||p==="object"&&Xa(u.toString)&&u.toString()==="[object FormData]"))},$6=fu("URLSearchParams"),[H6,W6,q6,Z6]=["ReadableStream","Request","Response","Headers"].map(fu),X6=u=>u.trim?u.trim():u.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Qg(u,p,{allOwnKeys:y=!1}={}){if(u===null||typeof u>"u")return;let b,C;if(typeof u!="object"&&(u=[u]),bm(u))for(b=0,C=u.length;b<C;b++)p.call(null,u[b],b,u);else{if(Kg(u))return;const M=y?Object.getOwnPropertyNames(u):Object.keys(u),D=M.length;let r;for(b=0;b<D;b++)r=M[b],p.call(null,u[r],r,u)}}function RC(u,p){if(Kg(u))return null;p=p.toLowerCase();const y=Object.keys(u);let b=y.length,C;for(;b-- >0;)if(C=y[b],p===C.toLowerCase())return C;return null}const _p=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,kC=u=>!Bg(u)&&u!==_p;function rv(){const{caseless:u}=kC(this)&&this||{},p={},y=(b,C)=>{const M=u&&RC(p,C)||C;oy(p[M])&&oy(b)?p[M]=rv(p[M],b):oy(b)?p[M]=rv({},b):bm(b)?p[M]=b.slice():p[M]=b};for(let b=0,C=arguments.length;b<C;b++)arguments[b]&&Qg(arguments[b],y);return p}const Y6=(u,p,y,{allOwnKeys:b}={})=>(Qg(p,(C,M)=>{y&&Xa(C)?u[M]=AC(C,y):u[M]=C},{allOwnKeys:b}),u),K6=u=>(u.charCodeAt(0)===65279&&(u=u.slice(1)),u),J6=(u,p,y,b)=>{u.prototype=Object.create(p.prototype,b),u.prototype.constructor=u,Object.defineProperty(u,"super",{value:p.prototype}),y&&Object.assign(u.prototype,y)},Q6=(u,p,y,b)=>{let C,M,D;const r={};if(p=p||{},u==null)return p;do{for(C=Object.getOwnPropertyNames(u),M=C.length;M-- >0;)D=C[M],(!b||b(D,u,p))&&!r[D]&&(p[D]=u[D],r[D]=!0);u=y!==!1&&n1(u)}while(u&&(!y||y(u,p))&&u!==Object.prototype);return p},eF=(u,p,y)=>{u=String(u),(y===void 0||y>u.length)&&(y=u.length),y-=p.length;const b=u.indexOf(p,y);return b!==-1&&b===y},tF=u=>{if(!u)return null;if(bm(u))return u;let p=u.length;if(!MC(p))return null;const y=new Array(p);for(;p-- >0;)y[p]=u[p];return y},iF=(u=>p=>u&&p instanceof u)(typeof Uint8Array<"u"&&n1(Uint8Array)),nF=(u,p)=>{const b=(u&&u[zy]).call(u);let C;for(;(C=b.next())&&!C.done;){const M=C.value;p.call(u,M[0],M[1])}},rF=(u,p)=>{let y;const b=[];for(;(y=u.exec(p))!==null;)b.push(y);return b},sF=fu("HTMLFormElement"),oF=u=>u.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(y,b,C){return b.toUpperCase()+C}),PS=(({hasOwnProperty:u})=>(p,y)=>u.call(p,y))(Object.prototype),aF=fu("RegExp"),DC=(u,p)=>{const y=Object.getOwnPropertyDescriptors(u),b={};Qg(y,(C,M)=>{let D;(D=p(C,M,u))!==!1&&(b[M]=D||C)}),Object.defineProperties(u,b)},lF=u=>{DC(u,(p,y)=>{if(Xa(u)&&["arguments","caller","callee"].indexOf(y)!==-1)return!1;const b=u[y];if(Xa(b)){if(p.enumerable=!1,"writable"in p){p.writable=!1;return}p.set||(p.set=()=>{throw Error("Can not rewrite read-only method '"+y+"'")})}})},cF=(u,p)=>{const y={},b=C=>{C.forEach(M=>{y[M]=!0})};return bm(u)?b(u):b(String(u).split(p)),y},uF=()=>{},hF=(u,p)=>u!=null&&Number.isFinite(u=+u)?u:p;function dF(u){return!!(u&&Xa(u.append)&&u[IC]==="FormData"&&u[zy])}const fF=u=>{const p=new Array(10),y=(b,C)=>{if(Jg(b)){if(p.indexOf(b)>=0)return;if(Kg(b))return b;if(!("toJSON"in b)){p[C]=b;const M=bm(b)?[]:{};return Qg(b,(D,r)=>{const U=y(D,C+1);!Bg(U)&&(M[r]=U)}),p[C]=void 0,M}}return b};return y(u,0)},pF=fu("AsyncFunction"),mF=u=>u&&(Jg(u)||Xa(u))&&Xa(u.then)&&Xa(u.catch),LC=((u,p)=>u?setImmediate:p?((y,b)=>(_p.addEventListener("message",({source:C,data:M})=>{C===_p&&M===y&&b.length&&b.shift()()},!1),C=>{b.push(C),_p.postMessage(y,"*")}))(`axios@${Math.random()}`,[]):y=>setTimeout(y))(typeof setImmediate=="function",Xa(_p.postMessage)),gF=typeof queueMicrotask<"u"?queueMicrotask.bind(_p):typeof process<"u"&&process.nextTick||LC,_F=u=>u!=null&&Xa(u[zy]),Ft={isArray:bm,isArrayBuffer:PC,isBuffer:Kg,isFormData:G6,isArrayBufferView:L6,isString:z6,isNumber:MC,isBoolean:F6,isObject:Jg,isPlainObject:oy,isEmptyObject:O6,isReadableStream:H6,isRequest:W6,isResponse:q6,isHeaders:Z6,isUndefined:Bg,isDate:N6,isFile:B6,isBlob:j6,isRegExp:aF,isFunction:Xa,isStream:U6,isURLSearchParams:$6,isTypedArray:iF,isFileList:V6,forEach:Qg,merge:rv,extend:Y6,trim:X6,stripBOM:K6,inherits:J6,toFlatObject:Q6,kindOf:Fy,kindOfTest:fu,endsWith:eF,toArray:tF,forEachEntry:nF,matchAll:rF,isHTMLForm:sF,hasOwnProperty:PS,hasOwnProp:PS,reduceDescriptors:DC,freezeMethods:lF,toObjectSet:cF,toCamelCase:oF,noop:uF,toFiniteNumber:hF,findKey:RC,global:_p,isContextDefined:kC,isSpecCompliantForm:dF,toJSONObject:fF,isAsyncFn:pF,isThenable:mF,setImmediate:LC,asap:gF,isIterable:_F};function qn(u,p,y,b,C){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=u,this.name="AxiosError",p&&(this.code=p),y&&(this.config=y),b&&(this.request=b),C&&(this.response=C,this.status=C.status?C.status:null)}Ft.inherits(qn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ft.toJSONObject(this.config),code:this.code,status:this.status}}});const zC=qn.prototype,FC={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(u=>{FC[u]={value:u}});Object.defineProperties(qn,FC);Object.defineProperty(zC,"isAxiosError",{value:!0});qn.from=(u,p,y,b,C,M)=>{const D=Object.create(zC);return Ft.toFlatObject(u,D,function(U){return U!==Error.prototype},r=>r!=="isAxiosError"),qn.call(D,u.message,p,y,b,C),D.cause=u,D.name=u.name,M&&Object.assign(D,M),D};const yF=null;function sv(u){return Ft.isPlainObject(u)||Ft.isArray(u)}function OC(u){return Ft.endsWith(u,"[]")?u.slice(0,-2):u}function MS(u,p,y){return u?u.concat(p).map(function(C,M){return C=OC(C),!y&&M?"["+C+"]":C}).join(y?".":""):p}function xF(u){return Ft.isArray(u)&&!u.some(sv)}const vF=Ft.toFlatObject(Ft,{},null,function(p){return/^is[A-Z]/.test(p)});function Ny(u,p,y){if(!Ft.isObject(u))throw new TypeError("target must be an object");p=p||new FormData,y=Ft.toFlatObject(y,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ve,ce){return!Ft.isUndefined(ce[ve])});const b=y.metaTokens,C=y.visitor||Q,M=y.dots,D=y.indexes,U=(y.Blob||typeof Blob<"u"&&Blob)&&Ft.isSpecCompliantForm(p);if(!Ft.isFunction(C))throw new TypeError("visitor must be a function");function G(Se){if(Se===null)return"";if(Ft.isDate(Se))return Se.toISOString();if(Ft.isBoolean(Se))return Se.toString();if(!U&&Ft.isBlob(Se))throw new qn("Blob is not supported. Use a Buffer instead.");return Ft.isArrayBuffer(Se)||Ft.isTypedArray(Se)?U&&typeof Blob=="function"?new Blob([Se]):Buffer.from(Se):Se}function Q(Se,ve,ce){let ze=Se;if(Se&&!ce&&typeof Se=="object"){if(Ft.endsWith(ve,"{}"))ve=b?ve:ve.slice(0,-2),Se=JSON.stringify(Se);else if(Ft.isArray(Se)&&xF(Se)||(Ft.isFileList(Se)||Ft.endsWith(ve,"[]"))&&(ze=Ft.toArray(Se)))return ve=OC(ve),ze.forEach(function(pt,Tt){!(Ft.isUndefined(pt)||pt===null)&&p.append(D===!0?MS([ve],Tt,M):D===null?ve:ve+"[]",G(pt))}),!1}return sv(Se)?!0:(p.append(MS(ce,ve,M),G(Se)),!1)}const se=[],de=Object.assign(vF,{defaultVisitor:Q,convertValue:G,isVisitable:sv});function Pe(Se,ve){if(!Ft.isUndefined(Se)){if(se.indexOf(Se)!==-1)throw Error("Circular reference detected in "+ve.join("."));se.push(Se),Ft.forEach(Se,function(ze,et){(!(Ft.isUndefined(ze)||ze===null)&&C.call(p,ze,Ft.isString(et)?et.trim():et,ve,de))===!0&&Pe(ze,ve?ve.concat(et):[et])}),se.pop()}}if(!Ft.isObject(u))throw new TypeError("data must be an object");return Pe(u),p}function RS(u){const p={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(u).replace(/[!'()~]|%20|%00/g,function(b){return p[b]})}function r1(u,p){this._pairs=[],u&&Ny(u,this,p)}const NC=r1.prototype;NC.append=function(p,y){this._pairs.push([p,y])};NC.toString=function(p){const y=p?function(b){return p.call(this,b,RS)}:RS;return this._pairs.map(function(C){return y(C[0])+"="+y(C[1])},"").join("&")};function wF(u){return encodeURIComponent(u).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function BC(u,p,y){if(!p)return u;const b=y&&y.encode||wF;Ft.isFunction(y)&&(y={serialize:y});const C=y&&y.serialize;let M;if(C?M=C(p,y):M=Ft.isURLSearchParams(p)?p.toString():new r1(p,y).toString(b),M){const D=u.indexOf("#");D!==-1&&(u=u.slice(0,D)),u+=(u.indexOf("?")===-1?"?":"&")+M}return u}class kS{constructor(){this.handlers=[]}use(p,y,b){return this.handlers.push({fulfilled:p,rejected:y,synchronous:b?b.synchronous:!1,runWhen:b?b.runWhen:null}),this.handlers.length-1}eject(p){this.handlers[p]&&(this.handlers[p]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(p){Ft.forEach(this.handlers,function(b){b!==null&&p(b)})}}const jC={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},bF=typeof URLSearchParams<"u"?URLSearchParams:r1,TF=typeof FormData<"u"?FormData:null,SF=typeof Blob<"u"?Blob:null,EF={isBrowser:!0,classes:{URLSearchParams:bF,FormData:TF,Blob:SF},protocols:["http","https","file","blob","url","data"]},s1=typeof window<"u"&&typeof document<"u",ov=typeof navigator=="object"&&navigator||void 0,CF=s1&&(!ov||["ReactNative","NativeScript","NS"].indexOf(ov.product)<0),AF=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",IF=s1&&window.location.href||"http://localhost",PF=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:s1,hasStandardBrowserEnv:CF,hasStandardBrowserWebWorkerEnv:AF,navigator:ov,origin:IF},Symbol.toStringTag,{value:"Module"})),ta={...PF,...EF};function MF(u,p){return Ny(u,new ta.classes.URLSearchParams,{visitor:function(y,b,C,M){return ta.isNode&&Ft.isBuffer(y)?(this.append(b,y.toString("base64")),!1):M.defaultVisitor.apply(this,arguments)},...p})}function RF(u){return Ft.matchAll(/\w+|\[(\w*)]/g,u).map(p=>p[0]==="[]"?"":p[1]||p[0])}function kF(u){const p={},y=Object.keys(u);let b;const C=y.length;let M;for(b=0;b<C;b++)M=y[b],p[M]=u[M];return p}function VC(u){function p(y,b,C,M){let D=y[M++];if(D==="__proto__")return!0;const r=Number.isFinite(+D),U=M>=y.length;return D=!D&&Ft.isArray(C)?C.length:D,U?(Ft.hasOwnProp(C,D)?C[D]=[C[D],b]:C[D]=b,!r):((!C[D]||!Ft.isObject(C[D]))&&(C[D]=[]),p(y,b,C[D],M)&&Ft.isArray(C[D])&&(C[D]=kF(C[D])),!r)}if(Ft.isFormData(u)&&Ft.isFunction(u.entries)){const y={};return Ft.forEachEntry(u,(b,C)=>{p(RF(b),C,y,0)}),y}return null}function DF(u,p,y){if(Ft.isString(u))try{return(p||JSON.parse)(u),Ft.trim(u)}catch(b){if(b.name!=="SyntaxError")throw b}return(y||JSON.stringify)(u)}const e_={transitional:jC,adapter:["xhr","http","fetch"],transformRequest:[function(p,y){const b=y.getContentType()||"",C=b.indexOf("application/json")>-1,M=Ft.isObject(p);if(M&&Ft.isHTMLForm(p)&&(p=new FormData(p)),Ft.isFormData(p))return C?JSON.stringify(VC(p)):p;if(Ft.isArrayBuffer(p)||Ft.isBuffer(p)||Ft.isStream(p)||Ft.isFile(p)||Ft.isBlob(p)||Ft.isReadableStream(p))return p;if(Ft.isArrayBufferView(p))return p.buffer;if(Ft.isURLSearchParams(p))return y.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),p.toString();let r;if(M){if(b.indexOf("application/x-www-form-urlencoded")>-1)return MF(p,this.formSerializer).toString();if((r=Ft.isFileList(p))||b.indexOf("multipart/form-data")>-1){const U=this.env&&this.env.FormData;return Ny(r?{"files[]":p}:p,U&&new U,this.formSerializer)}}return M||C?(y.setContentType("application/json",!1),DF(p)):p}],transformResponse:[function(p){const y=this.transitional||e_.transitional,b=y&&y.forcedJSONParsing,C=this.responseType==="json";if(Ft.isResponse(p)||Ft.isReadableStream(p))return p;if(p&&Ft.isString(p)&&(b&&!this.responseType||C)){const D=!(y&&y.silentJSONParsing)&&C;try{return JSON.parse(p)}catch(r){if(D)throw r.name==="SyntaxError"?qn.from(r,qn.ERR_BAD_RESPONSE,this,null,this.response):r}}return p}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ta.classes.FormData,Blob:ta.classes.Blob},validateStatus:function(p){return p>=200&&p<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ft.forEach(["delete","get","head","post","put","patch"],u=>{e_.headers[u]={}});const LF=Ft.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),zF=u=>{const p={};let y,b,C;return u&&u.split(`
`).forEach(function(D){C=D.indexOf(":"),y=D.substring(0,C).trim().toLowerCase(),b=D.substring(C+1).trim(),!(!y||p[y]&&LF[y])&&(y==="set-cookie"?p[y]?p[y].push(b):p[y]=[b]:p[y]=p[y]?p[y]+", "+b:b)}),p},DS=Symbol("internals");function xg(u){return u&&String(u).trim().toLowerCase()}function ay(u){return u===!1||u==null?u:Ft.isArray(u)?u.map(ay):String(u)}function FF(u){const p=Object.create(null),y=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let b;for(;b=y.exec(u);)p[b[1]]=b[2];return p}const OF=u=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(u.trim());function Cx(u,p,y,b,C){if(Ft.isFunction(b))return b.call(this,p,y);if(C&&(p=y),!!Ft.isString(p)){if(Ft.isString(b))return p.indexOf(b)!==-1;if(Ft.isRegExp(b))return b.test(p)}}function NF(u){return u.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(p,y,b)=>y.toUpperCase()+b)}function BF(u,p){const y=Ft.toCamelCase(" "+p);["get","set","has"].forEach(b=>{Object.defineProperty(u,b+y,{value:function(C,M,D){return this[b].call(this,p,C,M,D)},configurable:!0})})}let Ya=class{constructor(p){p&&this.set(p)}set(p,y,b){const C=this;function M(r,U,G){const Q=xg(U);if(!Q)throw new Error("header name must be a non-empty string");const se=Ft.findKey(C,Q);(!se||C[se]===void 0||G===!0||G===void 0&&C[se]!==!1)&&(C[se||U]=ay(r))}const D=(r,U)=>Ft.forEach(r,(G,Q)=>M(G,Q,U));if(Ft.isPlainObject(p)||p instanceof this.constructor)D(p,y);else if(Ft.isString(p)&&(p=p.trim())&&!OF(p))D(zF(p),y);else if(Ft.isObject(p)&&Ft.isIterable(p)){let r={},U,G;for(const Q of p){if(!Ft.isArray(Q))throw TypeError("Object iterator must return a key-value pair");r[G=Q[0]]=(U=r[G])?Ft.isArray(U)?[...U,Q[1]]:[U,Q[1]]:Q[1]}D(r,y)}else p!=null&&M(y,p,b);return this}get(p,y){if(p=xg(p),p){const b=Ft.findKey(this,p);if(b){const C=this[b];if(!y)return C;if(y===!0)return FF(C);if(Ft.isFunction(y))return y.call(this,C,b);if(Ft.isRegExp(y))return y.exec(C);throw new TypeError("parser must be boolean|regexp|function")}}}has(p,y){if(p=xg(p),p){const b=Ft.findKey(this,p);return!!(b&&this[b]!==void 0&&(!y||Cx(this,this[b],b,y)))}return!1}delete(p,y){const b=this;let C=!1;function M(D){if(D=xg(D),D){const r=Ft.findKey(b,D);r&&(!y||Cx(b,b[r],r,y))&&(delete b[r],C=!0)}}return Ft.isArray(p)?p.forEach(M):M(p),C}clear(p){const y=Object.keys(this);let b=y.length,C=!1;for(;b--;){const M=y[b];(!p||Cx(this,this[M],M,p,!0))&&(delete this[M],C=!0)}return C}normalize(p){const y=this,b={};return Ft.forEach(this,(C,M)=>{const D=Ft.findKey(b,M);if(D){y[D]=ay(C),delete y[M];return}const r=p?NF(M):String(M).trim();r!==M&&delete y[M],y[r]=ay(C),b[r]=!0}),this}concat(...p){return this.constructor.concat(this,...p)}toJSON(p){const y=Object.create(null);return Ft.forEach(this,(b,C)=>{b!=null&&b!==!1&&(y[C]=p&&Ft.isArray(b)?b.join(", "):b)}),y}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([p,y])=>p+": "+y).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(p){return p instanceof this?p:new this(p)}static concat(p,...y){const b=new this(p);return y.forEach(C=>b.set(C)),b}static accessor(p){const b=(this[DS]=this[DS]={accessors:{}}).accessors,C=this.prototype;function M(D){const r=xg(D);b[r]||(BF(C,D),b[r]=!0)}return Ft.isArray(p)?p.forEach(M):M(p),this}};Ya.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ft.reduceDescriptors(Ya.prototype,({value:u},p)=>{let y=p[0].toUpperCase()+p.slice(1);return{get:()=>u,set(b){this[y]=b}}});Ft.freezeMethods(Ya);function Ax(u,p){const y=this||e_,b=p||y,C=Ya.from(b.headers);let M=b.data;return Ft.forEach(u,function(r){M=r.call(y,M,C.normalize(),p?p.status:void 0)}),C.normalize(),M}function UC(u){return!!(u&&u.__CANCEL__)}function Tm(u,p,y){qn.call(this,u??"canceled",qn.ERR_CANCELED,p,y),this.name="CanceledError"}Ft.inherits(Tm,qn,{__CANCEL__:!0});function GC(u,p,y){const b=y.config.validateStatus;!y.status||!b||b(y.status)?u(y):p(new qn("Request failed with status code "+y.status,[qn.ERR_BAD_REQUEST,qn.ERR_BAD_RESPONSE][Math.floor(y.status/100)-4],y.config,y.request,y))}function jF(u){const p=/^([-+\w]{1,25})(:?\/\/|:)/.exec(u);return p&&p[1]||""}function VF(u,p){u=u||10;const y=new Array(u),b=new Array(u);let C=0,M=0,D;return p=p!==void 0?p:1e3,function(U){const G=Date.now(),Q=b[M];D||(D=G),y[C]=U,b[C]=G;let se=M,de=0;for(;se!==C;)de+=y[se++],se=se%u;if(C=(C+1)%u,C===M&&(M=(M+1)%u),G-D<p)return;const Pe=Q&&G-Q;return Pe?Math.round(de*1e3/Pe):void 0}}function UF(u,p){let y=0,b=1e3/p,C,M;const D=(G,Q=Date.now())=>{y=Q,C=null,M&&(clearTimeout(M),M=null),u(...G)};return[(...G)=>{const Q=Date.now(),se=Q-y;se>=b?D(G,Q):(C=G,M||(M=setTimeout(()=>{M=null,D(C)},b-se)))},()=>C&&D(C)]}const by=(u,p,y=3)=>{let b=0;const C=VF(50,250);return UF(M=>{const D=M.loaded,r=M.lengthComputable?M.total:void 0,U=D-b,G=C(U),Q=D<=r;b=D;const se={loaded:D,total:r,progress:r?D/r:void 0,bytes:U,rate:G||void 0,estimated:G&&r&&Q?(r-D)/G:void 0,event:M,lengthComputable:r!=null,[p?"download":"upload"]:!0};u(se)},y)},LS=(u,p)=>{const y=u!=null;return[b=>p[0]({lengthComputable:y,total:u,loaded:b}),p[1]]},zS=u=>(...p)=>Ft.asap(()=>u(...p)),GF=ta.hasStandardBrowserEnv?((u,p)=>y=>(y=new URL(y,ta.origin),u.protocol===y.protocol&&u.host===y.host&&(p||u.port===y.port)))(new URL(ta.origin),ta.navigator&&/(msie|trident)/i.test(ta.navigator.userAgent)):()=>!0,$F=ta.hasStandardBrowserEnv?{write(u,p,y,b,C,M){const D=[u+"="+encodeURIComponent(p)];Ft.isNumber(y)&&D.push("expires="+new Date(y).toGMTString()),Ft.isString(b)&&D.push("path="+b),Ft.isString(C)&&D.push("domain="+C),M===!0&&D.push("secure"),document.cookie=D.join("; ")},read(u){const p=document.cookie.match(new RegExp("(^|;\\s*)("+u+")=([^;]*)"));return p?decodeURIComponent(p[3]):null},remove(u){this.write(u,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function HF(u){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(u)}function WF(u,p){return p?u.replace(/\/?\/$/,"")+"/"+p.replace(/^\/+/,""):u}function $C(u,p,y){let b=!HF(p);return u&&(b||y==!1)?WF(u,p):p}const FS=u=>u instanceof Ya?{...u}:u;function vp(u,p){p=p||{};const y={};function b(G,Q,se,de){return Ft.isPlainObject(G)&&Ft.isPlainObject(Q)?Ft.merge.call({caseless:de},G,Q):Ft.isPlainObject(Q)?Ft.merge({},Q):Ft.isArray(Q)?Q.slice():Q}function C(G,Q,se,de){if(Ft.isUndefined(Q)){if(!Ft.isUndefined(G))return b(void 0,G,se,de)}else return b(G,Q,se,de)}function M(G,Q){if(!Ft.isUndefined(Q))return b(void 0,Q)}function D(G,Q){if(Ft.isUndefined(Q)){if(!Ft.isUndefined(G))return b(void 0,G)}else return b(void 0,Q)}function r(G,Q,se){if(se in p)return b(G,Q);if(se in u)return b(void 0,G)}const U={url:M,method:M,data:M,baseURL:D,transformRequest:D,transformResponse:D,paramsSerializer:D,timeout:D,timeoutMessage:D,withCredentials:D,withXSRFToken:D,adapter:D,responseType:D,xsrfCookieName:D,xsrfHeaderName:D,onUploadProgress:D,onDownloadProgress:D,decompress:D,maxContentLength:D,maxBodyLength:D,beforeRedirect:D,transport:D,httpAgent:D,httpsAgent:D,cancelToken:D,socketPath:D,responseEncoding:D,validateStatus:r,headers:(G,Q,se)=>C(FS(G),FS(Q),se,!0)};return Ft.forEach(Object.keys({...u,...p}),function(Q){const se=U[Q]||C,de=se(u[Q],p[Q],Q);Ft.isUndefined(de)&&se!==r||(y[Q]=de)}),y}const HC=u=>{const p=vp({},u);let{data:y,withXSRFToken:b,xsrfHeaderName:C,xsrfCookieName:M,headers:D,auth:r}=p;p.headers=D=Ya.from(D),p.url=BC($C(p.baseURL,p.url,p.allowAbsoluteUrls),u.params,u.paramsSerializer),r&&D.set("Authorization","Basic "+btoa((r.username||"")+":"+(r.password?unescape(encodeURIComponent(r.password)):"")));let U;if(Ft.isFormData(y)){if(ta.hasStandardBrowserEnv||ta.hasStandardBrowserWebWorkerEnv)D.setContentType(void 0);else if((U=D.getContentType())!==!1){const[G,...Q]=U?U.split(";").map(se=>se.trim()).filter(Boolean):[];D.setContentType([G||"multipart/form-data",...Q].join("; "))}}if(ta.hasStandardBrowserEnv&&(b&&Ft.isFunction(b)&&(b=b(p)),b||b!==!1&&GF(p.url))){const G=C&&M&&$F.read(M);G&&D.set(C,G)}return p},qF=typeof XMLHttpRequest<"u",ZF=qF&&function(u){return new Promise(function(y,b){const C=HC(u);let M=C.data;const D=Ya.from(C.headers).normalize();let{responseType:r,onUploadProgress:U,onDownloadProgress:G}=C,Q,se,de,Pe,Se;function ve(){Pe&&Pe(),Se&&Se(),C.cancelToken&&C.cancelToken.unsubscribe(Q),C.signal&&C.signal.removeEventListener("abort",Q)}let ce=new XMLHttpRequest;ce.open(C.method.toUpperCase(),C.url,!0),ce.timeout=C.timeout;function ze(){if(!ce)return;const pt=Ya.from("getAllResponseHeaders"in ce&&ce.getAllResponseHeaders()),It={data:!r||r==="text"||r==="json"?ce.responseText:ce.response,status:ce.status,statusText:ce.statusText,headers:pt,config:u,request:ce};GC(function(Bt){y(Bt),ve()},function(Bt){b(Bt),ve()},It),ce=null}"onloadend"in ce?ce.onloadend=ze:ce.onreadystatechange=function(){!ce||ce.readyState!==4||ce.status===0&&!(ce.responseURL&&ce.responseURL.indexOf("file:")===0)||setTimeout(ze)},ce.onabort=function(){ce&&(b(new qn("Request aborted",qn.ECONNABORTED,u,ce)),ce=null)},ce.onerror=function(){b(new qn("Network Error",qn.ERR_NETWORK,u,ce)),ce=null},ce.ontimeout=function(){let Tt=C.timeout?"timeout of "+C.timeout+"ms exceeded":"timeout exceeded";const It=C.transitional||jC;C.timeoutErrorMessage&&(Tt=C.timeoutErrorMessage),b(new qn(Tt,It.clarifyTimeoutError?qn.ETIMEDOUT:qn.ECONNABORTED,u,ce)),ce=null},M===void 0&&D.setContentType(null),"setRequestHeader"in ce&&Ft.forEach(D.toJSON(),function(Tt,It){ce.setRequestHeader(It,Tt)}),Ft.isUndefined(C.withCredentials)||(ce.withCredentials=!!C.withCredentials),r&&r!=="json"&&(ce.responseType=C.responseType),G&&([de,Se]=by(G,!0),ce.addEventListener("progress",de)),U&&ce.upload&&([se,Pe]=by(U),ce.upload.addEventListener("progress",se),ce.upload.addEventListener("loadend",Pe)),(C.cancelToken||C.signal)&&(Q=pt=>{ce&&(b(!pt||pt.type?new Tm(null,u,ce):pt),ce.abort(),ce=null)},C.cancelToken&&C.cancelToken.subscribe(Q),C.signal&&(C.signal.aborted?Q():C.signal.addEventListener("abort",Q)));const et=jF(C.url);if(et&&ta.protocols.indexOf(et)===-1){b(new qn("Unsupported protocol "+et+":",qn.ERR_BAD_REQUEST,u));return}ce.send(M||null)})},XF=(u,p)=>{const{length:y}=u=u?u.filter(Boolean):[];if(p||y){let b=new AbortController,C;const M=function(G){if(!C){C=!0,r();const Q=G instanceof Error?G:this.reason;b.abort(Q instanceof qn?Q:new Tm(Q instanceof Error?Q.message:Q))}};let D=p&&setTimeout(()=>{D=null,M(new qn(`timeout ${p} of ms exceeded`,qn.ETIMEDOUT))},p);const r=()=>{u&&(D&&clearTimeout(D),D=null,u.forEach(G=>{G.unsubscribe?G.unsubscribe(M):G.removeEventListener("abort",M)}),u=null)};u.forEach(G=>G.addEventListener("abort",M));const{signal:U}=b;return U.unsubscribe=()=>Ft.asap(r),U}},YF=function*(u,p){let y=u.byteLength;if(y<p){yield u;return}let b=0,C;for(;b<y;)C=b+p,yield u.slice(b,C),b=C},KF=async function*(u,p){for await(const y of JF(u))yield*YF(y,p)},JF=async function*(u){if(u[Symbol.asyncIterator]){yield*u;return}const p=u.getReader();try{for(;;){const{done:y,value:b}=await p.read();if(y)break;yield b}}finally{await p.cancel()}},OS=(u,p,y,b)=>{const C=KF(u,p);let M=0,D,r=U=>{D||(D=!0,b&&b(U))};return new ReadableStream({async pull(U){try{const{done:G,value:Q}=await C.next();if(G){r(),U.close();return}let se=Q.byteLength;if(y){let de=M+=se;y(de)}U.enqueue(new Uint8Array(Q))}catch(G){throw r(G),G}},cancel(U){return r(U),C.return()}},{highWaterMark:2})},By=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",WC=By&&typeof ReadableStream=="function",QF=By&&(typeof TextEncoder=="function"?(u=>p=>u.encode(p))(new TextEncoder):async u=>new Uint8Array(await new Response(u).arrayBuffer())),qC=(u,...p)=>{try{return!!u(...p)}catch{return!1}},e8=WC&&qC(()=>{let u=!1;const p=new Request(ta.origin,{body:new ReadableStream,method:"POST",get duplex(){return u=!0,"half"}}).headers.has("Content-Type");return u&&!p}),NS=64*1024,av=WC&&qC(()=>Ft.isReadableStream(new Response("").body)),Ty={stream:av&&(u=>u.body)};By&&(u=>{["text","arrayBuffer","blob","formData","stream"].forEach(p=>{!Ty[p]&&(Ty[p]=Ft.isFunction(u[p])?y=>y[p]():(y,b)=>{throw new qn(`Response type '${p}' is not supported`,qn.ERR_NOT_SUPPORT,b)})})})(new Response);const t8=async u=>{if(u==null)return 0;if(Ft.isBlob(u))return u.size;if(Ft.isSpecCompliantForm(u))return(await new Request(ta.origin,{method:"POST",body:u}).arrayBuffer()).byteLength;if(Ft.isArrayBufferView(u)||Ft.isArrayBuffer(u))return u.byteLength;if(Ft.isURLSearchParams(u)&&(u=u+""),Ft.isString(u))return(await QF(u)).byteLength},i8=async(u,p)=>{const y=Ft.toFiniteNumber(u.getContentLength());return y??t8(p)},n8=By&&(async u=>{let{url:p,method:y,data:b,signal:C,cancelToken:M,timeout:D,onDownloadProgress:r,onUploadProgress:U,responseType:G,headers:Q,withCredentials:se="same-origin",fetchOptions:de}=HC(u);G=G?(G+"").toLowerCase():"text";let Pe=XF([C,M&&M.toAbortSignal()],D),Se;const ve=Pe&&Pe.unsubscribe&&(()=>{Pe.unsubscribe()});let ce;try{if(U&&e8&&y!=="get"&&y!=="head"&&(ce=await i8(Q,b))!==0){let It=new Request(p,{method:"POST",body:b,duplex:"half"}),di;if(Ft.isFormData(b)&&(di=It.headers.get("content-type"))&&Q.setContentType(di),It.body){const[Bt,Yt]=LS(ce,by(zS(U)));b=OS(It.body,NS,Bt,Yt)}}Ft.isString(se)||(se=se?"include":"omit");const ze="credentials"in Request.prototype;Se=new Request(p,{...de,signal:Pe,method:y.toUpperCase(),headers:Q.normalize().toJSON(),body:b,duplex:"half",credentials:ze?se:void 0});let et=await fetch(Se,de);const pt=av&&(G==="stream"||G==="response");if(av&&(r||pt&&ve)){const It={};["status","statusText","headers"].forEach(vt=>{It[vt]=et[vt]});const di=Ft.toFiniteNumber(et.headers.get("content-length")),[Bt,Yt]=r&&LS(di,by(zS(r),!0))||[];et=new Response(OS(et.body,NS,Bt,()=>{Yt&&Yt(),ve&&ve()}),It)}G=G||"text";let Tt=await Ty[Ft.findKey(Ty,G)||"text"](et,u);return!pt&&ve&&ve(),await new Promise((It,di)=>{GC(It,di,{data:Tt,headers:Ya.from(et.headers),status:et.status,statusText:et.statusText,config:u,request:Se})})}catch(ze){throw ve&&ve(),ze&&ze.name==="TypeError"&&/Load failed|fetch/i.test(ze.message)?Object.assign(new qn("Network Error",qn.ERR_NETWORK,u,Se),{cause:ze.cause||ze}):qn.from(ze,ze&&ze.code,u,Se)}}),lv={http:yF,xhr:ZF,fetch:n8};Ft.forEach(lv,(u,p)=>{if(u){try{Object.defineProperty(u,"name",{value:p})}catch{}Object.defineProperty(u,"adapterName",{value:p})}});const BS=u=>`- ${u}`,r8=u=>Ft.isFunction(u)||u===null||u===!1,ZC={getAdapter:u=>{u=Ft.isArray(u)?u:[u];const{length:p}=u;let y,b;const C={};for(let M=0;M<p;M++){y=u[M];let D;if(b=y,!r8(y)&&(b=lv[(D=String(y)).toLowerCase()],b===void 0))throw new qn(`Unknown adapter '${D}'`);if(b)break;C[D||"#"+M]=b}if(!b){const M=Object.entries(C).map(([r,U])=>`adapter ${r} `+(U===!1?"is not supported by the environment":"is not available in the build"));let D=p?M.length>1?`since :
`+M.map(BS).join(`
`):" "+BS(M[0]):"as no adapter specified";throw new qn("There is no suitable adapter to dispatch the request "+D,"ERR_NOT_SUPPORT")}return b},adapters:lv};function Ix(u){if(u.cancelToken&&u.cancelToken.throwIfRequested(),u.signal&&u.signal.aborted)throw new Tm(null,u)}function jS(u){return Ix(u),u.headers=Ya.from(u.headers),u.data=Ax.call(u,u.transformRequest),["post","put","patch"].indexOf(u.method)!==-1&&u.headers.setContentType("application/x-www-form-urlencoded",!1),ZC.getAdapter(u.adapter||e_.adapter)(u).then(function(b){return Ix(u),b.data=Ax.call(u,u.transformResponse,b),b.headers=Ya.from(b.headers),b},function(b){return UC(b)||(Ix(u),b&&b.response&&(b.response.data=Ax.call(u,u.transformResponse,b.response),b.response.headers=Ya.from(b.response.headers))),Promise.reject(b)})}const XC="1.11.0",jy={};["object","boolean","number","function","string","symbol"].forEach((u,p)=>{jy[u]=function(b){return typeof b===u||"a"+(p<1?"n ":" ")+u}});const VS={};jy.transitional=function(p,y,b){function C(M,D){return"[Axios v"+XC+"] Transitional option '"+M+"'"+D+(b?". "+b:"")}return(M,D,r)=>{if(p===!1)throw new qn(C(D," has been removed"+(y?" in "+y:"")),qn.ERR_DEPRECATED);return y&&!VS[D]&&(VS[D]=!0,console.warn(C(D," has been deprecated since v"+y+" and will be removed in the near future"))),p?p(M,D,r):!0}};jy.spelling=function(p){return(y,b)=>(console.warn(`${b} is likely a misspelling of ${p}`),!0)};function s8(u,p,y){if(typeof u!="object")throw new qn("options must be an object",qn.ERR_BAD_OPTION_VALUE);const b=Object.keys(u);let C=b.length;for(;C-- >0;){const M=b[C],D=p[M];if(D){const r=u[M],U=r===void 0||D(r,M,u);if(U!==!0)throw new qn("option "+M+" must be "+U,qn.ERR_BAD_OPTION_VALUE);continue}if(y!==!0)throw new qn("Unknown option "+M,qn.ERR_BAD_OPTION)}}const ly={assertOptions:s8,validators:jy},ah=ly.validators;let xp=class{constructor(p){this.defaults=p||{},this.interceptors={request:new kS,response:new kS}}async request(p,y){try{return await this._request(p,y)}catch(b){if(b instanceof Error){let C={};Error.captureStackTrace?Error.captureStackTrace(C):C=new Error;const M=C.stack?C.stack.replace(/^.+\n/,""):"";try{b.stack?M&&!String(b.stack).endsWith(M.replace(/^.+\n.+\n/,""))&&(b.stack+=`
`+M):b.stack=M}catch{}}throw b}}_request(p,y){typeof p=="string"?(y=y||{},y.url=p):y=p||{},y=vp(this.defaults,y);const{transitional:b,paramsSerializer:C,headers:M}=y;b!==void 0&&ly.assertOptions(b,{silentJSONParsing:ah.transitional(ah.boolean),forcedJSONParsing:ah.transitional(ah.boolean),clarifyTimeoutError:ah.transitional(ah.boolean)},!1),C!=null&&(Ft.isFunction(C)?y.paramsSerializer={serialize:C}:ly.assertOptions(C,{encode:ah.function,serialize:ah.function},!0)),y.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?y.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:y.allowAbsoluteUrls=!0),ly.assertOptions(y,{baseUrl:ah.spelling("baseURL"),withXsrfToken:ah.spelling("withXSRFToken")},!0),y.method=(y.method||this.defaults.method||"get").toLowerCase();let D=M&&Ft.merge(M.common,M[y.method]);M&&Ft.forEach(["delete","get","head","post","put","patch","common"],Se=>{delete M[Se]}),y.headers=Ya.concat(D,M);const r=[];let U=!0;this.interceptors.request.forEach(function(ve){typeof ve.runWhen=="function"&&ve.runWhen(y)===!1||(U=U&&ve.synchronous,r.unshift(ve.fulfilled,ve.rejected))});const G=[];this.interceptors.response.forEach(function(ve){G.push(ve.fulfilled,ve.rejected)});let Q,se=0,de;if(!U){const Se=[jS.bind(this),void 0];for(Se.unshift(...r),Se.push(...G),de=Se.length,Q=Promise.resolve(y);se<de;)Q=Q.then(Se[se++],Se[se++]);return Q}de=r.length;let Pe=y;for(se=0;se<de;){const Se=r[se++],ve=r[se++];try{Pe=Se(Pe)}catch(ce){ve.call(this,ce);break}}try{Q=jS.call(this,Pe)}catch(Se){return Promise.reject(Se)}for(se=0,de=G.length;se<de;)Q=Q.then(G[se++],G[se++]);return Q}getUri(p){p=vp(this.defaults,p);const y=$C(p.baseURL,p.url,p.allowAbsoluteUrls);return BC(y,p.params,p.paramsSerializer)}};Ft.forEach(["delete","get","head","options"],function(p){xp.prototype[p]=function(y,b){return this.request(vp(b||{},{method:p,url:y,data:(b||{}).data}))}});Ft.forEach(["post","put","patch"],function(p){function y(b){return function(M,D,r){return this.request(vp(r||{},{method:p,headers:b?{"Content-Type":"multipart/form-data"}:{},url:M,data:D}))}}xp.prototype[p]=y(),xp.prototype[p+"Form"]=y(!0)});let o8=class YC{constructor(p){if(typeof p!="function")throw new TypeError("executor must be a function.");let y;this.promise=new Promise(function(M){y=M});const b=this;this.promise.then(C=>{if(!b._listeners)return;let M=b._listeners.length;for(;M-- >0;)b._listeners[M](C);b._listeners=null}),this.promise.then=C=>{let M;const D=new Promise(r=>{b.subscribe(r),M=r}).then(C);return D.cancel=function(){b.unsubscribe(M)},D},p(function(M,D,r){b.reason||(b.reason=new Tm(M,D,r),y(b.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(p){if(this.reason){p(this.reason);return}this._listeners?this._listeners.push(p):this._listeners=[p]}unsubscribe(p){if(!this._listeners)return;const y=this._listeners.indexOf(p);y!==-1&&this._listeners.splice(y,1)}toAbortSignal(){const p=new AbortController,y=b=>{p.abort(b)};return this.subscribe(y),p.signal.unsubscribe=()=>this.unsubscribe(y),p.signal}static source(){let p;return{token:new YC(function(C){p=C}),cancel:p}}};function a8(u){return function(y){return u.apply(null,y)}}function l8(u){return Ft.isObject(u)&&u.isAxiosError===!0}const cv={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(cv).forEach(([u,p])=>{cv[p]=u});function KC(u){const p=new xp(u),y=AC(xp.prototype.request,p);return Ft.extend(y,xp.prototype,p,{allOwnKeys:!0}),Ft.extend(y,p,null,{allOwnKeys:!0}),y.create=function(C){return KC(vp(u,C))},y}const Or=KC(e_);Or.Axios=xp;Or.CanceledError=Tm;Or.CancelToken=o8;Or.isCancel=UC;Or.VERSION=XC;Or.toFormData=Ny;Or.AxiosError=qn;Or.Cancel=Or.CanceledError;Or.all=function(p){return Promise.all(p)};Or.spread=a8;Or.isAxiosError=l8;Or.mergeConfig=vp;Or.AxiosHeaders=Ya;Or.formToJSON=u=>VC(Ft.isHTMLForm(u)?new FormData(u):u);Or.getAdapter=ZC.getAdapter;Or.HttpStatusCode=cv;Or.default=Or;const{Axios:mO,AxiosError:gO,CanceledError:_O,isCancel:yO,CancelToken:xO,VERSION:vO,all:wO,Cancel:bO,isAxiosError:TO,spread:SO,toFormData:EO,AxiosHeaders:CO,HttpStatusCode:AO,formToJSON:IO,getAdapter:PO,mergeConfig:MO}=Or,cy="https://backeenee.zeabur.app",JC="/auth",rm=Or.create({baseURL:`${cy}${JC}`,timeout:1e4,headers:{"Content-Type":"application/json"}});class jg{static async register(p){var y;try{return(await rm.post("/register",{username:p.username,password:p.password,phoneNumber:p.phoneNumber||void 0})).data}catch(b){if(console.error(":",b),b.code==="ERR_NETWORK")throw new Error("");if(b.message.includes("CORS")||b.message.includes("Network Error"))throw new Error("");if((y=b.response)!=null&&y.data){const C=b.response.data.message||b.response.data.error||"";throw new Error(C)}throw b.code==="ECONNABORTED"?new Error(""):new Error("")}}static async login(p){var y;try{return(await rm.post("/login",{username:p.username,password:p.password})).data}catch(b){if(console.error(":",b),b.code==="ERR_NETWORK")throw new Error("");if(b.message.includes("CORS")||b.message.includes("Network Error"))throw new Error("");if((y=b.response)!=null&&y.data){const C=b.response.data.message||b.response.data.error||"";throw new Error(C)}throw b.code==="ECONNABORTED"?new Error(""):new Error("")}}static async refreshToken(p){try{return(await rm.post("/refresh-token",{refreshToken:p})).data}catch(y){throw console.error(":",y),new Error("")}}static async logout(p){try{await rm.post("/logout",{},{headers:{Authorization:`Bearer ${p}`}})}catch(y){console.error(":",y)}}static async validateToken(p){try{return await Or.get(`${cy}/users/profile`,{headers:{Authorization:`Bearer ${p}`}}),!0}catch{return!1}}static async getUserProfile(p){try{return(await Or.get(`${cy}/users/profile`,{headers:{Authorization:`Bearer ${p}`}})).data}catch(y){throw console.error(":",y),new Error("")}}static async testConnection(){try{return await Or.options(`${cy}${JC}/register`,{timeout:5e3}),{success:!0,message:""}}catch(p){return console.error(":",p),p.code==="ERR_NETWORK"?{success:!1,message:""}:p.message.includes("CORS")?{success:!1,message:"CORS"}:p.code==="ECONNABORTED"?{success:!1,message:""}:{success:!1,message:`: ${p.message||""}`}}}static setupInterceptors(p){rm.interceptors.request.use(y=>{const b=p();return b&&(y.headers.Authorization=`Bearer ${b}`),y},y=>Promise.reject(y)),rm.interceptors.response.use(y=>y,async y=>{var C;const b=y.config;return((C=y.response)==null?void 0:C.status)===401&&!b._retry&&(b._retry=!0,console.log("Token expired, need to refresh or redirect to login")),Promise.reject(y)})}}function c8(){var C;const u=mc();Ka(),Nn(I5);const[p]=Nn(as),[,y]=Nn(EC),b=async()=>{if(p.isAuthenticated)try{p.accessToken&&await jg.logout(p.accessToken),y(),Dn.success(""),u("/auth")}catch(M){console.error("Logout failed:",M),y(),Dn.success(""),u("/auth")}else u("/auth")};return V.jsx("div",{className:"z-50 bg-background absolute flex bottom-4 left-4 flex-col items-center justify-center rounded-lg h-20",children:V.jsx(wC,{className:"relative bg-[rgba(255,255,255)] hover:bg-[rgb(255,255,255)] dark:bg-zinc-800 dark:hover:bg-zinc-700 duration-200 hover:backdrop-blur-xl",children:V.jsx(bC,{name:p.isAuthenticated?"":"",designation:p.isAuthenticated?`${((C=p.user)==null?void 0:C.username)||""} -  `:" ",id:1,onClick:b,className:"bg-neutral-400/20",children:p.isAuthenticated?V.jsx(US.User,{className:"h-6 w-6 dark:text-white"}):V.jsx(US.Login,{className:"h-6 w-6 dark:text-white"})})})})}const US={User:u=>V.jsxs("svg",{width:"30",height:"30",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[V.jsx("path",{d:"M12 12C14.7614 12 17 9.76142 17 7C17 4.23858 14.7614 2 12 2C9.23858 2 7 4.23858 7 7C7 9.76142 9.23858 12 12 12Z",fill:"#212833"}),V.jsx("path",{d:"M12 14C7.58172 14 4 17.5817 4 22H20C20 17.5817 16.4183 14 12 14Z",fill:"#B8BABC"})]}),Login:u=>V.jsxs("svg",{width:"30",height:"30",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[V.jsx("path",{d:"M9 12L11 14L15 10",stroke:"#212833",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),V.jsx("path",{d:"M21 12H13",stroke:"#212833",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),V.jsx("path",{d:"M21 6V18C21 19.1046 20.1046 20 19 20H5C3.89543 20 3 19.1046 3 18V6C3 4.89543 3.89543 4 5 4H19C20.1046 4 21 4.89543 21 6Z",fill:"#B8BABC",stroke:"#212833",strokeWidth:"2"})]})},Za=({children:u,requireAuth:p=!0})=>{const[y,b]=Nn(as),[C]=Nn(k6),M=Ka();return Fe.useEffect(()=>{const D=async()=>{if(y.accessToken&&y.isAuthenticated)try{await jg.validateToken(y.accessToken)||b({isAuthenticated:!1,user:null,accessToken:null,refreshToken:null,loading:!1,error:"Token expired"})}catch(r){console.error("Token validation failed:",r),b({isAuthenticated:!1,user:null,accessToken:null,refreshToken:null,loading:!1,error:"Token validation failed"})}};p&&y.accessToken&&D()},[y.accessToken,y.isAuthenticated,p,b]),p?y.loading?V.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:V.jsxs("div",{className:"text-center",children:[V.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),V.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"..."})]})}):y.isAuthenticated?!C&&M.pathname!=="/pet-initialization"&&M.pathname!=="/setting"?V.jsx(Dg,{to:"/pet-initialization",replace:!0}):V.jsx(V.Fragment,{children:u}):V.jsx(Dg,{to:"/auth",state:{from:M.pathname,message:""},replace:!0}):V.jsx(V.Fragment,{children:u})},GS=({children:u})=>{var b;const[p]=Nn(as),y=Ka();if(p.isAuthenticated){const C=((b=y.state)==null?void 0:b.from)||"/home";return V.jsx(Dg,{to:C,replace:!0})}return V.jsx(V.Fragment,{children:u})},u8=yr({currentLevel:"world",currentRegion:"world",breadcrumb:[{id:"world",name:"",level:"world"}]}),h8=yr({});yr(!1);yr("");const d8=yr({salaryRange:[0,1e5],rentRange:[0,5e3],petFriendlyIndexRange:[0,100],selectedCurrencies:[],selectedRegionTypes:[],minLifeQuality:0,maxStressFactor:100});yr({enabled:!1,selectedRegions:[],maxCompare:5});yr(null);const pd=yr("zh");yr(u=>{const p=u(u8),y=u(h8),b=u(d8);return Object.values(y).filter(M=>p.currentLevel==="world"?M.type==="country":M.parentId===p.currentRegion).filter(M=>M.averageSalary>=b.salaryRange[0]&&M.averageSalary<=b.salaryRange[1]&&M.rentPrice>=b.rentRange[0]&&M.rentPrice<=b.rentRange[1]&&M.petFriendlyIndex>=b.petFriendlyIndexRange[0]&&M.petFriendlyIndex<=b.petFriendlyIndexRange[1]&&M.lifeQuality>=b.minLifeQuality&&M.stressFactor<=b.maxStressFactor)});const f8="modulepreload",p8=function(u){return"/"+u},$S={},m8=function(p,y,b){let C=Promise.resolve();if(y&&y.length>0){let D=function(G){return Promise.all(G.map(Q=>Promise.resolve(Q).then(se=>({status:"fulfilled",value:se}),se=>({status:"rejected",reason:se}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),U=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));C=D(y.map(G=>{if(G=p8(G),G in $S)return;$S[G]=!0;const Q=G.endsWith(".css"),se=Q?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${G}"]${se}`))return;const de=document.createElement("link");if(de.rel=Q?"stylesheet":f8,Q||(de.as="script"),de.crossOrigin="",de.href=G,U&&de.setAttribute("nonce",U),document.head.appendChild(de),Q)return new Promise((Pe,Se)=>{de.addEventListener("load",Pe),de.addEventListener("error",()=>Se(new Error(`Unable to preload CSS for ${G}`)))})}))}function M(D){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=D,window.dispatchEvent(r),!r.defaultPrevented)throw D}return C.then(D=>{for(const r of D||[])r.status==="rejected"&&M(r.reason);return p().catch(M)})},g8={color:"#B1C192",weight:4,opacity:.8,dashArray:""},Px=[{id:"beijing",position:[39.9042,116.4074],title:"",description:"",petFriendlyIndex:25,data:{averageSalary:12e3,rentPrice:4500,currency:"CNY",workLifeBalance:"",costOfLiving:95,qualityOfLife:75}},{id:"shanghai",position:[31.2304,121.4737],title:"",description:"",petFriendlyIndex:20,data:{averageSalary:13500,rentPrice:5200,currency:"CNY",workLifeBalance:"",costOfLiving:98,qualityOfLife:72}},{id:"shenzhen",position:[22.5431,114.0579],title:"",description:"",petFriendlyIndex:30,data:{averageSalary:11800,rentPrice:4800,currency:"CNY",workLifeBalance:"",costOfLiving:92,qualityOfLife:78}},{id:"guangzhou",position:[23.1291,113.2644],title:"",description:"",petFriendlyIndex:45,data:{averageSalary:9500,rentPrice:3200,currency:"CNY",workLifeBalance:"",costOfLiving:82,qualityOfLife:80}},{id:"hangzhou",position:[30.2741,120.1551],title:"",description:"",petFriendlyIndex:55,data:{averageSalary:10200,rentPrice:3500,currency:"CNY",workLifeBalance:"",costOfLiving:85,qualityOfLife:85}},{id:"chengdu",position:[30.5728,104.0668],title:"",description:"",petFriendlyIndex:75,data:{averageSalary:7800,rentPrice:2200,currency:"CNY",workLifeBalance:"",costOfLiving:68,qualityOfLife:88}},{id:"chongqing",position:[29.5647,106.5507],title:"",description:"",petFriendlyIndex:70,data:{averageSalary:7200,rentPrice:1800,currency:"CNY",workLifeBalance:"",costOfLiving:62,qualityOfLife:82}},{id:"wuhan",position:[30.5928,114.3055],title:"",description:"",petFriendlyIndex:60,data:{averageSalary:7500,rentPrice:2e3,currency:"CNY",workLifeBalance:"",costOfLiving:65,qualityOfLife:80}},{id:"xian",position:[34.3416,108.9398],title:"",description:"",petFriendlyIndex:65,data:{averageSalary:6800,rentPrice:1600,currency:"CNY",workLifeBalance:"",costOfLiving:58,qualityOfLife:78}},{id:"nanjing",position:[32.0603,118.7969],title:"",description:"",petFriendlyIndex:50,data:{averageSalary:8500,rentPrice:2800,currency:"CNY",workLifeBalance:"",costOfLiving:72,qualityOfLife:82}},{id:"qingdao",position:[36.0986,120.3719],title:"",description:"",petFriendlyIndex:68,data:{averageSalary:7e3,rentPrice:2300,currency:"CNY",workLifeBalance:"",costOfLiving:65,qualityOfLife:85}},{id:"dalian",position:[38.914,121.6147],title:"",description:"",petFriendlyIndex:72,data:{averageSalary:6500,rentPrice:2e3,currency:"CNY",workLifeBalance:"",costOfLiving:62,qualityOfLife:83}}],HS=[{id:"beijing-shanghai",name:"",description:"",waypoints:[{position:[39.9042,116.4074],name:""},{position:[34.8114,117.1175],name:""},{position:[32.0603,118.7969],name:""},{position:[31.2304,121.4737],name:""}],style:{color:"#ff4444",weight:6,opacity:.9},travelMode:"transit",curveStyle:{enabled:!0,intensity:.3}},{id:"beijing-shenzhen",name:"",description:"",waypoints:[{position:[39.9042,116.4074],name:""},{position:[30.5928,114.3055],name:""},{position:[23.1291,113.2644],name:""},{position:[22.5431,114.0579],name:""}],style:{color:"#44ff44",weight:5,opacity:.8},travelMode:"driving",curveStyle:{enabled:!0,intensity:.25}},{id:"hangzhou-chengdu",name:"",description:"",waypoints:[{position:[30.2741,120.1551],name:""},{position:[32.0603,118.7969],name:""},{position:[34.3416,108.9398],name:""},{position:[30.5728,104.0668],name:""}],style:{color:"#4444ff",weight:4,opacity:.7,dashArray:"10,5"},travelMode:"driving",curveStyle:{enabled:!0,intensity:.4}}],QC=u=>u>=8?Px:u>=5?Px.filter(p=>["beijing","shanghai","shenzhen","guangzhou","chengdu","hangzhou"].includes(p.id)):Px.filter(p=>["beijing","shanghai","shenzhen","chengdu"].includes(p.id)),e4=u=>u>=6?HS:u>=4?HS.filter(p=>["beijing-shanghai","beijing-shenzhen"].includes(p.id)):[];QC(4),e4(4);const uv={version:8,name:"WanderPaw Theme",metadata:{"mapbox:autocomposite":!1,"mapbox:type":"template","mapbox:groups":{}},sources:{"mapbox-streets":{type:"vector",url:"mapbox://mapbox.mapbox-streets-v8"},"mapbox-terrain":{type:"vector",url:"mapbox://mapbox.mapbox-terrain-v2"}},sprite:"mapbox://sprites/mapbox/streets-v12",glyphs:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",layers:[{id:"background",type:"background",paint:{"background-color":"#FEFDF9"}},{id:"landuse",type:"fill",source:"mapbox-streets","source-layer":"landuse",paint:{"fill-color":"#F0F3EA","fill-opacity":.8}},{id:"water",type:"fill",source:"mapbox-streets","source-layer":"water",paint:{"fill-color":"#B1C192","fill-opacity":.6}},{id:"building",type:"fill",source:"mapbox-streets","source-layer":"building",paint:{"fill-color":"#EADDC7","fill-opacity":.7,"fill-outline-color":"#E5E2DC"}},{id:"road-primary",type:"line",source:"mapbox-streets","source-layer":"road",filter:["in","class","primary","trunk"],paint:{"line-color":"#E5D4A8","line-width":{base:1.2,stops:[[6,1],[14,6],[20,20]]},"line-opacity":.4}},{id:"road-secondary",type:"line",source:"mapbox-streets","source-layer":"road",filter:["in","class","secondary","tertiary"],paint:{"line-color":"#D5C6B0","line-width":{base:1.2,stops:[[6,.5],[14,4],[20,15]]},"line-opacity":.3}},{id:"road-minor",type:"line",source:"mapbox-streets","source-layer":"road",filter:["in","class","street","street_limited"],paint:{"line-color":"#F0EDEA","line-width":{base:1.2,stops:[[6,.5],[14,2],[20,8]]},"line-opacity":.25}},{id:"road-primary-case",type:"line",source:"mapbox-streets","source-layer":"road",filter:["in","class","primary","trunk"],paint:{"line-color":"#B5A088","line-width":{base:1.2,stops:[[6,1.5],[14,8],[20,24]]},"line-opacity":.15},layout:{"line-cap":"round","line-join":"round"}},{id:"admin-boundaries",type:"line",source:"mapbox-streets","source-layer":"admin",paint:{"line-color":"#687949","line-width":{base:1,stops:[[4,1],[8,2],[12,3]]},"line-opacity":.5,"line-dasharray":[2,2]}},{id:"place-city",type:"symbol",source:"mapbox-streets","source-layer":"place",filter:["==","type","city"],layout:{"text-field":"{name}","text-font":["DIN Pro Medium","Arial Unicode MS Regular"],"text-size":{base:1.2,stops:[[6,14],[14,18],[20,24]]},"text-anchor":"center","text-offset":[0,.5],"text-allow-overlap":!1},paint:{"text-color":"#687949","text-halo-color":"#FEFDF9","text-halo-width":2}},{id:"place-town",type:"symbol",source:"mapbox-streets","source-layer":"place",filter:["in","type","town","village"],layout:{"text-field":"{name}","text-font":["DIN Pro Regular","Arial Unicode MS Regular"],"text-size":{base:1.2,stops:[[6,12],[14,14],[20,18]]},"text-anchor":"center","text-offset":[0,.5]},paint:{"text-color":"#8F6C53","text-halo-color":"#FEFDF9","text-halo-width":1.5}},{id:"road-label",type:"symbol",source:"mapbox-streets","source-layer":"road",filter:["has","name"],layout:{"text-field":"{name}","text-font":["DIN Pro Regular","Arial Unicode MS Regular"],"text-size":{base:1,stops:[[9,10],[16,12],[20,14]]},"symbol-placement":"line","text-rotation-alignment":"map","text-pitch-alignment":"viewport"},paint:{"text-color":"#687949","text-halo-color":"#FEFDF9","text-halo-width":1}}]},_8={...uv,layers:uv.layers.filter(u=>["background","water","landuse","road-primary","road-secondary","place-city"].includes(u.id))},Sl={forest:"#687949",sage:"#B1C192",cream:"#F0F3EA",gold:"#C7AA6C",earth:"#8F6C53",sand:"#BBA084",linen:"#EADDC7",pearl:"#F9F2E2",ivory:"#FDF5E8",snow:"#FDF9EF",pure:"#FEFDF9",mist:"#E5E2DC"},y8=(u="default")=>({style:u==="simple"?_8:uv,colors:Sl,className:"wanderpaw-map"});var uy={exports:{}},x8=uy.exports,WS;function v8(){return WS||(WS=1,function(u,p){(function(y,b){u.exports=b()})(x8,function(){var y,b,C;function M(r,U){if(!y)y=U;else if(!b)b=U;else{var G="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+y+")(sharedChunk); ("+b+")(sharedChunk); self.onerror = null;",Q={};y(Q),C=U(Q),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(C.workerUrl=window.URL.createObjectURL(new Blob([G],{type:"text/javascript"})))}}M(["exports"],function(r){var U=1e-6,G=typeof Float32Array<"u"?Float32Array:Array;function Q(n,e){var i=e[0],o=e[1],a=e[2],h=e[3],d=i*h-a*o;return d?(n[0]=h*(d=1/d),n[1]=-o*d,n[2]=-a*d,n[3]=i*d,n):null}function se(){var n=new G(9);return G!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function de(n,e){var i=e[0],o=e[1],a=e[2],h=e[3],d=e[4],x=e[5],w=e[6],T=e[7],I=e[8];return n[0]=d*I-x*T,n[1]=a*T-o*I,n[2]=o*x-a*d,n[3]=x*w-h*I,n[4]=i*I-a*w,n[5]=a*h-i*x,n[6]=h*T-d*w,n[7]=o*w-i*T,n[8]=i*d-o*h,n}function Pe(n,e,i){var o=e[0],a=e[1],h=e[2],d=e[3],x=e[4],w=e[5],T=e[6],I=e[7],P=e[8],R=i[0],F=i[1],N=i[2],H=i[3],Z=i[4],ee=i[5],oe=i[6],ae=i[7],q=i[8];return n[0]=R*o+F*d+N*T,n[1]=R*a+F*x+N*I,n[2]=R*h+F*w+N*P,n[3]=H*o+Z*d+ee*T,n[4]=H*a+Z*x+ee*I,n[5]=H*h+Z*w+ee*P,n[6]=oe*o+ae*d+q*T,n[7]=oe*a+ae*x+q*I,n[8]=oe*h+ae*w+q*P,n}function Se(){var n=new G(16);return G!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function ve(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ce(n,e){var i=e[0],o=e[1],a=e[2],h=e[3],d=e[4],x=e[5],w=e[6],T=e[7],I=e[8],P=e[9],R=e[10],F=e[11],N=e[12],H=e[13],Z=e[14],ee=e[15],oe=i*x-o*d,ae=i*w-a*d,q=i*T-h*d,re=o*w-a*x,le=o*T-h*x,fe=a*T-h*w,Me=I*H-P*N,Ce=I*Z-R*N,Re=I*ee-F*N,Ne=P*Z-R*H,Je=P*ee-F*H,gt=R*ee-F*Z,ct=oe*gt-ae*Je+q*Ne+re*Re-le*Ce+fe*Me;return ct?(n[0]=(x*gt-w*Je+T*Ne)*(ct=1/ct),n[1]=(a*Je-o*gt-h*Ne)*ct,n[2]=(H*fe-Z*le+ee*re)*ct,n[3]=(R*le-P*fe-F*re)*ct,n[4]=(w*Re-d*gt-T*Ce)*ct,n[5]=(i*gt-a*Re+h*Ce)*ct,n[6]=(Z*q-N*fe-ee*ae)*ct,n[7]=(I*fe-R*q+F*ae)*ct,n[8]=(d*Je-x*Re+T*Me)*ct,n[9]=(o*Re-i*Je-h*Me)*ct,n[10]=(N*le-H*q+ee*oe)*ct,n[11]=(P*q-I*le-F*oe)*ct,n[12]=(x*Ce-d*Ne-w*Me)*ct,n[13]=(i*Ne-o*Ce+a*Me)*ct,n[14]=(H*ae-N*re-Z*oe)*ct,n[15]=(I*re-P*ae+R*oe)*ct,n):null}function ze(n,e,i){var o=e[0],a=e[1],h=e[2],d=e[3],x=e[4],w=e[5],T=e[6],I=e[7],P=e[8],R=e[9],F=e[10],N=e[11],H=e[12],Z=e[13],ee=e[14],oe=e[15],ae=i[0],q=i[1],re=i[2],le=i[3];return n[0]=ae*o+q*x+re*P+le*H,n[1]=ae*a+q*w+re*R+le*Z,n[2]=ae*h+q*T+re*F+le*ee,n[3]=ae*d+q*I+re*N+le*oe,n[4]=(ae=i[4])*o+(q=i[5])*x+(re=i[6])*P+(le=i[7])*H,n[5]=ae*a+q*w+re*R+le*Z,n[6]=ae*h+q*T+re*F+le*ee,n[7]=ae*d+q*I+re*N+le*oe,n[8]=(ae=i[8])*o+(q=i[9])*x+(re=i[10])*P+(le=i[11])*H,n[9]=ae*a+q*w+re*R+le*Z,n[10]=ae*h+q*T+re*F+le*ee,n[11]=ae*d+q*I+re*N+le*oe,n[12]=(ae=i[12])*o+(q=i[13])*x+(re=i[14])*P+(le=i[15])*H,n[13]=ae*a+q*w+re*R+le*Z,n[14]=ae*h+q*T+re*F+le*ee,n[15]=ae*d+q*I+re*N+le*oe,n}function et(n,e,i){var o,a,h,d,x,w,T,I,P,R,F,N,H=i[0],Z=i[1],ee=i[2];return e===n?(n[12]=e[0]*H+e[4]*Z+e[8]*ee+e[12],n[13]=e[1]*H+e[5]*Z+e[9]*ee+e[13],n[14]=e[2]*H+e[6]*Z+e[10]*ee+e[14],n[15]=e[3]*H+e[7]*Z+e[11]*ee+e[15]):(a=e[1],h=e[2],d=e[3],x=e[4],w=e[5],T=e[6],I=e[7],P=e[8],R=e[9],F=e[10],N=e[11],n[0]=o=e[0],n[1]=a,n[2]=h,n[3]=d,n[4]=x,n[5]=w,n[6]=T,n[7]=I,n[8]=P,n[9]=R,n[10]=F,n[11]=N,n[12]=o*H+x*Z+P*ee+e[12],n[13]=a*H+w*Z+R*ee+e[13],n[14]=h*H+T*Z+F*ee+e[14],n[15]=d*H+I*Z+N*ee+e[15]),n}function pt(n,e,i){var o=i[0],a=i[1],h=i[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*a,n[5]=e[5]*a,n[6]=e[6]*a,n[7]=e[7]*a,n[8]=e[8]*h,n[9]=e[9]*h,n[10]=e[10]*h,n[11]=e[11]*h,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Tt(n,e,i){var o=Math.sin(i),a=Math.cos(i),h=e[4],d=e[5],x=e[6],w=e[7],T=e[8],I=e[9],P=e[10],R=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=h*a+T*o,n[5]=d*a+I*o,n[6]=x*a+P*o,n[7]=w*a+R*o,n[8]=T*a-h*o,n[9]=I*a-d*o,n[10]=P*a-x*o,n[11]=R*a-w*o,n}function It(n,e,i){var o=Math.sin(i),a=Math.cos(i),h=e[0],d=e[1],x=e[2],w=e[3],T=e[8],I=e[9],P=e[10],R=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=h*a-T*o,n[1]=d*a-I*o,n[2]=x*a-P*o,n[3]=w*a-R*o,n[8]=h*o+T*a,n[9]=d*o+I*a,n[10]=x*o+P*a,n[11]=w*o+R*a,n}function di(n,e,i){var o=Math.sin(i),a=Math.cos(i),h=e[0],d=e[1],x=e[2],w=e[3],T=e[4],I=e[5],P=e[6],R=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=h*a+T*o,n[1]=d*a+I*o,n[2]=x*a+P*o,n[3]=w*a+R*o,n[4]=T*a-h*o,n[5]=I*a-d*o,n[6]=P*a-x*o,n[7]=R*a-w*o,n}function Bt(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Yt(n,e,i){var o,a,h,d=i[0],x=i[1],w=i[2],T=Math.hypot(d,x,w);return T<U?null:(d*=T=1/T,x*=T,w*=T,o=Math.sin(e),a=Math.cos(e),n[0]=d*d*(h=1-a)+a,n[1]=x*d*h+w*o,n[2]=w*d*h-x*o,n[3]=0,n[4]=d*x*h-w*o,n[5]=x*x*h+a,n[6]=w*x*h+d*o,n[7]=0,n[8]=d*w*h+x*o,n[9]=x*w*h-d*o,n[10]=w*w*h+a,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function vt(n,e){var i=e[0],o=e[1],a=e[2],h=e[3],d=i+i,x=o+o,w=a+a,T=i*d,I=o*d,P=o*x,R=a*d,F=a*x,N=a*w,H=h*d,Z=h*x,ee=h*w;return n[0]=1-P-N,n[1]=I+ee,n[2]=R-Z,n[3]=0,n[4]=I-ee,n[5]=1-T-N,n[6]=F+H,n[7]=0,n[8]=R+Z,n[9]=F-H,n[10]=1-T-P,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var Jt=ze;function Ht(){var n=new G(3);return G!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Nt(n){var e=new G(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Li(n){return Math.hypot(n[0],n[1],n[2])}function Dt(n,e,i){var o=new G(3);return o[0]=n,o[1]=e,o[2]=i,o}function Ci(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function yi(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function xi(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function $t(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function Ei(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function Kt(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Ue(n,e,i,o){return n[0]=e[0]+i[0]*o,n[1]=e[1]+i[1]*o,n[2]=e[2]+i[2]*o,n}function zt(n,e){var i=e[0]-n[0],o=e[1]-n[1],a=e[2]-n[2];return i*i+o*o+a*a}function un(n){var e=n[0],i=n[1],o=n[2];return e*e+i*i+o*o}function ln(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function Di(n,e){var i=e[0],o=e[1],a=e[2],h=i*i+o*o+a*a;return h>0&&(h=1/Math.sqrt(h)),n[0]=e[0]*h,n[1]=e[1]*h,n[2]=e[2]*h,n}function Zi(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function fn(n,e,i){var o=e[0],a=e[1],h=e[2],d=i[0],x=i[1],w=i[2];return n[0]=a*w-h*x,n[1]=h*d-o*w,n[2]=o*x-a*d,n}function Ln(n,e,i,o){var a=e[0],h=e[1],d=e[2];return n[0]=a+o*(i[0]-a),n[1]=h+o*(i[1]-h),n[2]=d+o*(i[2]-d),n}function Xi(n,e,i){var o=e[0],a=e[1],h=e[2],d=i[3]*o+i[7]*a+i[11]*h+i[15];return n[0]=(i[0]*o+i[4]*a+i[8]*h+i[12])/(d=d||1),n[1]=(i[1]*o+i[5]*a+i[9]*h+i[13])/d,n[2]=(i[2]*o+i[6]*a+i[10]*h+i[14])/d,n}function Hr(n,e,i){var o=e[0],a=e[1],h=e[2];return n[0]=o*i[0]+a*i[3]+h*i[6],n[1]=o*i[1]+a*i[4]+h*i[7],n[2]=o*i[2]+a*i[5]+h*i[8],n}function js(n,e,i){var o=i[0],a=i[1],h=i[2],d=e[0],x=e[1],w=e[2],T=a*w-h*x,I=h*d-o*w,P=o*x-a*d,R=a*P-h*I,F=h*T-o*P,N=o*I-a*T,H=2*i[3];return I*=H,P*=H,F*=2,N*=2,n[0]=d+(T*=H)+(R*=2),n[1]=x+I+F,n[2]=w+P+N,n}function Rs(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var xr=yi,_a=xi,Go=Li;function ls(){var n=new G(4);return G!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function ia(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function pu(n,e){var i=e[0],o=e[1],a=e[2],h=e[3],d=i*i+o*o+a*a+h*h;return d>0&&(d=1/Math.sqrt(d)),n[0]=i*d,n[1]=o*d,n[2]=a*d,n[3]=h*d,n}function vs(n,e,i){var o=e[0],a=e[1],h=e[2],d=e[3];return n[0]=i[0]*o+i[4]*a+i[8]*h+i[12]*d,n[1]=i[1]*o+i[5]*a+i[9]*h+i[13]*d,n[2]=i[2]*o+i[6]*a+i[10]*h+i[14]*d,n[3]=i[3]*o+i[7]*a+i[11]*h+i[15]*d,n}function ws(){var n=new G(4);return G!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function ko(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function ya(n,e,i){i*=.5;var o=e[0],a=e[1],h=e[2],d=e[3],x=Math.sin(i),w=Math.cos(i);return n[0]=o*w+d*x,n[1]=a*w+h*x,n[2]=h*w-a*x,n[3]=d*w-o*x,n}function Ja(n,e,i){i*=.5;var o=e[0],a=e[1],h=e[2],d=e[3],x=Math.sin(i),w=Math.cos(i);return n[0]=o*w-h*x,n[1]=a*w+d*x,n[2]=h*w+o*x,n[3]=d*w-a*x,n}Ht(),ls();var ks,gc,_c,Vs,Al,xa=pu,va=(ks=Ht(),gc=Dt(1,0,0),_c=Dt(0,1,0),function(n,e,i){var o=Zi(e,i);return o<-.999999?(fn(ks,gc,e),Go(ks)<1e-6&&fn(ks,_c,e),Di(ks,ks),function(a,h,d){d*=.5;var x=Math.sin(d);a[0]=x*h[0],a[1]=x*h[1],a[2]=x*h[2],a[3]=Math.cos(d)}(n,ks,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(fn(ks,e,i),n[0]=ks[0],n[1]=ks[1],n[2]=ks[2],n[3]=1+o,xa(n,n))});function Wr(){var n=new G(2);return G!=Float32Array&&(n[0]=0,n[1]=0),n}function $o(n,e){var i=new G(2);return i[0]=n,i[1]=e,i}function Il(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n}function Qa(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n}function yc(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n}function wa(n){return Math.hypot(n[0],n[1])}function Pl(n,e){var i=e[0],o=e[1],a=i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),n[0]=e[0]*a,n[1]=e[1]*a,n}function Zn(n,e){return n[0]*e[0]+n[1]*e[1]}function ba(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}ws(),ws(),se(),Wr();var Ml,cs,Rl=function(){if(Al)return Vs;function n(e,i,o,a){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(a-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=a}return Al=1,Vs=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,a=0;a<8;a++){var h=this.sampleCurveX(o)-e;if(Math.abs(h)<i)return o;var d=this.sampleCurveDerivativeX(o);if(Math.abs(d)<1e-6)break;o-=h/d}var x=0,w=1;for(o=e,a=0;a<20&&(h=this.sampleCurveX(o),!(Math.abs(h-e)<i));a++)e>h?x=o:w=o,o=.5*(w-x)+x;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Vs}(),hh=ba(Rl);function kl(){if(cs)return Ml;function n(e,i){this.x=e,this.y=i}return cs=1,Ml=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,o=e.y-this.y;return i*i+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),o=Math.sin(e),a=o*this.x+i*this.y;return this.x=i*this.x-o*this.y,this.y=a,this},_rotateAround:function(e,i){var o=Math.cos(e),a=Math.sin(e),h=i.y+a*(this.x-i.x)+o*(this.y-i.y);return this.x=i.x+o*(this.x-i.x)-a*(this.y-i.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(e){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):e},Ml}var Rt=ba(kl());function Ta(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Ta(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!Ta(n[i],e[i]))return!1;return!0}return n===e}const md=Math.PI/180,xc=180/Math.PI;function _n(n){return n*md}function qe(n){return n*xc}const te=[[0,0],[1,0],[1,1],[0,1]];function ne(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function ge(n,e,i,o){const a=new hh(n,e,i,o);return function(h){return a.solve(h)}}const Ie=ge(.25,.1,.25,1);function we(n,e,i){return Math.min(i,Math.max(e,n))}function De(n,e,i){return(i=we((i-n)/(e-n),0,1))*i*(3-2*i)}function $e(n,e,i){const o=i-e,a=((n-e)%o+o)%o+e;return a===e?i:a}function Le(n,e,i){if(!n.length)return i(null,[]);let o=n.length;const a=new Array(n.length);let h=null;n.forEach((d,x)=>{e(d,(w,T)=>{w&&(h=w),a[x]=T,--o==0&&i(h,a)})})}function He(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}let lt=1;function Ze(){return lt++}function Mt(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function ei(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function ri(n,e,i){const o={};for(const a in n)o[a]=e.call(this,n[a],a,n);return o}function Si(n,e,i){const o={};for(const a in n)e.call(this,n[a],a,n)&&(o[a]=n[a]);return o}function Ai(n){return Array.isArray(n)?n.map(Ai):typeof n=="object"&&n?ri(n,Ai):n}function Pi(n,e){for(let i=0;i<n.length;i++)if(e.indexOf(n[i])>=0)return!0;return!1}const Hi={};function zi(n){Hi[n]||(typeof console<"u"&&console.warn(n),Hi[n]=!0)}function Bn(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function nn(n){let e=0;for(let i,o,a=0,h=n.length,d=h-1;a<h;d=a++)i=n[a],o=n[d],e+=(o.x-i.x)*(i.y+o.y);return e}function tr([n,e,i]){const o=_n(e+90),a=_n(i);return{x:n*Math.cos(o)*Math.sin(a),y:n*Math.sin(o)*Math.sin(a),z:n*Math.cos(a),azimuthal:e,polar:i}}function Tn(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function xn(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,a,h)=>{const d=a||h;return e[o]=!d||d.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let fr=null;function gr(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function lr(n,e,i,o){for(;e<i;){const a=e+i>>1;n[a]<o?e=a+1:i=a}return e}function Nr(n,e,i,o){for(;e<i;){const a=e+i>>1;n[a]<=o?e=a+1:i=a}return e}function Lr(n){return n>0?1/(1.001-n):1+n}function Ds(n){return n>0?1-1/(1.001-n):-n}function to(n,e,i){return(n-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const us={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!us.API_URL)return null;try{const n=new URL(us.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v0.3.0.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Dl(n){return us.API_URL_REGEX.test(n)}function gd(n){return us.API_SPRITE_REGEX.test(n)}let Ll,zl,Fl,vc,wc,dh;function mu(){return Ll==null&&(Ll=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ll}const Ho={now:()=>vc!==void 0?vc:performance.now(),setNow(n){vc=n},restoreNow(){vc=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:o}=n;wc||(wc=document.createElement("canvas"));const a=wc.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(i>wc.width||o>wc.height)&&(wc.width=i,wc.height=o),a.clearRect(-e,-e,i+2*e,o+2*e),a.drawImage(n,0,0,i,o),a.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:n=>(zl||(zl=document.createElement("a")),zl.href=n,zl.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Fl==null&&(Fl=window.matchMedia("(prefers-reduced-motion: reduce)")),Fl.matches)},hasCanvasFingerprintNoise(){if(dh!==void 0)return dh;if(!mu())return dh=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let i=0;for(let a=0;a<n.width;++a)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(a,0,1,1);const o=e.getImageData(0,0,n.width,n.height);i=0;for(let a=0;a<o.data.length;++a)if(a%4!=3&&i++!==o.data[a])return dh=!0,!0;return dh=!1,!1}};function io(n,e){const i=n.indexOf("?");if(i<0)return`${n}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(n.slice(i));for(const a in e)o.set(a,e[a]);return`${n.slice(0,i)}?${o.toString()}`}function Us(n,e={persistentParams:[]}){const i=n.indexOf("?");if(i<0)return n;const o=new URLSearchParams,a=new URLSearchParams(n.slice(i));for(const d of e.persistentParams){const x=a.get(d);x&&o.set(d,x)}const h=o.toString();return`${n.slice(0,i)}${h.length>0?`?${h}`:""}`}const el="mapbox-tiles";let Do=500,Xn=50;const gu=["language","worldview","jobid"];let na,bc;function Ol(){try{return caches}catch{}}function Tc(){const n=Ol();n&&na==null&&(na=n.open(el))}let _d=1/0;const fh={supported:!1,testSupport:function(n){!Wo&&po&&(Lo?yu(n):bs=n)}};let bs,po,Wo=!1,Lo=!1;const _u=typeof self<"u"?self:{};function yu(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,po),n.isContextLost())return;fh.supported=!0}catch{}n.deleteTexture(e),Wo=!0}_u.document&&(po=_u.document.createElement("img"),po.onload=function(){bs&&yu(bs),bs=null,Lo=!0},po.onerror=function(){Wo=!0,bs=null},po.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const qo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(qo);class pn extends Error{constructor(e,i,o){i===401&&Dl(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ph=Tn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Sa=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(ph())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,a){const h=new AbortController,d=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:ph(),referrerPolicy:o.referrerPolicy,signal:h.signal});let x=!1,w=!1;const T=(I=d.url).indexOf("sku=")>0&&Dl(I);var I;o.type==="json"&&d.headers.set("Accept","application/json");const P=(F,N,H)=>{if(w)return;if(F&&F.message!=="SecurityError"&&zi(F.toString()),N&&H)return R(N);const Z=Date.now();fetch(d).then(ee=>{if(ee.ok){const oe=T?ee.clone():null;return R(ee,oe,Z)}return a(new pn(ee.statusText,ee.status,o.url))}).catch(ee=>{ee.name!=="AbortError"&&a(new Error(`${ee.message} ${o.url}`))})},R=(F,N,H)=>{(o.type==="arrayBuffer"?F.arrayBuffer():o.type==="json"?F.json():F.text()).then(Z=>{w||(N&&H&&function(ee,oe,ae){if(Tc(),na==null)return;const q=xn(oe.headers.get("Cache-Control")||"");if(q["no-store"])return;const re={status:oe.status,statusText:oe.statusText,headers:new Headers};oe.headers.forEach((Me,Ce)=>re.headers.set(Ce,Me)),q["max-age"]&&re.headers.set("Expires",new Date(ae+1e3*q["max-age"]).toUTCString());const le=re.headers.get("Expires");if(!le||new Date(le).getTime()-ae<42e4)return;let fe=Us(ee.url,{persistentParams:gu});if(oe.status===206){const Me=ee.headers.get("Range");if(!Me)return;re.status=200,fe=io(fe,{range:Me})}(function(Me,Ce){if(bc===void 0)try{new Response(new ReadableStream),bc=!0}catch{bc=!1}bc?Ce(Me.body):Me.blob().then(Ce).catch(Re=>zi(Re.message))})(oe,Me=>{const Ce=new Response((Re=oe.status)!==200&&Re!==404&&[101,103,204,205,304].includes(Re)?null:Me,re);var Re;Tc(),na!=null&&na.then(Ne=>Ne.put(fe,Ce)).catch(Ne=>zi(Ne.message))})}(d,N,H),x=!0,a(null,Z,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(Z=>{w||a(new Error(Z.message))})};return T?function(F,N){if(Tc(),na==null)return N(null);na.then(H=>{let Z=Us(F.url,{persistentParams:gu});const ee=F.headers.get("Range");ee&&(Z=io(Z,{range:ee})),H.match(Z).then(oe=>{const ae=function(q){if(!q)return!1;const re=new Date(q.headers.get("Expires")||0),le=xn(q.headers.get("Cache-Control")||"");return Number(re)>Date.now()&&!le["no-cache"]}(oe);H.delete(Z).catch(N),ae&&H.put(Z,oe.clone()).catch(N),N(null,oe,ae)}).catch(N)}).catch(N)}(d,P):P(null,null),{cancel:()=>{w=!0,x||h.abort()}}}(n,e);if(Tn(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(o,a){const h=new XMLHttpRequest;h.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(const d in o.headers)h.setRequestHeader(d,o.headers[d]);return o.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=o.credentials==="include",h.onerror=()=>{a(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let d=h.response;if(o.type==="json")try{d=JSON.parse(h.response)}catch(x){return a(x)}a(null,d,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else a(new pn(h.statusText,h.status,o.url))},h.send(o.body),{cancel:()=>h.abort()}}(n,e)},mh=function(n,e){return Sa(He(n,{type:"arrayBuffer"}),e)};function Ep(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const Nl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Bl,jl;Bl=[],jl=0;const Sc=function(n,e){if(fh.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),jl>=us.MAX_PARALLEL_IMAGE_REQUESTS){const h={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Bl.push(h),h}jl++;let i=!1;const o=()=>{if(!i)for(i=!0,jl--;Bl.length&&jl<us.MAX_PARALLEL_IMAGE_REQUESTS;){const h=Bl.shift(),{requestParameters:d,callback:x,cancelled:w}=h;w||(h.cancel=Sc(d,x).cancel)}},a=mh(n,(h,d,x,w)=>{o(),h?e(h):d&&(self.createImageBitmap?function(T,I){const P=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(P).then(R=>{I(null,R)}).catch(R=>{I(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(T,I)=>e(T,I,x,w)):function(T,I){const P=new Image;P.onload=()=>{I(null,P),URL.revokeObjectURL(P.src),P.onload=null,requestAnimationFrame(()=>{P.src=Nl})},P.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const R=new Blob([new Uint8Array(T)],{type:"image/png"});P.src=T.byteLength?URL.createObjectURL(R):Nl}(d,(T,I)=>e(T,I,x,w)))});return{cancel:()=>{a.cancel(),o()}}};var Ec,Zo,gh,tl={exports:{}},yd={exports:{}},xu={exports:{}},mo=function(){if(gh)return tl.exports;gh=1;var n=(Ec||(Ec=1,yd.exports=function(i,o){var a,h,d,x,w,T,I,P;for(h=i.length-(a=3&i.length),d=o,w=3432918353,T=461845907,P=0;P<h;)I=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,d=27492+(65535&(x=5*(65535&(d=(d^=I=(65535&(I=(I=(65535&I)*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(I=0,a){case 3:I^=(255&i.charCodeAt(P+2))<<16;case 2:I^=(255&i.charCodeAt(P+1))<<8;case 1:d^=I=(65535&(I=(I=(65535&(I^=255&i.charCodeAt(P)))*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return d^=i.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}),yd.exports),e=(Zo||(Zo=1,xu.exports=function(i,o){for(var a,h=i.length,d=o^h,x=0;h>=4;)a=1540483477*(65535&(a=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24))+((1540483477*(a>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),h-=4,++x;switch(h){case 3:d^=(255&i.charCodeAt(x+2))<<16;case 2:d^=(255&i.charCodeAt(x+1))<<8;case 1:d=1540483477*(65535&(d^=255&i.charCodeAt(x)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}),xu.exports);return tl.exports=n,tl.exports.murmur3=n,tl.exports.murmur2=e,tl.exports}(),Cc=ba(mo);class Vl{constructor(e,...i){He(this,i[0]||{}),this.type=e}}class ra extends Vl{constructor(e,i={}){super("error",He({error:e},i))}}function _h(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function Ac(n,e,i){if(i&&i[n]){const o=i[n].indexOf(e);o!==-1&&i[n].splice(o,1)}}class Ul{on(e,i){return this._listeners=this._listeners||{},_h(e,i,this._listeners),this}off(e,i){return Ac(e,i,this._listeners),Ac(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},_h(e,i,this._oneTimeListeners),this):new Promise(o=>{this.once(e,o)})}fire(e,i){const o=typeof e=="string"?new Vl(e,i):e,a=o.type;if(this.listens(a)){o.target=this;const h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const w of h)w.call(this,o);const d=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const w of d)Ac(a,w,this._oneTimeListeners),w.call(this,o);const x=this._eventedParent;x&&(He(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(o))}else o instanceof ra&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Ls{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Ls(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,o]=e.split("");return new Ls({name:i,iconsetId:o})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Ls.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var vu,Ic={},hs=function(){if(vu)return Ic;vu=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(h){return(h=Math.round(h))<0?0:h>255?255:h}function i(h){return e(h[h.length-1]==="%"?parseFloat(h)/100*255:parseInt(h))}function o(h){return(d=h[h.length-1]==="%"?parseFloat(h)/100:parseFloat(h))<0?0:d>1?1:d;var d}function a(h,d,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?h+(d-h)*x*6:2*x<1?d:3*x<2?h+(d-h)*(2/3-x)*6:h}try{Ic.parseCSSColor=function(h){var d,x=h.replace(/ /g,"").toLowerCase();if(x in n)return n[x].slice();if(x[0]==="#")return x.length===4?(d=parseInt(x.substr(1),16))>=0&&d<=4095?[(3840&d)>>4|(3840&d)>>8,240&d|(240&d)>>4,15&d|(15&d)<<4,1]:null:x.length===7&&(d=parseInt(x.substr(1),16))>=0&&d<=16777215?[(16711680&d)>>16,(65280&d)>>8,255&d,1]:null;var w=x.indexOf("("),T=x.indexOf(")");if(w!==-1&&T+1===x.length){var I=x.substr(0,w),P=x.substr(w+1,T-(w+1)).split(","),R=1;switch(I){case"rgba":if(P.length!==4)return null;R=o(P.pop());case"rgb":return P.length!==3?null:[i(P[0]),i(P[1]),i(P[2]),R];case"hsla":if(P.length!==4)return null;R=o(P.pop());case"hsl":if(P.length!==3)return null;var F=(parseFloat(P[0])%360+360)%360/360,N=o(P[1]),H=o(P[2]),Z=H<=.5?H*(N+1):H+N-H*N,ee=2*H-Z;return[e(255*a(ee,Z,F+1/3)),e(255*a(ee,Z,F)),e(255*a(ee,Z,F-1/3)),R];default:return null}}return null}}catch{}return Ic}();class mn{constructor(e,i,o,a=1){this.r=e,this.g=i,this.b=o,this.a=a}static parse(e){if(!e)return;if(e instanceof mn)return e;if(typeof e!="string")return;const i=hs.parseCSSColor(e);return i?new mn(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,o,a]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*o)},${a})`}toNonPremultipliedRenderColor(e){const{r:i,g:o,b:a,a:h}=this;return new yh(e,i,o,a,h)}toPremultipliedRenderColor(e){const{r:i,g:o,b:a,a:h}=this;return new Ef(e,i*h,o*h,a*h,h)}clone(){return new mn(this.r,this.g,this.b,this.a)}}class zo{constructor(e,i,o,a,h,d=!1){if(this.premultiplied=!1,this.premultiplied=d,e){const x=e.image.height,w=x*x;this.premultiplied?(i=h===0?0:i/h*(x-1),o=h===0?0:o/h*(x-1),a=h===0?0:a/h*(x-1)):(i*=x-1,o*=x-1,a*=x-1);const T=Math.floor(i),I=Math.floor(o),P=Math.floor(a),R=Math.ceil(i),F=Math.ceil(o),N=Math.ceil(a),H=i-T,Z=o-I,ee=a-P,oe=e.image.data,ae=4*(T+I*w+P*x),q=4*(T+I*w+N*x),re=4*(T+F*w+P*x),le=4*(T+F*w+N*x),fe=4*(R+I*w+P*x),Me=4*(R+I*w+N*x),Ce=4*(R+F*w+P*x),Re=4*(R+F*w+N*x);if(ae<0||Re>=oe.length)throw new Error("out of range");this.r=gi(gi(gi(oe[ae],oe[q],ee),gi(oe[re],oe[le],ee),Z),gi(gi(oe[fe],oe[Me],ee),gi(oe[Ce],oe[Re],ee),Z),H)/255*(this.premultiplied?h:1),this.g=gi(gi(gi(oe[ae+1],oe[q+1],ee),gi(oe[re+1],oe[le+1],ee),Z),gi(gi(oe[fe+1],oe[Me+1],ee),gi(oe[Ce+1],oe[Re+1],ee),Z),H)/255*(this.premultiplied?h:1),this.b=gi(gi(gi(oe[ae+2],oe[q+2],ee),gi(oe[re+2],oe[le+2],ee),Z),gi(gi(oe[fe+2],oe[Me+2],ee),gi(oe[Ce+2],oe[Re+2],ee),Z),H)/255*(this.premultiplied?h:1),this.a=h}else this.r=i,this.g=o,this.b=a,this.a=h}toArray(){const{r:e,g:i,b:o,a}=this;return[255*e,255*i,255*o,a]}toHslaArray(){let{r:e,g:i,b:o,a}=this;if(this.premultiplied){if(a===0)return[0,0,0,0];e/=a,i/=a,o/=a}const h=Math.min(Math.max(e,0),1),d=Math.min(Math.max(i,0),1),x=Math.min(Math.max(o,0),1),w=Math.min(h,d,x),T=Math.max(h,d,x),I=(w+T)/2;if(w===T)return[0,0,100*I,a];const P=T-w,R=I>.5?P/(2-T-w):P/(T+w);let F=0;return T===h?F=(d-x)/P+(d<x?6:0):T===d?F=(x-h)/P+2:T===x&&(F=(h-d)/P+4),F*=60,[Math.min(Math.max(F,0),360),Math.min(Math.max(100*R,0),100),Math.min(Math.max(100*I,0),100),a]}toArray01(){const{r:e,g:i,b:o,a}=this;return[e,i,o,a]}toArray01Scaled(e){const{r:i,g:o,b:a}=this;return[i*e,o*e,a*e]}toArray01Linear(){const{r:e,g:i,b:o,a}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(o,2.2),a]}}class yh extends zo{constructor(e,i,o,a,h){super(e,i,o,a,h,!1)}}class Ef extends zo{constructor(e,i,o,a,h){super(e,i,o,a,h,!0)}}function gi(n,e,i){return n*(1-i)+e*i}function wu(n,e,i){return n.map((o,a)=>gi(o,e[a],i))}mn.black=new mn(0,0,0,1),mn.white=new mn(1,1,1,1),mn.transparent=new mn(0,0,0,0),mn.red=new mn(1,0,0,1),mn.blue=new mn(0,0,1,1);var il=Object.freeze({__proto__:null,array:wu,color:function(n,e,i){return new mn(gi(n.r,e.r,i),gi(n.g,e.g,i),gi(n.b,e.b,i),gi(n.a,e.a,i))},number:gi});function Ea(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}class go extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Cf{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,a]of i)this.bindings[o]=a}concat(e){return new Cf(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const bu={kind:"null"},oi={kind:"number"},An={kind:"string"},Sn={kind:"boolean"},_o={kind:"color"},nl={kind:"object"},In={kind:"value"},xd={kind:"collator"},Tu={kind:"formatted"},xh={kind:"resolvedImage"};function Gs(n,e){return{kind:"array",itemType:n,N:e}}function zr(n){if(n.kind==="array"){const e=zr(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Sm=[bu,oi,An,Sn,_o,Tu,nl,Gs(In),xh];function Gl(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Gl(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of Sm)if(!Gl(i,e))return null}}return`Expected ${zr(n)} but found ${zr(e)} instead.`}function $l(n,e){return e.some(i=>i.kind===n.kind)}function vh(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}function vd(n,e){return n.kind==="array"&&e.kind==="array"?n.N===e.N&&vd(n.itemType,e.itemType):n.kind===e.kind}class Su{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class wd{constructor(e,i,o,a,h){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=a,this.textColor=h}}class $s{constructor(e){this.sections=e}static fromString(e){return new $s([new wd(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof $s?e:$s.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const a=i.image.getPrimary().id.toString();e.push(["image",a]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(o)}return e}}class rl{constructor(e,i={}){if(this.id=Ls.from(e),this.options=Object.assign({},i),i.transform){const{a:o,b:a,c:h,d,e:x,f:w}=i.transform;this.options.transform=new DOMMatrix([o,a,h,d,x,w])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:o,d:a,e:h,f:d}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:o,d:a,e:h,f:d}})}static parse(e){let i,o,a,h;try{({name:i,iconsetId:o,params:a,transform:h}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:d,b:x,c:w,d:T,e:I,f:P}=h||{};return new rl({name:i,iconsetId:o},{params:a,transform:new DOMMatrix([d,x,w,T,I,P])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class no{constructor(e,i,o,a,h=!1){this.primaryId=Ls.from(e),this.primaryOptions=i,o&&(this.secondaryId=Ls.from(o)),this.secondaryOptions=a,this.available=h}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new rl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new rl(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?no.build({name:e}):e}static build(e,i,o,a){return!e||typeof e=="object"&&!("name"in e)?null:new no(e,o,i,a)}}function Pc(n,e,i,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,i,o]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Wi(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof mn||n instanceof Su||n instanceof $s||n instanceof no)return!0;if(Array.isArray(n)){for(const e of n)if(!Wi(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Wi(n[e]))return!1;return!0}return!1}function Xt(n){if(n===null)return bu;if(typeof n=="string")return An;if(typeof n=="boolean")return Sn;if(typeof n=="number")return oi;if(n instanceof mn)return _o;if(n instanceof Su)return xd;if(n instanceof $s)return Tu;if(n instanceof no)return xh;if(Array.isArray(n)){const e=n.length;let i;for(const o of n){const a=Xt(o);if(i){if(i===a)continue;i=In;break}i=a}return Gs(i||In,e)}return nl}function yo(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof $s||n instanceof no||n instanceof mn?n.toString():JSON.stringify(n)}class vi{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Wi(e[1]))return i.error("invalid value");const o=e[1];let a=Xt(o);const h=i.expectedType;return a.kind!=="array"||a.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(a=h),new vi(a,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof mn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof $s?this.value.serialize():this.value}}class kr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Eu={string:An,number:oi,boolean:Sn,object:nl};class mi{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,a=1;const h=e[0];if(h==="array"){let x,w;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in Eu)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=Eu[T],a++}else x=In;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=e[2],a++}o=Gs(x,w)}else o=Eu[h];const d=[];for(;a<e.length;a++){const x=i.parse(e[a],a,In);if(!x)return null;d.push(x)}return new mi(o,d)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!Gl(this.type,Xt(o)))return o;if(i===this.args.length-1)throw new kr(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${zr(Xt(o))} but was expected to be of type ${zr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&i.push(a)}}return i.concat(this.args.map(o=>o.serialize()))}}class Mc{constructor(e){this.type=Tu,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const a=[];let h=!1;for(let d=1;d<=e.length-1;++d){const x=e[d];if(h&&typeof x=="object"&&!Array.isArray(x)){h=!1;let w=null;if(x["font-scale"]&&(w=i.parseObjectValue(x["font-scale"],d,"font-scale",oi),!w))return null;let T=null;if(x["text-font"]&&(T=i.parseObjectValue(x["text-font"],d,"text-font",Gs(An)),!T))return null;let I=null;if(x["text-color"]&&(I=i.parseObjectValue(x["text-color"],d,"text-color",_o),!I))return null;const P=a[a.length-1];P.scale=w,P.font=T,P.textColor=I}else{const w=i.parse(e[d],d,In);if(!w)return null;const T=w.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,a.push({content:w,scale:null,font:null,textColor:null})}}return new Mc(a)}evaluate(e){return new $s(this.sections.map(i=>{const o=i.content.evaluate(e);return vd(Xt(o),xh)?new wd("",o,null,null,null):new wd(yo(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class Rc{constructor(e,i,o,a){this._imageWarnHistory={},this.type=xh,this.namePrimary=e,this.nameSecondary=i,o&&(this.paramsPrimary=o.params,this.iconsetIdPrimary=o.iconset?o.iconset.id:void 0),a&&(this.paramsSecondary=a.params,this.iconsetIdSecondary=a.iconset?a.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let o=1;const a=[];function h(){if(o<e.length){const x=i.parse(e[o],o++,An);return x?(a.push({image:x,options:{}}),!0):(i.error(a.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function d(){if(o<e.length){const w=e[o];if((x=w)===null||typeof x!="object"||Array.isArray(x))return!0;const T=w.params,I=w.iconset,P=i.concat(o);if(!T&&!I)return o++,!0;if(T){if(typeof T!="object"||T.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const R={},F=P.concat(void 0,"params");for(const N in T){if(!N)return F.error("Image parameter name should be non-empty"),!1;const H=F.concat(void 0,N).parse(T[N],void 0,_o,void 0,{typeAnnotation:"coerce"});if(!H)return!1;R[N]=H}a[a.length-1].options.params=R}if(I){if(typeof I!="object"||I.constructor!==Object)return P.error('Image options "iconset" should be an object'),!1;if(!I.id)return P.error('Image options "iconset" should have an "id" property'),!1;a[a.length-1].options.iconset=I}return o++,!0}var x;return!0}for(let x=0;x<2;x++)if(!h()||!d())return;return new Rc(a[0].image,a[1]?a[1].image:void 0,a[0].options,a[1]?a[1].options:void 0)}evaluateParams(e,i){const o={};if(i){for(const a in i)if(i[a])try{o[a]=i[a].evaluate(e)}catch{continue}if(Object.keys(o).length!==0)return{params:o}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},o=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,a=no.build(i,o,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(a&&e.availableImages){const h=a.getPrimary().id;if(a.available=e.availableImages.some(d=>Ls.isEqual(d,h)),a.available){const d=a.getSecondary()?a.getSecondary().id:null;d&&(a.available=e.availableImages.some(x=>Ls.isEqual(x,d)))}}return a}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const o={};if(i&&(o.iconset={id:i}),e){o.params={};for(const a in e)e[a]&&(o.params[a]=e[a].serialize())}return Object.keys(o).length>0?o:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function sl(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}const kc={"to-boolean":Sn,"to-color":_o,"to-number":oi,"to-string":An};class Xo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0],a=[];let h=bu;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const d=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);h=Gs(i.expectedType.itemType,d)}else{if(!(d>0&&Wi(e[1][0])))return null;h=Gs(Xt(e[1][0]),d)}for(let x=0;x<d;x++){const w=e[1][x];let T;if(sl(w)==="array")T=i.parse(w,void 0,h.itemType);else{const I=sl(w);if(I!==h.itemType.kind)return i.error(`Expected ${h.itemType.kind} but found ${I}.`);T=i.registry.literal.parse(["literal",w===void 0?null:w],i)}if(!T)return null;a.push(T)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");h=kc[o];for(let d=1;d<e.length;d++){const x=i.parse(e[d],d,In);if(!x)return null;a.push(x)}}return new Xo(h,a)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(const a of this.args){if(i=a.evaluate(e),o=null,i instanceof mn)return i;if(typeof i=="string"){const h=e.parseColor(i);if(h)return h}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Pc(i[0],i[1],i[2],i[3]),!o))return new mn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new kr(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const a=Number(i);if(!isNaN(a))return a}throw new kr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?$s.fromString(yo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?no.build(yo(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):yo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Mc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Rc(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Hs=["Unknown","Point","LineString","Polygon"];class wh{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Hs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-e[0])+this.featureDistanceData.bearing[1]*(a*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=mn.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class qr{constructor(e,i,o,a,h){this.name=e,this.type=i,this._evaluate=o,this.args=a,this._overloadIndex=h}evaluate(e){if(!this._evaluate){const i=qr.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const o=e[0],a=qr.definitions[o];if(!a)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const h=Array.isArray(a)?a[0]:a.type,d=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,x=[];let w=null,T=-1;for(const[I,P]of d){if(Array.isArray(I)&&I.length!==e.length-1)continue;x.push(I),T++,w=new Lu(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const R=[];let F=!1;for(let N=1;N<e.length;N++){const H=e[N],Z=Array.isArray(I)?I[N-1]:I.type,ee=w.parse(H,1+R.length,Z);if(!ee){F=!0;break}R.push(ee)}if(!F)if(Array.isArray(I)&&I.length!==R.length)w.error(`Expected ${I.length} arguments, but found ${R.length} instead.`);else{for(let N=0;N<R.length;N++){const H=Array.isArray(I)?I[N]:I.type,Z=R[N];w.concat(N+1).checkSubtype(H,Z.type)}if(w.errors.length===0)return new qr(o,h,P,R,T)}}if(x.length===1)i.errors.push(...w.errors);else{const I=(x.length?x:d.map(([R])=>R)).map(bd).join(" | "),P=[];for(let R=1;R<e.length;R++){const F=i.parse(e[R],1+P.length);if(!F)return null;P.push(zr(F.type))}i.error(`Expected arguments of type ${I}, but found (${P.join(", ")}) instead.`)}return null}static register(e,i){qr.definitions=i;for(const o in i)e[o]=qr}}function bd(n){return Array.isArray(n)?`(${n.map(zr).join(", ")})`:`(${zr(n.type)}...)`}class xo{constructor(e,i,o){this.type=xd,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const a=o["case-sensitive"]===void 0?i.parse(!1,1,Sn):i.parseObjectValue(o["case-sensitive"],1,"case-sensitive",Sn);if(!a)return null;const h=o["diacritic-sensitive"]===void 0?i.parse(!1,1,Sn):i.parseObjectValue(o["diacritic-sensitive"],1,"diacritic-sensitive",Sn);if(!h)return null;let d=null;return o.locale&&(d=i.parseObjectValue(o.locale,1,"locale",An),!d)?null:new xo(a,h,d)}evaluate(e){return new Su(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Zr(n,e,i=0,o=n.length-1,a=Td){for(;o>i;){if(o-i>600){const w=o-i+1,T=e-i+1,I=Math.log(w),P=.5*Math.exp(2*I/3),R=.5*Math.sqrt(I*P*(w-P)/w)*(T-w/2<0?-1:1);Zr(n,e,Math.max(i,Math.floor(e-T*P/w+R)),Math.min(o,Math.floor(e+(w-T)*P/w+R)),a)}const h=n[e];let d=i,x=o;for(bh(n,i,e),a(n[o],h)>0&&bh(n,i,o);d<x;){for(bh(n,d,x),d++,x--;a(n[d],h)<0;)d++;for(;a(n[x],h)>0;)x--}a(n[i],h)===0?bh(n,i,x):(x++,bh(n,x,o)),x<=e&&(i=x+1),e<=x&&(o=x-1)}}function bh(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function Td(n,e){return n<e?-1:n>e?1:0}function Em(n){let e=0;for(let i,o,a=0,h=n.length,d=h-1;a<h;d=a++)i=n[a],o=n[d],e+=(o.x-i.x)*(i.y+o.y);return e}function ol(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Hl(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function al(n,e,i){const o=n[0]-e[0],a=n[1]-e[1],h=n[0]-i[0],d=n[1]-i[1];return o*d-h*a==0&&o*h<=0&&a*d<=0}function Dc(n,e,i=!1){let o=!1;for(let x=0,w=e.length;x<w;x++){const T=e[x];for(let I=0,P=T.length,R=P-1;I<P;R=I++){const F=T[R],N=T[I];if(al(n,F,N))return i;(h=F)[1]>(a=n)[1]!=(d=N)[1]>a[1]&&a[0]<(d[0]-h[0])*(a[1]-h[1])/(d[1]-h[1])+h[0]&&(o=!o)}}var a,h,d;return o}function Af(n,e,i,o){const a=o[0]-i[0],h=o[1]-i[1],d=(n[0]-i[0])*h-a*(n[1]-i[1]),x=(e[0]-i[0])*h-a*(e[1]-i[1]);return d>0&&x<0||d<0&&x>0}function Th(n,e,i,o){return(a=[o[0]-i[0],o[1]-i[1]])[0]*(h=[e[0]-n[0],e[1]-n[1]])[1]-a[1]*h[0]!=0&&!(!Af(n,e,i,o)||!Af(i,o,n,e));var a,h}function If(n){const e=new Rt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Rt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const o of n[0])e.x>o.x&&(e.x=o.x),e.y>o.y&&(e.y=o.y),i.x<o.x&&(i.x=o.x),i.y<o.y&&(i.y=o.y);return{min:e,max:i}}const ll=8192;function Cm(n,e){const i=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(i*a*ll),Math.round(o*a*ll)]}function Am(n,e){for(let i=0;i<e.length;i++)if(Dc(n,e[i]))return!0;return!1}function Cp(n,e,i){for(const o of i)for(let a=0,h=o.length,d=h-1;a<h;d=a++)if(Th(n,e,o[d],o[a]))return!0;return!1}function Yo(n,e){for(let i=0;i<n.length;++i)if(!Dc(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(Cp(n[i],n[i+1],e))return!1;return!0}function sa(n,e){for(let i=0;i<e.length;i++)if(Yo(n,e[i]))return!0;return!1}function Sd(n,e,i){const o=[];for(let a=0;a<n.length;a++){const h=[];for(let d=0;d<n[a].length;d++){const x=Cm(n[a][d],i);ol(e,x),h.push(x)}o.push(h)}return o}function Pf(n,e,i){const o=[];for(let a=0;a<n.length;a++){const h=Sd(n[a],e,i);o.push(h)}return o}function Sh(n,e,i,o){if(n[0]<i[0]||n[0]>i[2]){const a=.5*o;let h=n[0]-i[0]>a?-o:i[0]-n[0]>a?o:0;h===0&&(h=n[0]-i[2]>a?-o:i[2]-n[0]>a?o:0),n[0]+=h}ol(e,n)}function Ed(n,e,i,o){const a=Math.pow(2,o.z)*ll,h=[o.x*ll,o.y*ll],d=[];if(!n)return d;for(const x of n)for(const w of x){const T=[w.x+h[0],w.y+h[1]];Sh(T,e,i,a),d.push(T)}return d}function Eh(n,e,i,o){const a=Math.pow(2,o.z)*ll,h=[o.x*ll,o.y*ll],d=[];if(!n)return d;for(const w of n){const T=[];for(const I of w){const P=[I.x+h[0],I.y+h[1]];ol(e,P),T.push(P)}d.push(T)}if(e[2]-e[0]<=a/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of d)for(const T of w)Sh(T,e,i,a)}var x;return d}class zs{constructor(e,i){this.type=Sn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Wi(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let a=0;a<o.features.length;++a){const h=o.features[a].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new zs(o,o.features[a].geometry)}else if(o.type==="Feature"){const a=o.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new zs(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new zs(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const a=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(o.type==="Polygon"){const x=Sd(o.coordinates,h,d),w=Ed(i.geometry(),a,h,d);if(!Hl(a,h))return!1;for(const T of w)if(!Dc(T,x))return!1}if(o.type==="MultiPolygon"){const x=Pf(o.coordinates,h,d),w=Ed(i.geometry(),a,h,d);if(!Hl(a,h))return!1;for(const T of w)if(!Am(T,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const a=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(o.type==="Polygon"){const x=Sd(o.coordinates,h,d),w=Eh(i.geometry(),a,h,d);if(!Hl(a,h))return!1;for(const T of w)if(!Yo(T,x))return!1}if(o.type==="MultiPolygon"){const x=Pf(o.coordinates,h,d),w=Eh(i.geometry(),a,h,d);if(!Hl(a,h))return!1;for(const T of w)if(!sa(T,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ch={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Wl=1/298.257223563,Ah=Wl*(2-Wl),Ca=Math.PI/180;class ql{static fromTile(e,i,o){const a=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),h=Math.atan(.5*(Math.exp(a)-Math.exp(-a)))/Ca;return new ql(h,o)}static get units(){return Ch}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Ch[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Ch).join(", ")}`);const o=6378.137*Ca*(i?Ch[i]:1),a=Math.cos(e*Ca),h=1/(1-Ah*(1-a*a)),d=Math.sqrt(h);this.kx=o*d*a,this.ky=o*d*h*(1-Ah)}distance(e,i){const o=Ts(e[0]-i[0])*this.kx,a=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+a*a)}bearing(e,i){const o=Ts(i[0]-e[0])*this.kx;return Math.atan2(o,(i[1]-e[1])*this.ky)/Ca}destination(e,i,o){const a=o*Ca;return this.offset(e,Math.sin(a)*i,Math.cos(a)*i)}offset(e,i,o){return[e[0]+i/this.kx,e[1]+o/this.ky]}lineDistance(e){let i=0;for(let o=0;o<e.length-1;o++)i+=this.distance(e[o],e[o+1]);return i}area(e){let i=0;for(let o=0;o<e.length;o++){const a=e[o];for(let h=0,d=a.length,x=d-1;h<d;x=h++)i+=Ts(a[h][0]-a[x][0])*(a[h][1]+a[x][1])*(o?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let o=0;if(i<=0)return e[0];for(let a=0;a<e.length-1;a++){const h=e[a],d=e[a+1],x=this.distance(h,d);if(o+=x,o>i)return Lc(h,d,(i-(o-x))/x)}return e[e.length-1]}pointToSegmentDistance(e,i,o){let[a,h]=i,d=Ts(o[0]-a)*this.kx,x=(o[1]-h)*this.ky;if(d!==0||x!==0){const w=(Ts(e[0]-a)*this.kx*d+(e[1]-h)*this.ky*x)/(d*d+x*x);w>1?(a=o[0],h=o[1]):w>0&&(a+=d/this.kx*w,h+=x/this.ky*w)}return d=Ts(e[0]-a)*this.kx,x=(e[1]-h)*this.ky,Math.sqrt(d*d+x*x)}pointOnLine(e,i){let o=1/0,a=e[0][0],h=e[0][1],d=0,x=0;for(let w=0;w<e.length-1;w++){let T=e[w][0],I=e[w][1],P=Ts(e[w+1][0]-T)*this.kx,R=(e[w+1][1]-I)*this.ky,F=0;P===0&&R===0||(F=(Ts(i[0]-T)*this.kx*P+(i[1]-I)*this.ky*R)/(P*P+R*R),F>1?(T=e[w+1][0],I=e[w+1][1]):F>0&&(T+=P/this.kx*F,I+=R/this.ky*F)),P=Ts(i[0]-T)*this.kx,R=(i[1]-I)*this.ky;const N=P*P+R*R;N<o&&(o=N,a=T,h=I,d=w,x=F)}return{point:[a,h],index:d,t:Math.max(0,Math.min(1,x))}}lineSlice(e,i,o){let a=this.pointOnLine(o,e),h=this.pointOnLine(o,i);if(a.index>h.index||a.index===h.index&&a.t>h.t){const T=a;a=h,h=T}const d=[a.point],x=a.index+1,w=h.index;!Cd(o[x],d[0])&&x<=w&&d.push(o[x]);for(let T=x+1;T<=w;T++)d.push(o[T]);return Cd(o[w],h.point)||d.push(h.point),d}lineSliceAlong(e,i,o){let a=0;const h=[];for(let d=0;d<o.length-1;d++){const x=o[d],w=o[d+1],T=this.distance(x,w);if(a+=T,a>e&&h.length===0&&h.push(Lc(x,w,(e-(a-T))/T)),a>=i)return h.push(Lc(x,w,(i-(a-T))/T)),h;a>e&&h.push(w)}return h}bufferPoint(e,i){const o=i/this.ky,a=i/this.kx;return[e[0]-a,e[1]-o,e[0]+a,e[1]+o]}bufferBBox(e,i){const o=i/this.ky,a=i/this.kx;return[e[0]-a,e[1]-o,e[2]+a,e[3]+o]}insideBBox(e,i){return Ts(e[0]-i[0])>=0&&Ts(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function Cd(n,e){return n[0]===e[0]&&n[1]===e[1]}function Lc(n,e,i){const o=Ts(e[0]-n[0]);return[n[0]+o*i,n[1]+(e[1]-n[1])*i]}function Ts(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class Cu{constructor(e=[],i=(o,a)=>o<a?-1:o>a?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,a=i[e];for(;e>0;){const h=e-1>>1,d=i[h];if(o(a,d)>=0)break;i[e]=d,e=h}i[e]=a}_down(e){const{data:i,compare:o}=this,a=this.length>>1,h=i[e];for(;e<a;){let d=1+(e<<1);const x=d+1;if(x<this.length&&o(i[x],i[d])<0&&(d=x),o(i[d],h)>=0)break;i[e]=i[d],e=d}i[e]=h}}var Lt=8192;function Au(n,e){return e.dist-n.dist}const zc=100,Fc=50;function Iu(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}function Pu(n){return n[1]-n[0]+1}function oa(n,e){const i=n[1]>=n[0]&&n[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Ih(n,e){if(n[0]>n[1])return[null,null];const i=Pu(n);if(e){if(i===2)return[n,null];const o=Math.floor(i/2);return[[n[0],n[0]+o],[n[0]+o,n[1]]]}{if(i===1)return[n,null];const o=Math.floor(i/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}}function ds(n,e){const i=[1/0,1/0,-1/0,-1/0];if(!oa(e,n.length))return i;for(let o=e[0];o<=e[1];++o)ol(i,n[o]);return i}function en(n){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<n.length;++i)for(let o=0;o<n[i].length;++o)ol(e,n[i][o]);return e}function Zl(n,e,i){if(Iu(n)||Iu(e))return NaN;let o=0,a=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(a=n[1]-e[3]),n[3]<e[1]&&(a=e[1]-n[3]),i.distance([0,0],[o,a])}function Im(n){return 360*n-180}function Pm(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Xl(n,e){const i=Math.pow(2,e.z),o=(n.y/Lt+e.y)/i;return[Im((n.x/Lt+e.x)/i),Pm(o)]}function Mm(n,e){const i=[];for(let o=0;o<n.length;++o)i.push(Xl(n[o],e));return i}function cr(n,e,i){const o=i.pointOnLine(e,n).point;return i.distance(n,o)}function Mf(n,e,i,o,a){const h=i.slice(o[0],o[1]+1);let d=1/0;for(let x=e[0];x<=e[1];++x)if((d=Math.min(d,cr(n[x],h,a)))===0)return 0;return d}function Ir(n,e,i,o,a){const h=Math.min(a.pointToSegmentDistance(n,i,o),a.pointToSegmentDistance(e,i,o)),d=Math.min(a.pointToSegmentDistance(i,n,e),a.pointToSegmentDistance(o,n,e));return Math.min(h,d)}function Rf(n,e,i,o,a){if(!oa(e,n.length)||!oa(o,i.length))return NaN;let h=1/0;for(let d=e[0];d<e[1];++d)for(let x=o[0];x<o[1];++x){if(Th(n[d],n[d+1],i[x],i[x+1]))return 0;h=Math.min(h,Ir(n[d],n[d+1],i[x],i[x+1],a))}return h}function Ad(n,e,i,o,a){if(!oa(e,n.length)||!oa(o,i.length))return NaN;let h=1/0;for(let d=e[0];d<=e[1];++d)for(let x=o[0];x<=o[1];++x)if((h=Math.min(h,a.distance(n[d],i[x])))===0)return h;return h}function Ph(n,e,i){if(Dc(n,e,!0))return 0;let o=1/0;for(const a of e){const h=a.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[h-1]&&(o=Math.min(o,i.pointToSegmentDistance(n,a[h-1],a[0])))===0||(o=Math.min(o,cr(n,a,i)))===0)return o}return o}function Ap(n,e,i,o){if(!oa(e,n.length))return NaN;for(let h=e[0];h<=e[1];++h)if(Dc(n[h],i,!0))return 0;let a=1/0;for(let h=e[0];h<e[1];++h)for(const d of i)for(let x=0,w=d.length,T=w-1;x<w;T=x++){if(Th(n[h],n[h+1],d[T],d[x]))return 0;a=Math.min(a,Ir(n[h],n[h+1],d[T],d[x],o))}return a}function Id(n,e){for(const i of n)for(let o=0;o<=i.length-1;++o)if(Dc(i[o],e,!0))return!0;return!1}function Mh(n,e,i,o=1/0){const a=en(n),h=en(e);if(o!==1/0&&Zl(a,h,i)>=o)return o;if(Hl(a,h)){if(Id(n,e))return 0}else if(Id(e,n))return 0;let d=o;for(const x of n)for(let w=0,T=x.length,I=T-1;w<T;I=w++)for(const P of e)for(let R=0,F=P.length,N=F-1;R<F;N=R++){if(Th(x[I],x[w],P[N],P[R]))return 0;d=Math.min(d,Ir(x[I],x[w],P[N],P[R],i))}return d}function Oc(n,e,i,o,a,h,d){if(h===null||d===null)return;const x=Zl(ds(o,h),ds(a,d),i);x<e&&n.push({dist:x,range1:h,range2:d})}function Mu(n,e,i,o,a=1/0){let h=Math.min(o.distance(n[0],i[0][0]),a);if(h===0)return h;const d=new Cu([{dist:0,range1:[0,n.length-1],range2:[0,0]}],Au),x=e?Fc:zc,w=en(i);for(;d.length;){const T=d.pop();if(T.dist>=h)continue;const I=T.range1;if(Pu(I)<=x){if(!oa(I,n.length))return NaN;if(e){const P=Ap(n,I,i,o);if((h=Math.min(h,P))===0)return h}else for(let P=I[0];P<=I[1];++P){const R=Ph(n[P],i,o);if((h=Math.min(h,R))===0)return h}}else{const P=Ih(I,e);if(P[0]!==null){const R=Zl(ds(n,P[0]),w,o);R<h&&d.push({dist:R,range1:P[0],range2:[0,0]})}if(P[1]!==null){const R=Zl(ds(n,P[1]),w,o);R<h&&d.push({dist:R,range1:P[1],range2:[0,0]})}}}return h}function kf(n,e,i,o,a,h=1/0){let d=Math.min(h,a.distance(n[0],i[0]));if(d===0)return d;const x=new Cu([{dist:0,range1:[0,n.length-1],range2:[0,i.length-1]}],Au),w=e?Fc:zc,T=o?Fc:zc;for(;x.length;){const I=x.pop();if(I.dist>=d)continue;const P=I.range1,R=I.range2;if(Pu(P)<=w&&Pu(R)<=T){if(!oa(P,n.length)||!oa(R,i.length))return NaN;if(e&&o?d=Math.min(d,Rf(n,P,i,R,a)):e||o?e&&!o?d=Math.min(d,Mf(i,R,n,P,a)):!e&&o&&(d=Math.min(d,Mf(n,P,i,R,a))):d=Math.min(d,Ad(n,P,i,R,a)),d===0)return d}else{const F=Ih(P,e),N=Ih(R,o);Oc(x,d,a,n,i,F[0],N[0]),Oc(x,d,a,n,i,F[0],N[1]),Oc(x,d,a,n,i,F[1],N[0]),Oc(x,d,a,n,i,F[1],N[1])}}return d}function Df(n,e,i,o,a=1/0){let h=a;const d=ds(n,[0,n.length-1]);for(const x of i)if(!(h!==1/0&&Zl(d,ds(x,[0,x.length-1]),o)>=h)&&(h=Math.min(h,kf(n,e,x,!0,o,h)),h===0))return h;return h}function Pd(n,e,i,o,a=1/0){let h=a;const d=ds(n,[0,n.length-1]);for(const x of i){if(h!==1/0&&Zl(d,en(x),o)>=h)continue;const w=Mu(n,e,x,o,h);if(isNaN(w))return w;if((h=Math.min(h,w))===0)return h}return h}function Md(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class Aa{constructor(e,i){this.type=oi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Wi(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let a=0;a<o.features.length;++a)if(Md(o.features[a].geometry.type))return new Aa(o,o.features[a].geometry)}else if(o.type==="Feature"){if(Md(o.geometry.type))return new Aa(o,o.geometry)}else if(Md(o.type))return new Aa(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return function(a,h,d){const x=[];for(const T of a)for(const I of T)x.push(Xl(I,h));const w=new ql(x[0][1],"meters");return d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString"?kf(x,!1,d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",w):d.type==="MultiLineString"?Df(x,!1,d.coordinates,w):d.type==="Polygon"||d.type==="MultiPolygon"?Pd(x,!1,d.type==="Polygon"?[d.coordinates]:d.coordinates,w):null}(i,o,this.geometries);if(e.geometryType()==="LineString")return function(a,h,d){const x=[];for(const T of a){const I=[];for(const P of T)I.push(Xl(P,h));x.push(I)}const w=new ql(x[0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return Df(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",x,w);if(d.type==="MultiLineString"){let T=1/0;for(let I=0;I<d.coordinates.length;I++){const P=Df(d.coordinates[I],!0,x,w,T);if(isNaN(P))return P;if((T=Math.min(T,P))===0)return T}return T}if(d.type==="Polygon"||d.type==="MultiPolygon"){let T=1/0;for(let I=0;I<x.length;I++){const P=Pd(x[I],!0,d.type==="Polygon"?[d.coordinates]:d.coordinates,w,T);if(isNaN(P))return P;if((T=Math.min(T,P))===0)return T}return T}return null}(i,o,this.geometries);if(e.geometryType()==="Polygon")return function(a,h,d){const x=[];for(const T of function(I,P){const R=I.length;if(R<=1)return[I];const F=[];let N,H;for(let Z=0;Z<R;Z++){const ee=Em(I[Z]);ee!==0&&(I[Z].area=Math.abs(ee),H===void 0&&(H=ee<0),H===ee<0?(N&&F.push(N),N=[I[Z]]):N.push(I[Z]))}return N&&F.push(N),F}(a)){const I=[];for(let P=0;P<T.length;++P)I.push(Mm(T[P],h));x.push(I)}const w=new ql(x[0][0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return Pd(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",x,w);if(d.type==="MultiLineString"){let T=1/0;for(let I=0;I<d.coordinates.length;I++){const P=Pd(d.coordinates[I],!0,x,w,T);if(isNaN(P))return P;if((T=Math.min(T,P))===0)return T}return T}return d.type==="Polygon"||d.type==="MultiPolygon"?function(T,I,P){let R=1/0;for(const F of T)for(const N of I){const H=Mh(F,N,P,R);if(isNaN(H))return H;if((R=Math.min(R,H))===0)return R}return R}(d.type==="Polygon"?[d.coordinates]:d.coordinates,x,w):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function cl(n){if(n instanceof qr&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof zs||n instanceof Aa)return!1;if(n instanceof Du)return n.featureConstant;let e=!0;return n.eachChild(i=>{e&&!cl(i)&&(e=!1)}),e}function Ru(n){if(n instanceof qr&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!Ru(i)&&(e=!1)}),e}function ku(n){if(n instanceof Du)return new Set([n.key]);let e=new Set;return n.eachChild(i=>{e=new Set([...e,...ku(i)])}),e}function Yl(n,e){if(n instanceof qr&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(o=>{i&&!Yl(o,e)&&(i=!1)}),i}function Rd(n,e,i){return[n,e,i].filter(Boolean).join("")}function Lf(n,e){switch(n){case"string":return yo(e);case"number":return+e;case"boolean":return!!e;case"color":return mn.parse(e);case"formatted":return $s.fromString(yo(e));case"resolvedImage":return no.build(yo(e))}return e}function zf(n,e,i,o){return o!==void 0&&(n=o*Math.round(n/o)),e!==void 0&&n<e&&(n=e),i!==void 0&&n>i&&(n=i),n}class Du{constructor(e,i,o,a=!1){this.type=e,this.key=i,this.scope=o,this.featureConstant=a}static parse(e,i){let o=i.expectedType;if(o==null&&(o=In),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const a=i.parse(e[1],1);if(!(a instanceof vi))return i.error("Key name of 'config' expression must be a string literal.");let h,d=!0;const x=yo(a.value);if(e.length>=3){const w=i.parse(e[2],2);if(!(w instanceof vi))return i.error("Scope of 'config' expression must be a string literal.");h=yo(w.value)}if(i.options){const w=Rd(x,h,i._scope),T=i.options.get(w);T&&(d=cl(T.value||T.default))}return new Du(o,x,h,d)}evaluate(e){const i=Rd(this.key,this.scope,e.scope),o=e.getConfig(i);if(!o)return null;const{type:a,value:h,values:d,minValue:x,maxValue:w,stepValue:T}=o,I=o.default.evaluate(e);let P=I;if(h){const R=e.scope;e.scope=(R||"").split("").slice(1).join(""),P=h.evaluate(e),e.scope=R}return a&&(P=Lf(a,P)),P===void 0||x===void 0&&w===void 0&&T===void 0||(typeof P=="number"?P=zf(P,x,w,T):Array.isArray(P)&&(P=P.map(R=>typeof R=="number"?zf(R,x,w,T):R))),h!==void 0&&P!==void 0&&d&&!d.includes(P)&&(P=I,a&&(P=Lf(a,P))),(a&&a!==this.type||P!==void 0&&!vd(Xt(P),this.type))&&(P=Lf(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class kd{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new kd(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Lu{constructor(e,i=[],o,a=new Cf,h=[],d,x){this.registry=e,this.path=i,this.key=i.map(w=>typeof w=="string"?`['${w}']`:`[${w}]`).join(""),this.scope=a,this.errors=h,this.expectedType=o,this._scope=d,this.options=x}parse(e,i,o,a,h={}){return i||o?this.concat(i,null,o,a)._parse(e,h):this._parse(e,h)}parseObjectValue(e,i,o,a,h,d={}){return this.concat(i,o,a,h)._parse(e,d)}_parse(e,i){function o(a,h,d){return d==="assert"?new mi(h,[a]):d==="coerce"?new Xo(h,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(a){let h=a.parse(e,this);if(!h)return null;if(this.expectedType){const d=this.expectedType,x=h.type;if(d.kind!=="string"&&d.kind!=="number"&&d.kind!=="boolean"&&d.kind!=="object"&&d.kind!=="array"||x.kind!=="value")if(d.kind!=="color"&&d.kind!=="formatted"&&d.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(d,x))return null}else h=o(h,d,i.typeAnnotation||"coerce");else h=o(h,d,i.typeAnnotation||"assert")}if(!(h instanceof vi)&&h.type.kind!=="resolvedImage"&&Ia(h)){const d=new wh(this._scope,this.options);try{h=new vi(h.type,h.evaluate(d))}catch(x){return this.error(x.message),null}}return h}return Xo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o,a){let h=typeof e=="number"?this.path.concat(e):this.path;h=typeof i=="string"?h.concat(i):h;const d=a?this.scope.concat(a):this.scope;return new Lu(this.registry,h,o||null,d,this.errors,this._scope,this.options)}error(e,...i){const o=`${this.key}${i.map(a=>`[${a}]`).join("")}`;this.errors.push(new go(o,e))}checkSubtype(e,i){const o=Gl(e,i);return o&&this.error(o),o}}function Ia(n){if(n instanceof kd)return Ia(n.boundExpression);if(n instanceof qr&&n.name==="error"||n instanceof xo||n instanceof zs||n instanceof Aa||n instanceof Du)return!1;const e=n instanceof Xo||n instanceof mi;let i=!0;return n.eachChild(o=>{i=e?i&&Ia(o):i&&o instanceof vi}),!!i&&cl(n)&&Yl(n,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Rh(n,e){const i=n.length-1;let o,a,h=0,d=i,x=0;for(;h<=d;)if(x=Math.floor((h+d)/2),o=n[x],a=n[x+1],o<=e){if(x===i||e<a)return x;h=x+1}else{if(!(o>e))throw new kr("Input is not a number.");d=x-1}return 0}class Pa{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[a,h]of o)this.labels.push(a),this.outputs.push(h)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,oi);if(!o)return null;const a=[];let h=null;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);for(let d=1;d<e.length;d+=2){const x=d===1?-1/0:e[d],w=e[d+1],T=d,I=d+1;if(typeof x!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(a.length&&a[a.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const P=i.parse(w,I,h);if(!P)return null;h=h||P.type,a.push([x,P])}return new Pa(h,o,a)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return o[0].evaluate(e);const h=i.length;return a>=i[h-1]?o[h-1].evaluate(e):o[Rh(i,a)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const aa=.95047,zu=1.08883,Ma=4/29,Ra=6/29,Ip=3*Ra*Ra,Pp=Ra*Ra*Ra,Nc=Math.PI/180,kh=180/Math.PI;function Kl(n){return n>Pp?Math.pow(n,1/3):n/Ip+Ma}function Bc(n){return n>Ra?n*n*n:Ip*(n-Ma)}function Fu(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Fo(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function ka(n){const e=Fo(n.r),i=Fo(n.g),o=Fo(n.b),a=Kl((.4124564*e+.3575761*i+.1804375*o)/aa),h=Kl((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*h-16,a:500*(a-h),b:200*(h-Kl((.0193339*e+.119192*i+.9503041*o)/zu)),alpha:n.a}}function Pr(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,o=isNaN(n.b)?e:e-n.b/200;return e=1*Bc(e),i=aa*Bc(i),o=zu*Bc(o),new mn(Fu(3.2404542*i-1.5371385*e-.4985314*o),Fu(-.969266*i+1.8760108*e+.041556*o),Fu(.0556434*i-.2040259*e+1.0572252*o),n.alpha)}function Mr(n,e,i){const o=e-n;return n+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const vo={forward:ka,reverse:Pr,interpolate:function(n,e,i){return{l:gi(n.l,e.l,i),a:gi(n.a,e.a,i),b:gi(n.b,e.b,i),alpha:gi(n.alpha,e.alpha,i)}}},Vr={forward:function(n){const{l:e,a:i,b:o}=ka(n),a=Math.atan2(o,i)*kh;return{h:a<0?a+360:a,c:Math.sqrt(i*i+o*o),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Nc,i=n.c;return Pr({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:Mr(n.h,e.h,i),c:gi(n.c,e.c,i),l:gi(n.l,e.l,i),alpha:gi(n.alpha,e.alpha,i)}}};var ro=Object.freeze({__proto__:null,hcl:Vr,lab:vo});class fs{constructor(e,i,o,a,h){this.type=e,this.operator=i,this.interpolation=o,this.input=a,this.labels=[],this.outputs=[];for(const[d,x]of h)this.labels.push(d),this.outputs.push(x)}static interpolationFactor(e,i,o,a){let h=0;if(e.name==="exponential")h=ul(i,e.base,o,a);else if(e.name==="linear")h=ul(i,1,o,a);else if(e.name==="cubic-bezier"){const d=e.controlPoints;h=new hh(d[0],d[1],d[2],d[3]).solve(ul(i,1,o,a))}return h}static parse(e,i){let[o,a,h,...d]=e;if(!Array.isArray(a)||a.length===0)return i.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const T=a[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:T}}else{if(a[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const T=a.slice(1);if(T.length!==4||T.some(I=>typeof I!="number"||I<0||I>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(h=i.parse(h,2,oi),!h)return null;const x=[];let w=null;o==="interpolate-hcl"||o==="interpolate-lab"?w=_o:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType);for(let T=0;T<d.length;T+=2){const I=d[T],P=d[T+1],R=T+3,F=T+4;if(typeof I!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(x.length&&x[x.length-1][0]>=I)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const N=i.parse(P,F,w);if(!N)return null;w=w||N.type,x.push([I,N])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new fs(w,o,a,h,x):i.error(`Type ${zr(w)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return o[0].evaluate(e);const h=i.length;if(a>=i[h-1])return o[h-1].evaluate(e);const d=Rh(i,a),x=fs.interpolationFactor(this.interpolation,a,i[d],i[d+1]),w=o[d].evaluate(e),T=o[d+1].evaluate(e);return this.operator==="interpolate"?il[this.type.kind.toLowerCase()](w,T,x):this.operator==="interpolate-hcl"?Vr.reverse(Vr.interpolate(Vr.forward(w),Vr.forward(T),x)):vo.reverse(vo.interpolate(vo.forward(w),vo.forward(T),x))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function ul(n,e,i,o){const a=o-i,h=n-i;return a===0?0:e===1?h/a:(Math.pow(e,h)-1)/(Math.pow(e,a)-1)}class Ss{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const a=i.expectedType;a&&a.kind!=="value"&&(o=a);const h=[];for(const x of e.slice(1)){const w=i.parse(x,1+h.length,o,void 0,{typeAnnotation:"omit"});if(!w)return null;o=o||w.type,h.push(w)}const d=a&&h.some(x=>Gl(a,x.type));return new Ss(d?In:o,h)}evaluate(e){let i,o=null,a=0;for(const h of this.args){if(a++,o=h.evaluate(e),o&&o instanceof no&&!o.available&&(i||(i=o),o=null,a===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class jc{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let h=1;h<e.length-1;h+=2){const d=e[h];if(typeof d!="string")return i.error(`Expected string, but found ${typeof d} instead.`,h);if(/[^a-zA-Z0-9_]/.test(d))return i.error("Variable names must contain only alphanumeric characters or '_'.",h);const x=i.parse(e[h+1],h+1);if(!x)return null;o.push([d,x])}const a=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return a?new jc(o,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class Dd{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,oi),a=i.parse(e[2],2,Gs(i.expectedType||In));return o&&a?new Dd(a.type.itemType,o,a):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new kr(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new kr(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new kr(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ld{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,oi),a=i.parse(e[2],2,Gs(i.expectedType||In));return o&&a?new Ld(a.type.itemType,o,a):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new kr(`Array index out of bounds: ${i} < 0.`);if(i>o.length-1)throw new kr(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i===Math.floor(i))return o[i];const a=Math.floor(i),h=Math.ceil(i),d=o[a],x=o[h];if(typeof d!="number"||typeof x!="number")throw new kr(`Cannot interpolate between non-number values at index ${i}.`);const w=i-a;return d*(1-w)+x*w}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Vc{constructor(e,i){this.type=Sn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,In),a=i.parse(e[2],2,In);return o&&a?$l(o.type,[Sn,An,oi,bu,In])?new Vc(o,a):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${zr(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!vh(i,["boolean","string","number","null"]))throw new kr(`Expected first argument to be of type boolean, string, number or null, but found ${zr(Xt(i))} instead.`);if(!vh(o,["string","array"]))throw new kr(`Expected second argument to be of type array or string, but found ${zr(Xt(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ou{constructor(e,i,o){this.type=oi,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,In),a=i.parse(e[2],2,In);if(!o||!a)return null;if(!$l(o.type,[Sn,An,oi,bu,In]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${zr(o.type)} instead`);if(e.length===4){const h=i.parse(e[3],3,oi);return h?new Ou(o,a,h):null}return new Ou(o,a)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!vh(i,["boolean","string","number","null"]))throw new kr(`Expected first argument to be of type boolean, string, number or null, but found ${zr(Xt(i))} instead.`);if(!vh(o,["string","array"]))throw new kr(`Expected second argument to be of type array or string, but found ${zr(Xt(o))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return o.indexOf(i,a)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class wo{constructor(e,i,o,a,h,d){this.inputType=e,this.type=i,this.input=o,this.cases=a,this.outputs=h,this.otherwise=d}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const h={},d=[];for(let T=2;T<e.length-1;T+=2){let I=e[T];const P=e[T+1];Array.isArray(I)||(I=[I]);const R=i.concat(T);if(I.length===0)return R.error("Expected at least one branch label.");for(const N of I){if(typeof N!="number"&&typeof N!="string")return R.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return R.error("Numeric branch labels must be integer values.");if(o){if(R.checkSubtype(o,Xt(N)))return null}else o=Xt(N);if(h[String(N)]!==void 0)return R.error("Branch labels must be unique.");h[String(N)]=d.length}const F=i.parse(P,T,a);if(!F)return null;a=a||F.type,d.push(F)}const x=i.parse(e[1],1,In);if(!x)return null;const w=i.parse(e[e.length-1],e.length-1,a);return w?x.type.kind!=="value"&&i.concat(1).checkSubtype(o,x.type)?null:new wo(o,a,x,h,d,w):null}evaluate(e){const i=this.input.evaluate(e);return(vd(Xt(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],a={};for(const d of i){const x=a[this.cases[d]];x===void 0?(a[this.cases[d]]=o.length,o.push([this.cases[d],[d]])):o[x][1].push(d)}const h=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,x]of o)e.push(x.length===1?h(x[0]):x.map(h)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}class Nu{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const a=[];for(let d=1;d<e.length-1;d+=2){const x=i.parse(e[d],d,Sn);if(!x)return null;const w=i.parse(e[d+1],d+1,o);if(!w)return null;a.push([x,w]),o=o||w.type}const h=i.parse(e[e.length-1],e.length-1,o);return h?new Nu(o,a,h):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Uc{constructor(e,i,o,a){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,In),a=i.parse(e[2],2,oi);if(!o||!a)return null;if(!$l(o.type,[Gs(In),An,In]))return i.error(`Expected first argument to be of type array or string, but found ${zr(o.type)} instead`);if(e.length===4){const h=i.parse(e[3],3,oi);return h?new Uc(o.type,o,a,h):null}return new Uc(o.type,o,a)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!vh(i,["string","array"]))throw new kr(`Expected first argument to be of type array or string, but found ${zr(Xt(i))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return i.slice(o,a)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Ff(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Mp(n,e,i,o){return o.compare(e,i)===0}function bo(n,e,i){const o=n!=="=="&&n!=="!=";return class t4{constructor(h,d,x){this.type=Sn,this.lhs=h,this.rhs=d,this.collator=x,this.hasUntypedArgument=h.type.kind==="value"||d.type.kind==="value"}static parse(h,d){if(h.length!==3&&h.length!==4)return d.error("Expected two or three arguments.");const x=h[0];let w=d.parse(h[1],1,In);if(!w)return null;if(!Ff(x,w.type))return d.concat(1).error(`"${x}" comparisons are not supported for type '${zr(w.type)}'.`);let T=d.parse(h[2],2,In);if(!T)return null;if(!Ff(x,T.type))return d.concat(2).error(`"${x}" comparisons are not supported for type '${zr(T.type)}'.`);if(w.type.kind!==T.type.kind&&w.type.kind!=="value"&&T.type.kind!=="value")return d.error(`Cannot compare types '${zr(w.type)}' and '${zr(T.type)}'.`);o&&(w.type.kind==="value"&&T.type.kind!=="value"?w=new mi(T.type,[w]):w.type.kind!=="value"&&T.type.kind==="value"&&(T=new mi(w.type,[T])));let I=null;if(h.length===4){if(w.type.kind!=="string"&&T.type.kind!=="string"&&w.type.kind!=="value"&&T.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(I=d.parse(h[3],3,xd),!I)return null}return new t4(w,T,I)}evaluate(h){const d=this.lhs.evaluate(h),x=this.rhs.evaluate(h);if(o&&this.hasUntypedArgument){const w=Xt(d),T=Xt(x);if(w.kind!==T.kind||w.kind!=="string"&&w.kind!=="number")throw new kr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${w.kind}, ${T.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const w=Xt(d),T=Xt(x);if(w.kind!=="string"||T.kind!=="string")return e(h,d,x)}return this.collator?i(h,d,x,this.collator.evaluate(h)):e(h,d,x)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){const h=[n];return this.eachChild(d=>{h.push(d.serialize())}),h}}}const Gc=bo("==",function(n,e,i){return e===i},Mp),Bu=bo("!=",function(n,e,i){return e!==i},function(n,e,i,o){return!Mp(0,e,i,o)}),zd=bo("<",function(n,e,i){return e<i},function(n,e,i,o){return o.compare(e,i)<0}),Fd=bo(">",function(n,e,i){return e>i},function(n,e,i,o){return o.compare(e,i)>0}),so=bo("<=",function(n,e,i){return e<=i},function(n,e,i,o){return o.compare(e,i)<=0}),Ko=bo(">=",function(n,e,i){return e>=i},function(n,e,i,o){return o.compare(e,i)>=0});class Da{constructor(e,i,o,a,h,d){this.type=An,this.number=e,this.locale=i,this.currency=o,this.unit=a,this.minFractionDigits=h,this.maxFractionDigits=d}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,oi);if(!o)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return i.error("NumberFormat options argument must be an object.");let h=null;if(a.locale&&(h=i.parseObjectValue(a.locale,2,"locale",An),!h))return null;let d=null;if(a.currency&&(d=i.parseObjectValue(a.currency,2,"currency",An),!d))return null;let x=null;if(a.unit&&(x=i.parseObjectValue(a.unit,2,"unit",An),!x))return null;let w=null;if(a["min-fraction-digits"]&&(w=i.parseObjectValue(a["min-fraction-digits"],2,"min-fraction-digits",oi),!w))return null;let T=null;return a["max-fraction-digits"]&&(T=i.parseObjectValue(a["max-fraction-digits"],2,"max-fraction-digits",oi),!T)?null:new Da(o,h,d,x,w,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class la{constructor(e){this.type=oi,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${zr(o.type)} instead.`):new la(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new kr(`Expected value to be of type string or array, but found ${zr(Xt(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function La(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Oo={"==":Gc,"!=":Bu,">":Fd,"<":zd,">=":Ko,"<=":so,array:mi,at:Dd,"at-interpolated":Ld,boolean:mi,case:Nu,coalesce:Ss,collator:xo,format:Mc,image:Rc,in:Vc,"index-of":Ou,interpolate:fs,"interpolate-hcl":fs,"interpolate-lab":fs,length:la,let:jc,literal:vi,match:wo,number:mi,"number-format":Da,object:mi,slice:Uc,step:Pa,string:mi,"to-boolean":Xo,"to-color":Xo,"to-number":Xo,"to-string":Xo,var:kd,within:zs,distance:Aa,config:Du};function Od(n,[e,i,o,a]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const h=a?a.evaluate(n):1,d=Pc(e,i,o,h);if(d)throw new kr(d);return new mn(e/255,i/255,o/255,h)}function Dh(n,[e,i,o,a]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const h=a?a.evaluate(n):1,d=function(T,I,P,R){return typeof T=="number"&&T>=0&&T<=360?typeof I=="number"&&I>=0&&I<=100&&typeof P=="number"&&P>=0&&P<=100?R===void 0||typeof R=="number"&&R>=0&&R<=1?null:`Invalid hsla value [${[T,I,P,R].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof R=="number"?[T,I,P,R]:[T,I,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof R=="number"?[T,I,P,R]:[T,I,P]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,o,h);if(d)throw new kr(d);const x=`hsla(${e}, ${i}%, ${o}%, ${h})`,w=mn.parse(x);if(!w)throw new kr(`Failed to parse HSLA color: ${x}`);return w}function Nd(n,e){return n in e}function Qr(n,e){const i=e[n];return i===void 0?null:i}function ps(n){return{type:n}}function Dr(n){return{result:"success",value:n}}function Es(n){return{result:"error",value:n}}function Lh(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function ju(n){return n["property-type"]==="data-driven"}function zh(n){return Lh(n.expression,"measure-light")}function Fh(n){return Lh(n.expression,"zoom")}function Vu(n){return!!n.expression&&n.expression.interpolated}function Jl(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Of(n){return n}function $c(n,e){const i=e.type==="color",o=n.stops&&typeof n.stops[0][0]=="object",a=o||!(o||n.property!==void 0),h=n.type||(Vu(e)?"exponential":"interval");if(i&&((n=Ea({},n)).stops&&(n.stops=n.stops.map(T=>[T[0],mn.parse(T[1])])),n.default=mn.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!ro[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let d,x,w;if(h==="exponential")d=Uu;else if(h==="interval")d=Oh;else if(h==="categorical"){d=Rm,x=Object.create(null);for(const T of n.stops)x[T[0]]=T[1];w=typeof n.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);d=Rp}if(o){const T={},I=[];for(let F=0;F<n.stops.length;F++){const N=n.stops[F],H=N[0].zoom;T[H]===void 0&&(T[H]={zoom:H,type:n.type,property:n.property,default:n.default,stops:[]},I.push(H)),T[H].stops.push([N[0].value,N[1]])}const P=[];for(const F of I)P.push([T[F].zoom,$c(T[F],e)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:fs.interpolationFactor.bind(void 0,R),zoomStops:P.map(F=>F[0]),evaluate:({zoom:F},N)=>Uu({stops:P,base:n.base},e,F).evaluate(F,N)}}if(a){const T=h==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:fs.interpolationFactor.bind(void 0,T),zoomStops:n.stops.map(I=>I[0]),evaluate:({zoom:I})=>d(n,e,I,x,w)}}return{kind:"source",evaluate(T,I){const P=I&&I.properties?I.properties[n.property]:void 0;return P===void 0?To(n.default,e.default):d(n,e,P,x,w)}}}function To(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function Rm(n,e,i,o,a){return To(typeof i===a?o[i]:void 0,n.default,e.default)}function Oh(n,e,i){if(sl(i)!=="number")return To(n.default,e.default);const o=n.stops.length;if(o===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[o-1][0])return n.stops[o-1][1];const a=Rh(n.stops.map(h=>h[0]),i);return n.stops[a][1]}function Uu(n,e,i){const o=n.base!==void 0?n.base:1;if(sl(i)!=="number")return To(n.default,e.default);const a=n.stops.length;if(a===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];const h=Rh(n.stops.map(I=>I[0]),i),d=function(I,P,R,F){const N=F-R,H=I-R;return N===0?0:P===1?H/N:(Math.pow(P,H)-1)/(Math.pow(P,N)-1)}(i,o,n.stops[h][0],n.stops[h+1][0]),x=n.stops[h][1],w=n.stops[h+1][1];let T=il[e.type]||Of;if(n.colorSpace&&n.colorSpace!=="rgb"){const I=ro[n.colorSpace];T=(P,R)=>I.reverse(I.interpolate(I.forward(P),I.forward(R),d))}return typeof x.evaluate=="function"?{evaluate(...I){const P=x.evaluate.apply(void 0,I),R=w.evaluate.apply(void 0,I);if(P!==void 0&&R!==void 0)return T(P,R,d)}}:T(x,w,d)}function Rp(n,e,i){return e.type==="color"?i=mn.parse(i):e.type==="formatted"?i=$s.fromString(i.toString()):e.type==="resolvedImage"?i=no.build(i.toString()):sl(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),To(i,n.default,e.default)}qr.register(Oo,{error:[{kind:"error"},[An],(n,[e])=>{throw new kr(e.evaluate(n))}],typeof:[An,[In],(n,[e])=>zr(Xt(e.evaluate(n)))],"to-rgba":[Gs(oi,4),[_o],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Gs(oi,4),[_o],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[_o,[oi,oi,oi],Od],rgba:[_o,[oi,oi,oi,oi],Od],hsl:[_o,[oi,oi,oi],Dh],hsla:[_o,[oi,oi,oi,oi],Dh],has:{type:Sn,overloads:[[[An],(n,[e])=>Nd(e.evaluate(n),n.properties())],[[An,nl],(n,[e,i])=>Nd(e.evaluate(n),i.evaluate(n))]]},get:{type:In,overloads:[[[An],(n,[e])=>Qr(e.evaluate(n),n.properties())],[[An,nl],(n,[e,i])=>Qr(e.evaluate(n),i.evaluate(n))]]},"feature-state":[In,[An],(n,[e])=>Qr(e.evaluate(n),n.featureState||{})],properties:[nl,[],n=>n.properties()],"geometry-type":[An,[],n=>n.geometryType()],worldview:[An,[],n=>n.globals.worldview||""],id:[In,[],n=>n.id()],zoom:[oi,[],n=>n.globals.zoom],pitch:[oi,[],n=>n.globals.pitch||0],"distance-from-center":[oi,[],n=>n.distanceFromCenter()],"measure-light":[oi,[An],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[oi,[],n=>n.globals.heatmapDensity||0],"line-progress":[oi,[],n=>n.globals.lineProgress||0],"raster-value":[oi,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[oi,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[oi,[],n=>n.globals.skyRadialProgress||0],accumulated:[In,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[oi,ps(oi),(n,e)=>{let i=0;for(const o of e)i+=o.evaluate(n);return i}],"*":[oi,ps(oi),(n,e)=>{let i=1;for(const o of e)i*=o.evaluate(n);return i}],"-":{type:oi,overloads:[[[oi,oi],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[oi],(n,[e])=>-e.evaluate(n)]]},"/":[oi,[oi,oi],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[oi,[oi,oi],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[oi,[],()=>Math.LN2],pi:[oi,[],()=>Math.PI],e:[oi,[],()=>Math.E],"^":[oi,[oi,oi],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[oi,[oi],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[oi,[oi],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[oi,[oi],(n,[e])=>Math.log(e.evaluate(n))],log2:[oi,[oi],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[oi,[oi],(n,[e])=>Math.sin(e.evaluate(n))],cos:[oi,[oi],(n,[e])=>Math.cos(e.evaluate(n))],tan:[oi,[oi],(n,[e])=>Math.tan(e.evaluate(n))],asin:[oi,[oi],(n,[e])=>Math.asin(e.evaluate(n))],acos:[oi,[oi],(n,[e])=>Math.acos(e.evaluate(n))],atan:[oi,[oi],(n,[e])=>Math.atan(e.evaluate(n))],min:[oi,ps(oi),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[oi,ps(oi),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[oi,[oi],(n,[e])=>Math.abs(e.evaluate(n))],round:[oi,[oi],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[oi,[oi],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[oi,[oi],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Sn,[An,In],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Sn,[In],(n,[e])=>n.id()===e.value],"filter-type-==":[Sn,[An],(n,[e])=>n.geometryType()===e.value],"filter-<":[Sn,[An,In],(n,[e,i])=>{const o=n.properties()[e.value],a=i.value;return typeof o==typeof a&&o<a}],"filter-id-<":[Sn,[In],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Sn,[An,In],(n,[e,i])=>{const o=n.properties()[e.value],a=i.value;return typeof o==typeof a&&o>a}],"filter-id->":[Sn,[In],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Sn,[An,In],(n,[e,i])=>{const o=n.properties()[e.value],a=i.value;return typeof o==typeof a&&o<=a}],"filter-id-<=":[Sn,[In],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Sn,[An,In],(n,[e,i])=>{const o=n.properties()[e.value],a=i.value;return typeof o==typeof a&&o>=a}],"filter-id->=":[Sn,[In],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Sn,[In],(n,[e])=>e.value in n.properties()],"filter-has-id":[Sn,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Sn,[Gs(An)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Sn,[Gs(In)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Sn,[An,Gs(In)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Sn,[An,Gs(In)],(n,[e,i])=>function(o,a,h,d){for(;h<=d;){const x=h+d>>1;if(a[x]===o)return!0;a[x]>o?d=x-1:h=x+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Sn,overloads:[[[Sn,Sn],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[ps(Sn),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Sn,overloads:[[[Sn,Sn],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[ps(Sn),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Sn,[Sn],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Sn,[An],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[An,[An],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[An,[An],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[An,ps(In),(n,e)=>e.map(i=>yo(i.evaluate(n))).join("")],"resolved-locale":[An,[xd],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[oi,[oi,oi,In],(n,e)=>{const[i,o,a]=e.map(d=>d.evaluate(n));if(i>o||i===o)return i;let h;if(typeof a=="string")h=function(d){let x=0;if(d.length===0)return x;for(let w=0;w<d.length;w++)x=(x<<5)-x+d.charCodeAt(w),x|=0;return x}(a);else{if(typeof a!="number")throw new kr(`Invalid seed input: ${a}`);h=a}return i+La(h)()*(o-i)}]});class Hc{constructor(e,i,o,a){this.expression=e,this._warningHistory={},this._evaluator=new wh(o,a),this._defaultValue=i?function(h){return h.type==="color"&&(Jl(h.default)||Array.isArray(h.default))?new mn(0,0,0,0):h.type==="color"?mn.parse(h.default)||null:h.default===void 0?null:h.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=ku(e)}evaluateWithoutErrorHandling(e,i,o,a,h,d,x,w){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=a||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,a,h,d,x,w){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new kr(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${T.message}`)),this._defaultValue}}}function hl(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Oo}function za(n,e,i,o){const a=new Lu(Oo,[],e?function(d){const x={color:_o,string:An,number:oi,enum:An,boolean:Sn,formatted:Tu,resolvedImage:xh};return d.type==="array"?Gs(x[d.value]||In,d.length):x[d.type]}(e):void 0,void 0,void 0,i,o),h=a.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Dr(new Hc(h,e,i,o)):Es(a.errors)}class Ql{constructor(e,i,o,a){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isLineProgressConstant=a,this.isStateDependent=e!=="constant"&&!Ru(i.expression),this.configDependencies=ku(i.expression)}evaluateWithoutErrorHandling(e,i,o,a,h,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,a,h,d)}evaluate(e,i,o,a,h,d){return this._styleExpression.evaluate(e,i,o,a,h,d)}}class ec{constructor(e,i,o,a,h,d){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Ru(i.expression),this.isLightConstant=h,this.isLineProgressConstant=d,this.configDependencies=ku(i.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,i,o,a,h,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,a,h,d)}evaluate(e,i,o,a,h,d){return this._styleExpression.evaluate(e,i,o,a,h,d)}interpolationFactor(e,i,o){return this.interpolationType?fs.interpolationFactor(this.interpolationType,e,i,o):0}}function Wc(n,e,i,o){if((n=za(n,e,i,o)).result==="error")return n;const a=n.value.expression,h=cl(a);if(!h&&!ju(e))return Es([new go("","data expressions not supported")]);const d=Yl(a,["zoom","pitch","distance-from-center"]);if(!d&&!Fh(e))return Es([new go("","zoom expressions not supported")]);const x=Yl(a,["measure-light"]);if(!x&&!zh(e))return Es([new go("","measure-light expression not supported")]);const w=Yl(a,["line-progress"]);if(!w&&!function(P){return Lh(P.expression,"line-progress")}(e))return Es([new go("","line-progress expression not supported")]);const T=e.expression&&e.expression.relaxZoomRestriction,I=ic(a);return I||d||T?I instanceof go?Es([I]):I instanceof fs&&!Vu(e)?Es([new go("",'"interpolate" expressions cannot be used with this property')]):Dr(I?new ec(h&&w?"camera":"composite",n.value,I.labels,I instanceof fs?I.interpolation:void 0,x,w):new Ql(h&&w?"constant":"source",n.value,x,w)):Es([new go("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class tc{constructor(e,i){this._parameters=e,this._specification=i,Ea(this,$c(this._parameters,this._specification))}static deserialize(e){return new tc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ic(n){let e=null;if(n instanceof jc)e=ic(n.result);else if(n instanceof Ss){for(const i of n.args)if(e=ic(i),e)break}else(n instanceof Pa||n instanceof fs)&&n.input instanceof qr&&n.input.name==="zoom"&&(e=n);return e instanceof go||n.eachChild(i=>{const o=ic(i);o instanceof go?e=o:e&&o&&e!==o&&(e=new go("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Gu,Nh,nc=function(){if(Nh)return Gu;Nh=1,Gu=e;var n=3;function e(i,o,a){var h=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var d=new Int32Array(this.arrayBuffer);i=d[0],this.d=(o=d[1])+2*(a=d[2]);for(var x=0;x<this.d*this.d;x++){var w=d[n+x],T=d[n+x+1];h.push(w===T?null:d.subarray(w,T))}var I=d[n+h.length+1];this.keys=d.subarray(d[n+h.length],I),this.bboxes=d.subarray(I),this.insert=this._insertReadonly}else{this.d=o+2*a;for(var P=0;P<this.d*this.d;P++)h.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=i,this.padding=a,this.scale=o/i,this.uid=0;var R=a/o*i;this.min=-R,this.max=i+R}return e.prototype.insert=function(i,o,a,h,d){this._forEachCell(o,a,h,d,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(o),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(d)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,o,a,h,d,x){this.cells[d].push(x)},e.prototype.query=function(i,o,a,h,d){var x=this.min,w=this.max;if(i<=x&&o<=x&&w<=a&&w<=h&&!d)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(i,o,a,h,this._queryCell,T,{},d),T},e.prototype._queryCell=function(i,o,a,h,d,x,w,T){var I=this.cells[d];if(I!==null)for(var P=this.keys,R=this.bboxes,F=0;F<I.length;F++){var N=I[F];if(w[N]===void 0){var H=4*N;(T?T(R[H+0],R[H+1],R[H+2],R[H+3]):i<=R[H+2]&&o<=R[H+3]&&a>=R[H+0]&&h>=R[H+1])?(w[N]=!0,x.push(P[N])):w[N]=!1}}},e.prototype._forEachCell=function(i,o,a,h,d,x,w,T){for(var I=this._convertToCellCoord(i),P=this._convertToCellCoord(o),R=this._convertToCellCoord(a),F=this._convertToCellCoord(h),N=I;N<=R;N++)for(var H=P;H<=F;H++){var Z=this.d*H+N;if((!T||T(this._convertFromCellCoord(N),this._convertFromCellCoord(H),this._convertFromCellCoord(N+1),this._convertFromCellCoord(H+1)))&&d.call(this,i,o,a,h,Z,x,w,T))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,o=n+this.cells.length+1+1,a=0,h=0;h<this.cells.length;h++)a+=this.cells[h].length;var d=new Int32Array(o+a+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var x=o,w=0;w<i.length;w++){var T=i[w];d[n+w]=x,d.set(T,x),x+=T.length}return d[n+i.length]=x,d.set(this.keys,x),d[n+i.length+1]=x+=this.keys.length,d.set(this.bboxes,x),x+=this.bboxes.length,d.buffer},Gu}(),es=ba(nc);const oo={};function qt(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),oo[e]={klass:n,omit:i.omit||[]}}qt(Object,"Object"),es.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.add(i),{buffer:i}},es.deserialize=function(n){return new es(n.buffer)},Object.defineProperty(es,"name",{value:"Grid"}),qt(es,"Grid"),typeof DOMMatrix<"u"&&qt(DOMMatrix,"DOMMatrix"),qt(mn,"Color"),qt(Error,"Error"),qt($s,"Formatted"),qt(wd,"FormattedSection"),qt(pn,"AJAXError"),qt(no,"ResolvedImage"),qt(tc,"StylePropertyFunction"),qt(Hc,"StyleExpression",{omit:["_evaluator"]}),qt(Ls,"ImageId"),qt(rl,"ImageVariant"),qt(ec,"ZoomDependentExpression"),qt(Ql,"ZoomConstantExpression"),qt(qr,"CompoundExpression",{omit:["_evaluate"]});for(const n in Oo)oo[Oo[n]._classRegistryKey]||qt(Oo[n],`Expression${n}`);function Nf(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Fa(n){return self.ImageBitmap&&n instanceof ImageBitmap}function ao(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Nf(n)||Fa(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const o of n)i.push(ao(o,e));return i}if(n instanceof Map){const i={$name:"Map",entries:[]};for(const[o,a]of n.entries())i.entries.push(ao(o),ao(a,e));return i}if(n instanceof Set){const i={$name:"Set"};let o=0;for(const a of n.values())i[++o]=ao(a);return i}if(n instanceof DOMMatrix){const i={$name:"DOMMatrix"},o=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const a of o)i[a]=n[a];return i}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const i=n.constructor,o=i._classRegistryKey;if(!o)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const a=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const h in n)n.hasOwnProperty(h)&&(oo[o].omit.indexOf(h)>=0||(a[h]=ao(n[h],e)));n instanceof Error&&(a.message=n.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(a.$name=o),a}throw new Error("can't serialize object of type "+typeof n)}function Oa(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Nf(n)||Fa(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(Oa);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const a=n.entries||[],h=new Map;for(let d=0;d<a.length;d+=2)h.set(Oa(a[d]),Oa(a[d+1]));return h}if(e==="Set"){const a=new Set;for(const h of Object.keys(n))h!=="$name"&&a.add(Oa(n[h]));return a}if(e==="DOMMatrix"){let a;return a=n.is2D?[n.a,n.b,n.c,n.d,n.e,n.f]:[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44],new DOMMatrix(a)}if(e==="BigInt")return BigInt(n.value);const{klass:i}=oo[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(n);const o=Object.create(i.prototype);for(const a of Object.keys(n))a!=="$name"&&(o[a]=Oa(n[a]));return o}throw new Error("can't deserialize object of type "+typeof n)}const fi={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,Osage:n=>n>=66736&&n<=66815,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function No(n){for(const e of n)if(jd(e.charCodeAt(0)))return!0;return!1}function rc(n){for(const e of n)if(!Bd(e.charCodeAt(0)))return!1;return!0}function Bd(n){return!(fi.Arabic(n)||fi["Arabic Supplement"](n)||fi["Arabic Extended-A"](n)||fi["Arabic Presentation Forms-A"](n)||fi["Arabic Presentation Forms-B"](n))}function jd(n){return!(n!==746&&n!==747&&(n<4352||!(fi["Bopomofo Extended"](n)||fi.Bopomofo(n)||fi["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||fi["CJK Compatibility Ideographs"](n)||fi["CJK Compatibility"](n)||fi["CJK Radicals Supplement"](n)||fi["CJK Strokes"](n)||!(!fi["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||fi["CJK Unified Ideographs Extension A"](n)||fi["CJK Unified Ideographs"](n)||fi["Enclosed CJK Letters and Months"](n)||fi["Hangul Compatibility Jamo"](n)||fi["Hangul Jamo Extended-A"](n)||fi["Hangul Jamo Extended-B"](n)||fi["Hangul Jamo"](n)||fi["Hangul Syllables"](n)||fi.Hiragana(n)||fi["Ideographic Description Characters"](n)||fi.Kanbun(n)||fi["Kangxi Radicals"](n)||fi["Katakana Phonetic Extensions"](n)||fi.Katakana(n)&&n!==12540||!(!fi["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!fi["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||fi["Unified Canadian Aboriginal Syllabics"](n)||fi["Unified Canadian Aboriginal Syllabics Extended"](n)||fi["Vertical Forms"](n)||fi["Yijing Hexagram Symbols"](n)||fi["Yi Syllables"](n)||fi["Yi Radicals"](n))))}function Bh(n){return!(jd(n)||function(e){return!!(fi["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||fi["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||fi["Letterlike Symbols"](e)||fi["Number Forms"](e)||fi["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||fi["Control Pictures"](e)&&e!==9251||fi["Optical Character Recognition"](e)||fi["Enclosed Alphanumerics"](e)||fi["Geometric Shapes"](e)||fi["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||fi["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||fi["CJK Symbols and Punctuation"](e)||fi.Katakana(e)||fi["Private Use Area"](e)||fi["CJK Compatibility Forms"](e)||fi["Small Form Variants"](e)||fi["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function kp(n){return fi.Arabic(n)||fi["Arabic Supplement"](n)||fi["Arabic Extended-A"](n)||fi["Arabic Presentation Forms-A"](n)||fi["Arabic Presentation Forms-B"](n)}function $u(n){return n>=1424&&n<=2303||fi["Arabic Presentation Forms-A"](n)||fi["Arabic Presentation Forms-B"](n)}function Na(n,e){return!(!e&&$u(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||fi.Khmer(n))}function jh(n){for(const e of n)if($u(e.charCodeAt(0)))return!0;return!1}const Cs={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let dl=null,As=Cs.unavailable,So=null;const sc=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(As=Cs.error),dl&&dl(n)};function Hu(){Rr.fire(new Vl("pluginStateChange",{pluginStatus:As,pluginURL:So}))}const Rr=new Ul,fl=function(){return As},Vd=function(){if(As!==Cs.deferred||!So)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");As=Cs.loading,Hu(),So&&mh({url:So},n=>{n?sc(n):(As=Cs.loaded,Hu())})},ca={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>As===Cs.loaded||ca.applyArabicShaping!=null,isLoading:()=>As===Cs.loading,setState(n){As=n.pluginStatus,So=n.pluginURL},isParsing:()=>As===Cs.parsing,isParsed:()=>As===Cs.parsed,getPluginURL:()=>So};class Pn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,o){for(const a of i)if(!Na(a.charCodeAt(0),o))return!1;return!0}(e,ca.isLoaded())}}class qc{constructor(e,i,o,a){this.property=e,this.value=i,this.expression=function(h,d,x,w){if(Jl(h))return new tc(h,d);if(hl(h)||Array.isArray(h)&&h.length>0){const T=Wc(h,d,x,w);if(T.result==="error")throw new Error(T.value.map(I=>`${I.key}: ${I.message}`).join(", "));return T.value}{let T=h;return typeof h=="string"&&d.type==="color"&&(T=mn.parse(h)),{kind:"constant",configDependencies:new Set,evaluate:()=>T}}}(i===void 0?e.specification.default:i,e.specification,o,a)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class Eo{constructor(e,i,o){this.property=e,this.value=new qc(e,void 0,i,o)}transitioned(e,i){return new ts(this.property,this.value,i,He({},e.transition,this.transition),e.now)}untransitioned(){return new ts(this.property,this.value,null,{},0)}}class Fr{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return Ai(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Eo(this._values[e].property,this._scope,this._options)),this._values[e].value=new qc(this._values[e].property,i===null?void 0:Ai(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const o=this._properties.properties;if(e)for(const a in e){const h=e[a];if(a.endsWith("-transition")){const d=a.slice(0,-11);o[d]&&this.setTransition(d,h)}else o.hasOwnProperty(a)&&this.setValue(a,h)}}getTransition(e){return Ai(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Eo(this._values[e].property)),this._values[e].transition=Ai(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const a=this.getTransition(i);a!==void 0&&(e[`${i}-transition`]=a)}return e}transitioned(e,i){const o=new ms(this._properties);for(const a of Object.keys(this._values))o._values[a]=this._values[a].transitioned(e,i._values[a]);return o}untransitioned(){const e=new ms(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class ts{constructor(e,i,o,a,h){const d=a.delay||0,x=a.duration||0;h=h||0,this.property=e,this.value=i,this.begin=h+d,this.end=this.begin+x,e.specification.transition&&(a.delay||a.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const a=e.now||0,h=this.value.possiblyEvaluate(e,i,o),d=this.prior;if(d){if(a>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(a<this.begin)return d.possiblyEvaluate(e,i,o);{const x=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,i,o),h,ne(x))}}return h}}class ms{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const a=new ua(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].possiblyEvaluate(e,i,o);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ud{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this.configDependencies=new Set}getValue(e){return Ai(this._values[e].value)}setValue(e,i){this._values[e]=new qc(this._values[e].property,i===null?void 0:Ai(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const a=new ua(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].possiblyEvaluate(e,i,o);return a}}class Ba{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,a){return this.property.evaluate(this.value,this.parameters,e,i,o,a)}}class ua{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class wt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const a=il[this.specification.type];return a?a(e,i,o):e}}class kt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,a){return new Ba(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,a)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ba(this,{kind:"constant",value:void 0},e.parameters);const a=il[this.specification.type];return a?new Ba(this,{kind:"constant",value:a(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,a,h,d){return e.kind==="constant"?e.value:e.evaluate(i,o,a,h,d)}}class pl{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,a){return!!e.expression.evaluate(i,null,{},o,a)}interpolate(){return!1}}class ur{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Pn(0,{});for(const o in e){const a=e[o];a.specification.overridable&&this.overridableProperties.push(o);const h=this.defaultPropertyValues[o]=new qc(a,void 0),d=this.defaultTransitionablePropertyValues[o]=new Eo(a);this.defaultTransitioningPropertyValues[o]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=h.possiblyEvaluate(i)}}}qt(kt,"DataDrivenProperty"),qt(wt,"DataConstantProperty"),qt(pl,"ColorRampProperty");var je=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function is(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function lo(n){if(Array.isArray(n))return n.map(lo);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=lo(n[i]);return e}return is(n)}function oc(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!oc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Vh(n,e="",i=null,o="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};oc(n)||(n=Uh(n));const a=n;let h=!0;try{h=function(I){if(!Zc(I))return I;let P=lo(I);return Bf(P),P=Gd(P),P}(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(a,null,2)}
        `)}let d=null,x=null;if(o!=="background"&&o!=="sky"&&o!=="slot"){x=je[`filter_${o}`];const I=za(h,x,e,i);if(I.result==="error")throw new Error(I.value.map(P=>`${P.key}: ${P.message}`).join(", "));d=(P,R,F)=>I.value.evaluate(P,R,{},F)}let w=null,T=null;if(h!==a){const I=za(a,x,e,i);if(I.result==="error")throw new Error(I.value.map(P=>`${P.key}: ${P.message}`).join(", "));w=(P,R,F,N,H)=>I.value.evaluate(P,R,{},F,void 0,void 0,N,H),T=!cl(I.value.expression)}return{filter:d,dynamicFilter:w||void 0,needGeometry:jf(h),needFeature:!!T}}function Gd(n){if(!Array.isArray(n))return n;const e=function(i){if(Dp.has(i[0])){for(let o=1;o<i.length;o++)if(Zc(i[o]))return!0}return i}(n);return e===!0?e:e.map(i=>Gd(i))}function Bf(n){let e=!1;const i=[];if(n[0]==="case"){for(let o=1;o<n.length-1;o+=2)e=e||Zc(n[o]),i.push(n[o+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||Zc(n[1]);for(let o=2;o<n.length-1;o+=2)i.push(n[o+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||Zc(n[1]);for(let o=1;o<n.length-1;o+=2)i.push(n[o+1])}e&&(n.length=0,n.push("any",...i));for(let o=1;o<n.length;o++)Bf(n[o])}function Zc(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(Zc(n[i]))return!0;return!1}const Dp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Lp(n,e){return n<e?-1:n>e?1:0}function jf(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(jf(n[e]))return!0;return!1}function Uh(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?$d(n[1],n[2],"=="):e==="!="?Gh($d(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?$d(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(Uh))):e==="all"?["all"].concat(n.slice(1).map(Uh)):e==="none"?["all"].concat(n.slice(1).map(Uh).map(Gh)):e==="in"?Hd(n[1],n.slice(2)):e==="!in"?Gh(Hd(n[1],n.slice(2))):e==="has"?Wu(n[1]):e!=="!has"||Gh(Wu(n[1]));var i}function $d(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function Hd(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Lp)]]:["filter-in-small",n,["literal",e]]}}function Wu(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Gh(n){return["!",n]}const ac="";function ja(n,e){return e?`${n}${ac}${e}`:n}const Wd="-transition",Va=new Set(["fill","line","background","hillshade","raster"]);class Is extends Ul{constructor(e,i,o,a,h){if(super(),this.id=e.id,this.fqid=ja(this.id,o),this.type=e.type,this.scope=o,this.lut=a,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const d=za(this.filter,je[`filter_${e.type}`]);d.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...d.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new Ud(i.layout,this.scope,h),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new Fr(i.paint,this.scope,h);for(const d in e.paint)this.setPaintProperty(d,e.paint[d]);for(const d in e.layout)this.setLayoutProperty(d,e.layout[d]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ua(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Va.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Wd)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const o=this._transitionablePaint,a=o._properties.properties;if(e.endsWith(Wd)){const P=e.slice(0,-11);return a[P]&&o.setTransition(P,i||void 0),!1}if(!a[e])return!1;const h=o._values[e],d=h.value.isDataDriven(),x=h.value;o.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...o.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const w=o._values[e].value,T=w.isDataDriven(),I=e.endsWith("pattern")||e==="line-dasharray";return T||d||I||this._handleOverridablePaintPropertyUpdate(e,x,w)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,o){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Si({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ba&&ju(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Vh(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,o,a,h,d,x,w,T){}}const zp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class qu{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Yn{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function hn(n,e=1){let i=0,o=0;return{members:n.map(a=>{const h=zp[a.type].BYTES_PER_ELEMENT,d=i=qd(i,Math.max(e,h)),x=a.components||1;return o=Math.max(o,h),i+=h*x,{name:a.name,type:a.type,components:x,offset:d}}),size:qd(i,Math.max(o,e)),alignment:e}}function qd(n,e){return Math.ceil(n/e)*e}class Ua extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const a=2*e;return this.int16[a+0]=i,this.int16[a+1]=o,e}}Ua.prototype.bytesPerElement=4,qt(Ua,"StructArrayLayout2i4");class Zu extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o)}emplace(e,i,o,a){const h=3*e;return this.int16[h+0]=i,this.int16[h+1]=o,this.int16[h+2]=a,e}}Zu.prototype.bytesPerElement=6,qt(Zu,"StructArrayLayout3i6");class Xu extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,a)}emplace(e,i,o,a,h){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=o,this.int16[d+2]=a,this.int16[d+3]=h,e}}Xu.prototype.bytesPerElement=8,qt(Xu,"StructArrayLayout4i8");class ml extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}ml.prototype.bytesPerElement=4,qt(ml,"StructArrayLayout1f4");class Vf extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o)}emplace(e,i,o,a){const h=4*e,d=2*e;return this.int16[h+0]=i,this.int16[h+1]=o,this.float32[d+1]=a,e}}Vf.prototype.bytesPerElement=8,qt(Vf,"StructArrayLayout2i1f8");class Zd extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o)}emplace(e,i,o,a){const h=4*e;return this.int16[h+0]=i,this.int16[h+1]=o,this.int16[h+2]=a,e}}Zd.prototype.bytesPerElement=8,qt(Zd,"StructArrayLayout3i8");class Xc extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,a,h)}emplace(e,i,o,a,h,d){const x=5*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=a,this.int16[x+3]=h,this.int16[x+4]=d,e}}Xc.prototype.bytesPerElement=10,qt(Xc,"StructArrayLayout5i10");class Xd extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,d,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,a,h,d,x)}emplace(e,i,o,a,h,d,x,w){const T=6*e,I=12*e,P=3*e;return this.int16[T+0]=i,this.int16[T+1]=o,this.uint8[I+4]=a,this.uint8[I+5]=h,this.uint8[I+6]=d,this.uint8[I+7]=x,this.float32[P+2]=w,e}}Xd.prototype.bytesPerElement=12,qt(Xd,"StructArrayLayout2i4ub1f12");class ha extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o)}emplace(e,i,o,a){const h=3*e;return this.float32[h+0]=i,this.float32[h+1]=o,this.float32[h+2]=a,e}}ha.prototype.bytesPerElement=12,qt(ha,"StructArrayLayout3f12");class da extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,a,h)}emplace(e,i,o,a,h,d){const x=6*e,w=3*e;return this.uint16[x+0]=i,this.uint16[x+1]=o,this.uint16[x+2]=a,this.uint16[x+3]=h,this.float32[w+2]=d,e}}da.prototype.bytesPerElement=12,qt(da,"StructArrayLayout4ui1f12");class $h extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,a)}emplace(e,i,o,a,h){const d=4*e;return this.uint16[d+0]=i,this.uint16[d+1]=o,this.uint16[d+2]=a,this.uint16[d+3]=h,e}}$h.prototype.bytesPerElement=8,qt($h,"StructArrayLayout4ui8");class Yd extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,d){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,a,h,d)}emplace(e,i,o,a,h,d,x){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=a,this.int16[w+3]=h,this.int16[w+4]=d,this.int16[w+5]=x,e}}Yd.prototype.bytesPerElement=12,qt(Yd,"StructArrayLayout6i12");class Yu extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,d,x,w,T,I,P,R){const F=this.length;return this.resize(F+1),this.emplace(F,e,i,o,a,h,d,x,w,T,I,P,R)}emplace(e,i,o,a,h,d,x,w,T,I,P,R,F){const N=12*e;return this.int16[N+0]=i,this.int16[N+1]=o,this.int16[N+2]=a,this.int16[N+3]=h,this.uint16[N+4]=d,this.uint16[N+5]=x,this.uint16[N+6]=w,this.uint16[N+7]=T,this.int16[N+8]=I,this.int16[N+9]=P,this.int16[N+10]=R,this.int16[N+11]=F,e}}Yu.prototype.bytesPerElement=24,qt(Yu,"StructArrayLayout4i4ui4i24");class Ws extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,d){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,a,h,d)}emplace(e,i,o,a,h,d,x){const w=10*e,T=5*e;return this.int16[w+0]=i,this.int16[w+1]=o,this.int16[w+2]=a,this.float32[T+2]=h,this.float32[T+3]=d,this.float32[T+4]=x,e}}Ws.prototype.bytesPerElement=20,qt(Ws,"StructArrayLayout3i3f20");class Xr extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,a)}emplace(e,i,o,a,h){const d=4*e;return this.float32[d+0]=i,this.float32[d+1]=o,this.float32[d+2]=a,this.float32[d+3]=h,e}}Xr.prototype.bytesPerElement=16,qt(Xr,"StructArrayLayout4f16");class gl extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}gl.prototype.bytesPerElement=4,qt(gl,"StructArrayLayout1ul4");class _l extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const a=2*e;return this.uint16[a+0]=i,this.uint16[a+1]=o,e}}_l.prototype.bytesPerElement=4,qt(_l,"StructArrayLayout2ui4");class Kd extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,d,x,w,T,I,P,R,F){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,o,a,h,d,x,w,T,I,P,R,F)}emplace(e,i,o,a,h,d,x,w,T,I,P,R,F,N){const H=20*e,Z=10*e;return this.int16[H+0]=i,this.int16[H+1]=o,this.int16[H+2]=a,this.int16[H+3]=h,this.int16[H+4]=d,this.float32[Z+3]=x,this.float32[Z+4]=w,this.float32[Z+5]=T,this.float32[Z+6]=I,this.int16[H+14]=P,this.uint32[Z+8]=R,this.uint16[H+18]=F,this.uint16[H+19]=N,e}}Kd.prototype.bytesPerElement=40,qt(Kd,"StructArrayLayout5i4f1i1ul2ui40");class Hh extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,d,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,a,h,d,x)}emplace(e,i,o,a,h,d,x,w){const T=8*e;return this.int16[T+0]=i,this.int16[T+1]=o,this.int16[T+2]=a,this.int16[T+4]=h,this.int16[T+5]=d,this.int16[T+6]=x,this.int16[T+7]=w,e}}Hh.prototype.bytesPerElement=16,qt(Hh,"StructArrayLayout3i2i2i16");class Wh extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,a,h)}emplace(e,i,o,a,h,d){const x=4*e,w=8*e;return this.float32[x+0]=i,this.float32[x+1]=o,this.float32[x+2]=a,this.int16[w+6]=h,this.int16[w+7]=d,e}}Wh.prototype.bytesPerElement=16,qt(Wh,"StructArrayLayout2f1f2i16");class Ga extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,d){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,a,h,d)}emplace(e,i,o,a,h,d,x){const w=20*e,T=5*e;return this.uint8[w+0]=i,this.uint8[w+1]=o,this.float32[T+1]=a,this.float32[T+2]=h,this.float32[T+3]=d,this.float32[T+4]=x,e}}Ga.prototype.bytesPerElement=20,qt(Ga,"StructArrayLayout2ub4f20");class Yr extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,o)}emplace(e,i,o,a){const h=3*e;return this.uint16[h+0]=i,this.uint16[h+1]=o,this.uint16[h+2]=a,e}}Yr.prototype.bytesPerElement=6,qt(Yr,"StructArrayLayout3ui6");class Yc extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,d,x,w,T,I,P,R,F,N,H,Z,ee,oe,ae,q,re){const le=this.length;return this.resize(le+1),this.emplace(le,e,i,o,a,h,d,x,w,T,I,P,R,F,N,H,Z,ee,oe,ae,q,re)}emplace(e,i,o,a,h,d,x,w,T,I,P,R,F,N,H,Z,ee,oe,ae,q,re,le){const fe=30*e,Me=15*e,Ce=60*e;return this.int16[fe+0]=i,this.int16[fe+1]=o,this.int16[fe+2]=a,this.float32[Me+2]=h,this.float32[Me+3]=d,this.uint16[fe+8]=x,this.uint16[fe+9]=w,this.uint32[Me+5]=T,this.uint32[Me+6]=I,this.uint32[Me+7]=P,this.uint16[fe+16]=R,this.uint16[fe+17]=F,this.uint16[fe+18]=N,this.float32[Me+10]=H,this.float32[Me+11]=Z,this.uint8[Ce+48]=ee,this.uint8[Ce+49]=oe,this.uint8[Ce+50]=ae,this.uint32[Me+13]=q,this.int16[fe+28]=re,this.uint8[Ce+58]=le,e}}Yc.prototype.bytesPerElement=60,qt(Yc,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Uf extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,d,x,w,T,I,P,R,F,N,H,Z,ee,oe,ae,q,re,le,fe,Me,Ce,Re,Ne,Je,gt,ct,mt,xt,tt){const ft=this.length;return this.resize(ft+1),this.emplace(ft,e,i,o,a,h,d,x,w,T,I,P,R,F,N,H,Z,ee,oe,ae,q,re,le,fe,Me,Ce,Re,Ne,Je,gt,ct,mt,xt,tt)}emplace(e,i,o,a,h,d,x,w,T,I,P,R,F,N,H,Z,ee,oe,ae,q,re,le,fe,Me,Ce,Re,Ne,Je,gt,ct,mt,xt,tt,ft){const Ke=20*e,Qe=40*e,Ct=80*e;return this.float32[Ke+0]=i,this.float32[Ke+1]=o,this.int16[Qe+4]=a,this.int16[Qe+5]=h,this.int16[Qe+6]=d,this.int16[Qe+7]=x,this.int16[Qe+8]=w,this.int16[Qe+9]=T,this.int16[Qe+10]=I,this.int16[Qe+11]=P,this.int16[Qe+12]=R,this.uint16[Qe+13]=F,this.uint16[Qe+14]=N,this.uint16[Qe+15]=H,this.uint16[Qe+16]=Z,this.uint16[Qe+17]=ee,this.uint16[Qe+18]=oe,this.uint16[Qe+19]=ae,this.uint16[Qe+20]=q,this.uint16[Qe+21]=re,this.uint16[Qe+22]=le,this.uint16[Qe+23]=fe,this.uint16[Qe+24]=Me,this.uint16[Qe+25]=Ce,this.uint16[Qe+26]=Re,this.uint16[Qe+27]=Ne,this.uint32[Ke+14]=Je,this.float32[Ke+15]=gt,this.float32[Ke+16]=ct,this.float32[Ke+17]=mt,this.float32[Ke+18]=xt,this.uint8[Ct+76]=tt,this.uint16[Qe+39]=ft,e}}Uf.prototype.bytesPerElement=80,qt(Uf,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Jd extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,d){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,a,h,d)}emplace(e,i,o,a,h,d,x){const w=6*e;return this.float32[w+0]=i,this.float32[w+1]=o,this.float32[w+2]=a,this.float32[w+3]=h,this.float32[w+4]=d,this.float32[w+5]=x,e}}Jd.prototype.bytesPerElement=24,qt(Jd,"StructArrayLayout6f24");class yl extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,a,h)}emplace(e,i,o,a,h,d){const x=5*e;return this.float32[x+0]=i,this.float32[x+1]=o,this.float32[x+2]=a,this.float32[x+3]=h,this.float32[x+4]=d,e}}yl.prototype.bytesPerElement=20,qt(yl,"StructArrayLayout5f20");class Ku extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,d,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,a,h,d,x)}emplace(e,i,o,a,h,d,x,w){const T=7*e;return this.float32[T+0]=i,this.float32[T+1]=o,this.float32[T+2]=a,this.float32[T+3]=h,this.float32[T+4]=d,this.float32[T+5]=x,this.float32[T+6]=w,e}}Ku.prototype.bytesPerElement=28,qt(Ku,"StructArrayLayout7f28");class Qd extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,d,x,w,T,I,P){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,o,a,h,d,x,w,T,I,P)}emplace(e,i,o,a,h,d,x,w,T,I,P,R){const F=11*e;return this.float32[F+0]=i,this.float32[F+1]=o,this.float32[F+2]=a,this.float32[F+3]=h,this.float32[F+4]=d,this.float32[F+5]=x,this.float32[F+6]=w,this.float32[F+7]=T,this.float32[F+8]=I,this.float32[F+9]=P,this.float32[F+10]=R,e}}Qd.prototype.bytesPerElement=44,qt(Qd,"StructArrayLayout11f44");class qh extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,d,x,w,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,i,o,a,h,d,x,w,T)}emplace(e,i,o,a,h,d,x,w,T,I){const P=9*e;return this.float32[P+0]=i,this.float32[P+1]=o,this.float32[P+2]=a,this.float32[P+3]=h,this.float32[P+4]=d,this.float32[P+5]=x,this.float32[P+6]=w,this.float32[P+7]=T,this.float32[P+8]=I,e}}qh.prototype.bytesPerElement=36,qt(qh,"StructArrayLayout9f36");class Kc extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const a=2*e;return this.float32[a+0]=i,this.float32[a+1]=o,e}}Kc.prototype.bytesPerElement=8,qt(Kc,"StructArrayLayout2f8");class qs extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,o,a)}emplace(e,i,o,a,h){const d=6*e;return this.uint32[3*e+0]=i,this.uint16[d+2]=o,this.uint16[d+3]=a,this.uint16[d+4]=h,e}}qs.prototype.bytesPerElement=12,qt(qs,"StructArrayLayout1ul3ui12");class gs extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}gs.prototype.bytesPerElement=2,qt(gs,"StructArrayLayout1ui2");class Jc extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,d,x,w,T,I,P,R,F,N,H,Z){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,i,o,a,h,d,x,w,T,I,P,R,F,N,H,Z)}emplace(e,i,o,a,h,d,x,w,T,I,P,R,F,N,H,Z,ee){const oe=16*e;return this.float32[oe+0]=i,this.float32[oe+1]=o,this.float32[oe+2]=a,this.float32[oe+3]=h,this.float32[oe+4]=d,this.float32[oe+5]=x,this.float32[oe+6]=w,this.float32[oe+7]=T,this.float32[oe+8]=I,this.float32[oe+9]=P,this.float32[oe+10]=R,this.float32[oe+11]=F,this.float32[oe+12]=N,this.float32[oe+13]=H,this.float32[oe+14]=Z,this.float32[oe+15]=ee,e}}Jc.prototype.bytesPerElement=64,qt(Jc,"StructArrayLayout16f64");class Ju extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,a,h,d,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,o,a,h,d,x)}emplace(e,i,o,a,h,d,x,w){const T=10*e,I=5*e;return this.uint16[T+0]=i,this.uint16[T+1]=o,this.uint16[T+2]=a,this.uint16[T+3]=h,this.float32[I+2]=d,this.float32[I+3]=x,this.float32[I+4]=w,e}}Ju.prototype.bytesPerElement=20,qt(Ju,"StructArrayLayout4ui3f20");class ef extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}ef.prototype.bytesPerElement=2,qt(ef,"StructArrayLayout1i2");class Zh extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Zh.prototype.bytesPerElement=1,qt(Zh,"StructArrayLayout1ub1");class Gf extends qu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Gf.prototype.size=40;class Qu extends Kd{get(e){return new Gf(this,e)}}qt(Qu,"CollisionBoxArray");class $f extends qu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}$f.prototype.size=60;class tf extends Yc{get(e){return new $f(this,e)}}qt(tf,"PlacedSymbolArray");class Hf extends qu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Hf.prototype.size=80;class Wf extends Uf{get(e){return new Hf(this,e)}}qt(Wf,"SymbolInstanceArray");class Xh extends ml{getoffsetX(e){return this.float32[1*e+0]}}qt(Xh,"GlyphOffsetArray");class nf extends Ua{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}qt(nf,"SymbolLineVertexArray");class qf extends qu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}qf.prototype.size=12;class rf extends qs{get(e){return new qf(this,e)}}qt(rf,"FeatureIndexArray");class Yh extends _l{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}qt(Yh,"FillExtrusionCentroidArray");class Fp extends qu{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Fp.prototype.size=6;class Zf extends Zu{get(e){return new Fp(this,e)}}qt(Zf,"FillExtrusionWallArray");const Xf=hn([{name:"a_pos",components:2,type:"Int16"}],4),Op=hn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Qc=hn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Vn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,a){let h=this.segments[this.segments.length-1];return e>Vn.MAX_VERTEX_ARRAY_LENGTH&&zi(`Max vertices per segment is ${Vn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>Vn.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==a)&&(h={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},a!==void 0&&(h.sortKey=a),this.segments.push(h)),h}prepareSegment(e,i,o,a){return this._prepareSegment(e,i.length,o.length,a)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,a){return new Vn([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:a,vaos:{},sortKey:0}])}}function Np(n,e){return 256*(n=we(Math.floor(n),0,255))+we(Math.floor(e),0,255)}Vn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qt(Vn,"SegmentVector");const Kh=hn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Jh=hn([{name:"a_pattern_b",components:4,type:"Uint16"}]),Yf=hn([{name:"a_dash",components:4,type:"Uint16"}]);class eh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,a){this.ids.push(eu(e)),this.positions.push(i,o,a)}eachPosition(e,i){const o=eu(e);let a=0,h=this.ids.length-1;for(;a<h;){const d=a+h>>1;this.ids[d]>=o?h=d:a=d+1}for(;this.ids[a]===o;)i(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(e,i){const o=new Float64Array(e.ids),a=new Uint32Array(e.positions);return _s(o,a,0,o.length-1),i&&(i.add(o.buffer),i.add(a.buffer)),{ids:o,positions:a}}static deserialize(e){const i=new eh;let o;i.ids=e.ids,i.positions=e.positions;for(const a of i.ids)a!==o&&i.uniqueIds.push(a),o=a;return i.indexed=!0,i}}function eu(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Cc(String(n))}function _s(n,e,i,o){for(;i<o;){const a=n[i+o>>1];let h=i-1,d=o+1;for(;;){do h++;while(n[h]<a);do d--;while(n[d]>a);if(h>=d)break;Qh(n,h,d),Qh(e,3*h,3*d),Qh(e,3*h+1,3*d+1),Qh(e,3*h+2,3*d+2)}d-i<o-d?(_s(n,e,i,d),i=d+1):(_s(n,e,d+1,o),o=d)}}function Qh(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}qt(eh,"FeaturePositionMap");class xl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class tu extends xl{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class zn extends xl{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class $a extends xl{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class Ri extends xl{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class vl extends xl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class sf extends xl{constructor(e){super(e),this.current=mn.transparent.toPremultipliedRenderColor(null)}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const Bp=new Float32Array(16);class th extends xl{constructor(e){super(e),this.current=Bp}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let a=1;a<16;a++)if(o[a]!==this.current[a]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const iu=new Float32Array(9),Bo=new Float32Array(4);class nu extends xl{constructor(e){super(e),this.current=Bo}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let a=0;a<4;a++)if(o[a]!==this.current[a]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function of(n){return[Np(255*n.r,255*n.g),Np(255*n.b,255*n.a)]}class ih{constructor(e,i,o,a){this.value=e,this.uniformNames=i.map(h=>`u_${h}`),this.type=o,this.context=a}setUniform(e,i,o,a,h){const d=a.constantOr(this.value);i.set(e,h,d instanceof mn?d.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):d)}getBinding(e,i){return this.type==="color"?new sf(e):new zn(e)}}class ru{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,o,a,h){let d=null;h!=="u_pattern"&&h!=="u_dash"||(d=this.pattern),h==="u_pattern_b"&&(d=this.patternTransition),h==="u_pixel_ratio"&&(d=this.pixelRatio),d&&i.set(e,h,d)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new vl(e):new zn(e)}}class fa{constructor(e,i,o,a){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(h=>({name:`a_${h}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,i,o,a,h,d,x,w){const T=this.paintVertexArray.length,I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Pn(0,{brightness:d,worldview:w}),i,{},h,a,x):this.expression.kind==="constant"&&this.expression.value,P=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Pn(0,{brightness:d,worldview:w}),i,{},h,a,x):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(T,e,I,P?null:this.context.lut)}updatePaintArray(e,i,o,a,h,d,x,w){const T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:x,worldview:w},o,a,void 0,h):this.expression.kind==="constant"&&this.expression.value,I=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Pn(0,{brightness:x,worldview:w}),o,a,void 0,h):this.lutExpression.value)==="none";this._setPaintValue(e,i,T,I?null:this.context.lut)}_setPaintValue(e,i,o,a){if(this.type==="color"){const h=of(o.toPremultipliedRenderColor(a));for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,h[0],h[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class jo{constructor(e,i,o,a,h,d){this.expression=e,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=o,this.useIntegerZoom=a,this.context=h,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,i,o,a,h,d,x,w){const T=this.expression.evaluate(new Pn(this.context.zoom,{brightness:d,worldview:w}),i,{},h,a,x),I=this.expression.evaluate(new Pn(this.context.zoom+1,{brightness:d,worldview:w}),i,{},h,a,x),P=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Pn(0,{brightness:d,worldview:w}),i,{},h,a,x):this.lutExpression.value)==="none",R=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(R,e,T,I,P?null:this.context.lut)}updatePaintArray(e,i,o,a,h,d,x,w){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:x,worldview:w},o,a,void 0,h),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x,worldview:w},o,a,void 0,h),P=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Pn(0,{brightness:x,worldview:w}),o,a,void 0,h):this.lutExpression.value)==="none";this._setPaintValue(e,i,T,I,P?null:this.context.lut)}_setPaintValue(e,i,o,a,h){if(this.type==="color"){const d=of(o.toPremultipliedRenderColor(h)),x=of(o.toPremultipliedRenderColor(h));for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,d[0],d[1],x[0],x[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,o,a);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,a,h){const d=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,x=we(this.expression.interpolationFactor(d,this.context.zoom,this.context.zoom+1),0,1);i.set(e,h,x)}getBinding(e,i){return new zn(e)}}class Er{constructor(e,i,o,a,h){this.expression=e,this.layerId=h,this.paintVertexAttributes=(o==="array"?Yf:Kh).members;for(let d=0;d<i.length;++d);this.paintVertexArray=new a,this.paintTransitionVertexArray=new $h}populatePaintArray(e,i,o,a){const h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(h,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,a,h,d,x){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],d)}_setPaintValues(e,i,o,a){if(!a||!o)return;const h=a[o[0]],d=a[o[1]];if(h){if(h){const{tl:x,br:w,pixelRatio:T}=h;for(let I=e;I<i;I++)this.paintVertexArray.emplace(I,x[0],x[1],w[0],w[1],T)}if(d){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:x,br:w}=d;for(let T=e;T<i;T++)this.paintTransitionVertexArray.emplace(T,x[0],x[1],w[0],w[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Jh.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Zs{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[],this.context=i;const a=[];for(const h in e.paint._values){const d=e.paint.get(h);if(h.endsWith("-use-theme")||!o(h)||!(d instanceof Ba&&ju(d.property.specification)))continue;const x=s(h,e.type),w=d.value,T=d.property.specification.type,I=!!d.property.useIntegerZoom,P=h==="line-dasharray"||h.endsWith("pattern"),R=e.paint.get(`${h}-use-theme`),F=h==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||R&&R.value.kind!=="constant";if(w.kind!=="constant"||F)if(w.kind==="source"||F||P){const N=_(h,T,"source");this.binders[h]=P?new Er(w,x,T,N,e.id):new fa(w,x,T,N),a.push(`/a_${h}`)}else{const N=_(h,T,"composite");this.binders[h]=new jo(w,x,T,I,i,N),a.push(`/z_${h}`)}else this.binders[h]=P?new ru(w.value,x):new ih(w.value,x,T,i),a.push(`/u_${h}`);R&&(this.binders[h].lutExpression=R.value)}this.cacheKey=a.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof fa||i instanceof jo?i.maxValue:0}populatePaintArrays(e,i,o,a,h,d,x,w){for(const T in this.binders){const I=this.binders[T];I.context=this.context,(I instanceof fa||I instanceof jo||I instanceof Er)&&I.populatePaintArray(e,i,o,a,h,d,x,w)}}setConstantPatternPositions(e,i){for(const o in this.binders){const a=this.binders[o];a instanceof ru&&a.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof Er?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,o,a,h,d,x,w,T,I){let P=!1;const R=Object.keys(e),F=R.length!==0&&!w,N=F?R:i.uniqueIds;this.context.lut=h.lut;for(const H in this.binders){const Z=this.binders[H];if(Z.context=this.context,(Z instanceof fa||Z instanceof jo||Z instanceof Er)&&Z.expression&&Z.expression.kind&&Z.expression.kind!=="constant"&&(Z.expression.isStateDependent===!0||Z.expression.isLightConstant===!1)){const ee=h.paint.get(H);Z.expression=ee.value;for(const oe of N){const ae=e[oe.toString()];i.eachPosition(oe,(q,re,le)=>{const fe=a.feature(q);Z.updatePaintArray(re,le,fe,ae,d,x,T,I)})}if(!F)for(const oe of o.uniqueIds){const ae=e[oe.toString()];o.eachPosition(oe,(q,re,le)=>{const fe=a.feature(q);Z.updatePaintArray(re,le,fe,ae,d,x,T,I)})}P=!0}}return P}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof ih||o instanceof ru)&&e.push(...o.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof fa||o instanceof jo||o instanceof Er)for(let a=0;a<o.paintVertexAttributes.length;a++)e.push(o.paintVertexAttributes[a].name);if(o instanceof Er)for(let a=0;a<Jh.members.length;a++)e.push(Jh.members[a].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof ih||o instanceof ru||o instanceof jo)for(const a of o.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const o in this.binders){const a=this.binders[o];if(a instanceof ih||a instanceof ru||a instanceof jo)for(const h of a.uniformNames)i.push({name:h,property:o,binding:a.getBinding(e,h)})}return i}setUniforms(e,i,o,a,h){for(const{name:d,property:x,binding:w}of o)this.binders[x].setUniform(e,w,h,a.get(x),d)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof fa||i instanceof jo||i instanceof Er)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof Er&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof fa||o instanceof jo||o instanceof Er)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof fa||i instanceof jo||i instanceof Er)&&i.destroy()}}}class l{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new Zs(a,i,o);this.needsUpload=!1,this._featureMap=new eh,this._featureMapWithoutIds=new eh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,a,h,d,x,w,T){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(e,i,a,h,d,x,w,T);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,a,h,d,x,w){for(const T of o)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,T,a,h,d,x||0,w)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const t={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function s(n,e){return t[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const c={"line-pattern":{source:da,composite:da},"fill-pattern":{source:da,composite:da},"fill-extrusion-pattern":{source:da,composite:da},"line-dasharray":{source:$h,composite:$h}},m={color:{source:Kc,composite:Xr},number:{source:ml,composite:Kc}};function _(n,e,i){const o=c[n];return o&&o[i]||m[e][i]}qt(ih,"ConstantBinder"),qt(ru,"PatternConstantBinder"),qt(fa,"SourceExpressionBinder"),qt(Er,"PatternCompositeBinder"),qt(jo,"CompositeExpressionBinder"),qt(Zs,"ProgramConfiguration",{omit:["_buffers"]}),qt(l,"ProgramConfigurationSet");const v=Lt/Math.PI/2,S=5,A=6,k=16383,L=64,B=[L,32,16],O=-v,j=v;function X(n,e,i,o=v){return i=_n(i),[n*Math.sin(i)*o,-e*o,n*Math.cos(i)*o]}function W(n,e,i){return X(Math.cos(_n(n)),Math.sin(_n(n)),e,i)}const Y=63710088e-1,J=2*Math.PI*Y;class ie{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ie($e(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,a=e.lat*i,h=Math.sin(o)*Math.sin(a)+Math.cos(o)*Math.cos(a)*Math.cos((e.lng-this.lng)*i);return Y*Math.acos(Math.min(h,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new ue({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return W(this.lat,this.lng,v+e*v/Y)}static convert(e){if(e instanceof ie)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ie(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ie(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ue{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const o=e;this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]])}else{const o=e;this.setSouthWest(o[0]).setNorthEast(o[1])}}setNorthEast(e){return this._ne=e instanceof ie?new ie(e.lng,e.lat):ie.convert(e),this}setSouthWest(e){return this._sw=e instanceof ie?new ie(e.lng,e.lat):ie.convert(e),this}extend(e){const i=this._sw,o=this._ne;let a,h;if(e instanceof ie)a=e,h=e;else{if(!(e instanceof ue))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ue.convert(e)):this.extend(ie.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ie.convert(e)):this;if(a=e._sw,h=e._ne,!a||!h)return this}return i||o?(i.lng=Math.min(a.lng,i.lng),i.lat=Math.min(a.lat,i.lat),o.lng=Math.max(h.lng,o.lng),o.lat=Math.max(h.lat,o.lat)):(this._sw=new ie(a.lng,a.lat),this._ne=new ie(h.lng,h.lat)),this}getCenter(){return new ie((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ie(this.getWest(),this.getNorth())}getSouthEast(){return new ie(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=ie.convert(e);let a=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&a}static convert(e){if(e)return e instanceof ue?e:new ue(e)}}const pe=0,be=25.5;function Te(n){return J*Math.cos(n*Math.PI/180)}function xe(n){return(180+n)/360}function me(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Ee(n,e){return n/Te(e)}function Ae(n){return 360*n-180}function Oe(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Ge(n,e){return n*Te(Oe(e))}const nt=85.051129;function it(n){return Math.cos(_n(we(n,-85.051129,nt)))}function ht(n,e){const i=we(e,pe,be),o=Math.pow(2,i);return it(n)*J/(512*o)}function Be(n){return 1/Math.cos(n*Math.PI/180)}function Xe(n,e=0){const i=Math.exp(Math.PI*(1-(n.y+e/Lt)/(1<<n.z)*2));return 80150034*i/(i*i+1)/Lt/(1<<n.z)}class ke{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=ie.convert(e);return new ke(xe(o.lng),me(o.lat),Ee(i,o.lat))}toLngLat(){return new ie(Ae(this.x),Oe(this.y))}toAltitude(){return Ge(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/J*Be(Oe(this.y))}}function st(n,e,i,o,a,h,d,x,w){const T=(e+o)/2,I=(i+a)/2,P=new Rt(T,I);x(P),function(R,F,N,H,Z,ee){const oe=N-Z,ae=H-ee;return Math.abs((H-F)*oe-(N-R)*ae)/Math.hypot(oe,ae)}(P.x,P.y,h.x,h.y,d.x,d.y)>=w?(st(n,e,i,T,I,h,P,x,w),st(n,T,I,o,a,P,d,x,w)):n.push(d)}function We(n,e,i){let o=n[0],a=o.x,h=o.y;e(o);const d=[o];for(let x=1;x<n.length;x++){const w=n[x],{x:T,y:I}=w;e(w),st(d,a,h,T,I,o,w,e,i),a=T,h=I,o=w}return d}function ut(n,e,i,o){if(o(e,i)){const a=e.add(i)._mult(.5);ut(n,e,a,o),ut(n,a,i,o)}else n.push(i)}function Et(n,e){let i=n[0];const o=[i];for(let a=1;a<n.length;a++){const h=n[a];ut(o,i,h,e),i=h}return o}const ot=Math.pow(2,14)-1,yt=-ot-1;function jt(n,e){const i=Math.round(n.x*e),o=Math.round(n.y*e);return n.x=we(i,yt,ot),n.y=we(o,yt,ot),(i<n.x||i>n.x+1||o<n.y||o>n.y+1)&&zi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function Wt(n,e,i){const o=n.loadGeometry(),a=n.extent,h=Lt/a;if(e&&i&&i.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:x,x:w,y:T,projection:I}=i,P=R=>{const F=Ae((e.x+R.x/a)/d),N=Oe((e.y+R.y/a)/d),H=I.project(F,N);R.x=(H.x*x-w)*a,R.y=(H.y*x-T)*a};for(let R=0;R<o.length;R++)if(n.type!==1)o[R]=We(o[R],P,1);else{const F=[];for(const N of o[R])N.x<0||N.x>=a||N.y<0||N.y>=a||(P(N),F.push(N));o[R]=F}}for(const d of o)for(const x of d)jt(x,h);return o}function Ot(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Wt(n):[]}}var Zt,ai,ui,wi,Ni,cn,Un,En={};function yn(){if(ai)return Zt;ai=1;var n=kl();function e(a,h,d,x,w){this.properties={},this.extent=d,this.type=0,this._pbf=a,this._geometry=-1,this._keys=x,this._values=w,a.readFields(i,this,h)}function i(a,h,d){a==1?h.id=d.readVarint():a==2?function(x,w){for(var T=x.readVarint()+x.pos;x.pos<T;){var I=w._keys[x.readVarint()],P=w._values[x.readVarint()];w.properties[I]=P}}(d,h):a==3?h.type=d.readVarint():a==4&&(h._geometry=d.pos)}function o(a){for(var h,d,x=0,w=0,T=a.length,I=T-1;w<T;I=w++)x+=((d=a[I]).x-(h=a[w]).x)*(h.y+d.y);return x}return Zt=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var h,d=a.readVarint()+a.pos,x=1,w=0,T=0,I=0,P=[];a.pos<d;){if(w<=0){var R=a.readVarint();x=7&R,w=R>>3}if(w--,x===1||x===2)T+=a.readSVarint(),I+=a.readSVarint(),x===1&&(h&&P.push(h),h=[]),h.push(new n(T,I));else{if(x!==7)throw new Error("unknown command "+x);h&&h.push(h[0].clone())}}return h&&P.push(h),P},e.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var h=a.readVarint()+a.pos,d=1,x=0,w=0,T=0,I=1/0,P=-1/0,R=1/0,F=-1/0;a.pos<h;){if(x<=0){var N=a.readVarint();d=7&N,x=N>>3}if(x--,d===1||d===2)(w+=a.readSVarint())<I&&(I=w),w>P&&(P=w),(T+=a.readSVarint())<R&&(R=T),T>F&&(F=T);else if(d!==7)throw new Error("unknown command "+d)}return[I,R,P,F]},e.prototype.toGeoJSON=function(a,h,d){var x,w,T=this.extent*Math.pow(2,d),I=this.extent*a,P=this.extent*h,R=this.loadGeometry(),F=e.types[this.type];function N(ee){for(var oe=0;oe<ee.length;oe++){var ae=ee[oe];ee[oe]=[360*(ae.x+I)/T-180,360/Math.PI*Math.atan(Math.exp((180-360*(ae.y+P)/T)*Math.PI/180))-90]}}switch(this.type){case 1:var H=[];for(x=0;x<R.length;x++)H[x]=R[x][0];N(R=H);break;case 2:for(x=0;x<R.length;x++)N(R[x]);break;case 3:for(R=function(ee){var oe=ee.length;if(oe<=1)return[ee];for(var ae,q,re=[],le=0;le<oe;le++){var fe=o(ee[le]);fe!==0&&(q===void 0&&(q=fe<0),q===fe<0?(ae&&re.push(ae),ae=[ee[le]]):ae.push(ee[le]))}return ae&&re.push(ae),re}(R),x=0;x<R.length;x++)for(w=0;w<R[x].length;w++)N(R[x][w])}R.length===1?R=R[0]:F="Multi"+F;var Z={type:"Feature",geometry:{type:F,coordinates:R},properties:this.properties};return"id"in this&&(Z.id=this.id),Z},Zt}function _r(){if(wi)return ui;wi=1;var n=yn();function e(o,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(i,this,a),this.length=this._features.length}function i(o,a,h){o===15?a.version=h.readVarint():o===1?a.name=h.readString():o===5?a.extent=h.readVarint():o===2?a._features.push(h.pos):o===3?a._keys.push(h.readString()):o===4&&a._values.push(function(d){for(var x=null,w=d.readVarint()+d.pos;d.pos<w;){var T=d.readVarint()>>3;x=T===1?d.readString():T===2?d.readFloat():T===3?d.readDouble():T===4?d.readVarint64():T===5?d.readVarint():T===6?d.readSVarint():T===7?d.readBoolean():null}return x}(h))}return ui=e,e.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var a=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,a,this.extent,this._keys,this._values)},ui}function Ii(){return Un||(Un=1,En.VectorTile=function(){if(cn)return Ni;cn=1;var n=_r();function e(i,o,a){if(i===3){var h=new n(a,a.readVarint()+a.pos);h.length&&(o[h.name]=h)}}return Ni=function(i,o){this.layers=i.readFields(e,{},o)},Ni}(),En.VectorTileFeature=yn(),En.VectorTileLayer=_r()),En}var Bi=Ii();const Yi="3d_elevation_id",Gn="level";class Cr{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,o){return this.get(e,!0,i,o)}optional(e,i,o){return this.get(e,!1,i,o)}success(){return this._valid}get(e,i,o,a){const h=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&h!==void 0&&!Number.isNaN(h)?o(a?a(h):h):i&&(this._valid=!1),this}}class Hn{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,o){return this.featureFunc(e,i,o)}parseVertex(e,i,o){return this.vertexFunc(e,i,o)}}const wn=new Hn((n,e,i)=>n.reset(e).require(Yi,o=>{i.id=o}).optional("fixed_height_relative",o=>{i.constantHeight=o},an.decodeRelativeHeight).geometry(o=>{i.bounds=o},If).success(),(n,e,i)=>n.reset(e).require(Yi,o=>{i.id=o}).require("elevation_idx",o=>{i.idx=o}).require("extent",o=>{i.extent=o}).require("height_relative",o=>{i.height=o},an.decodeRelativeHeight).geometry(o=>{i.position=o},an.getPoint).success()),pr=new Hn((n,e,i)=>n.reset(e).require(Yi,o=>{i.id=o}).optional("fixed_height",o=>{i.constantHeight=o},an.decodeMetricHeight).geometry(o=>{i.bounds=o},If).success(),(n,e,i)=>n.reset(e).require(Yi,o=>{i.id=o}).require("elevation_idx",o=>{i.idx=o}).require("extent",o=>{i.extent=o}).require("height",o=>{i.height=o},an.decodeMetricHeight).geometry(o=>{i.position=o},an.getPoint).success());class an{static getPoint(e){return $o(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const i=[],o=[],a=e.length,h=new Cr;for(let x=0;x<a;x++){const w=e.feature(x),T=w.properties.hasOwnProperty("version")?String(w.properties.version):void 0,I=(d=T)?d==="1.0.1"?pr:void 0:wn;if(I===void 0){zi(`Unknown elevation feature version number ${T||"(unknown)"}`);continue}const P=w.properties.hasOwnProperty("type")?w.properties.type:void 0;if(P){if(Bi.VectorTileFeature.types[w.type]==="Point"&&P==="curve_point"){const R={};I.parseVertex(h,w,R)&&i.push(R)}else if(Bi.VectorTileFeature.types[w.type]==="Polygon"&&P==="curve_meta"){const R={};I.parseFeature(h,w,R)&&o.push(R)}}}var d;return{vertices:i,features:o}}}class mr{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const a=Zn(i,this.dir);if(Math.abs(a)<1e-6)return!1;const h=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/a;return o[0]=this.pos[0]+this.dir[0]*h,o[1]=this.pos[1]+this.dir[1]*h,!0}}class Kn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const a=Zi(i,this.dir);if(Math.abs(a)<1e-6)return!1;const h=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/a;return o[0]=this.pos[0]+this.dir[0]*h,o[1]=this.pos[1]+this.dir[1]*h,o[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,i,o){if(function(F,N){var H=F[0],Z=F[1],ee=F[2],oe=N[0],ae=N[1],q=N[2];return Math.abs(H-oe)<=U*Math.max(1,Math.abs(H),Math.abs(oe))&&Math.abs(Z-ae)<=U*Math.max(1,Math.abs(Z),Math.abs(ae))&&Math.abs(ee-q)<=U*Math.max(1,Math.abs(ee),Math.abs(q))}(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;const[a,h,d]=this.dir,x=this.pos[0]-e[0],w=this.pos[1]-e[1],T=this.pos[2]-e[2],I=a*a+h*h+d*d,P=2*(x*a+w*h+T*d),R=P*P-4*I*(x*x+w*w+T*T-i*i);if(R<0){const F=Math.max(-P/2,0),N=x+a*F,H=w+h*F,Z=T+d*F,ee=Math.hypot(N,H,Z);return o[0]=N*i/ee,o[1]=H*i/ee,o[2]=Z*i/ee,!1}{const F=(-P-Math.sqrt(R))/(2*I);if(F<0){const N=Math.hypot(x,w,T);return o[0]=x*i/N,o[1]=w*i/N,o[2]=T*i/N,!1}return o[0]=x+a*F,o[1]=w+h*F,o[2]=T+d*F,!0}}}class Mn{constructor(e,i,o,a,h){this.TL=e,this.TR=i,this.BR=o,this.BL=a,this.horizon=h}static fromInvProjectionMatrix(e,i,o){const a=[-1,1,1],h=[1,1,1],d=[1,-1,1],x=[-1,-1,1],w=Xi(a,a,e),T=Xi(h,h,e),I=Xi(d,d,e),P=Xi(x,x,e);return new Mn(w,T,I,P,i/o)}}function Wn(n,e,i){let o=1/0,a=-1/0;const h=[];for(const d of n){xr(h,d,e);const x=Zi(h,i);o=Math.min(o,x),a=Math.max(a,x)}return[o,a]}function Fi(n,e){let i=!0;for(let o=0;o<n.planes.length;o++){const a=n.planes[o];let h=0;for(let d=0;d<e.length;d++)h+=Zi(a,e[d])+a[3]>=0;if(h===0)return 0;h!==e.length&&(i=!1)}return i?2:1}function vr(n,e){for(const i of n.projections){const o=Wn(e,n.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function ns(n,e){let i=0;const o=[0,0,0,0];for(let d=0;d<n.length;d++)o[0]=n[d][0],o[1]=n[d][1],o[2]=n[d][2],o[3]=1,(a=o)[0]*(h=e)[0]+a[1]*h[1]+a[2]*h[2]+a[3]*h[3]>=0&&i++;var a,h;return i}class ir{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=vn.fromPoints(this.points),this.projections=[],this.frustumEdges=[xr([],this.points[2],this.points[3]),xr([],this.points[0],this.points[3]),xr([],this.points[4],this.points[0]),xr([],this.points[5],this.points[1]),xr([],this.points[6],this.points[2]),xr([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const a=[0,-o[2],o[1]],h=[o[2],0,-o[0]];this.projections.push({axis:a,projection:Wn(this.points,this.points[0],a)}),this.projections.push({axis:h,projection:Wn(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(e,i,o,a){const h=Math.pow(2,o),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const I=vs([],T,e),P=1/I[3]/i*h;return(R=I)[0]=(F=I)[0]*(N=[P,P,a?1/I[3]:P,P])[0],R[1]=F[1]*N[1],R[2]=F[2]*N[2],R[3]=F[3]*N[3],R;var R,F,N}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const I=Di([],fn([],xr([],d[T[0]],d[T[1]]),xr([],d[T[2]],d[T[1]]))),P=-Zi(I,d[T[1]]);return I.concat(P)}),w=[];for(let T=0;T<d.length;T++)w.push([d[T][0],d[T][1],d[T][2]]);return new ir(w,x)}intersectsPrecise(e,i,o){for(let a=0;a<i.length;a++)if(!ns(e,i[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!ns(e,this.planes[a]))return 0;for(const a of o)for(const h of this.frustumEdges){const d=fn([],a,h),x=Li(d);if(x===0)continue;Kt(d,d,1/x);const w=Wn(this.points,this.points[0],d),T=Wn(e,this.points[0],d);if(w[0]>T[1]||T[0]>w[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const o=i[3];if(Zi([i[0],i[1],i[2]],e)+o<0)return!1}return!0}}class vn{static fromPoints(e){const i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const a of e)$t(i,i,a),Ei(o,o,a);return new vn(i,o)}static fromTileIdAndHeight(e,i,o){const a=1<<e.canonical.z,h=e.canonical.x,d=e.canonical.y;return new vn([h/a,d/a,i],[(h+1)/a,(d+1)/a,o])}static applyTransform(e,i){const o=e.getCorners();for(let a=0;a<o.length;++a)Xi(o[a],o[a],i);return vn.fromPoints(o)}static applyTransformFast(e,i){const o=[i[12],i[13],i[14]],a=[...o];for(let h=0;h<3;h++)for(let d=0;d<3;d++){const x=i[4*d+h],w=x*e.min[d],T=x*e.max[d];o[h]+=Math.min(w,T),a[h]+=Math.max(w,T)}return new vn(o,a)}static projectAabbCorners(e,i){const o=e.getCorners();for(let a=0;a<o.length;++a)Xi(o[a],o[a],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=Kt([],Ci([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],o=Nt(this.min),a=Nt(this.max);for(let h=0;h<i.length;h++)o[h]=i[h]?this.min[h]:this.center[h],a[h]=i[h]?this.center[h]:this.max[h];return a[2]=this.max[2],new vn(o,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Fi(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Fi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?vr(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?vr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}qt(vn,"Aabb");class co{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,o=i[1],a=-i[0],h=(e.extent+1)*this.metersToTile;return[new Rt(Math.trunc(e.position[0]+o*h),Math.trunc(e.position[1]+a*h)),new Rt(Math.trunc(e.position[0]-o*h),Math.trunc(e.position[1]-a*h))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Xs{constructor(e,i,o,a,h,d){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:o,max:o},this.safeArea=i,this.constantHeight=o,this.constantHeight==null&&(this.constantHeight!=null||a.length!==0)){this.vertices=a,this.edges=h,this.edges=this.edges.filter(x=>{return x.a<this.vertices.length&&x.b<this.vertices.length&&!((w=this.vertices[x.a].position)[0]===(T=this.vertices[x.b].position)[0]&&w[1]===T[1]);var w,T}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const x of this.vertices)this.vertexProps.push({dir:$o(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,x.height),this.heightRange.max=Math.max(this.heightRange.max,x.height);for(const x of this.edges){const w=this.vertices[x.a].position,T=this.vertices[x.b].position,I=Qa(Wr(),T,w),P=wa(I),R=yc(Wr(),I,1/P);this.edgeProps.push({vec:I,dir:R,len:P});const F=this.vertexProps[x.a].dir,N=this.vertexProps[x.b].dir;Il(F,F,R),Il(N,N,R)}for(const x of this.vertexProps)x.dir[0]===0&&x.dir[1]===0||Pl(x.dir,x.dir);this.tessellate(d)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[o,a]=i;return gi(this.vertices[this.edges[o].a].height,this.vertices[this.edges[o].b].height,a)}computeSlopeNormal(e,i){const o=this.getClosestEdge(e);if(!o)return Dt(0,0,1);const a=o[0],h=this.edges[a],d=this.edgeProps[a].vec,x=Dt(d[0],d[1],(this.vertices[h.b].height-this.vertices[h.a].height)*i),w=Dt(x[1],-x[0],0);fn(w,w,x);const T=Li(w);return T>0?Kt(w,w,1/T):Dt(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,o=Number.POSITIVE_INFINITY,a=0;const h=$o(e.x,e.y);for(let d=0;d<this.edges.length;d++){const x=this.edges[d],w=this.edgeProps[d].dir,T=new mr(h,this.edgeProps[d].dir),I=this.vertices[x.a].position,P=this.vertices[x.b].position,R=Wr(),F=Wr(),N=T.intersectsPlane(I,this.vertexProps[x.a].dir,R),H=T.intersectsPlane(P,this.vertexProps[x.b].dir,F);if(!N||!H)continue;const Z=Qa(Wr(),F,R),ee=Qa(Wr(),h,R),oe=Zn(Z,Z),ae=oe>0?Zn(ee,Z)/oe:0,q=we(ae,0,1),re=Math.abs((ae-q)*this.edgeProps[d].len),le=Qa(Wr(),h,I),fe=re+Math.abs(Zn(le,$o(w[1],-w[0])));fe<o&&(i=d,o=fe,a=q)}return[i,a]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){const o=this.edges[i].a,a=this.edges[i].b,{position:h,height:d,extent:x}=this.vertices[o],{position:w,height:T,extent:I}=this.vertices[a],P=this.vertexProps[o].dir,R=this.vertexProps[a].dir,F=Dt(h[0]/e,h[1]/e,d),N=Dt(w[0]/e,w[1]/e,T),H=Dt(P[1],-P[0],0);Kt(H,H,x);const Z=Dt(R[1],-R[0],0);if(Kt(Z,Z,I),this.distSqLines(Dt(F[0]+.5*H[0],F[1]+.5*H[1],F[2]+.5*H[2]),Dt(N[0]-.5*Z[0],N[1]-.5*Z[1],N[2]-.5*Z[2]),Dt(F[0]-.5*H[0],F[1]-.5*H[1],F[2]-.5*H[2]),Dt(N[0]+.5*Z[0],N[1]+.5*Z[1],N[2]+.5*Z[2]))<=.0025000000000000005)continue;const ee=this.vertices.length,oe=Il(Wr(),h,w);this.vertices.push({position:yc(oe,oe,.5),height:.5*(d+T),extent:.5*(x+I)});const ae=Il(Wr(),P,R);this.vertexProps.push({dir:Pl(ae,ae)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a:o,b:ee}),this.edges.push({a:ee,b:a});const q=Qa(Wr(),this.vertices[ee].position,h),re=wa(q),le={vec:q,dir:yc(Wr(),q,1/re),len:re};this.edgeProps.push(le),this.edgeProps.push(le)}}distSqLines(e,i,o,a){const h=yi(Ht(),i,e),d=yi(Ht(),a,o),x=yi(Ht(),e,o),w=Zi(h,h),T=Zi(h,d),I=Zi(h,x),P=Zi(d,d),R=Zi(d,x),F=w*P-T*T;if(F===0){const Z=Zi(x,d)/Zi(d,d);return zt(Ln(Ht(),o,a,Z),e)}const N=(T*R-I*P)/F,H=(w*R-T*I)/F;return zt(Ln(Ht(),e,i,N),Ln(Ht(),o,a,H))}}class Vo{static parseFrom(e,i){const o=an.parse(e);if(!o)return[];let{vertices:a,features:h}=o;const d=1/Xe(i);h.sort((I,P)=>I.id-P.id),a.sort((I,P)=>I.id-P.id||I.idx-P.idx),a=a.filter((I,P,R)=>P===R.findIndex(F=>F.id===I.id&&F.idx===I.idx));const x=new Array;let w=0;const T=a.length;for(const I of h){if(I.constantHeight){x.push(new Xs(I.id,I.bounds,I.constantHeight));continue}for(;w!==T&&a[w].id<I.id;)w++;if(w===T||a[w].id!==I.id)continue;const P=new Array,R=new Array,F=w;for(;w!==T&&a[w].id===I.id;){const N=a[w];if(P.push({position:N.position,height:N.height,extent:N.extent}),w!==F&&a[w-1].idx===N.idx-1){const H=w-F;R.push({a:H-1,b:H})}w++}x.push(new Xs(I.id,I.bounds,void 0,P,R,d))}return x}static getElevationFeature(e,i){if(!i)return;const o=+e.properties[Yi];return Number.isNaN(o)?void 0:i.find(a=>a.id===o)}}class Ur{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*Lt,this.yOffset=(e.y*this.zScale-i.y)*Lt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,o){const a=this.constantElevation(i,o);return a??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),o))}computeBiasedHeight(e,i){return i<=0?e:e+i*De(0,i,e>=0?e:Math.abs(.5*e))}}qt(Xs,"ElevationFeature");class Co{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ua,this.indexArray=new Yr,this.segments=new Vn,this.programConfigurations=new l(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new ml),this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,o,a){const h=this.layers[0],d=[];let x=null;h.type==="circle"&&(x=h.layout.get("circle-sort-key"));for(const{feature:T,id:I,index:P,sourceLayerIndex:R}of e){const F=this.layers[0]._featureFilter.needGeometry,N=Ot(T,F);if(!this.layers[0]._featureFilter.filter(new Pn(this.zoom,{worldview:this.worldview}),N,o))continue;const H=x?x.evaluate(N,{},o):void 0,Z={id:I,properties:T.properties,type:T.type,sourceLayerIndex:R,index:P,geometry:F?N.geometry:Wt(T,o,a),patterns:{},sortKey:H};d.push(Z)}x&&d.sort((T,I)=>T.sortKey-I.sortKey);let w=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new Yd,w=a.projection);for(const T of d){const{geometry:I,index:P,sourceLayerIndex:R}=T,F=e[P].feature;this.addFeature(T,I,P,i.availableImages,o,w,i.brightness,i.elevationFeatures),i.featureIndex.insert(F,I,P,R,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,o,a,h,d,x){this.programConfigurations.updatePaintArrays(e,i,h,o,a,d,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Qc.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Op.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,o,a,h,d,x,w){let T;this.elevationMode!=="none"&&(T=Vo.getElevationFeature(e,w));for(const I of i)for(const P of I){const R=P.x,F=P.y;if(R<0||R>=Lt||F<0||F>=Lt)continue;if(d){const Z=d.projectTilePoint(R,F,h),ee=d.upVector(h,R,F);this.addGlobeExtVertex(Z,ee),this.addGlobeExtVertex(Z,ee),this.addGlobeExtVertex(Z,ee),this.addGlobeExtVertex(Z,ee)}const N=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),H=N.vertexLength;if(this.addCircleVertex(R,F,-1,-1),this.addCircleVertex(R,F,1,-1),this.addCircleVertex(R,F,1,1),this.addCircleVertex(R,F,-1,1),this.elevationMode!=="none"){const Z=T?T.pointElevation(new Rt(R,F)):0;this.hasElevation=this.hasElevation||Z!==0;for(let ee=0;ee<4;ee++)this.elevatedLayoutVertexArray.emplaceBack(Z)}this.indexArray.emplaceBack(H,H+1,H+2),this.indexArray.emplaceBack(H,H+2,H+3),N.vertexLength+=4,N.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},a,h,x,void 0,this.worldview)}addCircleVertex(e,i,o,a){this.layoutVertexArray.emplaceBack(2*e+(o+1)/2,2*i+(a+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function uo(n,e){for(let i=0;i<n.length;i++)if(pa(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(pa(n,e[i]))return!0;return!!lc(n,e)}function ho(n,e,i){return!!pa(n,e)||!!su(e,n,i)}function Ao(n,e){if(n.length===1)return td(e,n[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let a=0;a<o.length;a++)if(pa(n,o[a]))return!0}for(let i=0;i<n.length;i++)if(td(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(lc(n,e[i]))return!0;return!1}function Io(n,e,i){if(n.length>1){if(lc(n,e))return!0;for(let o=0;o<e.length;o++)if(su(e[o],n,i))return!0}for(let o=0;o<n.length;o++)if(su(n[o],e,i))return!0;return!1}function lc(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const o=n[i],a=n[i+1];for(let h=0;h<e.length-1;h++)if(ed(o,a,e[h],e[h+1]))return!0}return!1}function ed(n,e,i,o){return Bn(n,i,o)!==Bn(e,i,o)&&Bn(n,e,i)!==Bn(n,e,o)}function cc(n,e,i){return(n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x)}function Kf(n,e,i,o){const a=cc(n,e,o),h=cc(n,e,i);if(Math.sign(a)===Math.sign(h))return;const d=cc(i,o,n),x=d+h-a;return Math.sign(d)!==Math.sign(x)?[d/(d-x),h/(h-a)]:void 0}function su(n,e,i){const o=i*i;if(e.length===1)return n.distSqr(e[0])<o;for(let a=1;a<e.length;a++)if(af(n,e[a-1],e[a])<o)return!0;return!1}function af(n,e,i){const o=e.distSqr(i);if(o===0)return n.distSqr(e);const a=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/o;return n.distSqr(a<0?e:a>1?i:i.sub(e)._mult(a)._add(e))}function td(n,e){let i,o,a,h=!1;for(let d=0;d<n.length;d++){i=n[d];for(let x=0,w=i.length-1;x<i.length;w=x++)o=i[x],a=i[w],o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(h=!h)}return h}function pa(n,e){let i=!1;for(let o=0,a=n.length-1;o<n.length;a=o++){const h=n[o],d=n[a];h.y>e.y!=d.y>e.y&&e.x<(d.x-h.x)*(e.y-h.y)/(d.y-h.y)+h.x&&(i=!i)}return i}function wl(n,e,i,o,a){for(const d of n)if(e<=d.x&&i<=d.y&&o>=d.x&&a>=d.y)return!0;const h=[new Rt(e,i),new Rt(e,a),new Rt(o,a),new Rt(o,i)];if(n.length>2){for(const d of h)if(pa(n,d))return!0}for(let d=0;d<n.length-1;d++)if(Ha(n[d],n[d+1],h))return!0;return!1}function Ha(n,e,i){const o=i[0],a=i[2];if(n.x<o.x&&e.x<o.x||n.x>a.x&&e.x>a.x||n.y<o.y&&e.y<o.y||n.y>a.y&&e.y>a.y)return!1;const h=Bn(n,e,i[0]);return h!==Bn(n,e,i[1])||h!==Bn(n,e,i[2])||h!==Bn(n,e,i[3])}function bl(n,e,i,o,a,h){let d=e.y-n.y,x=n.x-e.x;if(h=h||0){const w=d*d+x*x;if(w===0)return!0;const T=Math.sqrt(w);d/=T,x/=T}return!((i.x-n.x)*d+(i.y-n.y)*x-h<0||(o.x-n.x)*d+(o.y-n.y)*x-h<0||(a.x-n.x)*d+(a.y-n.y)*x-h<0)}function Jf(n,e,i,o,a,h,d){return!(bl(n,e,o,a,h,d)||bl(e,i,o,a,h,d)||bl(i,n,o,a,h,d)||bl(o,a,n,e,i,d)||bl(a,h,n,e,i,d)||bl(h,o,n,e,i,d))}function lf(n,e,i){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(n)}function Qf(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function jp(n,e,i,o,a){if(!e[0]&&!e[1])return n;const h=Rt.convert(e)._mult(a);i==="viewport"&&h._rotate(-o);const d=[];for(let x=0;x<n.length;x++)d.push(n[x].sub(h));return d}function ep(n,e,i,o){const a=Rt.convert(n)._mult(o);return e==="viewport"&&a._rotate(-i),a}let Vp,tp;function km(n,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}qt(Co,"CircleBucket",{omit:["layers"]});class id{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=uc(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const o=function(h,d,x){var w=km(256*h,256*(d=Math.pow(2,x)-d-1),x),T=km(256*(h+1),256*(d+1),x);return w[0]+","+w[1]+","+T[0]+","+T[1]}(this.x,this.y,this.z),a=function(h,d,x){let w,T="";for(let I=h;I>0;I--)w=1<<I-1,T+=(d&w?1:0)+(x&w?2:0);return T}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ip{constructor(e,i){this.wrap=e,this.canonical=i,this.key=uc(e,i.z,i.z,i.x,i.y)}}class Ys{constructor(e,i,o,a,h){this.overscaledZ=e,this.wrap=i,this.canonical=new id(o,+a,+h),this.key=i===0&&e===o?this.canonical.key:uc(i,e,o,a,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Ys(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ys(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return uc(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return uc(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Ys(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,a=2*this.canonical.y;return[new Ys(i,this.wrap,i,o,a),new Ys(i,this.wrap,i,o+1,a),new Ys(i,this.wrap,i,o,a+1),new Ys(i,this.wrap,i,o+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ys(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ys(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ip(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function uc(n,e,i,o,a){const h=1<<Math.min(i,22);let d=h*(a%h)+o%h;return n&&i<22&&(d+=h*h*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*d+i)+(e-i)}const Vy=[n=>{let e=n.canonical.x-1,i=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,i--),new Ys(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,i=n.wrap;return e===1<<n.canonical.z&&(e=0,i++),new Ys(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>new Ys(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new Ys(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];qt(id,"CanonicalTileID"),qt(Ys,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Up=hn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:f}=Up,g=hn([{name:"a_pos_3",components:3,type:"Int16"}]);var E=hn([{name:"a_pos",type:"Int16",components:2}]);function z(n){return n*v/Y}const $=[new vn([O,O,O],[j,j,j]),new vn([O,O,O],[0,0,j]),new vn([0,O,O],[j,0,j]),new vn([O,0,O],[0,j,j]),new vn([0,0,O],[j,j,j])];function K(n,e,i,o=!0){const a=Kt([],n._camera.position,n.worldSize),h=[e,i,1,1];vs(h,h,n.pixelMatrixInverse),ia(h,h,1/h[3]);const d=Di([],xr([],h,a)),x=n.globeMatrix,w=[x[12],x[13],x[14]],T=xr([],w,a),I=Li(T),P=Di([],T),R=n.worldSize/(2*Math.PI),F=Zi(P,d),N=Math.asin(R/I);if(N<Math.acos(F)){if(!o)return null;const Re=[],Ne=[];Kt(Re,d,I/F),Di(Ne,xr(Ne,Re,T)),Di(d,Ci(d,T,Kt(d,Ne,Math.tan(N)*I)))}const H=[];new Kn(a,d).closestPointOnSphere(w,R,H);const Z=Di([],gr(x,0)),ee=Di([],gr(x,1)),oe=Di([],gr(x,2)),ae=Zi(Z,H),q=Zi(ee,H),re=Zi(oe,H),le=qe(Math.asin(-q/R));let fe=qe(Math.atan2(ae,re));fe=n.center.lng+function(Re,Ne){const Je=(Ne-Re+180)%360-180;return Je<-180?Je+360:Je}(n.center.lng,fe);const Me=xe(fe),Ce=we(me(le),0,1);return new ke(Me,Ce)}class _e{constructor(e,i,o){this.a=xr([],e,o),this.b=xr([],i,o),this.center=o;const a=Di([],this.a),h=Di([],this.b);this.angle=Math.acos(Zi(a,h))}}function Ve(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(o,a,h,d){const x=Math.sin(h);return o*(Math.sin((1-d)*h)/x)+a*(Math.sin(d*h)/x)}(n.a[e],n.b[e],n.angle,we(i,0,1))+n.center[e]}function Ye(n){if(n.z<=1)return $[n.z+2*n.y+n.x];const e=ki(si(n));return vn.fromPoints(e)}function bt(n,e,i){return Kt(n,n,1-i),Ue(n,n,e,i)}function li(n,e,i){for(const o of n)Xi(o,o,e),Kt(o,o,i)}function ci(n,e,i,o){const a=e/n.worldSize,h=n.globeMatrix;if(i.z<=1){const Ce=Ye(i).getCorners();return li(Ce,h,a),vn.fromPoints(Ce)}const d=si(i,o),x=ki(d,v+z(n._tileCoverLift));li(x,h,a);const w=Number.MAX_VALUE,T=[-w,-w,-w],I=[w,w,w];if(d.contains(n.center)){for(const Ne of x)$t(I,I,Ne),Ei(T,T,Ne);T[2]=0;const Ce=n.point,Re=[Ce.x*a,Ce.y*a,0];return $t(I,I,Re),Ei(T,T,Re),new vn(I,T)}if(n._tileCoverLift>0){for(const Ce of x)$t(I,I,Ce),Ei(T,T,Ce);return new vn(I,T)}const P=[h[12]*a,h[13]*a,h[14]*a],R=d.getCenter(),F=we(n.center.lat,-85.051129,nt),N=we(R.lat,-85.051129,nt),H=xe(n.center.lng),Z=me(F);let ee=H-xe(R.lng);const oe=Z-me(N);ee>.5?ee-=1:ee<-.5&&(ee+=1);let ae=0;Math.abs(ee)>Math.abs(oe)?ae=ee>=0?1:3:(ae=oe>=0?0:2,Ue(P,P,[h[4]*a,h[5]*a,h[6]*a],-Math.sin(_n(oe>=0?d.getSouth():d.getNorth()))*v));const q=x[ae],re=x[(ae+1)%4],le=new _e(q,re,P),fe=[Ve(le,0)||q[0],Ve(le,1)||q[1],Ve(le,2)||q[2]],Me=tn(n.zoom);if(Me>0){const Ce=function({x:Ne,y:Je,z:gt},ct,mt,xt,tt){const ft=1/(1<<gt);let Ke=Ne*ft,Qe=Ke+ft,Ct=Je*ft,At=Ct+ft,hi=0;const ii=(Ke+Qe)/2-xt;return ii>.5?hi=-1:ii<-.5&&(hi=1),Ke=((Ke+hi)*ct-(xt*=ct))*mt+xt,Qe=((Qe+hi)*ct-xt)*mt+xt,Ct=(Ct*ct-(tt*=ct))*mt+tt,At=(At*ct-tt)*mt+tt,[[Ke,At,0],[Qe,At,0],[Qe,Ct,0],[Ke,Ct,0]]}(i,e,n._pixelsPerMercatorPixel,H,Z);for(let Ne=0;Ne<x.length;Ne++)bt(x[Ne],Ce[Ne],Me);const Re=Ci([],Ce[ae],Ce[(ae+1)%4]);Kt(Re,Re,.5),bt(fe,Re,Me)}for(const Ce of x)$t(I,I,Ce),Ei(T,T,Ce);return I[2]=Math.min(q[2],re[2]),$t(I,I,fe),Ei(T,T,fe),new vn(I,T)}function si({x:n,y:e,z:i},o=!1){const a=1/(1<<i),h=new ie(Ae(n*a),e===(1<<i)-1&&o?-90:Oe((e+1)*a)),d=new ie(Ae((n+1)*a),e===0&&o?90:Oe(e*a));return new ue(h,d)}function ki(n,e=v){const i=_n(n.getNorth()),o=_n(n.getSouth()),a=Math.cos(i),h=Math.cos(o),d=Math.sin(i),x=Math.sin(o),w=n.getWest(),T=n.getEast();return[X(h,x,w,e),X(h,x,T,e),X(a,d,T,e),X(a,d,w,e)]}function ji(n,e,i,o){const a=1<<i.z,h=(n/Lt+i.x)/a;return W(Oe((e/Lt+i.y)/a),Ae(h),o)}function $i({min:n,max:e}){return k/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const rs=new Float64Array(16);function dt(n){const e=$i(n),i=Bt(rs,[e,e,e]);return et(i,i,ln([],n.min))}function at(n){const e=(o=n.min,(i=rs)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i);var i,o;const a=1/$i(n);return pt(e,e,[a,a,a])}function _t(n){const e=Lt/(2*Math.PI);return n/(2*Math.PI)/e}function pi(n,e){return Lt/(512*Math.pow(2,n))*$i(Ye(e))}function Qi(n,e,i,o,a){const h=_t(i),d=[n,e,-i/(2*Math.PI)],x=ve(new Float64Array(16));return et(x,x,d),pt(x,x,[h,h,h]),Tt(x,x,_n(-a)),It(x,x,_n(-o)),x}function tn(n){return De(S,A,n)}function dn(n,e){const i=W(e.lat,e.lng),o=function(N){const H=W(N._center.lat,N._center.lng);let Z=fn([],Dt(0,1,0),H);const ee=Yt([],-N.angle,H);Z=Xi(Z,Z,ee),Yt(ee,-N._pitch,Z);const oe=Di([],H);return Kt(oe,oe,z(N.cameraToCenterDistance/N.pixelsPerMeter)),Xi(oe,oe,ee),Ci([],H,oe)}(n);return d=(a=yi([],o,i))[0],x=a[1],w=a[2],T=(h=i)[0],I=h[1],P=h[2],F=(R=Math.sqrt(d*d+x*x+w*w)*Math.sqrt(T*T+I*I+P*P))&&Zi(a,h)/R,Math.acos(Math.min(Math.max(F,-1),1));var a,h,d,x,w,T,I,P,R,F}function bn(n,e){return dn(n,e)>Math.PI/2*1.01}const Fs=_n(85),Tr=Math.cos(Fs),nh=Math.sin(Fs),Uy=Se(),l1=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function c1(n,e,i,o,a,h,d,x,w){if(h&&n.queryGeometry.isAboveHorizon)return!1;h&&(w*=n.pixelToTileUnitsFactor);const T=n.tileID.canonical,I=i.projection.upVectorScale(T,i.center.lat,i.worldSize).metersToTile;for(const P of e)for(const R of P){const F=R.add(x),N=a&&i.elevation?i.elevation.exaggeration()*a.getElevationAt(F.x,F.y,!0):0,H=i.projection.projectTilePoint(F.x,F.y,T);if(N>0){const ae=i.projection.upVector(T,F.x,F.y);H.x+=ae[0]*I*N,H.y+=ae[1]*I*N,H.z+=ae[2]*I*N}const Z=h?F:u4(H.x,H.y,H.z,o),ee=h?n.tilespaceRays.map(ae=>d4(ae,N)):n.queryGeometry.screenGeometry,oe=vs([],[H.x,H.y,H.z,1],o);if(!d&&h?w*=oe[3]/i.cameraToCenterDistance:d&&!h&&(w*=i.cameraToCenterDistance/oe[3]),h){const ae=Oe((R.y/Lt+T.y)/(1<<T.z));w/=i.projection.pixelsPerMeter(ae,1)/Ee(1,ae)}if(ho(ee,Z,w))return!0}return!1}function u4(n,e,i,o){const a=vs([],[n,e,i,1],o);return new Rt(a[0]/a[3],a[1]/a[3])}const u1=Dt(0,0,0),h4=Dt(0,0,1);function d4(n,e){const i=Ht();return u1[2]=e,n.intersectsPlane(u1,h4,i),new Rt(i[0],i[1])}class h1 extends Co{}let d1,f1,p1,m1;function g1(n,{width:e,height:i},o,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*i*o)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*i*o);return n.width=e,n.height=i,n.data=a,n}function _1(n,e,i){const{width:o,height:a}=e;o===n.width&&a===n.height||(Gy(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,o),height:Math.min(n.height,a)},i,null),n.width=o,n.height=a,n.data=e.data)}function Gy(n,e,i,o,a,h,d,x){if(a.width===0||a.height===0)return e;if(a.width>n.width||a.height>n.height||i.x>n.width-a.width||i.y>n.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||o.x>e.width-a.width||o.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const w=n.data,T=e.data,I=h===4&&x;for(let P=0;P<a.height;P++){const R=((i.y+P)*n.width+i.x)*h,F=((o.y+P)*e.width+o.x)*h;if(I)for(let N=0;N<a.width;N++){const H=R+N*h+3,Z=F+N*h;T[Z+0]=255,T[Z+1]=255,T[Z+2]=255,T[Z+3]=w[H]}else if(d)for(let N=0;N<a.width;N++){const H=R+N*h,Z=F+N*h,ee=new mn(w[H+0]/255,w[H+1]/255,w[H+2]/255,w[H+3]).toNonPremultipliedRenderColor(d).toArray();T[Z+0]=ee[0],T[Z+1]=ee[1],T[Z+2]=ee[2],T[Z+3]=ee[3]}else for(let N=0;N<a.width*h;N++)T[F+N]=w[R+N]}return e}qt(h1,"HeatmapBucket",{omit:["layers"]});class cf{constructor(e,i){g1(this,e,1,i)}resize(e){_1(this,new cf(e),1)}clone(){return new cf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,a,h){Gy(e,i,o,a,h,1,null)}}class Ks{constructor(e,i){g1(this,e,4,i)}resize(e){_1(this,new Ks(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ks({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,a,h,d,x){Gy(e,i,o,a,h,4,d,x)}}class y1{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Dm(n){const e={},i=n.resolution||256,o=n.clips?n.clips.length:1,a=n.image||new Ks({width:i,height:o}),h=(d,x,w)=>{e[n.evaluationKey]=w;const T=n.expression.evaluate(e),I=T?T.toNonPremultipliedRenderColor(null):null;I&&(a.data[d+x+0]=Math.floor(255*I.r),a.data[d+x+1]=Math.floor(255*I.g),a.data[d+x+2]=Math.floor(255*I.b),a.data[d+x+3]=Math.floor(255*I.a))};if(n.clips)for(let d=0,x=0;d<o;++d,x+=4*i)for(let w=0,T=0;w<i;w++,T+=4){const I=w/(i-1),{start:P,end:R}=n.clips[d];h(x,T,P*(1-I)+R*I)}else for(let d=0,x=0;d<i;d++,x+=4)h(0,x,d/(i-1));return a}qt(cf,"AlphaImage"),qt(Ks,"RGBAImage");const f4=hn([{name:"a_pos",components:2,type:"Int16"}],4),p4=hn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),m4=hn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),g4=hn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Lm(n,e,i=2){const o=e&&e.length,a=o?e[0]*i:n.length;let h=x1(n,0,a,i,!0);const d=[];if(!h||h.next===h.prev)return d;let x,w,T;if(o&&(h=function(I,P,R,F){const N=[];for(let H=0,Z=P.length;H<Z;H++){const ee=x1(I,P[H]*F,H<Z-1?P[H+1]*F:I.length,F,!1);ee===ee.next&&(ee.steiner=!0),N.push(S4(ee))}N.sort(w4);for(let H=0;H<N.length;H++)R=b4(N[H],R);return R}(n,e,h,i)),n.length>80*i){x=1/0,w=1/0;let I=-1/0,P=-1/0;for(let R=i;R<a;R+=i){const F=n[R],N=n[R+1];F<x&&(x=F),N<w&&(w=N),F>I&&(I=F),N>P&&(P=N)}T=Math.max(I-x,P-w),T=T!==0?32767/T:0}return zm(h,d,i,x,w,T,0),d}function x1(n,e,i,o,a){let h;if(a===function(d,x,w,T){let I=0;for(let P=x,R=w-T;P<w;P+=T)I+=(d[R]-d[P])*(d[P+1]+d[R+1]),R=P;return I}(n,e,i,o)>0)for(let d=e;d<i;d+=o)h=T1(d/o|0,n[d],n[d+1],h);else for(let d=i-o;d>=e;d-=o)h=T1(d/o|0,n[d],n[d+1],h);return h&&Gp(h,h.next)&&(Nm(h),h=h.next),h}function np(n,e){if(!n)return n;e||(e=n);let i,o=n;do if(i=!1,o.steiner||!Gp(o,o.next)&&ys(o.prev,o,o.next)!==0)o=o.next;else{if(Nm(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function zm(n,e,i,o,a,h,d){if(!n)return;!d&&h&&function(w,T,I,P){let R=w;do R.z===0&&(R.z=$y(R.x,R.y,T,I,P)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==w);R.prevZ.nextZ=null,R.prevZ=null,function(F){let N,H=1;do{let Z,ee=F;F=null;let oe=null;for(N=0;ee;){N++;let ae=ee,q=0;for(let le=0;le<H&&(q++,ae=ae.nextZ,ae);le++);let re=H;for(;q>0||re>0&&ae;)q!==0&&(re===0||!ae||ee.z<=ae.z)?(Z=ee,ee=ee.nextZ,q--):(Z=ae,ae=ae.nextZ,re--),oe?oe.nextZ=Z:F=Z,Z.prevZ=oe,oe=Z;ee=ae}oe.nextZ=null,H*=2}while(N>1)}(R)}(n,o,a,h);let x=n;for(;n.prev!==n.next;){const w=n.prev,T=n.next;if(h?y4(n,o,a,h):_4(n))e.push(w.i,n.i,T.i),Nm(n),n=T.next,x=T.next;else if((n=T)===x){d?d===1?zm(n=x4(np(n),e),e,i,o,a,h,2):d===2&&v4(n,e,i,o,a,h):zm(np(n),e,i,o,a,h,1);break}}}function _4(n){const e=n.prev,i=n,o=n.next;if(ys(e,i,o)>=0)return!1;const a=e.x,h=i.x,d=o.x,x=e.y,w=i.y,T=o.y,I=Math.min(a,h,d),P=Math.min(x,w,T),R=Math.max(a,h,d),F=Math.max(x,w,T);let N=o.next;for(;N!==e;){if(N.x>=I&&N.x<=R&&N.y>=P&&N.y<=F&&Fm(a,x,h,w,d,T,N.x,N.y)&&ys(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function y4(n,e,i,o){const a=n.prev,h=n,d=n.next;if(ys(a,h,d)>=0)return!1;const x=a.x,w=h.x,T=d.x,I=a.y,P=h.y,R=d.y,F=Math.min(x,w,T),N=Math.min(I,P,R),H=Math.max(x,w,T),Z=Math.max(I,P,R),ee=$y(F,N,e,i,o),oe=$y(H,Z,e,i,o);let ae=n.prevZ,q=n.nextZ;for(;ae&&ae.z>=ee&&q&&q.z<=oe;){if(ae.x>=F&&ae.x<=H&&ae.y>=N&&ae.y<=Z&&ae!==a&&ae!==d&&Fm(x,I,w,P,T,R,ae.x,ae.y)&&ys(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,q.x>=F&&q.x<=H&&q.y>=N&&q.y<=Z&&q!==a&&q!==d&&Fm(x,I,w,P,T,R,q.x,q.y)&&ys(q.prev,q,q.next)>=0))return!1;q=q.nextZ}for(;ae&&ae.z>=ee;){if(ae.x>=F&&ae.x<=H&&ae.y>=N&&ae.y<=Z&&ae!==a&&ae!==d&&Fm(x,I,w,P,T,R,ae.x,ae.y)&&ys(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;q&&q.z<=oe;){if(q.x>=F&&q.x<=H&&q.y>=N&&q.y<=Z&&q!==a&&q!==d&&Fm(x,I,w,P,T,R,q.x,q.y)&&ys(q.prev,q,q.next)>=0)return!1;q=q.nextZ}return!0}function x4(n,e){let i=n;do{const o=i.prev,a=i.next.next;!Gp(o,a)&&w1(o,i,i.next,a)&&Om(o,a)&&Om(a,o)&&(e.push(o.i,i.i,a.i),Nm(i),Nm(i.next),i=n=a),i=i.next}while(i!==n);return np(i)}function v4(n,e,i,o,a,h){let d=n;do{let x=d.next.next;for(;x!==d.prev;){if(d.i!==x.i&&E4(d,x)){let w=b1(d,x);return d=np(d,d.next),w=np(w,w.next),zm(d,e,i,o,a,h,0),void zm(w,e,i,o,a,h,0)}x=x.next}d=d.next}while(d!==n)}function w4(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function b4(n,e){const i=function(a,h){let d=h;const x=a.x,w=a.y;let T,I=-1/0;if(Gp(a,d))return d;do{if(Gp(a,d.next))return d.next;if(w<=d.y&&w>=d.next.y&&d.next.y!==d.y){const H=d.x+(w-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(H<=x&&H>I&&(I=H,T=d.x<d.next.x?d:d.next,H===x))return T}d=d.next}while(d!==h);if(!T)return null;const P=T,R=T.x,F=T.y;let N=1/0;d=T;do{if(x>=d.x&&d.x>=R&&x!==d.x&&v1(w<F?x:I,w,R,F,w<F?I:x,w,d.x,d.y)){const H=Math.abs(w-d.y)/(x-d.x);Om(d,a)&&(H<N||H===N&&(d.x>T.x||d.x===T.x&&T4(T,d)))&&(T=d,N=H)}d=d.next}while(d!==P);return T}(n,e);if(!i)return e;const o=b1(i,n);return np(o,o.next),np(i,i.next)}function T4(n,e){return ys(n.prev,n,e.prev)<0&&ys(e.next,n,n.next)<0}function $y(n,e,i,o,a){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*a|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function S4(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function v1(n,e,i,o,a,h,d,x){return(a-d)*(e-x)>=(n-d)*(h-x)&&(n-d)*(o-x)>=(i-d)*(e-x)&&(i-d)*(h-x)>=(a-d)*(o-x)}function Fm(n,e,i,o,a,h,d,x){return!(n===d&&e===x)&&v1(n,e,i,o,a,h,d,x)}function E4(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,o){let a=i;do{if(a.i!==i.i&&a.next.i!==i.i&&a.i!==o.i&&a.next.i!==o.i&&w1(a,a.next,i,o))return!0;a=a.next}while(a!==i);return!1}(n,e)&&(Om(n,e)&&Om(e,n)&&function(i,o){let a=i,h=!1;const d=(i.x+o.x)/2,x=(i.y+o.y)/2;do a.y>x!=a.next.y>x&&a.next.y!==a.y&&d<(a.next.x-a.x)*(x-a.y)/(a.next.y-a.y)+a.x&&(h=!h),a=a.next;while(a!==i);return h}(n,e)&&(ys(n.prev,n,e.prev)||ys(n,e.prev,e))||Gp(n,e)&&ys(n.prev,n,n.next)>0&&ys(e.prev,e,e.next)>0)}function ys(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Gp(n,e){return n.x===e.x&&n.y===e.y}function w1(n,e,i,o){const a=i_(ys(n,e,i)),h=i_(ys(n,e,o)),d=i_(ys(i,o,n)),x=i_(ys(i,o,e));return a!==h&&d!==x||!(a!==0||!t_(n,i,e))||!(h!==0||!t_(n,o,e))||!(d!==0||!t_(i,n,o))||!(x!==0||!t_(i,e,o))}function t_(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function i_(n){return n>0?1:n<0?-1:0}function Om(n,e){return ys(n.prev,n,n.next)<0?ys(n,e,n.next)>=0&&ys(n,n.prev,e)>=0:ys(n,e,n.prev)<0||ys(n,n.next,e)<0}function b1(n,e){const i=Hy(n.i,n.x,n.y),o=Hy(e.i,e.x,e.y),a=n.next,h=e.prev;return n.next=e,e.prev=n,i.next=a,a.prev=i,o.next=i,i.prev=o,h.next=o,o.prev=h,o}function T1(n,e,i,o){const a=Hy(n,e,i);return o?(a.next=o.next,a.prev=o,o.next.prev=a,o.next=a):(a.prev=a,a.next=a),a}function Nm(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Hy(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function n_(n,e){const i=n.length;if(i<=1)return[n];const o=[];let a,h;for(let d=0;d<i;d++){const x=nn(n[d]);x!==0&&(n[d].area=Math.abs(x),h===void 0&&(h=x<0),h===x<0?(a&&o.push(a),a=[n[d]]):a.push(n[d]))}if(a&&o.push(a),e>1)for(let d=0;d<o.length;d++)o[d].length<=e||(Zr(o[d],e,1,o[d].length-1,C4),o[d]=o[d].slice(0,e));return o}function C4(n,e){return e.area-n.area}function S1(n,e,i=1){if(!n)return null;const o=typeof n=="string"?no.from(n).getPrimary():n.getPrimary(),a=typeof n=="string"?null:n.getSecondary();for(const h of[o,a]){if(!h)continue;const d=h.id.toString();e.has(d)||e.set(d,[]),h.scaleSelf(i),e.get(d).push(h)}return{primary:o.toString(),secondary:a?a.toString():null}}function Wy(n,e,i,o){const a=o.patternDependencies;let h=!1;for(const d of e){const x=d.paint.get(`${n}-pattern`);x.isConstant()||(h=!0),S1(x.constantOr(null),a,i)&&(h=!0)}return h}function qy(n,e,i,o,a,h){const d=h.patternDependencies;for(const x of e){const w=x.paint.get(`${n}-pattern`).value;if(w.kind!=="constant"){let T=w.evaluate({zoom:o},i,{},h.availableImages);T=T&&T.name?T.name:T;const I=S1(T,d,a);if(!I)continue;const{primary:P,secondary:R}=I;P&&(i.patterns[x.id]=[P,R].filter(Boolean))}}return i}class E1{constructor(){this.polygons=new Map}add(e,...i){this.polygons.has(e)?this.polygons.get(e).push(...i):this.polygons.set(e,i)}merge(e){for(const[i,o]of e.polygons)this.add(i,...o)}}class rp{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new rp;let i=[];for(const T of e)i.push(...T.portals);if(i.length===0)return new rp;const o=(T,I)=>T<=0&&I<=0||T>=Lt&&I>=Lt;for(const T of i){const I=T.va,P=T.vb;(o(I.x,P.x)||o(I.y,P.y))&&(T.type="border")}const a=i.filter(T=>T.type!=="unevaluated"),h=i.filter(T=>T.type==="unevaluated");if(h.length===0)return new rp;h.sort((T,I)=>T.hash===I.hash?T.isTunnel===I.isTunnel?0:T.isTunnel?-1:1:T.hash<I.hash?1:-1),i=a.concat(h);let d=a.length,x=d,w=d;do if(x++,x===i.length||i[d].hash!==i[x].hash){if(x-d==2){w<d&&(i[w]=i[d],i[d]=null);const T=i[w],I=i[x-1];T.type=T.isTunnel!==I.isTunnel?"tunnel":"polygon",T.connection={a:T.connection.a,b:I.connection.a},w++}d=x}while(d!==i.length);return i.splice(w),i.sort((T,I)=>T.hash<I.hash?1:-1),{portals:i}}}qt(rp,"ElevationPortalGraph"),qt(E1,"ElevationPolygons");class A4{constructor(e,i,o){this.outPositions=e,this.outNormals=i,this.outIndices=o,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,i,o){let a=e[2];o!=null&&(a*=o);const h=this.getVec3Bits(e)<<96n|this.getVec3Bits(i),d=this.vertexLookup.get(h);if(d!=null)return d;const x=this.outPositions.length;this.vertexLookup.set(h,x);const w=Math.trunc(16384*i[0]),T=Math.trunc(16384*i[1]),I=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],a),this.outNormals.emplaceBack(w,T,I),x}addVertices(e,i,...o){const a=[];for(const h of o){const d=this.addVertex(h,e,i);a.push(d)}return a}addTriangles(e,i,o){if(i&&o){const a=o.length===1,h=Dt(0,0,0);for(let d=0;d<e.length;d+=3){const x=i[e[d+0]],w=i[e[d+1]],T=i[e[d+2]],I=a?o[0]:o[e[d+1]],P=a?o[0]:o[e[d+2]],R=this.addVertex(Dt(x.x,x.y,a?o[0]:o[e[d+0]]),h),F=this.addVertex(Dt(w.x,w.y,I),h),N=this.addVertex(Dt(T.x,T.y,P),h);this.outIndices.emplaceBack(R,F,N)}}else for(let a=0;a<e.length;a+=3)this.outIndices.emplaceBack(e[a+0],e[a+1],e[a+2])}addQuad(e,i){const o=this.addVertices(i,void 0,...e.map(w=>Dt(w.coord.x,w.coord.y,w.height))),[a,h,d,x]=o;this.addTriangles([a,h,d,d,x,a])}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class Wa{constructor(e,i,o,a){this.unevaluatedPortals=new rp,this.portalPolygons=new E1,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Vf,this.vertexNormals=new Zd,this.indexArray=new Yr,this.tileToMeters=Xe(e),this.bridgeProgramConfigurations=new l(i,{zoom:o,lut:a},h=>h!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new l(i,{zoom:o,lut:a},h=>h!=="fill-bridge-guard-rail-color")}addVertices(e,i){const o=this.unevalVertices.length;for(let a=0;a<e.length;a++)this.unevalVertices.push(e[a]),this.unevalHeights.push(i[a]);return o}addTriangles(e,i,o){const a=o?this.unevalTunnelTriangles:this.unevalTriangles;for(const h of e)a.push(h+i)}addRenderableRing(e,i,o,a,h,d){const x=[new Rt(h.min.x,h.min.y),new Rt(h.max.x,h.min.y),new Rt(h.max.x,h.max.y),new Rt(h.min.x,h.max.y)];for(let w=0;w<o-1;w++){const T=i+w,I=T+1,P=this.unevalVertices[T],R=this.unevalVertices[I];if(!(P.x>=h.min.x&&P.x<=h.max.x&&P.y>=h.min.y&&P.y<=h.max.y||R.x>=h.min.x&&R.x<=h.max.x&&R.y>=h.min.y&&R.y<=h.max.y||Ha(P,R,x))||this.isOnBorder(P.x,R.x)||this.isOnBorder(P.y,R.y))continue;const F=Wa.computeEdgeHash(this.unevalVertices[T],this.unevalVertices[I]);let N,H=this.vertexHashLookup.get(Wa.computePosHash(P));H!=null?N=H.next:(H=this.vertexHashLookup.get(Wa.computePosHash(R)),N=H!=null?H.prev:F),this.unevalEdges.push({polygonIdx:e,a:T,b:I,hash:F,portalHash:N,isTunnel:a,type:"unevaluated",featureInfo:d})}}addPortalCandidates(e,i,o,a,h){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:h});const d=i[0];this.vertexHashLookup.clear();let x=Wa.computeEdgeHash(d[d.length-2],d[d.length-1]);for(let w=0;w<d.length-1;w++){const T=d[w+0],I=d[w+1],P=$o(I.x-T.x,I.y-T.y),R=wa(P);if(R===0)continue;let F="unevaluated";const N=a.pointElevation(T),H=a.pointElevation(I);Math.abs(N)<.01&&Math.abs(H)<.01?F="entrance":(this.isOnBorder(T.x,I.x)||this.isOnBorder(T.y,I.y))&&(F="border");const Z=Wa.computeEdgeHash(T,I);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:T,vb:I,vab:P,length:R,hash:Z,isTunnel:o,type:F});const ee=Wa.computePosHash(T);this.vertexHashLookup.set(ee,{prev:x,next:Z}),x=Z}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),o=R=>{R.primitiveLength=this.indexArray.length-R.primitiveOffset},a=new A4(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const h=i(),d=i(),x=i(),w=(R,F)=>{R.sort((H,Z)=>H.type===F&&Z.type!==F?-1:H.type!==F&&Z.type===F?1:0);const N=R.findIndex(H=>H.type!==F);return N>=0?N:R.length};let T=0;this.unevalEdges.length>0&&(T=w(this.unevalEdges,"none"),this.constructBridgeStructures(a,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},this.tileToMeters)),o(x);const I=i(),P=i();if(this.unevalEdges.length>0){const R=this.unevalEdges.splice(T),F=w(R,"tunnel")+T;this.unevalEdges.push(...R),this.constructTunnelStructures(a,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},{min:T,max:F})}o(I),a.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),o(P),a.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),o(d),a.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),o(h),this.maskSegments=Vn.simpleSegment(0,P.primitiveOffset,0,P.primitiveLength),this.depthSegments=Vn.simpleSegment(0,d.primitiveOffset,0,d.primitiveLength),this.renderableBridgeSegments=Vn.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableTunnelSegments=Vn.simpleSegment(0,I.primitiveOffset,0,I.primitiveLength),this.shadowCasterSegments=Vn.simpleSegment(0,h.primitiveOffset,0,h.primitiveLength)}update(e,i,o,a,h,d,x,w){this.bridgeProgramConfigurations.updatePaintArrays(e,i,h,o,a,d,x,w),this.tunnelProgramConfigurations.updatePaintArrays(e,i,h,o,a,d,x,w)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,m4.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,g4.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,o,a,h){const d=(x,w)=>{for(let T=0;T<w.length-1;T++){const I=w[T].featureIndex,P=w[T+1].vertexStart,R=e.feature(I);x.populatePaintArrays(P,R,I,{},o,i,a,void 0,h)}};d(this.bridgeProgramConfigurations,this.bridgeFeatureSections),d(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,o,a,h){const d=new Map;for(let x=a;x<h;x++){const w=o[x],T=w.a,I=w.b,P=Wa.computePosHash(e[T]),R=Wa.computePosHash(e[I]);d.has(P)||d.set(P,{}),d.has(R)||d.set(R,{});const F=d.get(P),N=d.get(R);i[T]<=0&&i[I]<=0||(F.to=I,N.from=T)}return d}constructBridgeStructures(e,i,o,a,h,d){e.clearVertexLookup();const x=this.computeVertexConnections(i,o,a,h.min,h.max),w=1/d,T=.5*w,I=F=>Dt(i[F].x,i[F].y,o[F]*w),P=F=>{const N=x.get(Wa.computePosHash(i[F])),H=N.from,Z=N.to;if(!H||!Z)return;const ee=I(H),oe=I(F),ae=I(Z),q=Dt(0,0,0);if(!Rs(ee,oe)){const le=xr(Ht(),oe,ee);Ci(q,q,Di(le,le))}if(!Rs(ae,oe)){const le=xr(Ht(),ae,oe);Ci(q,q,Di(le,le))}const re=Go(q);return re>0?Kt(q,q,1/re):void 0};let R=Number.POSITIVE_INFINITY;this.sortSubarray(a,h.min,h.max,(F,N)=>F.featureInfo.featureIndex-N.featureInfo.featureIndex);for(let F=h.min;F<h.max;F++){const N=a[F];if(!N.featureInfo.guardRailEnabled)continue;const H=this.prepareEdgePoints(i,o,N,(Mi,ti)=>Mi>ti);if(H==null)continue;const Z=H[0],ee=H[1],oe=Dt(Z.coord.x,Z.coord.y,w*Z.height),ae=Dt(ee.coord.x,ee.coord.y,w*ee.height);if(Rs(oe,ae))continue;const q=xr(Ht(),ae,oe);Di(q,q);const re=Mi=>Di(Mi,Mi),le=P(N.a)||q,fe=P(N.b)||q,Me=re(Dt(le[1],-le[0],0)),Ce=re(Dt(fe[1],-fe[0],0)),Re=re(fn(Ht(),Me,le)),Ne=re(fn(Ht(),Ce,fe)),Je=Ht(),gt=[Ci(Ht(),oe,Kt(Je,xr(Je,Me,Re),T)),Ci(Ht(),oe,Kt(Je,Ci(Je,Me,Re),T)),Ci(Ht(),oe,Kt(Je,Re,T)),oe],ct=[Ci(Ht(),ae,Kt(Je,xr(Je,Ce,Ne),T)),Ci(Ht(),ae,Kt(Je,Ci(Je,Ce,Ne),T)),Ci(Ht(),ae,Kt(Je,Ne,T)),ae];R=this.addFeatureSection(N.featureInfo.featureIndex,R,this.bridgeFeatureSections,e);const[mt,xt]=e.addVertices(Me,d,gt[0],gt[1]),[tt,ft]=e.addVertices(Ce,d,ct[0],ct[1]);e.addTriangles([mt,xt,tt,xt,ft,tt]);const[Ke,Qe]=e.addVertices(Re,d,gt[1],gt[2]),[Ct,At]=e.addVertices(Ne,d,ct[1],ct[2]);e.addTriangles([Ke,Qe,Ct,Qe,At,Ct]);const[hi,ii]=e.addVertices(ln(Me,Me),d,gt[2],gt[3]),[Ut,St]=e.addVertices(ln(Ce,Ce),d,ct[2],ct[3]);e.addTriangles([hi,ii,Ut,ii,St,Ut])}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,o,a,h,d){e.clearVertexLookup();let x=Number.POSITIVE_INFINITY;const w=(I,P)=>I.featureInfo.featureIndex-P.featureInfo.featureIndex;this.sortSubarray(a,h.min,h.max,w),this.sortSubarray(a,d.min,d.max,w);const T=I=>Di(I,I);for(let I=h.min;I<h.max;I++){const P=this.prepareEdgePoints(i,o,a[I],(H,Z)=>H<Z);if(P==null)continue;const[R,F]=P,N=T(Dt(-(F.coord.y-R.coord.y),F.coord.x-R.coord.x,0));x=this.addFeatureSection(a[I].featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad([R,F,{coord:F.coord,height:a[I].isTunnel?-.1:0},{coord:R.coord,height:a[I].isTunnel?-.1:0}],N)}for(let I=d.min;I<d.max;I++){const P=a[I];P.isTunnel&&([P.a,P.b]=[P.b,P.a]);const R=i[P.a],F=i[P.b],N=T(Dt(-(F.y-R.y),F.x-R.x,0));x=this.addFeatureSection(P.featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad([{coord:F,height:0},{coord:R,height:0},{coord:R,height:o[P.a]+4},{coord:F,height:o[P.b]+4}],N),e.addQuad([{coord:R,height:0},{coord:F,height:0},{coord:F,height:o[P.b]+4},{coord:R,height:o[P.a]+4}],N)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}prepareEdgePoints(e,i,o,a){let h=i[o.a],d=i[o.b];const x=a(h,0),w=a(d,0);if(x&&w)return[{coord:e[o.a],height:h},{coord:e[o.b],height:d}];if(!x&&!w)return;const T=e[o.a].clone(),I=e[o.b].clone();if(x){if(!w){const P=d/(d-h);I.x=gi(I.x,T.x,P),I.y=gi(I.y,T.y,P),d=gi(d,h,P)}}else{const P=h/(h-d);T.x=gi(T.x,I.x,P),T.y=gi(T.y,I.y,P),h=gi(h,d,P)}return[{coord:T,height:h},{coord:I,height:d}]}prepareEdges(e,i){if(i.length===0)return;i.sort((x,w)=>x.hash===w.hash?w.polygonIdx-x.polygonIdx:w.hash>x.hash?1:-1);let o=0,a=0,h=0,d=i[o].polygonIdx;do a++,(a===i.length||i[o].hash!==i[a].hash)&&((a-o==1||i[a-1].polygonIdx!==d)&&(h<o&&(i[h]=i[o],i[o]=null),i[h].type="none",h++),o=a,o!==i.length&&(d=i[o].polygonIdx));while(o!==i.length);if(i.splice(h),i.length!==0&&e.length!==0){i.sort((T,I)=>T.portalHash<I.portalHash?1:-1);let x=0,w=0;for(;x!==i.length&&w!==e.length;){const T=i[x],I=e[w];T.portalHash>I.hash?x++:I.hash>T.portalHash?w++:(T.type=I.type,x++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=Lt&&i>=Lt}addFeatureSection(e,i,o,a){return e!==i&&(i=e,o.push({featureIndex:e,vertexStart:a.getVertexCount()}),a.clearVertexLookup()),i}sortSubarray(e,i,o,a){const h=e.slice(i,o);h.sort(a),e.splice(i,h.length,...h)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Wa.computePosHash(e))<<32n|BigInt(Wa.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var C1,A1={exports:{}},I1=(C1||(C1=1,function(n,e){(function(i){function o(he,ye){return he>ye?1:he<ye?-1:0}var a=function(he,ye){he===void 0&&(he=o),ye===void 0&&(ye=!1),this._compare=he,this._root=null,this._size=0,this._noDuplicates=!!ye},h={size:{configurable:!0}};function d(he,ye,rt,Pt,Gt){var Vt=Gt-Pt;if(Vt>0){var Qt=Pt+Math.floor(Vt/2),bi={key:ye[Qt],data:rt[Qt],parent:he};return bi.left=d(bi,ye,rt,Pt,Qt),bi.right=d(bi,ye,rt,Qt+1,Gt),bi}return null}function x(he,ye,rt,Pt,Gt){if(!(rt>=Pt)){for(var Vt=he[rt+Pt>>1],Qt=rt-1,bi=Pt+1;;){do Qt++;while(Gt(he[Qt],Vt)<0);do bi--;while(Gt(he[bi],Vt)>0);if(Qt>=bi)break;var rn=he[Qt];he[Qt]=he[bi],he[bi]=rn,rn=ye[Qt],ye[Qt]=ye[bi],ye[bi]=rn}x(he,ye,rt,bi,Gt),x(he,ye,bi+1,Pt,Gt)}}a.prototype.rotateLeft=function(he){var ye=he.right;ye&&(he.right=ye.left,ye.left&&(ye.left.parent=he),ye.parent=he.parent),he.parent?he===he.parent.left?he.parent.left=ye:he.parent.right=ye:this._root=ye,ye&&(ye.left=he),he.parent=ye},a.prototype.rotateRight=function(he){var ye=he.left;ye&&(he.left=ye.right,ye.right&&(ye.right.parent=he),ye.parent=he.parent),he.parent?he===he.parent.left?he.parent.left=ye:he.parent.right=ye:this._root=ye,ye&&(ye.right=he),he.parent=ye},a.prototype._splay=function(he){for(;he.parent;){var ye=he.parent;ye.parent?ye.left===he&&ye.parent.left===ye?(this.rotateRight(ye.parent),this.rotateRight(ye)):ye.right===he&&ye.parent.right===ye?(this.rotateLeft(ye.parent),this.rotateLeft(ye)):ye.left===he&&ye.parent.right===ye?(this.rotateRight(ye),this.rotateLeft(ye)):(this.rotateLeft(ye),this.rotateRight(ye)):ye.left===he?this.rotateRight(ye):this.rotateLeft(ye)}},a.prototype.splay=function(he){for(var ye,rt,Pt,Gt,Vt;he.parent;)(rt=(ye=he.parent).parent)&&rt.parent?((Pt=rt.parent).left===rt?Pt.left=he:Pt.right=he,he.parent=Pt):(he.parent=null,this._root=he),Gt=he.left,Vt=he.right,he===ye.left?(rt&&(rt.left===ye?(ye.right?(rt.left=ye.right,rt.left.parent=rt):rt.left=null,ye.right=rt,rt.parent=ye):(Gt?(rt.right=Gt,Gt.parent=rt):rt.right=null,he.left=rt,rt.parent=he)),Vt?(ye.left=Vt,Vt.parent=ye):ye.left=null,he.right=ye,ye.parent=he):(rt&&(rt.right===ye?(ye.left?(rt.right=ye.left,rt.right.parent=rt):rt.right=null,ye.left=rt,rt.parent=ye):(Vt?(rt.left=Vt,Vt.parent=rt):rt.left=null,he.right=rt,rt.parent=he)),Gt?(ye.right=Gt,Gt.parent=ye):ye.right=null,he.left=ye,ye.parent=he)},a.prototype.replace=function(he,ye){he.parent?he===he.parent.left?he.parent.left=ye:he.parent.right=ye:this._root=ye,ye&&(ye.parent=he.parent)},a.prototype.minNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.left;)he=he.left;return he},a.prototype.maxNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.right;)he=he.right;return he},a.prototype.insert=function(he,ye){var rt=this._root,Pt=null,Gt=this._compare;if(this._noDuplicates)for(;rt;){if(Pt=rt,Gt(rt.key,he)===0)return;rt=Gt(rt.key,he)<0?rt.right:rt.left}else for(;rt;)Pt=rt,rt=Gt(rt.key,he)<0?rt.right:rt.left;return rt={key:he,data:ye,left:null,right:null,parent:Pt},Pt?Gt(Pt.key,rt.key)<0?Pt.right=rt:Pt.left=rt:this._root=rt,this.splay(rt),this._size++,rt},a.prototype.find=function(he){for(var ye=this._root,rt=this._compare;ye;){var Pt=rt(ye.key,he);if(Pt<0)ye=ye.right;else{if(!(Pt>0))return ye;ye=ye.left}}return null},a.prototype.contains=function(he){for(var ye=this._root,rt=this._compare;ye;){var Pt=rt(he,ye.key);if(Pt===0)return!0;ye=Pt<0?ye.left:ye.right}return!1},a.prototype.remove=function(he){var ye=this.find(he);if(!ye)return!1;if(this.splay(ye),ye.left)if(ye.right){var rt=this.minNode(ye.right);rt.parent!==ye&&(this.replace(rt,rt.right),rt.right=ye.right,rt.right.parent=rt),this.replace(ye,rt),rt.left=ye.left,rt.left.parent=rt}else this.replace(ye,ye.left);else this.replace(ye,ye.right);return this._size--,!0},a.prototype.removeNode=function(he){if(!he)return!1;if(this.splay(he),he.left)if(he.right){var ye=this.minNode(he.right);ye.parent!==he&&(this.replace(ye,ye.right),ye.right=he.right,ye.right.parent=ye),this.replace(he,ye),ye.left=he.left,ye.left.parent=ye}else this.replace(he,he.left);else this.replace(he,he.right);return this._size--,!0},a.prototype.erase=function(he){var ye=this.find(he);if(ye){this.splay(ye);var rt=ye.left,Pt=ye.right,Gt=null;rt&&(rt.parent=null,Gt=this.maxNode(rt),this.splay(Gt),this._root=Gt),Pt&&(rt?Gt.right=Pt:this._root=Pt,Pt.parent=Gt),this._size--}},a.prototype.pop=function(){var he=this._root,ye=null;if(he){for(;he.left;)he=he.left;ye={key:he.key,data:he.data},this.remove(he.key)}return ye},a.prototype.next=function(he){var ye=he;if(ye)if(ye.right)for(ye=ye.right;ye&&ye.left;)ye=ye.left;else for(ye=he.parent;ye&&ye.right===he;)he=ye,ye=ye.parent;return ye},a.prototype.prev=function(he){var ye=he;if(ye)if(ye.left)for(ye=ye.left;ye&&ye.right;)ye=ye.right;else for(ye=he.parent;ye&&ye.left===he;)he=ye,ye=ye.parent;return ye},a.prototype.forEach=function(he){for(var ye=this._root,rt=[],Pt=!1,Gt=0;!Pt;)ye?(rt.push(ye),ye=ye.left):rt.length>0?(he(ye=rt.pop(),Gt++),ye=ye.right):Pt=!0;return this},a.prototype.range=function(he,ye,rt,Pt){for(var Gt=[],Vt=this._compare,Qt=this._root;Gt.length!==0||Qt;)if(Qt)Gt.push(Qt),Qt=Qt.left;else{if(Vt((Qt=Gt.pop()).key,ye)>0)break;if(Vt(Qt.key,he)>=0&&rt.call(Pt,Qt))return this;Qt=Qt.right}return this},a.prototype.keys=function(){for(var he=this._root,ye=[],rt=[],Pt=!1;!Pt;)he?(ye.push(he),he=he.left):ye.length>0?(he=ye.pop(),rt.push(he.key),he=he.right):Pt=!0;return rt},a.prototype.values=function(){for(var he=this._root,ye=[],rt=[],Pt=!1;!Pt;)he?(ye.push(he),he=he.left):ye.length>0?(he=ye.pop(),rt.push(he.data),he=he.right):Pt=!0;return rt},a.prototype.at=function(he){for(var ye=this._root,rt=[],Pt=!1,Gt=0;!Pt;)if(ye)rt.push(ye),ye=ye.left;else if(rt.length>0){if(ye=rt.pop(),Gt===he)return ye;Gt++,ye=ye.right}else Pt=!0;return null},a.prototype.load=function(he,ye,rt){if(he===void 0&&(he=[]),ye===void 0&&(ye=[]),rt===void 0&&(rt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Pt=he.length;return rt&&x(he,ye,0,Pt-1,this._compare),this._root=d(null,he,ye,0,Pt),this._size=Pt,this},a.prototype.min=function(){var he=this.minNode(this._root);return he?he.key:null},a.prototype.max=function(){var he=this.maxNode(this._root);return he?he.key:null},a.prototype.isEmpty=function(){return this._root===null},h.size.get=function(){return this._size},a.createTree=function(he,ye,rt,Pt,Gt){return new a(rt,Gt).load(he,ye,Pt)},Object.defineProperties(a.prototype,h);var w=0,T=1,I=2,P=3,R=0,F=1,N=2,H=3;function Z(he,ye,rt){ye===null?(he.inOut=!1,he.otherInOut=!0):(he.isSubject===ye.isSubject?(he.inOut=!ye.inOut,he.otherInOut=ye.otherInOut):(he.inOut=!ye.otherInOut,he.otherInOut=ye.isVertical()?!ye.inOut:ye.inOut),ye&&(he.prevInResult=!ee(ye,rt)||ye.isVertical()?ye.prevInResult:ye));var Pt=ee(he,rt);he.resultTransition=Pt?function(Gt,Vt){var Qt,bi=!Gt.inOut,rn=!Gt.otherInOut;switch(Vt){case R:Qt=bi&&rn;break;case F:Qt=bi||rn;break;case H:Qt=bi^rn;break;case N:Qt=Gt.isSubject?bi&&!rn:rn&&!bi}return Qt?1:-1}(he,rt):0}function ee(he,ye){switch(he.type){case w:switch(ye){case R:return!he.otherInOut;case F:return he.otherInOut;case N:return he.isSubject&&he.otherInOut||!he.isSubject&&!he.otherInOut;case H:return!0}break;case I:return ye===R||ye===F;case P:return ye===N;case T:return!1}return!1}var oe=function(he,ye,rt,Pt,Gt){this.left=ye,this.point=he,this.otherEvent=rt,this.isSubject=Pt,this.type=Gt||w,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ae={inResult:{configurable:!0}};function q(he,ye){return he[0]===ye[0]&&he[1]===ye[1]}oe.prototype.isBelow=function(he){var ye=this.point,rt=this.otherEvent.point;return this.left?(ye[0]-he[0])*(rt[1]-he[1])-(rt[0]-he[0])*(ye[1]-he[1])>0:(rt[0]-he[0])*(ye[1]-he[1])-(ye[0]-he[0])*(rt[1]-he[1])>0},oe.prototype.isAbove=function(he){return!this.isBelow(he)},oe.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ae.inResult.get=function(){return this.resultTransition!==0},oe.prototype.clone=function(){var he=new oe(this.point,this.left,this.otherEvent,this.isSubject,this.type);return he.contourId=this.contourId,he.resultTransition=this.resultTransition,he.prevInResult=this.prevInResult,he.isExteriorRing=this.isExteriorRing,he.inOut=this.inOut,he.otherInOut=this.otherInOut,he},Object.defineProperties(oe.prototype,ae);var re=11102230246251565e-32,le=134217729,fe=(3+8*re)*re;function Me(he,ye,rt,Pt,Gt){var Vt,Qt,bi,rn,sn=ye[0],Gi=Pt[0],Fn=0,Jn=0;Gi>sn==Gi>-sn?(Vt=sn,sn=ye[++Fn]):(Vt=Gi,Gi=Pt[++Jn]);var on=0;if(Fn<he&&Jn<rt)for(Gi>sn==Gi>-sn?(bi=Vt-((Qt=sn+Vt)-sn),sn=ye[++Fn]):(bi=Vt-((Qt=Gi+Vt)-Gi),Gi=Pt[++Jn]),Vt=Qt,bi!==0&&(Gt[on++]=bi);Fn<he&&Jn<rt;)Gi>sn==Gi>-sn?(bi=Vt-((Qt=Vt+sn)-(rn=Qt-Vt))+(sn-rn),sn=ye[++Fn]):(bi=Vt-((Qt=Vt+Gi)-(rn=Qt-Vt))+(Gi-rn),Gi=Pt[++Jn]),Vt=Qt,bi!==0&&(Gt[on++]=bi);for(;Fn<he;)bi=Vt-((Qt=Vt+sn)-(rn=Qt-Vt))+(sn-rn),sn=ye[++Fn],Vt=Qt,bi!==0&&(Gt[on++]=bi);for(;Jn<rt;)bi=Vt-((Qt=Vt+Gi)-(rn=Qt-Vt))+(Gi-rn),Gi=Pt[++Jn],Vt=Qt,bi!==0&&(Gt[on++]=bi);return Vt===0&&on!==0||(Gt[on++]=Vt),on}function Ce(he){return new Float64Array(he)}var Re=33306690738754716e-32,Ne=22204460492503146e-32,Je=11093356479670487e-47,gt=Ce(4),ct=Ce(8),mt=Ce(12),xt=Ce(16),tt=Ce(4);function ft(he,ye,rt){var Pt=function(Gt,Vt,Qt,bi,rn,sn){var Gi=(Vt-sn)*(Qt-rn),Fn=(Gt-rn)*(bi-sn),Jn=Gi-Fn;if(Gi===0||Fn===0||Gi>0!=Fn>0)return Jn;var on=Math.abs(Gi+Fn);return Math.abs(Jn)>=Re*on?Jn:-function(wr,rr,kn,Ar,or,Qn,sr){var On,qi,jn,br,_i,gn,ar,Sr,hr,Gr,$n,Br,Jo,Js,Os,Qo,oh,$r,ss=wr-or,Qs=kn-or,Po=rr-Qn,fo=Ar-Qn;gt[0]=(Os=(Sr=ss-(ar=(gn=le*ss)-(gn-ss)))*(Gr=fo-(hr=(gn=le*fo)-(gn-fo)))-((Js=ss*fo)-ar*hr-Sr*hr-ar*Gr))-(($n=Os-(oh=(Sr=Po-(ar=(gn=le*Po)-(gn-Po)))*(Gr=Qs-(hr=(gn=le*Qs)-(gn-Qs)))-((Qo=Po*Qs)-ar*hr-Sr*hr-ar*Gr)))+(_i=Os-$n))+(_i-oh),gt[1]=(Jo=Js-((Br=Js+$n)-(_i=Br-Js))+($n-_i))-(($n=Jo-Qo)+(_i=Jo-$n))+(_i-Qo),gt[2]=Br-(($r=Br+$n)-(_i=$r-Br))+($n-_i),gt[3]=$r;var mf=function(uO,O2){for(var N2=O2[0],J0=1;J0<4;J0++)N2+=O2[J0];return N2}(0,gt),dg=Ne*sr;if(mf>=dg||-mf>=dg||(On=wr-(ss+(_i=wr-ss))+(_i-or),jn=kn-(Qs+(_i=kn-Qs))+(_i-or),qi=rr-(Po+(_i=rr-Po))+(_i-Qn),br=Ar-(fo+(_i=Ar-fo))+(_i-Qn),On===0&&qi===0&&jn===0&&br===0)||(dg=Je*sr+fe*Math.abs(mf),(mf+=ss*br+fo*On-(Po*jn+Qs*qi))>=dg||-mf>=dg))return mf;tt[0]=(Os=(Sr=On-(ar=(gn=le*On)-(gn-On)))*(Gr=fo-(hr=(gn=le*fo)-(gn-fo)))-((Js=On*fo)-ar*hr-Sr*hr-ar*Gr))-(($n=Os-(oh=(Sr=qi-(ar=(gn=le*qi)-(gn-qi)))*(Gr=Qs-(hr=(gn=le*Qs)-(gn-Qs)))-((Qo=qi*Qs)-ar*hr-Sr*hr-ar*Gr)))+(_i=Os-$n))+(_i-oh),tt[1]=(Jo=Js-((Br=Js+$n)-(_i=Br-Js))+($n-_i))-(($n=Jo-Qo)+(_i=Jo-$n))+(_i-Qo),tt[2]=Br-(($r=Br+$n)-(_i=$r-Br))+($n-_i),tt[3]=$r;var mP=Me(4,gt,4,tt,ct);tt[0]=(Os=(Sr=ss-(ar=(gn=le*ss)-(gn-ss)))*(Gr=br-(hr=(gn=le*br)-(gn-br)))-((Js=ss*br)-ar*hr-Sr*hr-ar*Gr))-(($n=Os-(oh=(Sr=Po-(ar=(gn=le*Po)-(gn-Po)))*(Gr=jn-(hr=(gn=le*jn)-(gn-jn)))-((Qo=Po*jn)-ar*hr-Sr*hr-ar*Gr)))+(_i=Os-$n))+(_i-oh),tt[1]=(Jo=Js-((Br=Js+$n)-(_i=Br-Js))+($n-_i))-(($n=Jo-Qo)+(_i=Jo-$n))+(_i-Qo),tt[2]=Br-(($r=Br+$n)-(_i=$r-Br))+($n-_i),tt[3]=$r;var gP=Me(mP,ct,4,tt,mt);tt[0]=(Os=(Sr=On-(ar=(gn=le*On)-(gn-On)))*(Gr=br-(hr=(gn=le*br)-(gn-br)))-((Js=On*br)-ar*hr-Sr*hr-ar*Gr))-(($n=Os-(oh=(Sr=qi-(ar=(gn=le*qi)-(gn-qi)))*(Gr=jn-(hr=(gn=le*jn)-(gn-jn)))-((Qo=qi*jn)-ar*hr-Sr*hr-ar*Gr)))+(_i=Os-$n))+(_i-oh),tt[1]=(Jo=Js-((Br=Js+$n)-(_i=Br-Js))+($n-_i))-(($n=Jo-Qo)+(_i=Jo-$n))+(_i-Qo),tt[2]=Br-(($r=Br+$n)-(_i=$r-Br))+($n-_i),tt[3]=$r;var _P=Me(gP,mt,4,tt,xt);return xt[_P-1]}(Gt,Vt,Qt,bi,rn,sn,on)}(he[0],he[1],ye[0],ye[1],rt[0],rt[1]);return Pt>0?-1:Pt<0?1:0}function Ke(he,ye){var rt=he.point,Pt=ye.point;return rt[0]>Pt[0]?1:rt[0]<Pt[0]?-1:rt[1]!==Pt[1]?rt[1]>Pt[1]?1:-1:function(Gt,Vt,Qt,bi){return Gt.left!==Vt.left?Gt.left?1:-1:ft(Qt,Gt.otherEvent.point,Vt.otherEvent.point)!==0?Gt.isBelow(Vt.otherEvent.point)?-1:1:!Gt.isSubject&&Vt.isSubject?1:-1}(he,ye,rt)}function Qe(he,ye,rt){var Pt=new oe(ye,!1,he,he.isSubject),Gt=new oe(ye,!0,he.otherEvent,he.isSubject);return q(he.point,he.otherEvent.point)&&console.warn("what is that, a collapsed segment?",he),Pt.contourId=Gt.contourId=he.contourId,Ke(Gt,he.otherEvent)>0&&(he.otherEvent.left=!0,Gt.left=!1),he.otherEvent.otherEvent=Gt,he.otherEvent=Pt,rt.push(Gt),rt.push(Pt),rt}function Ct(he,ye){return he[0]*ye[1]-he[1]*ye[0]}function At(he,ye){return he[0]*ye[0]+he[1]*ye[1]}function hi(he,ye,rt){var Pt=function(rn,sn,Gi,Fn,Jn){var on=[sn[0]-rn[0],sn[1]-rn[1]],wr=[Fn[0]-Gi[0],Fn[1]-Gi[1]];function rr(gn,ar,Sr){return[gn[0]+ar*Sr[0],gn[1]+ar*Sr[1]]}var kn=[Gi[0]-rn[0],Gi[1]-rn[1]],Ar=Ct(on,wr),or=Ar*Ar,Qn=At(on,on);if(or>0){var sr=Ct(kn,wr)/Ar;if(sr<0||sr>1)return null;var On=Ct(kn,on)/Ar;return On<0||On>1?null:sr===0||sr===1?[rr(rn,sr,on)]:On===0||On===1?[rr(Gi,On,wr)]:[rr(rn,sr,on)]}if((or=(Ar=Ct(kn,on))*Ar)>0)return null;var qi=At(on,kn)/Qn,jn=qi+At(on,wr)/Qn,br=Math.min(qi,jn),_i=Math.max(qi,jn);return br<=1&&_i>=0?br===1?[rr(rn,br>0?br:0,on)]:_i===0?[rr(rn,_i<1?_i:1,on)]:[rr(rn,br>0?br:0,on),rr(rn,_i<1?_i:1,on)]:null}(he.point,he.otherEvent.point,ye.point,ye.otherEvent.point),Gt=Pt?Pt.length:0;if(Gt===0||Gt===1&&(q(he.point,ye.point)||q(he.otherEvent.point,ye.otherEvent.point))||Gt===2&&he.isSubject===ye.isSubject)return 0;if(Gt===1)return q(he.point,Pt[0])||q(he.otherEvent.point,Pt[0])||Qe(he,Pt[0],rt),q(ye.point,Pt[0])||q(ye.otherEvent.point,Pt[0])||Qe(ye,Pt[0],rt),1;var Vt=[],Qt=!1,bi=!1;return q(he.point,ye.point)?Qt=!0:Ke(he,ye)===1?Vt.push(ye,he):Vt.push(he,ye),q(he.otherEvent.point,ye.otherEvent.point)?bi=!0:Ke(he.otherEvent,ye.otherEvent)===1?Vt.push(ye.otherEvent,he.otherEvent):Vt.push(he.otherEvent,ye.otherEvent),Qt&&bi||Qt?(ye.type=T,he.type=ye.inOut===he.inOut?I:P,Qt&&!bi&&Qe(Vt[1].otherEvent,Vt[0].point,rt),2):bi?(Qe(Vt[0],Vt[1].point,rt),3):Vt[0]!==Vt[3].otherEvent?(Qe(Vt[0],Vt[1].point,rt),Qe(Vt[1],Vt[2].point,rt),3):(Qe(Vt[0],Vt[1].point,rt),Qe(Vt[3].otherEvent,Vt[2].point,rt),3)}function ii(he,ye){if(he===ye)return 0;if(ft(he.point,he.otherEvent.point,ye.point)!==0||ft(he.point,he.otherEvent.point,ye.otherEvent.point)!==0)return q(he.point,ye.point)?he.isBelow(ye.otherEvent.point)?-1:1:he.point[0]===ye.point[0]?he.point[1]<ye.point[1]?-1:1:Ke(he,ye)===1?ye.isAbove(he.point)?-1:1:he.isBelow(ye.point)?-1:1;if(he.isSubject!==ye.isSubject)return he.isSubject?-1:1;var rt=he.point,Pt=ye.point;return rt[0]===Pt[0]&&rt[1]===Pt[1]?(rt=he.otherEvent.point)[0]===(Pt=ye.otherEvent.point)[0]&&rt[1]===Pt[1]?0:he.contourId>ye.contourId?1:-1:Ke(he,ye)===1?1:-1}var Ut=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function St(he,ye,rt,Pt){var Gt,Vt=he+1,Qt=ye[he].point,bi=ye.length;for(Vt<bi&&(Gt=ye[Vt].point);Vt<bi&&Gt[0]===Qt[0]&&Gt[1]===Qt[1];){if(!rt[Vt])return Vt;++Vt<bi&&(Gt=ye[Vt].point)}for(Vt=he-1;rt[Vt]&&Vt>Pt;)Vt--;return Vt}Ut.prototype.isExterior=function(){return this.holeOf==null};var Mi=ni,ti=ni;function ni(he,ye){if(!(this instanceof ni))return new ni(he,ye);if(this.data=he||[],this.length=this.data.length,this.compare=ye||Ti,this.length>0)for(var rt=(this.length>>1)-1;rt>=0;rt--)this._down(rt)}function Ti(he,ye){return he<ye?-1:he>ye?1:0}ni.prototype={push:function(he){this.data.push(he),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var he=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),he}},peek:function(){return this.data[0]},_up:function(he){for(var ye=this.data,rt=this.compare,Pt=ye[he];he>0;){var Gt=he-1>>1,Vt=ye[Gt];if(rt(Pt,Vt)>=0)break;ye[he]=Vt,he=Gt}ye[he]=Pt},_down:function(he){for(var ye=this.data,rt=this.compare,Pt=this.length>>1,Gt=ye[he];he<Pt;){var Vt=1+(he<<1),Qt=Vt+1,bi=ye[Vt];if(Qt<this.length&&rt(ye[Qt],bi)<0&&(Vt=Qt,bi=ye[Qt]),rt(bi,Gt)>=0)break;ye[he]=bi,he=Vt}ye[he]=Gt}},Mi.default=ti;var Vi=Math.max,Oi=Math.min,Ki=0;function Ui(he,ye,rt,Pt,Gt,Vt){var Qt,bi,rn,sn,Gi,Fn;for(Qt=0,bi=he.length-1;Qt<bi;Qt++)if(sn=he[Qt+1],Gi=new oe(rn=he[Qt],!1,void 0,ye),Fn=new oe(sn,!1,Gi,ye),Gi.otherEvent=Fn,rn[0]!==sn[0]||rn[1]!==sn[1]){Gi.contourId=Fn.contourId=rt,Vt||(Gi.isExteriorRing=!1,Fn.isExteriorRing=!1),Ke(Gi,Fn)>0?Fn.left=!0:Gi.left=!0;var Jn=rn[0],on=rn[1];Gt[0]=Oi(Gt[0],Jn),Gt[1]=Oi(Gt[1],on),Gt[2]=Vi(Gt[2],Jn),Gt[3]=Vi(Gt[3],on),Pt.push(Gi),Pt.push(Fn)}}var Ji=[];function Rn(he,ye,rt){typeof he[0][0][0]=="number"&&(he=[he]),typeof ye[0][0][0]=="number"&&(ye=[ye]);var Pt=function(on,wr,rr){var kn=null;return on.length*wr.length==0&&(rr===R?kn=Ji:rr===N?kn=on:rr!==F&&rr!==H||(kn=on.length===0?wr:on)),kn}(he,ye,rt);if(Pt)return Pt===Ji?null:Pt;var Gt=[1/0,1/0,-1/0,-1/0],Vt=[1/0,1/0,-1/0,-1/0],Qt=function(on,wr,rr,kn,Ar){var or,Qn,sr,On,qi,jn,br=new Mi(null,Ke);for(sr=0,On=on.length;sr<On;sr++)for(qi=0,jn=(or=on[sr]).length;qi<jn;qi++)(Qn=qi===0)&&Ki++,Ui(or[qi],!0,Ki,br,rr,Qn);for(sr=0,On=wr.length;sr<On;sr++)for(qi=0,jn=(or=wr[sr]).length;qi<jn;qi++)Qn=qi===0,Ar===N&&(Qn=!1),Qn&&Ki++,Ui(or[qi],!1,Ki,br,kn,Qn);return br}(he,ye,Gt,Vt,rt);if(Pt=function(on,wr,rr,kn,Ar){var or=null;return(rr[0]>kn[2]||kn[0]>rr[2]||rr[1]>kn[3]||kn[1]>rr[3])&&(Ar===R?or=Ji:Ar===N?or=on:Ar!==F&&Ar!==H||(or=on.concat(wr))),or}(he,ye,Gt,Vt,rt))return Pt===Ji?null:Pt;for(var bi=function(on){var wr,rr,kn=function(sr){var On,qi,jn,br,_i=[];for(qi=0,jn=sr.length;qi<jn;qi++)((On=sr[qi]).left&&On.inResult||!On.left&&On.otherEvent.inResult)&&_i.push(On);for(var gn=!1;!gn;)for(gn=!0,qi=0,jn=_i.length;qi<jn;qi++)qi+1<jn&&Ke(_i[qi],_i[qi+1])===1&&(br=_i[qi],_i[qi]=_i[qi+1],_i[qi+1]=br,gn=!1);for(qi=0,jn=_i.length;qi<jn;qi++)(On=_i[qi]).otherPos=qi;for(qi=0,jn=_i.length;qi<jn;qi++)(On=_i[qi]).left||(br=On.otherPos,On.otherPos=On.otherEvent.otherPos,On.otherEvent.otherPos=br);return _i}(on),Ar={},or=[],Qn=function(){if(!Ar[wr]){var sr=or.length,On=function(_i,gn,ar){var Sr=new Ut;if(_i.prevInResult!=null){var hr=_i.prevInResult,Gr=hr.outputContourId;if(hr.resultTransition>0){var $n=gn[Gr];if($n.holeOf!=null){var Br=$n.holeOf;gn[Br].holeIds.push(ar),Sr.holeOf=Br,Sr.depth=gn[Gr].depth}else gn[Gr].holeIds.push(ar),Sr.holeOf=Gr,Sr.depth=gn[Gr].depth+1}else Sr.holeOf=null,Sr.depth=gn[Gr].depth}else Sr.holeOf=null,Sr.depth=0;return Sr}(kn[wr],or,sr),qi=function(_i){Ar[_i]=!0,_i<kn.length&&kn[_i]&&(kn[_i].outputContourId=sr)},jn=wr,br=wr;for(On.points.push(kn[wr].point);qi(jn),qi(jn=kn[jn].otherPos),On.points.push(kn[jn].point),!((jn=St(jn,kn,Ar,br))==br||jn>=kn.length)&&kn[jn];);or.push(On)}};for(wr=0,rr=kn.length;wr<rr;wr++)Qn();return or}(function(on,wr,rr,kn,Ar,or){for(var Qn,sr,On,qi=new a(ii),jn=[],br=Math.min(kn[2],Ar[2]);on.length!==0;){var _i=on.pop();if(jn.push(_i),or===R&&_i.point[0]>br||or===N&&_i.point[0]>kn[2])break;if(_i.left){sr=Qn=qi.insert(_i),Qn=Qn!==(On=qi.minNode())?qi.prev(Qn):null,sr=qi.next(sr);var gn=Qn?Qn.key:null;if(Z(_i,gn,or),sr&&hi(_i,sr.key,on)===2&&(Z(_i,gn,or),Z(sr.key,_i,or)),Qn&&hi(Qn.key,_i,on)===2){var ar=Qn;Z(gn,(ar=ar!==On?qi.prev(ar):null)?ar.key:null,or),Z(_i,gn,or)}}else sr=Qn=qi.find(_i=_i.otherEvent),Qn&&sr&&(Qn=Qn!==On?qi.prev(Qn):null,sr=qi.next(sr),qi.remove(_i),sr&&Qn&&hi(Qn.key,sr.key,on))}return jn}(Qt,0,0,Gt,Vt,rt)),rn=[],sn=0;sn<bi.length;sn++){var Gi=bi[sn];if(Gi.isExterior()){for(var Fn=[Gi.points],Jn=0;Jn<Gi.holeIds.length;Jn++)Fn.push(bi[Gi.holeIds[Jn]].points);rn.push(Fn)}}return rn}var nr={UNION:F,DIFFERENCE:N,INTERSECTION:R,XOR:H};i.diff=function(he,ye){return Rn(he,ye,N)},i.intersection=function(he,ye){return Rn(he,ye,R)},i.operations=nr,i.union=function(he,ye){return Rn(he,ye,F)},i.xor=function(he,ye){return Rn(he,ye,H)},Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,A1.exports)),A1.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function r_(n,e,i,o){const a=[],h=o===0?(d,x,w,T,I,P)=>{d.push(new Rt(P,w+(P-x)/(T-x)*(I-w)))}:(d,x,w,T,I,P)=>{d.push(new Rt(x+(P-w)/(I-w)*(T-x),P))};for(const d of n){const x=[];for(const w of d){if(w.length<=2)continue;const T=[];for(let R=0;R<w.length-1;R++){const F=w[R].x,N=w[R].y,H=w[R+1].x,Z=w[R+1].y,ee=o===0?F:N,oe=o===0?H:Z;ee<e?oe>e&&h(T,F,N,H,Z,e):ee>i?oe<i&&h(T,F,N,H,Z,i):T.push(w[R]),oe<e&&ee>=e&&h(T,F,N,H,Z,e),oe>i&&ee<=i&&h(T,F,N,H,Z,i)}let I=w[w.length-1];const P=o===0?I.x:I.y;P>=e&&P<=i&&T.push(I),T.length&&(I=T[T.length-1],T[0].x===I.x&&T[0].y===I.y||T.push(T[0]),x.push(T))}x.length&&a.push(x)}return a}function I4(n,e){const i=Zy(n),o=Zy([e]),a=I1.intersection(i,o);return a==null?[]:P1(a)}function P4(n,e){let o=Zy(n,65536);for(;e.valid();e.next()){const[a,h]=e.get(),d=a.x*65536,x=a.y*65536,w=h.x*65536,T=h.y*65536,I=w-d,P=T-x,R=Math.hypot(I,P),F=Math.trunc(P/R*3),N=-Math.trunc(I/R*3);o=I1.diff(o,[[[d,x],[w,T],[w+F,T+N],[d+F,x+N],[d,x]]])}return P1(o,1/65536)}function Zy(n,e=1){return[n.map(i=>i.map(o=>[o.x*e,o.y*e]))]}function P1(n,e=1){return n.map(i=>i.map((o,a)=>{const h=o.map(d=>new Rt(d[0]*e,d[1]*e).round());return a>0&&h.reverse(),h}))}class Xy{constructor(e,i){this.layoutVertexArray=new Ua,this.indexArray=new Yr,this.lineIndexArray=new _l,this.triangleSegments=new Vn,this.lineSegments=new Vn,this.programConfigurations=new l(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new ml)}update(e,i,o,a,h,d,x,w){this.programConfigurations.updatePaintArrays(e,i,h,o,a,d,x,w)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,f4.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,p4.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,o,a,h,d,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,o,a,h,d,void 0,x)}}class Yy{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new Xy(e,!1),this.elevationBufferData=new Xy(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,o,a){this.hasPattern=Wy("fill",this.layers,this.pixelRatio,i);const h=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:x,id:w,index:T,sourceLayerIndex:I}of e){const P=this.layers[0]._featureFilter.needGeometry,R=Ot(x,P);if(!this.layers[0]._featureFilter.filter(new Pn(this.zoom,{worldview:this.worldview}),R,o))continue;const F=h?h.evaluate(R,{},o,i.availableImages):void 0,N={id:w,properties:x.properties,type:x.type,sourceLayerIndex:I,index:T,geometry:P?R.geometry:Wt(x,o,a),patterns:{},sortKey:F};d.push(N)}h&&d.sort((x,w)=>x.sortKey-w.sortKey);for(const x of d){const{geometry:w,index:T,sourceLayerIndex:I}=x;if(this.hasPattern){const P=qy("fill",this.layers,x,this.zoom,this.pixelRatio,i);this.patternFeatures.push(P)}else this.addFeature(x,w,T,o,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[T].feature,w,T,I,this.index)}}update(e,i,o,a,h,d,x){this.bufferData.update(e,i,o,a,h,d,x,this.worldview),this.elevationBufferData.update(e,i,o,a,h,d,x,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,o,a,h,d,x,this.worldview)}addFeatures(e,i,o,a,h,d){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,o,a,d,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,o,a,h,d=[],x,w){const T=n_(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,T,a,o,w):this.addGeometry(T,this.bufferData),this.bufferData.populatePaintArrays(e,o,h,d,a,x,this.worldview),this.elevationBufferData.populatePaintArrays(e,o,h,d,a,x,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,o,a,h){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,o,a,h,this.worldview))}addElevatedRoadFeature(e,i,o,a,h){const d=new Array,x=Vo.getElevationFeature(e,h);if(!x)return void this.addGeometry(i,this.bufferData);{const T=this.clipPolygonsToTile(i,1);T.length>0&&d.push({polygons:T,elevationFeature:x,elevationTileID:o})}const w={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},o),featureIndex:a};for(const T of d)if(T.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Wa(T.elevationTileID,this.layers,this.zoom,this.lut));const P=T.elevationFeature.isTunnel();let R=0;e.properties.hasOwnProperty(Gn)&&(R=+e.properties[Gn]);for(const F of T.polygons)this.elevatedStructures.addPortalCandidates(T.elevationFeature.id,F,P,T.elevationFeature,R)}T.elevationFeature.constantHeight==null&&(T.polygons=this.prepareElevatedPolygons(T.polygons,T.elevationFeature,T.elevationTileID));const I=new Ur(o,T.elevationTileID);this.addElevatedGeometry(T.polygons,I,T.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,a,w)}}addElevatedGeometry(e,i,o,a,h,d){const x={elevation:o,elevationSampler:i,bias:a,index:h,featureInfo:d},[w,T]=this.addGeometry(e,this.elevationBufferData,x);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:w,max:T}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,w),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,T))}addGeometry(e,i,o){let a=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,d=null;o&&(d=o.elevationSampler.constantElevation(o.elevation,o.bias),d!=null&&(a=d,h=d));const x=(w,T,I)=>{if(o!=null)if(T.push(w),d!=null)i.elevatedLayoutVertexArray.emplaceBack(d),I.push(d);else{const P=o.elevationSampler.pointElevation(w,o.elevation,o.bias);i.elevatedLayoutVertexArray.emplaceBack(P),I.push(P),a=Math.min(a,P),h=Math.max(h,P)}};for(const w of e){let T=0;for(const ae of w)T+=ae.length;const I=i.triangleSegments.prepareSegment(T,i.layoutVertexArray,i.indexArray),P=I.vertexLength,R=[],F=[],N=[],H=[],Z=[],ee=i.layoutVertexArray.length;for(const ae of w){if(ae.length===0)continue;ae!==w[0]&&F.push(R.length/2);const q=i.lineSegments.prepareSegment(ae.length,i.layoutVertexArray,i.lineIndexArray),re=q.vertexLength;o&&Z.push(i.layoutVertexArray.length-ee),x(ae[0],N,H),i.layoutVertexArray.emplaceBack(ae[0].x,ae[0].y),i.lineIndexArray.emplaceBack(re+ae.length-1,re),R.push(ae[0].x),R.push(ae[0].y);for(let le=1;le<ae.length;le++)x(ae[le],N,H),i.layoutVertexArray.emplaceBack(ae[le].x,ae[le].y),i.lineIndexArray.emplaceBack(re+le-1,re+le),R.push(ae[le].x),R.push(ae[le].y);q.vertexLength+=ae.length,q.primitiveLength+=ae.length}const oe=Lm(R,F);for(let ae=0;ae<oe.length;ae+=3)i.indexArray.emplaceBack(P+oe[ae],P+oe[ae+1],P+oe[ae+2]);if(oe.length>0&&o&&this.elevationMode==="hd-road-base"){const ae=o.elevation.isTunnel(),q=o.elevation.safeArea,re=this.elevatedStructures.addVertices(N,H);this.elevatedStructures.addTriangles(oe,re,ae);const le=Z.length;if(le>0){for(let fe=0;fe<le-1;fe++)this.elevatedStructures.addRenderableRing(o.index,Z[fe]+re,Z[fe+1]-Z[fe],ae,q,o.featureInfo);this.elevatedStructures.addRenderableRing(o.index,Z[le-1]+re,N.length-Z[le-1],ae,q,o.featureInfo)}}I.vertexLength+=T,I.primitiveLength+=oe.length/3}return[a,h]}prepareElevatedPolygons(e,i,o){const a=1/Xe(o),h=[];for(const d of e){const x=P4(d,new co(i,a));h.push(...x)}return h}clipPolygonsToTile(e,i){const o=-i,a=-i,h=Lt+i,d=Lt+i;let x=0;const w=[],T=[];for(;x<e.length;x++){const R=e[x],F=If(R);(F.min.x>=o&&F.max.x<=h&&F.min.y>=a&&F.max.y<=d?w:T).push(R)}if(w.length===e.length)return e;const I=[new Rt(o,a),new Rt(h,a),new Rt(h,d),new Rt(o,d),new Rt(o,a)],P=w;for(const R of T)P.push(...I4(R,I));return P}}let M1,R1,k1,D1;qt(Yy,"FillBucket",{omit:["layers","patternFeatures"]}),qt(Xy,"FillBufferData"),qt(Wa,"ElevatedStructures");class Ky{constructor(e,i,o,a){if(this.triangleCount=i.length/3,this.min=new Rt(0,0),this.max=new Rt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[h,d]=[e[0].clone(),e[0].clone()];for(let P=1;P<e.length;++P){const R=e[P];h.x=Math.min(h.x,R.x),h.y=Math.min(h.y,R.y),d.x=Math.max(d.x,R.x),d.y=Math.max(d.y,R.y)}if(a){const P=Math.ceil(Math.max(d.x-h.x,d.y-h.y)/a);o=Math.max(o,P)}if(o===0)return;this.min=h,this.max=d;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const w=Math.max(x.x,x.y)/o;this.cellsX=Math.max(1,Math.ceil(x.x/w)),this.cellsY=Math.max(1,Math.ceil(x.y/w)),this.xScale=1/w,this.yScale=1/w;const T=[];for(let P=0;P<this.triangleCount;P++){const R=e[i[3*P+0]].sub(this.min),F=e[i[3*P+1]].sub(this.min),N=e[i[3*P+2]].sub(this.min),H=rh(Math.floor(Math.min(R.x,F.x,N.x)),this.xScale,this.cellsX),Z=rh(Math.floor(Math.max(R.x,F.x,N.x)),this.xScale,this.cellsX),ee=rh(Math.floor(Math.min(R.y,F.y,N.y)),this.yScale,this.cellsY),oe=rh(Math.floor(Math.max(R.y,F.y,N.y)),this.yScale,this.cellsY),ae=new Rt(0,0),q=new Rt(0,0),re=new Rt(0,0),le=new Rt(0,0);for(let fe=ee;fe<=oe;++fe){ae.y=q.y=fe*w,re.y=le.y=(fe+1)*w;for(let Me=H;Me<=Z;++Me)ae.x=re.x=Me*w,q.x=le.x=(Me+1)*w,(Jf(R,F,N,ae,q,le)||Jf(R,F,N,ae,le,re))&&T.push({cellIdx:fe*this.cellsX+Me,triIdx:P})}}if(T.length===0)return;T.sort((P,R)=>P.cellIdx-R.cellIdx||P.triIdx-R.triIdx);let I=0;for(;I<T.length;){const P=T[I].cellIdx,R={start:this.payload.length,len:0};for(;I<T.length&&T[I].cellIdx===P;)++R.len,this.payload.push(T[I++].triIdx);this.cells[P]=R}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=rh(e.x-this.min.x,this.xScale,this.cellsX),a=rh(e.y-this.min.y,this.yScale,this.cellsY),h=this.cells[a*this.cellsX+o];if(h){this._lazyInitLookup();for(let d=0;d<h.len;d++){const x=this.payload[h.start+d],w=Math.floor(x/8),T=1<<x%8;if(!(this.lookup[w]&T)&&(this.lookup[w]|=T,i.push(x),i.length===this.triangleCount))return}}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const a=rh(e.x-this.min.x,this.xScale,this.cellsX),h=rh(i.x-this.min.x,this.xScale,this.cellsX),d=rh(e.y-this.min.y,this.yScale,this.cellsY),x=rh(i.y-this.min.y,this.yScale,this.cellsY);for(let w=d;w<=x;w++)for(let T=a;T<=h;T++){const I=this.cells[w*this.cellsX+T];if(I)for(let P=0;P<I.len;P++){const R=this.payload[I.start+P],F=Math.floor(R/8),N=1<<R%8;if(!(this.lookup[F]&N)&&(this.lookup[F]|=N,o.push(R),o.length===this.triangleCount))return}}}}function rh(n,e,i){return Math.max(0,Math.min(i-1,Math.floor(n*e)))}qt(Ky,"TriangleGridIndex");class L1{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,i){for(const o of this.footprints)i.push({footprint:o,id:e})}populate(e,i,o,a){const h=[];for(const{feature:d,id:x,index:w,sourceLayerIndex:T}of e){const I=this.layers[0]._featureFilter.needGeometry,P=Ot(d,I);if(!this.layers[0]._featureFilter.filter(new Pn(this.zoom,{worldview:this.worldview}),P,o))continue;const R={id:x,properties:d.properties,type:d.type,sourceLayerIndex:T,index:w,geometry:I?P.geometry:Wt(d,o,a),patterns:{}};h.push(R)}for(const d of h){const{geometry:x,index:w,sourceLayerIndex:T}=d;this.addFeature(d,x,w,o,{},i.availableImages,i.brightness),i.featureIndex.insert(e[w].feature,x,w,T,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,o,a,h,d,x){}destroy(){}addFeature(e,i,o,a,h,d=[],x){for(const w of n_(i,2)){const T=[],I=[],P=[],R=new Rt(1/0,1/0),F=new Rt(-1/0,-1/0);for(const Z of w)if(Z.length!==0){Z!==w[0]&&P.push(I.length/2);for(let ee=0;ee<Z.length;ee++)I.push(Z[ee].x),I.push(Z[ee].y),T.push(Z[ee]),R.x=Math.min(R.x,Z[ee].x),R.y=Math.min(R.y,Z[ee].y),F.x=Math.max(F.x,Z[ee].x),F.y=Math.max(F.y,Z[ee].y)}const N=Lm(I,P),H=new Ky(T,N,8,256);this.footprints.push({vertices:T,indices:N,grid:H,min:R,max:F})}}}qt(L1,"ClipBucket",{omit:["layers"]});const M4=hn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),R4=hn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),k4=hn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),D4=hn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),L4=hn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),z4=hn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:F4}=M4,s_=Number.MAX_SAFE_INTEGER;function z1(n,e,i,o){return n.order<e||n.order===s_||!(n.clipMask&i)||function(a,h){return h.length!==0&&h.find(d=>d===a)===void 0}(o,n.clipScope)}function o_(n,e){return n.x-e.x||n.y-e.y}function F1(n,e){return o_(n.min,e.min)===0&&o_(n.max,e.max)===0}function Jy(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function Qy(n,e){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(n[i].sourceId!==e[i].sourceId||!F1(n[i],e[i])||n[i].order!==e[i].order||n[i].clipMask!==e[i].clipMask||!Ta(n[i].clipScope,e[i].clipScope))return!1;return!0}function O1(n,e,i){const o=1/Lt,a=1/(1<<i.canonical.z),h=(e.x*o+i.canonical.x)*a+i.wrap,d=(e.y*o+i.canonical.y)*a;return{min:new Rt((n.x*o+i.canonical.x)*a+i.wrap,(n.y*o+i.canonical.y)*a),max:new Rt(h,d)}}function O4(n,e,i){const o=1<<i.canonical.z,a=((e.x-i.wrap)*o-i.canonical.x)*Lt,h=(e.y*o-i.canonical.y)*Lt;return{min:new Rt(((n.x-i.wrap)*o-i.canonical.x)*Lt,(n.y*o-i.canonical.y)*Lt),max:new Rt(a,h)}}function N1(n,e,i,o,a,h,d){const x=n.indices,w=n.vertices,T=[];for(let I=o;I<o+a;I+=3){const P=e[i[I+0]+h],R=e[i[I+1]+h],F=e[i[I+2]+h],N=Math.min(P.x,R.x,F.x),H=Math.max(P.x,R.x,F.x),Z=Math.min(P.y,R.y,F.y),ee=Math.max(P.y,R.y,F.y);T.length=0,n.grid.query(new Rt(N,Z),new Rt(H,ee),T);for(let oe=0;oe<T.length;oe++){const ae=T[oe];if(Jf(w[x[3*ae+0]],w[x[3*ae+1]],w[x[3*ae+2]],P,R,F,d))return!0}}return!1}function B1(n,e,i,o){if(!n||!i)return!1;let a=n.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<n.vertices.length)return B1(i,o,n,e);const h=e.canonical,d=o.canonical,x=Math.pow(2,d.z-h.z);a=n.vertices.map(w=>new Rt((w.x+h.x*Lt)*x-d.x*Lt,(w.y+h.y*Lt)*x-d.y*Lt))}return N1(i,a,n.indices,0,n.indices.length,0,0)}function j1(n,e,i,o){const a=Math.pow(2,o.z-i.z);return new Rt((n+i.x*Lt)*a-o.x*Lt,(e+i.y*Lt)*a-o.y*Lt)}function V1(n,e){const i=[];e.grid.queryPoint(n,i);const o=e.indices,a=e.vertices;for(let h=0;h<i.length;h++){const d=i[h];if(pa([a[o[3*d+0]],a[o[3*d+1]],a[o[3*d+2]]],n))return!0}return!1}const e0=[new Rt(0,0),new Rt(Lt,0),new Rt(Lt,Lt),new Rt(0,Lt)];function U1(n,e){const i=[];let o=[];if(!e||n.length<2)return[n];if(n.length===2)return Ha(n[0],n[1],e0)?[n]:[];for(let a=0;a<n.length+2;a++){const h=n[a%n.length],d=n[(a+1)%n.length],x=Ha(a===0?n[n.length-1]:n[(a-1)%n.length],h,e0),w=Ha(h,d,e0),T=x||w;T&&o.push(h),T&&w||o.length>0&&(o.length>1&&i.push(o),o=[])}return o.length>1&&i.push(o),i}const t0=Bi.VectorTileFeature.types,N4=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],B4=["fill-extrusion-flood-light-ground-radius"],j4=Math.pow(2,13),V4=Math.pow(2,15)-1,G1=new Rt(0,1),uf=2147483648;function Bm(n,e,i,o,a,h,d,x){n.emplaceBack((e<<1)+d,(i<<1)+h,(Math.floor(o*j4)<<1)+a,Math.round(x))}function jm(n,e,i){n.emplaceBack(e.x*Lt,e.y*Lt,i?1:0)}function a_(n,e,i,o,a,h){n.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+a,h)}function Vm(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class $1{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class H1{constructor(){this.centroidXY=new Rt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Rt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Rt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Rt(this.max.x-this.min.x,this.max.y-this.min.y)}}class W1{constructor(){this.acc=new Rt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let a=!!this.borders;i.x<e.min.x?(e.min.x=i.x,a=!0):i.x>e.max.x&&(e.max.x=i.x,a=!0),i.y<e.min.y?(e.min.y=i.y,a=!0):i.y>e.max.y&&(e.max.y=i.y,a=!0),((i.x===0||i.x===Lt)&&i.x===o.x)!=((i.y===0||i.y===Lt)&&i.y===o.y)&&this.processBorderOverlap(i,o),a&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,gi(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Lt!=e.x>Lt&&this.addBorderIntersection(1,gi(i.y,e.y,(Lt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,gi(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Lt!=e.y>Lt&&this.addBorderIntersection(3,gi(i.x,e.x,(Lt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new Rt(0,0):new Rt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function q1(n,e){const i=n.add(e)._unit(),o=we(n.x*i.x+n.y*i.y,-1,1);var a,h,d;return a=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(a)))/4*V4*((h=n).x*(d=e).y-h.y*d.x<0?-1:1)}const U4=[n=>n.x<0,n=>n.x>Lt,n=>n.y<0,n=>n.y>Lt];function G4(n,e,i,o){const a=[4];if(o===0)return a;i._mult(o);const h=n.sub(i),d=e.sub(i),x=[n,e,h,d];for(let w=0;w<4;w++)for(const T of x)if(U4[w](T)){a.push(w);break}return a}class Z1{constructor(e){this.vertexArray=new Xc,this.indexArray=new Yr,this.programConfigurations=new l(e.layers,{zoom:e.zoom,lut:e.lut},i=>B4.includes(i)),this._segments=new Vn,this.hiddenByLandmarkVertexArray=new Zh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Vn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,a=!1){const h=e.length;if(h>2){let d=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[d].length);let w;d!==this._segments.get().length-1&&(d++,this._segmentToGroundQuads[d]=[],this._segmentToRegionTriCounts[d]=[0,0,0,0,0]);{const T=e[0],I=e[1];w=q1(T.sub(e[h-1])._perp()._unit(),I.sub(T)._perp()._unit())}for(let T=0;T<h;T++){const I=T===h-1?0:T+1,P=e[T],R=e[I],F=e[I===h-1?0:I+1],N=R.sub(P)._perp()._unit(),H=q1(N,F.sub(R)._perp()._unit()),Z=w,ee=H;if(i0(P,R,i)||a&&K1(P,i)&&K1(R,i)){w=H;continue}const oe=x.vertexLength;a_(this.vertexArray,P,R,1,1,Z),a_(this.vertexArray,P,R,1,0,Z),a_(this.vertexArray,P,R,0,1,ee),a_(this.vertexArray,P,R,0,0,ee),x.vertexLength+=4;const ae=G4(P,R,N,o);for(const q of ae)this._segmentToGroundQuads[d].push({id:oe,region:q}),this._segmentToRegionTriCounts[d][q]+=2,x.primitiveLength+=2;w=H}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((a,h)=>a.region-h.region);for(let o=0;o<i;o++){const a=this._segmentToGroundQuads[o],h=e[o],d=this._segmentToRegionTriCounts[o];d.reduce((w,T)=>w+T,0);let x=0;for(let w=0;w<=4;w++){const T=d[w];if(T!==0){let I=this.regionSegments[w];I||(I=this.regionSegments[w]=new Vn);const P={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+x,vertexLength:h.vertexLength,primitiveLength:T};I.get().push(P)}x+=T}for(let w=0;w<a.length;w++){const T=a[w].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,a,h,d,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,a,h,d,void 0,x)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,R4.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,a,h,d,x,w){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,a,h,d,x,w)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const o=e.flags&uf?1:0;for(let a=e.groundVertexArrayOffset;a<i;++a)this.hiddenByLandmarkVertexArray.emplace(a,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,L4.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class l_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Yr,this.footprintVertices=new Ua,this.footprintSegments=[],this.layoutVertexArray=new Xu,this.centroidVertexArray=new Yh,this.wallVertexArray=new Zf,this.indexArray=new Yr,this.programConfigurations=new l(e.layers,{zoom:e.zoom,lut:e.lut},i=>N4.includes(i)),this.segments=new Vn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Z1(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,o,a){this.features=[],this.hasPattern=Wy("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Xe(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:h,id:d,index:x,sourceLayerIndex:w}of e){const T=this.layers[0]._featureFilter.needGeometry,I=Ot(h,T);if(!this.layers[0]._featureFilter.filter(new Pn(this.zoom,{worldview:this.worldview}),I,o))continue;const P={id:d,sourceLayerIndex:w,index:x,geometry:T?I.geometry:Wt(h,o,a),properties:h.properties,type:h.type,patterns:{}},R=this.layoutVertexArray.length,F=t0[P.type]==="Polygon";if(this.hasPattern)this.features.push(qy("fill-extrusion",this.layers,P,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const N of P.geometry)for(const H of U1(N,F))this.addFeature(P,[H],x,o,{},i.availableImages,a,i.brightness);else this.addFeature(P,P.geometry,x,o,{},i.availableImages,a,i.brightness);i.featureIndex.insert(h,P.geometry,x,w,this.index,R)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,a,h,d){for(const x of this.features){const w=t0[x.type]==="Polygon",{geometry:T}=x;if(this.wallMode)for(const I of T)for(const P of U1(I,w))this.addFeature(x,[P],x.index,i,o,a,h,d);else this.addFeature(x,T,x.index,i,o,a,h,d)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,a,h,d,x){this.programConfigurations.updatePaintArrays(e,i,h,o,a,d,x,this.worldview),this.groundEffect.update(e,i,h,o,a,d,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,F4),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,D4.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,z4.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,k4.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,a,h,d,x,w){const T=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,I=[new Rt(0,0),new Rt(Lt,Lt)],P=x.projection,R=P.name==="globe",F=this.wallMode||t0[e.type]==="Polygon",N=new W1;N.centroidDataIndex=this.centroidData.length;const H=new H1,Z=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},a)<=0,ee=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},a);let oe;if(H.height=ee,H.vertexArrayOffset=this.layoutVertexArray.length,H.groundVertexArrayOffset=this.groundEffect.vertexArray.length,R&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Yd),this.wallMode){if(R)return void zi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;oe=function(Re){const Ne=Re[0].x===Re[Re.length-1].x&&Re[0].y===Re[Re.length-1].y;(function(Ut){let St=0;const Mi=Ut.length;for(let ti=0;ti<Mi;ti++)St+=(Ut[(ti+1)%Mi].x-Ut[ti].x)*(Ut[(ti+1)%Mi].y+Ut[ti].y);return St>=0})(Re)||(Re=Re.reverse());const gt={geometry:[],joinNormals:[],indices:[]},ct=[],mt=[],xt=[];let tt=Re.length;for(;tt>=2&&Re[tt-1].equals(Re[tt-2]);)tt--;if(tt<(Ne?3:2))return gt;let ft,Ke,Qe,Ct,At,hi=0;for(;hi<tt-1&&Re[hi].equals(Re[hi+1]);)hi++;Ne&&(ft=Re[tt-2],At=Re[hi].sub(ft)._unit()._perp());for(let Ut=hi;Ut<tt;Ut++){if(Qe=Ut===tt-1?Ne?Re[hi+1]:void 0:Re[Ut+1],Qe&&Re[Ut].equals(Qe))continue;At&&(Ct=At),ft&&(Ke=ft),ft=Re[Ut],At=Qe?Qe.sub(ft)._unit()._perp():Ct,Ct=Ct||At;let St=Ct.add(At);St.x===0&&St.y===0||St._unit();const Mi=St.x*At.x+St.y*At.y,ti=Mi!==0?1/Mi:1/0,ni=Ct.x*At.y-Ct.y*At.x>0;let Ti="miter";const Vi=2;Ti==="miter"&&ti>Vi&&(Ti="bevel"),Ti==="bevel"&&(ti>100&&(Ti="flipbevel"),ti<Vi&&(Ti="miter"));const Oi=(Ki,Ui,Ji,Rn)=>{const nr=new Rt(Ki.x,Ki.y),he=new Rt(Ki.x,Ki.y);nr.x+=Ui.x*Rn,nr.y+=Ui.y*Rn,he.x-=Ui.x*Math.max(Ji,1),he.y-=Ui.y*Math.max(Ji,1),xt.push(Ui),ct.push(nr),mt.push(he)};if(Ti==="miter")St._mult(ti),Oi(ft,St,0,0);else if(Ti==="flipbevel")St=At.mult(-1),Oi(ft,St,0,0),Oi(ft,St.mult(-1),0,0);else{const Ki=-Math.sqrt(ti*ti-1),Ui=ni?Ki:0,Ji=ni?0:Ki;Ke&&Oi(ft,Ct,Ui,Ji),Qe&&Oi(ft,At,Ui,Ji)}}gt.geometry=[...ct,...mt.reverse(),ct[0]],gt.joinNormals=[...xt,...xt.reverse(),xt[xt.length-1]];const ii=gt.geometry.length-1;for(let Ut=0;Ut<ii/2;Ut++)if(Ut+1<ii/2){let St=Ut,Mi=Ut+1,ti=ii-1-Ut,ni=ii-2-Ut;St=St===0?ii-1:St-1,Mi=Mi===0?ii-1:Mi-1,ti=ti===0?ii-1:ti-1,ni=ni===0?ii-1:ni-1,gt.indices.push(ti),gt.indices.push(Mi),gt.indices.push(St),gt.indices.push(ti),gt.indices.push(ni),gt.indices.push(Mi)}return gt}(i[0]),i=[oe.geometry]}const ae=(Re,Ne)=>Re<(Ne.length-1)/2||Re===Ne.length-1,q=this.wallMode?[i]:n_(i,500);for(let Re=q.length-1;Re>=0;Re--){const Ne=q[Re];(Ne.length===0||(re=Ne[0]).every(Je=>Je.x<=0)||re.every(Je=>Je.x>=Lt)||re.every(Je=>Je.y<=0)||re.every(Je=>Je.y>=Lt))&&q.splice(Re,1)}var re;let le;if(R)le=tw(q,I,a);else{le=[];for(const Re of q)le.push({polygon:Re,bounds:I})}const fe=F?this.edgeRadius:0,Me=fe>0&&this.zoom<17,Ce=(Re,Ne)=>{if(Re.length===0)return!1;const Je=Re[Re.length-1];return Ne.x===Je.x&&Ne.y===Je.y};for(const{polygon:Re,bounds:Ne}of le){let Je=0,gt=0;for(const tt of Re)F&&!tt[0].equals(tt[tt.length-1])&&tt.push(tt[0]),gt+=F?tt.length-1:tt.length;const ct=this.segments.prepareSegment((F?5:4)*gt,this.layoutVertexArray,this.indexArray);H.footprintSegIdx<0&&(H.footprintSegIdx=this.footprintSegments.length),H.polygonSegIdx<0&&(H.polygonSegIdx=this.polygonSegments.length);const mt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},xt=new $1;if(xt.vertexOffset=this.footprintVertices.length,xt.indexOffset=3*this.footprintIndices.length,xt.ringIndices=[],F){const tt=[],ft=[];Je=ct.vertexLength;for(let Qe=0;Qe<Re.length;Qe++){const Ct=Re[Qe];Ct.length&&Qe!==0&&ft.push(tt.length/2);const At=[];let hi,ii;hi=Ct[1].sub(Ct[0])._perp()._unit(),xt.ringIndices.push(Ct.length-1);for(let Ut=1;Ut<Ct.length;Ut++){const St=Ct[Ut],Mi=Ct[Ut===Ct.length-1?1:Ut+1],ti=St.clone();if(fe){ii=Mi.sub(St)._perp()._unit();const ni=hi.add(ii)._unit(),Ti=fe*Math.min(4,1/(hi.x*ni.x+hi.y*ni.y));ti.x+=Ti*ni.x,ti.y+=Ti*ni.y,ti.x=Math.round(ti.x),ti.y=Math.round(ti.y),hi=ii}if(!Z||fe!==0&&!Me||Ce(At,ti)||At.push(ti),Bm(this.layoutVertexArray,ti.x,ti.y,0,0,1,1,0),this.wallMode){const ni=ae(Ut,Ct);jm(this.wallVertexArray,oe.joinNormals[Ut],!ni)}ct.vertexLength++,this.footprintVertices.emplaceBack(St.x,St.y),tt.push(St.x,St.y),R&&Vm(this.layoutVertexExtArray,P.projectTilePoint(ti.x,ti.y,a),P.upVector(a,ti.x,ti.y))}Z&&(fe===0||Me)&&(At.length!==0&&Ce(At,At[0])&&At.pop(),this.groundEffect.addData(At,Ne,T))}const Ke=this.wallMode?oe.indices:Lm(tt,ft);for(let Qe=0;Qe<Ke.length;Qe+=3)this.footprintIndices.emplaceBack(xt.vertexOffset+Ke[Qe+0],xt.vertexOffset+Ke[Qe+1],xt.vertexOffset+Ke[Qe+2]),this.indexArray.emplaceBack(Je+Ke[Qe],Je+Ke[Qe+2],Je+Ke[Qe+1]),ct.primitiveLength++;xt.indexCount+=Ke.length,xt.vertexCount+=this.footprintVertices.length-xt.vertexOffset}for(let tt=0;tt<Re.length;tt++){const ft=Re[tt];N.startRing(H,ft[0]);let Ke=ft.length>4&&J1(ft[ft.length-2],ft[0],ft[1]),Qe=fe?$4(ft[ft.length-2],ft[0],ft[1],fe):0;const Ct=[];let At,hi,ii;hi=ft[1].sub(ft[0])._perp()._unit();let Ut=!0;for(let St=1,Mi=0;St<ft.length;St++){let ti=ft[St-1],ni=ft[St];const Ti=ft[St===ft.length-1?1:St+1];if(N.appendEdge(H,ni,ti),i0(ni,ti,Ne)){fe&&(hi=Ti.sub(ni)._perp()._unit(),Ut=!Ut);continue}const Vi=ni.sub(ti)._perp(),Oi=Vi.x/(Math.abs(Vi.x)+Math.abs(Vi.y)),Ki=Vi.y>0?1:0,Ui=ti.dist(ni);if(Mi+Ui>32768&&(Mi=0),fe){ii=Ti.sub(ni)._perp()._unit();let he=Y1(ti,ni,Ti,X1(hi,ii),fe);isNaN(he)&&(he=0);const ye=ni.sub(ti)._unit();ti=ti.add(ye.mult(Qe))._round(),ni=ni.add(ye.mult(-he))._round(),Qe=he,hi=ii,Z&&this.zoom>=17&&(Ce(Ct,ti)||Ct.push(ti),Ce(Ct,ni)||Ct.push(ni))}const Ji=ct.vertexLength,Rn=ft.length>4&&J1(ti,ni,Ti);let nr=Q1(Mi,Ke,Ut);if(Bm(this.layoutVertexArray,ti.x,ti.y,Oi,Ki,0,0,nr),Bm(this.layoutVertexArray,ti.x,ti.y,Oi,Ki,0,1,nr),this.wallMode){const he=ae(St-1,ft),ye=oe.joinNormals[St-1];jm(this.wallVertexArray,ye,he),jm(this.wallVertexArray,ye,he)}if(Mi+=Ui,nr=Q1(Mi,Rn,!Ut),Ke=Rn,Bm(this.layoutVertexArray,ni.x,ni.y,Oi,Ki,0,0,nr),Bm(this.layoutVertexArray,ni.x,ni.y,Oi,Ki,0,1,nr),this.wallMode){const he=ae(St,ft),ye=oe.joinNormals[St];jm(this.wallVertexArray,ye,he),jm(this.wallVertexArray,ye,he)}if(ct.vertexLength+=4,this.indexArray.emplaceBack(Ji+0,Ji+1,Ji+2),this.indexArray.emplaceBack(Ji+1,Ji+3,Ji+2),ct.primitiveLength+=2,fe){const he=Je+(St===1?ft.length-2:St-2),ye=St===1?Je:he+1;if(this.indexArray.emplaceBack(Ji+1,he,Ji+3),this.indexArray.emplaceBack(he,ye,Ji+3),ct.primitiveLength+=2,At===void 0&&(At=Ji),!i0(Ti,ft[St],Ne)){const rt=St===ft.length-1?At:ct.vertexLength;this.indexArray.emplaceBack(Ji+2,Ji+3,rt),this.indexArray.emplaceBack(Ji+3,rt+1,rt),this.indexArray.emplaceBack(Ji+3,ye,rt+1),ct.primitiveLength+=3}Ut=!Ut}if(R){const he=this.layoutVertexExtArray,ye=P.projectTilePoint(ti.x,ti.y,a),rt=P.projectTilePoint(ni.x,ni.y,a),Pt=P.upVector(a,ti.x,ti.y),Gt=P.upVector(a,ni.x,ni.y);Vm(he,ye,Pt),Vm(he,ye,Pt),Vm(he,rt,Gt),Vm(he,rt,Gt)}}F&&(Je+=ft.length-1),Z&&fe&&this.zoom>=17&&(Ct.length!==0&&Ce(Ct,Ct[0])&&Ct.pop(),this.groundEffect.addData(Ct,Ne,T,fe>0))}this.footprintSegments.push(xt),mt.triangleCount=this.indexArray.length-mt.triangleArrayOffset,this.polygonSegments.push(mt),++H.footprintSegLen,++H.polygonSegLen}if(H.vertexCount=this.layoutVertexArray.length-H.vertexArrayOffset,H.groundVertexCount=this.groundEffect.vertexArray.length-H.groundVertexArrayOffset,H.vertexCount!==0){if(H.centroidXY=N.borders?G1:this.encodeCentroid(N,H),this.centroidData.push(H),N.borders){this.featuresOnBorder.push(N);const Re=this.featuresOnBorder.length-1;for(let Ne=0;Ne<N.borders.length;Ne++)N.borders[Ne][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ne].push(Re)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,d,a,w,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(e,o,h,d,a,w,this.worldview),this.maxHeight=Math.max(this.maxHeight,ee)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){const e=[];for(let x=0;x<this.centroidData.length;x++){const w=this.centroidData[x],T=+(w.min.y+w.max.y>Lt),I=2*T+(+(w.min.x+w.max.x>Lt)^T);for(let P=0;P<w.polygonSegLen;P++){const R=w.polygonSegIdx+P;e.push({centroidIdx:x,subtile:I,polygonSegmentIdx:R,triangleSegmentIdx:this.polygonSegments[R].triangleSegIdx})}}const i=new Yr;e.sort((x,w)=>x.triangleSegmentIdx===w.triangleSegmentIdx?x.subtile-w.subtile:x.triangleSegmentIdx-w.triangleSegmentIdx);let o=0,a=0,h=0;for(const x of e){if(x.triangleSegmentIdx!==o)break;h++}const d=e.length;for(;a!==e.length;){o=e[a].triangleSegmentIdx;let x=0,w=a,T=a;for(let I=w;I<h&&e[I].subtile===x;I++)T++;for(;w!==h;){const I=e[w];x=I.subtile;const P=this.centroidData[I.centroidIdx].min.clone(),R=this.centroidData[I.centroidIdx].max.clone(),F={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let N=w;N<T;N++){const H=e[N],Z=this.polygonSegments[H.polygonSegmentIdx],ee=this.centroidData[H.centroidIdx].min,oe=this.centroidData[H.centroidIdx].max,ae=this.indexArray.uint16;for(let q=Z.triangleArrayOffset;q<Z.triangleArrayOffset+Z.triangleCount;q++)i.emplaceBack(ae[3*q],ae[3*q+1],ae[3*q+2]);F.primitiveLength+=Z.triangleCount,P.x=Math.min(P.x,ee.x),P.y=Math.min(P.y,ee.y),R.x=Math.max(R.x,oe.x),R.y=Math.max(R.y,oe.y)}F.primitiveLength>0&&this.triangleSubSegments.push({segment:F,min:P,max:R}),w=T;for(let N=w;N<h&&e[N].subtile===e[w].subtile;N++)T++}a=h;for(let I=a;I<d&&e[I].triangleSegmentIdx===e[a].triangleSegmentIdx;I++)h++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){const a=new Vn;if(this.wallMode){for(const H of this.triangleSubSegments)a.segments.push(H.segment);return a}let h=0,d=0;const x=1<<e.canonical.z;if(i){const H=i.getMinMaxForTile(e);H&&(h=H.min,d=H.max)}d+=this.maxHeight;const w=e.toUnwrapped();let T;const I=[w.canonical.x/x+w.wrap,w.canonical.y/x],P=[(w.canonical.x+1)/x+w.wrap,(w.canonical.y+1)/x],R=(H,Z,ee)=>[H[0]*(1-ee[0])+Z[0]*ee[0],H[1]*(1-ee[1])+Z[1]*ee[1]],F=[],N=[];for(const H of this.triangleSubSegments){F[0]=H.min.x/Lt,F[1]=H.min.y/Lt,N[0]=H.max.x/Lt,N[1]=H.max.y/Lt;const Z=R(I,P,F),ee=R(I,P,N);if(new vn([Z[0],Z[1],h],[ee[0],ee[1],d]).intersectsPrecise(o)===0){T&&(a.segments.push(T),T=void 0);continue}const oe=H.segment;T&&T.vertexOffset!==oe.vertexOffset&&(a.segments.push(T),T=void 0),T?(T.vertexLength+=oe.vertexLength,T.primitiveLength+=oe.primitiveLength):T={vertexOffset:oe.vertexOffset,primitiveLength:oe.primitiveLength,vertexLength:oe.vertexLength,primitiveOffset:oe.primitiveOffset,sortKey:void 0,vaos:{}}}return T&&a.segments.push(T),a}encodeCentroid(e,i){const o=e.centroid(),a=i.span(),h=Math.min(7,Math.round(a.x*this.tileToMeter/10)),d=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new Rt(we(o.x,1,Lt-1)<<3|h,we(o.y,1,Lt-1)<<3|d)}encodeBorderCentroid(e){if(!e.borders)return new Rt(0,0);const i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){const a=i[0][0]!==o?0:1;return new Rt(6|(i[0][0]!==o?0:65528),(i[a][0]+i[a][1])/2<<3|6)}{const a=i[2][0]!==o?2:3;return new Rt((i[a][0]+i[a][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=uf,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,a=e.flags&uf?G1:e.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==a.y||h!==a.x){for(let d=i;d<o;++d)this.centroidVertexArray.emplace(d,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());if(Qy(this.activeReplacements,a))return;if(this.activeReplacements=a,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const d of this.centroidData)d.flags&=2147483647;const h=[];for(const d of this.activeReplacements){if(d.order<o)continue;const x=Math.max(1,Math.pow(2,d.footprintTileId.canonical.z-e.canonical.z));for(const w of this.centroidData)if(!(w.flags&uf||d.min.x>w.max.x||w.min.x>d.max.x||d.min.y>w.max.y||w.min.y>d.max.y))for(let T=0;T<w.footprintSegLen;T++){const I=this.footprintSegments[w.footprintSegIdx+T];if(h.length=0,H4(this.footprintVertices,I.vertexOffset,I.vertexCount,d.footprintTileId.canonical,e.canonical,h),N1(d.footprint,h,this.footprintIndices.uint16,I.indexOffset,I.indexCount,-I.vertexOffset,-x)){w.flags|=uf;break}}}for(const d of this.centroidData)this.writeCentroidToBuffer(d);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let a=!1;for(let h=0;h<o.footprintSegLen;h++){const d=this.footprintSegments[o.footprintSegIdx+h];let x=0;for(const w of d.ringIndices){for(let T=x,I=w+x-1;T<w+x;I=T++){const P=this.footprintVertices.int16[2*(T+d.vertexOffset)+0],R=this.footprintVertices.int16[2*(T+d.vertexOffset)+1],F=this.footprintVertices.int16[2*(I+d.vertexOffset)+1];R>i!=F>i&&e<(this.footprintVertices.int16[2*(I+d.vertexOffset)+0]-P)*(i-R)/(F-R)+P&&(a=!a)}x=w}}return a}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,a=!0;const h=4*(e+Lt)*Lt+(i+Lt);if(this.partLookup.hasOwnProperty(h)){const d=this.partLookup[h];return d?{height:d.height,hidden:!!(d.flags&uf)}:void 0}for(const d of this.centroidData)e>d.max.x||d.min.x>e||i>d.max.y||d.min.y>i||this.footprintContainsPoint(e,i,d)&&d&&d.height>o&&(o=d.height,this.partLookup[h]=d,a=!!(d.flags&uf));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:a};this.partLookup[h]=void 0}}function X1(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function $4(n,e,i,o){const a=e.sub(n)._perp()._unit(),h=i.sub(e)._perp()._unit();return Y1(n,e,i,X1(a,h),o)}function Y1(n,e,i,o,a){const h=Math.sqrt(1-o*o);return Math.min(n.dist(e)/3,e.dist(i)/3,a*h/o)}function i0(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function K1(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function J1(n,e,i){if(n.x<0||n.x>=Lt||e.x<0||e.x>=Lt||i.x<0||i.x>=Lt)return!1;const o=i.sub(e),a=o.perp(),h=n.sub(e);return(o.x*h.x+o.y*h.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(h.x*h.x+h.y*h.y))>-.866&&a.x*h.x+a.y*h.y<0}function Q1(n,e,i){const o=e?2|n:-3&n;return i?1|o:-2&o}function ew(){const n=Math.PI/32,e=Math.tan(n),i=Y;return i*Math.sqrt(1+2*e*e)-i}function tw(n,e,i){const o=1<<i.z,a=Ae(i.x/o),h=Ae((i.x+1)/o),d=Oe(i.y/o),x=Oe((i.y+1)/o);return function(w,T,I,P,R=0,F){const N=[];if(!w.length||!I||!P)return N;const H=(le,fe)=>{for(const Me of le)N.push({polygon:Me,bounds:fe})},Z=Math.ceil(Math.log2(I)),ee=Math.ceil(Math.log2(P)),oe=Z-ee,ae=[];for(let le=0;le<Math.abs(oe);le++)ae.push(oe>0?0:1);for(let le=0;le<Math.min(Z,ee);le++)ae.push(0),ae.push(1);let q=w;if(q=r_(q,T[0].y-R,T[1].y+R,1),q=r_(q,T[0].x-R,T[1].x+R,0),!q.length)return N;const re=[];for(ae.length?re.push({polygons:q,bounds:T,depth:0}):H(q,T);re.length;){const le=re.pop(),fe=le.depth,Me=ae[fe],Ce=le.bounds[0],Re=le.bounds[1],Ne=Me===0?Ce.x:Ce.y,Je=Me===0?Re.x:Re.y,gt=F?F(Me,Ne,Je):.5*(Ne+Je),ct=r_(le.polygons,Ne-R,gt+R,Me),mt=r_(le.polygons,gt-R,Je+R,Me);if(ct.length){const xt=[Ce,new Rt(Me===0?gt:Re.x,Me===1?gt:Re.y)];ae.length>fe+1?re.push({polygons:ct,bounds:xt,depth:fe+1}):H(ct,xt)}if(mt.length){const xt=[new Rt(Me===0?gt:Ce.x,Me===1?gt:Ce.y),Re];ae.length>fe+1?re.push({polygons:mt,bounds:xt,depth:fe+1}):H(mt,xt)}}return N}(n,e,Math.ceil((h-a)/11.25),Math.ceil((d-x)/11.25),1,(w,T,I)=>{if(w===0)return .5*(T+I);{const P=Oe((i.y+T/Lt)/o);return(me(.5*(Oe((i.y+I/Lt)/o)+P))*o-i.y)*Lt}})}function H4(n,e,i,o,a,h){const d=Math.pow(2,o.z-a.z);for(let x=0;x<i;x++){let w=n.int16[2*(x+e)+0],T=n.int16[2*(x+e)+1];w=(w+a.x*Lt)*d-o.x*Lt,T=(T+a.y*Lt)*d-o.y*Lt,h.push(new Rt(w,T))}}let iw,nw;qt(l_,"FillExtrusionBucket",{omit:["layers","features"]}),qt(H1,"PartData"),qt($1,"FootprintSegment"),qt(W1,"BorderCentroidData"),qt(Z1,"GroundEffect");class sp extends Rt{constructor(e,i,o){super(e,i),this.z=o}}class rw extends sp{constructor(e,i,o,a){super(e,i,o),this.w=a}}function sw(n,e,i,o){const a=i==="x"?"y":"x",h=(o-n[i])/(e[i]-n[i]);n[a]=Math.round(n[a]+(e[a]-n[a])*h),n[i]=o,n.hasOwnProperty("z")&&(n.z=gi(n.z,e.z,h)),n.hasOwnProperty("w")&&(n.w=gi(n.w,e.w,h))}function ow(n,e,i,o){const a=i,h=o;for(const d of["x","y"]){let x=n,w=e;x[d]>=w[d]&&(x=e,w=n),x[d]<a&&w[d]>a&&sw(x,w,d,a),x[d]<h&&w[d]>h&&sw(w,x,d,h)}}function c_(n,e,i,o,a,h){const d=[];for(let x=0;x<n.length;x++){const w=n[x];let T;const I=d.length;let P=0;for(let R=0;R<w.length-1;R++){let F=w[R],N=w[R+1],H=0;const Z=P;let ee,oe;h&&(H=Math.hypot(N.x-F.x,N.y-F.y),P+=H,ee=F,oe=N),F.x<e&&N.x<e||(F.x<e?F=new Rt(e,F.y+(e-F.x)/(N.x-F.x)*(N.y-F.y))._round():N.x<e&&(N=new Rt(e,F.y+(e-F.x)/(N.x-F.x)*(N.y-F.y))._round()),F.y<i&&N.y<i||(F.y<i?F=new Rt(F.x+(i-F.y)/(N.y-F.y)*(N.x-F.x),i)._round():N.y<i&&(N=new Rt(F.x+(i-F.y)/(N.y-F.y)*(N.x-F.x),i)._round()),F.x>=o&&N.x>=o||(F.x>=o?F=new Rt(o,F.y+(o-F.x)/(N.x-F.x)*(N.y-F.y))._round():N.x>=o&&(N=new Rt(o,F.y+(o-F.x)/(N.x-F.x)*(N.y-F.y))._round()),F.y>=a&&N.y>=a||(F.y>=a?F=new Rt(F.x+(a-F.y)/(N.y-F.y)*(N.x-F.x),a)._round():N.y>=a&&(N=new Rt(F.x+(a-F.y)/(N.y-F.y)*(N.x-F.x),a)._round()),T&&F.equals(T[T.length-1])||(T=[F],d.push(T),h&&h.push({progress:{min:Z+aw(ee,oe,F)*H,max:1},parentIndex:x,prevPoint:ee,nextPoint:oe})),T.push(N),h&&(h[h.length-1].progress.max=Z+aw(ee,oe,N)*H,h[h.length-1].nextPoint=oe)))))}if(h&&P>0)for(let R=I;R<d.length;R++)h[R].progress.min/=P,h[R].progress.max/=P}return d}function W4(n,e,i,o,a){if(n.length<2)return void o.push(n);const h=[];for(;e.valid();){const[T,I]=e.get();for(let P=0;P<n.length-1;P++){const R=n[P],F=n[P+1],N=Kf(R,F,T,I);if(N){const[H]=N,Z=new Rt(gi(R.x,F.x,H),gi(R.y,F.y,H));h.push({t:P+H,distance:0,point:Z})}}e.next()}if(h.length===0)return void o.push(n);h.sort((T,I)=>T.t-I.t);let d=0,x=0,w=[];for(o.push(w);d!==n.length;){if(x===h.length){for(;d!==n.length;)w.length!==0&&w[w.length-1].equals(n[d])||w.push(n[d]),d++;break}h[x].t<=d?(w.length!==0&&w[w.length-1].equals(h[x].point)||w.push(h[x].point),Math.trunc(h[x].t),x++):(w.length!==0&&w[w.length-1].equals(n[d])||w.push(n[d]),d++)}}function aw(n,e,i){return n.x!==e.x?(i.x-n.x)/(e.x-n.x):n.y!==e.y?(i.y-n.y)/(e.y-n.y):0}function Um(n,e){return n.x*e.x+n.y*e.y}function lw(n,e){if(n.length===1){let i=0;const o=e[i++];let a;for(;!a||o.equals(a);)if(a=e[i++],!a)return 1/0;for(;i<e.length;i++){const h=e[i],d=n[0],x=a.sub(o),w=h.sub(o),T=d.sub(o),I=Um(x,x),P=Um(x,w),R=Um(w,w),F=Um(T,x),N=Um(T,w),H=I*R-P*P,Z=(R*F-P*N)/H,ee=(I*N-P*F)/H,oe=o.z*(1-Z-ee)+a.z*Z+h.z*ee;if(isFinite(oe))return oe}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function cw(n,e,i,o,a,h,d,x){const w=d*a.getElevationAt(n,e,!0,!0),T=h[0]!==0,I=T?h[1]===0?d*(h[0]/7-450):d*function(P,R,F){const N=Math.floor(R[0]/8),H=Math.floor(R[1]/8),Z=10*(R[0]-8*N),ee=10*(R[1]-8*H),oe=P.getElevationAt(N,H,!0,!0),ae=P.getMeterToDEM(F),q=Math.floor(.5*(Z*ae-1)),re=Math.floor(.5*(ee*ae-1)),le=P.tileCoordToPixel(N,H),fe=2*q+1,Me=2*re+1,Ce=function(mt,xt,tt,ft,Ke){return[mt.getElevationAtPixel(xt,tt,!0),mt.getElevationAtPixel(xt+Ke,tt,!0),mt.getElevationAtPixel(xt,tt+Ke,!0),mt.getElevationAtPixel(xt+ft,tt+Ke,!0)]}(P,le.x-q,le.y-re,fe,Me),Re=Math.abs(Ce[0]-Ce[1]),Ne=Math.abs(Ce[2]-Ce[3]),Je=Math.abs(Ce[0]-Ce[2])+Math.abs(Ce[1]-Ce[3]),gt=Math.min(.25,.5*ae*(Re+Ne)/fe),ct=Math.min(.25,.5*ae*Je/Me);return oe+Math.max(gt*Z,ct*ee)}(a,h,x):w;return{base:w+(i===0?-1:i),top:T?Math.max(I+o,w+i+2):w+o}}class q4{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Z4{constructor(){this.tasks={},this.taskQueue=[],ei(["process"],this),this.invoker=new q4(this.process),this.nextId=0}add(e,i){const o=this.nextId++,a=function({type:h,isSymbolTile:d,zoom:x}){return x=x||0,h==="message"?0:h!=="maybePrepare"||d?h!=="parseTile"||d?h==="parseTile"&&d?300-x:h==="maybePrepare"&&d?400-x:500:200-x:100-x}(i);if(a===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:a,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let a=0;a<this.taskQueue.length;a++){const h=this.tasks[this.taskQueue[a]];h.priority<i&&(i=h.priority,e=a)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class uw{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},ei(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Z4}send(e,i,o,a,h=!1,d){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=d,this.callbacks[x]=o);const w=new Set;return this.target.postMessage({id:x,type:e,hasCallback:!!o,targetMapId:a,mustQueue:h,sourceMapId:this.mapId,data:ao(i,w)},w),{cancel:()=>{o&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const a=this.cancelCallbacks[o];delete this.cancelCallbacks[o],a&&a.cancel()}else if(i.mustQueue||Tn(self)){const a=this.callbacks[o],h=this.scheduler.add(()=>this.processTask(o,i),a&&a.metadata||{type:"message"});h&&(this.cancelCallbacks[o]=h)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o(Oa(i.error)):o(null,Oa(i.data)))}else{const o=new Set,a=i.hasCallback?(d,x)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:d?ao(d):null,data:ao(x,o)},o)}:()=>{},h=Oa(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,h,a);else if(this.parent.getWorkerSource){const d=i.type.split("."),{source:x,scope:w}=h;this.parent.getWorkerSource(i.sourceMapId,d[0],x,w)[d[1]](h,a)}else a(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Gm={workerUrl:"",workerClass:null,workerParams:void 0};const n0="mapboxgl_preloaded_worker_pool";class op{constructor(){this.active={}}acquire(e,i=op.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(Gm.workerClass!=null?new Gm.workerClass:new self.Worker(Gm.workerUrl,Gm.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[n0]}numActive(){return Object.keys(this.active).length}}op.workerCount=2;class $p{constructor(e,i,o="Worker",a=op.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Ze();const h=this.workerPool.acquire(this.id,a);for(let d=0;d<h.length;d++){const x=new $p.Actor(h[d],i,this.id);x.name=`${o} ${d}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,o){Le(this.actors,(a,h)=>{a.send(e,i,h)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let $m,r0;function u_(){return $m||($m=new op),$m}$p.Actor=uw;class X4{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),o=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,o/i.BYTES_PER_ELEMENT),o}createFloatArray(e){const i=new Float32Array(e),o=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,o/i.BYTES_PER_ELEMENT),o}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let o=0;o<e.length;++o)this.module.heapU8[i+o]=e.charCodeAt(o);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,o=e.facadeGlazingColorRgb,a=e.roofColorRgb,h=e.wallColorRgb,d=e.normalScale;this.module.setStyle(i[0],i[1],i[2],o[0],o[1],o[2],a[0],a[1],a[2],h[0],h[1],h[2],d[0],d[1],d[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setFacadeOptions(e,i,o){this.module.setFacadeOptions(e,i,o)}generateMesh(e,i){for(const x of e){const w=this.createStringBuffer(x.roofType),T=[0],I=[];for(const F of x.coordinates)if(Array.isArray(F)){for(const N of F)I.push(N.x),I.push(N.y);T.push(I.length)}const P=this.createIntArray(T),R=this.createFloatArray(I);this.module.addFeature(x.id,x.sourceId,x.minHeight,x.height,w,x.roofType.length,R,P,T.length-1),this.module.free(w),this.module.free(P),this.module.free(R)}for(const x of i){let w;w=x.entrances?JSON.parse(x.entrances):[];const T=this.createFloatArray(w),I=[];for(const R of x.coordinates)I.push(R.x),I.push(R.y);const P=this.createFloatArray(I);this.module.addFacade(x.sourceId,x.crossPerc,x.distanceToRoad,T,w.length,P,I.length),this.module.free(T),this.module.free(P)}if(!this.module.generateMesh()){const x=this.module.getLastError();return this.readStringBuffer(x)}const o=this.module.getMeshCount(),a=new Array(o);for(let x=0;x<o;x++){const w=this.module.getPositionsPtr(x),T=this.module.getPositionsLength(x),I=new Float32Array(this.module.heapF32.buffer,w,T),P=this.module.getNormalsPtr(x),R=this.module.getNormalsLength(x),F=new Float32Array(this.module.heapF32.buffer,P,R),N=this.module.getColorsPtr(x),H=this.module.getColorsLength(x),Z=new Uint8Array(this.module.heapU8.buffer,N,H),ee=this.module.getAOPtr(x),oe=this.module.getAOLength(x),ae=new Float32Array(this.module.heapF32.buffer,ee,oe),q=this.module.getIndicesPtr(x),re=this.module.getIndicesLength(x),le=new Int32Array(this.module.heap32.buffer,q,re),fe=this.module.getBuildingPart(x),Me=this.readStringBuffer(fe);a[x]={positions:I,normals:F,colors:Z,ao:ae,indices:le,buildingPart:Me}}const h=this.module.getRingCount(),d=[];for(let x=0;x<h;x++){const w=this.module.getRingPtr(x),T=this.module.getRingLength(x),I=new Float32Array(this.module.heapF32.buffer,w,T);d.push(I)}return{meshes:a,modifiedPolygonRings:d}}}let Hm,s0,ou,Hp,o0,Wp=null,qp=null,hw=null,a0=null;function dw(){return Tn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:s0||us.DRACO_URL}function fw(){if(Tn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Hp)return Hp;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Hp=WebAssembly.validate(n)?us.MESHOPT_SIMD_URL:us.MESHOPT_URL,Hp}const h_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Y4={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Wm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function pw(n,e,i){const o=i.json.bufferViews.length,a=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:a,byteLength:n.byteLength},i.buffers[a]=n}const l0="KHR_draco_mesh_compression";function K4(n,e){const i=n.extensions&&n.extensions[l0];if(!i)return;const o=new ou.Decoder,a=yw(e,i.bufferView),h=new ou.Mesh;if(!o.DecodeArrayToMesh(a,a.byteLength,h))throw new Error("Failed to decode Draco mesh");const d=e.json.accessors[n.indices],x=h_[d.componentType],w=d.count*x.BYTES_PER_ELEMENT,T=ou._malloc(w);x===Uint16Array?o.GetTrianglesUInt16Array(h,w,T):o.GetTrianglesUInt32Array(h,w,T),pw(ou.memory.buffer.slice(T,T+w),d,e),ou._free(T);for(const I of Object.keys(i.attributes)){const P=o.GetAttributeByUniqueId(h,i.attributes[I]),R=e.json.accessors[n.attributes[I]],F=Y4[R.componentType],N=R.count*Wm[R.type]*h_[R.componentType].BYTES_PER_ELEMENT,H=ou._malloc(N);o.GetAttributeDataArrayForAllPoints(h,P,ou[F],N,H),pw(ou.memory.buffer.slice(H,H+N),R,e),ou._free(H)}o.destroy(),h.destroy(),delete n.extensions[l0]}const d_="EXT_meshopt_compression";function J4(n,e){if(!n.extensions||!n.extensions[d_])return;const i=n.extensions[d_],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),a=new Uint8Array(i.count*i.byteStride);o0.decodeGltfBuffer(a,i.count,i.byteStride,o,i.mode,i.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=a.buffer,delete n.extensions[d_]}const mw=1179937895,gw=new TextDecoder("utf8");function _w(n,e){return new URL(n,e).href}function Q4(n,e,i,o){return fetch(_w(n.uri,o)).then(a=>a.arrayBuffer()).then(a=>{e.buffers[i]=a})}function yw(n,e){const i=n.json.bufferViews[e];return new Uint8Array(n.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function eA(n,e,i,o){if(n.uri){const a=_w(n.uri,o);return fetch(a).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{e.images[i]=h})}if(n.bufferView!==void 0){const a=yw(e,n.bufferView),h=new Blob([a],{type:n.mimeType});return createImageBitmap(h).then(d=>{e.images[i]=d})}}function xw(n,e=0,i){const o={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===mw){const I=new Uint32Array(n,e);let P=2;const R=(I[P++]>>2)-3,F=I[P++]>>2;if(P++,o.json=JSON.parse(gw.decode(I.subarray(P,P+F))),P+=F,P<R){const N=I[P++];P++;const H=e+(P<<2);o.buffers[0]=n.slice(H,H+N)}}else o.json=JSON.parse(gw.decode(new Uint8Array(n,e)));const{buffers:a,images:h,meshes:d,extensionsUsed:x,bufferViews:w}=o.json;let T=Promise.resolve();if(a){const I=[];for(let P=0;P<a.length;P++){const R=a[P];R.uri?I.push(Q4(R,o,P,i)):o.buffers[P]||(o.buffers[P]=null)}T=Promise.all(I)}return T.then(()=>{const I=[],P=x&&x.includes(l0),R=x&&x.includes(d_);if(P&&I.push(function(){if(!ou)return Hm??(Hm=function(F){let N,H=null;function Z(){N=new Uint8Array(H.buffer)}function ee(){throw new Error("Unexpected Draco error.")}const oe={a:{a:ee,d:function(ae,q,re){return N.copyWithin(ae,q,q+re)},c:function(ae){const q=N.length,re=Math.max(ae>>>0,Math.ceil(1.2*q)),le=Math.ceil((re-q)/65536);try{return H.grow(le),Z(),!0}catch{return!1}},b:ee}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(F,oe):F.then(ae=>ae.arrayBuffer()).then(ae=>WebAssembly.instantiate(ae,oe))).then(ae=>{const{Rb:q,Qb:re,P:le,T:fe,X:Me,Ja:Ce,La:Re,Qa:Ne,Va:Je,Wa:gt,eb:ct,jb:mt,f:xt,e:tt,yb:ft,zb:Ke,Ab:Qe,Bb:Ct,Db:At,Gb:hi}=ae.instance.exports;H=tt;const ii=(()=>{let Ut=0,St=0,Mi=0,ti=0;return ni=>{Mi&&(q(ti),q(Ut),St+=Mi,Mi=Ut=0),Ut||(St+=128,Ut=re(St));const Ti=ni.length+7&-8;let Vi=Ut;Ti>=St&&(Mi=Ti,Vi=ti=re(Ti));for(let Oi=0;Oi<ni.length;Oi++)N[Vi+Oi]=ni[Oi];return Vi}})();return Z(),xt(),{memory:tt,_free:q,_malloc:re,Mesh:class{constructor(){this.ptr=le()}destroy(){fe(this.ptr)}},Decoder:class{constructor(){this.ptr=Ce()}destroy(){mt(this.ptr)}DecodeArrayToMesh(Ut,St,Mi){const ti=ii(Ut),ni=Re(this.ptr,ti,St,Mi.ptr);return!!Me(ni)}GetAttributeByUniqueId(Ut,St){return{ptr:Ne(this.ptr,Ut.ptr,St)}}GetTrianglesUInt16Array(Ut,St,Mi){Je(this.ptr,Ut.ptr,St,Mi)}GetTrianglesUInt32Array(Ut,St,Mi){gt(this.ptr,Ut.ptr,St,Mi)}GetAttributeDataArrayForAllPoints(Ut,St,Mi,ti,ni){ct(this.ptr,Ut.ptr,St.ptr,Mi,ti,ni)}},DT_INT8:ft(),DT_UINT8:Ke(),DT_INT16:Qe(),DT_UINT16:Ct(),DT_UINT32:At(),DT_FLOAT32:hi()}})}(fetch(dw())),Hm.then(F=>{ou=F,Hm=void 0}))}()),R&&I.push(function(){if(o0)return;const F=function(N){let H;const Z=WebAssembly.instantiateStreaming(N,{}).then(ae=>{H=ae.instance,H.exports.__wasm_call_ctors()}),ee={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},oe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Z,supported:!0,decodeGltfBuffer(ae,q,re,le,fe,Me){(function(Ce,Re,Ne,Je,gt,ct,mt){const xt=Ce.exports.sbrk,tt=Je+3&-4,ft=xt(tt*gt),Ke=xt(ct.length),Qe=new Uint8Array(Ce.exports.memory.buffer);Qe.set(ct,Ke);const Ct=Re(ft,Je,gt,Ke,ct.length);if(Ct===0&&mt&&mt(ft,tt,gt),Ne.set(Qe.subarray(ft,ft+Je*gt)),xt(ft-xt(0)),Ct!==0)throw new Error(`Malformed buffer data: ${Ct}`)})(H,H.exports[oe[fe]],ae,q,re,le,H.exports[ee[Me]])}}}(fetch(fw()));return F.ready.then(()=>{o0=F})}()),h)for(let F=0;F<h.length;F++)I.push(eA(h[F],o,F,i));return(I.length?Promise.all(I):Promise.resolve()).then(()=>{if(P&&d)for(const{primitives:F}of d)for(const N of F)K4(N,o);if(R&&d&&w)for(const F of w)J4(F,o);return o})})}class vw{constructor(e){this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.hasPattern=!1,this.worldview=e.worldview}updateFootprints(e,i){}prepare(){return function(){if(a0!=null||hw!=null)return null;if(qp!=null)return qp;const e=fetch(us.BUILDING_GEN_URL);return qp=function(i){let o,a,h,d;function x(){o=new Uint8Array(d.buffer),a=new Int32Array(d.buffer),h=new Float32Array(d.buffer)}function w(){throw new Error("Unexpected BuildingGen error.")}const T=()=>{},I={a:{a:w,f:function(P){const R=o.length,F=Math.max(P>>>0,Math.ceil(1.2*R)),N=Math.ceil((F-R)/65536);try{return d.grow(N),x(),!0}catch{return!1}},g:w,b:T,c:T,d:T,e:T}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,I):i.then(P=>P.arrayBuffer()).then(P=>WebAssembly.instantiate(P,I))).then(P=>{const R=P.instance.exports;return(0,R.g)(),d=R.f,x(),new X4({setStyle:R.h,setAOOptions:R.i,setMetricOptions:R.j,setFacadeOptions:R.k,addFeature:R.l,addFacade:R.m,generateMesh:R.n,getLastError:R.o,getMeshCount:R.p,getPositionsPtr:R.q,getPositionsLength:R.r,getNormalsPtr:R.s,getNormalsLength:R.t,getColorsPtr:R.u,getColorsLength:R.v,getAOPtr:R.w,getAOLength:R.x,getIndicesPtr:R.y,getIndicesLength:R.z,getBuildingPart:R.A,getRingCount:R.B,getRingPtr:R.C,getRingLength:R.D,free:R.E,malloc:R.F,heapU8:o,heap32:a,heapF32:h})})}(e).then(i=>(qp=null,a0=i,a0)).catch(i=>{zi("Could not load building-gen"),qp=null,hw=i}),qp}()}populate(e,i,o,a){}update(e,i,o,a,h,d,x){}isEmpty(){return!1}uploadPending(){return!1}upload(e){}destroy(){}getHeightAtTileCoord(e,i){return{height:Number.NEGATIVE_INFINITY,hidden:!0}}}let ww,bw;qt(vw,"BuildingBucket",{omit:["layers"]});const tA=hn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),iA=hn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:nA}=tA,rA=hn([{name:"a_packed",components:3,type:"Float32"}]),{members:sA}=rA,oA=hn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:aA}=oA;class Tw{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new cf({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=Mt(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const a=[];let h=e.length%2==1?-e[e.length-1]*o:0,d=e[0]*o,x=!0;a.push({left:h,right:d,isDash:x,zeroLength:e[0]===0});let w=e[0];for(let T=1;T<e.length;T++){x=!x;const I=e[T];h=w*o,w+=I,d=w*o,a.push({left:h,right:d,isDash:x,zeroLength:I===0})}return a}addRoundDash(e,i,o){const a=i/2;for(let h=-o;h<=o;h++){const d=this.width*(this.nextRow+o+h);let x=0,w=e[x];for(let T=0;T<this.width;T++){T/w.right>1&&(w=e[++x]);const I=Math.abs(T-w.left),P=Math.abs(T-w.right),R=Math.min(I,P);let F;const N=h/o*(a+1);if(w.isDash){const H=a-Math.abs(N);F=Math.sqrt(R*R+H*H)}else F=a-Math.sqrt(R*R+N*N);this.image.data[d+T]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(e,i){for(let w=e.length-1;w>=0;--w){const T=e[w],I=e[w+1];T.zeroLength?e.splice(w,1):I&&I.isDash===T.isDash&&(I.left=T.left,e.splice(w,1))}const o=e[0],a=e[e.length-1];o.isDash===a.isDash&&(o.left=a.left-this.width,a.right=o.right+this.width);const h=this.width*this.nextRow;let d=0,x=e[d];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++d]);const T=Math.abs(w-x.left),I=Math.abs(w-x.right),P=Math.min(T,I);this.image.data[h+w]=Math.max(0,Math.min(255,(x.isDash?P:-P)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const a=i==="round",h=a?7:0,d=2*h+1;if(this.nextRow+d>this.height)return zi("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let I=0;I<e.length;I++)e[I]<0&&(zi("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),x+=e[I];if(x!==0){const I=this.width/x,P=this.getDashRanges(e,this.width,I);a?this.addRoundDash(P,I,h):this.addRegularDash(P,i==="square"?.5*I:0)}const w=this.nextRow+h;this.nextRow+=d;const T={tl:[w,h],br:[x,0]};return this.positions[o]=T,T}}qt(Tw,"LineAtlas");const lA=Bi.VectorTileFeature.types,cA=Math.cos(Math.PI/180*37.5),uA=Math.cos(Math.PI/180*5);class c0{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Xd,this.layoutVertexArray2=new ha,this.patternVertexArray=new ha,this.indexArray=new Yr,this.programConfigurations=new l(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Vn,this.maxLineLength=0,this.zOffsetVertexArray=new ha,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Lt/64,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,o,a){this.hasPattern=Wy("line",this.layers,this.pixelRatio,i);const h=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Xe(o);const d=this.layers[0].layout.get("line-elevation-reference");if(d==="hd-road-markup")this.elevationType="road";else{const R=this.layers[0].layout.get("line-z-offset"),F=R.isConstant()&&!R.constantOr(0);this.elevationType=d!=="sea"&&d!=="ground"&&F?"none":"offset",this.elevationType==="offset"&&d==="none"&&zi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const x=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&x!==void 0;const w=[];for(const{feature:R,id:F,index:N,sourceLayerIndex:H}of e){const Z=this.layers[0]._featureFilter.needGeometry,ee=Ot(R,Z);if(!this.layers[0]._featureFilter.filter(new Pn(this.zoom,{worldview:this.worldview}),ee,o))continue;const oe=h?h.evaluate(ee,{},o):void 0,ae={id:F,properties:R.properties,type:R.type,sourceLayerIndex:H,index:N,geometry:Z?ee.geometry:Wt(R,o,a),patterns:{},sortKey:oe};w.push(ae)}h&&w.sort((R,F)=>R.sortKey-F.sortKey);const{lineAtlas:T,featureIndex:I}=i,P=this.addConstantDashes(T);for(const R of w){const{geometry:F,index:N,sourceLayerIndex:H}=R;if(P&&this.addFeatureDashes(R,T),this.hasPattern){const Z=qy("line",this.layers,R,this.zoom,this.pixelRatio,i);this.patternFeatures.push(Z)}else this.addFeature(R,F,N,o,T.positions,i.availableImages,i.brightness,i.elevationFeatures);I.insert(e[N].feature,F,N,H,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const a=o.paint.get("line-dasharray").value,h=o.layout.get("line-cap").value;if(a.kind!=="constant"||h.kind!=="constant")i=!0;else{const d=h.value,x=a.value;if(!x)continue;e.addDash(x,d)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const a of this.layers){const h=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(h.kind==="constant"&&d.kind==="constant")continue;let x,w;if(h.kind==="constant"){if(x=h.value,!x)continue}else x=h.evaluate({zoom:o},e);w=d.kind==="constant"?d.value:d.evaluate({zoom:o},e),i.addDash(x,w),e.patterns[a.id]=[i.getKey(x,w)]}}update(e,i,o,a,h,d,x,w){this.programConfigurations.updatePaintArrays(e,i,h,o,a,d,x,w)}addFeatures(e,i,o,a,h,d){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,o,a,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,sA)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,aA)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,iA.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nA),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,a,h,d,x,w){const T=this.layers[0].layout,I=T.get("line-join").evaluate(e,{}),P=T.get("line-cap").evaluate(e,{}),R=T.get("line-miter-limit"),F=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=T.get("line-z-offset").value;const N=this.layers[0].paint.get("line-width").value;if(N.kind!=="constant"&&N.isLineProgressConstant===!1&&(this.variableWidthValue=N),this.elevationType==="road"){const H=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,a,w,I,P,R,F)){const[Z,ee]=this.clipRuntimeLinesToTile(i,1);for(let oe=0;oe<Z.length;oe++){const ae=Z[oe],q=ee[oe],re={progress:{min:q.progress.min,max:q.progress.max},nextDir:this.computeSegNextDir(q,ae),prevDir:this.computeSegPrevDir(q,ae)};this.addLine(ae,e,a,I,P,R,F,re)}this.fillNonElevatedRoadSegment(H)}}else for(const H of i)this.addLine(H,e,a,I,P,R,F);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,h,d,a,x,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return c_(e,-i,-i,Lt+i,Lt+i)}clipRuntimeLinesToTile(e,i){const o=[];return[c_(e,-i,-i,Lt+i,Lt+i,o),o]}addElevatedRoadFeature(e,i,o,a,h,d,x,w){const T=[],I=Vo.getElevationFeature(e,a);if(I){const P=this.clipLinesToTile(i,1),R=this.prepareElevatedLines(P,I,o);for(const F of R)T.push({geometry:F,elevation:I,elevationTileID:o,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(T.length===0)return!1;for(const P of T){const R=this.layoutVertexArray.length;this.addLine(P.geometry,e,o,h,d,x,w);const F=new Ur(o,P.elevationTileID);if(P.elevation)for(let N=R;N<this.layoutVertexArray.length;N++){const H=new Rt(this.layoutVertexArray.int16[6*N]>>1,this.layoutVertexArray.int16[6*N+1]>>1),Z=F.pointElevation(H,P.elevation,.05);this.updateHeightRange(Z),this.zOffsetVertexArray.emplaceBack(Z,0,0)}else this.fillNonElevatedRoadSegment(R)}return!0}prepareElevatedLines(e,i,o){if(i.constantHeight!=null)return e;const a=[],h=1/Xe(o);for(const d of e)W4(d,new co(i,h),0,a);return a}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,o,a,h,d,x,w){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const T=a==="none";this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const I=w&&w.progress.min>0,P=w&&w.progress.max<1;if(this.lineClips){let Me={min:this.lineClips.start,max:this.lineClips.end},Ce=1;if(w){const Je=this.lineClips.end-this.lineClips.start;Me=function(gt,ct,mt){return{min:to(gt.min,ct,mt),max:to(gt.max,ct,mt)}}(w.progress,{min:0,max:1},Me),Je>0&&(Ce=(Me.max-Me.min)/Je)}const Re=+i.properties.mapbox_clip_feature_len,Ne=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Re)||Number.isNaN(Ne)){for(let gt=0;gt<e.length-1;gt++)this.totalDistance+=e[gt].dist(e[gt+1]);const Je=this.totalDistance/(Me.max-Me.min);this.totalFeatureLength=Number.isFinite(Je)?Je:0,this.lineClips.start=Me.min,this.lineClips.end=Me.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Re,this.distance=Ne*Ce,this.lineClips.start=Me.min,this.lineClips.end=Me.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const R=lA[i.type]==="Polygon";let F=e.length;for(;F>=2&&e[F-1].equals(e[F-2]);)F--;let N=0;for(;N<F-1&&e[N].equals(e[N+1]);)N++;if(F<(R?3:2))return;a==="bevel"&&(d=1.05);const H=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray);let Z,ee,oe,ae,q,re,le,fe;w&&w.prevDir&&(re=w.prevDir.perp()),w&&w.nextDir&&(le=w.nextDir.perp()),this.e1=this.e2=-1,R&&(Z=e[F-2],q=e[N].sub(Z)._unit()._perp());for(let Me=N;Me<F;Me++){if(oe=Me===F-1?R?e[N+1]:void 0:e[Me+1],oe&&e[Me].equals(oe))continue;q&&(ae=q),Z&&(ee=Z),Z=e[Me],fe=this.evaluateLineProgressFeatures(ee?ee.dist(Z):0),q=oe?oe.sub(Z)._unit()._perp():ae,ae=ae||q;const Ce=ee&&oe;let Re=Ce?a:R||T?"butt":h;const Ne=ae.x*q.x+ae.y*q.y;if(T){const Ke=function(Qe){if(Qe.patternJoinNone){const Ct=Qe.segmentPoints.length/2,At=Qe.lineSoFar-Qe.segmentStart;for(let hi=0;hi<Ct;++hi){const ii=Qe.segmentPoints[2*hi+1],Ut=Math.round(Qe.segmentPoints[2*hi])+.5+.25*ii;Qe.patternVertexArray.emplaceBack(Ut,At,Qe.segmentStart),Qe.patternVertexArray.emplaceBack(Ut,At,Qe.segmentStart)}Qe.segmentPoints.length=0}Qe.e1=Qe.e2=-1};if(Ce&&Ne<uA){this.updateDistance(ee,Z),this.addCurrentVertex(Z,ae,1,1,H,fe),Ke(this),this.addCurrentVertex(Z,q,-1,-1,H,fe);continue}if(ee){if(!oe){this.updateDistance(ee,Z),this.addCurrentVertex(Z,ae,1,1,H,fe),Ke(this);continue}Re="miter"}}let Je=ae.add(q);Je.x===0&&Je.y===0||Je._unit();const gt=Je.x*q.x+Je.y*q.y,ct=gt!==0?1/gt:1/0,mt=2*Math.sqrt(2-2*gt),xt=gt<cA&&ee&&oe,tt=ae.x*q.y-ae.y*q.x>0,ft=this.overscaling<=16?15*Lt/(512*this.overscaling):0;if(Ce&&Re==="round"){if(ct<x)Re="miter";else if(ct<=2){const Ke=u0(Z,-10,Lt+10);Re=this.elevationType==="offset"&&(Ke||this.hasCrossSlope)?"miter":"fakeround"}}if(Re==="miter"&&ct>d&&(Re="bevel"),Re==="bevel"&&(ct>2&&(Re="flipbevel"),ct<d&&(Re="miter")),ee&&!(Re==="miter"&&xt)&&this.updateDistance(ee,Z),Re==="miter")if(xt){const Ke=Z.dist(ee);if(Ke>2*ft){const Ct=Z.sub(Z.sub(ee)._mult(ft/Ke)._round());this.updateDistance(ee,Ct),this.addCurrentVertex(Ct,ae,0,0,H,fe),ee=Ct}this.updateDistance(ee,Z),Je._mult(ct),this.addCurrentVertex(Z,Je,0,0,H,fe);const Qe=Z.dist(oe);if(Qe>2*ft){const Ct=Z.add(oe.sub(Z)._mult(ft/Qe)._round());this.updateDistance(Z,Ct),this.addCurrentVertex(Ct,q,0,0,H,fe),Z=Ct}}else Je._mult(ct),this.addCurrentVertex(Z,Je,0,0,H,fe);else if(Re==="flipbevel"){if(ct>100)Je=q.mult(-1);else{const Ke=ct*ae.add(q).mag()/ae.sub(q).mag();Je._perp()._mult(Ke*(tt?-1:1))}this.addCurrentVertex(Z,Je,0,0,H,fe),this.addCurrentVertex(Z,Je.mult(-1),0,0,H,fe)}else if(Re==="bevel"||Re==="fakeround"){fe!=null&&ee&&this.addCurrentVertex(Z,le||ae,-1,-1,H,fe);const Ke=Z.dist(ee)<=2*ft&&Re!=="bevel",Qe=Je.mult(tt?1:-1);Qe._mult(ct);const Ct=q.mult(tt?-1:1),At=ae.mult(tt?-1:1),hi=this.evaluateLineProgressFeatures(this.distance);if(fe==null&&(this.addHalfVertex(Z,Qe.x,Qe.y,!1,!tt,0,H,hi),Ke||this.addHalfVertex(Z,Qe.x+2*At.x,Qe.y+2*At.y,!1,tt,0,H,hi)),Re==="fakeround"){const ii=Math.round(180*mt/Math.PI/20);this.addHalfVertex(Z,At.x,At.y,!1,tt,0,H,hi);for(let Ut=0;Ut<ii;Ut++){let St=Ut/ii;if(St!==.5){const ti=St-.5;St+=St*ti*(St-1)*((1.0904+Ne*(Ne*(3.55645-1.43519*Ne)-3.2452))*ti*ti+(.848013+Ne*(.215638*Ne-1.06021)))}const Mi=Ct.sub(At)._mult(St)._add(At)._unit();this.addHalfVertex(Z,Mi.x,Mi.y,!1,tt,0,H,hi)}this.addHalfVertex(Z,Ct.x,Ct.y,!1,tt,0,H,hi)}Ke||fe!=null||this.addHalfVertex(Z,Qe.x+2*Ct.x,Qe.y+2*Ct.y,!1,tt,0,H,hi),fe!=null&&oe&&this.addCurrentVertex(Z,re||q,1,1,H,fe)}else if(Re==="butt")this.addCurrentVertex(Z,Je,0,0,H,fe);else if(Re==="square"){if(!ee){const Ke=I?0:-1;this.addCurrentVertex(Z,Je,Ke,Ke,H,fe)}if(this.addCurrentVertex(Z,Je,0,0,H,fe),ee){const Ke=P?0:1;this.addCurrentVertex(Z,Je,Ke,Ke,H,fe)}}else if(Re==="round"){if(ee){const Ke=!Ce&&le?le:ae;this.addCurrentVertex(Z,Ke,0,0,H,fe),!Ce&&P||this.addCurrentVertex(Z,Ke,1,1,H,fe,!0)}if(oe){const Ke=!Ce&&re?re:q;!Ce&&I||this.addCurrentVertex(Z,Ke,-1,-1,H,fe,!0),this.addCurrentVertex(Z,Ke,0,0,H,fe)}}}}addVerticesTo(e,i,o,a,h,d,x,w,T,I){const P=(i.w-e.w)/this.tessellationStep|0;let R=0;const F=this.scaledDistance;if(P>1){this.lineSoFar=e.w;const H=(i.x-e.x)/P,Z=(i.y-e.y)/P,ee=(i.z-e.z)/P,oe=(i.w-e.w)/P;for(let ae=1;ae<P;++ae){e.x+=H,e.y+=Z,e.z+=ee,this.lineSoFar+=oe,R+=oe;const q=this.evaluateLineProgressFeatures(this.prevDistance+R);this.scaledDistance=(this.prevDistance+R)/this.totalDistance,this.addHalfVertex(e,o,a,I,!1,x,T,q),this.addHalfVertex(e,h,d,I,!0,-w,T,q)}}this.lineSoFar=i.w,this.scaledDistance=F;const N=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,o,a,I,!1,x,T,N),this.addHalfVertex(i,h,d,I,!0,-w,T,N)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):zi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,o,a,h,d,x=!1){const w=i.x+i.y*o,T=i.y-i.x*o,I=i.y*a-i.x,P=-i.y-i.x*a;if(d!=null){const R=this.elevationType==="offset",F=-10,N=Lt+10,H=d.zOffset,Z=new rw(e.x,e.y,H,this.lineSoFar),ee=!!R&&u0(e,F,N),oe=this.lineSoFar,ae=this.distance;if(this.currentVertex)if(ee){const q=this.currentVertexIsOutside,re=this.currentVertex,le=new rw(e.x,e.y,H,this.lineSoFar);if(ow(re,le,F,N),!u0(le,F,N)){if(q){this.e1=this.e2=-1,this.distance-=re.dist(Z),this.lineSoFar=re.w;const fe=this.evaluateLineProgressFeatures(re.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(re,w,T,x,!1,o,h,fe),this.addHalfVertex(re,I,P,x,!0,-a,h,fe),this.prevDistance=this.distance}this.distance=this.prevDistance+re.dist(le),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(re,le,w,T,I,P,o,a,h,x),this.distance=ae,this.scaledDistance=this.distance/this.totalDistance}}else{const q=this.currentVertex;if(this.currentVertexIsOutside){ow(q,Z,F,N),this.e1=this.e2=-1,this.distance-=q.dist(Z),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=q.w;const re=this.evaluateLineProgressFeatures(q.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(q,w,T,x,!1,o,h,re),this.addHalfVertex(q,I,P,x,!0,-a,h,re),this.prevDistance=this.distance,this.distance=ae,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(q,Z,w,T,I,P,o,a,h,x)}else ee||(this.addHalfVertex(e,w,T,x,!1,o,h,d),this.addHalfVertex(e,I,P,x,!0,-a,h,d));this.currentVertex=Z,this.currentVertexIsOutside=ee,this.lineSoFar=oe}else this.addHalfVertex(e,w,T,x,!1,o,h,d),this.addHalfVertex(e,I,P,x,!0,-a,h,d)}addHalfVertex({x:e,y:i},o,a,h,d,x,w,T){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),d||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(i<<1)+(d?1:0),Math.round(63*o)+128,Math.round(63*a)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const P=gi(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,P)}const I=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),w.primitiveLength++),d?this.e2=I:this.e1=I,T!=null&&this.zOffsetVertexArray.emplaceBack(T.zOffset,T.variableWidth,T.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function u0(n,e,i){return n.x<e||n.x>i||n.y<e||n.y>i}let Sw,Ew;function Cw(n,e,i){return e*(Lt/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}qt(c0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Aw=(n,e,i)=>(1-i)*n+i*e;function Iw(n,e){return 1/Cw(n,1,e.tileZoom)}function Pw(n,e,i,o){return n.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Mw=n=>{const e=[];Rw(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=n.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=n.layout.get("line-join").constantOr("miter")==="none",a=!!n.paint.get("line-pattern").constantOr(1);return o&&a&&e.push("LINE_JOIN_NONE"),e};function Rw(n){const e=n.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let h0;const kw=()=>h0||(h0={layout:Sw||(Sw=new ur({"line-cap":new kt(je.layout_line["line-cap"]),"line-join":new kt(je.layout_line["line-join"]),"line-miter-limit":new wt(je.layout_line["line-miter-limit"]),"line-round-limit":new wt(je.layout_line["line-round-limit"]),"line-sort-key":new kt(je.layout_line["line-sort-key"]),"line-z-offset":new kt(je.layout_line["line-z-offset"]),"line-elevation-reference":new wt(je.layout_line["line-elevation-reference"]),"line-cross-slope":new wt(je.layout_line["line-cross-slope"]),visibility:new wt(je.layout_line.visibility),"line-width-unit":new wt(je.layout_line["line-width-unit"])})),paint:Ew||(Ew=new ur({"line-opacity":new kt(je.paint_line["line-opacity"]),"line-color":new kt(je.paint_line["line-color"]),"line-translate":new wt(je.paint_line["line-translate"]),"line-translate-anchor":new wt(je.paint_line["line-translate-anchor"]),"line-width":new kt(je.paint_line["line-width"]),"line-gap-width":new kt(je.paint_line["line-gap-width"]),"line-offset":new kt(je.paint_line["line-offset"]),"line-blur":new kt(je.paint_line["line-blur"]),"line-dasharray":new kt(je.paint_line["line-dasharray"]),"line-pattern":new kt(je.paint_line["line-pattern"]),"line-pattern-cross-fade":new wt(je.paint_line["line-pattern-cross-fade"]),"line-gradient":new pl(je.paint_line["line-gradient"]),"line-trim-offset":new wt(je.paint_line["line-trim-offset"]),"line-trim-fade-range":new wt(je.paint_line["line-trim-fade-range"]),"line-trim-color":new wt(je.paint_line["line-trim-color"]),"line-emissive-strength":new wt(je.paint_line["line-emissive-strength"]),"line-border-width":new kt(je.paint_line["line-border-width"]),"line-border-color":new kt(je.paint_line["line-border-color"]),"line-occlusion-opacity":new wt(je.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},h0);class hA extends kt{possiblyEvaluate(e,i){return i=new Pn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,a){return i=He({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,a)}}let qm;function Dw(n,e){return e>0?e+2*n:n}const dA=hn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),fA=hn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),pA=hn([{name:"a_projected_pos",components:4,type:"Float32"}],4);hn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const mA=hn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),gA=hn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),_A=hn([{name:"a_texb",components:2,type:"Uint16"}]),yA=hn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),xA=hn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);hn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Lw=hn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),vA=hn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);hn([{name:"triangle",components:3,type:"Uint16"}]),hn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),hn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),hn([{type:"Float32",name:"offsetX"}]),hn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Ps=24;function wA(n,e,i){return n.sections.forEach(o=>{o.text=function(a,h,d){const x=h.layout.get("text-transform").evaluate(d,{});return x==="uppercase"?a=a.toLocaleUpperCase():x==="lowercase"&&(a=a.toLocaleLowerCase()),ca.applyArabicShaping&&(a=ca.applyArabicShaping(a)),a}(o.text,e,i)}),n}const Zm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function bA(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}function TA(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}var zw,d0,Fw,f0={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function SA(){return zw||(zw=1,f0.read=function(n,e,i,o,a){var h,d,x=8*a-o-1,w=(1<<x)-1,T=w>>1,I=-7,P=i?a-1:0,R=i?-1:1,F=n[e+P];for(P+=R,h=F&(1<<-I)-1,F>>=-I,I+=x;I>0;h=256*h+n[e+P],P+=R,I-=8);for(d=h&(1<<-I)-1,h>>=-I,I+=o;I>0;d=256*d+n[e+P],P+=R,I-=8);if(h===0)h=1-T;else{if(h===w)return d?NaN:1/0*(F?-1:1);d+=Math.pow(2,o),h-=T}return(F?-1:1)*d*Math.pow(2,h-o)},f0.write=function(n,e,i,o,a,h){var d,x,w,T=8*h-a-1,I=(1<<T)-1,P=I>>1,R=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=o?0:h-1,N=o?1:-1,H=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,d=I):(d=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-d))<1&&(d--,w*=2),(e+=d+P>=1?R/w:R*Math.pow(2,1-P))*w>=2&&(d++,w/=2),d+P>=I?(x=0,d=I):d+P>=1?(x=(e*w-1)*Math.pow(2,a),d+=P):(x=e*Math.pow(2,P-1)*Math.pow(2,a),d=0));a>=8;n[i+F]=255&x,F+=N,x/=256,a-=8);for(d=d<<a|x,T+=a;T>0;n[i+F]=255&d,F+=N,d/=256,T-=8);n[i+F-N]|=128*H}),f0}function Ow(){if(Fw)return d0;Fw=1,d0=e;var n=SA();function e(q){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(q)?q:new Uint8Array(q||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,o=1/i,a=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function h(q){return q.type===e.Bytes?q.readVarint()+q.pos:q.pos+1}function d(q,re,le){return le?4294967296*re+(q>>>0):4294967296*(re>>>0)+(q>>>0)}function x(q,re,le){var fe=re<=16383?1:re<=2097151?2:re<=268435455?3:Math.floor(Math.log(re)/(7*Math.LN2));le.realloc(fe);for(var Me=le.pos-1;Me>=q;Me--)le.buf[Me+fe]=le.buf[Me]}function w(q,re){for(var le=0;le<q.length;le++)re.writeVarint(q[le])}function T(q,re){for(var le=0;le<q.length;le++)re.writeSVarint(q[le])}function I(q,re){for(var le=0;le<q.length;le++)re.writeFloat(q[le])}function P(q,re){for(var le=0;le<q.length;le++)re.writeDouble(q[le])}function R(q,re){for(var le=0;le<q.length;le++)re.writeBoolean(q[le])}function F(q,re){for(var le=0;le<q.length;le++)re.writeFixed32(q[le])}function N(q,re){for(var le=0;le<q.length;le++)re.writeSFixed32(q[le])}function H(q,re){for(var le=0;le<q.length;le++)re.writeFixed64(q[le])}function Z(q,re){for(var le=0;le<q.length;le++)re.writeSFixed64(q[le])}function ee(q,re){return(q[re]|q[re+1]<<8|q[re+2]<<16)+16777216*q[re+3]}function oe(q,re,le){q[le]=re,q[le+1]=re>>>8,q[le+2]=re>>>16,q[le+3]=re>>>24}function ae(q,re){return(q[re]|q[re+1]<<8|q[re+2]<<16)+(q[re+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(q,re,le){for(le=le||this.length;this.pos<le;){var fe=this.readVarint(),Me=fe>>3,Ce=this.pos;this.type=7&fe,q(Me,re,this),this.pos===Ce&&this.skip(fe)}return re},readMessage:function(q,re){return this.readFields(q,re,this.readVarint()+this.pos)},readFixed32:function(){var q=ee(this.buf,this.pos);return this.pos+=4,q},readSFixed32:function(){var q=ae(this.buf,this.pos);return this.pos+=4,q},readFixed64:function(){var q=ee(this.buf,this.pos)+ee(this.buf,this.pos+4)*i;return this.pos+=8,q},readSFixed64:function(){var q=ee(this.buf,this.pos)+ae(this.buf,this.pos+4)*i;return this.pos+=8,q},readFloat:function(){var q=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,q},readDouble:function(){var q=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,q},readVarint:function(q){var re,le,fe=this.buf;return re=127&(le=fe[this.pos++]),le<128?re:(re|=(127&(le=fe[this.pos++]))<<7,le<128?re:(re|=(127&(le=fe[this.pos++]))<<14,le<128?re:(re|=(127&(le=fe[this.pos++]))<<21,le<128?re:function(Me,Ce,Re){var Ne,Je,gt=Re.buf;if(Ne=(112&(Je=gt[Re.pos++]))>>4,Je<128||(Ne|=(127&(Je=gt[Re.pos++]))<<3,Je<128)||(Ne|=(127&(Je=gt[Re.pos++]))<<10,Je<128)||(Ne|=(127&(Je=gt[Re.pos++]))<<17,Je<128)||(Ne|=(127&(Je=gt[Re.pos++]))<<24,Je<128)||(Ne|=(1&(Je=gt[Re.pos++]))<<31,Je<128))return d(Me,Ne,Ce);throw new Error("Expected varint not more than 10 bytes")}(re|=(15&(le=fe[this.pos]))<<28,q,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var q=this.readVarint();return q%2==1?(q+1)/-2:q/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var q=this.readVarint()+this.pos,re=this.pos;return this.pos=q,q-re>=12&&a?function(le,fe,Me){return a.decode(le.subarray(fe,Me))}(this.buf,re,q):function(le,fe,Me){for(var Ce="",Re=fe;Re<Me;){var Ne,Je,gt,ct=le[Re],mt=null,xt=ct>239?4:ct>223?3:ct>191?2:1;if(Re+xt>Me)break;xt===1?ct<128&&(mt=ct):xt===2?(192&(Ne=le[Re+1]))==128&&(mt=(31&ct)<<6|63&Ne)<=127&&(mt=null):xt===3?(Je=le[Re+2],(192&(Ne=le[Re+1]))==128&&(192&Je)==128&&((mt=(15&ct)<<12|(63&Ne)<<6|63&Je)<=2047||mt>=55296&&mt<=57343)&&(mt=null)):xt===4&&(Je=le[Re+2],gt=le[Re+3],(192&(Ne=le[Re+1]))==128&&(192&Je)==128&&(192&gt)==128&&((mt=(15&ct)<<18|(63&Ne)<<12|(63&Je)<<6|63&gt)<=65535||mt>=1114112)&&(mt=null)),mt===null?(mt=65533,xt=1):mt>65535&&(mt-=65536,Ce+=String.fromCharCode(mt>>>10&1023|55296),mt=56320|1023&mt),Ce+=String.fromCharCode(mt),Re+=xt}return Ce}(this.buf,re,q)},readBytes:function(){var q=this.readVarint()+this.pos,re=this.buf.subarray(this.pos,q);return this.pos=q,re},readPackedVarint:function(q,re){if(this.type!==e.Bytes)return q.push(this.readVarint(re));var le=h(this);for(q=q||[];this.pos<le;)q.push(this.readVarint(re));return q},readPackedSVarint:function(q){if(this.type!==e.Bytes)return q.push(this.readSVarint());var re=h(this);for(q=q||[];this.pos<re;)q.push(this.readSVarint());return q},readPackedBoolean:function(q){if(this.type!==e.Bytes)return q.push(this.readBoolean());var re=h(this);for(q=q||[];this.pos<re;)q.push(this.readBoolean());return q},readPackedFloat:function(q){if(this.type!==e.Bytes)return q.push(this.readFloat());var re=h(this);for(q=q||[];this.pos<re;)q.push(this.readFloat());return q},readPackedDouble:function(q){if(this.type!==e.Bytes)return q.push(this.readDouble());var re=h(this);for(q=q||[];this.pos<re;)q.push(this.readDouble());return q},readPackedFixed32:function(q){if(this.type!==e.Bytes)return q.push(this.readFixed32());var re=h(this);for(q=q||[];this.pos<re;)q.push(this.readFixed32());return q},readPackedSFixed32:function(q){if(this.type!==e.Bytes)return q.push(this.readSFixed32());var re=h(this);for(q=q||[];this.pos<re;)q.push(this.readSFixed32());return q},readPackedFixed64:function(q){if(this.type!==e.Bytes)return q.push(this.readFixed64());var re=h(this);for(q=q||[];this.pos<re;)q.push(this.readFixed64());return q},readPackedSFixed64:function(q){if(this.type!==e.Bytes)return q.push(this.readSFixed64());var re=h(this);for(q=q||[];this.pos<re;)q.push(this.readSFixed64());return q},skip:function(q){var re=7&q;if(re===e.Varint)for(;this.buf[this.pos++]>127;);else if(re===e.Bytes)this.pos=this.readVarint()+this.pos;else if(re===e.Fixed32)this.pos+=4;else{if(re!==e.Fixed64)throw new Error("Unimplemented type: "+re);this.pos+=8}},writeTag:function(q,re){this.writeVarint(q<<3|re)},realloc:function(q){for(var re=this.length||16;re<this.pos+q;)re*=2;if(re!==this.length){var le=new Uint8Array(re);le.set(this.buf),this.buf=le,this.length=re}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(q){this.realloc(4),oe(this.buf,q,this.pos),this.pos+=4},writeSFixed32:function(q){this.realloc(4),oe(this.buf,q,this.pos),this.pos+=4},writeFixed64:function(q){this.realloc(8),oe(this.buf,-1&q,this.pos),oe(this.buf,Math.floor(q*o),this.pos+4),this.pos+=8},writeSFixed64:function(q){this.realloc(8),oe(this.buf,-1&q,this.pos),oe(this.buf,Math.floor(q*o),this.pos+4),this.pos+=8},writeVarint:function(q){(q=+q||0)>268435455||q<0?function(re,le){var fe,Me;if(re>=0?(fe=re%4294967296|0,Me=re/4294967296|0):(Me=~(-re/4294967296),4294967295^(fe=~(-re%4294967296))?fe=fe+1|0:(fe=0,Me=Me+1|0)),re>=18446744073709552e3||re<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");le.realloc(10),function(Ce,Re,Ne){Ne.buf[Ne.pos++]=127&Ce|128,Ce>>>=7,Ne.buf[Ne.pos++]=127&Ce|128,Ce>>>=7,Ne.buf[Ne.pos++]=127&Ce|128,Ce>>>=7,Ne.buf[Ne.pos++]=127&Ce|128,Ne.buf[Ne.pos]=127&(Ce>>>=7)}(fe,0,le),function(Ce,Re){var Ne=(7&Ce)<<4;Re.buf[Re.pos++]|=Ne|((Ce>>>=3)?128:0),Ce&&(Re.buf[Re.pos++]=127&Ce|((Ce>>>=7)?128:0),Ce&&(Re.buf[Re.pos++]=127&Ce|((Ce>>>=7)?128:0),Ce&&(Re.buf[Re.pos++]=127&Ce|((Ce>>>=7)?128:0),Ce&&(Re.buf[Re.pos++]=127&Ce|((Ce>>>=7)?128:0),Ce&&(Re.buf[Re.pos++]=127&Ce)))))}(Me,le)}(q,this):(this.realloc(4),this.buf[this.pos++]=127&q|(q>127?128:0),q<=127||(this.buf[this.pos++]=127&(q>>>=7)|(q>127?128:0),q<=127||(this.buf[this.pos++]=127&(q>>>=7)|(q>127?128:0),q<=127||(this.buf[this.pos++]=q>>>7&127))))},writeSVarint:function(q){this.writeVarint(q<0?2*-q-1:2*q)},writeBoolean:function(q){this.writeVarint(!!q)},writeString:function(q){q=String(q),this.realloc(4*q.length),this.pos++;var re=this.pos;this.pos=function(fe,Me,Ce){for(var Re,Ne,Je=0;Je<Me.length;Je++){if((Re=Me.charCodeAt(Je))>55295&&Re<57344){if(!Ne){Re>56319||Je+1===Me.length?(fe[Ce++]=239,fe[Ce++]=191,fe[Ce++]=189):Ne=Re;continue}if(Re<56320){fe[Ce++]=239,fe[Ce++]=191,fe[Ce++]=189,Ne=Re;continue}Re=Ne-55296<<10|Re-56320|65536,Ne=null}else Ne&&(fe[Ce++]=239,fe[Ce++]=191,fe[Ce++]=189,Ne=null);Re<128?fe[Ce++]=Re:(Re<2048?fe[Ce++]=Re>>6|192:(Re<65536?fe[Ce++]=Re>>12|224:(fe[Ce++]=Re>>18|240,fe[Ce++]=Re>>12&63|128),fe[Ce++]=Re>>6&63|128),fe[Ce++]=63&Re|128)}return Ce}(this.buf,q,this.pos);var le=this.pos-re;le>=128&&x(re,le,this),this.pos=re-1,this.writeVarint(le),this.pos+=le},writeFloat:function(q){this.realloc(4),n.write(this.buf,q,this.pos,!0,23,4),this.pos+=4},writeDouble:function(q){this.realloc(8),n.write(this.buf,q,this.pos,!0,52,8),this.pos+=8},writeBytes:function(q){var re=q.length;this.writeVarint(re),this.realloc(re);for(var le=0;le<re;le++)this.buf[this.pos++]=q[le]},writeRawMessage:function(q,re){this.pos++;var le=this.pos;q(re,this);var fe=this.pos-le;fe>=128&&x(le,fe,this),this.pos=le-1,this.writeVarint(fe),this.pos+=fe},writeMessage:function(q,re,le){this.writeTag(q,e.Bytes),this.writeRawMessage(re,le)},writePackedVarint:function(q,re){re.length&&this.writeMessage(q,w,re)},writePackedSVarint:function(q,re){re.length&&this.writeMessage(q,T,re)},writePackedBoolean:function(q,re){re.length&&this.writeMessage(q,R,re)},writePackedFloat:function(q,re){re.length&&this.writeMessage(q,I,re)},writePackedDouble:function(q,re){re.length&&this.writeMessage(q,P,re)},writePackedFixed32:function(q,re){re.length&&this.writeMessage(q,F,re)},writePackedSFixed32:function(q,re){re.length&&this.writeMessage(q,N,re)},writePackedFixed64:function(q,re){re.length&&this.writeMessage(q,H,re)},writePackedSFixed64:function(q,re){re.length&&this.writeMessage(q,Z,re)},writeBytesField:function(q,re){this.writeTag(q,e.Bytes),this.writeBytes(re)},writeFixed32Field:function(q,re){this.writeTag(q,e.Fixed32),this.writeFixed32(re)},writeSFixed32Field:function(q,re){this.writeTag(q,e.Fixed32),this.writeSFixed32(re)},writeFixed64Field:function(q,re){this.writeTag(q,e.Fixed64),this.writeFixed64(re)},writeSFixed64Field:function(q,re){this.writeTag(q,e.Fixed64),this.writeSFixed64(re)},writeVarintField:function(q,re){this.writeTag(q,e.Varint),this.writeVarint(re)},writeSVarintField:function(q,re){this.writeTag(q,e.Varint),this.writeSVarint(re)},writeStringField:function(q,re){this.writeTag(q,e.Bytes),this.writeString(re)},writeFloatField:function(q,re){this.writeTag(q,e.Fixed32),this.writeFloat(re)},writeDoubleField:function(q,re){this.writeTag(q,e.Fixed64),this.writeDouble(re)},writeBooleanField:function(q,re){this.writeVarintField(q,!!re)}},d0}var f_=ba(Ow());const p0=3;function EA(n,e,i){e.glyphs=[],n===1&&i.readMessage(CA,e)}function CA(n,e,i){if(n===3){const{id:o,bitmap:a,width:h,height:d,left:x,top:w,advance:T}=i.readMessage(AA,{});e.glyphs.push({id:o,bitmap:new cf({width:h+2*p0,height:d+2*p0},a),metrics:{width:h,height:d,left:x,top:w,advance:T}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function AA(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const IA=p0,ma={horizontal:1,vertical:2,horizontalOnly:3};class Xm{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const o=new Xm;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new Xm;return i.image=e,i}}class Zp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,o){const a=new Zp;for(let h=0;h<e.sections.length;h++){const d=e.sections[h];d.image?a.addImageSection(d,o):a.addTextSection(d,i)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,o){let a="";for(let h=0;h<i.length;h++){const d=i.charCodeAt(h+1)||null,x=i.charCodeAt(h-1)||null;a+=!o&&(d&&Bh(d)&&!Zm[i[h+1]]||x&&Bh(x)&&!Zm[i[h-1]])||!Zm[i[h]]?i[h]:Zm[i[h]]}return a}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&p_[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&p_[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new Zp;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Xm.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(o)}addImageSection(e,i){const o=e.image?e.image.getPrimary():null;if(!o)return void zi("Can't add FormattedSection with an empty image.");o.scaleSelf(i);const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Xm.forImage(o)),this.sectionIndex.push(this.sections.length-1)):zi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function m0(n,e,i,o,a,h,d,x,w,T,I,P,R,F,N,H=1){const Z=Zp.fromFeature(n,a,H);P===ma.vertical&&Z.verticalizePunctuation(R);let ee=[];const oe=function(fe,Me,Ce,Re,Ne,Je){if(!fe)return[];const gt=[],ct=function(ft,Ke,Qe,Ct,At,hi){let ii=0;for(let Ut=0;Ut<ft.length();Ut++){const St=ft.getSection(Ut);ii+=Nw(ft.getCodePoint(Ut),St,Ct,At,Ke,hi)}return ii/Math.max(1,Math.ceil(ii/Qe))}(fe,Me,Ce,Re,Ne,Je),mt=fe.text.indexOf("")>=0;let xt=0;for(let ft=0;ft<fe.length();ft++){const Ke=fe.getSection(ft),Qe=fe.getCodePoint(ft);if(p_[Qe]||(xt+=Nw(Qe,Ke,Re,Ne,Me,Je)),ft<fe.length()-1){const Ct=!((tt=Qe)<11904||!(fi["Bopomofo Extended"](tt)||fi.Bopomofo(tt)||fi["CJK Compatibility Forms"](tt)||fi["CJK Compatibility Ideographs"](tt)||fi["CJK Compatibility"](tt)||fi["CJK Radicals Supplement"](tt)||fi["CJK Strokes"](tt)||fi["CJK Symbols and Punctuation"](tt)||fi["CJK Unified Ideographs Extension A"](tt)||fi["CJK Unified Ideographs"](tt)||fi["Enclosed CJK Letters and Months"](tt)||fi["Halfwidth and Fullwidth Forms"](tt)||fi.Hiragana(tt)||fi["Ideographic Description Characters"](tt)||fi["Kangxi Radicals"](tt)||fi["Katakana Phonetic Extensions"](tt)||fi.Katakana(tt)||fi["Vertical Forms"](tt)||fi["Yi Radicals"](tt)||fi["Yi Syllables"](tt)));(PA[Qe]||Ct||Ke.image)&&gt.push(jw(ft+1,xt,ct,gt,MA(Qe,fe.getCodePoint(ft+1),Ct&&mt),!1))}}var tt;return Vw(jw(fe.length(),xt,ct,gt,0,!0))}(Z,T,h,e,o,F),{processBidirectionalText:ae,processStyledBidirectionalText:q}=ca;if(ae&&Z.sections.length===1){const fe=ae(Z.toString(),oe);for(const Me of fe){const Ce=new Zp;Ce.text=Me,Ce.sections=Z.sections;for(let Re=0;Re<Me.length;Re++)Ce.sectionIndex.push(0);ee.push(Ce)}}else if(q){const fe=q(Z.text,Z.sectionIndex,oe);for(const Me of fe){const Ce=new Zp;Ce.text=Me[0],Ce.sectionIndex=Me[1],Ce.sections=Z.sections,ee.push(Ce)}}else ee=function(fe,Me){const Ce=[],Re=fe.text;let Ne=0;for(const Je of Me)Ce.push(fe.substring(Ne,Je)),Ne=Je;return Ne<Re.length&&Ce.push(fe.substring(Ne,Re.length)),Ce}(Z,oe);const re=[],le={positionedLines:re,text:Z.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(fe,Me,Ce,Re,Ne,Je,gt,ct,mt,xt,tt,ft){let Ke=0,Qe=0,Ct=0;const At=ct==="right"?1:ct==="left"?0:.5;let hi=!1;for(const ni of Ne){const Ti=ni.getSections();for(const Vi of Ti){if(Vi.image)continue;const Oi=Me[Vi.fontStack];if(Oi&&(hi=Oi.ascender!==void 0&&Oi.descender!==void 0,!hi))break}if(!hi)break}let ii=0;for(const ni of Ne){ni.trim();const Ti=ni.getMaxScale(),Vi=(Ti-1)*Ps,Oi={positionedGlyphs:[],lineOffset:0};fe.positionedLines[ii]=Oi;const Ki=Oi.positionedGlyphs;let Ui=0;if(!ni.length()){Qe+=Je,++ii;continue}let Ji=0,Rn=0;for(let he=0;he<ni.length();he++){const ye=ni.getSection(he),rt=ni.getSectionIndex(he),Pt=ni.getCodePoint(he);let Gt=ye.scale,Vt=null,Qt=null,bi=null,rn=Ps,sn=0;mt===ma.vertical&&((Ut=Pt)===12312||Ut===12313||Ut===12316||Ut===12540||Ut===12448)&&(mt=ma.horizontal);const Gi=!(mt===ma.horizontal||!tt&&!jd(Pt)||tt&&(p_[Pt]||kp(Pt)));if(ye.image){const Fn=Re.get(ye.image.toString());if(!Fn)continue;bi=ye.image,fe.iconsInText=fe.iconsInText||!0,Qt=Fn.paddedRect;const Jn=Fn.displaySize;Gt=Gt*Ps/ft,Vt={width:Jn[0],height:Jn[1],left:0,top:-3,advance:Gi?Jn[1]:Jn[0],localGlyph:!1},sn=hi?-Vt.height*Gt:Ti*Ps-17-Jn[1]*Gt,rn=Vt.advance;const on=(Gi?Jn[0]:Jn[1])*Gt-Ps*Ti;on>0&&on>Ui&&(Ui=on)}else{const Fn=Ce[ye.fontStack];if(!Fn)continue;Fn[Pt]&&(Qt=Fn[Pt]);const Jn=Me[ye.fontStack];if(!Jn)continue;const on=Jn.glyphs[Pt];if(!on)continue;if(Vt=on.metrics,rn=Pt!==8203?Ps:0,hi){const wr=Jn.ascender!==void 0?Math.abs(Jn.ascender):0,rr=Jn.descender!==void 0?Math.abs(Jn.descender):0,kn=(wr+rr)*Gt;Ji<kn&&(Ji=kn,Rn=(wr-rr)/2*Gt),sn=-wr*Gt}else sn=(Ti-Gt)*Ps-17}Gi?(fe.verticalizable=!0,Ki.push({glyph:Pt,image:bi,x:Ke,y:Qe+sn,vertical:Gi,scale:Gt,localGlyph:Vt.localGlyph,fontStack:ye.fontStack,sectionIndex:rt,metrics:Vt,rect:Qt}),Ke+=rn*Gt+xt):(Ki.push({glyph:Pt,image:bi,x:Ke,y:Qe+sn,vertical:Gi,scale:Gt,localGlyph:Vt.localGlyph,fontStack:ye.fontStack,sectionIndex:rt,metrics:Vt,rect:Qt}),Ke+=Vt.advance*Gt+xt)}Ki.length!==0&&(Ct=Math.max(Ke-xt,Ct),hi?Uw(Ki,At,Ui,Rn,Je*Ti/2):Uw(Ki,At,Ui,0,Je/2)),Ke=0;const nr=Je*Ti+Ui;Oi.lineOffset=Math.max(Ui,Vi),Qe+=nr,++ii}var Ut;const St=Qe,{horizontalAlign:Mi,verticalAlign:ti}=g0(gt);(function(ni,Ti,Vi,Oi,Ki,Ui){const Ji=(Ti-Vi)*Ki,Rn=-Ui*Oi;for(const nr of ni)for(const he of nr.positionedGlyphs)he.x+=Ji,he.y+=Rn})(fe.positionedLines,At,Mi,ti,Ct,St),fe.top+=-ti*St,fe.bottom=fe.top+St,fe.left+=-Mi*Ct,fe.right=fe.left+Ct,fe.hasBaseline=hi}(le,e,i,o,ee,d,x,w,P,T,R,N),!function(fe){for(const Me of fe)if(Me.positionedGlyphs.length!==0)return!1;return!0}(re))return le}const p_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},PA={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Nw(n,e,i,o,a,h){if(e.image){const d=o.get(e.image.toString());return d?d.displaySize[0]*e.scale*Ps/h+a:0}{const d=i[e.fontStack],x=d&&d.glyphs[n];return x?x.metrics.advance*e.scale+a:0}}function Bw(n,e,i,o){const a=Math.pow(n-e,2);return o?n<e?a/2:2*a:a+Math.abs(i)*i}function MA(n,e,i){let o=0;return n===10&&(o-=1e4),i&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function jw(n,e,i,o,a,h){let d=null,x=Bw(e,i,a,h);for(const w of o){const T=Bw(e-w.x,i,a,h)+w.badness;T<=x&&(d=w,x=T)}return{index:n,x:e,priorBreak:d,badness:x}}function Vw(n){return n?Vw(n.priorBreak).concat(n.index):[]}function g0(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Uw(n,e,i,o,a){if(!(e||i||o||a))return;const h=n.length-1,d=n[h],x=(d.x+d.metrics.advance*d.scale)*e;for(let w=0;w<=h;w++)n[w].x-=x,n[w].y+=i+o+a}function Gw(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function RA(n,e,i,o){const{horizontalAlign:a,verticalAlign:h}=g0(o),d=i[0]-n.displaySize[0]*a,x=i[1]-n.displaySize[1]*h;return{imagePrimary:n,imageSecondary:e,top:x,bottom:x+n.displaySize[1],left:d,right:d+n.displaySize[0]}}function $w(n,e,i,o,a,h){const d=n.imagePrimary;let x;if(d.content){const Z=d.content,ee=d.pixelRatio||1;x=[Z[0]/ee,Z[1]/ee,d.displaySize[0]-Z[2]/ee,d.displaySize[1]-Z[3]/ee]}const w=e.left*h,T=e.right*h;let I,P,R,F;i==="width"||i==="both"?(F=a[0]+w-o[3],P=a[0]+T+o[1]):(F=a[0]+(w+T-d.displaySize[0])/2,P=F+d.displaySize[0]);const N=e.top*h,H=e.bottom*h;return i==="height"||i==="both"?(I=a[1]+N-o[0],R=a[1]+H+o[2]):(I=a[1]+(N+H-d.displaySize[1])/2,R=I+d.displaySize[1]),{imagePrimary:d,imageSecondary:void 0,top:I,right:P,bottom:R,left:F,collisionPadding:x}}function Hw(n){return!n.imagePrimary.stretchX}function Ww(n){return!n.imagePrimary.stretchY}function qw(n){return{width:n.right-n.left,height:n.bottom-n.top}}const sh=128;function Zw(n,e,i){const{expression:o}=e;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new Pn(n+1,{worldview:i}))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:h}=o;let d=0;for(;d<a.length&&a[d]<=n;)d++;d=Math.max(0,d-1);let x=d;for(;x<a.length&&a[x]<n+1;)x++;x=Math.min(a.length-1,x);const w=a[d],T=a[x];return o.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:h}:{kind:"camera",minZoom:w,maxZoom:T,minSize:o.evaluate(new Pn(w,{worldview:i})),maxSize:o.evaluate(new Pn(T,{worldview:i})),interpolationType:h}}}function _0(n,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:a}){return n.kind==="source"?o/sh:n.kind==="composite"?gi(o/sh,a/sh,i):e}function Ym(n,e,i=1){let o=0,a=0;if(n.kind==="constant")a=n.layoutSize*i;else if(n.kind!=="source"){const{interpolationType:h,minZoom:d,maxZoom:x}=n,w=h?we(fs.interpolationFactor(h,e,d,x),0,1):0;n.kind==="camera"?a=gi(n.minSize,n.maxSize,w)*i:o=w*i}return{uSizeT:o,uSize:a}}class nd extends Rt{constructor(e,i,o,a,h){super(e,i),this.angle=a,this.z=o,h!==void 0&&(this.segment=h)}clone(){return new nd(this.x,this.y,this.z,this.angle,this.segment)}}function Xw(n,e,i,o,a){if(e.segment===void 0)return!0;let h=e,d=e.segment+1,x=0;for(;x>-i/2;){if(d--,d<0)return!1;x-=n[d].dist(h),h=n[d]}x+=n[d].dist(n[d+1]),d++;const w=[];let T=0;for(;x<i/2;){const I=n[d],P=n[d+1];if(!P)return!1;let R=n[d-1].angleTo(I)-I.angleTo(P);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:R}),T+=R;x-w[0].distance>o;)T-=w.shift().angleDelta;if(T>a)return!1;d++,x+=I.dist(P)}return!0}function Yw(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function Kw(n,e,i){return n?.6*e*i:0}function Jw(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function kA(n,e,i,o,a,h){const d=Kw(i,a,h),x=Jw(i,o)*h;let w=0;const T=Yw(n)/2;for(let I=0;I<n.length-1;I++){const P=n[I],R=n[I+1],F=P.dist(R);if(w+F>T){const N=(T-w)/F,H=gi(P.x,R.x,N),Z=gi(P.y,R.y,N),ee=new nd(H,Z,0,R.angleTo(P),I);return!d||Xw(n,ee,x,d,e)?ee:void 0}w+=F}}function DA(n,e,i,o,a,h,d,x,w){const T=Kw(o,h,d),I=Jw(o,a),P=I*d,R=n[0].x===0||n[0].x===w||n[0].y===0||n[0].y===w;return e-P<e/4&&(e=P+e/4),Qw(n,R?e/2*x%e:(I/2+2*h)*d*x%e,e,T,i,P,R,!1,w)}function Qw(n,e,i,o,a,h,d,x,w){const T=h/2,I=Yw(n);let P=0,R=e-i,F=[];for(let N=0;N<n.length-1;N++){const H=n[N],Z=n[N+1],ee=H.dist(Z),oe=Z.angleTo(H);for(;R+i<P+ee;){R+=i;const ae=(R-P)/ee,q=gi(H.x,Z.x,ae),re=gi(H.y,Z.y,ae);if(q>=0&&q<w&&re>=0&&re<w&&R-T>=0&&R+T<=I){const le=new nd(q,re,0,oe,N);o&&!Xw(n,le,h,o,a)||F.push(le)}}P+=ee}return x||F.length||d||(F=Qw(n,P/2,i,o,a,h,d,!0,w)),F}function eb(n){let e=0,i=0;for(const d of n)e+=d.w*d.h,i=Math.max(i,d.w);n.sort((d,x)=>x.h-d.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let a=0,h=0;for(const d of n)for(let x=o.length-1;x>=0;x--){const w=o[x];if(!(d.w>w.w||d.h>w.h)){if(d.x=w.x,d.y=w.y,h=Math.max(h,d.y+d.h),a=Math.max(a,d.x+d.w),d.w===w.w&&d.h===w.h){const T=o.pop();x<o.length&&(o[x]=T)}else d.h===w.h?(w.x+=d.w,w.w-=d.w):d.w===w.w?(w.y+=d.h,w.h-=d.h):(o.push({x:w.x+d.w,y:w.y,w:w.w-d.w,h:d.h}),w.y+=d.h,w.h-=d.h);break}}return{w:a,h,fill:e/(a*h)||0}}qt(nd,"Anchor");const ap=1;class Km{static getImagePositionScale(e,i,o){if(i&&e&&e.options&&e.options.transform){const a=e.options.transform;return{x:a.a,y:a.d}}return{x:o,y:o}}constructor(e,i,o,a){this.paddedRect=e;const{pixelRatio:h,version:d,stretchX:x,stretchY:w,content:T,sdf:I,usvg:P}=i;this.pixelRatio=h,this.stretchX=x,this.stretchY=w,this.content=T,this.version=d,this.padding=o,this.sdf=I,this.usvg=P,this.scale=Km.getImagePositionScale(a,P,h)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function y0(n,e,i){const o=rl.parse(n),a=function(h,d,x=[1,1]){return{x:0,y:0,w:(h.data?h.data.width:h.width*x[0])+2*d,h:(h.data?h.data.height:h.height*x[1])+2*d}}(e,i,[o.options.transform.a,o.options.transform.d]);return{bin:a,imagePosition:new Km(a,e,i,o),imageVariant:o}}class tb{constructor(e,i,o){const a=new Map,h=new Map;this.haveRenderCallbacks=[];const d=[];this.addImages(e,a,ap,d),this.addImages(i,h,2,d);const{w:x,h:w}=eb(d),T=new Ks({width:x||1,height:w||1});for(const[I,P]of e.entries()){const R=a.get(I).paddedRect;Ks.copy(P.data,T,{x:0,y:0},{x:R.x+ap,y:R.y+ap},P.data,o,P.sdf)}for(const[I,P]of i.entries()){const R=h.get(I),F=R.paddedRect;let N=R.padding;const H=F.x+N,Z=F.y+N,ee=P.data.width,oe=P.data.height;N=N>1?N-1:N,Ks.copy(P.data,T,{x:0,y:0},{x:H,y:Z},P.data,o),Ks.copy(P.data,T,{x:0,y:oe-N},{x:H,y:Z-N},{width:ee,height:N},o),Ks.copy(P.data,T,{x:0,y:0},{x:H,y:Z+oe},{width:ee,height:N},o),Ks.copy(P.data,T,{x:ee-N,y:0},{x:H-N,y:Z},{width:N,height:oe},o),Ks.copy(P.data,T,{x:0,y:0},{x:H+ee,y:Z},{width:N,height:oe},o),Ks.copy(P.data,T,{x:ee-N,y:oe-N},{x:H-N,y:Z-N},{width:N,height:N},o),Ks.copy(P.data,T,{x:0,y:oe-N},{x:H+ee,y:Z-N},{width:N,height:N},o),Ks.copy(P.data,T,{x:0,y:0},{x:H+ee,y:Z+oe},{width:N,height:N},o),Ks.copy(P.data,T,{x:ee-N,y:0},{x:H-N,y:Z+oe},{width:N,height:N},o)}this.lut=o,this.image=T,this.iconPositions=a,this.patternPositions=h}addImages(e,i,o,a){for(const[h,d]of e.entries()){const{bin:x,imagePosition:w,imageVariant:T}=y0(h,d,o);i.set(h,w),a.push(x),d.hasRenderCallback&&this.haveRenderCallbacks.push(T.id)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const a of e.getUpdatedImages(o)){for(const h of this.iconPositions.keys()){const d=rl.parse(h);if(Ls.isEqual(d.id,a)){const x=e.getImage(a,o);this.patchUpdatedImage(this.iconPositions.get(h),x,i)}}for(const h of this.patternPositions.keys()){const d=rl.parse(h);if(Ls.isEqual(d.id,a)){const x=e.getImage(a,o);this.patchUpdatedImage(this.patternPositions.get(h),x,i)}}}}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[a,h]=e.tl,d=e.sdf;if(this.lut||d){const x={width:i.data.width,height:i.data.height},w=new Ks(x);Ks.copy(i.data,w,{x:0,y:0},{x:0,y:0},x,this.lut,d),o.update(w,{position:{x:a,y:h}})}else o.update(i.data,{position:{x:a,y:h}})}}qt(Km,"ImagePosition"),qt(tb,"ImageAtlas");const m_=1e20;function ib(n,e,i,o,a,h,d,x,w){for(let T=e;T<e+o;T++)nb(n,i*h+T,h,a,d,x,w);for(let T=i;T<i+a;T++)nb(n,T*h+e,1,o,d,x,w)}function nb(n,e,i,o,a,h,d){h[0]=0,d[0]=-1e20,d[1]=m_,a[0]=n[e];for(let x=1,w=0,T=0;x<o;x++){a[x]=n[e+x*i];const I=x*x;do{const P=h[w];T=(a[x]-a[P]+I-P*P)/(x-P)/2}while(T<=d[w]&&--w>-1);w++,h[w]=x,d[w]=T,d[w+1]=m_}for(let x=0,w=0;x<o;x++){for(;d[w+1]<x;)w++;const T=h[w],I=x-T;n[e+x*i]=a[T]+I*I}}const au=2,x0={none:0,ideographs:1,all:2};class Xp{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,o){const a=[],h=this.urls[i]||us.GLYPHS_URL;for(const d in e)for(const x of e[d])a.push({stack:d,id:x});Le(a,({stack:d,id:x},w)=>{let T=this.entries[d];T||(T=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let I=T.glyphs[x];if(I!==void 0)return void w(null,{stack:d,id:x,glyph:I});if(I=this._tinySDF(T,d,x),I)return T.glyphs[x]=I,void w(null,{stack:d,id:x,glyph:I});const P=Math.floor(x/256);if(256*P>65535)return zi("glyphs > 65535 not supported"),void w(null,{stack:d,id:x,glyph:I});if(T.ranges[P])return void w(null,{stack:d,id:x,glyph:I});let R=T.requests[P];R||(R=T.requests[P]=[],Xp.loadGlyphRange(d,P,h,this.requestManager,(F,N)=>{if(N){T.ascender=N.ascender,T.descender=N.descender;for(const H in N.glyphs)this._doesCharSupportLocalGlyph(+H)||(T.glyphs[+H]=N.glyphs[+H]);T.ranges[P]=!0}for(const H of R)H(F,N);delete T.requests[P]})),R.push((F,N)=>{F?w(F):N&&w(null,{stack:d,id:x,glyph:N.glyphs[x]||null})})},(d,x)=>{if(d)o(d);else if(x){const w={};for(const{stack:T,id:I,glyph:P}of x)w[T]===void 0&&(w[T]={}),w[T].glyphs===void 0&&(w[T].glyphs={}),w[T].glyphs[I]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},w[T].ascender=this.entries[T].ascender,w[T].descender=this.entries[T].descender;o(null,w)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==x0.none&&(this.localGlyphMode===x0.all?!!this.localFontFamily:!!this.localFontFamily&&(fi["CJK Unified Ideographs"](e)||fi["Hangul Syllables"](e)||fi.Hiragana(e)||fi.Katakana(e)||fi["CJK Symbols and Punctuation"](e)||fi["CJK Unified Ideographs Extension A"](e)||fi["CJK Unified Ideographs Extension B"](e)||fi.Osage(e)))}_tinySDF(e,i,o){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(o))return;let h=e.tinySDF;if(!h){let H="400";/bold/i.test(i)?H="900":/medium/i.test(i)?H="500":/light/i.test(i)&&(H="200"),h=e.tinySDF=new Xp.TinySDF({fontFamily:a,fontWeight:H,fontSize:24*au,buffer:3*au,radius:8*au}),h.fontWeight=H}if(this.localGlyphs[h.fontWeight][o])return this.localGlyphs[h.fontWeight][o];const d=String.fromCodePoint(o),{data:x,width:w,height:T,glyphWidth:I,glyphHeight:P,glyphLeft:R,glyphTop:F,glyphAdvance:N}=h.draw(d);return this.localGlyphs[h.fontWeight][o]={id:o,bitmap:new cf({width:w,height:T},x),metrics:{width:I/au,height:P/au,left:R/au,top:F/au-27,advance:N/au,localGlyph:!0}}}}Xp.loadGlyphRange=function(n,e,i,o,a){const h=256*e,d=h+255,x=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${h}-${d}`),qo.Glyphs);mh(x,(w,T)=>{if(w)a(w);else if(T){const I={},P=function(R){return new f_(R).readFields(EA,{})}(T);for(const R of P.glyphs)I[R.id]=R;a(null,{glyphs:I,ascender:P.ascender,descender:P.descender})}})},Xp.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:a="sans-serif",fontWeight:h="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=i;const x=this.size=n+4*e,w=this._createCanvas(x),T=this.ctx=w.getContext("2d",{willReadFrequently:!0});T.font=`${d} ${h} ${n}px ${a}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:a,actualBoundingBoxRight:h}=this.ctx.measureText(n),d=Math.ceil(i),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-a))),w=Math.min(this.size-this.buffer,d+Math.ceil(o)),T=x+2*this.buffer,I=w+2*this.buffer,P=Math.max(T*I,0),R=new Uint8ClampedArray(P),F={data:R,width:T,height:I,glyphWidth:x,glyphHeight:w,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(x===0||w===0)return F;const{ctx:N,buffer:H,gridInner:Z,gridOuter:ee}=this;N.clearRect(H,H,x,w),N.fillText(n,H,H+d);const oe=N.getImageData(H,H,x,w);ee.fill(m_,0,P),Z.fill(0,0,P);for(let ae=0;ae<w;ae++)for(let q=0;q<x;q++){const re=oe.data[4*(ae*x+q)+3]/255;if(re===0)continue;const le=(ae+H)*T+q+H;if(re===1)ee[le]=0,Z[le]=m_;else{const fe=.5-re;ee[le]=fe>0?fe*fe:0,Z[le]=fe<0?fe*fe:0}}ib(ee,0,0,T,I,T,this.f,this.v,this.z),ib(Z,H,H,x,w,T,this.f,this.v,this.z);for(let ae=0;ae<P;ae++){const q=Math.sqrt(ee[ae])-Math.sqrt(Z[ae]);R[ae]=Math.round(255-255*(q/this.radius+this.cutoff))}return F}};const lp=ap;function rb(n,e){return n+e[1]-e[0]}function sb(n,e,i,o,a=1){const h=[],d=n.imagePrimary,x=d.pixelRatio,w=d.paddedRect.w-2*lp,T=d.paddedRect.h-2*lp,I=(n.right-n.left)*a,P=(n.bottom-n.top)*a,R=d.stretchX||[[0,w]],F=d.stretchY||[[0,T]],N=R.reduce(rb,0),H=F.reduce(rb,0),Z=w-N,ee=T-H;let oe=0,ae=N,q=0,re=H,le=0,fe=Z,Me=0,Ce=ee;if(d.content&&o){const Ne=d.content;oe=g_(R,0,Ne[0]),q=g_(F,0,Ne[1]),ae=g_(R,Ne[0],Ne[2]),re=g_(F,Ne[1],Ne[3]),le=Ne[0]-oe,Me=Ne[1]-q,fe=Ne[2]-Ne[0]-ae,Ce=Ne[3]-Ne[1]-re}const Re=(Ne,Je,gt,ct)=>{const mt=__(Ne.stretch-oe,ae,I,n.left*a),xt=y_(Ne.fixed-le,fe,Ne.stretch,N),tt=__(Je.stretch-q,re,P,n.top*a),ft=y_(Je.fixed-Me,Ce,Je.stretch,H),Ke=__(gt.stretch-oe,ae,I,n.left*a),Qe=y_(gt.fixed-le,fe,gt.stretch,N),Ct=__(ct.stretch-q,re,P,n.top*a),At=y_(ct.fixed-Me,Ce,ct.stretch,H),hi=new Rt(mt,tt),ii=new Rt(Ke,tt),Ut=new Rt(Ke,Ct),St=new Rt(mt,Ct),Mi=new Rt(xt/x,ft/x),ti=new Rt(Qe/x,At/x),ni=e*Math.PI/180;if(ni){const Ji=Math.sin(ni),Rn=Math.cos(ni),nr=[Rn,-Ji,Ji,Rn];hi._matMult(nr),ii._matMult(nr),St._matMult(nr),Ut._matMult(nr)}const Ti=Ne.stretch+Ne.fixed,Vi=gt.stretch+gt.fixed,Oi=Je.stretch+Je.fixed,Ki=ct.stretch+ct.fixed,Ui=n.imageSecondary;return{tl:hi,tr:ii,bl:St,br:Ut,texPrimary:{x:d.paddedRect.x+lp+Ti,y:d.paddedRect.y+lp+Oi,w:Vi-Ti,h:Ki-Oi},texSecondary:Ui?{x:Ui.paddedRect.x+lp+Ti,y:Ui.paddedRect.y+lp+Oi,w:Vi-Ti,h:Ki-Oi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mi,pixelOffsetBR:ti,minFontScaleX:fe/x/I,minFontScaleY:Ce/x/P,isSDF:i}};if(o&&(d.stretchX||d.stretchY)){const Ne=ob(R,Z,N),Je=ob(F,ee,H);for(let gt=0;gt<Ne.length-1;gt++){const ct=Ne[gt],mt=Ne[gt+1];for(let xt=0;xt<Je.length-1;xt++)h.push(Re(ct,Je[xt],mt,Je[xt+1]))}}else h.push(Re({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return h}function g_(n,e,i){let o=0;for(const a of n)o+=Math.max(e,Math.min(i,a[1]))-Math.max(e,Math.min(i,a[0]));return o}function ob(n,e,i){const o=[{fixed:-1,stretch:0}];for(const[a,h]of n){const d=o[o.length-1];o.push({fixed:a-d.stretch,stretch:d.stretch}),o.push({fixed:a-d.stretch,stretch:d.stretch+(h-a)})}return o.push({fixed:e+lp,stretch:i}),o}function __(n,e,i,o){return n/e*i+o}function y_(n,e,i,o){return n-e*i/o}function LA(n,e,i,o){const a=e+n.positionedLines[o].lineOffset;return o===0?i+a/2:i+(a+(e+n.positionedLines[o-1].lineOffset))/2}function zA(n,e=1,i=!1){let o=1/0,a=1/0,h=-1/0,d=-1/0;const x=n[0];for(let F=0;F<x.length;F++){const N=x[F];(!F||N.x<o)&&(o=N.x),(!F||N.y<a)&&(a=N.y),(!F||N.x>h)&&(h=N.x),(!F||N.y>d)&&(d=N.y)}const w=Math.min(h-o,d-a);let T=w/2;const I=new Cu([],FA);if(w===0)return new Rt(o,a);for(let F=o;F<h;F+=w)for(let N=a;N<d;N+=w)I.push(new Yp(F+T,N+T,T,n));let P=function(F){let N=0,H=0,Z=0;const ee=F[0];for(let oe=0,ae=ee.length,q=ae-1;oe<ae;q=oe++){const re=ee[oe],le=ee[q],fe=re.x*le.y-le.x*re.y;H+=(re.x+le.x)*fe,Z+=(re.y+le.y)*fe,N+=3*fe}return new Yp(H/N,Z/N,0,F)}(n),R=I.length;for(;I.length;){const F=I.pop();(F.d>P.d||!P.d)&&(P=F,i&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,R)),F.max-P.d<=e||(T=F.h/2,I.push(new Yp(F.p.x-T,F.p.y-T,T,n)),I.push(new Yp(F.p.x+T,F.p.y-T,T,n)),I.push(new Yp(F.p.x-T,F.p.y+T,T,n)),I.push(new Yp(F.p.x+T,F.p.y+T,T,n)),R+=4)}return i&&(console.log(`num probes: ${R}`),console.log(`best distance: ${P.d}`)),P.p}function FA(n,e){return e.max-n.max}class Yp{constructor(e,i,o,a){this.p=new Rt(e,i),this.h=o,this.d=function(h,d){let x=!1,w=1/0;for(let T=0;T<d.length;T++){const I=d[T];for(let P=0,R=I.length,F=R-1;P<R;F=P++){const N=I[P],H=I[F];N.y>h.y!=H.y>h.y&&h.x<(H.x-N.x)*(h.y-N.y)/(H.y-N.y)+N.x&&(x=!x),w=Math.min(w,af(h,N,H))}}return(x?1:-1)*Math.sqrt(w)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const OA=Object.keys,v0=Number.POSITIVE_INFINITY,NA=Math.sqrt(2);function ab(n,[e,i]){let o=0,a=0;if(i===v0){e<0&&(e=0);const h=e/NA;switch(n){case"top-right":case"top-left":a=h-7;break;case"bottom-right":case"bottom-left":a=7-h;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(n){case"top-right":case"bottom-right":o=-h;break;case"top-left":case"bottom-left":o=h;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":a=i-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-i}switch(n){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,a]}function x_(n,e,i,o,a,h,d,x,w){if(!e||!e.usvg)return;const T=qw(o),I=qw(a),P=h!=="both"&&h!=="width"||!Hw(o)?1:I.width/T.width,R=h!=="both"&&h!=="height"||!Ww(o)?1:I.height/T.height;i.scaleSelf(P,R);const F=i.toString();d.set(F,i),x.set(F,e);const{imagePosition:N}=y0(F,e,ap);w.set(F,N)}function lb(n,e,i,o,a,h,d,x,w){if(!n)return;const T=function(I,P,R,F,N,H){if(I.kind==="camera")return I.maxSize;if(I.kind==="composite"){const Z=P.possiblyEvaluate(new Pn(I.maxZoom,{worldview:H}),R).evaluate(N,{},R),ee=P.possiblyEvaluate(new Pn(I.minZoom,{worldview:H}),R).evaluate(N,{},R);return Math.max(Z,ee)}return P.possiblyEvaluate(new Pn(F,{worldview:H})).evaluate(N,{},R)}(e,i,o,a,h,w);return n.scaleSelf(T*x*d)}function cb(n,e,i,o,a,h,d,x,w){return{iconPrimary:lb(n.getPrimary(),e,i,o,a,h,d,x,w),iconSecondary:lb(n.getSecondary(),e,i,o,a,h,d,x,w)}}function BA(n,e,i){if(!e)return;const o=i.get(n.toString()),a=i.get(e.toString());a&&(o.paddedRect.w===a.paddedRect.w&&o.paddedRect.h===a.paddedRect.h||zi(`Mismatch in icon variant sizes: ${n.toString()} and ${e.toString()}`),o.usvg!==a.usvg&&zi(`Mismatch in icon variant image types: ${n.id} and ${e.id}`))}function ub(n,e,i,o){if(!n)return;const a=e.get(i.toString());if(n.imagePrimary=a,o){const h=e.get(o.toString());n.imageSecondary=h}}function jA(n,e){for(const i in n.horizontal)hb(n.horizontal[i],e);hb(n.vertical,e)}function hb(n,e){if(n){for(const i of n.positionedLines)for(const o of i.positionedGlyphs)if(o.image!==null){const a=o.image.toString();o.rect=e.get(a).paddedRect}}}function w0(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function VA(n,e,i,o,a,h,d,x,w){const T=b0(h.horizontal)||h.vertical,I=i.get("icon-text-fit-padding").evaluate(o,{},a);let P,R=e;return e&&w!=="none"&&(n.allowVerticalPlacement&&h.vertical&&(P=$w(e,h.vertical,w,I,x,d)),T&&(R=$w(e,T,w,I,x,d))),{defaultShapedIcon:R,verticallyShapedIcon:P}}function UA(n,e,i,o,a,h,d,x,w,T,I,P,R,F,N,H,Z,ee,oe,ae){let q=d.textMaxSize.evaluate(e,{},R);q===void 0?q=x*d.textScaleFactor:q*=d.textScaleFactor;const re=n.layers[0].layout,le=b0(i.horizontal)||i.vertical,fe=F.name==="globe",Me=Ps,Ce=n.tilePixelRatio*q/Me,Re=(xt=n.overscaling,n.zoom>18&&xt>2&&(xt>>=1),Math.max(Lt/(512*xt),1)*re.get("symbol-spacing")),Ne=re.get("text-padding")*n.tilePixelRatio,Je=re.get("icon-padding")*n.tilePixelRatio,gt=_n(re.get("text-max-angle")),ct=re.get("icon-rotation-alignment")==="map"&&ae!=="point",mt=Re/2;var xt;n.hasAnyIconTextFit===!1&&Z!=="none"&&(n.hasAnyIconTextFit=!0);const tt=e.properties?+e.properties[Yi]:null,ft=tt&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get(tt):65535,Ke=(Qe,Ct,At)=>{if(Ct.x<0||Ct.x>=Lt||Ct.y<0||Ct.y>=Lt)return;let hi=null;if(fe){const{x:ii,y:Ut,z:St}=F.projectTilePoint(Ct.x,Ct.y,At);hi={anchor:new nd(ii,Ut,St,0,void 0),up:F.upVector(At,Ct.x,Ct.y)}}(function(ii,Ut,St,Mi,ti,ni,Ti,Vi,Oi,Ki,Ui,Ji,Rn,nr,he,ye,rt,Pt,Gt,Vt,Qt,bi,rn,sn,Gi,Fn,Jn,on,wr){const rr=ii.addToLineVertexArray(Ut,Mi);let kn,Ar,or,Qn,sr,On,qi,jn=0,br=0,_i=0,gn=0,ar=-1,Sr=-1;const hr={};let Gr=Cc("");const $n=St?St.anchor:Ut,Br=on!=="none";let Jo=0,Js=0;if(Oi._unevaluatedLayout.getValue("text-radial-offset")===void 0){const $r=Oi.layout.get("text-offset").evaluate(Qt,{},Gi);Jo=$r[0]*Ps,Js=$r[1]*Ps}else Jo=Oi.layout.get("text-radial-offset").evaluate(Qt,{},Gi)*Ps,Js=v0;if(ii.allowVerticalPlacement&&ti.vertical){const $r=ti.vertical;if(he)On=T0($r),Vi&&(qi=T0(Vi));else{const ss=Oi.layout.get("text-rotate").evaluate(Qt,{},Gi)+90;or=v_(Ki,$n,Ut,Ui,Ji,Rn,$r,nr,ss,ye),Vi&&(Qn=v_(Ki,$n,Ut,Ui,Ji,Rn,Vi,Pt,ss))}}if(ni){const $r=ii.iconSizeData,ss=Oi.layout.get("icon-rotate").evaluate(Qt,{},Gi),Qs=sb(ni,ss,rn,Br,bi.iconScaleFactor),Po=Vi?sb(Vi,ss,rn,Br,bi.iconScaleFactor):void 0;Ar=v_(Ki,$n,Ut,Ui,Ji,Rn,ni,Pt,ss,null),jn=4*Qs.length;let fo=null;$r.kind==="source"?(fo=[sh*Oi.layout.get("icon-size").evaluate(Qt,{},Gi)*bi.iconScaleFactor],fo[0]>hf&&zi(`${ii.layerIds[0]}: Value for "icon-size" is >= ${Jm}. Reduce your "icon-size".`)):$r.kind==="composite"&&(fo=[sh*bi.compositeIconSizes[0].evaluate(Qt,{},Gi)*bi.iconScaleFactor,sh*bi.compositeIconSizes[1].evaluate(Qt,{},Gi)*bi.iconScaleFactor],(fo[0]>hf||fo[1]>hf)&&zi(`${ii.layerIds[0]}: Value for "icon-size" is >= ${Jm}. Reduce your "icon-size".`)),ii.addSymbols(ii.icon,Qs,fo,Vt,Gt,Qt,void 0,St,Ut,rr.lineStartIndex,rr.lineLength,-1,sn,Gi,Fn,Jn),ar=ii.icon.placedSymbolArray.length-1,Po&&(br=4*Po.length,ii.addSymbols(ii.icon,Po,fo,Vt,Gt,Qt,ma.vertical,St,Ut,rr.lineStartIndex,rr.lineLength,-1,sn,Gi,Fn,Jn),Sr=ii.icon.placedSymbolArray.length-1)}for(const $r in ti.horizontal){const ss=$r,Qs=ti.horizontal[ss];kn||(Gr=Cc(Qs.text),he?sr=T0(Qs):kn=v_(Ki,$n,Ut,Ui,Ji,Rn,Qs,nr,Oi.layout.get("text-rotate").evaluate(Qt,{},Gi),ye));const Po=Qs.positionedLines.length===1;if(_i+=db(ii,St,Ut,Qs,Ti,Oi,he,Qt,ye,rr,ti.vertical?ma.horizontal:ma.horizontalOnly,Po?OA(ti.horizontal):[ss],hr,ar,bi,sn,Gi,Fn),Po)break}ti.vertical&&(gn+=db(ii,St,Ut,ti.vertical,Ti,Oi,he,Qt,ye,rr,ma.vertical,["vertical"],hr,Sr,bi,sn,Gi,Fn));let Os=-1;const Qo=($r,ss)=>$r?Math.max($r,ss):ss;Os=Qo(sr,Os),Os=Qo(On,Os),Os=Qo(qi,Os);const oh=Os>-1?1:0;ii.glyphOffsetArray.length>=65535&&zi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Qt.sortKey!==void 0&&ii.addToSortKeyRanges(ii.symbolInstances.length,Qt.sortKey),ii.symbolInstances.emplaceBack(Ut.x,Ut.y,$n.x,$n.y,$n.z,hr.right>=0?hr.right:-1,hr.center>=0?hr.center:-1,hr.left>=0?hr.left:-1,hr.vertical>=0?hr.vertical:-1,ar,Sr,Gr,kn!==void 0?kn:ii.collisionBoxArray.length,kn!==void 0?kn+1:ii.collisionBoxArray.length,or!==void 0?or:ii.collisionBoxArray.length,or!==void 0?or+1:ii.collisionBoxArray.length,Ar!==void 0?Ar:ii.collisionBoxArray.length,Ar!==void 0?Ar+1:ii.collisionBoxArray.length,Qn||ii.collisionBoxArray.length,Qn?Qn+1:ii.collisionBoxArray.length,Ui,_i,gn,jn,br,oh,0,Jo,Js,Os,0,Br?1:0,wr)})(n,Ct,hi,Qe,i,o,h,a,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,Ne,oe,T,0,Je,ct,ee,e,d,I,P,R,N,H,Z,ft)};if(ae==="line")for(const Qe of c_(e.geometry,0,0,Lt,Lt)){const Ct=DA(Qe,Re,gt,i.vertical||le,o,Me,Ce,n.overscaling,Lt);for(const At of Ct)le&&GA(n,le.text,mt,At)||Ke(Qe,At,R)}else if(ae==="line-center"){for(const Qe of e.geometry)if(Qe.length>1){const Ct=kA(Qe,gt,i.vertical||le,o,Me,Ce);Ct&&Ke(Qe,Ct,R)}}else if(e.type==="Polygon")for(const Qe of n_(e.geometry,0)){const Ct=zA(Qe,16);Ke(Qe[0],new nd(Ct.x,Ct.y,0,0,void 0),R)}else if(e.type==="LineString")for(const Qe of e.geometry)Ke(Qe,new nd(Qe[0].x,Qe[0].y,0,0,void 0),R);else if(e.type==="Point")for(const Qe of e.geometry)for(const Ct of Qe)Ke([Ct],new nd(Ct.x,Ct.y,0,0,void 0),R)}const Jm=255,hf=Jm*sh;function db(n,e,i,o,a,h,d,x,w,T,I,P,R,F,N,H,Z,ee){const oe=function(re,le,fe,Me,Ce,Re,Ne,Je){const gt=[];if(le.positionedLines.length===0)return gt;const ct=Me.layout.get("text-rotate").evaluate(Re,{})*Math.PI/180,mt=function(Qe){const Ct=Qe[0],At=Qe[1],hi=Ct*At;return hi>0?[Ct,-At]:hi<0?[-Ct,At]:Ct===0?[At,Ct]:[At,-Ct]}(fe);let xt=Math.abs(le.top-le.bottom);for(const Qe of le.positionedLines)xt-=Qe.lineOffset;const tt=le.positionedLines.length,ft=xt/tt;let Ke=le.top-fe[1];for(let Qe=0;Qe<tt;++Qe){const Ct=le.positionedLines[Qe];Ke=LA(le,ft,Ke,Qe);for(const At of Ct.positionedGlyphs){if(!At.rect)continue;const hi=At.rect||{};let ii=IA+1,Ut=!0,St=1,Mi=0;if(At.image){const Qt=Ne.get(At.image.toString());if(!Qt)continue;if(Qt.sdf){zi("SDF images are not supported in formatted text and will be ignored.");continue}Ut=!1,St=Qt.pixelRatio,ii=ap/St}const ti=(Ce||Je)&&At.vertical,ni=At.metrics.advance*At.scale/2,Ti=At.metrics,Vi=At.rect;if(Vi===null)continue;Je&&le.verticalizable&&(Mi=At.image?ni-At.metrics.width*At.scale/2:0);const Oi=Ce?[At.x+ni,At.y]:[0,0];let Ki=[0,0],Ui=[0,0],Ji=!1;Ce||(ti?(Ui=[At.x+ni+mt[0],At.y+mt[1]-Mi],Ji=!0):Ki=[At.x+ni+fe[0],At.y+fe[1]-Mi]);const Rn=Vi.w*At.scale/(St*(At.localGlyph?au:1)),nr=Vi.h*At.scale/(St*(At.localGlyph?au:1));let he,ye,rt,Pt;if(ti){const Qt=At.y-Ke,bi=new Rt(-ni,ni-Qt),rn=-Math.PI/2,sn=new Rt(...Ui);he=new Rt(-ni+Ki[0],Ki[1]),he._rotateAround(rn,bi)._add(sn),he.x+=-Qt+ni,he.y-=(Ti.left-ii)*At.scale;const Gi=At.image?Ti.advance*At.scale:Ps*At.scale,Fn=String.fromCodePoint(At.glyph);bA(Fn)?he.x+=(1-ii)*At.scale:TA(Fn)?he.x+=Gi-Ti.height*At.scale+(-ii-1)*At.scale:he.x+=At.image||Ti.width+2*ii===Vi.w&&Ti.height+2*ii===Vi.h?(Gi-nr)/2:(Gi-(Ti.height+2*ii)*At.scale)/2,ye=new Rt(he.x,he.y-Rn),rt=new Rt(he.x+nr,he.y),Pt=new Rt(he.x+nr,he.y-Rn)}else{const Qt=(Ti.left-ii)*At.scale-ni+Ki[0],bi=(-Ti.top-ii)*At.scale+Ki[1],rn=Qt+Rn,sn=bi+nr;he=new Rt(Qt,bi),ye=new Rt(rn,bi),rt=new Rt(Qt,sn),Pt=new Rt(rn,sn)}if(ct){let Qt;Qt=Ce?new Rt(0,0):Ji?new Rt(mt[0],mt[1]):new Rt(fe[0],fe[1]),he._rotateAround(ct,Qt),ye._rotateAround(ct,Qt),rt._rotateAround(ct,Qt),Pt._rotateAround(ct,Qt)}const Gt=new Rt(0,0),Vt=new Rt(0,0);gt.push({tl:he,tr:ye,bl:rt,br:Pt,texPrimary:hi,texSecondary:void 0,writingMode:le.writingMode,glyphOffset:Oi,sectionIndex:At.sectionIndex,isSDF:Ut,pixelOffsetTL:Gt,pixelOffsetBR:Vt,minFontScaleX:0,minFontScaleY:0})}}return gt}(0,o,w,h,d,x,a,n.allowVerticalPlacement),ae=n.textSizeData;let q=null;ae.kind==="source"?(q=[sh*h.layout.get("text-size").evaluate(x,{},Z)*N.textScaleFactor],q[0]>hf&&zi(`${n.layerIds[0]}: Value for "text-size" is >= ${Jm}. Reduce your "text-size".`)):ae.kind==="composite"&&(q=[sh*N.compositeTextSizes[0].evaluate(x,{},Z)*N.textScaleFactor,sh*N.compositeTextSizes[1].evaluate(x,{},Z)*N.textScaleFactor],(q[0]>hf||q[1]>hf)&&zi(`${n.layerIds[0]}: Value for "text-size" is >= ${Jm}. Reduce your "text-size".`)),n.addSymbols(n.text,oe,q,w,d,x,I,e,i,T.lineStartIndex,T.lineLength,F,H,Z,ee,!1);for(const re of P)R[re]=n.text.placedSymbolArray.length-1;return 4*oe.length}function b0(n){for(const e in n)return n[e];return null}function v_(n,e,i,o,a,h,d,x,w,T){let I=d.top,P=d.bottom,R=d.left,F=d.right;if(Gw(d)&&d.collisionPadding){const N=d.collisionPadding;R-=N[0],I-=N[1],F+=N[2],P+=N[3]}if(w){const N=new Rt(R,I),H=new Rt(F,I),Z=new Rt(R,P),ee=new Rt(F,P),oe=_n(w);let ae=new Rt(0,0);T&&(ae=new Rt(T[0],T[1])),N._rotateAround(oe,ae),H._rotateAround(oe,ae),Z._rotateAround(oe,ae),ee._rotateAround(oe,ae),R=Math.min(N.x,H.x,Z.x,ee.x),F=Math.max(N.x,H.x,Z.x,ee.x),I=Math.min(N.y,H.y,Z.y,ee.y),P=Math.max(N.y,H.y,Z.y,ee.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,R,I,F,P,x,o,a,h),n.length-1}function T0(n){Gw(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function GA(n,e,i,o){const a=n.compareText;if(e in a){const h=a[e];for(let d=h.length-1;d>=0;d--)if(o.dist(h[d])<i)return!0}else a[e]=[];return a[e].push(o),!1}function fb(n,e){const i=n.fovAboveCenter,o=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,a=(n._camera.position[2]*n.worldSize-o)/Math.cos(n._pitch),h=Math.sin(i)*a/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01));let d=Math.sin(n._pitch)*h+a;const x=a*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let w=Math.max(n.zoom-17,0);n.isOrthographic&&(w/=10),d*=1+w}return Math.min(1.01*d,x)}function Qm(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),o=n.x*i,a=(n.x+1)*i,h=n.y*i,d=(n.y+1)*i,x=Ae(o),w=Ae(a),T=Oe(h),I=Oe(d),P=e.project(x,T),R=e.project(w,T),F=e.project(w,I),N=e.project(x,I);let H=Math.min(P.x,R.x,F.x,N.x),Z=Math.min(P.y,R.y,F.y,N.y),ee=Math.max(P.x,R.x,F.x,N.x),oe=Math.max(P.y,R.y,F.y,N.y);const ae=i/16;function q(le,fe,Me,Ce,Re,Ne){const Je=(Me+Re)/2,gt=(Ce+Ne)/2,ct=e.project(Ae(Je),Oe(gt)),mt=Math.max(0,H-ct.x,Z-ct.y,ct.x-ee,ct.y-oe);H=Math.min(H,ct.x),ee=Math.max(ee,ct.x),Z=Math.min(Z,ct.y),oe=Math.max(oe,ct.y),mt>ae&&(q(le,ct,Me,Ce,Je,gt),q(ct,fe,Je,gt,Re,Ne))}q(P,R,o,h,a,h),q(R,F,a,h,a,d),q(F,N,a,d,o,d),q(N,P,o,d,o,h),H-=ae,Z-=ae,ee+=ae,oe+=ae;const re=1/Math.max(ee-H,oe-Z);return{scale:re,x:H*re,y:Z*re,x2:ee*re,y2:oe*re,projection:e}}function pb(n,{x:e,y:i},o=0){return new Rt(((e-o)*n.scale-n.x)*Lt,(i*n.scale-n.y)*Lt)}const $A=ve(new Float32Array(16));class df{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new ie(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o,a=!0){return e._coordinatePoint(e.locationCoordinate(i,o),a)}pixelsPerMeter(e,i){return Ee(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return fb(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,a){const h=e.horizonLineFromTop(!1),d=new Rt(i,Math.max(h,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,a))}pointCoordinate3D(e,i,o){const a=new Rt(i,o);if(e.elevation)return e.elevation.pointCoordinate(a);{const h=this.pointCoordinate(e,a.x,a.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return $A}createTileMatrix(e,i,o){let a,h,d;const x=o.canonical,w=ve(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=Qm(x,this);a=1,h=T.x+o.wrap*T.scale,d=T.y,pt(w,w,[a/T.scale,a/T.scale,e.pixelsPerMeter/i])}else a=i/e.zoomScale(x.z),h=(x.x+Math.pow(2,x.z)*o.wrap)*a,d=x.y*a;return et(w,w,[h,d,0]),pt(w,w,[a/Lt,a/Lt,1]),w}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class HA extends df{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,o]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(_n(i));this.n=(a+Math.sin(_n(o)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:o,c:a,r0:h}=this,d=_n(e-this.center[0]),x=_n(i),w=Math.sqrt(a-2*o*Math.sin(x))/o;return{x:w*Math.sin(d*o),y:w*Math.cos(d*o)-h,z:0}}unproject(e,i){const{n:o,c:a,r0:h}=this,d=h+i;let x=Math.atan2(e,Math.abs(d))*Math.sign(d);d*o<0&&(x-=Math.PI*Math.sign(e)*Math.sign(d));const w=_n(this.center[0])*o;x=$e(x,-Math.PI-w,Math.PI-w);const T=we(qe(x/o)+this.center[0],-180,180),I=Math.asin(we((a-(e*e+d*d)*o*o)/(2*o),-1,1)),P=we(qe(I),-85.051129,nt);return new ie(T,P)}}const eg=1.340264,tg=-.081106,ig=893e-6,ng=.003796,w_=Math.sqrt(3)/2;class WA extends df{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(w_*Math.sin(i)),a=o*o,h=a*a*a;return{x:.5*(e*Math.cos(o)/(w_*(eg+3*tg*a+h*(7*ig+9*ng*a)))/Math.PI+.5),y:1-.5*(o*(eg+tg*a+h*(ig+ng*a))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,a=o*o,h=a*a*a;for(let I,P,R,F=0;F<12&&(P=o*(eg+tg*a+h*(ig+ng*a))-i,R=eg+3*tg*a+h*(7*ig+9*ng*a),I=P/R,o=we(o-I,-Math.PI/3,Math.PI/3),a=o*o,h=a*a*a,!(Math.abs(I)<1e-12));++F);const d=w_*e*(eg+3*tg*a+h*(7*ig+9*ng*a))/Math.cos(o),x=Math.asin(Math.sin(o)/w_),w=we(180*d/Math.PI,-180,180),T=we(180*x/Math.PI,-85.051129,nt);return new ie(w,T)}}class qA extends df{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const o=360*(e-.5),a=we(360*(.5-i),-85.051129,nt);return new ie(o,a)}}const Kp=Math.PI/2;function b_(n){return Math.tan((Kp+n)/2)}class ZA extends df{constructor(e){super(e),this.center=e.center||[0,30];const[i,o]=this.parallels=e.parallels||[30,30];let a=_n(i),h=_n(o);this.southernCenter=a+h<0,this.southernCenter&&(a=-a,h=-h);const d=Math.cos(a),x=b_(a);this.n=a===h?Math.sin(a):Math.log(d/Math.cos(h))/Math.log(b_(h)/x),this.f=d*Math.pow(b_(a),this.n)/this.n}project(e,i){i=_n(i),this.southernCenter&&(i=-i),e=_n(e-this.center[0]);const o=1e-6,{n:a,f:h}=this;h>0?i<-Kp+o&&(i=-Kp+o):i>Kp-o&&(i=Kp-o);const d=h/Math.pow(b_(i),a);let x=d*Math.sin(a*e),w=h-d*Math.cos(a*e);return x=.5*(x/Math.PI+.5),w=.5*(w/Math.PI+.5),{x,y:this.southernCenter?w:1-w,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:o,f:a}=this,h=a-i,d=Math.sign(h),x=Math.sign(o)*Math.sqrt(e*e+h*h);let w=Math.atan2(e,Math.abs(h))*d;h*o<0&&(w-=Math.PI*Math.sign(e)*d);const T=we(qe(w/o)+this.center[0],-180,180),I=we(qe(2*Math.atan(Math.pow(a/x,1/o))-Kp),-85.051129,nt);return new ie(T,this.southernCenter?-I:I)}}class mb extends df{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:xe(e),y:me(i),z:0}}unproject(e,i){const o=Ae(e),a=Oe(i);return new ie(o,a)}}const gb=_n(nt);class XA extends df{project(e,i){const o=(i=_n(i))*i,a=o*o;return{x:.5*((e=_n(e))*(.8707-.131979*o+a*(a*(.003971*o-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+a*(.028874*o-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,a=25,h=0,d=o*o;do{d=o*o;const T=d*d;h=(o*(1.007226+d*(.015085+T*(.028874*d-.044475-.005916*T)))-i)/(1.007226+d*(.045255+T*(.259866*d-.311325-.005916*11*T))),o=we(o-h,-gb,gb)}while(Math.abs(h)>1e-6&&--a>0);d=o*o;const x=we(qe(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),w=qe(o);return new ie(x,w)}}const _b=_n(nt);class YA extends df{project(e,i){i=_n(i),e=_n(e);const o=Math.cos(i),a=2/Math.PI,h=Math.acos(o*Math.cos(e/2)),d=Math.sin(h)/h,x=.5*(e*a+2*o*Math.sin(e/2)/d)||0,w=.5*(i+Math.sin(i)/d)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,a=i=(2*(1-i)-1)*Math.PI,h=25;const d=1e-6;let x=0,w=0;do{const T=Math.cos(a),I=Math.sin(a),P=2*I*T,R=I*I,F=T*T,N=Math.cos(o/2),H=Math.sin(o/2),Z=2*N*H,ee=H*H,oe=1-F*N*N,ae=oe?1/oe:0,q=oe?Math.acos(T*N)*Math.sqrt(1/oe):0,re=.5*(2*q*T*H+2*o/Math.PI)-e,le=.5*(q*I+a)-i,fe=.5*ae*(F*ee+q*T*N*R)+1/Math.PI,Me=ae*(Z*P/4-q*I*H),Ce=.125*ae*(P*H-q*I*F*Z),Re=.5*ae*(R*N+q*ee*T)+.5,Ne=Me*Ce-Re*fe;x=(le*Me-re*Re)/Ne,w=(re*Ce-le*fe)/Ne,o=we(o-x,-Math.PI,Math.PI),a=we(a-w,-_b,_b)}while((Math.abs(x)>d||Math.abs(w)>d)&&--h>0);return new ie(qe(o),qe(a))}}class yb extends df{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(_n(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:o,cosPhi:a}=this;return{x:_n(e)*a*o+.5,y:-Math.sin(_n(i))/a*o+.5,z:0}}unproject(e,i){const{scale:o,cosPhi:a}=this,h=-(i-.5)/o,d=we(qe((e-.5)/o)/a,-180,180),x=Math.asin(we(h*a,-1,1)),w=we(qe(x),-85.051129,nt);return new ie(d,w)}}class KA extends mb{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){const a=ji(e,i,o);return Xi(a,a,dt(Ye(o))),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,i,o){const a=W(i.lat,i.lng),h=Di([],a),d=o?e._centerAltitude+o:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Ue(a,a,h,Ee(1,0)*Lt*d);const x=ve(new Float64Array(16));return ze(x,e.pixelMatrix,e.globeMatrix),Xi(a,a,x),new Rt(a[0],a[1])}pixelsPerMeter(e,i){return Ee(1,0)*i}pixelSpaceConversion(e,i,o){const a=Ee(1,e)*i,h=gi(Ee(1,45)*i,a,o);return this.pixelsPerMeter(e,i)/h}createTileMatrix(e,i,o){const a=at(Ye(o.canonical));return ze(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,i){const{center:o}=e,a=dt(Ye(i));return It(a,a,_n(o.lng)),Tt(a,a,_n(o.lat)),pt(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,i,o,a){return K(e,i,o,!0)||new ke(0,0)}pointCoordinate3D(e,i,o){const a=this.pointCoordinate(e,i,o,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,i){return!K(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(a,h){const d=a.cameraToCenterDistance,x=a._centerAltitude*h,w=a._camera,T=a._camera.forward(),I=Ci([],Kt([],T,-d),[0,0,x]),P=a.worldSize/(2*Math.PI),R=[0,0,-P],F=a.width/a.height,N=Math.tan(a.fovAboveCenter),H=Kt([],w.up(),N),Z=Kt([],w.right(),N*F),ee=Di([],Ci([],Ci([],T,H),Z)),oe=[];let ae;if(new Kn(I,ee).closestPointOnSphere(R,P,oe)){const q=Ci([],oe,R),re=xr([],q,I);ae=Math.cos(a.fovAboveCenter)*Li(re)}else{const q=xr([],I,R),re=xr([],R,I);Di(re,re);const le=Li(q)-P;ae=Math.sqrt(le*(le+2*P));const fe=Math.acos(ae/(P+le))-Math.acos(Zi(T,re));ae*=Math.cos(fe)}return 1.01*ae}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=tn(e.zoom);if(o>0){const a=fb(e,Ee(1,e.center.lat)*e.worldSize),h=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return gi(i,a+h*(1-Math.cos(d)),Math.pow(o,10))}return i}upVector(e,i,o){return ji(i,o,e,1)}upVectorScale(e){return{metersToTile:z($i(Ye(e)))}}}function xb(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new mb(n);case"equirectangular":return new qA(n);case"naturalEarth":return new XA(n);case"equalEarth":return new WA(n);case"winkelTripel":return new YA(n);case"albers":return i?new yb(n):new HA(n);case"lambertConformalConic":return i?new yb(n):new ZA(n);case"globe":return new KA(n)}throw new Error(`Invalid projection name: ${n.name}`)}const JA=Bi.VectorTileFeature.types,QA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function T_(n,e,i,o,a,h,d,x,w,T,I,P,R){const F=x?Math.min(hf,Math.round(x[0])):0,N=x?Math.min(hf,Math.round(x[1])):0;n.emplaceBack(e,i,Math.round(32*o),Math.round(32*a),h,d,(F<<1)+(w?1:0),N,16*T,16*I,256*P,256*R)}function S_(n,e,i){n.emplaceBack(e,i)}function E_(n,e,i,o,a,h,d){n.emplaceBack(e,i,o,a,h,d)}const C_=(n,e,i,o)=>{for(let a=0;a<e;a++)n.emplaceBack(i[0],i[1],i[2],o[0],o[1],o[2])};function A_(n,e,i,o,a){n.emplaceBack(e,i,o,a),n.emplaceBack(e,i,o,a),n.emplaceBack(e,i,o,a),n.emplaceBack(e,i,o,a)}function eI(n){for(const e of n.sections)if(jh(e.text))return!0;return!1}class S0{constructor(e){this.layoutVertexArray=new Yu,this.indexArray=new Yr,this.programConfigurations=e,this.segments=new Vn,this.dynamicLayoutVertexArray=new Xr,this.opacityVertexArray=new gl,this.placedSymbolArray=new tf,this.iconTransitioningVertexArray=new _l,this.globeExtVertexArray=new Ws,this.zOffsetVertexArray=new ml,this.orientationVertexArray=new Jd}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,o,a,h){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,pA.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,QA,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,_A.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,fA.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,mA.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,gA.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}qt(S0,"SymbolBuffers");class E0{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new Vn,this.collisionVertexArray=new Ga,this.collisionVertexArrayExt=new Xr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,yA.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,xA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}qt(E0,"CollisionBuffers");class I_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ve([]),this.placementViewportMatrix=ve([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=Zw(this.zoom,i["text-size"],this.worldview),this.iconSizeData=Zw(this.zoom,i["icon-size"],this.worldview);const o=this.layers[0].layout,a=o.get("symbol-sort-key"),h=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(d=>ma[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new S0(new l(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new S0(new l(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Xh,this.lineVertexArray=new nf,this.symbolInstances=new Wf}calculateGlyphDependencies(e,i,o,a,h){for(const d of e){const x=d.codePointAt(0);if(x===void 0)break;if(i[x]=!0,a&&h&&x<=65535){const w=Zm[d];w&&(i[w.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Qy(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}populate(e,i,o,a){const h=this.layers[0],d=h.layout,x=this.projection.name==="globe",w=d.get("text-font"),T=d.get("text-field"),I=d.get("icon-image"),[P,R]=d.get("icon-size-scale-range"),F=we(i.scaleFactor||1,P,R),N=(T.value.kind!=="constant"||T.value.value instanceof $s&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),H=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,Z=d.get("symbol-sort-key");if(this.features=[],!N&&!H)return;const ee=i.iconDependencies,oe=i.glyphDependencies,ae=i.availableImages,q=new Pn(this.zoom,{worldview:this.worldview});for(const{feature:re,id:le,index:fe,sourceLayerIndex:Me}of e){const Ce=h._featureFilter.needGeometry,Re=Ot(re,Ce);if(!h._featureFilter.filter(q,Re,o))continue;if(Ce||(Re.geometry=Wt(re,o,a)),x&&re.type!==1&&o.z<=5){const mt=Re.geometry,xt=.98078528056,tt=(ft,Ke)=>Zi(ji(ft.x,ft.y,o,1),ji(Ke.x,Ke.y,o,1))<xt;for(let ft=0;ft<mt.length;ft++)mt[ft]=Et(mt[ft],tt)}let Ne,Je;if(N){const mt=h.getValueAndResolveTokens("text-field",Re,o,ae),xt=$s.factory(mt);eI(xt)&&(this.hasRTLText=!0),(!this.hasRTLText||fl()==="unavailable"||this.hasRTLText&&ca.isParsed())&&(Ne=wA(xt,h,Re))}if(H){const mt=h.getValueAndResolveTokens("icon-image",Re,o,ae);Je=typeof mt=="string"?no.build(mt):mt}if(!Ne&&!Je)continue;const gt=this.sortFeaturesByKey?Z.evaluate(Re,{},o):void 0,ct={id:le,text:Ne,icon:Je,index:fe,sourceLayerIndex:Me,geometry:Re.geometry,properties:re.properties,type:JA[re.type],sortKey:gt};if(this.features.push(ct),Je){const mt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:xt,iconSecondary:tt}=cb(Je,this.iconSizeData,mt["icon-size"],o,this.zoom,ct,this.pixelRatio,F,this.worldview),ft=xt.id.toString();if(ee.has(ft)?ee.get(ft).push(xt):ee.set(ft,[xt]),tt){const Ke=tt.id.toString();ee.has(Ke)?ee.get(Ke).push(tt):ee.set(Ke,[tt])}}if(Ne){const mt=w.evaluate(Re,{},o).join(","),xt=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ma.vertical)>=0;for(const tt of Ne.sections)if(tt.image){const ft=tt.image.getPrimary().scaleSelf(this.pixelRatio),Ke=ft.id.toString(),Qe=ee.get(Ke)||[];Qe.push(ft),ee.set(Ke,Qe)}else{const ft=No(Ne.toString()),Ke=tt.fontStack||mt,Qe=oe[Ke]=oe[Ke]||{};this.calculateGlyphDependencies(tt.text,Qe,xt,this.allowVerticalPlacement,ft)}}}if(d.get("symbol-placement")==="line"&&(this.features=function(re){const le={},fe={},Me=[];let Ce=0;function Re(ct){Me.push(re[ct]),Ce++}function Ne(ct,mt,xt){const tt=fe[ct];return delete fe[ct],fe[mt]=tt,Me[tt].geometry[0].pop(),Me[tt].geometry[0]=Me[tt].geometry[0].concat(xt[0]),tt}function Je(ct,mt,xt){const tt=le[mt];return delete le[mt],le[ct]=tt,Me[tt].geometry[0].shift(),Me[tt].geometry[0]=xt[0].concat(Me[tt].geometry[0]),tt}function gt(ct,mt,xt){const tt=xt?mt[0][mt[0].length-1]:mt[0][0];return`${ct}:${tt.x}:${tt.y}`}for(let ct=0;ct<re.length;ct++){const mt=re[ct],xt=mt.geometry,tt=mt.text?mt.text.toString():null;if(!tt){Re(ct);continue}const ft=gt(tt,xt),Ke=gt(tt,xt,!0);if(ft in fe&&Ke in le&&fe[ft]!==le[Ke]){const Qe=Je(ft,Ke,xt),Ct=Ne(ft,Ke,Me[Qe].geometry);delete le[ft],delete fe[Ke],fe[gt(tt,Me[Ct].geometry,!0)]=Ct,Me[Qe].geometry=null}else ft in fe?Ne(ft,Ke,xt):Ke in le?Je(ft,Ke,xt):(Re(ct),le[ft]=Ce-1,fe[Ke]=Ce-1)}return Me.filter(ct=>ct.geometry)}(this.features)),d.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const re of i.elevationFeatures)this.elevationFeatureIdToIndex.set(re.id,this.elevationFeatures.length),this.elevationFeatures.push(re)}}else d.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((re,le)=>re.sortKey-le.sortKey)}update(e,i,o,a,h,d,x){this.text.programConfigurations.updatePaintArrays(e,i,h,o,a,d,x,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,h,o,a,d,x,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const o=Xe(e),a=1/o;let h=!1,d=!1;for(let x=0;x<this.symbolInstances.length;x++){const w=this.symbolInstances.get(x),T=Dt(1,0,0),I=Dt(0,1,0),{numHorizontalGlyphVertices:P,numVerticalGlyphVertices:R,numIconVertices:F,numVerticalIconVertices:N}=w,H=P>0||R>0,Z=F>0,ee=this.elevationFeatures[w.elevationFeatureIndex];if(ee){const oe=new Rt(w.tileAnchorX,w.tileAnchorY),ae=.075+ee.pointElevation(oe);w.zOffset!==ae&&(i=!0,w.zOffset=ae);const q=ee.computeSlopeNormal(oe,a),re=va(ws(),Dt(0,0,1),q);js(T,T,re),js(I,I,re),T[2]*=o,I[2]*=o,T[0]===1&&T[1]===0&&T[2]===0&&I[0]===0&&I[1]===1&&I[2]===0||(h=h||H,d=d||Z)}if(H&&(C_(this.text.orientationVertexArray,P,T,I),C_(this.text.orientationVertexArray,R,T,I)),Z){const{placedIconSymbolIndex:oe,verticalPlacedIconSymbolIndex:ae}=w;oe>=0&&C_(this.icon.orientationVertexArray,F,T,I),ae>=0&&C_(this.icon.orientationVertexArray,N,T,I)}}h||(this.text.orientationVertexArray=void 0),d||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(h,d,x)=>{o+=d,o>h.length&&h.resize(o);for(let w=-d;w<0;w++)h.emplace(w+o,x)},i=(h,d,x)=>{a+=d,a>h.length&&h.resize(a);for(let w=-d;w<0;w++)h.emplace(w+a,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,a=0;for(let h=0;h<this.symbolInstances.length;h++){const d=this.symbolInstances.get(h),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:w,numIconVertices:T}=d,I=d.zOffset,P=T>0;if((x>0||w>0)&&(e(this.text.zOffsetVertexArray,x,I),e(this.text.zOffsetVertexArray,w,I)),P){const{placedIconSymbolIndex:R,verticalPlacedIconSymbolIndex:F}=d;R>=0&&i(this.icon.zOffsetVertexArray,T,I),F>=0&&i(this.icon.zOffsetVertexArray,d.numVerticalIconVertices,I)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=xb(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:a,y:h}of i)this.lineVertexArray.emplaceBack(a,h);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,a,h,d,x,w,T,I,P,R,F,N,H,Z){const ee=e.indexArray,oe=e.layoutVertexArray,ae=e.globeExtVertexArray,q=e.segments.prepareSegment(4*i.length,oe,ee,this.canOverlap?d.sortKey:void 0),re=this.glyphOffsetArray.length,le=q.vertexLength,fe=this.allowVerticalPlacement&&x===ma.vertical?Math.PI/2:0,Me=d.text&&d.text.sections;for(let Re=0;Re<i.length;Re++){const{tl:Ne,tr:Je,bl:gt,br:ct,texPrimary:mt,texSecondary:xt,pixelOffsetTL:tt,pixelOffsetBR:ft,minFontScaleX:Ke,minFontScaleY:Qe,glyphOffset:Ct,isSDF:At,sectionIndex:hi}=i[Re],ii=q.vertexLength,Ut=Ct[1];if(T_(oe,T.x,T.y,Ne.x,Ut+Ne.y,mt.x,mt.y,o,At,tt.x,tt.y,Ke,Qe),T_(oe,T.x,T.y,Je.x,Ut+Je.y,mt.x+mt.w,mt.y,o,At,ft.x,tt.y,Ke,Qe),T_(oe,T.x,T.y,gt.x,Ut+gt.y,mt.x,mt.y+mt.h,o,At,tt.x,ft.y,Ke,Qe),T_(oe,T.x,T.y,ct.x,Ut+ct.y,mt.x+mt.w,mt.y+mt.h,o,At,ft.x,ft.y,Ke,Qe),w){const{x:St,y:Mi,z:ti}=w.anchor,[ni,Ti,Vi]=w.up;E_(ae,St,Mi,ti,ni,Ti,Vi),E_(ae,St,Mi,ti,ni,Ti,Vi),E_(ae,St,Mi,ti,ni,Ti,Vi),E_(ae,St,Mi,ti,ni,Ti,Vi),A_(e.dynamicLayoutVertexArray,St,Mi,ti,fe)}else A_(e.dynamicLayoutVertexArray,T.x,T.y,T.z,fe);if(Z){const St=xt||mt;S_(e.iconTransitioningVertexArray,St.x,St.y),S_(e.iconTransitioningVertexArray,St.x+St.w,St.y),S_(e.iconTransitioningVertexArray,St.x,St.y+St.h),S_(e.iconTransitioningVertexArray,St.x+St.w,St.y+St.h)}ee.emplaceBack(ii,ii+1,ii+2),ee.emplaceBack(ii+1,ii+2,ii+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ct[0]),Re!==i.length-1&&hi===i[Re+1].sectionIndex||e.programConfigurations.populatePaintArrays(oe.length,d,d.index,{},F,N,H,Me&&Me[hi],this.worldview)}const Ce=w?w.anchor:T;e.placedSymbolArray.emplaceBack(Ce.x,Ce.y,Ce.z,T.x,T.y,re,this.glyphOffsetArray.length-re,le,I,P,T.segment,o?o[0]:0,o?o[1]:0,a[0],a[1],x,0,0,0,R,0)}_commitLayoutVertex(e,i,o,a,h,d,x){e.emplaceBack(i,o,a,h,d,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,o,a,h,d,x){const w=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),T=w.vertexLength,I=x.tileAnchorX,P=x.tileAnchorY;for(let F=0;F<4;F++)o.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,x.zOffset),this._commitLayoutVertex(o.layoutVertexArray,a,h,d,I,P,new Rt(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,a,h,d,I,P,new Rt(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,a,h,d,I,P,new Rt(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,a,h,d,I,P,new Rt(e.x1,e.y2)),w.vertexLength+=4;const R=o.indexArray;R.emplaceBack(T,T+1),R.emplaceBack(T+1,T+2),R.emplaceBack(T+2,T+3),R.emplaceBack(T+3,T),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,a,h,d){for(let x=a;x<h;x++){const w=o.get(x),T=this.getSymbolInstanceTextSize(e,d,i,x);this._addCollisionDebugVertices(w,T,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,i,o,a,h,d){for(let x=a;x<h;x++){const w=o.get(x),T=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._addCollisionDebugVertices(w,T,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,i,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new E0(Hh,Lw.members,_l),this.iconCollisionBox=new E0(Hh,Lw.members,_l);const a=Ym(this.iconSizeData,e),h=Ym(this.textSizeData,e,o);for(let d=0;d<this.symbolInstances.length;d++){const x=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(h,e,i,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(h,e,i,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(a,e,i,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(a,e,i,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,i,o,a){const h=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:a),d=_0(this.textSizeData,e,h)/Ps;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,i,o){const a=this.icon.placedSymbolArray.get(o),h=_0(this.iconSizeData,e,a);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,i,o,a){e.emplaceBack(i,-o,-o,a),e.emplaceBack(i,o,-o,a),e.emplaceBack(i,o,o,a),e.emplaceBack(i,-o,o,a)}_updateTextDebugCollisionBoxes(e,i,o,a,h,d,x){for(let w=a;w<h;w++){const T=o.get(w),I=this.getSymbolInstanceTextSize(e,d,i,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,I,T.padding,d.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,a,h,d,x){for(let w=a;w<h;w++){const T=o.get(w),I=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,I,T.padding,d.zOffset)}}updateCollisionDebugBuffers(e,i,o,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=Ym(this.iconSizeData,e,a),d=Ym(this.textSizeData,e,o);for(let x=0;x<this.symbolInstances.length;x++){const w=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(d,e,i,w.textBoxStartIndex,w.textBoxEndIndex,w,o),this._updateTextDebugCollisionBoxes(d,e,i,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w,o),this._updateIconDebugCollisionBoxes(h,e,i,w.iconBoxStartIndex,w.iconBoxEndIndex,w,a),this._updateIconDebugCollisionBoxes(h,e,i,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w,a)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,a,h,d,x,w,T){const I={};if(i<o){const{x1:P,y1:R,x2:F,y2:N,padding:H,projectedAnchorX:Z,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:ae,tileAnchorY:q,featureIndex:re}=e.get(i);I.textBox={x1:P,y1:R,x2:F,y2:N,padding:H,projectedAnchorX:Z,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:ae,tileAnchorY:q},I.textFeatureIndex=re}if(a<h){const{x1:P,y1:R,x2:F,y2:N,padding:H,projectedAnchorX:Z,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:ae,tileAnchorY:q,featureIndex:re}=e.get(a);I.verticalTextBox={x1:P,y1:R,x2:F,y2:N,padding:H,projectedAnchorX:Z,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:ae,tileAnchorY:q},I.verticalTextFeatureIndex=re}if(d<x){const{x1:P,y1:R,x2:F,y2:N,padding:H,projectedAnchorX:Z,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:ae,tileAnchorY:q,featureIndex:re}=e.get(d);I.iconBox={x1:P,y1:R,x2:F,y2:N,padding:H,projectedAnchorX:Z,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:ae,tileAnchorY:q},I.iconFeatureIndex=re}if(w<T){const{x1:P,y1:R,x2:F,y2:N,padding:H,projectedAnchorX:Z,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:ae,tileAnchorY:q,featureIndex:re}=e.get(w);I.verticalIconBox={x1:P,y1:R,x2:F,y2:N,padding:H,projectedAnchorX:Z,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:ae,tileAnchorY:q},I.verticalIconFeatureIndex=re}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),a=o.vertexStartIndex+4*o.numGlyphs;for(let h=o.vertexStartIndex;h<a;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),a=[],h=[],d=[];for(let x=0;x<this.symbolInstances.length;++x){d.push(x);const w=this.symbolInstances.get(x);a.push(0|Math.round(i*w.tileAnchorX+o*w.tileAnchorY)),h.push(w.featureIndex)}return d.sort((x,w)=>a[x]-a[w]||h[w]-h[x]),d}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:T}=o;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),h>=0&&h!==a&&this.addIndicesForPlacedSymbol(this.text,h),d>=0&&d!==h&&d!==a&&this.addIndicesForPlacedSymbol(this.text,d),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let vb,wb,C0;qt(I_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),I_.addDynamicAttributes=A_;class bb{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:bu,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qt(bb,"FormatSectionOverride",{omit:["defaultValue"]});const A0=()=>C0||(C0={layout:vb||(vb=new ur({"symbol-placement":new wt(je.layout_symbol["symbol-placement"]),"symbol-spacing":new wt(je.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new wt(je.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new kt(je.layout_symbol["symbol-sort-key"]),"symbol-z-order":new wt(je.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new wt(je.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new wt(je.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new wt(je.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new wt(je.layout_symbol["icon-ignore-placement"]),"icon-optional":new wt(je.layout_symbol["icon-optional"]),"icon-rotation-alignment":new wt(je.layout_symbol["icon-rotation-alignment"]),"icon-size":new kt(je.layout_symbol["icon-size"]),"icon-size-scale-range":new wt(je.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new kt(je.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new kt(je.layout_symbol["icon-text-fit-padding"]),"icon-image":new kt(je.layout_symbol["icon-image"]),"icon-rotate":new kt(je.layout_symbol["icon-rotate"]),"icon-padding":new wt(je.layout_symbol["icon-padding"]),"icon-keep-upright":new wt(je.layout_symbol["icon-keep-upright"]),"icon-offset":new kt(je.layout_symbol["icon-offset"]),"icon-anchor":new kt(je.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new wt(je.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new wt(je.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new wt(je.layout_symbol["text-rotation-alignment"]),"text-field":new kt(je.layout_symbol["text-field"]),"text-font":new kt(je.layout_symbol["text-font"]),"text-size":new kt(je.layout_symbol["text-size"]),"text-size-scale-range":new wt(je.layout_symbol["text-size-scale-range"]),"text-max-width":new kt(je.layout_symbol["text-max-width"]),"text-line-height":new kt(je.layout_symbol["text-line-height"]),"text-letter-spacing":new kt(je.layout_symbol["text-letter-spacing"]),"text-justify":new kt(je.layout_symbol["text-justify"]),"text-radial-offset":new kt(je.layout_symbol["text-radial-offset"]),"text-variable-anchor":new wt(je.layout_symbol["text-variable-anchor"]),"text-anchor":new kt(je.layout_symbol["text-anchor"]),"text-max-angle":new wt(je.layout_symbol["text-max-angle"]),"text-writing-mode":new wt(je.layout_symbol["text-writing-mode"]),"text-rotate":new kt(je.layout_symbol["text-rotate"]),"text-padding":new wt(je.layout_symbol["text-padding"]),"text-keep-upright":new wt(je.layout_symbol["text-keep-upright"]),"text-transform":new kt(je.layout_symbol["text-transform"]),"text-offset":new kt(je.layout_symbol["text-offset"]),"text-allow-overlap":new wt(je.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new wt(je.layout_symbol["text-ignore-placement"]),"text-optional":new wt(je.layout_symbol["text-optional"]),visibility:new wt(je.layout_symbol.visibility)})),paint:wb||(wb=new ur({"icon-opacity":new kt(je.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new kt(je.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new kt(je.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new kt(je.paint_symbol["text-emissive-strength"]),"icon-color":new kt(je.paint_symbol["icon-color"]),"icon-halo-color":new kt(je.paint_symbol["icon-halo-color"]),"icon-halo-width":new kt(je.paint_symbol["icon-halo-width"]),"icon-halo-blur":new kt(je.paint_symbol["icon-halo-blur"]),"icon-translate":new wt(je.paint_symbol["icon-translate"]),"icon-translate-anchor":new wt(je.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new wt(je.paint_symbol["icon-image-cross-fade"]),"text-opacity":new kt(je.paint_symbol["text-opacity"]),"text-occlusion-opacity":new kt(je.paint_symbol["text-occlusion-opacity"]),"text-color":new kt(je.paint_symbol["text-color"],{runtimeType:_o,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new kt(je.paint_symbol["text-halo-color"]),"text-halo-width":new kt(je.paint_symbol["text-halo-width"]),"text-halo-blur":new kt(je.paint_symbol["text-halo-blur"]),"text-translate":new wt(je.paint_symbol["text-translate"]),"text-translate-anchor":new wt(je.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new wt(je.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new wt(je.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new wt(je.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new wt(je.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new kt(je.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},C0);class P_ extends Is{constructor(e,i,o,a){super(e,A0(),i,o,a),this._colorAdjustmentMatrix=ve([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const a=[];for(const h of o)a.indexOf(h)<0&&a.push(h);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,o,a){return this._saturation===e&&this._contrast===i&&this._brightnessMin===o&&this._brightnessMax===a||(this._colorAdjustmentMatrix=function(h,d,x,w){h=Ds(h),d=Lr(d);const T=Se(),I=h/3,P=1-2*I,R=[P,I,I,0,I,P,I,0,I,I,P,0,0,0,0,1],F=.5-.5*d,N=w-x;return ze(T,[N,0,0,0,0,N,0,0,0,0,N,0,x,x,x,1],[d,0,0,0,0,d,0,0,0,0,d,0,F,F,F,1]),ze(T,T,R),T}(e,i,o,a),this._saturation=e,this._contrast=i,this._brightnessMin=o,this._brightnessMax=a),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,o,a){const h=this.layout.get(e).evaluate(i,{},o,a),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||hl(d.value)||!h?h:function(x,w){return w.replace(/{([^{}]+)}/g,(T,I)=>I in x?String(x[I]):"")}(i.properties,h)}createBucket(e){return new I_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of A0().paint.overridableProperties){if(!P_.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new bb(i),a=new Hc(o,i.property.specification,this.scope,this.options);let h=null;h=i.value.kind==="constant"||i.value.kind==="source"?new Ql("source",a):new ec("composite",a,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Ba(i.property,h,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&P_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),a=A0().paint.properties[i];let h=!1;const d=x=>{for(const w of x)if(a.overrides&&a.overrides.hasOverride(w))return void(h=!0)};if(o.value.kind==="constant"&&o.value.value instanceof $s)d(o.value.value.sections);else if(o.value.kind==="source"){const x=T=>{h||(T instanceof vi&&Xt(T.value)===Tu?d(T.value.sections):T instanceof Mc?d(T.sections):T.eachChild(x))},w=o.value;w._styleExpression&&x(w._styleExpression.expression)}return h}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,o){return{config:new Zs(this,{zoom:i,lut:o}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Tb,Sb,Eb,Cb;var I0=hn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function P0(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function M0(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class R0{constructor(e,i,o,a){this.context=e,this.format=o,this.useMipmap=a&&a.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:a&&a.premultiply})}update(e,i){const o=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,a=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:h}=this,{gl:d}=h,{x,y:w}=i&&i.position?i.position:{x:0,y:0},T=x+o,I=w+a;!this.size||this.size[0]===T&&this.size[1]===I||(d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(this.texture),this.texture=d.createTexture(),this.size=null),d.bindTexture(d.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===d.RGBA8&&(!i||i.premultiply!==!1));const P=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&T>0&&I>0){const R=this.useMipmap?Math.floor(Math.log2(Math.max(T,I)))+1:1;d.texStorage2D(d.TEXTURE_2D,R,this.format,T,I),this.size=[T,I]}if(this.size)if(P)d.texSubImage2D(d.TEXTURE_2D,0,x,w,P0(this.format),M0(this.format),e);else{const R=e.data;R&&d.texSubImage2D(d.TEXTURE_2D,0,x,w,o,a,P0(this.format),M0(this.format),R)}this.useMipmap&&d.generateMipmap(d.TEXTURE_2D)}bind(e,i,o=!1){const{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,a,h){const{context:d}=this,{gl:x}=d;x.bindTexture(x.TEXTURE_2D,this.texture),i!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?e===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,o),this.wrapS=o),a!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,a),this.wrapT=a),h!==this.compareMode&&(h?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.COMPARE_REF_TO_TEXTURE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_FUNC,h)):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.NONE),this.compareMode=h)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class M_{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:o}=this,{gl:a}=o;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrapS=i)}}function R_(n,e,i,o,a,h,d,x){const w=[n,e,1,i,o,1,a,h,1],T=[d,x,1],I=de([],w),[P,R,F]=Hr(T,T,I);return Pe(w,w,[P,0,0,0,R,0,0,0,F])}function Ab(n,e,i,o,a,h,d,x){const w=function(T,I,P,R,F,N,H,Z){const ee=R_(0,0,1,0,1,1,0,1),oe=R_(T,I,P,R,F,N,H,Z);return Pe(oe,oe,de([],ee))}(n,e,i,o,a,h,d,x);return[w[2]/w[8]/Lt,w[5]/w[8]/Lt]}function k_(n){return[n[0],Math.min(Math.max(n[1],-85.051129),nt)]}class Ib extends Ul{constructor(e,i,o,a){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Vl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Sc(this.map._requestManager.transformRequest(this.url,qo.Image),(o,a)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new ra(o)):a&&(this.image=a instanceof HTMLImageElement?Ho.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new M_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Vl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof M_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(const h of e)h[1]>o&&(o=h[1]),h[1]<i&&(i=h[1]);const a=(o+i)/2;if(a>nt?this.onNorthPole=!0:a<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const h=e.map(ke.fromLngLat);this.tileID=function(d){let x=1/0,w=1/0,T=-1/0,I=-1/0;for(const H of d)x=Math.min(x,H.x),w=Math.min(w,H.y),T=Math.max(T,H.x),I=Math.max(I,H.y);const P=Math.max(T-x,I-w),R=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),F=Math.pow(2,R);let N=Math.floor((x+T)/2*F);return N>1&&(N-=1),new id(R,N,Math.floor((w+I)/2*F))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Vl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const ee in this.tiles){const oe=this.tiles[ee];oe.state!=="loaded"&&(oe.state="loaded",oe.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Qm(new id(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ee){const oe=ee[1].x-ee[0].x,ae=ee[1].y-ee[0].y,q=ee[2].x-ee[1].x,re=ee[2].y-ee[1].y,le=ee[3].x-ee[2].x,fe=ee[3].y-ee[2].y,Me=ee[0].x-ee[3].x,Ce=ee[0].y-ee[3].y,Re=oe*re-q*ae,Ne=q*fe-le*re,Je=le*Ce-Me*fe,gt=Me*ae-oe*Ce;return Re>0&&Ne>0&&Je>0&&gt>0||Re<0&&Ne<0&&Je<0&&gt<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const a=Qm(this.tileID,this.map.transform.projection),[h,d,x,w]=this.coordinates.map(ee=>{const oe=a.projection.project(ee[0],ee[1]);return pb(a,oe)._round()});this.perspectiveTransform=Ab(h.x,h.y,d.x,d.y,x.x,x.y,w.x,w.y);const T=this._boundsArray=new Xu;T.emplaceBack(h.x,h.y,0,0),T.emplaceBack(d.x,d.y,Lt,0),T.emplaceBack(w.x,w.y,0,Lt),T.emplaceBack(x.x,x.y,Lt,Lt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(T,I0.members),this.boundsSegments=Vn.simpleSegment(0,0,4,2);const I=[],P=[k_((R=this.coordinates)[0]),k_(R[1]),k_(R[2]),k_(R[3])];var R;const[F,N,H,Z]=function(ee){let oe=ee[0][0],ae=oe,q=ee[0][1],re=q;for(let le=1;le<ee.length;le++)ee[le][0]<oe?oe=ee[le][0]:ee[le][0]>ae&&(ae=ee[le][0]),ee[le][1]<q?q=ee[le][1]:ee[le][1]>re&&(re=ee[le][1]);return[oe,q,ae-oe,re-q]}(P);{const ee=new Xu,[oe,ae,q,re]=function(tt){let ft=tt[0].x,Ke=ft,Qe=tt[0].y,Ct=Qe;for(let At=1;At<tt.length;At++)tt[At].x<ft?ft=tt[At].x:tt[At].x>Ke&&(Ke=tt[At].x),tt[At].y<Qe?Qe=tt[At].y:tt[At].y>Ct&&(Ct=tt[At].y);return[ft,Qe,Ke-ft,Ct-Qe]}(o),le=tt=>[(tt.x-oe)/q,(tt.y-ae)/re],[fe,Me,Ce,Re]=o.map(le),Ne=function(tt,ft,Ke,Qe,Ct,At,hi,ii){const Ut=R_(0,0,1,0,1,1,0,1);return Pe(Ut,Ut,de([],R_(tt,ft,Ke,Qe,Ct,At,hi,ii)))}(fe[0],fe[1],Me[0],Me[1],Ce[0],Ce[1],Re[0],Re[1]);this.elevatedGlobePerspectiveTransform=Ab(fe[0],fe[1],Me[0],Me[1],Ce[0],Ce[1],Re[0],Re[1]);const Je=(tt,ft)=>{I.push(tt.lng);const Ke=Math.round((tt.lng-F)/H*Lt),Qe=Math.round((tt.lat-N)/Z*Lt),Ct=le(ft),At=Hr([],[Ct[0],Ct[1],1],Ne),hi=Math.round(At[0]/At[2]*Lt),ii=Math.round(At[1]/At[2]*Lt);ee.emplaceBack(Ke,Qe,hi,ii)},gt=o[3].x-o[0].x,ct=o[3].y-o[0].y,mt=o[2].x-o[1].x,xt=o[2].y-o[1].y;for(let tt=0;tt<65;tt++){const ft=tt/64,Ke=[o[0].x+ft*gt,o[0].y+ft*ct],Qe=[o[1].x+ft*mt,o[1].y+ft*xt],Ct=Qe[0]-Ke[0],At=Qe[1]-Ke[1];for(let hi=0;hi<65;hi++){const ii=hi/64,Ut={x:Ke[0]+Ct*ii,y:Ke[1]+At*ii};Je(i.projection.unproject(Ut.x,Ut.y),Ut)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(ee,I0.members)}{this.maxLongitudeTriangleSize=0;let ee=[],oe=new Yr;const ae=(q,re,le)=>{oe.emplaceBack(q,re,le);const fe=I[q],Me=I[re],Ce=I[le],Re=Math.min(Math.min(fe,Me),Ce),Ne=Math.max(Math.max(fe,Me),Ce)-Re;Ne>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ne),ee.push(Re+Ne/2)};for(let q=0;q<64;q++)for(let re=0;re<64;re++){const le=65*q+re,fe=le+1,Me=le+65,Ce=Me+1;ae(le,Me,fe),ae(fe,Me,Ce)}[ee,oe]=function(q,re){const le=Array.from({length:q.length},(Ce,Re)=>Re);le.sort((Ce,Re)=>q[Ce]-q[Re]);const fe=[],Me=new Yr;for(let Ce=0;Ce<le.length;Ce++){const Re=le[Ce];fe.push(q[Re]);const Ne=3*Re,Je=Ne+1;Me.emplaceBack(re.uint16[Ne],re.uint16[Je],re.uint16[Je+1])}return[fe,Me]}(ee,oe),this.elevatedGlobeTrianglesCenterLongitudes=ee,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(oe)}this.elevatedGlobeSegments=Vn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,H/Lt,0,Z/Lt,0,0,N,F,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof M_||(this.texture?this.texture.update(this.image):(this.texture=new R0(i,this.image,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let a=(h=e+180)+360*Math.round((o[0]-h)/360);var h;const d=new Vn,x=(P,R)=>{d.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:i.segments[0].vertexLength,primitiveLength:R,sortKey:void 0,vaos:{}})},w=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-a)<=w){const P=Nr(o,0,o.length,a+w);return P===o.length||x(P,lr(o,P+1,o.length,a+360-w)-P),d}a<o[0]&&(a+=360);const T=lr(o,0,o.length,a-w);if(T===o.length)return x(0,o.length),d;x(0,T-0);const I=Nr(o,T+1,o.length,a+w);return I!==o.length&&x(I,o.length-I),d}}const tI=(Math.pow(256,2)-1)/16907520;class Pb extends Is{constructor(e,i,o,a){super(e,{layout:Eb||(Eb=new ur({visibility:new wt(je.layout_raster.visibility)})),paint:Cb||(Cb=new ur({"raster-opacity":new wt(je.paint_raster["raster-opacity"]),"raster-color":new pl(je.paint_raster["raster-color"]),"raster-color-mix":new wt(je.paint_raster["raster-color-mix"]),"raster-color-range":new wt(je.paint_raster["raster-color-range"]),"raster-hue-rotate":new wt(je.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new wt(je.paint_raster["raster-brightness-min"]),"raster-brightness-max":new wt(je.paint_raster["raster-brightness-max"]),"raster-saturation":new wt(je.paint_raster["raster-saturation"]),"raster-contrast":new wt(je.paint_raster["raster-contrast"]),"raster-resampling":new wt(je.paint_raster["raster-resampling"]),"raster-fade-duration":new wt(je.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new wt(je.paint_raster["raster-emissive-strength"]),"raster-array-band":new wt(je.paint_raster["raster-array-band"]),"raster-elevation":new wt(je.paint_raster["raster-elevation"]),"raster-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,a),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Ib&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[o,a]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(a)||o===this._curRampRange[0]&&a===this._curRampRange[1]||(this.colorRamp=Dm({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:a}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,a])}}let Mb,Rb,kb,Db,Lb;class zb extends Is{constructor(e,i,o,a){super(e,{layout:Mb||(Mb=new ur({visibility:new wt(je["layout_raster-particle"].visibility)})),paint:Rb||(Rb=new ur({"raster-particle-array-band":new wt(je["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new wt(je["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new pl(je["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new wt(je["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new wt(je["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new wt(je["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new wt(je["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new wt(je["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,a),this._updateColorRamp(),this.lastInvalidatedAt=Ho.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Dm({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ho.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class iI extends Is{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function k0(n,e,i){const o=[0,0,1],a=ko([]);return Ja(a,a,i?-_n(n)+Math.PI:_n(n)),ya(a,a,-_n(e)),js(o,o,a),Di(o,o)}function Fb(n,e){const i=D_(n.projection,n.zoom,n.width,n.height),o=function(h,d,x,w,T){const I=new ie(x.lng-180*ff,x.lat),P=new ie(x.lng+180*ff,x.lat),R=h.project(I.lng,I.lat),F=h.project(P.lng,P.lat),N=-Math.atan2(F.y-R.y,F.x-R.x),H=ke.fromLngLat(x);H.y=we(H.y,-1+ff,1-ff);const Z=H.toLngLat(),ee=h.project(Z.lng,Z.lat),oe=ke.fromLngLat(Z);oe.x+=ff;const ae=oe.toLngLat(),q=h.project(ae.lng,ae.lat),re=Nb(q.x-ee.x,q.y-ee.y,N),le=ke.fromLngLat(Z);le.y+=ff;const fe=le.toLngLat(),Me=h.project(fe.lng,fe.lat),Ce=Nb(Me.x-ee.x,Me.y-ee.y,N),Re=Math.abs(re.x)/Math.abs(Ce.y),Ne=ve([]);di(Ne,Ne,-N*(1-(T?0:w)));const Je=ve([]);return pt(Je,Je,[1,1-(1-Re)*w,1]),Je[4]=-Ce.x/Ce.y*w,di(Je,Je,N),ze(Je,Ne,Je),Je}(n.projection,0,n.center,i,e),a=Ob(n);return pt(o,o,[a,a,1]),o}function Ob(n){const e=n.projection,i=D_(n.projection,n.zoom,n.width,n.height),o=D0(e,n.center),a=D0(e,ie.convert(e.center));return Math.pow(2,o*i+(1-i)*a)}function D_(n,e,i,o,a=1/0){const h=n.range;if(!h)return 0;const d=Math.min(a,Math.max(i,o)),x=Math.log(d/1024)/Math.LN2;return De(h[0]+x,h[1]+x,e)}const ff=1/4e4;function D0(n,e){const i=we(e.lat,-85.051129,nt),o=new ie(e.lng-180*ff,i),a=new ie(e.lng+180*ff,i),h=n.project(o.lng,i),d=n.project(a.lng,i),x=ke.fromLngLat(o),w=ke.fromLngLat(a),T=d.x-h.x,I=d.y-h.y,P=w.x-x.x,R=w.y-x.y,F=Math.sqrt((P*P+R*R)/(T*T+I*I));return Math.log(F)/Math.LN2}function Nb(n,e,i){const o=Math.cos(i),a=Math.sin(i);return{x:n*o-e*a,y:n*a+e*o}}function Bb(n,e,i){ve(n),di(n,n,_n(e[2])),Tt(n,n,_n(e[0])),It(n,n,_n(e[1])),pt(n,n,i),ze(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function L_(n,e,i,o,a,h,d,x){const w=[i[0]-e[0],i[1]-e[1],0],T=[o[0]-e[0],o[1]-e[1],0];if(Li(w)<1e-12||Li(T)<1e-12)return ko(n);const I=fn([],w,T);Di(I,I),yi(T,o,e),w[2]=(h-a)*x,T[2]=(d-a)*x;const P=w;return fn(P,w,T),Di(P,P),va(n,I,P)}function L0(n,e,i=!1){const o=tn(e.zoom),a=function(h,d,x){const w=d.worldSize,T=[h[12],h[13],h[14]],I=Oe(T[1]/w),P=Ae(T[0]/w),R=ve([]),F=Ee(1,I)*w,N=Ee(1,0)*w*ht(I,d.zoom),H=1/_t(w);let Z=N*H;if(x){const q=D_(d.projection,d.zoom,d.width,d.height,1024);Z=H*d.projection.pixelSpaceConversion(d.center.lat,w,q)}const ee=W(I,P);Ci(ee,ee,Kt([],Di([],ee),F*Z*T[2]));const oe=function(q){const re=[q[0],q[1],q[2]];let le=[0,1,0];const fe=fn([],le,re);return fn(le,re,fe),un(le)===0&&(le=[0,1,0],fn(fe,re,le)),Di(fe,fe),Di(le,le),Di(re,re),[fe[0],fe[1],fe[2],0,le[0],le[1],le[2],0,re[0],re[1],re[2],0,q[0],q[1],q[2],1]}(ee);pt(R,R,[Z,Z,Z*F]),et(R,R,[-T[0],-T[1],-T[2]]);const ae=ze([],d.globeMatrix,oe);return ze(ae,ae,R),ze(ae,ae,h),ae}(n,e,i);if(o>0){const h=function(d,x){const w=x.worldSize,T=Ee(1,0)*w*ht(x.center.lat,x.zoom)/_t(w),I=Ee(1,x.center.lat)*w,P=ve([]);return It(P,P,_n(x.center.lng)),Tt(P,P,_n(x.center.lat)),et(P,P,[0,0,v]),pt(P,P,[T,T,T*I]),et(P,P,[x.point.x-.5*w,x.point.y-.5*w,0]),ze(P,P,d),ze(P,x.globeMatrix,P)}(n,e);return function(d,x,w){const T=(N,H,Z)=>{const ee=Li(N),oe=Li(H),ae=bt(N,H,Z);return Kt(ae,ae,1/Li(ae)*gi(ee,oe,Z))},I=T([d[0],d[1],d[2]],[x[0],x[1],x[2]],w),P=T([d[4],d[5],d[6]],[x[4],x[5],x[6]],w),R=T([d[8],d[9],d[10]],[x[8],x[9],x[10]],w),F=bt([d[12],d[13],d[14]],[x[12],x[13],x[14]],w);return[I[0],I[1],I[2],0,P[0],P[1],P[2],0,R[0],R[1],R[2],0,F[0],F[1],F[2],1]}(a,h,o)}return a}function jb(n,e,i,o){const a=vn.projectAabbCorners(o,i);let h=Number.MAX_VALUE,d=-1;for(let T=0;T<a.length;++T){const I=a[T];I[0]=(.5*I[0]+.5)*e.width,I[1]=(.5-.5*I[1])*e.height,I[2]<h&&(d=T,h=I[2])}const x=T=>new Rt(a[T][0],a[T][1]);let w;switch(d){case 0:case 6:w=[x(1),x(5),x(4),x(7),x(3),x(2),x(1)];break;case 1:case 7:w=[x(0),x(4),x(5),x(6),x(2),x(3),x(0)];break;case 3:case 5:w=[x(1),x(0),x(4),x(7),x(6),x(2),x(1)];break;default:w=[x(1),x(5),x(6),x(7),x(3),x(0),x(1)]}if(uo(n,w))return h}const nI=hn([{name:"a_pos_3f",components:3,type:"Float32"}]),rI=hn([{name:"a_color_3f",components:3,type:"Float32"}]),sI=hn([{name:"a_color_4f",components:4,type:"Float32"}]),oI=hn([{name:"a_uv_2f",components:2,type:"Float32"}]),aI=hn([{name:"a_normal_3f",components:3,type:"Float32"}]),lI=hn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),cI=hn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),Vb={None:0,Model:1,Symbol:2,FillExtrusion:4};class z_{constructor(e,i,o,a){this.message=(e?`${e}: `:"")+o,a&&(this.identifier=a),i!=null&&i.__line__&&(this.line=i.__line__)}}function z0(n,e){const i=n.indexOf("://")===-1;try{return new URL(n,i&&e?"http://example.com":void 0),!0}catch{return!1}}class Ub{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Gb{constructor(){this.instancedDataArray=new Jc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class F0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,o,a){this.tileToMeter=Xe(o);const h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:d,id:x,index:w,sourceLayerIndex:T}of e){const I=x??(d.properties&&d.properties.hasOwnProperty("id")?d.properties.id:void 0),P=Ot(d,h);if(!this.layers[0]._featureFilter.filter(new Pn(this.zoom,{worldview:this.worldview}),P,o))continue;const R={id:I,sourceLayerIndex:T,index:w,geometry:h?P.geometry:Wt(d,o,a),properties:d.properties,type:d.type,patterns:{}},F=this.addFeature(R,R.geometry,P);F&&i.featureIndex.insert(d,R.geometry,w,T,this.index,this.instancesPerModel[F].instancedDataArray.length,Lt/32)}this.lookup=null}update(e,i,o,a){for(const h in this.instancesPerModel){const d=this.instancesPerModel[h];for(const x in e)d.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(d.features[d.idToFeaturesIndex[x]],e[x],d,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];for(const a of o.features){const h=this.layers[0],d=a.feature,x=this.canonical,w=h.paint.get("model-rotation").evaluate(d,{},x),T=h.paint.get("model-scale").evaluate(d,{},x),I=h.paint.get("model-translation").evaluate(d,{},x);Rs(a.rotation,w)&&Rs(a.scale,T)&&Rs(a.translation,I)||(this.evaluate(a,a.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,i,o,a){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Qy(this.activeReplacements,h))return!1;this.activeReplacements=h;let d=!1;for(const x in this.instancesPerModel){const w=this.instancesPerModel[x],T=w.instancedDataArray;for(const I of w.features){const P=I.instancedDataOffset,R=I.instancedDataCount;for(let F=0;F<R;F++){const N=16*(F+P);let H=T.float32[N+0];const Z=H>Lt;H=Z?H-Lt:H;const ee=Math.floor(H),oe=T.float32[N+1];let ae=!1;for(const q of this.activeReplacements)if(!z1(q,o,Vb.Model,a)&&!(q.min.x>ee||ee>q.max.x||q.min.y>oe||oe>q.max.y)&&(ae=V1(j1(ee,oe,e.canonical,q.footprintTileId.canonical),q.footprint),ae))break;T.float32[N]=ae?H+Lt:H,d=d||ae!==Z}}}return d}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,lI.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,o){const a=this.layers[0],h=a.layout.get("model-id").evaluate(o,{},this.canonical);if(!h)return zi(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),h;(z0(h,!1)||this.styleDefinedModelURLs[h]!==void 0)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new Gb);const d=this.instancesPerModel[h],x=d.instancedDataArray,w=new Ub(o,x.length);for(const T of i)for(const I of T){if(I.x<0||I.x>=Lt||I.y<0||I.y>=Lt)continue;const P=(this.lookupDim-1)/Lt,R=this.lookupDim*(I.y*P|0)+I.x*P|0;if(this.lookup){if(this.lookup[R]!==0)continue;this.lookup[R]=1}this.instanceCount++;const F=x.length;x.resize(F+1),d.instancesEvaluatedElevation.push(0),x.float32[16*F]=I.x,x.float32[16*F+1]=I.y}return w.instancedDataCount=d.instancedDataArray.length-w.instancedDataOffset,w.instancedDataCount>0&&(e.id&&(d.idToFeaturesIndex[e.id]=d.features.length),d.features.push(w),this.evaluate(w,{},d,!1)),h}getModelUris(){return this.modelUris}evaluate(e,i,o,a){const h=this.layers[0],d=e.feature,x=this.canonical,w=e.rotation=h.paint.get("model-rotation").evaluate(d,i,x),T=e.scale=h.paint.get("model-scale").evaluate(d,i,x),I=e.translation=h.paint.get("model-translation").evaluate(d,i,x),P=h.paint.get("model-color").evaluate(d,i,x);P.a=h.paint.get("model-color-mix-intensity").evaluate(d,i,x);const R=[];this.maxVerticalOffset<I[2]&&(this.maxVerticalOffset=I[2]),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),Bb(R,w,T);const F=Math.round(100*P.a)+P.b/1.05;for(let N=0;N<e.instancedDataCount;++N){const H=e.instancedDataOffset+N,Z=16*H,ee=o.instancedDataArray.float32;let oe=0;a&&(oe=ee[Z+6]-o.instancesEvaluatedElevation[H]);const ae=0|ee[Z+1];ee[Z]=(0|ee[Z])+P.r/1.05,ee[Z+1]=ae+P.g/1.05,ee[Z+2]=F,ee[Z+3]=1/(x.z>10?this.tileToMeter:Xe(x,ae)),ee[Z+4]=I[0],ee[Z+5]=I[1],ee[Z+6]=I[2]+oe,ee[Z+7]=R[0],ee[Z+8]=R[1],ee[Z+9]=R[2],ee[Z+10]=R[4],ee[Z+11]=R[5],ee[Z+12]=R[6],ee[Z+13]=R[8],ee[Z+14]=R[9],ee[Z+15]=R[10],o.instancesEvaluatedElevation[H]=I[2]}}}let $b,Hb;qt(F0,"ModelBucket",{omit:["layers"]}),qt(Gb,"PerModelAttributes"),qt(Ub,"ModelFeature");const cp=64,Jp={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Wb(n,e,i,o,a,h,d,x,w,T=!1){const I=i.zoom,P=i.project(o),R=ht(o.lat,I),F=1/R;ve(n),et(n,n,[P.x+d[0]*F,P.y+d[1]*F,d[2]]);let N=1,H=1;const Z=i.worldSize;if(T){if(i.projection.name==="mercator"){let q=0;i.elevation&&(q=i.elevation.getAtPointOrZero(new ke(P.x/Z,P.y/Z),0));const re=vs([],[P.x,P.y,q,1],i.projMatrix)[3]/i.cameraToCenterDistance;N=re,H=re*ht(i.center.lat,I)}else if(i.projection.name==="globe"){const q=L0(n,i),re=[0,0,0,1];vs(re,re,ze([],i.projMatrix,q));const le=re[3]/i.cameraToCenterDistance,fe=tn(I),Me=i.projection.pixelsPerMeter(o.lat,Z)*ht(o.lat,I),Ce=i.projection.pixelsPerMeter(i.center.lat,Z)*ht(i.center.lat,I);N=le/gi(Me,it(i.center.lat),fe),H=le*R/Me,N*=Ce,H*=Ce}}else N=F;pt(n,n,[N,N,H]);const ee=[...n],oe=e.orientation,ae=[];if(Bb(ae,[oe[0]+a[0],oe[1]+a[1],oe[2]+a[2]],h),ze(n,ee,ae),x&&i.elevation){let q=0;const re=[];if(w&&i.elevation){q=function(fe,Me,Ce,Re,Ne){const Je=Me.elevation;if(!Je)return 0;const gt=vn.projectAabbCorners(Ce,Re),ct=Ee(1,Ne.lat)*Me.worldSize,mt=function(St,Mi){const ti=[0,0,1],ni=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ti of ni){const Vi=St[Ti.corners[0]],Oi=St[Ti.corners[1]],Ki=St[Ti.corners[2]],Ui=[Oi[0]-Vi[0],Oi[1]-Vi[1],Mi*(Oi[2]-Vi[2])],Ji=fn(Ui,Ui,[Ki[0]-Vi[0],Ki[1]-Vi[1],Mi*(Ki[2]-Vi[2])]);Di(Ji,Ji),Ti.dotProductWithUp=Zi(Ji,ti)}return ni.sort((Ti,Vi)=>Ti.dotProductWithUp-Vi.dotProductWithUp),ni[0].corners}(gt,ct),xt=gt[mt[0]],tt=gt[mt[1]],ft=gt[mt[2]],Ke=gt[mt[3]],Qe=Je.getAtPointOrZero(new ke(xt[0]/Me.worldSize,xt[1]/Me.worldSize),0),Ct=Je.getAtPointOrZero(new ke(tt[0]/Me.worldSize,tt[1]/Me.worldSize),0),At=Je.getAtPointOrZero(new ke(ft[0]/Me.worldSize,ft[1]/Me.worldSize),0),hi=Je.getAtPointOrZero(new ke(Ke[0]/Me.worldSize,Ke[1]/Me.worldSize),0),ii=(Qe+hi)/2,Ut=(Ct+At)/2;return ii>Ut?Ct<At?L_(fe,tt,Ke,xt,Ct,hi,Qe,ct):L_(fe,ft,xt,Ke,At,Qe,hi,ct):Qe<hi?L_(fe,xt,tt,ft,Qe,Ct,At,ct):L_(fe,Ke,ft,tt,hi,At,Ct,ct),Math.max(ii,Ut)}(re,i,e.aabb,n,o);const le=ze([],vt([],re),ae);ze(n,ee,le)}else q=i.elevation.getAtPointOrZero(new ke(P.x/Z,P.y/Z),0);q!==0&&(n[14]+=q)}}function rg(n,e,i=!1){n.uploaded||(n.gfxTexture=new R0(e,n.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function uI(n,e,i){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,nI.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,aI.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,oI.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?rI:sI).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,cI.members,!0)),n.segments=Vn.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const o=n.material;o.pbrMetallicRoughness.baseColorTexture&&rg(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&rg(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&rg(o.normalTexture,e),o.occlusionTexture&&rg(o.occlusionTexture,e,i),o.emissionTexture&&rg(o.emissionTexture,e)}function O0(n,e,i){if(n.meshes)for(const o of n.meshes)uI(o,e,i);if(n.children)for(const o of n.children)O0(o,e,i)}function F_(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)F_(e)}function N0(n){if(n.meshes)for(const i of n.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const i of n.children)N0(i)}class Qp{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const a=o||e.findDEMTileFor(i);if(!a||!a.dem)return;const h=a.dem,d=a.tileID,x=1<<i.canonical.z-d.canonical.z;return new Qp(a,h.dim/Lt/x,[(i.canonical.x/x-d.canonical.x)*h.dim,(i.canonical.y/x-d.canonical.y)*h.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(o);return new Rt(a,h)}getElevationAt(e,i,o,a){const h=e*this._scale+this._offset[0],d=i*this._scale+this._offset[1],x=Math.floor(h),w=Math.floor(d),T=this._dem;return a=!!a,o?gi(gi(T.get(x,w,a),T.get(x,w+1,a),d-w),gi(T.get(x+1,w,a),T.get(x+1,w+1,a),d-w),h-x):T.get(x,w,a)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ee(1,e)*this._dem.stride}}const B0=new Float32Array(262144),up=new Uint8Array(262144);function qb(n){let e=0;if(n.meshes)for(const i of n.meshes)e=Math.max(e,i.aabb.max[2]);if(n.children)for(const i of n.children)e=Math.max(e,qb(i));return e}function Zb(n,e,i){if(n.meshes)for(const o of n.meshes){if(o.aabb.min[0]===1/0)continue;const a=vn.applyTransform(o.aabb,n.matrix);i.insert(e,a.min[0],a.min[1],a.max[0],a.max[1])}if(n.children)for(const o of n.children)Zb(o,e,i)}const Xb=["","wall","door","roof","window","lamp","logo"];class Yb{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:qb(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=vn.applyTransformFast(o.aabb,this.node.matrix),i.encapsulate(o.transformedAabb)),e++;this.aabb=i}return this.aabb}}class O_{constructor(e,i,o,a,h,d,x,w){this.id=o,this.layers=e,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=Jp.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=Jp.HasMapboxMeshFeatures),h&&(this.modelTraits|=Jp.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=d,this.worldview=w,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const T of i)this.nodesInfo.push(new Yb(T)),Zb(T,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const o of this.getNodesInfo()){const a=o.node;a.footprint&&i.push({footprint:a.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const o=i?this.stateDependentLayers:this.layers;if(!Ta(e,this.states))for(const a of o)this.evaluate(a,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const o of i){const a=o.node;this.uploaded?this.updatePbrBuffer(a):O0(a,e,!0)}for(const o of i)F_(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){const a=e.transform.projectionOptions,h=e.style.getBrightness(),d=this.brightness!==h;if(!this.uploaded||this.dirty||a.name!==this.projection.name||sg(o.paint.get("model-color").value,d)||sg(o.paint.get("model-color-mix-intensity").value,d)||sg(o.paint.get("model-roughness").value,d)||sg(o.paint.get("model-emissive-strength").value,d)||sg(o.paint.get("model-height-based-emissive-strength-multiplier").value,d)){this.projection=a,this.brightness=h;const x=this.getNodesInfo();for(const w of x)w.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),a=this.id.canonical;for(const h of o){const d=h.feature;h.evaluatedTranslation=i.paint.get("model-translation").evaluate(d,{},a),h.evaluatedScale=i.paint.get("model-scale").evaluate(d,{},a)}}evaluate(e,i){const o=this.getNodesInfo();for(const a of o){if(!a.node.meshes)continue;const h=a.feature,d=i&&i[h.id];if(Ta(d,a.state))continue;a.state=structuredClone(d);const x=a.node.meshes&&a.node.meshes[0].featureData,w=a.evaluatedColor[2],T=a.evaluatedRMEA[2],I=this.id.canonical;if(a.hasTranslucentParts=!1,x){for(let P=0;P<Xb.length;P++){const R=Xb[P];R.length&&(h.properties.part=R);const F=e.paint.get("model-color").evaluate(h,d,I).toPremultipliedRenderColor(null),N=e.paint.get("model-color-mix-intensity").evaluate(h,d,I);a.evaluatedColor[P]=[F.r,F.g,F.b,N],a.evaluatedRMEA[P][0]=e.paint.get("model-roughness").evaluate(h,d,I),a.evaluatedRMEA[P][2]=e.paint.get("model-emissive-strength").evaluate(h,d,I),a.evaluatedRMEA[P][3]=F.a,a.emissionHeightBasedParams[P]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,d,I),!a.hasTranslucentParts&&F.a<1&&(a.hasTranslucentParts=!0)}delete h.properties.part,dI(a,w!==a.evaluatedColor[2]||T!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(h,d,I);a.evaluatedTranslation=e.paint.get("model-translation").evaluate(h,d,I),a.evaluatedScale=e.paint.get("model-scale").evaluate(h,d,I),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,a){const h=e.findDEMTileFor(o);if(h&&(h.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;const d=Qp.create(e,o,h);if(!d)return;this.modelTraits&Jp.HasMapboxMeshFeatures&&this.updateDEM(e,d,o,a);for(const x of this.getNodesInfo()){const w=x.node;if(!w.footprint||!w.footprint.vertices||!w.footprint.vertices.length)continue;const T=w.footprint.vertices;let I=d.getElevationAt(T[0].x,T[0].y,!0,!0);for(let P=1;P<T.length;P++)I=Math.min(I,d.getElevationAt(T[P].x,T[P].y,!0,!0));w.elevation=I}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,a){let h=i._dem._modifiedForSources[a];if(h===void 0&&(i._dem._modifiedForSources[a]=[],h=i._dem._modifiedForSources[a]),h.includes(o.canonical))return;const d=i._dem.dim;h.push(o.canonical);let x=!1;for(const w of this.getNodesInfo()){const T=w.node;if(!T.footprint||!T.footprint.grid)continue;const I=T.footprint.grid,P=i.tileCoordToPixel(I.min.x,I.min.y),R=i.tileCoordToPixel(I.max.x,I.max.y),F=Math.min(Math.min(d-R.y,P.x),Math.min(P.y,d-R.x));if(F<0)continue;const N=we(F,2,5);let H=Math.max(0,P.x-N),Z=Math.max(0,P.y-N),ee=Math.min(R.x+N,d-1),oe=Math.min(R.y+N,d-1);for(let le=Z;le<=oe;++le)for(let fe=H;fe<=ee;++fe)up[le*d+fe]=255;let ae=0,q=0;for(let le=0;le<I.cellsY;++le)for(let fe=0;fe<I.cellsX;++fe){if(!I.cells[le*I.cellsX+fe])continue;const Me=i.tileCoordToPixel(I.min.x+fe/I.xScale,I.min.y+le/I.yScale),Ce=i.tileCoordToPixel(I.min.x+(fe+1)/I.xScale,I.min.y+(le+1)/I.yScale);for(let Re=Me.y;Re<=Math.min(Ce.y+1,d-1);++Re)for(let Ne=Me.x;Ne<=Math.min(Ce.x+1,d-1);++Ne)up[Re*d+Ne]===255&&(up[Re*d+Ne]=0,ae+=i.getElevationAtPixel(Ne,Re),q++)}const re=ae/q;H=Math.max(1,P.x-N),Z=Math.max(1,P.y-N),ee=Math.min(R.x+N,d-2),oe=Math.min(R.y+N,d-2),x=!0;for(let le=Z;le<=oe;++le)for(let fe=H;fe<=ee;++fe)up[le*d+fe]===0&&(B0[le*d+fe]=i._dem.set(fe,le,re));for(let le=1;le<N;++le){H=Math.max(1,P.x-le),Z=Math.max(1,P.y-le),ee=Math.min(R.x+le,d-2),oe=Math.min(R.y+le,d-2);for(let fe=Z;fe<=oe;++fe)for(let Me=H;Me<=ee;++Me){const Ce=fe*d+Me;if(up[Ce]===255){let Re=0,Ne=0,Je=-1,gt=-1;for(let ct=-1;ct<=1;++ct)for(let mt=-1;mt<=1;++mt){const xt=(fe+ct)*d+Me+mt;if(up[xt]>=le)continue;const tt=B0[xt],ft=Math.abs(tt);ft>Ne&&(Re=tt,Ne=ft,Je=mt,gt=ct)}if(Ne>.1){const ct=1-(le+.5*Math.abs(Je*gt))/N;let mt=i._dem.get(Me,fe)+Re*ct;const xt=i._dem.get(Me+Je,fe+gt),tt=i._dem.get(Me-Je,fe-gt,!0);(mt-xt)*(mt-tt)>0&&(mt=(xt+tt)/2),B0[Ce]=i._dem.set(Me,fe,mt),up[Ce]=le}}}}}x&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Ho.now())}setFilter(e){this.filter=e?Vh(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Pn(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)F_(i.node),N0(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped());for(const a of this.getNodesInfo()){const h=a.node.footprint;a.hiddenByReplacement=!!h&&!o.find(d=>d.footprint===h)}}getHeightAtTileCoord(e,i){const o=[],a=[0,0,0],h=ve([]);for(const d of this.getNodesInfo()){const x=d.node.meshes[0],w=x.transformedAabb;if(e<w.min[0]||i<w.min[1]||e>w.max[0]||i>w.max[1])continue;if(d.node.hidden===!0)return{height:1/0,maxHeight:d.feature.properties.height,hidden:!1,verticalScale:d.evaluatedScale[2]};ce(h,d.node.matrix),a[0]=e,a[1]=i,Xi(a,a,h);const T=(a[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*cp|0,I=Math.min(63,(a[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*cp|0)*cp+Math.min(63,T),P=x.heightmap[I];if(!(P<0&&d.node.footprint))return d.hiddenByReplacement?void 0:{height:P,maxHeight:d.feature.properties.height,hidden:!1,verticalScale:d.evaluatedScale[2]};if(d.node.footprint.grid.query(new Rt(e,i),new Rt(e,i),o),o.length>0)return{height:void 0,maxHeight:d.feature.properties.height,hidden:d.hiddenByReplacement,verticalScale:d.evaluatedScale[2]}}}}function sg(n,e){return n instanceof Ql&&!n.isLightConstant&&e}function hI(n,e,i,o,a,h,d,x){let w=(61440&e|(61440&e)>>4)>>8,T=(3840&e|(3840&e)>>4)>>4,I=240&e|(240&e)>>4;i[3]>0&&(w=gi(w,255*i[0],i[3]),T=gi(T,255*i[1],i[3]),I=gi(I,255*i[2],i[3]));const P=w<<8|T,R=I<<8|Math.floor(255*o[3]),F=function(le){const fe=we(le,0,2);return Math.min(Math.round(.5*fe*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],N=we(a[0],0,1),H=we(a[1],0,1),Z=we(a[2],0,1),ee=we(a[3],0,1);let oe,ae,q,re;if(N!==H&&d!==h&&H!==N){const le=d-h;ae=1/(le*(H-N)),q=-(h+le*N)/(le*(H-N));const fe=we(a[4],-1,1);re=Math.pow(10,fe),oe=255*Z<<8|255*ee}else oe=65535,ae=0,q=1,re=1;if(n.emplaceBack(P,R,F,oe,ae,q,re),x){const le=x.length;x.clear();for(let fe=0;fe<le;fe++)x.emplaceBack(P,R,F,oe,ae,q,re)}}function dI(n,e,i){const o=n.node;let a=0;const h=i&Jp.HasMeshoptCompression;for(const d of o.meshes){if(o.lights&&o.lightMeshIndex===a||!d.featureData)continue;d.featureArray=new Ju,d.featureArray.reserve(d.featureData.length);let x=e;for(const w of d.featureData){const T=h?65535&w:w>>16&65535,I=h?w>>16&65535:65535&w,P=(15&I)<8?15&I:0,R=n.evaluatedRMEA[P],F=n.evaluatedColor[P],N=n.emissionHeightBasedParams[P];let H;if(x&&P===2&&o.lights&&(H=new Ju,H.resize(10*o.lights.length)),hI(d.featureArray,T,F,R,N,d.aabb.min[2],d.aabb.max[2],H),H&&x){x=!1;const Z=o.meshes[o.lightMeshIndex];Z.featureArray=H,Z.featureArray._trim()}}d.featureArray._trim(),a++}}function Kb(n,e,i,o){const a=1<<n.z;e.lat=Oe((o/Lt+n.y)/a),e.lng=Ae((i/Lt+n.x)/a)}function fI(n,e,i,o){const a=n.getNodesInfo()[e];if(!a||a.hiddenByReplacement||!a.node.meshes)return;let h=Number.MAX_VALUE;const d=a.node,x=i.tile,w=o.calculatePosMatrix(x.tileID.toUnwrapped(),o.worldSize),T=a.evaluatedScale;let I=0;o.elevation&&d.elevation&&(I=d.elevation*o.elevation.exaggeration()),et(w,w,[(d.anchor?d.anchor[0]:0)*(T[0]-1),(d.anchor?d.anchor[1]:0)*(T[1]-1),I]),pt(w,w,T);const P=i.queryGeometry,R=P.isPointQuery()?P.screenBounds:P.screenGeometry,F=function(H){const Z=ze([],w,H.matrix);ze(Z,o.expandedFarZProjMatrix,Z);for(let ee=0;ee<H.meshes.length;++ee){const oe=H.meshes[ee];if(ee===H.lightMeshIndex)continue;const ae=jb(R,o,Z,oe.aabb);ae!=null&&(h=Math.min(ae,h))}if(H.children)for(const ee of H.children)F(ee)};if(F(d),h===Number.MAX_VALUE)return;const N=new ie(0,0);return Kb(x.tileID.canonical,N,a.node.anchor[0],a.node.anchor[1]),{intersectionZ:h,position:N,feature:a.feature}}qt(O_,"Tiled3dModelBucket",{omit:["layers"]}),qt(Yb,"Tiled3dModelFeature");const pI={circle:class extends Is{constructor(n,e,i,o){super(n,{layout:Vp||(Vp=new ur({"circle-sort-key":new kt(je.layout_circle["circle-sort-key"]),"circle-elevation-reference":new wt(je.layout_circle["circle-elevation-reference"]),visibility:new wt(je.layout_circle.visibility)})),paint:tp||(tp=new ur({"circle-radius":new kt(je.paint_circle["circle-radius"]),"circle-color":new kt(je.paint_circle["circle-color"]),"circle-blur":new kt(je.paint_circle["circle-blur"]),"circle-opacity":new kt(je.paint_circle["circle-opacity"]),"circle-translate":new wt(je.paint_circle["circle-translate"]),"circle-translate-anchor":new wt(je.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new wt(je.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new wt(je.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new kt(je.paint_circle["circle-stroke-width"]),"circle-stroke-color":new kt(je.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new kt(je.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new wt(je.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}createBucket(n){return new Co(n)}queryRadius(n){const e=n;return lf("circle-radius",this,e)+lf("circle-stroke-width",this,e)+Qf(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,o,a,h,d,x){const w=ep(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,n.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return c1(n,o,h,d,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,i){const o=l1(this);return{config:new Zs(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}is3D(n){return!n&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Is{createBucket(n){return new h1(n)}constructor(n,e,i,o){super(n,{layout:d1||(d1=new ur({visibility:new wt(je.layout_heatmap.visibility)})),paint:f1||(f1=new ur({"heatmap-radius":new kt(je.paint_heatmap["heatmap-radius"]),"heatmap-weight":new kt(je.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new wt(je.paint_heatmap["heatmap-intensity"]),"heatmap-color":new pl(je.paint_heatmap["heatmap-color"]),"heatmap-opacity":new wt(je.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Dm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return lf("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,o,a,h,d,x){const w=this.paint.get("heatmap-radius").evaluate(e,i);return c1(n,o,h,d,x,!0,!0,new Rt(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,i){return n==="heatmap"?{config:new Zs(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Is{constructor(n,e,i,o){super(n,{layout:p1||(p1=new ur({visibility:new wt(je.layout_hillshade.visibility)})),paint:m1||(m1=new ur({"hillshade-illumination-direction":new wt(je.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new wt(je.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new wt(je.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new wt(je.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new wt(je.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new wt(je.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new wt(je.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}},fill:class extends Is{constructor(n,e,i,o){super(n,{layout:M1||(M1=new ur({"fill-sort-key":new kt(je.layout_fill["fill-sort-key"]),visibility:new wt(je.layout_fill.visibility),"fill-elevation-reference":new wt(je.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new kt(je.layout_fill["fill-construct-bridge-guard-rail"])})),paint:R1||(R1=new ur({"fill-antialias":new wt(je.paint_fill["fill-antialias"]),"fill-opacity":new kt(je.paint_fill["fill-opacity"]),"fill-color":new kt(je.paint_fill["fill-color"]),"fill-outline-color":new kt(je.paint_fill["fill-outline-color"]),"fill-translate":new wt(je.paint_fill["fill-translate"]),"fill-translate-anchor":new wt(je.paint_fill["fill-translate-anchor"]),"fill-pattern":new kt(je.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new wt(je.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new wt(je.paint_fill["fill-emissive-strength"]),"fill-z-offset":new kt(je.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new kt(je.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new kt(je.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(n,e,i){return{config:new Zs(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new Yy(n)}queryRadius(){return Qf(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,o,a,h){return!n.queryGeometry.isAboveHorizon&&Ao(jp(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,n.pixelToTileUnitsFactor),o)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Is{constructor(n,e,i,o){super(n,{layout:iw||(iw=new ur({visibility:new wt(je["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new wt(je["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:nw||(nw=new ur({"fill-extrusion-opacity":new wt(je["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new kt(je["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new wt(je["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new wt(je["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kt(je["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new wt(je["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new kt(je["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new kt(je["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new wt(je["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new wt(je["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new wt(je["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new wt(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new wt(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new wt(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new wt(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new wt(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new wt(je["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new wt(je["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new kt(je["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new kt(je["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new wt(je["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new wt(je["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new wt(je["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new wt(je["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new kt(je["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new kt(je["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new wt(je["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new l_(n)}queryRadius(){return Qf(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,i,o,a,h,d,x,w){const T=ep(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,n.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,i),P=this.paint.get("fill-extrusion-base").evaluate(e,i),R=[0,0],F=x&&h.elevation,N=h.elevation?h.elevation.exaggeration():1,H=n.tile.getBucket(this);if(F&&H instanceof l_){const q=H.centroidVertexArray,re=w+1;re<q.length&&(R[0]=q.geta_centroid_pos0(re),R[1]=q.geta_centroid_pos1(re))}if(R[0]===0&&R[1]===1)return!1;h.projection.name==="globe"&&(o=tw([o],[new Rt(0,0),new Rt(Lt,Lt)],n.tileID.canonical).map(q=>q.polygon).flat());const Z=F?x:null,[ee,oe]=function(q,re,le,fe,Me,Ce,Re,Ne,Je,gt,ct){return q.projection.name==="globe"?function(mt,xt,tt,ft,Ke,Qe,Ct,At,hi,ii,Ut){const St=[],Mi=[],ti=mt.projection.upVectorScale(Ut,mt.center.lat,mt.worldSize).metersToTile,ni=[0,0,0,1],Ti=[0,0,0,1],Vi=(Ki,Ui,Ji,Rn)=>{Ki[0]=Ui,Ki[1]=Ji,Ki[2]=Rn,Ki[3]=1},Oi=ew();tt>0&&(tt+=Oi),ft+=Oi;for(const Ki of xt){const Ui=[],Ji=[];for(const Rn of Ki){const nr=Rn.x+Ke.x,he=Rn.y+Ke.y,ye=mt.projection.projectTilePoint(nr,he,Ut),rt=mt.projection.upVector(Ut,Rn.x,Rn.y);let Pt=tt,Gt=ft;if(Ct){const Vt=cw(nr,he,tt,ft,Ct,At,hi,ii);Pt+=Vt.base,Gt+=Vt.top}tt!==0?Vi(ni,ye.x+rt[0]*ti*Pt,ye.y+rt[1]*ti*Pt,ye.z+rt[2]*ti*Pt):Vi(ni,ye.x,ye.y,ye.z),Vi(Ti,ye.x+rt[0]*ti*Gt,ye.y+rt[1]*ti*Gt,ye.z+rt[2]*ti*Gt),Xi(ni,ni,Qe),Xi(Ti,Ti,Qe),Ui.push(new sp(ni[0],ni[1],ni[2])),Ji.push(new sp(Ti[0],Ti[1],Ti[2]))}St.push(Ui),Mi.push(Ji)}return[St,Mi]}(q,re,le,fe,Me,Ce,Re,Ne,Je,gt,ct):Re?function(mt,xt,tt,ft,Ke,Qe,Ct,At,hi){const ii=[],Ut=[],St=[0,0,0,1];for(const Mi of mt){const ti=[],ni=[];for(const Ti of Mi){const Vi=Ti.x+ft.x,Oi=Ti.y+ft.y,Ki=cw(Vi,Oi,xt,tt,Qe,Ct,At,hi);St[0]=Vi,St[1]=Oi,St[2]=Ki.base,St[3]=1,vs(St,St,Ke),St[3]=Math.max(St[3],1e-5);const Ui=new sp(St[0]/St[3],St[1]/St[3],St[2]/St[3]);St[0]=Vi,St[1]=Oi,St[2]=Ki.top,St[3]=1,vs(St,St,Ke),St[3]=Math.max(St[3],1e-5);const Ji=new sp(St[0]/St[3],St[1]/St[3],St[2]/St[3]);ti.push(Ui),ni.push(Ji)}ii.push(ti),Ut.push(ni)}return[ii,Ut]}(re,le,fe,Me,Ce,Re,Ne,Je,gt):function(mt,xt,tt,ft,Ke){const Qe=[],Ct=[],At=Ke[8]*xt,hi=Ke[9]*xt,ii=Ke[10]*xt,Ut=Ke[11]*xt,St=Ke[8]*tt,Mi=Ke[9]*tt,ti=Ke[10]*tt,ni=Ke[11]*tt;for(const Ti of mt){const Vi=[],Oi=[];for(const Ki of Ti){const Ui=Ki.x+ft.x,Ji=Ki.y+ft.y,Rn=Ke[0]*Ui+Ke[4]*Ji+Ke[12],nr=Ke[1]*Ui+Ke[5]*Ji+Ke[13],he=Ke[2]*Ui+Ke[6]*Ji+Ke[14],ye=Ke[3]*Ui+Ke[7]*Ji+Ke[15],rt=Rn+At,Pt=nr+hi,Gt=he+ii,Vt=Math.max(ye+Ut,1e-5),Qt=Rn+St,bi=nr+Mi,rn=he+ti,sn=Math.max(ye+ni,1e-5);Vi.push(new sp(rt/Vt,Pt/Vt,Gt/Vt)),Oi.push(new sp(Qt/sn,bi/sn,rn/sn))}Qe.push(Vi),Ct.push(Oi)}return[Qe,Ct]}(re,le,fe,Me,Ce)}(h,o,P,I,T,d,Z,R,N,h.center.lat,n.tileID.canonical),ae=n.queryGeometry;return function(q,re,le){let fe=1/0;Ao(le,re)&&(fe=lw(le,re[0]));for(let Me=0;Me<re.length;Me++){const Ce=re[Me],Re=q[Me];for(let Ne=0;Ne<Ce.length-1;Ne++){const Je=Ce[Ne],gt=[Je,Ce[Ne+1],Re[Ne+1],Re[Ne],Je];uo(le,gt)&&(fe=Math.min(fe,lw(le,gt)))}}return fe!==1/0&&fe}(ee,oe,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},building:class extends Is{constructor(n,e,i,o){super(n,{layout:ww||(ww=new ur({visibility:new wt(je.layout_building.visibility),"building-roof-shape":new kt(je.layout_building["building-roof-shape"]),"building-height":new kt(je.layout_building["building-height"]),"building-base":new kt(je.layout_building["building-base"])})),paint:bw||(bw=new ur({"building-opacity":new wt(je.paint_building["building-opacity"]),"building-ambient-occlusion-wall-intensity":new wt(je.paint_building["building-ambient-occlusion-wall-intensity"]),"building-ambient-occlusion-ground-intensity":new wt(je.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new wt(je.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new wt(je.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new wt(je.paint_building["building-vertical-scale"]),"building-cast-shadows":new wt(je.paint_building["building-cast-shadows"]),"building-color":new kt(je.paint_building["building-color"]),"building-emissive-strength":new kt(je.paint_building["building-emissive-strength"]),"building-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new vw(n)}},line:class extends Is{constructor(n,e,i,o){const a=kw();super(n,a,e,i,o),a.layout&&(this.layout=new ua(a.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Pa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if(qm)return qm;const i=kw();return qm=new hA(i.paint.properties["line-width"].specification),qm.useIntegerZoom=!0,qm})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new c0(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,i){const o=Mw(this);return{config:new Zs(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}queryRadius(n){const e=n,i=Dw(lf("line-width",this,e),lf("line-gap-width",this,e)),o=lf("line-offset",this,e);return i/2+Math.abs(o)+Qf(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,o,a,h){if(n.queryGeometry.isAboveHorizon)return!1;const d=jp(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,n.pixelToTileUnitsFactor),x=n.pixelToTileUnitsFactor/2*Dw(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),w=this.paint.get("line-offset").evaluate(e,i);return w&&(o=function(T,I){const P=[],R=new Rt(0,0);for(let F=0;F<T.length;F++){const N=T[F],H=[];for(let Z=0;Z<N.length;Z++){const ee=N[Z],oe=N[Z+1],ae=Z===0?R:ee.sub(N[Z-1])._unit()._perp(),q=Z===N.length-1?R:oe.sub(ee)._unit()._perp(),re=ae._add(q)._unit();re._mult(1/(re.x*q.x+re.y*q.y)),H.push(re._mult(I)._add(ee))}P.push(H)}return P}(o,w*n.pixelToTileUnitsFactor)),function(T,I,P){for(let R=0;R<I.length;R++){const F=I[R];if(T.length>=3){for(let N=0;N<F.length;N++)if(pa(T,F[N]))return!0}if(Io(T,F,P))return!0}return!1}(d,o,x)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:P_,background:class extends Is{constructor(n,e,i,o){super(n,{layout:Tb||(Tb=new ur({visibility:new wt(je.layout_background.visibility)})),paint:Sb||(Sb=new ur({"background-pitch-alignment":new wt(je.paint_background["background-pitch-alignment"]),"background-color":new wt(je.paint_background["background-color"]),"background-pattern":new wt(je.paint_background["background-pattern"]),"background-opacity":new wt(je.paint_background["background-opacity"]),"background-emissive-strength":new wt(je.paint_background["background-emissive-strength"]),"background-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Pb,"raster-particle":zb,sky:class extends Is{constructor(n,e,i,o){super(n,{layout:kb||(kb=new ur({visibility:new wt(je.layout_sky.visibility)})),paint:Db||(Db=new ur({"sky-type":new wt(je.paint_sky["sky-type"]),"sky-atmosphere-sun":new wt(je.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new wt(je.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new wt(je.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new wt(je.paint_sky["sky-gradient-radius"]),"sky-gradient":new pl(je.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new wt(je.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new wt(je.paint_sky["sky-atmosphere-color"]),"sky-opacity":new wt(je.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Dm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),a=!o,h=n.style.light,d=h.properties.get("position");return a&&h.properties.get("anchor")==="viewport"&&zi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?k0(d.azimuthal,90-d.polar,e):k0(o[0],90-o[1],e)}const i=this.paint.get("sky-gradient-center");return k0(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends Is{constructor(n,e,i,o){super(n,{paint:Lb||(Lb=new ur({}))},e,null)}},model:class extends Is{constructor(n,e,i,o){super(n,{layout:$b||($b=new ur({visibility:new wt(je.layout_model.visibility),"model-id":new kt(je.layout_model["model-id"])})),paint:Hb||(Hb=new ur({"model-opacity":new kt(je.paint_model["model-opacity"]),"model-rotation":new kt(je.paint_model["model-rotation"]),"model-scale":new kt(je.paint_model["model-scale"]),"model-translation":new kt(je.paint_model["model-translation"]),"model-color":new kt(je.paint_model["model-color"]),"model-color-mix-intensity":new kt(je.paint_model["model-color-mix-intensity"]),"model-type":new wt(je.paint_model["model-type"]),"model-cast-shadows":new wt(je.paint_model["model-cast-shadows"]),"model-receive-shadows":new wt(je.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new wt(je.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new kt(je.paint_model["model-emissive-strength"]),"model-roughness":new kt(je.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new kt(je.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new wt(je.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new wt(je.paint_model["model-front-cutoff"]),"model-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new F0(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof O_?Lt-1:0}queryIntersectsFeature(n,e,i,o,a,h){if(!this.modelManager)return!1;const d=this.modelManager,x=n.tile.getBucket(this);if(!(x&&x instanceof F0))return!1;for(const w in x.instancesPerModel){const T=x.instancesPerModel[w],I=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(I)){const P=T.features[T.idToFeaturesIndex[I]],R=d.getModel(w,this.scope);if(!R)return!1;let F=Se();const N=new ie(0,0),H=x.canonical;let Z=Number.MAX_VALUE;for(let ee=0;ee<P.instancedDataCount;++ee){const oe=16*(P.instancedDataOffset+ee),ae=T.instancedDataArray.float32,q=[ae[oe+4],ae[oe+5],ae[oe+6]];Kb(H,N,ae[oe],0|ae[oe+1]),Wb(F,R,h,N,P.rotation,P.scale,q,!1,!1,!1),h.projection.name==="globe"&&(F=L0(F,h));const re=ze([],h.projMatrix,F),le=n.queryGeometry,fe=jb(le.isPointQuery()?le.screenBounds:le.screenGeometry,h,re,R.aabb);fe!=null&&(Z=Math.min(fe,Z))}return Z!==Number.MAX_VALUE&&Z}}return!1}_handleOverridablePaintPropertyUpdate(n,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof ec}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Is{constructor(n,e,i,o){super(n,{layout:k1||(k1=new ur({"clip-layer-types":new wt(je.layout_clip["clip-layer-types"]),"clip-layer-scope":new wt(je.layout_clip["clip-layer-scope"])})),paint:D1||(D1=new ur({}))},e,i,o)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new L1(n)}is3D(n){return!0}}},j0=new mn(0,0,0),V0={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},U0={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},N_={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},mI={PAINT_ORDER_FILL_AND_STROKE:1},og={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},Jb={MASK_TYPE_LUMINANCE:1};function gI(n,e,i){n===1&&e.icons.push(function(o,a){return function(h){if(h.usvg_tree.height||(h.usvg_tree.height=h.usvg_tree.width),!h.metadata)return h;const{metadata:d}=h;if(d.content_area){const{content_area:x}=d;x.top==null&&(x.top=x.left),x.width==null&&(x.width=h.usvg_tree.width),x.height==null&&(x.height=x.width)}return d.stretch_x&&d.stretch_x.length&&Qb(d,"x"),d.stretch_y&&d.stretch_y.length&&Qb(d,"y"),h}(o.readFields(_I,{name:void 0},a))}(i,i.readVarint()+i.pos))}function Qb(n,e){const i=[],o=n[`stretch_${e}`];let a=null;for(let h=0;h<o.length;h++)a===null?a=i.length===0?o[0]:i[i.length-1][1]+o[h]:(i.push([a,a+o[h]]),a=null);n[`stretch_${e}_areas`]=i}function _I(n,e,i){n===1?e.name=i.readString():n===2?e.metadata=function(o,a){return o.readFields(yI,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},a)}(i,i.readVarint()+i.pos):n===3&&(e.usvg_tree=function(o,a){return o.readFields(wI,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},a)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function yI(n,e,i){n===1?e.stretch_x=i.readPackedVarint():n===2?e.stretch_y=i.readPackedVarint():n===3?e.content_area=function(o,a){return o.readFields(xI,{left:0},a)}(i,i.readVarint()+i.pos):n===4&&e.variables.push(function(o,a){return o.readFields(vI,{name:void 0},a)}(i,i.readVarint()+i.pos))}function xI(n,e,i){n===1?e.left=i.readVarint():n===2?e.width=i.readVarint():n===3?e.top=i.readVarint():n===4&&(e.height=i.readVarint())}function vI(n,e,i){n===1?e.name=i.readString():n===2&&(e.rgb_color=V_(i.readVarint()),e.value="rgb_color")}function wI(n,e,i){n===1?e.width=e.height=i.readVarint():n===2?e.height=i.readVarint():n===3?e.children.push(B_(i,i.readVarint()+i.pos)):n===4?e.linear_gradients.push(function(o,a){return o.readFields(II,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},a)}(i,i.readVarint()+i.pos)):n===5?e.radial_gradients.push(function(o,a){return o.readFields(MI,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},a)}(i,i.readVarint()+i.pos)):n===7?e.clip_paths.push(function(o,a){return o.readFields(RI,{children:[]},a)}(i,i.readVarint()+i.pos)):n===8&&e.masks.push(function(o,a){const h=o.readFields(kI,{left:0,width:20,mask_type:Jb.MASK_TYPE_LUMINANCE,children:[]},a);return h.height==null&&(h.height=h.width),h.top==null&&(h.top=h.left),h}(i,i.readVarint()+i.pos))}function B_(n,e){return n.readFields(bI,{},e)}function bI(n,e,i){n===1?(e.group=function(o,a){return o.readFields(TI,{opacity:255,children:[]},a)}(i,i.readVarint()+i.pos),e.node="group"):n===2&&(e.path=function(o,a){return o.readFields(EI,{paint_order:1,commands:[],step:1,diffs:[],rule:V0.PATH_RULE_NON_ZERO},a)}(i,i.readVarint()+i.pos),e.node="path")}function TI(n,e,i){n===1?e.transform=j_(i,i.readVarint()+i.pos):n===2?e.opacity=i.readVarint():n===5?e.clip_path_idx=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(B_(i,i.readVarint()+i.pos))}function j_(n,e){return n.readFields(SI,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function SI(n,e,i){n===1?e.sx=i.readFloat():n===2?e.ky=i.readFloat():n===3?e.kx=i.readFloat():n===4?e.sy=i.readFloat():n===5?e.tx=i.readFloat():n===6&&(e.ty=i.readFloat())}function EI(n,e,i){n===1?e.fill=function(o,a){return o.readFields(CI,{rgb_color:j0,paint:"rgb_color",opacity:255},a)}(i,i.readVarint()+i.pos):n===2?e.stroke=function(o,a){return o.readFields(AI,{rgb_color:j0,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},a)}(i,i.readVarint()+i.pos):n===3?e.paint_order=i.readVarint():n===5?i.readPackedVarint(e.commands):n===6?e.step=i.readFloat():n===7?i.readPackedSVarint(e.diffs):n===8&&(e.rule=i.readVarint())}function CI(n,e,i){n===1?(e.rgb_color=V_(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=i.readVarint())}function V_(n){return new mn((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function AI(n,e,i){n===1?(e.rgb_color=V_(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5?i.readPackedFloat(e.dasharray):n===6?e.dashoffset=i.readFloat():n===7?e.miterlimit=i.readFloat():n===8?e.opacity=i.readVarint():n===9?e.width=i.readFloat():n===10?e.linecap=i.readVarint():n===11&&(e.linejoin=i.readVarint())}function II(n,e,i){n===1?e.transform=j_(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(e2(i,i.readVarint()+i.pos)):n===4?e.x1=i.readFloat():n===5?e.y1=i.readFloat():n===6?e.x2=i.readFloat():n===7&&(e.y2=i.readFloat())}function e2(n,e){return n.readFields(PI,{offset:0,opacity:255,rgb_color:j0},e)}function PI(n,e,i){n===1?e.offset=i.readFloat():n===2?e.opacity=i.readVarint():n===3&&(e.rgb_color=V_(i.readVarint()))}function MI(n,e,i){n===1?e.transform=j_(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(e2(i,i.readVarint()+i.pos)):n===4?e.cx=i.readFloat():n===5?e.cy=i.readFloat():n===6?e.r=i.readFloat():n===7?e.fx=i.readFloat():n===8?e.fy=i.readFloat():n===9&&(e.fr=i.readFloat())}function RI(n,e,i){n===1?e.transform=j_(i,i.readVarint()+i.pos):n===2?e.clip_path_idx=i.readVarint():n===3&&e.children.push(B_(i,i.readVarint()+i.pos))}function kI(n,e,i){n===1?e.left=e.top=i.readFloat():n===2?e.width=e.height=i.readFloat():n===3?e.top=i.readFloat():n===4?e.height=i.readFloat():n===5?e.mask_type=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(B_(i,i.readVarint()+i.pos))}class DI{static calculate(e={},i=[]){const o=new Map,a=new Map;if(Object.keys(e).length===0)return o;i.forEach(h=>{a.set(h.name,h.rgb_color||new mn(0,0,0))});for(const[h,d]of Object.entries(e))a.has(h)?o.set(a.get(h).toString(),d):console.warn(`Ignoring unknown image variable "${h}"`);return o}}function em(n,e=255,i){const o=e/255,a=n.toString(),h=i.has(a)?i.get(a).clone():n.clone();return h.a*=o,h.toString()}function ag(n,e){if(!mu()){const i=document.createElement("canvas");return i.width=n,i.height=e,i}return new OffscreenCanvas(n,e)}function LI(n,e){const i=DI.calculate(e.params,n.metadata?n.metadata.variables:[]),o=n.usvg_tree,a=o.width,h=o.height,d=e.transform?e.transform:new DOMMatrix,x=Math.max(1,Math.round(a*d.a)),w=Math.max(1,Math.round(h*d.d)),T=new DOMMatrix([x/a,0,0,w/h,0,0]),I=ag(x,w).getContext("2d");return G0(I,T,o,o,i),I.getImageData(0,0,x,w)}function G0(n,e,i,o,a){for(const h of o.children)t2(n,e,i,h,a)}function t2(n,e,i,o,a){o.group?(n.save(),function(h,d,x,w,T){const I=w.mask_idx!=null?x.masks[w.mask_idx]:null,P=w.clip_path_idx!=null?x.clip_paths[w.clip_path_idx]:null;if(w.transform&&(d=tm(w.transform).preMultiplySelf(d)),!function(N,H,Z){return N.opacity!==255||H||Z}(w,P!=null,I!=null))return void G0(h,d,x,w,T);const R=ag(h.canvas.width,h.canvas.height),F=R.getContext("2d");G0(F,d,x,w,T),P&&l2(F,d,x,P),I&&c2(F,d,x,I,T),h.globalAlpha=w.opacity/255,h.drawImage(R,0,0)}(n,e,i,o.group,a),n.restore()):o.path&&(n.save(),function(h,d,x,w,T){h.setTransform(d),w.paint_order===mI.PAINT_ORDER_FILL_AND_STROKE?(i2(h,x,w,T),r2(h,x,w,T)):(r2(h,x,w,T),i2(h,x,w,T))}(n,e,i,o.path,a),n.restore())}function i2(n,e,i,o){const a=i.fill;if(!a)return;const h=a.opacity/255;switch(n.save(),n.beginPath(),u2(i,n),a.paint){case"rgb_color":n.fillStyle=em(a.rgb_color,a.opacity,o);break;case"linear_gradient_idx":{const d=e.linear_gradients[a.linear_gradient_idx];d.transform&&n.setTransform(tm(d.transform).preMultiplySelf(n.getTransform())),n.fillStyle=s2(n,d,h,o);break}case"radial_gradient_idx":{const d=e.radial_gradients[a.radial_gradient_idx];d.transform&&n.setTransform(tm(d.transform).preMultiplySelf(n.getTransform())),n.fillStyle=o2(n,d,h,o)}}n.fill(n2(i)),n.restore()}function n2(n){return n.rule===V0.PATH_RULE_NON_ZERO?"nonzero":n.rule===V0.PATH_RULE_EVEN_ODD?"evenodd":void 0}function r2(n,e,i,o){const a=i.stroke;if(!a)return;const h=h2(i);n.lineWidth=a.width,n.miterLimit=a.miterlimit,n.setLineDash(a.dasharray),n.lineDashOffset=a.dashoffset;const d=a.opacity/255;switch(a.paint){case"rgb_color":n.strokeStyle=em(a.rgb_color,a.opacity,o);break;case"linear_gradient_idx":n.strokeStyle=s2(n,e.linear_gradients[a.linear_gradient_idx],d,o,!0);break;case"radial_gradient_idx":n.strokeStyle=o2(n,e.radial_gradients[a.radial_gradient_idx],d,o,!0)}switch(a.linejoin){case N_.LINE_JOIN_MITER_CLIP:case N_.LINE_JOIN_MITER:n.lineJoin="miter";break;case N_.LINE_JOIN_ROUND:n.lineJoin="round";break;case N_.LINE_JOIN_BEVEL:n.lineJoin="bevel"}switch(a.linecap){case U0.LINE_CAP_BUTT:n.lineCap="butt";break;case U0.LINE_CAP_ROUND:n.lineCap="round";break;case U0.LINE_CAP_SQUARE:n.lineCap="square"}n.stroke(h)}function s2(n,e,i,o,a=!1){if(e.stops.length===1){const R=e.stops[0];return em(R.rgb_color,R.opacity*i,o)}const{x1:h,y1:d,x2:x,y2:w}=e;let T=new DOMPoint(h,d),I=new DOMPoint(x,w);if(a){const R=tm(e.transform);T=R.transformPoint(T),I=R.transformPoint(I)}const P=n.createLinearGradient(T.x,T.y,I.x,I.y);for(const R of e.stops)P.addColorStop(R.offset,em(R.rgb_color,R.opacity*i,o));return P}function o2(n,e,i,o,a=!1){if(e.stops.length===1){const ee=e.stops[0];return em(ee.rgb_color,ee.opacity*i,o)}const h=tm(e.transform),{fx:d,fy:x,fr:w,cx:T,cy:I,r:P}=e;let R=new DOMPoint(d,x),F=new DOMPoint(T,I),N=w,H=P;if(a){R=h.transformPoint(R),F=h.transformPoint(F);const ee=(h.a+h.d)/2;N=w*ee,H=e.r*ee}const Z=n.createRadialGradient(R.x,R.y,N,F.x,F.y,H);for(const ee of e.stops)Z.addColorStop(ee.offset,em(ee.rgb_color,ee.opacity*i,o));return Z}function a2(n,e,i,o){const a=o.transform?tm(o.transform).preMultiplySelf(e):e,h=ag(n.canvas.width,n.canvas.height),d=h.getContext("2d");for(const w of o.children)if(w.group)a2(d,a,i,w.group);else if(w.path){const T=w.path,I=new Path2D;I.addPath(h2(T),a),d.fill(I,n2(T))}const x=o.clip_path_idx!=null?i.clip_paths[o.clip_path_idx]:null;x&&l2(d,a,i,x),n.globalCompositeOperation="source-over",n.drawImage(h,0,0)}function l2(n,e,i,o){const a=ag(n.canvas.width,n.canvas.height);a2(a.getContext("2d"),e,i,o),n.globalCompositeOperation="destination-in",n.drawImage(a,0,0)}function c2(n,e,i,o,a){if(o.children.length===0)return;const h=o.mask_idx!=null?i.masks[o.mask_idx]:null;h&&c2(n,e,i,h,a);const d=n.canvas.width,x=n.canvas.height,w=ag(d,x),T=w.getContext("2d"),I=o.width,P=o.height,R=o.left,F=o.top,N=new Path2D,H=new Path2D;H.rect(R,F,I,P),N.addPath(H,e),T.clip(N);for(const oe of o.children)t2(T,e,i,oe,a);const Z=T.getImageData(0,0,d,x),ee=Z.data;if(o.mask_type===Jb.MASK_TYPE_LUMINANCE)for(let oe=0;oe<ee.length;oe+=4)ee[oe+3]=ee[oe+3]/255*(.2126*ee[oe]+.7152*ee[oe+1]+.0722*ee[oe+2]);T.putImageData(Z,0,0),n.globalCompositeOperation="destination-in",n.drawImage(w,0,0)}function tm(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function u2(n,e){const i=n.step;let o=n.diffs[0]*i,a=n.diffs[1]*i;e.moveTo(o,a);for(let h=0,d=2;h<n.commands.length;h++)switch(n.commands[h]){case og.PATH_COMMAND_MOVE:o+=n.diffs[d++]*i,a+=n.diffs[d++]*i,e.moveTo(o,a);break;case og.PATH_COMMAND_LINE:o+=n.diffs[d++]*i,a+=n.diffs[d++]*i,e.lineTo(o,a);break;case og.PATH_COMMAND_QUAD:{const x=o+n.diffs[d++]*i,w=a+n.diffs[d++]*i;o=x+n.diffs[d++]*i,a=w+n.diffs[d++]*i,e.quadraticCurveTo(x,w,o,a);break}case og.PATH_COMMAND_CUBIC:{const x=o+n.diffs[d++]*i,w=a+n.diffs[d++]*i,T=x+n.diffs[d++]*i,I=w+n.diffs[d++]*i;o=T+n.diffs[d++]*i,a=I+n.diffs[d++]*i,e.bezierCurveTo(x,w,T,I,o,a);break}case og.PATH_COMMAND_CLOSE:e.closePath()}return e}function h2(n){return u2(n,new Path2D)}class U_{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}qt(U_,"LRUCache");class $0{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Ks(e,e.data)}getFromCache(e,i,o){return this.cacheMap.has(o)||this.cacheMap.set(o,new U_(150)),this.cacheMap.get(o).get(ja(e.toString(),i))}setInCache(e,i,o,a){this.cacheDependenciesMap.has(a)||this.cacheDependenciesMap.set(a,new Map),this.cacheMap.has(a)||this.cacheMap.set(a,new U_(150));const h=this.cacheDependenciesMap.get(a),d=ja(e.id.toString(),o);h.get(d)||h.set(d,new Set);const x=this.cacheMap.get(a),w=e.toString();h.get(d).add(w),x.put(ja(e.toString(),o),i)}removeImagesFromCacheByIds(e,i,o=0){if(!this.cacheMap.has(o)||!this.cacheDependenciesMap.has(o))return;const a=this.cacheMap.get(o),h=this.cacheDependenciesMap.get(o);for(const d of e){const x=ja(d.toString(),i);if(h.has(x)){for(const w of h.get(x))a.delete(w);h.delete(x)}}}rasterize(e,i,o,a,h=LI){const d=this.getFromCache(e,o,a);if(d)return d.clone();const x=h(i.icon,e.options),w=$0._getImage(x);return this.setInCache(e,w,o,a),w.clone()}}class d2{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function f2(n,e,i,o){let a=0,h=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(o[d])<1e-15){if(i[d]<n[d]||i[d]>e[d])return null}else{const x=1/o[d];let w=(n[d]-i[d])*x,T=(e[d]-i[d])*x;if(w>T){const I=w;w=T,T=I}if(w>a&&(a=w),T<h&&(h=T),a>h)return null}return a}function p2(n,e,i,o,a,h,d,x,w,T,I){const P=o-n,R=a-e,F=h-i,N=d-n,H=x-e,Z=w-i,ee=I[1]*Z-I[2]*H,oe=I[2]*N-I[0]*Z,ae=I[0]*H-I[1]*N,q=P*ee+R*oe+F*ae;if(Math.abs(q)<1e-15)return null;const re=1/q,le=T[0]-n,fe=T[1]-e,Me=T[2]-i,Ce=(le*ee+fe*oe+Me*ae)*re;if(Ce<0||Ce>1)return null;const Re=fe*F-Me*R,Ne=Me*P-le*F,Je=le*R-fe*P,gt=(I[0]*Re+I[1]*Ne+I[2]*Je)*re;return gt<0||Ce+gt>1?null:(N*Re+H*Ne+Z*Je)*re}function m2(n,e,i){return(n-e)/(i-e)}function g2(n,e,i,o,a,h,d,x,w){const T=1<<i,I=h-o,P=d-a,R=(n+1)/T*I+o,F=(e+0)/T*P+a,N=(e+1)/T*P+a;x[0]=(n+0)/T*I+o,x[1]=F,w[0]=R,w[1]=N}class _2{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(h){const d=Math.ceil(Math.log2(h.dim/8)),x=[];let w=Math.ceil(Math.pow(2,d));const T=1/w,I=(F,N,H,Z,ee)=>{const oe=Z?1:0,ae=(F+1)*H-oe,q=N*H,re=(N+1)*H-oe;ee[0]=F*H,ee[1]=q,ee[2]=ae,ee[3]=re};let P=new d2(w);const R=[];for(let F=0;F<w*w;F++){I(F%w,Math.floor(F/w),T,!1,R);const N=pf(R[0],R[1],h),H=pf(R[2],R[1],h),Z=pf(R[2],R[3],h),ee=pf(R[0],R[3],h);P.minimums.push(Math.min(N,H,Z,ee)),P.maximums.push(Math.max(N,H,Z,ee)),P.leaves.push(1)}for(x.push(P),w/=2;w>=1;w/=2){const F=x[x.length-1];P=new d2(w);for(let N=0;N<w*w;N++){I(N%w,Math.floor(N/w),2,!0,R);const H=F.getElevation(R[0],R[1]),Z=F.getElevation(R[2],R[1]),ee=F.getElevation(R[2],R[3]),oe=F.getElevation(R[0],R[3]),ae=F.isLeaf(R[0],R[1]),q=F.isLeaf(R[2],R[1]),re=F.isLeaf(R[2],R[3]),le=F.isLeaf(R[0],R[3]),fe=Math.min(H.min,Z.min,ee.min,oe.min),Me=Math.max(H.max,Z.max,ee.max,oe.max),Ce=ae&&q&&re&&le;P.maximums.push(Me),P.minimums.push(fe),P.leaves.push(Me-fe<=5&&Ce?1:0)}x.push(P)}return x}(this.dem),o=i.length-1,a=i[o];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,a,h,d,x=1){return f2([e,i,-100],[o,a,this.maximums[0]*x],h,d)}raycast(e,i,o,a,h,d,x=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,i,o,a,h,d,x);if(w==null)return null;const T=[],I=[],P=[],R=[],F=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:N,t:H,nodex:Z,nodey:ee,depth:oe}=F.pop();if(this.leaves[N]){g2(Z,ee,oe,e,i,o,a,P,R);const q=1<<oe,re=(Z+0)/q,le=(Z+1)/q,fe=(ee+0)/q,Me=(ee+1)/q,Ce=pf(re,fe,this.dem)*x,Re=pf(le,fe,this.dem)*x,Ne=pf(le,Me,this.dem)*x,Je=pf(re,Me,this.dem)*x,gt=p2(P[0],P[1],Ce,R[0],P[1],Re,R[0],R[1],Ne,h,d),ct=p2(R[0],R[1],Ne,P[0],R[1],Je,P[0],P[1],Ce,h,d),mt=Math.min(gt!==null?gt:Number.MAX_VALUE,ct!==null?ct:Number.MAX_VALUE);if(mt!==Number.MAX_VALUE)return mt;{const xt=Ue([],h,d,H);if(y2(Ce,Re,Je,Ne,m2(xt[0],P[0],R[0]),m2(xt[1],P[1],R[1]))>=xt[2])return H}continue}let ae=0;for(let q=0;q<this._siblingOffset.length;q++){g2((Z<<1)+this._siblingOffset[q][0],(ee<<1)+this._siblingOffset[q][1],oe+1,e,i,o,a,P,R),P[2]=-100,R[2]=this.maximums[this.childOffsets[N]+q]*x;const re=f2(P,R,h,d);if(re!=null){const le=re;T[q]=le;let fe=!1;for(let Me=0;Me<ae&&!fe;Me++)le>=T[I[Me]]&&(I.splice(Me,0,q),fe=!0);fe||(I[ae]=q),ae++}}for(let q=0;q<ae;q++){const re=I[q];F.push({idx:this.childOffsets[N]+re,t:T[re],nodex:(Z<<1)+this._siblingOffset[re][0],nodey:(ee<<1)+this._siblingOffset[re][1],depth:oe+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,a,h){if(e[a].isLeaf(i,o)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);const d=a-1,x=e[d];let w=0,T=0;for(let I=0;I<this._siblingOffset.length;I++){const P=2*i+this._siblingOffset[I][0],R=2*o+this._siblingOffset[I][1],F=x.getElevation(P,R),N=x.isLeaf(P,R),H=this._addNode(F.min,F.max,N);N&&(w|=1<<I),T||(T=H)}for(let I=0;I<this._siblingOffset.length;I++)w&1<<I||this._construct(e,2*i+this._siblingOffset[I][0],2*o+this._siblingOffset[I][1],d,T+I)}}function y2(n,e,i,o,a,h){return gi(gi(n,i,h),gi(e,o,h),a)}function pf(n,e,i){const o=i.dim,a=we(n*o-.5,0,o-1),h=we(e*o-.5,0,o-1),d=Math.floor(a),x=Math.floor(h),w=Math.min(d+1,o-1),T=Math.min(x+1,o-1);return y2(i.get(d,x),i.get(w,x),i.get(d,T),i.get(w,T),a-d,h-x)}const zI={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function FI(n,e,i){return(256*n*256+256*e+i)/10-1e4}function OI(n,e,i){return 256*n+e+i/256-32768}class G_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,a=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void zi(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const h=this.dim=i.height-2,d=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let w=0;w<h;w++)d[this._idx(-1,w)]=d[this._idx(0,w)],d[this._idx(h,w)]=d[this._idx(h-1,w)],d[this._idx(w,-1)]=d[this._idx(w,0)],d[this._idx(w,h)]=d[this._idx(w,h-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(h,-1)]=d[this._idx(h-1,0)],d[this._idx(-1,h)]=d[this._idx(0,h-1)],d[this._idx(h,h)]=d[this._idx(h-1,h-1)]}const x=o==="terrarium"?OI:FI;for(let w=0;w<d.length;++w){const T=4*w;this.floatView[w]=x(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=Ho.now()}_buildQuadTree(){this._tree=new _2(this)}get(e,i,o=!1){o&&(e=we(e,-1,this.dim),i=we(i,-1,this.dim));const a=this._idx(e,i);return this.floatView[a]}set(e,i,o){const a=this._idx(e,i),h=this.floatView[a];return this.floatView[a]=o,o-h}static getUnpackVector(e){return zI[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const o=[0,0,0,0],a=G_.getUnpackVector(i);let h=Math.floor((e+a[3])/a[2]);return o[2]=h%256,h=Math.floor(h/256),o[1]=h%256,h=Math.floor(h/256),o[0]=h,o}getPixels(){return new y1({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=i*this.dim,h=i*this.dim+this.dim,d=o*this.dim,x=o*this.dim+this.dim;switch(i){case-1:a=h-1;break;case 1:h=a+1}switch(o){case-1:d=x-1;break;case 1:x=d+1}const w=-i*this.dim,T=-o*this.dim;for(let I=d;I<x;I++)for(let P=a;P<h;P++){const R=4*this._idx(P,I),F=4*this._idx(P+w,I+T);this.pixels[R+0]=e.pixels[F+0],this.pixels[R+1]=e.pixels[F+1],this.pixels[R+2]=e.pixels[F+2],this.pixels[R+3]=e.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function NI(n,e,i){n===1?e.headerLength=i.readFixed32():n===2?e.x=i.readVarint():n===3?e.y=i.readVarint():n===4?e.z=i.readVarint():n===5&&e.layers.push(function(o,a){return o.readFields(GI,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},a)}(i,i.readVarint()+i.pos))}function BI(n,e,i){n===1?(e.delta_filter=function(o,a){return o.readFields(jI,{blockSize:0},a)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):n===2?(i.readVarint(),e.filter="zigzag_filter"):n===3?(i.readVarint(),e.filter="bitshuffle_filter"):n===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function jI(n,e,i){n===1&&(e.blockSize=i.readVarint())}function VI(n,e,i){n===1?(i.readVarint(),e.codec="gzip_data"):n===2?(i.readVarint(),e.codec="jpeg_image"):n===3?(i.readVarint(),e.codec="webp_image"):n===4&&(i.readVarint(),e.codec="png_image")}function UI(n,e,i){let o=0,a=0;n===1?e.firstByte=i.readFixed64():n===2?e.lastByte=i.readFixed64():n===3?e.filters.push(function(h,d){return h.readFields(BI,{},d)}(i,i.readVarint()+i.pos)):n===4?e.codec=function(h,d){return h.readFields(VI,{},d)}(i,i.readVarint()+i.pos):n===5?a=i.readFloat():n===6?o=i.readFloat():n===7?e.bands.push(i.readString()):n===8?e.offset=i.readDouble():n===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=a),e.scale===0&&(e.scale=o)}function GI(n,e,i){n===1?e.version=i.readVarint():n===2?e.name=i.readString():n===3?e.units=i.readString():n===4?e.tileSize=i.readVarint():n===5?e.buffer=i.readVarint():n===6?e.pixelFormat=i.readVarint():n===7&&e.dataIndex.push(function(o,a){return o.readFields(UI,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},a)}(i,i.readVarint()+i.pos))}function $I(n,e,i){if(n===2)(function(o,a,h){o.readFields(HI,h,a)})(i,i.readVarint()+i.pos,e);else if(n===3)throw new Error("Not implemented")}function HI(n,e,i){if(n===1){let o=0;const a=i.readVarint()+i.pos;for(;i.pos<a;)e[o++]=i.readVarint()}}function WI(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){const a=o===1?1:0,h=o===2?1:0;for(let d=0;d<e[0];d++){const x=e[1]*d;for(let w=a;w<e[1];w++){const T=e[2]*(w+x);for(let I=h;I<e[2];I++){const P=e[3]*(I+T);for(let R=0;R<e[3];R++){const F=P+R;n[F]+=n[F-i]}}}}i*=e[o]}return n}function qI(n){for(let e=0,i=n.length;e<i;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function ZI(n,e){switch(e){case"uint32":return n;case"uint16":for(let i=0;i<n.length;i+=2){const o=n[i],a=n[i+1];n[i]=(240&o)>>4|(61440&o)>>8|(240&a)<<4|61440&a,n[i+1]=15&o|(3840&o)>>4|(15&a)<<8|(3840&a)<<4}return n;case"uint8":for(let i=0;i<n.length;i+=4){const o=n[i],a=n[i+1],h=n[i+2],d=n[i+3];n[i+0]=(192&o)>>6|(192&a)>>4|(192&h)>>2|192&d,n[i+1]=(48&o)>>4|(48&a)>>2|48&h|(48&d)<<2,n[i+2]=(12&o)>>2|12&a|(12&h)<<2|(12&d)<<4,n[i+3]=3&o|(3&a)<<2|(3&h)<<4|(3&d)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}qt(G_,"DEMData"),qt(_2,"DemMinMaxQuadTree",{omit:["dem"]});var Tl=Uint8Array,lg=Uint16Array,XI=Int32Array,x2=new Tl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),v2=new Tl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),YI=new Tl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),w2=function(n,e){for(var i=new lg(31),o=0;o<31;++o)i[o]=e+=1<<n[o-1];var a=new XI(i[30]);for(o=1;o<30;++o)for(var h=i[o];h<i[o+1];++h)a[h]=h-i[o]<<5|o;return{b:i,r:a}},b2=w2(x2,2),T2=b2.b,KI=b2.r;T2[28]=258,KI[258]=28;for(var JI=w2(v2,0).b,S2=new lg(32768),Kr=0;Kr<32768;++Kr){var im=(43690&Kr)>>1|(21845&Kr)<<1;S2[Kr]=((65280&(im=(61680&(im=(52428&im)>>2|(13107&im)<<2))>>4|(3855&im)<<4))>>8|(255&im)<<8)>>1}var cg=function(n,e,i){for(var o=n.length,a=0,h=new lg(e);a<o;++a)n[a]&&++h[n[a]-1];var d,x=new lg(e);for(a=1;a<e;++a)x[a]=x[a-1]+h[a-1]<<1;d=new lg(1<<e);var w=15-e;for(a=0;a<o;++a)if(n[a])for(var T=a<<4|n[a],I=e-n[a],P=x[n[a]-1]++<<I,R=P|(1<<I)-1;P<=R;++P)d[S2[P]>>w]=T;return d},ug=new Tl(288);for(Kr=0;Kr<144;++Kr)ug[Kr]=8;for(Kr=144;Kr<256;++Kr)ug[Kr]=9;for(Kr=256;Kr<280;++Kr)ug[Kr]=7;for(Kr=280;Kr<288;++Kr)ug[Kr]=8;var E2=new Tl(32);for(Kr=0;Kr<32;++Kr)E2[Kr]=5;var QI=cg(ug,9),eP=cg(E2,5),H0=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},lu=function(n,e,i){var o=e/8|0;return(n[o]|n[o+1]<<8)>>(7&e)&i},W0=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(7&e)},tP=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],cu=function(n,e,i){var o=new Error(e||tP[n]);if(o.code=n,Error.captureStackTrace&&Error.captureStackTrace(o,cu),!i)throw o;return o},iP=new Tl(0),nP=typeof TextDecoder<"u"&&new TextDecoder;try{nP.decode(iP,{stream:!0})}catch{}const rP={gzip_data:"gzip"};class hc extends Error{constructor(e){super(e),this.name="MRTError"}}const sP={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},C2={uint32:1,uint16:2,uint8:4},oP={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let q0;class $_{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new hc(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new hc("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new hc(`Expected header with length >= ${o} but got buffer of length ${i.length}`);const a=function(h,d){return h.readFields(NI,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new q0(i.subarray(0,o)));if(!isNaN(this.x)&&(this.x!==a.x||this.y!==a.y||this.z!==a.z))throw new hc(`Invalid attempt to parse header ${a.z}/${a.x}/${a.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=a.x,this.y=a.y,this.z=a.z;for(const h of a.layers)this.layers[h.name]=new A2(h,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],o=this.getLayer(e.layerName);for(let a of e.blockIndices){const h=o.dataIndex[a],d=h.firstByte-e.firstByte,x=h.lastByte-e.firstByte;if(o._blocksInProgress.has(a))continue;const w={layerName:o.name,firstByte:d,lastByte:x,pixelFormat:o.pixelFormat,blockIndex:a,blockShape:[h.bands.length].concat(o.bandShape),buffer:o.buffer,codec:h.codec.codec,filters:h.filters.map(T=>T.filter)};o._blocksInProgress.add(a),i.push(w)}return new I2(i,()=>{i.forEach(a=>o._blocksInProgress.delete(a.blockIndex))},(a,h)=>{if(i.forEach(d=>o._blocksInProgress.delete(d.blockIndex)),a)throw a;h.forEach(d=>{this.getLayer(d.layerName).processDecodedData(d)})})}}class A2{constructor({version:e,name:i,units:o,tileSize:a,pixelFormat:h,buffer:d,dataIndex:x},w){if(this.version=e,this.version!==1)throw new hc(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=a,this.buffer=d,this.pixelFormat=sP[h],this.dataIndex=x,this.bandShape=[a+2*d,a+2*d,C2[this.pixelFormat]],this._decodedBlocks=new U_(w?w.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return C2[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[o,a]of this.dataIndex.entries()){for(const[h,d]of a.bands.entries())if(d===e)return{bandIndex:i+h,blockIndex:o,blockBandIndex:h};i+=a.bands.length}break;case"number":for(const[o,a]of this.dataIndex.entries()){if(e>=i&&e<i+a.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=a.bands.length}break;default:throw new hc(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,o=-1/0;const a=[],h=new Set;for(const d of e){const{blockIndex:x}=this.getBlockForBand(d);if(x<0)throw new hc(`Invalid band: ${JSON.stringify(d)}`);const w=this.dataIndex[x];a.includes(x)||a.push(x),h.add(x),i=Math.min(i,w.firstByte),o=Math.max(o,w.lastByte)}if(h.size>this.cacheSize)throw new hc(`Number of blocks to decode (${h.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:o,blockIndices:a}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e);if(i<0)throw new hc(`Band not found: ${JSON.stringify(e)}`);const a=this._decodedBlocks.get(i.toString());if(!a)throw new hc(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const h=this.dataIndex[i],d=this.bandShape.reduce((T,I)=>T*I,1),x=o*d,w=a.subarray(x,x+d);return{data:w,bytes:new Uint8Array(w.buffer).subarray(w.byteOffset,w.byteOffset+w.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:h.offset,scale:h.scale}}}$_.setPbf=function(n){q0=n};class I2{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}function hp(n,e){const i=n.json.bufferViews[e.bufferView],o=h_[e.componentType];return new o(n.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Wm[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:Wm[e.type]))}function Z0(n,e,i,o){const a=h_[e.componentType],h=function(I){switch(I){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(a),d=n.json.bufferViews[e.bufferView],x=d.byteStride?d.byteStride/a.BYTES_PER_ELEMENT:Wm[e.type],w=i.float32,T=w.length/i.capacity;for(let I=0,P=0;I<e.count*x;I+=x,P+=T)for(let R=0;R<T;R++)w[P+R]=o[I+R]*h;i._trim()}function aP(n,e,i){const o=n.indices,a=n.attributes,h={};h.indexArray=new Yr;const d=e.json.accessors[o],x=d.count/3;h.indexArray.reserve(x);const w=hp(e,d);for(let R=0;R<x;R++)h.indexArray.emplaceBack(w[3*R],w[3*R+1],w[3*R+2]);h.indexArray._trim(),h.vertexArray=new ha;const T=e.json.accessors[a.POSITION];h.vertexArray.reserve(T.count);const I=hp(e,T);for(let R=0;R<T.count;R++)h.vertexArray.emplaceBack(I[3*R],I[3*R+1],I[3*R+2]);if(h.vertexArray._trim(),h.aabb=new vn(T.min,T.max),h.centroid=function(R,F){const N=[0,0,0],H=R.length;if(H>0){for(let Z=0;Z<H;Z++){const ee=3*R[Z];N[0]+=F[ee],N[1]+=F[ee+1],N[2]+=F[ee+2]}N[0]/=H,N[1]/=H,N[2]/=H}return N}(w,I),a.COLOR_0!==void 0){const R=e.json.accessors[a.COLOR_0],F=Wm[R.type],N=hp(e,R);h.colorArray=F===3?new ha:new Xr,h.colorArray.resize(R.count),Z0(e,R,h.colorArray,N)}if(a.NORMAL!==void 0){h.normalArray=new ha;const R=e.json.accessors[a.NORMAL];h.normalArray.resize(R.count);const F=hp(e,R);Z0(e,R,h.normalArray,F)}if(a.TEXCOORD_0!==void 0&&i.length>0){h.texcoordArray=new Kc;const R=e.json.accessors[a.TEXCOORD_0];h.texcoordArray.resize(R.count);const F=hp(e,R);Z0(e,R,h.texcoordArray,F)}if(a._FEATURE_ID_RGBA4444!==void 0){const R=e.json.accessors[a._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=hp(e,R))}a._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(hp(e,e.json.accessors[a._FEATURE_RGBA4444]).buffer));const P=n.material;return h.material=function(R,F){const{emissiveFactor:N=[0,0,0],alphaMode:H="OPAQUE",alphaCutoff:Z=.5,normalTexture:ee,occlusionTexture:oe,emissiveTexture:ae,doubleSided:q}=R,{baseColorFactor:re=[1,1,1,1],metallicFactor:le=1,roughnessFactor:fe=1,baseColorTexture:Me,metallicRoughnessTexture:Ce}=R.pbrMetallicRoughness||{},Re=oe?F[oe.index]:void 0;if(oe&&oe.extensions&&oe.extensions.KHR_texture_transform&&Re){const Ne=oe.extensions.KHR_texture_transform;Re.offsetScale=[Ne.offset[0],Ne.offset[1],Ne.scale[0],Ne.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new mn(...re),metallicFactor:le,roughnessFactor:fe,baseColorTexture:Me?F[Me.index]:void 0,metallicRoughnessTexture:Ce?F[Ce.index]:void 0},doubleSided:q,emissiveFactor:new mn(...N),alphaMode:H,alphaCutoff:Z,normalTexture:ee?F[ee.index]:void 0,occlusionTexture:Re,emissionTexture:ae?F[ae.index]:void 0,defined:R.defined===void 0}}(P!==void 0?e.json.materials[P]:{defined:!1},i),h}function P2(n,e,i){const{matrix:o,rotation:a,translation:h,scale:d,mesh:x,extras:w,children:T}=n,I={};if(I.matrix=o||function(P,R,F,N){var H=R[0],Z=R[1],ee=R[2],oe=R[3],ae=H+H,q=Z+Z,re=ee+ee,le=H*ae,fe=H*q,Me=H*re,Ce=Z*q,Re=Z*re,Ne=ee*re,Je=oe*ae,gt=oe*q,ct=oe*re,mt=N[0],xt=N[1],tt=N[2];return P[0]=(1-(Ce+Ne))*mt,P[1]=(fe+ct)*mt,P[2]=(Me-gt)*mt,P[3]=0,P[4]=(fe-ct)*xt,P[5]=(1-(le+Ne))*xt,P[6]=(Re+Je)*xt,P[7]=0,P[8]=(Me+gt)*tt,P[9]=(Re-Je)*tt,P[10]=(1-(le+Ce))*tt,P[11]=0,P[12]=F[0],P[13]=F[1],P[14]=F[2],P[15]=1,P}([],a||[0,0,0,1],h||[0,0,0],d||[1,1,1]),x!==void 0){I.meshes=i[x];const P=I.anchor=[0,0];for(const R of I.meshes){const{min:F,max:N}=R.aabb;P[0]+=F[0]+N[0],P[1]+=F[1]+N[1]}P[0]=Math.floor(P[0]/I.meshes.length/2),P[1]=Math.floor(P[1]/I.meshes.length/2)}if(w&&(w.id&&(I.id=w.id),w.lights&&(I.lights=function(P){if(!P.length)return[];const R=function(ee){const oe=atob(ee),ae=new Uint8Array(oe.length);for(let q=0;q<oe.length;q++)ae[q]=oe.codePointAt(q);return ae}(P),F=[],N=R.length/24,H=new Uint16Array(R.buffer),Z=new Float32Array(R.buffer);for(let ee=0;ee<N;ee++){const oe=H[2*ee*6]/30,ae=H[2*ee*6+1]/30,q=H[2*ee*6+10]/100,re=Z[6*ee+1],le=Z[6*ee+2],fe=Z[6*ee+3],Me=Z[6*ee+4],Ce=fe-re,Re=Me-le,Ne=Math.hypot(Ce,Re);F.push({pos:[re+.5*Ce,le+.5*Re,ae],normal:[Re/Ne,-Ce/Ne,0],width:Ne,height:oe,depth:q,points:[re,le,fe,Me]})}return F}(w.lights))),T){const P=[];for(const R of T)P.push(P2(e.json.nodes[R],e,i));I.children=P}return I}function lP(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new Ky(n.vertices,n.indices,8,256),[i,o]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:i,max:o}}function cP(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const o=[];for(const d of i){if(!Array.isArray(d)||d.length!==2)continue;const x=d[0],w=d[1];typeof x=="number"&&typeof w=="number"&&o.push(new Rt(x,w))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let a=0;for(let d=0;d<o.length;d++){const x=o[d],w=o[(d+1)%o.length],T=o[(d+2)%o.length];a+=(x.x-w.x)*(T.y-w.y)-(T.x-w.x)*(x.y-w.y)}a>0&&o.reverse();const h=Lm(o.flatMap(d=>[d.x,d.y]),[]);return h.length===0?null:{vertices:o,indices:h}}function uP(n,e){const i=[],o=[];let a=0;const h=[];for(const d of n){a=i.length;const x=d.vertexArray.float32,w=d.indexArray.uint16;for(let T=0;T<d.vertexArray.length;T++)h[0]=x[3*T+0],h[1]=x[3*T+1],h[2]=x[3*T+2],Xi(h,h,e),i.push(new Rt(h[0],h[1]));for(let T=0;T<3*d.indexArray.length;T++)o.push(w[T]+a)}if(o.length%3!=0)return null;for(let d=0;d<o.length;d+=3){const x=i[o[d+0]],w=i[o[d+1]],T=i[o[d+2]];(x.x-w.x)*(T.y-w.y)-(T.x-w.x)*(x.y-w.y)>0&&([o[d+1],o[d+2]]=[o[d+2],o[d+1]])}return{vertices:i,indices:o}}function M2(n){const e=function(w,T){const I=[],P=WebGL2RenderingContext;if(w.json.textures)for(const R of w.json.textures){const F={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};R.sampler!==void 0&&Object.assign(F,w.json.samplers[R.sampler]),I.push({image:T[R.source],sampler:F,uploaded:!1})}return I}(n,n.images),i=function(w,T){const I=[];for(const P of w.json.meshes){const R=[];for(const F of P.primitives)R.push(aP(F,w,T));I.push(R)}return I}(n,e),{scenes:o,scene:a,nodes:h}=n.json,d=o?o[a||0].nodes:h,x=[];for(const w of d)x.push(P2(h[w],n,i));return function(w,T,I){const P={},R=new Set;for(let F=0;F<w.length;F++){const N=I[T[F]];if(!N.extras)continue;const H=N.extras["mapbox:footprint:version"],Z=N.extras["mapbox:footprint:id"];(H||Z)&&R.add(F),H==="1.0.0"&&Z&&(P[Z]=F)}for(let F=0;F<w.length;F++){if(R.has(F))continue;const N=w[F],H=I[T[F]];if(!H.extras)continue;let Z=null;N.id in P&&(Z=uP(w[P[N.id]].meshes,N.matrix)),Z||(Z=cP(H)),Z&&(N.footprint=lP(Z))}if(R.size>0){const F=Array.from(R.values()).sort((N,H)=>N-H);for(let N=F.length-1;N>=0;N--)w.splice(F[N],1)}}(x,d,n.json.nodes),x}function hP(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,i=n.aabb.min[0]-1,o=n.aabb.min[1]-1,a=cp/(n.aabb.max[0]-i+2),h=cp/(n.aabb.max[1]-o+2);for(let d=0;d<e.length;d+=3){const x=e[d+2],w=(e[d+0]-i)*a|0,T=(e[d+1]-o)*h|0;x>n.heightmap[T*cp+w]&&(n.heightmap[T*cp+w]=x)}}function dP(n,e){const i={};i.indexArray=new Yr,i.indexArray.reserve(4*n.length),i.vertexArray=new ha,i.vertexArray.reserve(10*n.length),i.colorArray=new Xr,i.vertexArray.reserve(10*n.length);let o=0;for(const d of n){const x=Math.min(10,Math.max(4,1.3*d.height))*e,w=[-d.normal[1],d.normal[0],0],T=Math.min(.29,.1*d.width/d.depth),I=d.width-2*d.depth*e*(T+.01),P=Ue([],d.pos,w,I/2),R=Ue([],d.pos,w,-I/2),F=[P[0],P[1],P[2]+d.height],N=[R[0],R[1],R[2]+d.height],H=Ue([],d.normal,w,T);Kt(H,H,x);const Z=Ue([],d.normal,w,-T);Kt(Z,Z,x),Ci(H,P,H),Ci(Z,R,Z),P[2]+=.1,R[2]+=.1,i.vertexArray.emplaceBack(H[0],H[1],H[2]),i.vertexArray.emplaceBack(Z[0],Z[1],Z[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack(N[0],N[1],N[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(H[0],H[1],H[2]),i.vertexArray.emplaceBack(Z[0],Z[1],Z[2]);const ee=I/x/2;i.colorArray.emplaceBack(-ee-T,-1,ee,.8),i.colorArray.emplaceBack(ee+T,-1,ee,.8),i.colorArray.emplaceBack(-ee,0,ee,1.3),i.colorArray.emplaceBack(ee,0,ee,1.3),i.colorArray.emplaceBack(ee+T,-.8,ee,.7),i.colorArray.emplaceBack(ee+T,-.8,ee,.7),i.colorArray.emplaceBack(0,0,ee,1.3),i.colorArray.emplaceBack(0,0,ee,1.3),i.colorArray.emplaceBack(ee+T,-1.2,ee,.8),i.colorArray.emplaceBack(ee+T,-1.2,ee,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}const a={defined:!0};a.emissiveFactor=mn.black;const h={};return h.baseColorFactor=mn.white,a.pbrMetallicRoughness=h,i.material=a,i.aabb=new vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}$_.performDecoding=function(n,e){const i=new Uint8Array(n);return Promise.all(e.tasks.map(o=>{const{layerName:a,firstByte:h,lastByte:d,pixelFormat:x,blockShape:w,blockIndex:T,filters:I,codec:P}=o,R=i.subarray(h,d+1),F=new Uint32Array(w[0]*w[1]*w[2]);let N;if(P!=="gzip_data")throw new hc(`Unhandled codec: ${P}`);return N=function(H,Z){if(!globalThis.DecompressionStream&&Z==="gzip_data")return Promise.resolve(((q=function(fe){fe[0]==31&&fe[1]==139&&fe[2]==8||cu(6,"invalid gzip data");var Me=fe[3],Ce=10;4&Me&&(Ce+=2+(fe[10]|fe[11]<<8));for(var Re=(Me>>3&1)+(Me>>4&1);Re>0;Re-=!fe[Ce++]);return Ce+(2&Me)}(ae=H))+8>ae.length&&cu(6,"invalid gzip data"),function(fe,Me,Ce,Re){var Ne=fe.length;if(!Ne||Me.f&&!Me.l)return Ce||new Tl(0);var Je=!Ce,gt=Je||Me.i!=2,ct=Me.i;Je&&(Ce=new Tl(3*Ne));var mt,xt,tt=function(Ar){var or=Ce.length;if(Ar>or){var Qn=new Tl(Math.max(2*or,Ar));Qn.set(Ce),Ce=Qn}},ft=Me.f||0,Ke=Me.p||0,Qe=Me.b||0,Ct=Me.l,At=Me.d,hi=Me.m,ii=Me.n,Ut=8*Ne;do{if(!Ct){ft=lu(fe,Ke,1);var St=lu(fe,Ke+1,3);if(Ke+=3,!St){var Mi=fe[(he=4+((Ke+7)/8|0))-4]|fe[he-3]<<8,ti=he+Mi;if(ti>Ne){ct&&cu(0);break}gt&&tt(Qe+Mi),Ce.set(fe.subarray(he,ti),Qe),Me.b=Qe+=Mi,Me.p=Ke=8*ti,Me.f=ft;continue}if(St==1)Ct=QI,At=eP,hi=9,ii=5;else if(St==2){var ni=lu(fe,Ke,31)+257,Ti=lu(fe,Ke+10,15)+4,Vi=ni+lu(fe,Ke+5,31)+1;Ke+=14;for(var Oi=new Tl(Vi),Ki=new Tl(19),Ui=0;Ui<Ti;++Ui)Ki[YI[Ui]]=lu(fe,Ke+3*Ui,7);Ke+=3*Ti;var Ji=H0(Ki),Rn=(1<<Ji)-1,nr=cg(Ki,Ji);for(Ui=0;Ui<Vi;){var he,ye=nr[lu(fe,Ke,Rn)];if(Ke+=15&ye,(he=ye>>4)<16)Oi[Ui++]=he;else{var rt=0,Pt=0;for(he==16?(Pt=3+lu(fe,Ke,3),Ke+=2,rt=Oi[Ui-1]):he==17?(Pt=3+lu(fe,Ke,7),Ke+=3):he==18&&(Pt=11+lu(fe,Ke,127),Ke+=7);Pt--;)Oi[Ui++]=rt}}var Gt=Oi.subarray(0,ni),Vt=Oi.subarray(ni);hi=H0(Gt),ii=H0(Vt),Ct=cg(Gt,hi),At=cg(Vt,ii)}else cu(1);if(Ke>Ut){ct&&cu(0);break}}gt&&tt(Qe+131072);for(var Qt=(1<<hi)-1,bi=(1<<ii)-1,rn=Ke;;rn=Ke){var sn=(rt=Ct[W0(fe,Ke)&Qt])>>4;if((Ke+=15&rt)>Ut){ct&&cu(0);break}if(rt||cu(2),sn<256)Ce[Qe++]=sn;else{if(sn==256){rn=Ke,Ct=null;break}var Gi=sn-254;sn>264&&(Gi=lu(fe,Ke,(1<<(on=x2[Ui=sn-257]))-1)+T2[Ui],Ke+=on);var Fn=At[W0(fe,Ke)&bi],Jn=Fn>>4;if(Fn||cu(3),Ke+=15&Fn,Vt=JI[Jn],Jn>3){var on=v2[Jn];Vt+=W0(fe,Ke)&(1<<on)-1,Ke+=on}if(Ke>Ut){ct&&cu(0);break}gt&&tt(Qe+131072);var wr=Qe+Gi;if(Qe<Vt){var rr=0-Vt,kn=Math.min(Vt,wr);for(rr+Qe<0&&cu(3);Qe<kn;++Qe)Ce[Qe]=(void 0)[rr+Qe]}for(;Qe<wr;++Qe)Ce[Qe]=Ce[Qe-Vt]}}Me.l=Ct,Me.p=rn,Me.b=Qe,Me.f=ft,Ct&&(ft=1,Me.m=hi,Me.d=At,Me.n=ii)}while(!ft);return Qe!=Ce.length&&Je?(mt=Ce,((xt=Qe)==null||xt>mt.length)&&(xt=mt.length),new Tl(mt.subarray(0,xt))):Ce.subarray(0,Qe)}(ae.subarray(q,-8),{i:2},new Tl(((ee=ae)[(oe=ee.length)-4]|ee[oe-3]<<8|ee[oe-2]<<16|ee[oe-1]<<24)>>>0))));var ee,oe,ae,q;const re=rP[Z];if(!re)throw new Error(`Unhandled codec: ${Z}`);const le=new globalThis.DecompressionStream(re);return new Response(new Blob([H]).stream().pipeThrough(le)).arrayBuffer().then(fe=>new Uint8Array(fe))}(R,P).then(H=>(function(Z,ee){Z.readFields($I,ee)}(new q0(H),F),new oP[x](F.buffer))),N.then(H=>{for(let Z=I.length-1;Z>=0;Z--)switch(I[Z]){case"delta_filter":WI(H,w);break;case"zigzag_filter":qI(H);break;case"bitshuffle_filter":ZI(H,x);break;default:throw new hc(`Unhandled filter "${I[Z]}"`)}return{layerName:a,blockIndex:T,data:H}}).catch(H=>{throw H})}))},qt(I2,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),qt($_,"MapboxRasterTile"),qt(A2,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class R2{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const fP=["id","tile","layer","source","sourceLayer","state"];class nm{constructor(e,i,o,a,h){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=a,this.properties=e.properties,this.id=h}clone(){const e=new nm(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of fP)this[i]!==void 0&&(e[i]=this[i]);return e}}class k2{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new es(Lt,16,0),this.featureIndexArray=new rf,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,o,a,h,d=0,x=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,a,h,d);const T=this.grid;for(let I=0;I<i.length;I++){const P=i[I],R=[1/0,1/0,-1/0,-1/0];for(let F=0;F<P.length;F++){const N=P[F];R[0]=Math.min(R[0],N.x),R[1]=Math.min(R[1],N.y),R[2]=Math.max(R[2],N.x),R[3]=Math.max(R[3],N.y)}x!==0&&(R[0]-=x,R[1]-=x,R[2]+=x,R[3]+=x),R[0]<Lt&&R[1]<Lt&&R[2]>=0&&R[3]>=0&&T.insert(w,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Bi.VectorTile(new f_(this.rawTileData)).layers,this.sourceLayerCoder=new R2(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:o,transform:a,tileTransform:h,pixelPosMatrix:d,availableImages:x,worldview:w}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const T=o.bufferedTilespaceBounds,I=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(N,H,Z,ee)=>wl(o.bufferedTilespaceGeometry,N,H,Z,ee));I.sort(pP);let P=null;a.elevation&&I.length>0&&(P=Qp.create(a.elevation,this.tileID));const R={};let F;for(let N=0;N<I.length;N++){const H=I[N];if(H===F)continue;F=H;const Z=this.featureIndexArray.get(H);let ee=null;this.is3DTile?this.loadMatchingModelFeature(R,Z,e,o,a,w):this.loadMatchingFeature(R,Z,e,x,w,(oe,ae,q,re=0)=>(ee||(ee=Wt(oe,this.tileID.canonical,h)),ae.queryIntersectsFeature(o,oe,q,ee,this.z,a,d,P,re)))}return R}loadMatchingFeature(e,i,o,a,h,d){const{featureIndex:x,bucketIndex:w,sourceLayerIndex:T,layoutVertexArrayOffset:I}=i,P=this.bucketLayerIDs[w],R=o.layers,F=Object.keys(R);if(F.length&&!Pi(F,P))return;const N=o.sourceCache,H=this.sourceLayerCoder.decode(T),Z=this.vtLayers[H].feature(x),ee=this.getId(Z,H);for(let oe=0;oe<P.length;oe++){const ae=P[oe];if(!R[ae])continue;const{styleLayer:q,targets:re}=R[ae];let le={};ee!==void 0&&(le=N.getFeatureState(q.sourceLayer,ee));const fe=!d||d(Z,q,le,I);if(!fe)continue;const Me=new nm(Z,this.z,this.x,this.y,ee);Me.tile=this.tileID.canonical,Me.state=le;let Ce=this.serializedLayersCache.get(ae);Ce||(Ce=q.serialize(),Ce.id=ae,this.serializedLayersCache.set(ae,Ce)),Me.source=Ce.source,Me.sourceLayer=Ce["source-layer"],Me.layer=He({},Ce),Me.layer.paint=D2(Ce.paint,q.paint,Z,le,a),Me.layer.layout=D2(Ce.layout,q.layout,Z,le,a);let Re=!1;for(const Ne of re){this.updateFeatureProperties(Me,Ne);const{filter:Je}=Ne;if(Je){if(Z.properties=Me.properties,Je.needGeometry){const gt=Ot(Z,!0);if(!Je.filter(new Pn(this.tileID.overscaledZ,{worldview:h}),gt,this.tileID.canonical))continue}else if(!Je.filter(new Pn(this.tileID.overscaledZ,{worldview:h}),Z))continue}Re=!0,Ne.targetId&&this.addFeatureVariant(Me,Ne)}Re&&this.appendToResult(e,ae,x,Me,fe)}}loadMatchingModelFeature(e,i,o,a,h,d){const{featureIndex:x,bucketIndex:w}=i,T=this.bucketLayerIDs[w],I=o.layers,P=Object.keys(I);if(!P.length||Pi(P,T))for(let R=0;R<T.length;R++){const F=T[R],{styleLayer:N,targets:H}=I[F];if(N.type!=="model")continue;const Z=a.tile,ee=Z.getBucket(N);if(!(ee&&ee instanceof O_))continue;const oe=fI(ee,x,a,h);if(!oe)continue;const{z:ae,x:q,y:re}=Z.tileID.canonical,{feature:le,intersectionZ:fe,position:Me}=oe;let Ce={};le.id!==void 0&&(Ce=o.sourceCache.getFeatureState(N.sourceLayer,le.id));const Re=new nm({},ae,q,re,le.id);Re.tile=this.tileID.canonical,Re.state=Ce,Re.properties=le.properties,Re.geometry={type:"Point",coordinates:[Me.lng,Me.lat]};let Ne=this.serializedLayersCache.get(F);Ne||(Ne=N.serialize(),Ne.id=F,this.serializedLayersCache.set(F,Ne)),Re.source=Ne.source,Re.sourceLayer=Ne["source-layer"],Re.layer=He({},Ne);let Je=!1;for(const gt of H){this.updateFeatureProperties(Re,gt);const{filter:ct}=gt;if(ct){if(le.properties=Re.properties,ct.needGeometry){if(!ct.filter(new Pn(this.tileID.overscaledZ,{worldview:d}),le,this.tileID.canonical))continue}else if(!ct.filter(new Pn(this.tileID.overscaledZ,{worldview:d}),le))continue}Je=!0,gt.targetId&&this.addFeatureVariant(Re,gt)}Je&&this.appendToResult(e,F,x,Re,fe)}}updateFeatureProperties(e,i,o){if(i.properties){const a={};for(const h in i.properties){const d=i.properties[h].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,o);d!=null&&(a[h]=d)}e.properties=a}}addFeatureVariant(e,i,o){const a={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(a.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(a)}appendToResult(e,i,o,a,h){let d=e[i];d===void 0&&(d=e[i]=[]),d.push({featureIndex:o,feature:a,intersectionZ:h})}lookupSymbolFeatures(e,i,o,a,h,d){const x={};this.loadVTLayers();for(const w of e)this.loadMatchingFeature(x,{bucketIndex:i,sourceLayerIndex:o,featureIndex:w,layoutVertexArrayOffset:0},a,h,d);return x}loadFeature(e){const{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(o),h=this.vtFeatures[a];if(h[i])return h[i];const d=this.vtLayers[a].feature(i);return h[i]=d,d}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){const a=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(a!=null)if(Array.isArray(a)){if(!this.promoteIdExpression){const h=za(a);if(h.result!=="success"){const d=h.value.map(x=>`${x.key}: ${x.message}`).join(", ");return void zi(`Failed to create expression for promoteId: ${d}`)}this.promoteIdExpression=h.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new wh),o=this.promoteIdExpression.evaluate({zoom:0},e)}else o=e.properties[a];typeof o=="boolean"&&(o=Number(o))}return o}}function D2(n,e,i,o,a){return ri(n,(h,d)=>{const x=e instanceof ua?e.get(d):null;return x&&x.evaluate?x.evaluate(i,o,void 0,a):x})}function pP(n,e){return e-n}qt(k2,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const L2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class X0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const a=o>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);const h=L2[15&o];if(!h)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new X0(x,d,h,e)}constructor(e,i=64,o=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const h=L2.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-x%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${o}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+x+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Y0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:d,nodeSize:x}=this,w=[0,h.length-1,0],T=[];for(;w.length;){const I=w.pop()||0,P=w.pop()||0,R=w.pop()||0;if(P-R<=x){for(let Z=R;Z<=P;Z++){const ee=d[2*Z],oe=d[2*Z+1];ee>=e&&ee<=o&&oe>=i&&oe<=a&&T.push(h[Z])}continue}const F=R+P>>1,N=d[2*F],H=d[2*F+1];N>=e&&N<=o&&H>=i&&H<=a&&T.push(h[F]),(I===0?e<=N:i<=H)&&(w.push(R),w.push(F-1),w.push(1-I)),(I===0?o>=N:a>=H)&&(w.push(F+1),w.push(P),w.push(1-I))}return T}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:h,nodeSize:d}=this,x=[0,a.length-1,0],w=[],T=o*o;for(;x.length;){const I=x.pop()||0,P=x.pop()||0,R=x.pop()||0;if(P-R<=d){for(let Z=R;Z<=P;Z++)F2(h[2*Z],h[2*Z+1],e,i)<=T&&w.push(a[Z]);continue}const F=R+P>>1,N=h[2*F],H=h[2*F+1];F2(N,H,e,i)<=T&&w.push(a[F]),(I===0?e-o<=N:i-o<=H)&&(x.push(R),x.push(F-1),x.push(1-I)),(I===0?e+o>=N:i+o>=H)&&(x.push(F+1),x.push(P),x.push(1-I))}return w}}function Y0(n,e,i,o,a,h){if(a-o<=i)return;const d=o+a>>1;z2(n,e,d,o,a,h),Y0(n,e,i,o,d-1,1-h),Y0(n,e,i,d+1,a,1-h)}function z2(n,e,i,o,a,h){for(;a>o;){if(a-o>600){const T=a-o+1,I=i-o+1,P=Math.log(T),R=.5*Math.exp(2*P/3),F=.5*Math.sqrt(P*R*(T-R)/T)*(I-T/2<0?-1:1);z2(n,e,i,Math.max(o,Math.floor(i-I*R/T+F)),Math.min(a,Math.floor(i+(T-I)*R/T+F)),h)}const d=e[2*i+h];let x=o,w=a;for(hg(n,e,o,i),e[2*a+h]>d&&hg(n,e,o,a);x<w;){for(hg(n,e,x,w),x++,w--;e[2*x+h]<d;)x++;for(;e[2*w+h]>d;)w--}e[2*o+h]===d?hg(n,e,o,w):(w++,hg(n,e,w,a)),w<=i&&(o=w+1),i<=w&&(a=w-1)}}function hg(n,e,i,o){K0(n,i,o),K0(e,2*i,2*o),K0(e,2*i+1,2*o+1)}function K0(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function F2(n,e,i,o){const a=n-i,h=e-o;return a*a+h*h}r.$=qr,r.A=Vl,r.B=rl,r.C=ja,r.D=$p,r.E=Ul,r.F=2,r.G=Km,r.H=eb,r.I=Ls,r.J=sl,r.K=class extends z_{},r.L=Ea,r.M=is,r.N=Vu,r.O=ju,r.P=Rt,r.Q=Fh,r.R=qo,r.S=hl,r.T=R0,r.U=lo,r.V=z_,r.W=Wc,r.X=za,r.Y=Ru,r.Z=Yl,r._=cl,r.a=function(n){return us.API_CDN_URL_REGEX.test(n)},r.a$=Ze,r.a0=hs,r.a1=oc,r.a2=Jl,r.a3=zh,r.a4=function(n){const e=n.value;let i=[];if(!e)return i;const o=sl(e);return o!=="string"?(i=i.concat([new z_(n.key,e,`string expected, "${o}" found`)]),i):(z0(e,!0)||(i=i.concat([new z_(n.key,e,`invalid url "${e}"`)])),i)},r.a5=je,r.a6=Fr,r.a7=ur,r.a8=wt,r.a9=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return tr(n.expression.evaluate(e))}interpolate(n,e,i){return{x:gi(n.x,e.x,i),y:gi(n.y,e.y,i),z:gi(n.z,e.z,i),azimuthal:gi(n.azimuthal,e.azimuthal,i),polar:gi(n.polar,e.polar,i)}}},r.aA=vs,r.aB=v,r.aC=pa,r.aD=xe,r.aE=We,r.aF=function(n,e){const i={};for(let o=0;o<e.length;o++){const a=e[o];a in n&&(i[a]=n[a])}return i},r.aG=ue,r.aH=me,r.aI=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,i,o){const a=this.entries[n]=this.entries[n]||{callbacks:[]};if(a.result){const[h,d]=a.result;return this.scheduler?this.scheduler.add(()=>{o(h,d)},e):o(h,d),()=>{}}return a.callbacks.push(o),a.cancel||(a.cancel=i((h,d)=>{a.result=[h,d];for(const x of a.callbacks)this.scheduler?this.scheduler.add(()=>{x(h,d)},e):x(h,d);setTimeout(()=>delete this.entries[n],3e3)})),()=>{a.result||(a.callbacks=a.callbacks.filter(h=>h!==o),a.callbacks.length||(a.cancel(),delete this.entries[n]))}}},r.aJ=function(n,e,i){const o=JSON.stringify(n.request);return n.data&&(this.deduped.entries[o]={result:[null,n.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},a=>{const h=mh(n.request,(d,x,w,T)=>{d?a(d):x&&a(null,{vectorTile:i?void 0:new Bi.VectorTile(new f_(x)),rawData:x,cacheControl:w,expires:T})});return()=>{h.cancel(),a()}},e)},r.aK=function(n){_d++,_d>Xn&&(n.getActor().send("enforceCacheSizeLimit",Do),_d=0)},r.aL=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},r.aM=Ys,r.aN=Pb,r.aO=zb,r.aP=Ib,r.aQ=function(n,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<n.length;o++){const a=document.createElement("source");Ep(n[o])||(i.crossOrigin="Anonymous"),a.src=n[o],i.appendChild(a)}return{cancel:()=>{}}},r.aR=M_,r.aS=function(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>xw(e,0,n))},r.aT=M2,r.aU=class{constructor(n,e,i,o){this.id=n,this.position=e!=null?new ie(e[0],e[1]):new ie(0,0),this.orientation=i??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,e){if(ze(n.matrix,e,n.matrix),n.meshes)for(const i of n.meshes){const o=vn.applyTransformFast(i.aabb,n.matrix);this.aabb.encapsulate(o)}if(n.children)for(const i of n.children)this._applyTransformations(i,n.matrix)}computeBoundsAndApplyParent(){const n=ve([]);for(const e of this.nodes)this._applyTransformations(e,n)}computeModelMatrix(n,e,i,o,a,h,d=!1){Wb(this.matrix,this,n.transform,this.position,e,i,o,a,h,d)}upload(n){if(!this.uploaded){for(const e of this.nodes)O0(e,n);for(const e of this.nodes)F_(e);this.uploaded=!0}}destroy(){for(const n of this.nodes)N0(n)}},r.aV=ei,r.aW=Qm,r.aX=Ae,r.aY=Oe,r.aZ=Xu,r.a_=Yr,r.aa=Pn,r.ab=ec,r.ac=ke,r.ad=Xi,r.ae=Li,r.af=De,r.ag=ua,r.ah=tn,r.ai=gi,r.aj=Lt,r.ak=wu,r.al=_n,r.am=mn,r.an=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return function([i,o]){const a=tr([1,i,o]);return{x:a.x,y:a.y,z:a.z}}(n.expression.evaluate(e))}interpolate(n,e,i){return{x:gi(n.x,e.x,i),y:gi(n.y,e.y,i),z:gi(n.z,e.z,i)}}},r.ao=function(n,e,i=0,o=!0){const a=new Rt(i,i),h=n.sub(a),d=e.add(a),x=[h,new Rt(d.x,h.y),d,new Rt(h.x,d.y)];return o&&x.push(h.clone()),x},r.ap=function(n,e){const i=[];for(let o=0;o<n.length;o++){const a=$e(o-1,-1,n.length-1),h=$e(o+1,-1,n.length-1),d=n[o],x=n[h],w=n[a].sub(d).unit(),T=x.sub(d).unit(),I=T.angleWithSep(w.x,w.y),P=w.add(T).unit().mult(-1*e/Math.sin(I/2));i.push(d.add(P))}return i},r.aq=pb,r.ar=wl,r.as=function(n,e,i=0){return Dt(((e.x-i)*n.scale-n.x)*Lt,(e.y*n.scale-n.y)*Lt,Ge(e.z,e.y))},r.at=xr,r.au=Di,r.av=Kn,r.aw=Cw,r.ax=function(n){let e=1/0,i=1/0,o=-1/0,a=-1/0;for(const h of n)e=Math.min(e,h.x),i=Math.min(i,h.y),o=Math.max(o,h.x),a=Math.max(a,h.y);return{min:new Rt(e,i),max:new Rt(o,a)}},r.ay=we,r.az=ze,r.b=function(n){return us.API_FONTS_REGEX.test(n)},r.b$=function(n,e,i){i*=.5;var o=e[0],a=e[1],h=e[2],d=e[3],x=Math.sin(i),w=Math.cos(i);return n[0]=o*w+a*x,n[1]=a*w-o*x,n[2]=h*w+d*x,n[3]=d*w-h*x,n},r.b0=Qu,r.b1=I_,r.b2=function(){ca.isLoading()||ca.isLoaded()||fl()!=="deferred"||Vd()},r.b3=Vh,r.b4=Ot,r.b5=nm,r.b6=xn,r.b7=c0,r.b8=Yy,r.b9=Wt,r.bA=function(n,e){const{x:i,y:o}=n.point,a=Qi(i,o,n.worldSize/n._pixelsPerMercatorPixel,0,0);return ze(a,a,at(Ye(e)))},r.bB=Q,r.bC=function(n){return n[0]=0,n[1]=0,n[2]=0,n},r.bD=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},r.bE=Ue,r.bF=fn,r.bG=Zi,r.bH=Ym,r.bI=ma,r.bJ=_0,r.bK=function(n,e,i,o,a){const h=5*e+2;n.float32[h+0]=i,n.float32[h+1]=o,n.float32[h+2]=a},r.bL=A_,r.bM=c_,r.bN=uo,r.bO=Ps,r.bP=z1,r.bQ=Vb,r.bR=j1,r.bS=V1,r.bT=g0,r.bU=ab,r.bV=w0,r.bW=X0,r.bX=$e,r.bY=Kt,r.bZ=Go,r.b_=ko,r.ba=Ua,r.bb=gs,r.bc=E,r.bd=Vn,r.be=Lm,r.bf=I0,r.bg=function(n,e){const i=tn(e.zoom);if(i===0)return Ye(n);const o=si(n),a=ki(o),h=xe(o.getWest())*e.worldSize,d=xe(o.getEast())*e.worldSize,x=me(o.getNorth())*e.worldSize,w=me(o.getSouth())*e.worldSize,T=[h,x,0],I=[d,x,0],P=[h,w,0],R=[d,w,0],F=ce([],e.globeMatrix);return Xi(T,T,F),Xi(I,I,F),Xi(P,P,F),Xi(R,R,F),a[0]=bt(a[0],P,i),a[1]=bt(a[1],R,i),a[2]=bt(a[2],I,i),a[3]=bt(a[3],T,i),vn.fromPoints(a)},r.bh=dt,r.bi=ce,r.bj=ji,r.bk=bt,r.bl=Zu,r.bm=g,r.bn=Bt,r.bo=et,r.bp=$_,r.bq=f_,r.br=mh,r.bs=function(n,e){const i=[];for(const o in n)o in e||i.push(o);return i},r.bt=Le,r.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bv=Ta,r.bw=function(n){var e=new G(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},r.bx=ve,r.by=di,r.bz=Se,r.c=gd,r.c$=u_,r.c0=ya,r.c1=gr,r.c2=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},r.c3=vt,r.c4=function(n,e,i,o,a){var h,d=1/Math.tan(e/2);return n[0]=d/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,a!=null&&a!==1/0?(n[10]=(a+o)*(h=1/(o-a)),n[14]=2*a*o*h):(n[10]=-1,n[14]=-2*o),n},r.c5=function(n,e,i,o,a,h,d){var x=1/(e-i),w=1/(o-a),T=1/(h-d);return n[0]=-2*x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*T,n[11]=0,n[12]=(e+i)*x,n[13]=(a+o)*w,n[14]=(d+h)*T,n[15]=1,n},r.c6=Ee,r.c7=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},r.c8=tu,r.c9=Ri,r.cA=D_,r.cB=Jt,r.cC=Fb,r.cD=function(n){const e=Fb(n,!0);return Q([],[e[0],e[1],e[4],e[5]])},r.cE=pt,r.cF=Mn,r.cG=Tt,r.cH=function(n){const{x:e,y:i}=n.point,{lng:o,lat:a}=n._center;return Qi(e,i,n.worldSize,o,a)},r.cI=xi,r.cJ=qe,r.cK=uc,r.cL=S,r.cM=function(n,e,i){let o=0;for(let a=0;a<2;++a)n[a]>0&&(o+=(n[a]-0)*(n[a]-0)),e[a]<0&&(o+=(0-e[a])*(0-e[a]));return o},r.cN=function(n){return n*n*n*n*n},r.cO=Te,r.cP=45,r.cQ=vl,r.cR=function(n,e,i){const o=Math.sqrt(n*n+e*e+i*i),a=o>0?Math.acos(i/o)*xc:0;let h=n!==0||e!==0?Math.atan2(-e,-n)*xc+90:0;return h<0&&(h+=360),[o,h,a]},r.cS=Dt,r.cT=tr,r.cU=Xe,r.cV=Ci,r.cW=vn,r.cX=yi,r.cY=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},r.cZ=z0,r.c_=function(n,e){return n.readFields(gI,{icons:[]},e)},r.ca=zn,r.cb=$a,r.cc=th,r.cd=ie,r.ce=xb,r.cf=function(){var n=new G(4);return G!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},r.cg=function(n,e,i){var o=e[0],a=e[1],h=e[2],d=e[3],x=Math.sin(i),w=Math.cos(i);return n[0]=o*w+h*x,n[1]=a*w+d*x,n[2]=o*-x+h*w,n[3]=a*-x+d*w,n},r.ch=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},r.ci=Rs,r.cj=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},r.ck=xa,r.cl=js,r.cm=ip,r.cn=ir,r.co=Ob,r.cp=id,r.cq=ci,r.cr=function(n,e,i,o,a,h,d,x,w){if(w.name==="globe")return ci(n,e,new id(i,o,a),!1);const T=Qm({z:i,x:o,y:a},w);return new vn([(h+T.x/T.scale)*e,e*(T.y/T.scale),d],[(h+T.x2/T.scale)*e,e*(T.y2/T.scale),x])},r.cs=function(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n[3]=Math.min(e[3],i[3]),n},r.ct=function(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n[3]=Math.max(e[3],i[3]),n},r.cu=function(n){const e=Math.round((n+45+360)%360/90)%4;return te[e]},r.cv=nt,r.cw=ia,r.cx=A,r.cy=function(n){const e=ve(new Float64Array(16));ze(e,n.pixelMatrix,n.globeMatrix);const i=[0,O,0],o=[0,j,0];return Xi(i,i,e),Xi(o,o,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!bn(n,new ie(n.center.lat,90)),o[0]>0&&o[0]<=n.width&&o[1]>0&&o[1]<=n.height&&!bn(n,new ie(n.center.lat,-90))]},r.cz=function(n,e){const{scale:i}=n.tileTransform,o=i*Lt/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return function(a,h,d){var x=h[1],w=h[2],T=h[3],I=d[0],P=d[1];return a[0]=h[0]*I,a[1]=x*I,a[2]=w*P,a[3]=T*P,a}(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},r.d=function(n){return us.API_TILEJSON_REGEX.test(n)},r.d$=ef,r.d0=Xp,r.d1=x0,r.d2=ph,r.d3=sc,r.d4=Us,r.d5=Cc,r.d6=Ai,r.d7=function(n){const e=n.indexOf(ac);return e>=0?n.slice(0,e):n},r.d8=function(n){return n.indexOf(ac)>=0},r.d9=function(n){const e=n.lastIndexOf(ac);return e>=0?n.slice(e+1):""},r.dA=pi,r.dB=Lr,r.dC=Ds,r.dD=256,r.dE=function(n,e){const i=[0,0,0];return Xi(i,i,dt(Ye(e.canonical))),Xi(i,i,n),i},r.dF=n=>({u_matrix:new th(n),u_texsize:new $a(n),u_pixels_to_tile_units:new nu(n),u_device_pixel_ratio:new zn(n),u_width_scale:new zn(n),u_floor_width_scale:new zn(n),u_image:new tu(n),u_units_to_pixels:new $a(n),u_tile_units_to_pixels:new zn(n),u_alpha_discard_threshold:new zn(n),u_trim_offset:new $a(n),u_trim_fade_range:new $a(n),u_trim_color:new vl(n),u_emissive_strength:new zn(n),u_zbias_factor:new zn(n),u_tile_to_meter:new zn(n),u_ground_shadow_factor:new Ri(n),u_pattern_transition:new zn(n)}),r.dG=n=>({u_matrix:new th(n),u_pixels_to_tile_units:new nu(n),u_device_pixel_ratio:new zn(n),u_width_scale:new zn(n),u_floor_width_scale:new zn(n),u_units_to_pixels:new $a(n),u_dash_image:new tu(n),u_gradient_image:new tu(n),u_image_height:new zn(n),u_texsize:new $a(n),u_tile_units_to_pixels:new zn(n),u_alpha_discard_threshold:new zn(n),u_trim_offset:new $a(n),u_trim_fade_range:new $a(n),u_trim_color:new vl(n),u_emissive_strength:new zn(n),u_zbias_factor:new zn(n),u_tile_to_meter:new zn(n),u_ground_shadow_factor:new Ri(n)}),r.dH=n=>({u_camera_to_center_distance:new zn(n),u_extrude_scale:new nu(n),u_device_pixel_ratio:new zn(n),u_matrix:new th(n),u_inv_rot_matrix:new th(n),u_merc_center:new $a(n),u_tile_id:new Ri(n),u_zoom_transition:new zn(n),u_up_dir:new Ri(n),u_emissive_strength:new zn(n)}),r.dI=Wh,r.dJ=vA,r.dK=l1,r.dL=(n,e,i,o,a,h)=>{const d=n.transform,x=d.projection.name==="globe";let w;if(h.paint.get("circle-pitch-alignment")==="map")if(x){const I=pi(d.zoom,e.canonical)*d._pixelsPerMercatorPixel;w=Float32Array.from([I,0,0,I])}else w=d.calculatePixelsToTileUnitsMatrix(i);else w=new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(d.projection),u_matrix:n.translatePosMatrix(e.projMatrix,i,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ho.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:Uy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(x){T.u_inv_rot_matrix=o,T.u_merc_center=a,T.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],T.u_zoom_transition=tn(d.zoom);const I=a[0]*Lt,P=a[1]*Lt;T.u_up_dir=d.projection.upVector(new id(0,0,0),I,P)}return T},r.dM=Mw,r.dN=no,r.dO=(n,e,i,o,a,h,d,x,w,T)=>{const I=n.transform,P=I.pitch<15?Aw(.07,.7,we((14-I.zoom)/5,0,1)):.07,R=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Pw(n,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:a,u_width_scale:h,u_floor_width_scale:d,u_image:0,u_tile_units_to_pixels:Iw(e,I),u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(R?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:Xe(e.tileID.canonical,0),u_ground_shadow_factor:w,u_pattern_transition:T}},r.dP=(n,e,i,o,a,h,d,x,w,T)=>{const I=n.transform,P=I.calculatePixelsToTileUnitsMatrix(e),R=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",F=I.pitch<15?Aw(.07,.7,we((14-I.zoom)/5,0,1)):.07;return{u_matrix:Pw(n,e,i,o),u_pixels_to_tile_units:P,u_device_pixel_ratio:h,u_width_scale:d,u_floor_width_scale:x,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:Rw(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Iw(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(R?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:F,u_tile_to_meter:Xe(e.tileID.canonical,0),u_ground_shadow_factor:T}},r.dQ=Mt,r.dR=Dm,r.dS=Ge,r.dT=Vy,r.dU=l_,r.dV=ew,r.dW=uf,r.dX=450,r.dY=7,r.dZ=tI,r.d_=hn,r.da=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.db=function(n,e,i,o){return n.type==="custom"?new iI(n,e):new pI[n.type](n,e,i,o)},r.dc=Si,r.dd=function(n){const e=n.indexOf(ac);return e>=0?n.slice(e+1):""},r.de=class extends nm{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},r.df=Rr,r.dg=Sa,r.dh=function(n){return n({pluginStatus:As,pluginURL:So}),Rr.on("pluginStateChange",n),n},r.di=sf,r.dj=class extends xl{constructor(n){super(n),this.current=iu}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.dk=ne,r.dl=function(n,e,i){const o=tn(i.zoom),a=n.style.map._antialias,h=n.terrain&&n.terrain.exaggeration()>0;return o===0&&!a&&!h},r.dm=function(n){const e=n.pixelsPerMeter,i=e/Ee(1,n.center.lat),o=ve(new Float64Array(16));return et(o,o,[n.point.x,n.point.y,0]),pt(o,o,[i,i,e]),Float32Array.from(o)},r.dn=si,r.dp=function(n){const e=nt-5;n=we(n,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(_n(n))),3);return Math.round(i*(B.length-1))},r.dq=function(n,e,i,o){const a=e.getNorth(),h=e.getSouth(),d=e.getWest(),x=e.getEast(),w=1<<n.z,T=x-d,I=a-h,P=T/L,R=-I/B[i],F=[0,P,0,R,0,0,a,d,0];if(n.z>0){const N=180/o;Pe(F,F,[N/T+1,0,0,0,N/I+1,0,-.5*N/P,.5*N/R,1])}return F[2]=w,F[5]=n.x,F[8]=n.y,F},r.dr=Ye,r.ds=function(n,e,i){const o=ve(new Float64Array(16)),a=(e/(1<<n)-.5)*Math.PI*2;return It(o,i.globeMatrix,a),Float32Array.from(o)},r.dt=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,o=1<<i,a=Math.floor(n.x),h=Math.floor((n.x-a)*o),d=Math.floor(n.y*o),x=this.findDEMTileFor(new Ys(i,a,i,h,d));return!(!x||!x.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||n.y<0||n.y>1)return e;const a=o.getSource().maxzoom,h=1<<a,d=Math.floor(n.x),x=n.x-d,w=new Ys(a,d,a,Math.floor(x*h),Math.floor(n.y*h)),T=this.findDEMTileFor(w);if(!T||!T.dem)return e;const I=T.dem,P=1<<T.tileID.canonical.z,R=(x*P-T.tileID.canonical.x)*I.dim,F=(n.y*P-T.tileID.canonical.y)*I.dim,N=Math.floor(R),H=Math.floor(F);return(i?this.exaggeration():1)*gi(gi(I.get(N,H),I.get(N,H+1),F-H),gi(I.get(N+1,H),I.get(N+1,H+1),F-H),R-N)}getAtTileOffset(n,e,i){const o=1<<n.canonical.z;return this.getAtPointOrZero(new ke(n.wrap+(n.canonical.x+e/Lt)/o,(n.canonical.y+i/Lt)/o))}getAtTileOffsetFunc(n,e,i,o){return a=>{const h=this.getAtTileOffset(n,a.x,a.y),d=o.upVector(n.canonical,a.x,a.y);return Kt(d,d,h*o.upVectorScale(n.canonical,e,i).metersToTile),d}}getForTilePoints(n,e,i,o){if(this.isUsingMockSource())return!1;const a=Qp.create(this,n,o);return!!a&&(e.forEach(h=>{h[2]=this.exaggeration()*a.getElevationAt(h[0],h[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,a=1<<n.canonical.z-o.canonical.z;let h=n.canonical.x/a-o.canonical.x,d=n.canonical.y/a-o.canonical.y,x=0;for(let w=0;w<n.canonical.z-o.canonical.z&&!i.leaves[x];w++){h*=2,d*=2;const T=2*Math.floor(d)+Math.floor(h);x=i.childOffsets[x]+T,h%=1,d%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const a of n){const h=this.getMinMaxForTile(a.tileID);h&&(i=Math.min(i,h.min),o=Math.max(o,h.max),e=!0)}return e?{min:i,max:o}:null}},r.du=y1,r.dv=z,r.dw=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},r.dx=se,r.dy=function(n,e){var i=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=i,n[2]=0,n[3]=-i,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},r.dz=Hr,r.e=us,r.e$=R2,r.e0=256,r.e1=at,r.e2=ha,r.e3=It,r.e4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},r.e5=yl,r.e6=Ku,r.e7=La,r.e8=function(n,e,i,o,a){return we((n-e)/(i-e)*(a-o)+o,o,a)},r.e9=Ja,r.eA=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},r.eB=_a,r.eC=W,r.eD=un,r.eE=function(n,e,i,o){return n[0]=e,n[1]=i,n[2]=o,n},r.eF=function([n,e,i]){const o=Math.hypot(n,e,i),a=Math.atan2(n,i),h=.5*Math.PI-Math.acos(-e/o);return new ie(qe(a),qe(h))},r.eG=pu,r.eH=D0,r.eI=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!function(i){if(fr==null){const o=i.navigator?i.navigator.userAgent:null;fr=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return fr}(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},r.eJ=function(n,e){Do=n,Xn=e},r.eK=bn,r.eL=dn,r.eM=function(n){const e=[0,0,0],i=ve(new Float64Array(16));return ze(i,n.pixelMatrix,n.globeMatrix),Xi(e,e,i),new Rt(e[0],e[1])},r.eN=function(){const n=$m;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(n0),$m=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.eO=function(){u_().acquire(n0)},r.eP=fl,r.eQ=function(n,e,i=!1){if(As===Cs.deferred||As===Cs.loading||As===Cs.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");So=Ho.resolveURL(n),As=Cs.deferred,dl=e,Hu(),i||Vd()},r.eR=function(n){Hp=Ho.resolveURL(n),Wp||(Wp=new $p(u_(),new Ul)),Wp.broadcast("setMeshoptUrl",Hp)},r.eS=fw,r.eT=function(n){s0=Ho.resolveURL(n),Wp||(Wp=new $p(u_(),new Ul)),Wp.broadcast("setDracoUrl",s0)},r.eU=dw,r.eV=Gm,r.eW=function(n){const e=Ol();if(!e)return;const i=e.delete(el);n&&i.then(()=>n()).catch(n)},r.eX=op,r.eY=qt,r.eZ=cf,r.e_=au,r.ea=function(n,e){var i=e[0],o=e[1],a=e[2],h=e[3],d=e[4],x=e[5],w=e[6],T=e[7],I=e[8],P=I*d-x*T,R=-I*h+x*w,F=T*h-d*w,N=i*P+o*R+a*F;return N?(n[0]=P*(N=1/N),n[1]=(-I*o+a*T)*N,n[2]=(x*o-a*d)*N,n[3]=R*N,n[4]=(I*i-a*w)*N,n[5]=(-x*i+a*h)*N,n[6]=F*N,n[7]=(-T*i+o*w)*N,n[8]=(d*i-o*h)*N,n):null},r.eb=ln,r.ec=ht,r.ed=L0,r.ee=function(n,e){if(n===e){var i=e[1],o=e[2],a=e[3],h=e[6],d=e[7],x=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=i,n[6]=e[9],n[7]=e[13],n[8]=o,n[9]=h,n[11]=e[14],n[12]=a,n[13]=d,n[14]=x}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},r.ef=Ht,r.eg=[1,1,1],r.eh=class{constructor(n,e,i,o){this.context=n,this.format=o,this.size=i,this.texture=n.gl.createTexture();const[a,h,d]=this.size,{gl:x}=n;x.bindTexture(x.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),x.texImage3D(x.TEXTURE_3D,0,this.format,a,h,d,0,P0(this.format),M0(this.format),e.data)}bind(n,e){const{context:i}=this,{gl:o}=i;o.bindTexture(o.TEXTURE_3D,this.texture),n!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,n),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},r.ei=Qp,r.ej=function(n,e,i,o){var a=new G(4);return a[0]=n,a[1]=e,a[2]=i,a[3]=o,a},r.ek=ls,r.el=function(n,e,i,o){var a=e[0],h=e[1],d=e[2],x=e[3];return n[0]=a+o*(i[0]-a),n[1]=h+o*(i[1]-h),n[2]=d+o*(i[2]-d),n[3]=x+o*(i[3]-x),n},r.em=Jp,r.en=_l,r.eo=Kc,r.ep=function(n,e,i,o,a,h,d,x,w,T,I,P,R,F,N,H){var Z=new G(16);return Z[0]=n,Z[1]=e,Z[2]=i,Z[3]=o,Z[4]=a,Z[5]=h,Z[6]=d,Z[7]=x,Z[8]=w,Z[9]=T,Z[10]=I,Z[11]=P,Z[12]=R,Z[13]=F,Z[14]=N,Z[15]=H,Z},r.eq=Y,r.er=qh,r.es=Qd,r.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Rt(1/0,1/0),max:new Rt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const i=O1(new Rt(0,0),new Rt(Lt,Lt),n),o=[];if(e&&!Jy(i,this._globalClipBounds))return o;for(const a of this._activeRegions){if(a.hiddenByOverlap||!Jy(i,a))continue;const h=O4(a.min,a.max,n);o.push({min:h.min,max:h.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId,order:a.order,clipMask:a.clipMask,clipScope:a.clipScope})}return o}setSources(n){this._setSources(n.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const o of e.cache.getVisibleCoordinates()){const a=e.cache.getTile(o).buckets[e.layer];a&&a.updateFootprints(o.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const i=n.getOrder(),o=n.getClipMask(),a=n.getClipScope();for(const h of e){if(!h.footprint)continue;const d=O1(h.footprint.min,h.footprint.max,h.id);this._activeRegions.push({min:d.min,max:d.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:h.id,footprint:h.footprint,order:i,clipMask:o,clipScope:a})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||o_(e.min,i.min)||o_(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(o,a){const h=(d,x)=>d+x;return o.length-a.length||o.reduce(h,"").localeCompare(a.reduce(h,""))}(e.clipScope,i.clipScope));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const i=this._activeRegions[e],o=this._prevRegions[e];n=i.priority!==o.priority||!F1(i,o)||i.order!==o.order||i.clipMask!==o.clipMask||!Ta(i.clipScope,o.clipScope),++e}}if(n){++this._updateTime;for(const i of this._activeRegions)i.order!==s_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const o=this._activeRegions;if(i>=o.length)return i;const a=o[i].priority;for(;i<o.length&&o[i].priority===a;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let a=i;const h=i;for(;a!==o;){const d=this._activeRegions[a];d.hiddenByOverlap=!1;for(let x=0;x<h;x++){const w=this._activeRegions[x];if(!w.hiddenByOverlap&&d.order===s_&&Jy(d,w)&&(d.hiddenByOverlap=B1(d.footprint,d.tileId,w.footprint,w.tileId),d.hiddenByOverlap))break}++a}i=o,o=e(i)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},r.eu=s_,r.ev=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const i=new Ua,o=new Yr,a=[],h=n+1+2,d=e[0]+1,x=e[0]+1+(1+e.length),w=(T,I,P)=>{let R=T===h-1?T-2:T===0?T:T-1;return R+=P?24575:0,[R,I]};for(let T=0;T<h;++T)i.emplaceBack(...w(T,0,!0));for(let T=0;T<d;++T)for(let I=0;I<h;++I)i.emplaceBack(...w(I,T,(I===0||I===h-1)&&!0));for(let T=0;T<e.length;++T){const I=e[T];for(let P=0;P<h;++P)i.emplaceBack(...w(P,I,!0))}for(let T=0;T<e.length;++T){const I=o.length,P=e[T]+1+2,R=new Yr;for(let H=0;H<P-1;H++){const Z=H===P-2,ee=Z?h*(x-e.length+T-H):h;for(let oe=0;oe<h-1;oe++){const ae=H*h+oe;H===0||Z||oe===0||oe===h-2?(R.emplaceBack(ae+1,ae,ae+ee),R.emplaceBack(ae+ee,ae+ee+1,ae+1)):(o.emplaceBack(ae+1,ae,ae+ee),o.emplaceBack(ae+ee,ae+ee+1,ae+1))}}const F=Vn.simpleSegment(0,I,i.length,o.length-I);for(let H=0;H<R.uint16.length;H+=3)o.emplaceBack(R.uint16[H],R.uint16[H+1],R.uint16[H+2]);const N=Vn.simpleSegment(0,I,i.length,o.length-I);a.push({withoutSkirts:F,withSkirts:N})}return{vertices:i,indices:o,segments:a}}_createGrid(n){const e=this._fillGridMeshWithLods(L,B);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,E.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new Yr;for(let d=0;d<=L;d++)e.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new yl,o=new yl,a=new yl,h=new yl;this._poleSegments=[];for(let d=0,x=0;d<S;d++){const w=360/(1<<d);i.emplaceBack(0,-v,0,.5,0),o.emplaceBack(0,-v,0,.5,1),a.emplaceBack(0,-v,0,.5,.5),h.emplaceBack(0,-v,0,.5,.5);for(let T=0;T<=L;T++){let I=T/L,P=0;const R=gi(0,w,I),[F,N,H]=X(Tr,nh,R,v);i.emplaceBack(F,N,H,I,P),o.emplaceBack(F,N,H,I,1-P);const Z=_n(R);I=.5+.5*Math.sin(Z),P=.5+.5*Math.cos(Z),a.emplaceBack(F,N,H,I,P),h.emplaceBack(F,N,H,I,1-P)}this._poleSegments.push(Vn.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,f,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(o,f,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(a,f,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(h,f,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},r.ew=ge,r.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.ey=Ie,r.ez=Be,r.f=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},r.f0=k2,r.f1=Tw,r.f2=Yi,r.f3="hd_road_elevation",r.f4=Vo,r.f5=ri,r.f6=rp,r.f7=y0,r.f8=ap,r.f9=function(n,e,i,o,a,h,d,x=1,w,T,I){n.createArrays(),n.tilePixelRatio=Lt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const P=n.layers[0].layout,R=n.layers[0]._unevaluatedLayout._values,F={};F.scaleFactor=x,F.textSizeScaleRange=P.get("text-size-scale-range"),F.iconSizeScaleRange=P.get("icon-size-scale-range");const[N,H]=F.textSizeScaleRange,[Z,ee]=F.iconSizeScaleRange;F.textScaleFactor=we(F.scaleFactor,N,H),F.iconScaleFactor=we(F.scaleFactor,Z,ee);const oe=R["text-size"],ae=R["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:Ce,maxZoom:Re}=n.textSizeData;F.compositeTextSizes=[oe.possiblyEvaluate(new Pn(Ce,{worldview:I}),h),oe.possiblyEvaluate(new Pn(Re,{worldview:I}),h)]}if(n.iconSizeData.kind==="composite"){const{minZoom:Ce,maxZoom:Re}=n.iconSizeData;F.compositeIconSizes=[ae.possiblyEvaluate(new Pn(Ce,{worldview:I}),h),ae.possiblyEvaluate(new Pn(Re,{worldview:I}),h)]}F.layoutTextSize=oe.possiblyEvaluate(new Pn(d+1,{worldview:I}),h),F.layoutIconSize=ae.possiblyEvaluate(new Pn(d+1,{worldview:I}),h),F.textMaxSize=oe.possiblyEvaluate(new Pn(18,{worldview:I}),h);const q=P.get("symbol-placement"),re=P.get("text-rotation-alignment")==="map"&&q!=="point",le=P.get("text-size");let fe=!1;const Me=[];for(const Ce of n.features){const Re=P.get("text-font").evaluate(Ce,{},h).join(","),Ne=le.evaluate(Ce,{},h)*F.textScaleFactor,Je=F.layoutTextSize.evaluate(Ce,{},h)*F.textScaleFactor,gt=F.layoutIconSize.evaluate(Ce,{},h)*F.iconScaleFactor,ct={horizontal:{},vertical:void 0},mt=Ce.text;let xt,tt=[0,0];if(mt){const Ti=mt.toString(),Vi=P.get("text-letter-spacing").evaluate(Ce,{},h)*Ps,Oi=P.get("text-line-height").evaluate(Ce,{},h)*Ps,Ki=rc(Ti)?Vi:0,Ui=P.get("text-anchor").evaluate(Ce,{},h),Ji=P.get("text-variable-anchor");if(!Ji){const rt=P.get("text-radial-offset").evaluate(Ce,{},h);if(rt)tt=ab(Ui,[rt*Ps,v0]);else{const Pt=P.get("text-offset").evaluate(Ce,{},h);tt=[Pt[0]*Ps,Pt[1]*Ps]}}let Rn=re?"center":P.get("text-justify").evaluate(Ce,{},h);const nr=q==="point",he=nr?P.get("text-max-width").evaluate(Ce,{},h)*Ps:1/0,ye=rt=>{n.allowVerticalPlacement&&No(Ti)&&(ct.vertical=m0(mt,e,i,a,Re,he,Oi,Ui,rt,Ki,tt,ma.vertical,!0,Je,Ne,w))};if(!re&&Ji){const rt=Rn==="auto"?Ji.map(Gt=>w0(Gt)):[Rn];let Pt=!1;for(let Gt=0;Gt<rt.length;Gt++){const Vt=rt[Gt];if(!ct.horizontal[Vt])if(Pt)ct.horizontal[Vt]=ct.horizontal[0];else{const Qt=m0(mt,e,i,a,Re,he,Oi,"center",Vt,Ki,tt,ma.horizontal,!1,Je,Ne,w);Qt&&(ct.horizontal[Vt]=Qt,Pt=Qt.positionedLines.length===1)}}ye("left")}else{if(Rn==="auto"&&(Rn=w0(Ui)),nr||P.get("text-writing-mode").indexOf("horizontal")>=0||!No(Ti)){const rt=m0(mt,e,i,a,Re,he,Oi,Ui,Rn,Ki,tt,ma.horizontal,!1,Je,Ne,w);rt&&(ct.horizontal[Rn]=rt)}ye(nr?"left":Rn)}}let ft,Ke,Qe,Ct,At,hi,ii=!1;const Ut=P.get("icon-text-fit").evaluate(Ce,{},h);if(Ce.icon&&Ce.icon.hasPrimary()){const Ti=cb(Ce.icon,n.iconSizeData,R["icon-size"],h,n.zoom,Ce,w,F.iconScaleFactor,I);ft=Ti.iconPrimary,Qe=Ti.iconSecondary;const Vi=ft.toString();if(Ke=o.get(Vi),Ke&&(At=P.get("icon-offset").evaluate(Ce,{},h),hi=P.get("icon-anchor").evaluate(Ce,{},h),xt=RA(a.get(Vi),Qe?a.get(Qe.toString()):void 0,At,hi),ii=Ke.sdf,n.sdfIcons===void 0?n.sdfIcons=Ke.sdf:n.sdfIcons!==Ke.sdf&&zi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ke.pixelRatio!==n.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),Qe){const Oi=Qe.toString();Ct=o.get(Oi)}}fe=fe||!(!Ce.icon||!Ce.icon.hasSecondary());const St=b0(ct.horizontal)||ct.vertical;n.iconsInText||(n.iconsInText=!!St&&St.iconsInText);const Mi=Je*F.textScaleFactor/Ps,{defaultShapedIcon:ti,verticallyShapedIcon:ni}=VA(n,xt,P,Ce,h,ct,Mi,At,Ut);Ut!=="none"&&xt&&(Hw(xt)||Ww(xt))&&(x_(0,Ke,ft,xt,ti,Ut,T,o,a),x_(0,Ct,Qe,xt,ti,Ut,T,o,a),ni&&(x_(0,Ke,ft,xt,ni,Ut,T,o,a),x_(0,Ct,Qe,xt,ni,Ut,T,o,a))),xt=ti,Me.push({feature:Ce,shapedTextOrientations:ct,shapedText:St,shapedIcon:xt,iconPrimary:ft,iconSecondary:Qe,iconOffset:At,iconAnchor:hi,verticallyShapedIcon:ni,layoutTextSize:Je,layoutIconSize:gt,textOffset:tt,isSDFIcon:ii,iconTextFit:Ut})}return{featureData:Me,sizes:F,hasAnySecondaryIcon:fe,textAlongLine:re,symbolPlacement:q}},r.fa=tb,r.fb=function(n,e,i,o,a,h,d,x,w,T){const{featureData:I,hasAnySecondaryIcon:P,sizes:R,textAlongLine:F,symbolPlacement:N}=e;for(const H of I){const{shapedIcon:Z,verticallyShapedIcon:ee,feature:oe,shapedTextOrientations:ae,shapedText:q,layoutTextSize:re,textOffset:le,isSDFIcon:fe,iconPrimary:Me,iconSecondary:Ce,iconTextFit:Re,iconOffset:Ne}=H;ub(Z,T.iconPositions,Me,Ce),ub(ee,T.iconPositions,Me,Ce),jA(ae,T.iconPositions),BA(Me,Ce,T.iconPositions),(q||Z)&&UA(n,oe,ae,Z,ee,w,R,re,0,le,fe,o,a,d,x,P,Re,Ne,F,N)}i&&n.generateCollisionDebugBuffers(h,n.collisionBoxArray,R.textScaleFactor)},r.fc=Bi,r.fd=G_,r.fe=kl,r.ff=Ii,r.fg=Ow,r.fh=ba,r.fi=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==mw){const i=new Uint32Array(n,0,7),[,,o,a,h,d]=i;e=i.byteLength+a+h+d+h,(o!==n.byteLength||e>=n.byteLength)&&zi("Invalid b3dm header information.")}return xw(n,e)},r.fj=function(n,e){const i=M2(n);for(const o of i){for(const a of o.meshes)hP(a);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(dP(o.lights,e)))}return i},r.fk=O_,r.fl=Tn,r.fm=uw,r.fn=ca,r.fo=Cs,r.fp=function(n){Tc(),na!=null&&na.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-n;o++)e.delete(i[o]).catch(a=>zi(a.message))}).catch(i=>zi(i.message))}).catch(e=>zi(e.message))},r.g=function(n,e){return Sa(He(n,{method:"GET"}),e)},r.h=He,r.i=function(n){return us.API_STYLE_REGEX.test(n)&&!gd(n)},r.j=function(n){return n.indexOf("mapbox:")===0},r.k=Dl,r.l=fh,r.m=function(n){return decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.n=function(n,e){return Sa(He(n,{type:"json"}),e)},r.o=Sc,r.p=function(n,e){return Sa(He(n,{method:"POST"}),e)},r.q=Ho,r.r=Ks,r.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=mu,r.u=function(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()},r.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},r.w=zi,r.x=function(){return r0||(r0=new op),r0},r.y=$0,r.z=ra}),M(["./shared"],function(r){function U(qe){const te=qe?qe.url.toString():void 0;return te?performance.getEntriesByName(te):[]}function G(qe){if(typeof qe=="number"||typeof qe=="boolean"||typeof qe=="string"||qe==null)return JSON.stringify(qe);if(Array.isArray(qe)){let ne="[";for(const ge of qe)ne+=`${G(ge)},`;return`${ne}]`}let te="{";for(const ne of Object.keys(qe).sort())te+=`${ne}:${G(qe[ne])},`;return`${te}}`}function Q(qe){let te="";for(const ne of r.bu)te+=`/${G(qe[ne])}`;return te}class se{constructor(te){this.keyCache={},this._layers={},this._layerConfigs={},te&&this.replace(te)}replace(te,ne){this._layerConfigs={},this._layers={},this.update(te,[],ne)}update(te,ne,ge){this._options=ge;for(const we of te)this._layerConfigs[we.id]=we,(this._layers[we.id]=r.db(we,this.scope,null,this._options)).compileFilter(ge),this.keyCache[we.id]&&delete this.keyCache[we.id];for(const we of ne)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const Ie=function(we,De){const $e={};for(let He=0;He<we.length;He++){const lt=we[He];let Ze=De&&De[lt.id];Ze||(lt.type==="symbol"?Ze=lt.id:(Ze=Q(lt),lt.type==="line"&&lt.paint&&function ei(ri){return typeof ri=="string"&&ri==="line-progress"||(Array.isArray(ri)?ri.some(ei):!(!ri||typeof ri!="object")&&Object.values(ri).some(ei))}(lt.paint["line-width"])&&(Ze+=`/${G(lt.paint["line-width"])}`))),De&&(De[lt.id]=Ze);let Mt=$e[Ze];Mt||(Mt=$e[Ze]=[]),Mt.push(lt)}const Le=[];for(const He in $e)Le.push($e[He]);return Le}(Object.values(this._layerConfigs),this.keyCache);for(const we of Ie){const De=we.map(Mt=>this._layers[Mt.id]),$e=De[0];if($e.visibility==="none")continue;const Le=$e.source||"";let He=this.familiesBySource[Le];He||(He=this.familiesBySource[Le]={});const lt=$e.sourceLayer||"_geojsonTileLayer";let Ze=He[lt];Ze||(Ze=He[lt]=[]),Ze.push(De)}}}const de=1*r.e_;class Pe{constructor(te){const ne={},ge=[];for(const $e in te){const Le=te[$e],He=ne[$e]={};for(const lt in Le.glyphs){const Ze=Le.glyphs[+lt];if(!Ze||Ze.bitmap.width===0||Ze.bitmap.height===0)continue;const Mt=Ze.metrics.localGlyph?de:1,ei={x:0,y:0,w:Ze.bitmap.width+2*Mt,h:Ze.bitmap.height+2*Mt};ge.push(ei),He[lt]=ei}}const{w:Ie,h:we}=r.H(ge),De=new r.eZ({width:Ie||1,height:we||1});for(const $e in te){const Le=te[$e];for(const He in Le.glyphs){const lt=Le.glyphs[+He];if(!lt||lt.bitmap.width===0||lt.bitmap.height===0)continue;const Ze=ne[$e][He],Mt=lt.metrics.localGlyph?de:1;r.eZ.copy(lt.bitmap,De,{x:0,y:0},{x:Ze.x+Mt,y:Ze.y+Mt},lt.bitmap)}}this.image=De,this.positions=ne}}r.eY(Pe,"GlyphAtlas");class Se{constructor(te){this.tileID=new r.aM(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.lut=te.lut,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.scope=te.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.request&&te.request.collectResourceTiming,this.promoteId=te.promoteId,this.isSymbolTile=te.isSymbolTile,this.tileTransform=r.aW(te.tileID.canonical,te.projection),this.projection=te.projection,this.worldview=te.worldview,this.localizableLayerIds=te.localizableLayerIds,this.brightness=te.brightness,this.extraShadowCaster=!!te.extraShadowCaster,this.tessellationStep=te.tessellationStep,this.scaleFactor=te.scaleFactor,this.worldview=te.worldview}parse(te,ne,ge,Ie,we,De){this.status="parsing",this.data=te,this.collisionBoxArray=new r.b0;const $e=new r.e$(Object.keys(te.layers).sort()),Le=new r.f0(this.tileID,this.promoteId);Le.bucketLayerIDs=[];const He={},lt=new r.f1(256,256),Ze={featureIndex:Le,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:lt,availableImages:ge,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},Mt=[],ei=ne.familiesBySource[this.source];for(const Si in ei){const Ai=te.layers[Si];if(!Ai)continue;let Pi=!1,Hi=!1,zi=!1;for(const Tn of ei[Si])Tn[0].type==="symbol"?Pi=!0:Hi=!0,Tn[0].is3D()&&Tn[0].type!=="model"&&(zi=!0);if(this.extraShadowCaster&&!zi||this.isSymbolTile===!0&&!Pi||this.isSymbolTile===!1&&!Hi)continue;Ai.version===1&&r.w(`Vector tile source "${this.source}" layer "${Si}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bn=$e.encode(Si),nn=[];let tr=!1;for(let Tn=0,xn=0;Tn<Ai.length;Tn++){const fr=Ai.feature(Tn),gr=Le.getId(fr,Si);if(this.localizableLayerIds&&this.localizableLayerIds.has(Si)){const lr=fr.properties?fr.properties.worldview:null;if(this.worldview&&typeof lr=="string")if(lr==="all")fr.properties.$localized=!0;else{if(!lr.split(",").includes(this.worldview))continue;fr.properties.$localized=!0,fr.properties.worldview=this.worldview}}!tr&&fr.properties&&fr.properties.hasOwnProperty(r.f2)&&(tr=!0),nn.push({feature:fr,id:gr,index:xn,sourceLayerIndex:Bn}),xn++}tr&&!Ze.elevationFeatures&&te.layers.hasOwnProperty(r.f3)&&(Ze.elevationFeatures=r.f4.parseFrom(te.layers[r.f3],this.canonical));for(const Tn of ei[Si]){const xn=Tn[0];if(this.extraShadowCaster&&(!xn.is3D()||xn.type==="model")||this.isSymbolTile!==void 0&&xn.type==="symbol"!==this.isSymbolTile||xn.minzoom&&this.zoom<Math.floor(xn.minzoom)||xn.maxzoom&&this.zoom>=xn.maxzoom||xn.visibility==="none")continue;ve(Tn,this.zoom,Ze.brightness,ge,this.worldview);const fr=He[xn.id]=xn.createBucket({index:Le.bucketLayerIDs.length,layers:Tn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ie,worldview:this.worldview});Le.bucketLayerIDs.push(Tn.map(lr=>r.C(lr.id,lr.scope)));let gr=fr.prepare?fr.prepare():null;gr!=null?(gr=gr.then(()=>fr.populate(nn,Ze,this.tileID.canonical,this.tileTransform)),Mt.push(gr)):fr.populate(nn,Ze,this.tileID.canonical,this.tileTransform)}}const ri=()=>{let Si,Ai,Pi,Hi,zi,Bn;lt.trim();const nn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},tr=()=>{if(Si)return this.status="done",De(Si);if(this.extraShadowCaster)this.status="done",De(null,{buckets:Object.values(He).filter(xn=>!xn.isEmpty()),featureIndex:Le,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ze.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Ai&&Pi&&Hi){const xn=new Pe(Ai),fr=new Map;for(const[Nr,Lr]of Pi.entries()){const{imagePosition:Ds}=r.f7(Nr,Lr,r.f8);fr.set(Nr,Ds)}const gr={};for(const Nr in He){const Lr=He[Nr];Lr instanceof r.b1&&(ve(Lr.layers,this.zoom,Ze.brightness,ge,this.worldview),gr[Nr]=r.f9(Lr,Ai,xn.positions,Pi,fr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,zi,this.worldview))}const lr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(we,Pi,zi,()=>{lr.iconsPending=!1,Tn(gr,xn,lr)}),this.rasterizeIfNeeded(we,Hi,Bn,()=>{lr.patternsPending=!1,Tn(gr,xn,lr)})}},Tn=(xn,fr,gr,lr)=>{if(gr.iconsPending||gr.patternsPending)return;const Nr=new r.fa(Pi,Hi,this.lut);for(const Lr in He){const Ds=He[Lr];if(Lr in xn)r.fb(Ds,xn[Lr],this.showCollisionBoxes,ge,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Pi,Nr);else if(Ds.hasPattern&&(Ds instanceof r.b7||Ds instanceof r.b8||Ds instanceof r.dU)){ve(Ds.layers,this.zoom,Ze.brightness,ge,this.worldview);const to=Object.fromEntries(Nr.patternPositions);Ds.addFeatures(Ze,this.tileID.canonical,to,ge,this.tileTransform,this.brightness)}}this.status="done",De(null,{buckets:Object.values(He).filter(Lr=>!Lr.isEmpty()),featureIndex:Le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:fr.image,lineAtlas:lt,imageAtlas:Nr,brightness:Ze.brightness})};if(!this.extraShadowCaster){const xn=r.f5(Ze.glyphDependencies,lr=>Object.keys(lr).map(Number));Object.keys(xn).length?we.send("getGlyphs",{uid:this.uid,stacks:xn,scope:this.scope},(lr,Nr)=>{Si||(Si=lr,Ai=Nr,tr())},void 0,!1,nn):Ai={};const fr=Array.from(Ze.iconDependencies.keys()).map(lr=>r.I.parse(lr));fr.length?we.send("getImages",{images:fr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(lr,Nr)=>{Si||(Si=lr,Pi=new Map,zi=this.updateImageMapAndGetImageTaskQueue(Pi,Nr,Ze.iconDependencies),tr())},void 0,!1,nn):(Pi=new Map,zi=new Map);const gr=Array.from(Ze.patternDependencies.keys()).map(lr=>r.I.parse(lr));gr.length?we.send("getImages",{images:gr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(lr,Nr)=>{Si||(Si=lr,Hi=new Map,Bn=this.updateImageMapAndGetImageTaskQueue(Hi,Nr,Ze.patternDependencies),tr())},void 0,!1,nn):(Hi=new Map,Bn=new Map)}if(Ze.elevationFeatures&&Ze.elevationFeatures.length>0){const xn=[];for(const gr of Object.values(He))if(gr instanceof r.b8){const lr=gr.getUnevaluatedPortalGraph();lr&&xn.push(lr)}const fr=r.f6.evaluate(xn);for(const gr of Object.values(He))if(gr instanceof r.b8){const lr=te.layers[$e.decode(gr.sourceLayerIndex)];gr.setEvaluatedPortalGraph(fr,lr,this.tileID.canonical,Ze.availableImages,Ze.brightness)}}tr()};Mt.length>0?Promise.allSettled(Mt).then(ri).catch(De):ri()}rasterizeIfNeeded(te,ne,ge,Ie){Array.from(ne.values()).some(we=>we.usvg)?this.rasterize(te,ne,ge,Ie):Ie()}updateImageMapAndGetImageTaskQueue(te,ne,ge){const Ie=new Map;for(const we of ne.keys()){const De=ge.get(we)||[];for(const $e of De){const Le=$e.toString(),He=ne.get($e.id.toString());He.usvg?Ie.has(Le)||(Ie.set(Le,$e),te.set(Le,Object.assign({},He))):te.set(Le,He)}}return Ie}rasterize(te,ne,ge,Ie){this.rasterizeTask=te.send("rasterizeImages",{scope:this.scope,tasks:ge},(we,De)=>{if(!we)for(const[$e,Le]of De.entries()){const He=Object.assign(ne.get($e),{data:Le});ne.set($e,He)}Ie()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ve(qe,te,ne,ge,Ie){const we=new r.aa(te,{brightness:ne,worldview:Ie});for(const De of qe)De.recalculate(we,ge)}class ce extends r.E{constructor(te,ne,ge,Ie,we,De,$e){super(),this.actor=te,this.layerIndex=ne,this.availableImages=ge,this.availableModels=Ie,this.loadVectorData=De||r.aJ,this.loading={},this.loaded={},this.deduped=new r.aI(te.scheduler),this.isSpriteLoaded=we,this.scheduler=te.scheduler,this.brightness=$e}loadTile(te,ne){const ge=te.uid,Ie=te&&te.request,we=Ie&&Ie.collectResourceTiming,De=this.loading[ge]=new Se(te);De.abort=this.loadVectorData(te,($e,Le)=>{const He=!this.loading[ge];if(delete this.loading[ge],De.cancelRasterize(),He||$e||!Le)return De.status="done",He||(this.loaded[ge]=De),ne($e);const lt=Le.rawData,Ze={};Le.expires&&(Ze.expires=Le.expires),Le.cacheControl&&(Ze.cacheControl=Le.cacheControl),De.vectorTile=Le.vectorTile||new r.fc.VectorTile(new r.bq(lt));const Mt=()=>{De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(ei,ri)=>{if(ei||!ri)return ne(ei);const Si={};if(we){const Ai=U(Ie);Ai.length>0&&(Si.resourceTiming=JSON.parse(JSON.stringify(Ai)))}ne(null,r.h({rawTileData:lt.slice(0)},ri,Ze,Si))})};this.isSpriteLoaded?Mt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Mt,{type:"parseTile",isSymbolTile:te.isSymbolTile,zoom:te.tileZoom}):Mt()}),this.loaded=this.loaded||{},this.loaded[ge]=De})}reloadTile(te,ne){const ge=this.loaded,Ie=te.uid;if(ge&&ge[Ie]){const we=ge[Ie];we.scaleFactor=te.scaleFactor,we.showCollisionBoxes=te.showCollisionBoxes,we.projection=te.projection,we.brightness=te.brightness,we.tileTransform=r.aW(te.tileID.canonical,te.projection),we.extraShadowCaster=te.extraShadowCaster,we.lut=te.lut,we.worldview=te.worldview;const De=($e,Le)=>{const He=we.reloadCallback;He&&(delete we.reloadCallback,we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,He)),ne($e,Le)};we.status==="parsing"?we.reloadCallback=De:we.status==="done"&&(we.vectorTile?we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,De):De())}else ne(null,void 0)}abortTile(te,ne){const ge=te.uid,Ie=this.loading[ge];Ie&&(Ie.abort&&Ie.abort(),delete this.loading[ge]),ne()}removeTile(te,ne){const ge=this.loaded,Ie=te.uid;ge&&ge[Ie]&&delete ge[Ie],ne()}}class ze{loadTile(te,ne){const{uid:ge,encoding:Ie,rawImageData:we,padding:De}=te,$e=ImageBitmap&&we instanceof ImageBitmap?this.getImageData(we,De):we;ne(null,new r.fd(ge,$e,Ie,De<1))}reloadTile(te,ne){ne(null,null)}abortTile(te,ne){ne()}removeTile(te,ne){ne()}getImageData(te,ne){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const ge=this.offscreenCanvasContext.getImageData(-ne,-ne,te.width+2*ne,te.height+2*ne);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ge}}r.bp.setPbf(r.bq);class et{constructor(te){this._mrt=new r.bp(te.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=te.uid,this.tileID=te.tileID,this.source=te.source}parse(te,ne){const ge=this._mrt;this.status="parsing",this._entireBuffer=te;try{ge.parseHeader(te),this._isHeaderLoaded=!0;const Ie=[];for(const we in ge.layers){const De=ge.getLayer(we),$e=De.getDataRange(De.getBandList()),Le=ge.createDecodingTask($e),He=te.slice($e.firstByte,$e.lastByte+1),lt=r.bp.performDecoding(He,Le).then(Ze=>Le.complete(null,Ze)).catch(Ze=>Le.complete(Ze,null));Ie.push(lt)}Promise.allSettled(Ie).then(()=>ne(null,ge)).catch(we=>ne(we))}catch(Ie){ne(Ie)}}}class pt{constructor(te){this.actor=te,this.loading={},this.loaded={}}loadTile(te,ne){const ge=te.uid,Ie=te.request,we=this.loading[ge]=new et(te),{cancel:De}=r.br(Ie,($e,Le,He,lt)=>{const Ze=!this.loading[ge];if(delete this.loading[ge],Ze||$e||!Le)return we.status="done",Ze||(this.loaded[ge]=we),ne($e);we.parse(Le,(Mt,ei)=>{if(Mt||!ei)return ne(Mt);ne(null,ei,He,lt)}),this.loaded[ge]=we});we.abort=De}reloadTile(te,ne){ne(null,void 0)}abortTile(te,ne){const ge=te.uid,Ie=this.loading[ge];Ie&&(Ie.abort&&Ie.abort(),delete this.loading[ge]),ne()}removeTile(te,ne){const ge=te.uid;this.loaded[ge]&&delete this.loaded[ge],ne()}decodeRasterArray(te,ne){r.bp.performDecoding(te.buffer,te.task).then(ge=>ne(null,ge)).catch(ge=>ne(ge))}}const Tt=r.fc.VectorTileFeature.prototype.toGeoJSON;class It{constructor(te){this._feature=te,this.extent=r.aj,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const ne of this._feature.geometry)te.push([new r.P(ne[0],ne[1])]);return te}{const te=[];for(const ne of this._feature.geometry){const ge=[];for(const Ie of ne)ge.push(new r.P(Ie[0],Ie[1]));te.push(ge)}return te}}toGeoJSON(te,ne,ge){return Tt.call(this,te,ne,ge)}}class di{constructor(te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.aj,this.length=te.length,this._features=te}feature(te){return new It(this._features[te])}}class Bt{constructor(te,ne){this.name=te,this.extent=r.aj,this.length=ne.length,this._features=ne}feature(te){return new It(this._features[te])}}class Yt extends di{constructor(te){super([]),this.layers={};for(const ne in te)this.layers[ne]=new Bt(ne,te[ne])}}const vt=64/4096,Jt=128;class Ht{constructor(){this.features=new Map}clear(){this.features.clear()}load(te=[],ne){for(const ge of te){const Ie=ge.id;if(Ie==null)continue;let we=this.features.get(Ie);we&&this.updateCache(we,ne),ge.geometry?(we=Li(ge),this.updateCache(we,ne),this.features.set(Ie,we)):this.features.delete(Ie),this.updateCache(we,ne)}}updateCache(te,ne){for(const{canonical:ge,uid:Ie}of Object.values(ne)){const{z:we,x:De,y:$e}=ge;Nt(te,Math.pow(2,we),De,$e)&&delete ne[Ie]}}getTile(te,ne,ge){const Ie=Math.pow(2,te),we=[];for(const De of this.features.values())Nt(De,Ie,ne,ge)&&we.push(xi(De,Ie,ne,ge));return{features:we}}getFeatures(){return[...this.features.values()]}}function Nt({minX:qe,minY:te,maxX:ne,maxY:ge},Ie,we,De){return qe<(we+1+vt)/Ie&&te<(De+1+vt)/Ie&&ne>(we-vt)/Ie&&ge>(De-vt)/Ie}function Li(qe){const{id:te,geometry:ne,properties:ge}=qe;if(!ne)return;if(ne.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ie,coordinates:we}=ne,De={id:te,type:1,geometry:[],tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},$e=De.geometry;if(Ie==="Point")Dt(we,$e,De);else if(Ie==="MultiPoint")for(const Le of we)Dt(Le,$e,De);else if(Ie==="LineString")De.type=2,Ci(we,$e,De);else if(Ie==="MultiLineString")De.type=2,yi(we,$e,De);else if(Ie==="Polygon")De.type=3,yi(we,$e,De,!0);else{if(Ie!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");De.type=3;for(const Le of we)yi(Le,$e,De,!0)}return De}function Dt([qe,te],ne,ge){const Ie=r.aD(qe);let we=r.aH(te);we=we<0?0:we>1?1:we,ne.push(Ie,we),ge.minX=Math.min(ge.minX,Ie),ge.minY=Math.min(ge.minY,we),ge.maxX=Math.max(ge.maxX,Ie),ge.maxY=Math.max(ge.maxY,we)}function Ci(qe,te,ne,ge=!1,Ie=!1){const we=[];for(const De of qe)Dt(De,we,ne);te.push(we),ge&&function(De,$e){let Le=0;for(let He=0,lt=De.length,Ze=lt-2;He<lt;Ze=He,He+=2)Le+=(De[He]-De[Ze])*(De[He+1]+De[Ze+1]);if(Le>0===$e)for(let He=0,lt=De.length;He<lt/2;He+=2){const Ze=De[He],Mt=De[He+1];De[He]=De[lt-2-He],De[He+1]=De[lt-1-He],De[lt-2-He]=Ze,De[lt-1-He]=Mt}}(we,Ie)}function yi(qe,te,ne,ge=!1){for(let Ie=0;Ie<qe.length;Ie++)Ci(qe[Ie],te,ne,ge,Ie===0)}function xi(qe,te,ne,ge){const{id:Ie,type:we,geometry:De,tags:$e}=qe,Le=[];if(we===1)(function(He,lt,Ze,Mt,ei){for(let ri=0;ri<He.length;ri+=2){const Si=Math.round(r.aj*(He[ri+0]*lt-Ze)),Ai=Math.round(r.aj*(He[ri+1]*lt-Mt));ei.push([Si,Ai])}})(De,te,ne,ge,Le);else for(const He of De)$t(He,te,ne,ge,Le);return{id:Ie,type:we,geometry:Le,tags:$e}}function $t(qe,te,ne,ge,Ie){const De=r.aj+Jt;let $e;for(let Le=0;Le<qe.length-2;Le+=2){let He=Math.round(r.aj*(qe[Le+0]*te-ne)),lt=Math.round(r.aj*(qe[Le+1]*te-ge)),Ze=Math.round(r.aj*(qe[Le+2]*te-ne)),Mt=Math.round(r.aj*(qe[Le+3]*te-ge));const ei=Ze-He,ri=Mt-lt;He<-128&&Ze<-128||(He<-128?(lt+=Math.round(ri*((-128-He)/ei)),He=-128):Ze<-128&&(Mt=lt+Math.round(ri*((-128-He)/ei)),Ze=-128),lt<-128&&Mt<-128||(lt<-128?(He+=Math.round(ei*((-128-lt)/ri)),lt=-128):Mt<-128&&(Ze=He+Math.round(ei*((-128-lt)/ri)),Mt=-128),He>=De&&Ze>=De||(He>=De?(lt+=Math.round(ri*((De-He)/ei)),He=De):Ze>=De&&(Mt=lt+Math.round(ri*((De-He)/ei)),Ze=De),lt>=De&&Mt>=De||(lt>=De?(He+=Math.round(ei*((De-lt)/ri)),lt=De):Mt>=De&&(Ze=He+Math.round(ei*((De-lt)/ri)),Mt=De),$e&&He===$e[$e.length-1][0]&&lt===$e[$e.length-1][1]||($e=[[He,lt]],Ie.push($e)),$e.push([Ze,Mt])))))}}var Ei,Kt,Ue,zt={exports:{}},un=function(){if(Ue)return zt.exports;Ue=1;var qe=r.fg(),te=function(){if(Kt)return Ei;Kt=1;var lt=r.fe(),Ze=r.ff().VectorTileFeature;function Mt(ri,Si){this.options=Si||{},this.features=ri,this.length=ri.length}function ei(ri,Si){this.id=typeof ri.id=="number"?ri.id:void 0,this.type=ri.type,this.rawGeometry=ri.type===1?[ri.geometry]:ri.geometry,this.properties=ri.tags,this.extent=Si||4096}return Ei=Mt,Mt.prototype.feature=function(ri){return new ei(this.features[ri],this.options.extent)},ei.prototype.loadGeometry=function(){var ri=this.rawGeometry;this.geometry=[];for(var Si=0;Si<ri.length;Si++){for(var Ai=ri[Si],Pi=[],Hi=0;Hi<Ai.length;Hi++)Pi.push(new lt(Ai[Hi][0],Ai[Hi][1]));this.geometry.push(Pi)}return this.geometry},ei.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ri=this.geometry,Si=1/0,Ai=-1/0,Pi=1/0,Hi=-1/0,zi=0;zi<ri.length;zi++)for(var Bn=ri[zi],nn=0;nn<Bn.length;nn++){var tr=Bn[nn];Si=Math.min(Si,tr.x),Ai=Math.max(Ai,tr.x),Pi=Math.min(Pi,tr.y),Hi=Math.max(Hi,tr.y)}return[Si,Pi,Ai,Hi]},ei.prototype.toGeoJSON=Ze.prototype.toGeoJSON,Ei}();function ne(lt){var Ze=new qe;return function(Mt,ei){for(var ri in Mt.layers)ei.writeMessage(3,ge,Mt.layers[ri])}(lt,Ze),Ze.finish()}function ge(lt,Ze){var Mt;Ze.writeVarintField(15,lt.version||1),Ze.writeStringField(1,lt.name||""),Ze.writeVarintField(5,lt.extent||4096);var ei={keys:[],values:[],keycache:{},valuecache:{}};for(Mt=0;Mt<lt.length;Mt++)ei.feature=lt.feature(Mt),Ze.writeMessage(2,Ie,ei);var ri=ei.keys;for(Mt=0;Mt<ri.length;Mt++)Ze.writeStringField(3,ri[Mt]);var Si=ei.values;for(Mt=0;Mt<Si.length;Mt++)Ze.writeMessage(4,He,Si[Mt])}function Ie(lt,Ze){var Mt=lt.feature;Mt.id!==void 0&&Ze.writeVarintField(1,Mt.id),Ze.writeMessage(2,we,lt),Ze.writeVarintField(3,Mt.type),Ze.writeMessage(4,Le,Mt)}function we(lt,Ze){var Mt=lt.feature,ei=lt.keys,ri=lt.values,Si=lt.keycache,Ai=lt.valuecache;for(var Pi in Mt.properties){var Hi=Mt.properties[Pi],zi=Si[Pi];if(Hi!==null){zi===void 0&&(ei.push(Pi),Si[Pi]=zi=ei.length-1),Ze.writeVarint(zi);var Bn=typeof Hi;Bn!=="string"&&Bn!=="boolean"&&Bn!=="number"&&(Hi=JSON.stringify(Hi));var nn=Bn+":"+Hi,tr=Ai[nn];tr===void 0&&(ri.push(Hi),Ai[nn]=tr=ri.length-1),Ze.writeVarint(tr)}}}function De(lt,Ze){return(Ze<<3)+(7&lt)}function $e(lt){return lt<<1^lt>>31}function Le(lt,Ze){for(var Mt=lt.loadGeometry(),ei=lt.type,ri=0,Si=0,Ai=Mt.length,Pi=0;Pi<Ai;Pi++){var Hi=Mt[Pi],zi=1;ei===1&&(zi=Hi.length),Ze.writeVarint(De(1,zi));for(var Bn=ei===3?Hi.length-1:Hi.length,nn=0;nn<Bn;nn++){nn===1&&ei!==1&&Ze.writeVarint(De(2,Bn-1));var tr=Hi[nn].x-ri,Tn=Hi[nn].y-Si;Ze.writeVarint($e(tr)),Ze.writeVarint($e(Tn)),ri+=tr,Si+=Tn}ei===3&&Ze.writeVarint(De(7,1))}}function He(lt,Ze){var Mt=typeof lt;Mt==="string"?Ze.writeStringField(1,lt):Mt==="boolean"?Ze.writeBooleanField(7,lt):Mt==="number"&&(lt%1!=0?Ze.writeDoubleField(3,lt):lt<0?Ze.writeSVarintField(6,lt):Ze.writeVarintField(5,lt))}return zt.exports=ne,zt.exports.fromVectorTileJs=ne,zt.exports.fromGeojsonVt=function(lt,Ze){Ze=Ze||{};var Mt={};for(var ei in lt)Mt[ei]=new te(lt[ei].features,Ze),Mt[ei].name=ei,Mt[ei].version=Ze.version,Mt[ei].extent=Ze.extent;return ne({layers:Mt})},zt.exports.GeoJSONWrapper=te,zt.exports}(),ln=r.fh(un);const Di={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:qe=>qe},Zi=Math.fround||(fn=new Float32Array(1),qe=>(fn[0]=+qe,fn[0]));var fn;const Ln=3,Xi=5,Hr=6;class js{constructor(te){this.options=Object.assign(Object.create(Di),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:ne,minZoom:ge,maxZoom:Ie}=this.options;ne&&console.time("total time");const we=`prepare ${te.length} points`;ne&&console.time(we),this.points=te;const De=[];for(let Le=0;Le<te.length;Le++){const He=te[Le];if(!He.geometry)continue;const[lt,Ze]=He.geometry.coordinates,Mt=Zi(_a(lt)),ei=Zi(Go(Ze));De.push(Mt,ei,1/0,Le,-1,1),this.options.reduce&&De.push(0)}let $e=this.trees[Ie+1]=this._createTree(De);ne&&console.timeEnd(we);for(let Le=Ie;Le>=ge;Le--){const He=+Date.now();$e=this.trees[Le]=this._createTree(this._cluster($e,Le)),ne&&console.log("z%d: %d clusters in %dms",Le,$e.numItems,+Date.now()-He)}return ne&&console.timeEnd("total time"),this}getClusters(te,ne){let ge=((te[0]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,te[1]));let we=te[2]===180?180:((te[2]+180)%360+360)%360-180;const De=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)ge=-180,we=180;else if(ge>we){const Ze=this.getClusters([ge,Ie,180,De],ne),Mt=this.getClusters([-180,Ie,we,De],ne);return Ze.concat(Mt)}const $e=this.trees[this._limitZoom(ne)],Le=$e.range(_a(ge),Go(De),_a(we),Go(Ie)),He=$e.data,lt=[];for(const Ze of Le){const Mt=this.stride*Ze;lt.push(He[Mt+Xi]>1?Rs(He,Mt,this.clusterProps):this.points[He[Mt+Ln]])}return lt}getChildren(te){const ne=this._getOriginId(te),ge=this._getOriginZoom(te),Ie="No cluster with the specified id.",we=this.trees[ge];if(!we)throw new Error(Ie);const De=we.data;if(ne*this.stride>=De.length)throw new Error(Ie);const $e=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),Le=we.within(De[ne*this.stride],De[ne*this.stride+1],$e),He=[];for(const lt of Le){const Ze=lt*this.stride;De[Ze+4]===te&&He.push(De[Ze+Xi]>1?Rs(De,Ze,this.clusterProps):this.points[De[Ze+Ln]])}if(He.length===0)throw new Error(Ie);return He}getLeaves(te,ne,ge){const Ie=[];return this._appendLeaves(Ie,te,ne=ne||10,ge=ge||0,0),Ie}getTile(te,ne,ge){const Ie=this.trees[this._limitZoom(te)],we=Math.pow(2,te),{extent:De,radius:$e}=this.options,Le=$e/De,He=(ge-Le)/we,lt=(ge+1+Le)/we,Ze={features:[]};return this._addTileFeatures(Ie.range((ne-Le)/we,He,(ne+1+Le)/we,lt),Ie.data,ne,ge,we,Ze),ne===0&&this._addTileFeatures(Ie.range(1-Le/we,He,1,lt),Ie.data,we,ge,we,Ze),ne===we-1&&this._addTileFeatures(Ie.range(0,He,Le/we,lt),Ie.data,-1,ge,we,Ze),Ze.features.length?Ze:null}getClusterExpansionZoom(te){let ne=this._getOriginZoom(te)-1;for(;ne<=this.options.maxZoom;){const ge=this.getChildren(te);if(ne++,ge.length!==1)break;te=ge[0].properties.cluster_id}return ne}_appendLeaves(te,ne,ge,Ie,we){const De=this.getChildren(ne);for(const $e of De){const Le=$e.properties;if(Le&&Le.cluster?we+Le.point_count<=Ie?we+=Le.point_count:we=this._appendLeaves(te,Le.cluster_id,ge,Ie,we):we<Ie?we++:te.push($e),te.length===ge)break}return we}_createTree(te){const ne=new r.bW(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<te.length;ge+=this.stride)ne.add(te[ge],te[ge+1]);return ne.finish(),ne.data=te,ne}_addTileFeatures(te,ne,ge,Ie,we,De){for(const $e of te){const Le=$e*this.stride,He=ne[Le+Xi]>1;let lt,Ze,Mt;if(He)lt=xr(ne,Le,this.clusterProps),Ze=ne[Le],Mt=ne[Le+1];else{const Si=this.points[ne[Le+Ln]];lt=Si.properties;const[Ai,Pi]=Si.geometry.coordinates;Ze=_a(Ai),Mt=Go(Pi)}const ei={type:1,geometry:[[Math.round(this.options.extent*(Ze*we-ge)),Math.round(this.options.extent*(Mt*we-Ie))]],tags:lt};let ri;ri=He||this.options.generateId?ne[Le+Ln]:this.points[ne[Le+Ln]].id,ri!==void 0&&(ei.id=ri),De.features.push(ei)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,ne){const{radius:ge,extent:Ie,reduce:we,minPoints:De}=this.options,$e=ge/(Ie*Math.pow(2,ne)),Le=te.data,He=[],lt=this.stride;for(let Ze=0;Ze<Le.length;Ze+=lt){if(Le[Ze+2]<=ne)continue;Le[Ze+2]=ne;const Mt=Le[Ze],ei=Le[Ze+1],ri=te.within(Le[Ze],Le[Ze+1],$e),Si=Le[Ze+Xi];let Ai=Si;for(const Pi of ri){const Hi=Pi*lt;Le[Hi+2]>ne&&(Ai+=Le[Hi+Xi])}if(Ai>Si&&Ai>=De){let Pi,Hi=Mt*Si,zi=ei*Si,Bn=-1;const nn=(Ze/lt<<5)+(ne+1)+this.points.length;for(const tr of ri){const Tn=tr*lt;if(Le[Tn+2]<=ne)continue;Le[Tn+2]=ne;const xn=Le[Tn+Xi];Hi+=Le[Tn]*xn,zi+=Le[Tn+1]*xn,Le[Tn+4]=nn,we&&(Pi||(Pi=this._map(Le,Ze,!0),Bn=this.clusterProps.length,this.clusterProps.push(Pi)),we(Pi,this._map(Le,Tn)))}Le[Ze+4]=nn,He.push(Hi/Ai,zi/Ai,1/0,nn,-1,Ai),we&&He.push(Bn)}else{for(let Pi=0;Pi<lt;Pi++)He.push(Le[Ze+Pi]);if(Ai>1)for(const Pi of ri){const Hi=Pi*lt;if(!(Le[Hi+2]<=ne)){Le[Hi+2]=ne;for(let zi=0;zi<lt;zi++)He.push(Le[Hi+zi])}}}}return He}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,ne,ge){if(te[ne+Xi]>1){const De=this.clusterProps[te[ne+Hr]];return ge?Object.assign({},De):De}const Ie=this.points[te[ne+Ln]].properties,we=this.options.map(Ie);return ge&&we===Ie?Object.assign({},we):we}}function Rs(qe,te,ne){return{type:"Feature",id:qe[te+Ln],properties:xr(qe,te,ne),geometry:{type:"Point",coordinates:[(ge=qe[te],360*(ge-.5)),ls(qe[te+1])]}};var ge}function xr(qe,te,ne){const ge=qe[te+Xi],Ie=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,we=qe[te+Hr],De=we===-1?{}:Object.assign({},ne[we]);return Object.assign(De,{cluster:!0,cluster_id:qe[te+Ln],point_count:ge,point_count_abbreviated:Ie})}function _a(qe){return qe/360+.5}function Go(qe){const te=Math.sin(qe*Math.PI/180),ne=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ne<0?0:ne>1?1:ne}function ls(qe){const te=(180-360*qe)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function ia(qe,te,ne,ge){let Ie=ge;const we=te+(ne-te>>1);let De,$e=ne-te;const Le=qe[te],He=qe[te+1],lt=qe[ne],Ze=qe[ne+1];for(let Mt=te+3;Mt<ne;Mt+=3){const ei=pu(qe[Mt],qe[Mt+1],Le,He,lt,Ze);if(ei>Ie)De=Mt,Ie=ei;else if(ei===Ie){const ri=Math.abs(Mt-we);ri<$e&&(De=Mt,$e=ri)}}Ie>ge&&(De-te>3&&ia(qe,te,De,ge),qe[De+2]=Ie,ne-De>3&&ia(qe,De,ne,ge))}function pu(qe,te,ne,ge,Ie,we){let De=Ie-ne,$e=we-ge;if(De!==0||$e!==0){const Le=((qe-ne)*De+(te-ge)*$e)/(De*De+$e*$e);Le>1?(ne=Ie,ge=we):Le>0&&(ne+=De*Le,ge+=$e*Le)}return De=qe-ne,$e=te-ge,De*De+$e*$e}function vs(qe,te,ne,ge){const Ie={id:qe??null,type:te,geometry:ne,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(te==="Point"||te==="MultiPoint"||te==="LineString")ws(Ie,ne);else if(te==="Polygon")ws(Ie,ne[0]);else if(te==="MultiLineString")for(const we of ne)ws(Ie,we);else if(te==="MultiPolygon")for(const we of ne)ws(Ie,we[0]);return Ie}function ws(qe,te){for(let ne=0;ne<te.length;ne+=3)qe.minX=Math.min(qe.minX,te[ne]),qe.minY=Math.min(qe.minY,te[ne+1]),qe.maxX=Math.max(qe.maxX,te[ne]),qe.maxY=Math.max(qe.maxY,te[ne+1])}function ko(qe,te,ne,ge){if(!te.geometry)return;const Ie=te.geometry.coordinates;if(Ie&&Ie.length===0)return;const we=te.geometry.type,De=Math.pow(ne.tolerance/((1<<ne.maxZoom)*ne.extent),2);let $e=[],Le=te.id;if(ne.promoteId?Le=te.properties[ne.promoteId]:ne.generateId&&(Le=ge||0),we==="Point")ya(Ie,$e);else if(we==="MultiPoint")for(const He of Ie)ya(He,$e);else if(we==="LineString")Ja(Ie,$e,De,!1);else if(we==="MultiLineString"){if(ne.lineMetrics){for(const He of Ie)$e=[],Ja(He,$e,De,!1),qe.push(vs(Le,"LineString",$e,te.properties));return}ks(Ie,$e,De,!1)}else if(we==="Polygon")ks(Ie,$e,De,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(const He of te.geometry.geometries)ko(qe,{id:Le,geometry:He,properties:te.properties},ne,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const He of Ie){const lt=[];ks(He,lt,De,!0),$e.push(lt)}}qe.push(vs(Le,we,$e,te.properties))}function ya(qe,te){te.push(gc(qe[0]),_c(qe[1]),0)}function Ja(qe,te,ne,ge){let Ie,we,De=0;for(let Le=0;Le<qe.length;Le++){const He=gc(qe[Le][0]),lt=_c(qe[Le][1]);te.push(He,lt,0),Le>0&&(De+=ge?(Ie*lt-He*we)/2:Math.sqrt(Math.pow(He-Ie,2)+Math.pow(lt-we,2))),Ie=He,we=lt}const $e=te.length-3;te[2]=1,ia(te,0,$e,ne),te[$e+2]=1,te.size=Math.abs(De),te.start=0,te.end=te.size}function ks(qe,te,ne,ge){for(let Ie=0;Ie<qe.length;Ie++){const we=[];Ja(qe[Ie],we,ne,ge),te.push(we)}}function gc(qe){return qe/360+.5}function _c(qe){const te=Math.sin(qe*Math.PI/180),ne=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ne<0?0:ne>1?1:ne}function Vs(qe,te,ne,ge,Ie,we,De,$e){if(ge/=te,we>=(ne/=te)&&De<ge)return qe;if(De<ne||we>=ge)return null;const Le=[];for(const He of qe){const lt=He.geometry;let Ze=He.type;const Mt=Ie===0?He.minX:He.minY,ei=Ie===0?He.maxX:He.maxY;if(Mt>=ne&&ei<ge){Le.push(He);continue}if(ei<ne||Mt>=ge)continue;let ri=[];if(Ze==="Point"||Ze==="MultiPoint")Al(lt,ri,ne,ge,Ie);else if(Ze==="LineString")xa(lt,ri,ne,ge,Ie,!1,$e.lineMetrics);else if(Ze==="MultiLineString")Wr(lt,ri,ne,ge,Ie,!1);else if(Ze==="Polygon")Wr(lt,ri,ne,ge,Ie,!0);else if(Ze==="MultiPolygon")for(const Si of lt){const Ai=[];Wr(Si,Ai,ne,ge,Ie,!0),Ai.length&&ri.push(Ai)}if(ri.length){if($e.lineMetrics&&Ze==="LineString"){for(const Si of ri)Le.push(vs(He.id,Ze,Si,He.tags));continue}Ze!=="LineString"&&Ze!=="MultiLineString"||(ri.length===1?(Ze="LineString",ri=ri[0]):Ze="MultiLineString"),Ze!=="Point"&&Ze!=="MultiPoint"||(Ze=ri.length===3?"Point":"MultiPoint"),Le.push(vs(He.id,Ze,ri,He.tags))}}return Le.length?Le:null}function Al(qe,te,ne,ge,Ie){for(let we=0;we<qe.length;we+=3){const De=qe[we+Ie];De>=ne&&De<=ge&&$o(te,qe[we],qe[we+1],qe[we+2])}}function xa(qe,te,ne,ge,Ie,we,De){let $e=va(qe);const Le=Ie===0?Il:Qa;let He,lt,Ze=qe.start;for(let Ai=0;Ai<qe.length-3;Ai+=3){const Pi=qe[Ai],Hi=qe[Ai+1],zi=qe[Ai+2],Bn=qe[Ai+3],nn=qe[Ai+4],tr=Ie===0?Pi:Hi,Tn=Ie===0?Bn:nn;let xn=!1;De&&(He=Math.sqrt(Math.pow(Pi-Bn,2)+Math.pow(Hi-nn,2))),tr<ne?Tn>ne&&(lt=Le($e,Pi,Hi,Bn,nn,ne),De&&($e.start=Ze+He*lt)):tr>ge?Tn<ge&&(lt=Le($e,Pi,Hi,Bn,nn,ge),De&&($e.start=Ze+He*lt)):$o($e,Pi,Hi,zi),Tn<ne&&tr>=ne&&(lt=Le($e,Pi,Hi,Bn,nn,ne),xn=!0),Tn>ge&&tr<=ge&&(lt=Le($e,Pi,Hi,Bn,nn,ge),xn=!0),!we&&xn&&(De&&($e.end=Ze+He*lt),te.push($e),$e=va(qe)),De&&(Ze+=He)}let Mt=qe.length-3;const ei=qe[Mt],ri=qe[Mt+1],Si=Ie===0?ei:ri;Si>=ne&&Si<=ge&&$o($e,ei,ri,qe[Mt+2]),Mt=$e.length-3,we&&Mt>=3&&($e[Mt]!==$e[0]||$e[Mt+1]!==$e[1])&&$o($e,$e[0],$e[1],$e[2]),$e.length&&te.push($e)}function va(qe){const te=[];return te.size=qe.size,te.start=qe.start,te.end=qe.end,te}function Wr(qe,te,ne,ge,Ie,we){for(const De of qe)xa(De,te,ne,ge,Ie,we,!1)}function $o(qe,te,ne,ge){qe.push(te,ne,ge)}function Il(qe,te,ne,ge,Ie,we){const De=(we-te)/(ge-te);return $o(qe,we,ne+(Ie-ne)*De,1),De}function Qa(qe,te,ne,ge,Ie,we){const De=(we-ne)/(Ie-ne);return $o(qe,te+(ge-te)*De,we,1),De}function yc(qe,te){const ne=[];for(let ge=0;ge<qe.length;ge++){const Ie=qe[ge],we=Ie.type;let De;if(we==="Point"||we==="MultiPoint"||we==="LineString")De=wa(Ie.geometry,te);else if(we==="MultiLineString"||we==="Polygon"){De=[];for(const $e of Ie.geometry)De.push(wa($e,te))}else if(we==="MultiPolygon"){De=[];for(const $e of Ie.geometry){const Le=[];for(const He of $e)Le.push(wa(He,te));De.push(Le)}}ne.push(vs(Ie.id,we,De,Ie.tags))}return ne}function wa(qe,te){const ne=[];ne.size=qe.size,qe.start!==void 0&&(ne.start=qe.start,ne.end=qe.end);for(let ge=0;ge<qe.length;ge+=3)ne.push(qe[ge]+te,qe[ge+1],qe[ge+2]);return ne}function Pl(qe,te){if(qe.transformed)return qe;const ne=1<<qe.z,ge=qe.x,Ie=qe.y;for(const we of qe.features){const De=we.geometry,$e=we.type;if(we.geometry=[],$e===1)for(let Le=0;Le<De.length;Le+=2)we.geometry.push(Zn(De[Le],De[Le+1],te,ne,ge,Ie));else for(let Le=0;Le<De.length;Le++){const He=[];for(let lt=0;lt<De[Le].length;lt+=2)He.push(Zn(De[Le][lt],De[Le][lt+1],te,ne,ge,Ie));we.geometry.push(He)}}return qe.transformed=!0,qe}function Zn(qe,te,ne,ge,Ie,we){return[Math.round(ne*(qe*ge-Ie)),Math.round(ne*(te*ge-we))]}function ba(qe,te,ne,ge,Ie){const we=te===Ie.maxZoom?0:Ie.tolerance/((1<<te)*Ie.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:qe.length,source:null,x:ne,y:ge,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const $e of qe)Ml(De,$e,we,Ie);return De}function Ml(qe,te,ne,ge){const Ie=te.geometry,we=te.type,De=[];if(qe.minX=Math.min(qe.minX,te.minX),qe.minY=Math.min(qe.minY,te.minY),qe.maxX=Math.max(qe.maxX,te.maxX),qe.maxY=Math.max(qe.maxY,te.maxY),we==="Point"||we==="MultiPoint")for(let $e=0;$e<Ie.length;$e+=3)De.push(Ie[$e],Ie[$e+1]),qe.numPoints++,qe.numSimplified++;else if(we==="LineString")cs(De,Ie,qe,ne,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(let $e=0;$e<Ie.length;$e++)cs(De,Ie[$e],qe,ne,we==="Polygon",$e===0);else if(we==="MultiPolygon")for(let $e=0;$e<Ie.length;$e++){const Le=Ie[$e];for(let He=0;He<Le.length;He++)cs(De,Le[He],qe,ne,!0,He===0)}if(De.length){let $e=te.tags||null;if(we==="LineString"&&ge.lineMetrics){$e={};for(const He in te.tags)$e[He]=te.tags[He];$e.mapbox_clip_start=Ie.start/Ie.size,$e.mapbox_clip_end=Ie.end/Ie.size}const Le={geometry:De,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:$e};te.id!==null&&(Le.id=te.id),qe.features.push(Le)}}function cs(qe,te,ne,ge,Ie,we){const De=ge*ge;if(ge>0&&te.size<(Ie?De:ge))return void(ne.numPoints+=te.length/3);const $e=[];for(let Le=0;Le<te.length;Le+=3)(ge===0||te[Le+2]>De)&&(ne.numSimplified++,$e.push(te[Le],te[Le+1])),ne.numPoints++;Ie&&function(Le,He){let lt=0;for(let Ze=0,Mt=Le.length,ei=Mt-2;Ze<Mt;ei=Ze,Ze+=2)lt+=(Le[Ze]-Le[ei])*(Le[Ze+1]+Le[ei+1]);if(lt>0===He)for(let Ze=0,Mt=Le.length;Ze<Mt/2;Ze+=2){const ei=Le[Ze],ri=Le[Ze+1];Le[Ze]=Le[Mt-2-Ze],Le[Ze+1]=Le[Mt-1-Ze],Le[Mt-2-Ze]=ei,Le[Mt-1-Ze]=ri}}($e,we),qe.push($e)}const Rl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class hh{constructor(te,ne){const ge=(ne=this.options=function(we,De){for(const $e in De)we[$e]=De[$e];return we}(Object.create(Rl),ne)).debug;if(ge&&console.time("preprocess data"),ne.maxZoom<0||ne.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ne.promoteId&&ne.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ie=function(we,De){const $e=[];if(we.type==="FeatureCollection")for(let Le=0;Le<we.features.length;Le++)ko($e,we.features[Le],De,Le);else ko($e,we.type==="Feature"?we:{geometry:we},De);return $e}(te,ne);this.tiles={},this.tileCoords=[],ge&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ne.indexMaxZoom,ne.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ie=function(we,De){const $e=De.buffer/De.extent;let Le=we;const He=Vs(we,1,-1-$e,$e,0,-1,2,De),lt=Vs(we,1,1-$e,2+$e,0,-1,2,De);return(He||lt)&&(Le=Vs(we,1,-$e,1+$e,0,-1,2,De)||[],He&&(Le=yc(He,1).concat(Le)),lt&&(Le=Le.concat(yc(lt,-1)))),Le}(Ie,ne),Ie.length&&this.splitTile(Ie,0,0,0),ge&&(Ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(te,ne,ge,Ie,we,De,$e){const Le=[te,ne,ge,Ie],He=this.options,lt=He.debug;for(;Le.length;){Ie=Le.pop(),ge=Le.pop(),ne=Le.pop(),te=Le.pop();const Ze=1<<ne,Mt=kl(ne,ge,Ie);let ei=this.tiles[Mt];if(!ei&&(lt>1&&console.time("creation"),ei=this.tiles[Mt]=ba(te,ne,ge,Ie,He),this.tileCoords.push({z:ne,x:ge,y:Ie}),lt)){lt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ne,ge,Ie,ei.numFeatures,ei.numPoints,ei.numSimplified),console.timeEnd("creation"));const xn=`z${ne}`;this.stats[xn]=(this.stats[xn]||0)+1,this.total++}if(ei.source=te,we==null){if(ne===He.indexMaxZoom||ei.numPoints<=He.indexMaxPoints)continue}else{if(ne===He.maxZoom||ne===we)continue;if(we!=null){const xn=we-ne;if(ge!==De>>xn||Ie!==$e>>xn)continue}}if(ei.source=null,te.length===0)continue;lt>1&&console.time("clipping");const ri=.5*He.buffer/He.extent,Si=.5-ri,Ai=.5+ri,Pi=1+ri;let Hi=null,zi=null,Bn=null,nn=null,tr=Vs(te,Ze,ge-ri,ge+Ai,0,ei.minX,ei.maxX,He),Tn=Vs(te,Ze,ge+Si,ge+Pi,0,ei.minX,ei.maxX,He);te=null,tr&&(Hi=Vs(tr,Ze,Ie-ri,Ie+Ai,1,ei.minY,ei.maxY,He),zi=Vs(tr,Ze,Ie+Si,Ie+Pi,1,ei.minY,ei.maxY,He),tr=null),Tn&&(Bn=Vs(Tn,Ze,Ie-ri,Ie+Ai,1,ei.minY,ei.maxY,He),nn=Vs(Tn,Ze,Ie+Si,Ie+Pi,1,ei.minY,ei.maxY,He),Tn=null),lt>1&&console.timeEnd("clipping"),Le.push(Hi||[],ne+1,2*ge,2*Ie),Le.push(zi||[],ne+1,2*ge,2*Ie+1),Le.push(Bn||[],ne+1,2*ge+1,2*Ie),Le.push(nn||[],ne+1,2*ge+1,2*Ie+1)}}getTile(te,ne,ge){te=+te,ne=+ne,ge=+ge;const Ie=this.options,{extent:we,debug:De}=Ie;if(te<0||te>24)return null;const $e=1<<te,Le=kl(te,ne=ne+$e&$e-1,ge);if(this.tiles[Le])return Pl(this.tiles[Le],we);De>1&&console.log("drilling down to z%d-%d-%d",te,ne,ge);let He,lt=te,Ze=ne,Mt=ge;for(;!He&&lt>0;)lt--,Ze>>=1,Mt>>=1,He=this.tiles[kl(lt,Ze,Mt)];return He&&He.source?(De>1&&(console.log("found parent tile z%d-%d-%d",lt,Ze,Mt),console.time("drilling down")),this.splitTile(He.source,lt,Ze,Mt,te,ne,ge),De>1&&console.timeEnd("drilling down"),this.tiles[Le]?Pl(this.tiles[Le],we):null):null}}function kl(qe,te,ne){return 32*((1<<qe)*ne+te)+qe}function Rt(qe,te){const ne=qe.tileID.canonical;if(!this._geoJSONIndex)return void te(null,null);const ge=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!ge)return void te(null,null);const Ie=Le=>Le.tags&&"3d_elevation_id"in Le.tags&&"source"in Le.tags&&Le.tags.source==="elevation",we=ge.features.filter(Le=>Ie(Le));let De;if(we.length>0){const Le=ge.features.filter(He=>!Ie(He));De=new Yt({_geojsonTileLayer:Le,hd_road_elevation:we})}else De=new di(ge.features);let $e=ln(De);$e.byteOffset===0&&$e.byteLength===$e.buffer.byteLength||($e=new Uint8Array($e)),te(null,{vectorTile:De,rawData:$e.buffer})}class Ta extends ce{constructor(te,ne,ge,Ie,we,De,$e){super(te,ne,ge,Ie,we,Rt,$e),De&&(this.loadGeoJSON=De),this._dynamicIndex=new Ht}loadData(te,ne){const ge=te&&te.request,Ie=ge&&ge.collectResourceTiming;this.loadGeoJSON(te,(we,De)=>{if(we||!De)return ne(we);if(typeof De!="object")return ne(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{try{if(te.filter){const Le=r.X(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Le.result==="error")throw new Error(Le.value.map(He=>`${He.key}: ${He.message}`).join(", "));De.features=De.features.filter(He=>Le.value.evaluate({zoom:0},He))}te.dynamic?(De.type==="Feature"&&(De={type:"FeatureCollection",features:[De]}),te.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(De.features,this.loaded),te.cluster&&(De.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=te.cluster?new js(function({superclusterOptions:Le,clusterProperties:He}){if(!He||!Le)return Le;const lt={},Ze={},Mt={accumulated:null,zoom:0},ei={properties:null},ri=Object.keys(He);for(const Si of ri){const[Ai,Pi]=He[Si],Hi=r.X(Pi),zi=r.X(typeof Ai=="string"?[Ai,["accumulated"],["get",Si]]:Ai);lt[Si]=Hi.value,Ze[Si]=zi.value}return Le.map=Si=>{ei.properties=Si;const Ai={};for(const Pi of ri)Ai[Pi]=lt[Pi].evaluate(Mt,ei);return Ai},Le.reduce=(Si,Ai)=>{ei.properties=Ai;for(const Pi of ri)Mt.accumulated=Si[Pi],Si[Pi]=Ze[Pi].evaluate(Mt,ei)},Le}(te)).load(De.features):te.dynamic?this._dynamicIndex:function(Le,He){return new hh(Le,He)}(De,te.geojsonVtOptions)}catch(Le){return ne(Le)}const $e={};if(Ie){const Le=U(ge);Le&&($e.resourceTiming={},$e.resourceTiming[te.source]=JSON.parse(JSON.stringify(Le)))}ne(null,$e)}})}reloadTile(te,ne){const ge=this.loaded;return ge&&ge[te.uid]?te.partial?ne(null,void 0):super.reloadTile(te,ne):this.loadTile(te,ne)}loadGeoJSON(te,ne){if(te.request)r.n(te.request,ne);else{if(typeof te.data!="string")return ne(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));try{return ne(null,JSON.parse(te.data))}catch{return ne(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(te,ne){try{ne(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(ge){ne(ge)}}getClusterChildren(te,ne){try{ne(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(ge){ne(ge)}}getClusterLeaves(te,ne){try{ne(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(ge){ne(ge)}}}class md{constructor(te,ne,ge){this.tileID=new r.aM(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=te.projection,this.brightness=ne,this.worldview=ge}parse(te,ne,ge,Ie){this.status="parsing";const we=new r.aM(ge.tileID.overscaledZ,ge.tileID.wrap,ge.tileID.canonical.z,ge.tileID.canonical.x,ge.tileID.canonical.y),De=[],$e=ne.familiesBySource[ge.source],Le=new r.f0(we,ge.promoteId);Le.bucketLayerIDs=[],Le.is3DTile=!0,r.fi(te).then(He=>{if(!He)return Ie(new Error("Could not parse tile"));const lt=He.json.extensionsUsed&&He.json.extensionsUsed.includes("MAPBOX_mesh_features")||He.json.asset.extras&&He.json.asset.extras.MAPBOX_mesh_features,Ze=He.json.extensionsUsed&&He.json.extensionsUsed.includes("EXT_meshopt_compression"),Mt=new r.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const ei in $e)for(const ri of $e[ei]){const Si=ri[0];Le.bucketLayerIDs.push(ri.map(Hi=>r.C(Hi.id,Hi.scope))),Si.recalculate(Mt,[]);const Ai=r.fj(He,1/r.cU(ge.tileID.canonical)),Pi=new r.fk(ri,Ai,we,lt,Ze,this.brightness,Le,this.worldview);lt||(Pi.needsUpload=!0),De.push(Pi),Pi.evaluate(Si)}this.status="done",Ie(null,{buckets:De,featureIndex:Le,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(He=>Ie(new Error(He.message)))}}class xc{constructor(te,ne,ge,Ie,we,De,$e,Le){this.actor=te,this.layerIndex=ne,this.availableImages=ge,this.availableModels=Ie,this.brightness=$e,this.loading={},this.loaded={},this.worldview=Le}loadTile(te,ne){const ge=te.uid,Ie=this.loading[ge]=new md(te,this.brightness,this.worldview);r.br(te.request,(we,De)=>{const $e=!this.loading[ge];return delete this.loading[ge],$e||we?(Ie.status="done",$e||(this.loaded[ge]=Ie),ne(we)):De&&De.byteLength!==0?void Ie.parse(De,this.layerIndex,te,(Le,He)=>{Ie.status="done",this.loaded=this.loaded||{},this.loaded[ge]=Ie,Le||!He?ne(Le):ne(null,He)}):(Ie.status="done",this.loaded[ge]=Ie,ne())})}reloadTile(te,ne){const ge=this.loaded,Ie=te.uid;if(ge&&ge[Ie]){const we=ge[Ie];we.projection=te.projection,we.brightness=te.brightness;const De=($e,Le)=>{we.reloadCallback&&(delete we.reloadCallback,this.loadTile(te,ne)),ne($e,Le)};we.status==="parsing"?we.reloadCallback=De:we.status==="done"&&this.loadTile(te,ne)}}abortTile(te,ne){const ge=te.uid;this.loading[ge]&&delete this.loading[ge],ne()}removeTile(te,ne){const ge=this.loaded,Ie=te.uid;ge&&ge[Ie]&&delete ge[Ie],ne()}}class _n{constructor(te){this.self=te,this.actor=new r.fm(te,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new r.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=r.ce({name:"mercator"}),this.workerSourceTypes={vector:ce,geojson:Ta,"raster-dem":ze,"raster-array":pt,"batched-model":xc},this.workerSources={},this.self.registerWorkerSource=(ne,ge)=>{if(this.workerSourceTypes[ne])throw new Error(`Worker source with name "${ne}" already registered.`);this.workerSourceTypes[ne]=ge},this.self.registerRTLTextPlugin=ne=>{if(r.fn.isParsed())throw new Error("RTL text plugin already registered.");r.fn.setState({pluginStatus:r.fo.parsed,pluginURL:r.fn.getPluginURL()}),r.fn.applyArabicShaping=ne.applyArabicShaping,r.fn.processBidirectionalText=ne.processBidirectionalText,r.fn.processStyledBidirectionalText=ne.processStyledBidirectionalText;for(const ge of this.rtlPluginParsingListeners)ge(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(te,ne,ge){delete this.layerIndexes[te],delete this.availableImages[te],delete this.availableModels[te],delete this.workerSources[te],ge()}checkIfReady(te,ne,ge){ge()}setReferrer(te,ne){this.referrer=ne}spriteLoaded(te,ne){this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={});const{scope:ge,isLoaded:Ie}=ne;if(this.isSpriteLoaded[te][ge]=Ie,this.workerSources[te]&&this.workerSources[te][ge])for(const we in this.workerSources[te][ge]){const De=this.workerSources[te][ge][we];for(const $e in De){const Le=De[$e];Le instanceof ce&&(Le.isSpriteLoaded=Ie,Le.fire(new r.A("isSpriteLoaded")))}}}setImages(te,ne,ge){this.availableImages[te]||(this.availableImages[te]={});const{scope:Ie,images:we}=ne;if(this.availableImages[te][Ie]=we,this.workerSources[te]&&this.workerSources[te][Ie]){for(const De in this.workerSources[te][Ie]){const $e=this.workerSources[te][Ie][De];for(const Le in $e)$e[Le].availableImages=we}ge()}else ge()}setModels(te,{scope:ne,models:ge},Ie){if(this.availableModels[te]||(this.availableModels[te]={}),this.availableModels[te][ne]=ge,this.workerSources[te]&&this.workerSources[te][ne]){for(const we in this.workerSources[te][ne]){const De=this.workerSources[te][ne][we];for(const $e in De)De[$e].availableModels=ge}Ie()}else Ie()}setProjection(te,ne){this.projections[te]=r.ce(ne)}setBrightness(te,ne,ge){this.brightness=ne,ge()}setWorldview(te,ne,ge){this.worldview=ne,ge()}setLayers(te,ne,ge){this.getLayerIndex(te,ne.scope).replace(ne.layers,ne.options),ge()}updateLayers(te,ne,ge){this.getLayerIndex(te,ne.scope).update(ne.layers,ne.removedIds,ne.options),ge()}loadTile(te,ne,ge){ne.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,ne.type,ne.source,ne.scope).loadTile(ne,ge)}decodeRasterArray(te,ne,ge){this.getWorkerSource(te,ne.type,ne.source,ne.scope).decodeRasterArray(ne,ge)}reloadTile(te,ne,ge){ne.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,ne.type,ne.source,ne.scope).reloadTile(ne,ge)}abortTile(te,ne,ge){this.getWorkerSource(te,ne.type,ne.source,ne.scope).abortTile(ne,ge)}removeTile(te,ne,ge){this.getWorkerSource(te,ne.type,ne.source,ne.scope).removeTile(ne,ge)}removeSource(te,ne,ge){if(!(this.workerSources[te]&&this.workerSources[te][ne.scope]&&this.workerSources[te][ne.scope][ne.type]&&this.workerSources[te][ne.scope][ne.type][ne.source]))return;const Ie=this.workerSources[te][ne.scope][ne.type][ne.source];delete this.workerSources[te][ne.scope][ne.type][ne.source],Ie.removeSource!==void 0?Ie.removeSource(ne,ge):ge()}loadWorkerSource(te,ne,ge){try{this.self.importScripts(ne.url),ge()}catch(Ie){ge(Ie.toString())}}syncRTLPluginState(te,ne,ge){if(r.fn.isParsed())ge(null,!0);else if(r.fn.isParsing())this.rtlPluginParsingListeners.push(ge);else try{r.fn.setState(ne);const Ie=r.fn.getPluginURL();!r.fn.isLoaded()||r.fn.isParsed()||r.fn.isParsing()||Ie==null||(r.fn.setState({pluginStatus:r.fo.parsing,pluginURL:r.fn.getPluginURL()}),this.self.importScripts(Ie),r.fn.isParsed()?ge(null,!0):this.rtlPluginParsingListeners.push(ge))}catch(Ie){ge(Ie.toString())}}setDracoUrl(te,ne){this.dracoUrl=ne}getAvailableImages(te,ne){this.availableImages[te]||(this.availableImages[te]={});let ge=this.availableImages[te][ne];return ge||(ge=[]),ge}getAvailableModels(te,ne){this.availableModels[te]||(this.availableModels[te]={});let ge=this.availableModels[te][ne];return ge||(ge={}),ge}getLayerIndex(te,ne){this.layerIndexes[te]||(this.layerIndexes[te]={});let ge=this.layerIndexes[te][ne];return ge||(ge=this.layerIndexes[te][ne]=new se,ge.scope=ne),ge}getWorkerSource(te,ne,ge,Ie){const we=this.workerSources;return we[te]||(we[te]={}),we[te][Ie]||(we[te][Ie]={}),we[te][Ie][ne]||(we[te][Ie][ne]={}),this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),we[te][Ie][ne][ge]||(we[te][Ie][ne][ge]=new this.workerSourceTypes[ne]({send:(De,$e,Le,He,lt,Ze)=>this.actor.send(De,$e,Le,te,lt,Ze),scheduler:this.actor.scheduler},this.getLayerIndex(te,Ie),this.getAvailableImages(te,Ie),this.getAvailableModels(te,Ie),this.isSpriteLoaded[te][Ie],void 0,this.brightness,this.worldview)),we[te][Ie][ne][ge]}rasterizeImagesWorker(te,ne,ge){const Ie=new Map;for(const[we,{image:De,imageVariant:$e}]of ne.tasks.entries()){const Le=this.imageRasterizer.rasterize($e,De,ne.scope,te);Ie.set(we,Le)}ge(void 0,Ie)}removeRasterizedImages(te,ne,ge){this.imageRasterizer.removeImagesFromCacheByIds(ne.imageIds,ne.scope,te),ge()}enforceCacheSizeLimit(te,ne){r.fp(ne)}getWorkerPerformanceMetrics(te,ne,ge){ge(void 0,void 0)}}return r.fl(self)&&(self.worker=new _n(self)),_n}),M(["./shared"],function(r){var U="3.13.0";const G={create:"create",load:"load",fullLoad:"fullLoad"},Q={mark(l){performance.mark(l)},measure(l,t,s){performance.measure(l,t,s)}};function se(l){const t=l.name.split("?")[0];return r.a(t)&&t.includes("mapbox-gl.js")?"javascript":r.a(t)&&t.includes("mapbox-gl.css")?"css":r.b(t)?"fontRange":r.c(t)?"sprite":r.i(t)?"style":r.d(t)?"tilejson":"other"}var de,Pe={},Se=function(){if(de)return Pe;function l(c){return!t(c)}function t(c){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,v,S=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(S);try{v=new Worker(A),_=!0}catch{_=!1}return v&&v.terminate(),URL.revokeObjectURL(A),_}()?function(){var _=document.createElement("canvas");_.width=_.height=1;var v=_.getContext("2d");if(!v)return!1;var S=v.getImageData(0,0,1,1);return S&&S.width===_.width}()?(s[m=c&&c.failIfMajorPerformanceCaveat]===void 0&&(s[m]=function(_){var v,S=function(A){var k=document.createElement("canvas"),L=Object.create(l.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=A,k.getContext("webgl2",L)}(_);if(!S)return!1;try{v=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!v||S.isContextLost())&&(S.shaderSource(v,"void main() {}"),S.compileShader(v),S.getShaderParameter(v,S.COMPILE_STATUS)===!0)}(m)),s[m]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var m}de=1,Pe.supported=l,Pe.notSupportedReason=t;var s={};return l.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Pe}();function ve(l,t,s){const c=document.createElement(l);return t!=null&&(c.className=t),s&&s.appendChild(c),c}function ce(l,t,s){const c=document.createElementNS("http://www.w3.org/2000/svg",l);for(const m of Object.keys(t))c.setAttributeNS(null,m,String(t[m]));return s&&s.appendChild(c),c}const ze=typeof document<"u"?document.documentElement&&document.documentElement.style:null,et=ze&&ze.userSelect!==void 0?"userSelect":"WebkitUserSelect";let pt;function Tt(){ze&&et&&(pt=ze[et],ze[et]="none")}function It(){ze&&et&&(ze[et]=pt)}function di(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",di,!0)}function Bt(){window.addEventListener("click",di,!0),window.setTimeout(()=>{window.removeEventListener("click",di,!0)},0)}function Yt(l,t){const s=l.getBoundingClientRect();return Ht(l,s,t)}function vt(l,t){const s=l.getBoundingClientRect(),c=[];for(let m=0;m<t.length;m++)c.push(Ht(l,s,t[m]));return c}function Jt(l){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&l.button===2&&l.ctrlKey?0:l.button}function Ht(l,t,s){const c=l.offsetWidth===t.width?1:l.offsetWidth/t.width;return new r.P((s.clientX-t.left)*c,(s.clientY-t.top)*c)}const Nt="01",Li="NO_ACCESS_TOKEN";class Dt{constructor(t,s,c){this._transformRequestFn=t,this._customAccessToken=s,this._silenceAuthErrors=!!c,this._createSkuToken()}_createSkuToken(){const t=function(){let s="";for(let c=0;c<10;c++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Nt,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeStyleURL(t,s){if(!r.j(t))return t;const c=yi(t);return c.params.push(`sdk=js-${U}`),c.path=`/styles/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||s)}normalizeGlyphsURL(t,s){if(!r.j(t))return t;const c=yi(t);return c.path=`/fonts/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||s)}normalizeModelURL(t,s){if(!r.j(t))return t;const c=yi(t);return c.path=`/models/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||s)}normalizeSourceURL(t,s,c,m){if(!r.j(t))return t;const _=yi(t);return _.path=`/v4/${_.authority}.json`,_.params.push("secure"),c&&_.params.push(`language=${c}`),m&&_.params.push(`worldview=${m}`),this._makeAPIURL(_,this._customAccessToken||s)}normalizeIconsetURL(t,s){const c=yi(t);return r.j(t)?(c.path=`/styles/v1${c.path}/iconset.pbf`,this._makeAPIURL(c,this._customAccessToken||s)):xi(c)}normalizeSpriteURL(t,s,c,m){const _=yi(t);return r.j(t)?(_.path=`/styles/v1${_.path}/sprite${s}${c}`,this._makeAPIURL(_,this._customAccessToken||m)):(_.path+=`${s}${c}`,xi(_))}normalizeTileURL(t,s,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!r.j(t))return t;const m=yi(t);m.path=m.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||c&&m.authority!=="raster"&&c===512?"@2x":""}${r.l.supported?".webp":"$1"}`),m.authority==="raster"?m.path=`/${r.e.RASTER_URL_PREFIX}${m.path}`:m.authority==="rasterarrays"?m.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${m.path}`:m.authority==="3dtiles"?m.path=`/${r.e.TILES3D_URL_PREFIX}${m.path}`:(m.path=m.path.replace(/^.+\/v4\//,"/"),m.path=`/${r.e.TILE_URL_VERSION}${m.path}`);const _=this._customAccessToken||function(v){for(const S of v){const A=S.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(m.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&_&&this._skuToken&&m.params.push(`sku=${this._skuToken}`),this._makeAPIURL(m,_)}canonicalizeTileURL(t,s){const c=yi(t);if(!c.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!c.path.match(/\.[\w]+$/))return t;let m="mapbox://";c.path.match(/^\/raster\/v1\//)?m+=`raster/${c.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:c.path.match(/^\/rasterarrays\/v1\//)?m+=`rasterarrays/${c.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:m+=`tiles/${c.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let _=c.params;return s&&(_=_.filter(v=>!v.match(/^access_token=/))),_.length&&(m+=`?${_.join("&")}`),m}canonicalizeTileset(t,s){const c=!!s&&r.j(s),m=[];for(const _ of t.tiles||[])r.k(_)?m.push(this.canonicalizeTileURL(_,c)):m.push(_);return m}_makeAPIURL(t,s){const c="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",m=yi(r.e.API_URL);if(t.protocol=m.protocol,t.authority=m.authority,t.protocol==="http"){const _=t.params.indexOf("secure");_>=0&&t.params.splice(_,1)}if(m.path!=="/"&&(t.path=`${m.path}${t.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return xi(t);if(s=s||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${c}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${c}`)}return t.params=t.params.filter(_=>_.indexOf("access_token")===-1),t.params.push(`access_token=${s||""}`),xi(t)}}const Ci=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function yi(l){const t=l.match(Ci);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function xi(l){const t=l.params.length?`?${l.params.join("&")}`:"";return`${l.protocol}://${l.authority}${l.path}${t}`}const $t="mapbox.eventData";function Ei(l){if(!l)return null;const t=l.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(r.m(t[1]))}catch{return null}}class Kt{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const s=Ei(r.e.ACCESS_TOKEN);let c="";return c=s&&s.u?r.f(s.u):r.e.ACCESS_TOKEN||"",t?`${$t}.${t}:${c}`:`${$t}:${c}`}fetchEventData(){const t=r.s("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(t)try{const m=localStorage.getItem(s);m&&(this.eventData=JSON.parse(m));const _=localStorage.getItem(c);_&&(this.anonId=_)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const t=r.s("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid"),m=this.anonId;if(t&&m)try{localStorage.setItem(c,m),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,s,c,m){if(!r.e.EVENTS_URL)return;const _=yi(r.e.EVENTS_URL);_.params.push(`access_token=${m||r.e.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(t).toISOString()},S=s?r.h(v,s):v,A={url:xi(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=r.p(A,k=>{this.pendingRequest=null,c(k),this.saveEventData(),this.processRequests(m)})}queueRequest(t,s){this.queue.push(t),this.processRequests(s)}}const Ue=new class extends Kt{constructor(l){super("appUserTurnstile"),this._customAccessToken=l}postTurnstileEvent(l,t){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(l)&&l.some(s=>r.j(s)||r.k(s))&&this.queueRequest(Date.now(),t)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Ei(r.e.ACCESS_TOKEN),s=t?t.u:r.e.ACCESS_TOKEN;let c=s!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),c=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),v=new Date(m),S=(m-this.eventData.lastSuccess)/864e5;c=c||S>=1||S<-1||_.getDate()!==v.getDate()}else c=!0;c?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:U,skuId:Nt,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=m,this.eventData.tokenU=s)},l):this.processRequests()}},zt=Ue.postTurnstileEvent.bind(Ue),un=new class extends Kt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(l,t,s,c){this.skuToken=t,this.errorCb=c,r.e.EVENTS_URL&&(s||r.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},s):this.errorCb(new Error(Li)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:U,skuId:Nt,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},l))}remove(){this.errorCb=null}},ln=un.postMapLoadEvent.bind(un),Di=new class extends Kt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(l){let t=this.mapInstanceIdMap.get(l);return t||(t=r.u(),this.mapInstanceIdMap.set(l,t)),t}getEventId(l){const t=this.eventIdPerMapInstanceMap.get(l)||0;return this.eventIdPerMapInstanceMap.set(l,t+1),t}postStyleLoadEvent(l,t){const{map:s,style:c,importedStyles:m}=t;if(!r.e.EVENTS_URL||!l&&!r.e.ACCESS_TOKEN)return;const _=this.getMapInstanceId(s),v={mapInstanceId:_,eventId:this.getEventId(_),style:c};m.length&&(v.importedStyles=m),this.queueRequest({timestamp:Date.now(),payload:v},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:s}=this.queue.shift();this.postEvent(t,s,()=>{},l)}},Zi=Di.postStyleLoadEvent.bind(Di),fn=new class extends Kt{constructor(){super("gljs.performance")}postPerformanceEvent(l,t){r.e.EVENTS_URL&&(l||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:s}=this.queue.shift(),c=function(m){const _=performance.getEntriesByType("resource"),v=performance.getEntriesByType("mark"),S=function(j){const X={};if(j){for(const W in j)if(W!=="other")for(const Y of j[W]){const J=`${W}ResolveRangeMin`,ie=`${W}ResolveRangeMax`,ue=`${W}RequestCount`,pe=`${W}RequestCachedCount`;X[J]=Math.min(X[J]||1/0,Y.startTime),X[ie]=Math.max(X[ie]||-1/0,Y.responseEnd);const be=Te=>{X[Te]===void 0&&(X[Te]=0),++X[Te]};Y.transferSize!==void 0&&Y.transferSize===0&&be(pe),be(ue)}}return X}(function(j,X){const W={};if(j)for(const Y of j){const J=X(Y);W[J]===void 0&&(W[J]=[]),W[J].push(Y)}return W}(_,se)),A=window.devicePixelRatio,k=navigator.connection||navigator.mozConnection||navigator.webkitConnection,L=k?k.effectiveType:void 0,B={counters:[],metadata:[],attributes:[]},O=(j,X,W)=>{W!=null&&j.push({name:X,value:W.toString()})};for(const j in S)O(B.counters,j,S[j]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(O(B.counters,"interactionRangeMin",m.interactionRange[0]),O(B.counters,"interactionRangeMax",m.interactionRange[1])),v)for(const j of Object.keys(G)){const X=G[j],W=v.find(Y=>Y.name===X);W&&O(B.counters,X,W.startTime)}return O(B.counters,"visibilityHidden",m.visibilityHidden),O(B.attributes,"style",function(j){if(j)for(const X of j){const W=X.name.split("?")[0];if(r.i(W)){const Y=W.split("/").slice(-2);if(Y.length===2)return`mapbox://styles/${Y[0]}/${Y[1]}`}}}(_)),O(B.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),O(B.attributes,"fogEnabled",m.fogEnabled?"true":"false"),O(B.attributes,"projection",m.projection),O(B.attributes,"zoom",m.zoom),O(B.metadata,"devicePixelRatio",A),O(B.metadata,"connectionEffectiveType",L),O(B.metadata,"navigatorUserAgent",navigator.userAgent),O(B.metadata,"screenWidth",window.screen.width),O(B.metadata,"screenHeight",window.screen.height),O(B.metadata,"windowWidth",window.innerWidth),O(B.metadata,"windowHeight",window.innerHeight),O(B.metadata,"mapWidth",m.width/A),O(B.metadata,"mapHeight",m.height/A),O(B.metadata,"webglRenderer",m.renderer),O(B.metadata,"webglVendor",m.vendor),O(B.metadata,"sdkVersion",U),O(B.metadata,"sdkIdentifier","mapbox-gl-js"),B}(s);for(const m of c.metadata);for(const m of c.counters);for(const m of c.attributes);this.postEvent(t,c,()=>{},l)}},Ln=fn.postPerformanceEvent.bind(fn),Xi=new class extends Kt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(l,t,s,c){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const m=yi(r.e.API_URL+r.e.SESSION_PATH);m.params.push(`sku=${t||""}`),m.params.push(`access_token=${c||r.e.ACCESS_TOKEN||""}`);const _={url:xi(m),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(_,v=>{this.pendingRequest=null,s(v),this.saveEventData(),this.processRequests(c)})}getSessionAPI(l,t,s,c){this.skuToken=t,this.errorCb=c,r.e.SESSION_PATH&&r.e.API_URL&&(s||r.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},s):this.errorCb(new Error(Li)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||this.getSession(s,this.skuToken,c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},l)}remove(){this.errorCb=null}},Hr=Xi.getSessionAPI.bind(Xi),js=new Set;function Rs(l,t){t?js.add(l):js.delete(l)}class xr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,s){this._updatedSourceCaches[t]=s,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const s=t.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(t.id),this.setDirty()}removeLayer(t){const s=t.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][t.id]=t,this._updatedLayers[s].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const s in this._updatedLayers)t[s]=t[s]||{},t[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)t[s]=t[s]||{},t[s].removedIds=Object.keys(this._removedLayers[s]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,s){this._updatedImages[s]=this._updatedImages[s]||new Set,this._updatedImages[s].add(r.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function _a(l){const{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class Go extends r.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&r.t()&&(this.imageRasterizerDispatcher=new r.D(r.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new r.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const s=this.atlasTexture.get(t);s&&(s.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,s){this.imageProviders.has(s)||this.imageProviders.set(s,new Map),this.imageProviders.get(s).set(t.id,t)}removeImageProvider(t,s){this.imageProviders.has(s)&&this.imageProviders.get(s).delete(t)}getPendingImageProviders(){const t=[];for(const s of this.imageProviders.values())for(const c of s.values())c.hasPendingRequests()&&t.push(c);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,s){if(this.loaded.get(s)!==t&&(this.loaded.set(s,t),t)){for(const{ids:c,callback:m}of this.requestors)this._notify(c,s,m);this.requestors=[]}}hasImage(t,s){return!!this.getImage(t,s)}getImage(t,s){return this.images.get(s).get(t.toString())}addImage(t,s,c){this._validate(t,c)&&this.images.get(s).set(t.toString(),c)}_validate(t,s){let c=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new r.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),c=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new r.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),c=!1),this._validateContent(s.content,s)||(this.fire(new r.z(new Error(`Image "${t.name}" has invalid "content" value`))),c=!1),c}_validateStretch(t,s){if(!t)return!0;let c=0;for(const m of t){if(m[0]<c||m[1]<m[0]||s<m[1])return!1;c=m[1]}return!0}_validateContent(t,s){return t?t.length!==4||!s.usvg&&(t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,s,c){const m=this.images.get(s).get(t.toString());c.version=m.version+1,this.images.get(s).set(t.toString(),c),this.updatedImages.get(s).add(t),this.removeFromImageRasterizerCache(t,s)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,s){this.spriteFormat!=="raster"&&(r.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:s}):this.imageRasterizer.removeImagesFromCacheByIds([t],s))}removeImage(t,s){const c=this.images.get(s),m=c.get(t.toString());c.delete(t.toString()),this.patterns.get(s).delete(t.toString()),this.removeFromImageRasterizerCache(t,s),m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(s=>r.I.from(s))}getImages(t,s,c){const m=[],_=[],v=this.imageProviders.get(s);for(const L of t){if(!L.iconsetId){m.push(L);continue}const B=v.get(L.iconsetId);B&&(this.getImage(L,s)?_.push(L):B.addPendingRequest(L))}if(m.length===0)return void this._notify(_,s,c);let S=!0;const A=!!this.loaded.get(s),k=this.images.get(s);if(!A)for(const L of m)k.has(L.toString())||(S=!1);A||S?this._notify(m,s,c):this.requestors.push({ids:m,scope:s,callback:c})}rasterizeImages(t,s){const c=new Map,{tasks:m,scope:_}=t;for(const[v,S]of m.entries()){const A=this.getImage(S.id,_);A&&c.set(v,{image:A,imageVariant:S})}this._rasterizeImages(_,c,s)}_rasterizeImages(t,s,c){if(r.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:s,scope:t},c);else{const m=new Map;for(const[_,{image:v,imageVariant:S}]of s.entries())m.set(_,this.imageRasterizer.rasterize(S,v,t,0));c(void 0,m)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,s,c){const m=this.images.get(s),_=new Map;for(const v of t){if(!m.get(v.toString())){if(v.iconsetId)continue;this.fire(new r.A("styleimagemissing",{id:v.name}))}const S=m.get(v.toString());if(!S){r.w(`Image "${v.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const A={data:S.usvg?null:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,usvg:S.usvg,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)};S.usvg&&Object.assign(A,{width:S.icon.usvg_tree.width,height:S.icon.usvg_tree.height}),_.set(r.I.toString(v),A)}c(null,_)}getPixelSize(t){const{width:s,height:c}=this.atlasImage.get(t);return{width:s,height:c}}getPattern(t,s,c){const m=t.toString(),_=this.patterns.get(s),v=_.get(m),S=this.getImage(t,s);if(!S)return null;if(v){if(v.position.version===S.version)return v.position;v.position.version=S.version}else{if(S.usvg&&!S.data){const A=this.getPatternInFlightId(m,s);if(this.patternsInFlight.has(A))return null;this.patternsInFlight.add(A);const k=new r.B(t).scaleSelf(r.q.devicePixelRatio),L=new Map([[k.toString(),{image:S,imageVariant:k}]]);return this._rasterizeImages(s,L,(B,O)=>this.storePatternImage(k,s,S,c,O)),null}this.storePattern(t,s,S)}return this._updatePatternAtlas(s,c),_.get(m).position}getPatternInFlightId(t,s){return r.C(t,s)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,s,c,m,_){const v=t.toString(),S=_?_.get(v):void 0;S&&(c.data=S,this.storePattern(t.id,s,c),this._updatePatternAtlas(s,m),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),s)))}storePattern(t,s,c){const m={w:c.data.width+2*r.F,h:c.data.height+2*r.F,x:0,y:0},_=new r.G(m,c,r.F);this.patterns.get(s).set(t.toString(),{bin:m,position:_})}bind(t,s){const c=t.gl;let m=this.atlasTexture.get(s);m?this.dirty&&(m.update(this.atlasImage.get(s)),this.dirty=!1):(m=new r.T(t,this.atlasImage.get(s),c.RGBA8),this.atlasTexture.set(s,m)),m.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(t,s){const c=this.patterns.get(t),m=Array.from(c.values()).map(({bin:k})=>k),{w:_,h:v}=r.H(m),S=this.atlasImage.get(t);S.resize({width:_||1,height:v||1});const A=this.images.get(t);for(const[k,{bin:L,position:B}]of c.entries()){let O=B.padding;const j=L.x+O,X=L.y+O,W=A.get(k).data,Y=W.width,J=W.height;O=O>1?O-1:O,r.r.copy(W,S,{x:0,y:0},{x:j,y:X},{width:Y,height:J},s),r.r.copy(W,S,{x:0,y:J-O},{x:j,y:X-O},{width:Y,height:O},s),r.r.copy(W,S,{x:0,y:0},{x:j,y:X+J},{width:Y,height:O},s),r.r.copy(W,S,{x:Y-O,y:0},{x:j-O,y:X},{width:O,height:J},s),r.r.copy(W,S,{x:0,y:0},{x:j+Y,y:X},{width:O,height:J},s),r.r.copy(W,S,{x:Y-O,y:J-O},{x:j-O,y:X-O},{width:O,height:O},s),r.r.copy(W,S,{x:0,y:J-O},{x:j+Y,y:X-O},{width:O,height:O},s),r.r.copy(W,S,{x:0,y:0},{x:j+Y,y:X+J},{width:O,height:O},s),r.r.copy(W,S,{x:Y-O,y:0},{x:j-O,y:X+J},{width:O,height:O},s)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,s){const c=this.images.get(s);for(const m of t){if(this.callbackDispatchedThisFrame.get(s).has(m.toString()))continue;this.callbackDispatchedThisFrame.get(s).add(m.toString());const _=c.get(m.toString());_a(_)&&this.updateImage(m,s,_)}}}function ls(l){const t=l.key,s=l.value,c=l.valueSpec||{},m=l.objectElementValidators||{},_=l.style,v=l.styleSpec;let S=[];const A=r.J(s);if(A!=="object")return[new r.V(t,s,`object expected, ${A} found`)];for(const k in s){const L=k.split(".")[0];let B;m[L]?B=m[L]:c[L]?B=Zn:m["*"]?B=m["*"]:c["*"]&&(B=Zn),B?S=S.concat(B({key:(t&&`${t}.`)+k,value:s[k],valueSpec:c[L]||c["*"],style:_,styleSpec:v,object:s,objectKey:k},s)):S.push(new r.K(t,s[k],`unknown property "${k}"`))}for(const k in c)m[k]||c[k].required&&c[k].default===void 0&&s[k]===void 0&&S.push(new r.V(t,s,`missing required property "${k}"`));return S}function ia(l){const t=l.value,s=l.valueSpec,c=l.style,m=l.styleSpec,_=l.key,v=l.arrayElementValidator||Zn;if(r.J(t)!=="array")return[new r.V(_,t,`array expected, ${r.J(t)} found`)];if(s.length&&t.length!==s.length)return[new r.V(_,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new r.V(_,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let S={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};m.$version<7&&(S.function=s.function),r.J(s.value)==="object"&&(S=s.value);let A=[];for(let k=0;k<t.length;k++)A=A.concat(v({array:t,arrayIndex:k,value:t[k],valueSpec:S,style:c,styleSpec:m,key:`${_}[${k}]`},!0));return A}function pu(l){const t=l.key,s=l.value,c=l.valueSpec;let m=r.J(s);if(m==="number"&&s!=s&&(m="NaN"),m!=="number")return[new r.V(t,s,`number expected, ${m} found`)];if("minimum"in c){let _=c.minimum;if(r.J(c.minimum)==="array"&&(_=c.minimum[l.arrayIndex]),s<_)return[new r.V(t,s,`${s} is less than the minimum value ${_}`)]}if("maximum"in c){let _=c.maximum;if(r.J(c.maximum)==="array"&&(_=c.maximum[l.arrayIndex]),s>_)return[new r.V(t,s,`${s} is greater than the maximum value ${_}`)]}return[]}function vs(l){const t=l.valueSpec,s=r.M(l.value.type);let c,m,_,v={};const S=s!=="categorical"&&l.value.property===void 0,A=!S,k=r.J(l.value.stops)==="array"&&r.J(l.value.stops[0])==="array"&&r.J(l.value.stops[0][0])==="object",L=ls({key:l.key,value:l.value,valueSpec:l.styleSpec.function,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(j){if(s==="identity")return[new r.V(j.key,j.value,'identity function may not have a "stops" property')];let X=[];const W=j.value;return X=X.concat(ia({key:j.key,value:W,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:B})),r.J(W)==="array"&&W.length===0&&X.push(new r.V(j.key,W,"array must have at least one stop")),X},default:function(j){return Zn({key:j.key,value:j.value,valueSpec:t,style:j.style,styleSpec:j.styleSpec})}}});return s==="identity"&&S&&L.push(new r.V(l.key,l.value,'missing required property "property"')),s==="identity"||l.value.stops||L.push(new r.V(l.key,l.value,'missing required property "stops"')),s==="exponential"&&l.valueSpec.expression&&!r.N(l.valueSpec)&&L.push(new r.V(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(A&&!r.O(l.valueSpec)?L.push(new r.V(l.key,l.value,"property functions not supported")):S&&!r.Q(l.valueSpec)&&L.push(new r.V(l.key,l.value,"zoom functions not supported"))),s!=="categorical"&&!k||l.value.property!==void 0||L.push(new r.V(l.key,l.value,'"property" property is required')),L;function B(j){let X=[];const W=j.value,Y=j.key;if(r.J(W)!=="array")return[new r.V(Y,W,`array expected, ${r.J(W)} found`)];if(W.length!==2)return[new r.V(Y,W,`array length 2 expected, length ${W.length} found`)];if(k){if(r.J(W[0])!=="object")return[new r.V(Y,W,`object expected, ${r.J(W[0])} found`)];if(W[0].zoom===void 0)return[new r.V(Y,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new r.V(Y,W,"object stop key must have value")];const J=r.M(W[0].zoom);if(typeof J!="number")return[new r.V(Y,W[0].zoom,"stop zoom values must be numbers")];if(_&&_>J)return[new r.V(Y,W[0].zoom,"stop zoom values must appear in ascending order")];J!==_&&(_=J,m=void 0,v={}),X=X.concat(ls({key:`${Y}[0]`,value:W[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:pu,value:O}}))}else X=X.concat(O({key:`${Y}[0]`,value:W[0],style:j.style,styleSpec:j.styleSpec},W));return r.S(r.U(W[1]))?X.concat([new r.V(`${Y}[1]`,W[1],"expressions are not allowed in function stops.")]):X.concat(Zn({key:`${Y}[1]`,value:W[1],valueSpec:t,style:j.style,styleSpec:j.styleSpec}))}function O(j,X){const W=r.J(j.value),Y=r.M(j.value),J=j.value!==null?j.value:X;if(c){if(W!==c)return[new r.V(j.key,J,`${W} stop domain type must match previous stop domain type ${c}`)]}else c=W;if(W!=="number"&&W!=="string"&&W!=="boolean"&&typeof Y!="number"&&typeof Y!="string"&&typeof Y!="boolean")return[new r.V(j.key,J,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&s!=="categorical"){let ie=`number expected, ${W} found`;return r.O(t)&&s===void 0&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(j.key,J,ie)]}return s!=="categorical"||W!=="number"||typeof Y=="number"&&isFinite(Y)&&Math.floor(Y)===Y?s!=="categorical"&&W==="number"&&typeof Y=="number"&&typeof m=="number"&&m!==void 0&&Y<m?[new r.V(j.key,J,"stop domain values must appear in ascending order")]:(m=Y,s==="categorical"&&Y in v?[new r.V(j.key,J,"stop domain values must be unique")]:(v[Y]=!0,[])):[new r.V(j.key,J,`integer expected, found ${String(Y)}`)]}}function ws(l){const t=(l.expressionContext==="property"?r.W:r.X)(r.U(l.value),l.valueSpec);if(t.result==="error")return t.value.map(c=>new r.V(`${l.key}${c.key}`,l.value,c.message));const s=t.value.expression||t.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!s.outputDefined())return[new r.V(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!r.Y(s))return[new r.V(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter")return ko(s,l);if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!r.Z(s,["zoom","feature-state"]))return[new r.V(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!r._(s))return[new r.V(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ko(l,t){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const m of t.valueSpec.expression.parameters)s.delete(m);if(s.size===0)return[];const c=[];return l instanceof r.$&&s.has(l.name)?[new r.V(t.key,t.value,`["${l.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(l.eachChild(m=>{c.push(...ko(m,t))}),c)}function ya(l){const t=l.key,s=l.value,c=l.valueSpec,m=[];return Array.isArray(c.values)?c.values.indexOf(r.M(s))===-1&&m.push(new r.V(t,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(c.values).indexOf(r.M(s))===-1&&m.push(new r.V(t,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),m}function Ja(l){return r.a1(r.U(l.value))?ws(r.L({},l,{expressionContext:"filter",valueSpec:l.styleSpec[`filter_${l.layerType||"fill"}`]})):ks(l)}function ks(l){const t=l.value,s=l.key;if(r.J(t)!=="array")return[new r.V(s,t,`array expected, ${r.J(t)} found`)];const c=l.styleSpec;let m,_=[];if(t.length<1)return[new r.V(s,t,"filter array must have at least 1 element")];switch(_=_.concat(ya({key:`${s}[0]`,value:t[0],valueSpec:c.filter_operator,style:l.style,styleSpec:l.styleSpec})),r.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&r.M(t[1])==="$type"&&_.push(new r.V(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new r.V(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(m=r.J(t[1]),m!=="string"&&_.push(new r.V(`${s}[1]`,t[1],`string expected, ${m} found`)));for(let v=2;v<t.length;v++)m=r.J(t[v]),r.M(t[1])==="$type"?_=_.concat(ya({key:`${s}[${v}]`,value:t[v],valueSpec:c.geometry_type,style:l.style,styleSpec:l.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&_.push(new r.V(`${s}[${v}]`,t[v],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)_=_.concat(ks({key:`${s}[${v}]`,value:t[v],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":m=r.J(t[1]),t.length!==2?_.push(new r.V(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):m!=="string"&&_.push(new r.V(`${s}[1]`,t[1],`string expected, ${m} found`))}return _}function gc(l,t){const s=l.key,c=l.style,m=l.layer,_=l.styleSpec,v=l.value,S=l.objectKey,A=_[`${t}_${l.layerType}`];if(!A)return[];const k=S.match(/^(.*)-use-theme$/);if(t==="paint"&&k&&A[k[1]])return r.S(v)?[].concat(Zn({key:l.key,value:v,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:c,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:S})):Zn({key:s,value:v,valueSpec:{type:"string"},style:c,styleSpec:_});const L=S.match(/^(.*)-transition$/);if(t==="paint"&&L&&A[L[1]]&&A[L[1]].transition)return Zn({key:s,value:v,valueSpec:_.transition,style:c,styleSpec:_});const B=l.valueSpec||A[S];if(!B)return[new r.K(s,v,`unknown property "${S}"`)];let O;if(r.J(v)==="string"&&r.O(B)&&!B.tokens&&(O=/^{([^}]+)}$/.exec(v))){const X=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new r.V(s,v,`"${S}" does not support interpolation syntax
Use an identity property function instead: ${X}.`)]}const j=[];if(l.layerType==="symbol")S!=="text-field"||!c||c.glyphs||c.imports||j.push(new r.V(s,v,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&r.a2(r.U(v))&&r.M(v.type)==="identity"&&j.push(new r.V(s,v,'"text-font" does not support identity functions'));else if(l.layerType==="model"&&t==="paint"&&m&&m.layout&&m.layout.hasOwnProperty("model-id")&&r.O(B)&&(r.a3(B)||r.Q(B))){const X=r.W(r.U(v),B),W=X.value.expression||X.value._styleExpression.expression;W&&!r.Z(W,["measure-light"])&&(S==="model-emissive-strength"&&r._(W)&&r.Y(W)||j.push(new r.V(s,v,`${S} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return j.concat(Zn({key:l.key,value:v,valueSpec:B,style:c,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:S}))}function _c(l){return gc(l,"paint")}function Vs(l){return gc(l,"layout")}function Al(l){let t=[];const s=l.value,c=l.key,m=l.style,_=l.styleSpec;s.type||s.ref||t.push(new r.V(c,s,'either "type" or "ref" is required'));let v=r.M(s.type);const S=r.M(s.ref);if(s.id){const A=r.M(s.id);for(let k=0;k<l.arrayIndex;k++){const L=m.layers[k];r.M(L.id)===A&&t.push(new r.V(c,s.id,`duplicate layer id "${s.id}", previously used at line ${L.id.__line__}`))}}if("ref"in s){let A;["type","source","source-layer","filter","layout"].forEach(k=>{k in s&&t.push(new r.V(c,s[k],`"${k}" is prohibited for ref layers`))}),m.layers.forEach(k=>{r.M(k.id)===S&&(A=k)}),A?A.ref?t.push(new r.V(c,s.ref,"ref cannot reference another ref layer")):v=r.M(A.type):typeof S=="string"&&t.push(new r.V(c,s.ref,`ref layer "${S}" not found`))}else if(v!=="background"&&v!=="sky"&&v!=="slot")if(s.source){const A=m.sources&&m.sources[s.source],k=A&&r.M(A.type);A?k==="vector"&&v==="raster"?t.push(new r.V(c,s.source,`layer "${s.id}" requires a raster source`)):k==="raster"&&v!=="raster"?t.push(new r.V(c,s.source,`layer "${s.id}" requires a vector source`)):k!=="vector"||s["source-layer"]?k==="raster-dem"&&v!=="hillshade"?t.push(new r.V(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="raster-array"||["raster","raster-particle"].includes(v)?v==="line"&&s.paint&&(s.paint["line-gradient"]||s.paint["line-trim-offset"])&&k==="geojson"&&!A.lineMetrics?t.push(new r.V(c,s,`layer "${s.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):v==="raster-particle"&&k!=="raster-array"&&t.push(new r.V(c,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):t.push(new r.V(c,s.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new r.V(c,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new r.V(c,s.source,`source "${s.source}" not found`))}else t.push(new r.V(c,s,'missing required property "source"'));return t=t.concat(ls({key:c,value:s,valueSpec:_.layer,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Zn({key:`${c}.type`,value:s.type,valueSpec:_.layer.type,style:l.style,styleSpec:l.styleSpec,object:s,objectKey:"type"}),filter:A=>Ja(r.L({layerType:v},A)),layout:A=>ls({layer:s,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":k=>Vs(r.L({layerType:v},k))}}),paint:A=>ls({layer:s,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":k=>_c(r.L({layerType:v,layer:s},k))}})}})),t}function xa(l){const t=l.value,s=l.key,c=r.J(t);return c!=="string"?[new r.V(s,t,`string expected, ${c} found`)]:[]}const va={promoteId:function l({key:t,value:s}){if(r.J(s)==="string")return xa({key:t,value:s});if(Array.isArray(s)){const c=[],m=r.U(s),_=r.X(m);return _.result==="error"&&_.value.forEach(v=>{c.push(new r.V(`${t}${v.key}`,null,`${v.message}`))}),r.Z(_.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||c.push(new r.V(`${t}`,null,"promoteId expression should be only feature dependent")),c}{const c=[];for(const m in s)c.push(...l({key:`${t}.${m}`,value:s[m]}));return c}}};function Wr(l){const t=l.value,s=l.key,c=l.styleSpec,m=l.style;if(!t.type)return[new r.V(s,t,'"type" is required')];const _=r.M(t.type);let v=[];switch(["vector","raster","raster-dem","raster-array"].includes(_)&&(t.url||t.tiles||v.push(new r.K(s,t,'Either "url" or "tiles" is required.'))),_){case"vector":case"raster":case"raster-dem":case"raster-array":return v=v.concat(ls({key:s,value:t,valueSpec:c[`source_${_.replace("-","_")}`],style:l.style,styleSpec:c,objectElementValidators:va})),v;case"geojson":if(v=ls({key:s,value:t,valueSpec:c.source_geojson,style:m,styleSpec:c,objectElementValidators:va}),t.cluster)for(const S in t.clusterProperties){const[A,k]=t.clusterProperties[S],L=typeof A=="string"?[A,["accumulated"],["get",S]]:A;v.push(...ws({key:`${s}.${S}.map`,value:k,expressionContext:"cluster-map"})),v.push(...ws({key:`${s}.${S}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return v;case"video":return ls({key:s,value:t,valueSpec:c.source_video,style:m,styleSpec:c});case"image":return ls({key:s,value:t,valueSpec:c.source_image,style:m,styleSpec:c});case"canvas":return[new r.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ya({key:`${s}.type`,value:t.type,valueSpec:{values:$o(c)}})}}function $o(l){return l.source.reduce((t,s)=>{const c=l[s];return c.type.type==="enum"&&(t=t.concat(Object.keys(c.type.values))),t},[])}function Il(l){const t=l.value,s=l.styleSpec,c=s.light,m=l.style;let _=[];const v=r.J(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new r.V("light",t,`object expected, ${v} found`)]),_;for(const S in t){const A=S.match(/^(.*)-transition$/),k=S.match(/^(.*)-use-theme$/);_=_.concat(k&&c[k[1]]?Zn({key:S,value:t[S],valueSpec:{type:"string"},style:m,styleSpec:s}):A&&c[A[1]]&&c[A[1]].transition?Zn({key:S,value:t[S],valueSpec:s.transition,style:m,styleSpec:s}):c[S]?Zn({key:S,value:t[S],valueSpec:c[S],style:m,styleSpec:s}):[new r.V(S,t[S],`unknown property "${S}"`)])}return _}function Qa(l){const t=l.value;let s=[];if(!t)return s;const c=r.J(t);if(c!=="object")return s=s.concat([new r.V("light-3d",t,`object expected, ${c} found`)]),s;const m=l.styleSpec,_=m["light-3d"],v=l.key,S=l.style,A=l.style.lights;for(const B of["type","id"])if(!(B in t))return s=s.concat([new r.V("light-3d",t,`missing property ${B} on light`)]),s;if(t.type&&A)for(let B=0;B<l.arrayIndex;B++){const O=r.M(t.type),j=A[B];r.M(j.type)===O&&s.push(new r.V(v,t.id,`duplicate light type "${t.type}", previously defined at line ${j.id.__line__}`))}const k=`properties_light_${t.type}`;if(!(k in m))return s=s.concat([new r.V("light-3d",t,`Invalid light type ${t.type}`)]),s;const L=m[k];for(const B in t)if(B==="properties"){const O=t[B],j=r.J(O);if(j!=="object")return s=s.concat([new r.V("properties",O,`object expected, ${j} found`)]),s;for(const X in O){const W=X.match(/^(.*)-transition$/),Y=X.match(/^(.*)-use-theme$/);s=s.concat(Y&&L[Y[1]]?Zn({key:B,value:O[X],valueSpec:{type:"string"},style:S,styleSpec:m}):W&&L[W[1]]&&L[W[1]].transition?Zn({key:B,value:t[B],valueSpec:m.transition,style:S,styleSpec:m}):L[X]?Zn({key:X,value:O[X],valueSpec:L[X],style:S,styleSpec:m}):[new r.K(l.key,O[X],`unknown property "${X}"`)])}}else s=s.concat(_[B]?Zn({key:B,value:t[B],valueSpec:_[B],style:S,styleSpec:m}):[new r.K(B,t[B],`unknown property "${B}"`)]);return s}function yc(l){const t=l.value,s=l.key,c=l.style,m=l.styleSpec,_=m.terrain;let v=[];const S=r.J(t);if(t===void 0||S==="null")return v;if(S!=="object")return v=v.concat([new r.V("terrain",t,`object expected, ${S} found`)]),v;for(const A in t){const k=A.match(/^(.*)-transition$/),L=A.match(/^(.*)-use-theme$/);v=v.concat(L&&_[L[1]]?Zn({key:A,value:t[A],valueSpec:{type:"string"},style:c,styleSpec:m}):k&&_[k[1]]&&_[k[1]].transition?Zn({key:A,value:t[A],valueSpec:m.transition,style:c,styleSpec:m}):_[A]?Zn({key:A,value:t[A],valueSpec:_[A],style:c,styleSpec:m}):[new r.K(A,t[A],`unknown property "${A}"`)])}if(t.source){const A=c.sources&&c.sources[t.source],k=A&&r.M(A.type);A?k!=="raster-dem"&&v.push(new r.V(s,t.source,`terrain cannot be used with a source of type ${String(k)}, it only be used with a "raster-dem" source type`)):v.push(new r.V(s,t.source,`source "${t.source}" not found`))}else v.push(new r.V(s,t,'terrain is missing required property "source"'));return v}function wa(l){const t=l.value,s=l.style,c=l.styleSpec,m=c.fog;let _=[];const v=r.J(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new r.V("fog",t,`object expected, ${v} found`)]),_;for(const S in t){const A=S.match(/^(.*)-transition$/),k=S.match(/^(.*)-use-theme$/);_=_.concat(k&&m[k[1]]?Zn({key:S,value:t[S],valueSpec:{type:"string"},style:s,styleSpec:c}):A&&m[A[1]]&&m[A[1]].transition?Zn({key:S,value:t[S],valueSpec:c.transition,style:s,styleSpec:c}):m[S]?Zn({key:S,value:t[S],valueSpec:m[S],style:s,styleSpec:c}):[new r.K(S,t[S],`unknown property "${S}"`)])}return _}const Pl={"*":()=>[],array:ia,boolean:function(l){const t=l.value,s=l.key,c=r.J(t);return c!=="boolean"?[new r.V(s,t,`boolean expected, ${c} found`)]:[]},number:pu,color:function(l){const t=l.key,s=l.value,c=r.J(s);return c!=="string"?[new r.V(t,s,`color expected, ${c} found`)]:r.a0.parseCSSColor(s)===null?[new r.V(t,s,`color expected, "${s}" found`)]:[]},enum:ya,filter:Ja,function:vs,layer:Al,object:ls,source:Wr,model:r.a4,light:Il,"light-3d":Qa,terrain:yc,fog:wa,string:xa,formatted:function(l){return xa(l).length===0?[]:ws(l)},resolvedImage:function(l){return xa(l).length===0?[]:ws(l)},projection:function(l){const t=l.value,s=l.styleSpec,c=s.projection,m=l.style;let _=[];const v=r.J(t);if(v==="object")for(const S in t)_=_.concat(Zn({key:S,value:t[S],valueSpec:c[S],style:m,styleSpec:s}));else v!=="string"&&(_=_.concat([new r.V("projection",t,`object or string expected, ${v} found`)]));return _},import:function(l){const{value:t,styleSpec:s}=l,{data:c,...m}=t;Object.defineProperty(m,"__line__",{value:t.__line__,enumerable:!1});let _=ls(r.L({},l,{value:m,valueSpec:s.import}));return r.M(m.id)===""&&_.push(new r.V(`${l.key}.id`,m,"import id can't be an empty string")),c&&(_=_.concat(Ml(c,s,{key:`${l.key}.data`}))),_},iconset:function(l){const t=l.value,s=l.key,c=l.styleSpec,m=l.style;if(!t.type)return[new r.V(s,t,'"type" is required')];const _=r.M(t.type);let v=[];if(v=v.concat(ls({key:s,value:t,valueSpec:c[`iconset_${_}`],style:m,styleSpec:c})),_==="source"&&t.source){const S=m.sources&&m.sources[t.source],A=S&&r.M(S.type);S?A!=="raster-array"&&v.push(new r.V(s,t.source,`iconset cannot be used with a source of type ${String(A)}, it only be used with a "raster-array" source type`)):v.push(new r.V(s,t.source,`source "${t.source}" not found`))}return v}};function Zn(l,t=!1){const s=l.value,c=l.valueSpec,m=l.styleSpec;if(c.expression&&r.a2(r.M(s)))return vs(l);if(c.expression&&r.S(r.U(s)))return ws(l);if(c.type&&Pl[c.type]){const _=Pl[c.type](l);return t===!0&&_.length>0&&r.J(l.value)==="array"?ws(l):_}return ls(r.L({},l,{valueSpec:c.type?m[c.type]:c}))}function ba(l){const t=l.value,s=l.key,c=xa(l);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new r.V(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new r.V(s,t,'"glyphs" url must include a "{range}" token'))),c}function Ml(l,t=r.a5,s={}){return Zn({key:s.key||"",value:l,valueSpec:t.$root,styleSpec:t,style:l,objectElementValidators:{glyphs:ba,"*":()=>[]}})}function cs(l,t=r.a5){return Ie(Ml(l,t))}const Rl=l=>Ie(Wr(l)),hh=l=>Ie(Il(l)),kl=l=>Ie(Qa(l)),Rt=l=>Ie(yc(l)),Ta=l=>Ie(wa(l)),md=l=>Ie(function(t){const s=t.value,c=t.style,m=t.styleSpec,_=m.snow;let v=[];const S=r.J(s);if(s===void 0)return v;if(S!=="object")return v=v.concat([new r.V("snow",s,`object expected, ${S} found`)]),v;for(const A in s){const k=A.match(/^(.*)-transition$/);v=v.concat(k&&_[k[1]]&&_[k[1]].transition?Zn({key:A,value:s[A],valueSpec:m.transition,style:c,styleSpec:m}):_[A]?Zn({key:A,value:s[A],valueSpec:_[A],style:c,styleSpec:m}):[new r.K(A,s[A],`unknown property "${A}"`)])}return v}(l)),xc=l=>Ie(function(t){const s=t.value,c=t.style,m=t.styleSpec,_=m.rain;let v=[];const S=r.J(s);if(s===void 0)return v;if(S!=="object")return v=v.concat([new r.V("rain",s,`object expected, ${S} found`)]),v;for(const A in s){const k=A.match(/^(.*)-transition$/);v=v.concat(k&&_[k[1]]&&_[k[1]].transition?Zn({key:A,value:s[A],valueSpec:m.transition,style:c,styleSpec:m}):_[A]?Zn({key:A,value:s[A],valueSpec:_[A],style:c,styleSpec:m}):[new r.K(A,s[A],`unknown property "${A}"`)])}return v}(l)),_n=l=>Ie(Al(l)),qe=l=>Ie(Ja(l)),te=l=>Ie(_c(l)),ne=l=>Ie(Vs(l)),ge=l=>Ie(r.a4(l));function Ie(l){return l.slice().sort((t,s)=>t.line&&s.line?t.line-s.line:0)}function we(l,t){let s=!1;if(t&&t.length)for(const c of t)c instanceof r.K?r.w(c.message):(l.fire(new r.z(new Error(c.message))),s=!0);return s}let De;class $e extends r.E{constructor(t,s="flat"){super(),this._transitionable=new r.a6(De||(De=new r.a7({anchor:new r.a8(r.a5.light.anchor),position:new r.a9(r.a5.light.position),color:new r.a8(r.a5.light.color),intensity:new r.a8(r.a5.light.intensity)}))),this.setLight(t,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s,c={}){this._validate(hh,t,c)||(this._transitionable.setTransitionOrValue(t),this.id=s)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,c){return(!c||c.validate!==!1)&&we(this,t.call(cs,r.h({value:s,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}}let Le=class extends r.E{constructor(l,t,s,c,m){super(),this.scope=s,this._transitionable=new r.a6(new r.a7({source:new r.a8(r.a5.terrain.source),exaggeration:new r.a8(r.a5.terrain.exaggeration)}),s,c),this._transitionable.setTransitionOrValue(l,c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=m}get(){return this._transitionable.serialize()}set(l,t){this._transitionable.setTransitionOrValue(l,t)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}getExaggeration(l){return this._transitioning.possiblyEvaluate(new r.aa(l,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const l=this._transitionable._values.exaggeration;if(!l)return null;const t=l.value.expression;if(!t)return null;let s=-1,c=-1,m=1;for(const _ of t.zoomStops)m=t.evaluate(new r.aa(_,{worldview:this.worldview})),m>.01?(s=_,c=-1):c=_;return m<.01&&s>0&&c>s?[s,c]:null}isZoomDependent(){const l=this._transitionable._values.exaggeration;return l!=null&&l.value!=null&&l.value.expression!=null&&l.value.expression instanceof r.ab}};const He=45,lt=65,Ze=.05;function Mt(l,t,s,c){const m=r.af(He,lt,s),[_,v]=ei(l,c);let S=1-Math.min(1,Math.exp((t-_)/(v-_)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*m*l.alpha}function ei(l,t){const s=.5/Math.tan(.5*t);return[l.range[0]+s,l.range[1]+s]}function ri(l,t,s,c,m){const _=r.ad([],[t,s,c],m.mercatorFogMatrix);return Mt(l,r.ae(_),m.pitch,m._fov)}function Si(l,t,s,c,m,_,v){const S=[[s,c,0],[m,c,0],[m,_,0],[s,_,0]];let A=Number.MAX_VALUE,k=-Number.MAX_VALUE;for(const L of S){const B=r.ad([],L,t),O=r.ae(B);A=Math.min(A,O),k=Math.max(k,O)}return[Mt(l,A,v.pitch,v._fov),Mt(l,k,v.pitch,v._fov)]}class Ai extends r.E{constructor(t,s,c,m){super();const _=new r.a7({range:new r.a8(r.a5.fog.range),color:new r.a8(r.a5.fog.color),"color-use-theme":new r.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.a8(r.a5.fog["high-color"]),"high-color-use-theme":new r.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.a8(r.a5.fog["space-color"]),"space-color-use-theme":new r.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.a8(r.a5.fog["horizon-blend"]),"star-intensity":new r.a8(r.a5.fog["star-intensity"]),"vertical-range":new r.a8(r.a5.fog["vertical-range"])});this._transitionable=new r.a6(_,c,new Map(m)),this.set(t,m),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new r.ag(_),this.scope=c}get state(){const t=this._transform,s=t.projection.name==="globe",c=r.ah(t.zoom),m=this.properties.get("range"),_=[.5,3];return{range:s?[r.ai(_[0],m[0],c),r.ai(_[1],m[1],c)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s,c={}){if(this._validate(Ta,t,c))return;const m=r.h({},t);for(const _ of Object.keys(r.a5.fog))m[_]===void 0&&(m[_]=r.a5.fog[_].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.af(He,lt,t))*s.a}getOpacityAtLatLng(t,s){return this._transform.projection.supportsFog?function(c,m,_){const v=r.ac.fromLngLat(m),S=_.elevation?_.elevation.getAtPointOrZero(v):0;return ri(c,v.x,v.y,S,_)}(this.state,t,s):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Si(this.state,s,0,0,r.aj,r.aj,this._transform)}getOpacityForBounds(t,s,c,m,_){return this._transform.projection.supportsFog?Si(this.state,t,s,c,m,_,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?ei(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const c of s){const m=t.points[c];let _;if(m[2]>=0)_=m;else{const v=t.points[c-4];_=r.ak(v,m,v[2]/(v[2]-m[2]))}if(ri(this.state,_[0],_[1],0,this._transform)>=Ze)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,c){return(!c||c.validate!==!1)&&we(this,t.call(cs,r.h({value:s,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}}let Pi,Hi,zi,Bn,nn=class extends r.E{constructor(l,t,s,c){super();const m=Pi||(Pi=new r.a7({density:new r.a8(r.a5.snow.density),intensity:new r.a8(r.a5.snow.intensity),color:new r.a8(r.a5.snow.color),opacity:new r.a8(r.a5.snow.opacity),vignette:new r.a8(r.a5.snow.vignette),"vignette-color":new r.a8(r.a5.snow["vignette-color"]),"center-thinning":new r.a8(r.a5.snow["center-thinning"]),direction:new r.a8(r.a5.snow.direction),"flake-size":new r.a8(r.a5.snow["flake-size"])}));this._transitionable=new r.a6(m,s,new Map(c)),this.set(l,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ag(m),this.scope=s}get state(){const l=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),c=r.al(s[0]),m=-Math.max(r.al(s[1]),.01),_=[Math.cos(c)*Math.cos(m),Math.sin(c)*Math.cos(m),Math.sin(m)],v=this.properties.get("vignette"),S=this.properties.get("vignette-color");return S.a=v,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.am(t.r,t.g,t.b,t.a*l),direction:_,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(l,t,s={}){if(this._validate(md,l,s))return;const c=r.h({},l);for(const m of Object.keys(r.a5.snow))c[m]===void 0&&(c[m]=r.a5.snow[m].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,s){return(!s||s.validate!==!1)&&we(this,l.call(cs,r.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}},tr=class extends r.E{constructor(l,t,s,c){super();const m=Hi||(Hi=new r.a7({density:new r.a8(r.a5.rain.density),intensity:new r.a8(r.a5.rain.intensity),color:new r.a8(r.a5.rain.color),opacity:new r.a8(r.a5.rain.opacity),vignette:new r.a8(r.a5.rain.vignette),"vignette-color":new r.a8(r.a5.rain["vignette-color"]),"center-thinning":new r.a8(r.a5.rain["center-thinning"]),direction:new r.a8(r.a5.rain.direction),"droplet-size":new r.a8(r.a5.rain["droplet-size"]),"distortion-strength":new r.a8(r.a5.rain["distortion-strength"])}));this._transitionable=new r.a6(m,s,new Map(c)),this.set(l,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ag(m),this.scope=s}get state(){const l=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),c=r.al(s[0]),m=-Math.max(r.al(s[1]),.01),_=[Math.cos(c)*Math.cos(m),Math.sin(c)*Math.cos(m),Math.sin(m)],v=this.properties.get("vignette-color");return v.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.am(t.r,t.g,t.b,t.a*l),direction:_,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:v}}get(){return this._transitionable.serialize()}set(l,t,s={}){if(this._validate(xc,l,s))return;const c=r.h({},l);for(const m of Object.keys(r.a5.rain))c[m]===void 0&&(c[m]=r.a5.rain[m].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,s){return(!s||s.validate!==!1)&&we(this,l.call(cs,r.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a5})))}};class Tn extends r.E{constructor(t,s,c,m){super(),this.scope=c,this._options=t,this.properties=new r.ag(s),this._transitionable=new r.a6(s,c,new Map(m)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,s){this._options=t,this._transitionable.setTransitionOrValue(t.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class xn{constructor(t,s,c,m){this.screenBounds=t,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(t,s){let c,m;if(t instanceof r.P||typeof t[0]=="number"){const _=r.P.convert(t);c=[_],m=s.isPointAboveHorizon(_)}else{const _=r.P.convert(t[0]),v=r.P.convert(t[1]),S=_.add(v)._div(2);c=[_,v],m=r.ao(_,v).every(A=>s.isPointAboveHorizon(A))&&s.isPointAboveHorizon(S)}return new xn(c,s.getCameraPoint(),m,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return r.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],m=r.ao(s,c,0,!1);return this.cameraPoint.y>c.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<c.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=c.x?m[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(m[3]=this.cameraPoint)),r.ap(m,t)}bufferedCameraGeometryGlobe(t){const s=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],m=r.ao(s,c,t),_=this.cameraPoint.clone();switch(3*((_.y>s.y)+(_.y>c.y))+((_.x>s.x)+(_.x>c.x))){case 0:m[0]=_,m[4]=_.clone();break;case 1:m.splice(1,0,_);break;case 2:m[1]=_;break;case 3:m.splice(4,0,_);break;case 5:m.splice(2,0,_);break;case 6:m[3]=_;break;case 7:m.splice(3,0,_);break;case 8:m[2]=_}return m}containsTile(t,s,c,m=0){const _=t.queryPadding/s._pixelsPerMercatorPixel+1,v=c?this._bufferedCameraMercator(_,s):this._bufferedScreenMercator(_,s);let S=t.tileID.wrap+(v.unwrapped?m:0);const A=v.polygon.map(Y=>r.aq(t.tileTransform,Y,S));if(!r.ar(A,0,0,r.aj,r.aj))return;S=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const k=this.screenGeometryMercator.polygon.map(Y=>r.as(t.tileTransform,Y,S)),L=k.map(Y=>new r.P(Y[0],Y[1])),B=s.getFreeCameraOptions().position||new r.ac(0,0,0),O=r.as(t.tileTransform,B,S),j=k.map(Y=>{const J=r.at(Y,Y,O);return r.au(J,J),new r.av(O,J)}),X=r.aw(t,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:j,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(W=r.ax(A),W.min.x=r.ay(W.min.x,0,r.aj),W.min.y=r.ay(W.min.y,0,r.aj),W.max.x=r.ay(W.max.x,0,r.aj),W.max.y=r.ay(W.max.y,0,r.aj),W),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:X};var W}_bufferedScreenMercator(t,s){const c=lr(t);if(this._screenRaycastCache[c])return this._screenRaycastCache[c];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),s):{polygon:this.bufferedScreenGeometry(t).map(_=>s.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[c]=m,m}}_bufferedCameraMercator(t,s){const c=lr(t);if(this._cameraRaycastCache[c])return this._cameraRaycastCache[c];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),s):{polygon:this.bufferedCameraGeometry(t).map(_=>s.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[c]=m,m}}_projectAndResample(t,s){const c=function(_,v){const S=r.az([],v.pixelMatrix,v.globeMatrix),A=[0,-r.aB,0,1],k=[0,r.aB,0,1],L=[0,0,0,1];r.aA(A,A,S),r.aA(k,k,S),r.aA(L,L,S);const B=new r.P(A[0]/A[3],A[1]/A[3]),O=new r.P(k[0]/k[3],k[1]/k[3]),j=r.aC(_,B)&&A[3]<L[3],X=r.aC(_,O)&&k[3]<L[3];if(!j&&!X)return null;const W=function(xe,me,Ee){for(let Ae=1;Ae<xe.length;Ae++){const Oe=gr(me.pointCoordinate3D(xe[Ae-1]).x),Ge=gr(me.pointCoordinate3D(xe[Ae]).x);if(Ee<0){if(Oe<Ge)return{idx:Ae,t:-Oe/(Ge-1-Oe)}}else if(Ge<Oe)return{idx:Ae,t:(1-Oe)/(Ge+1-Oe)}}return null}(_,v,j?-1:1);if(!W)return null;const{idx:Y,t:J}=W;let ie=Y>1?fr(_.slice(0,Y),v):[],ue=Y<_.length?fr(_.slice(Y),v):[];ie=ie.map(xe=>new r.P(gr(xe.x),xe.y)),ue=ue.map(xe=>new r.P(gr(xe.x),xe.y));const pe=[...ie];pe.length===0&&pe.push(ue[ue.length-1]);const be=r.ai(pe[pe.length-1].y,(ue.length===0?ie[0]:ue[0]).y,J);let Te;return Te=j?[new r.P(0,be),new r.P(0,0),new r.P(1,0),new r.P(1,be)]:[new r.P(1,be),new r.P(1,1),new r.P(0,1),new r.P(0,be)],pe.push(...Te),ue.length===0?pe.push(ie[0]):pe.push(...ue),{polygon:pe.map(xe=>new r.ac(xe.x,xe.y)),unwrapped:!1}}(t,s);if(c)return c;const m=function(_,v){let S=!1,A=-1/0,k=0;for(let B=0;B<_.length-1;B++)_[B].x>A&&(A=_[B].x,k=B);for(let B=0;B<_.length-1;B++){const O=(k+B)%(_.length-1),j=_[O],X=_[O+1];Math.abs(j.x-X.x)>.5&&(j.x<X.x?(j.x+=1,O===0&&(_[_.length-1].x+=1)):(X.x+=1,O+1===_.length-1&&(_[0].x+=1)),S=!0)}const L=r.aD(v.center.lng);return S&&L<Math.abs(L-1)&&_.forEach(B=>{B.x-=1}),{polygon:_,unwrapped:S}}(fr(t,s).map(_=>new r.P(gr(_.x),_.y)),s);return{polygon:m.polygon.map(_=>new r.ac(_.x,_.y)),unwrapped:m.unwrapped}}}function fr(l,t){return r.aE(l,s=>{const c=t.pointCoordinate3D(s);s.x=c.x,s.y=c.y},1/256)}function gr(l){return l<0?1+l%1:l%1}function lr(l){return 100*l|0}function Nr(l,t,s,c,m){const _=function(S,A){if(S)return m(S);if(A){if(l.url&&A.tiles&&l.tiles&&delete l.tiles,A.variants){if(!Array.isArray(A.variants))return m(new Error("variants must be an array"));for(const L of A.variants){if(L==null||typeof L!="object"||L.constructor!==Object)return m(new Error("variant must be an object"));if(!Array.isArray(L.capabilities))return m(new Error("capabilities must be an array"));if(L.capabilities.length===1&&L.capabilities[0]==="meshopt"){A=r.h(A,L);break}}}const k=r.aF(r.h({},A,l),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);k.tiles=t.canonicalizeTileset(k,l.url),m(null,k)}},v=function(S,A,k){if(!S)return null;if(!A&&!k)return S;k=k||S.worldview_default;const L=Object.values(S.language||{});if(L.length===0)return null;const B=Object.values(S.worldview||{});if(B.length===0)return null;const O=L.every(X=>X===A),j=B.every(X=>X===k);return O&&j?S:A in(S.language_options||{})||k in(S.worldview_options||{})?null:S.language_options&&S.worldview_options?S:null}(l.data,s,c);return v?r.q.frame(()=>_(null,v)):l.url?r.n(t.transformRequest(t.normalizeSourceURL(l.url,null,s,c),r.R.Source),_):r.q.frame(()=>{const{data:S,...A}=l;_(null,A)})}function Lr(l,t){const s=Math.pow(2,t.z),c=Math.floor(r.aD(l.getWest())*s),m=Math.floor(r.aH(l.getNorth())*s),_=Math.ceil(r.aD(l.getEast())*s),v=Math.ceil(r.aH(l.getSouth())*s);return t.x>=c&&t.x<_&&t.y>=m&&t.y<v}class Ds{constructor(t,s,c){this.bounds=t?r.aG.convert(this.validateBounds(t)):null,this.minzoom=s||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const s of t)this.extraBounds.push(r.aG.convert(this.validateBounds(s)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!Lr(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const s of this.extraBounds)if(Lr(s,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const s=new Ds(t.bounds,t.minzoom,t.maxzoom);return s.addExtraBounds(t.extra_bounds),s}}class to extends r.E{constructor(t,s,c,m){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.h(this,r.aF(s,["url","scheme","tileSize","promoteId"])),this._options=r.h({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new r.aI}load(t){this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=Nr(this._options,this.map._requestManager,s,c,(m,_)=>{if(this._tileJSONRequest=null,this._loaded=!0,m)s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),c&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new r.z(m));else if(_){if(r.h(this,_),this.hasWorldviews=!!_.worldview_options,_.worldview_default&&(this.worldviewDefault=_.worldview_default),_.vector_layers){this.vectorLayers=_.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const v of _.vector_layers)this.vectorLayerIds.push(v.id),_.worldview&&_.worldview[v.source]&&this.localizableLayerIds.add(v.id)}this.tileBounds=Ds.fromTileJSON(_),zt(_.tiles,this.map._requestManager._customAccessToken),this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(m)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return r.h({},this._options)}loadTile(t,s){const c=t.tileID.canonical.url(this.tiles,this.scheme),m=this.map._requestManager.normalizeTileURL(c),_=this.map._requestManager.transformRequest(m,r.R.Tile),v=this.map.style?this.map.style.getLut(this.scope):null,S=v?{image:v.image.clone()}:null,A={request:_,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:S,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&r.j(c)&&(A.localizableLayerIds=this.localizableLayerIds),A.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",A,k.bind(this));else if(t.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",A,k.bind(this),void 0,!0);else{const L=r.aJ.call({deduped:this._deduped},A,(B,O)=>{B||!O?k.call(this,B):(A.data={cacheControl:O.cacheControl,expires:O.expires,rawData:O.rawData.slice(0)},t.actor&&t.actor.send("loadTile",A,k.bind(this),void 0,!0))},!0);t.request={cancel:L}}function k(L,B){return delete t.request,t.aborted?s(null):L&&L.status!==404?s(L):(B&&B.resourceTiming&&(t.resourceTiming=B.resourceTiming),this.map._refreshExpiredTiles&&B&&t.setExpiryData(B),t.loadVectorData(B,this.map.painter),r.aK(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class us extends r.E{constructor(t,s,c,m){super(),this.id=t,this.dispatcher=c,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.h({type:"raster"},s),r.h(this,r.aF(s,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"}));const s=this.map.getWorldview();this._tileJSONRequest=Nr(this._options,this.map._requestManager,null,s,(c,m)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new r.z(c)):m&&(r.h(this,m),m.raster_layers&&(this.rasterLayers=m.raster_layers,this.rasterLayerIds=this.rasterLayers.map(_=>_.id)),this.tileBounds=Ds.fromTileJSON(m),zt(m.tiles),this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(c)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return r.h({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const c=r.q.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),c,this.tileSize);t.request=r.o(this.map._requestManager.transformRequest(m,r.R.Tile),(_,v,S,A)=>(delete t.request,t.aborted?(t.state="unloaded",s(null)):_?(t.state="errored",s(_)):v?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:S,expires:A}),t.setTexture(v,this.map.painter),t.state="loaded",r.aK(this.dispatcher),void s(null)):s(null)))}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s&&s()}unloadTile(t,s){t.texture&&t.texture instanceof r.T?(t.destroy(!0),t.texture&&t.texture instanceof r.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Dl extends us{constructor(t,s,c,m){super(t,s,c,m),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=r.h({type:"raster-array"},s)}triggerRepaint(t){const s=this.map.painter._terrain,c=this.map.style.getSourceCache(this.id);s&&s.enabled&&c&&s._clearRenderCacheForTile(c.id,t.tileID),this.map.triggerRepaint()}loadTile(t,s){const c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(c,r.R.Tile),_={request:m,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=m,t.actor||(t.actor=this.dispatcher.getActor());const v=(S,A,k,L)=>{if(delete t.request,t.aborted)return t.state="unloaded",s(null);if(S)return S.name==="AbortError"?void 0:(t.state="errored",s(S));if(this.map._refreshExpiredTiles&&A&&t.setExpiryData({cacheControl:k,expires:L}),this.partial)t.state="empty";else{if(!A)return s(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=A}s(null)};t.request=this.partial?t.fetchHeader(void 0,v.bind(this)):t.actor.send("loadTile",_,v.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){const c=t.texture;c&&c instanceof r.T?(t.destroy(!0),this.map.painter.saveTileTexture(c)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,s,c){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(s,c,(m,_)=>{if(m)return t.state="errored",this.fire(new r.z(m)),void this.triggerRepaint(t);_&&(t._isHeaderLoaded=!0,t.setTexture(_,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find(({id:_})=>_===t),c=s&&s.fields,m=c&&c.bands&&c.bands;return m?m[0]:0}getTextureDescriptor(t,s,c){if(!t)return;const m=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!m)return;let _=null;s instanceof r.aN?_=s.paint.get("raster-array-band"):s instanceof r.aO&&(_=s.paint.get("raster-particle-array-band"));const v=_||this.getInitialBand(m);if(v!=null)if(t.textureDescriptor){if(!t.updateNeeded(m,v)||c)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,m,v)}getImages(t,s){const c=new Map;for(const m of t)for(const _ of s){const[v,S]=_.split("/"),A=m.getLayer(v);if(!A||!A.hasBand(S)||!A.hasDataForBand(S))continue;const{bytes:k,tileSize:L,buffer:B}=A.getBandView(S),O=L+2*B,j={data:new r.r({width:O,height:O},k),pixelRatio:2,sdf:!1,usvg:!1,version:0};c.set(_,j)}return c}}const gd={vector:to,raster:us,"raster-dem":class extends us{constructor(l,t,s,c){super(l,t,s,c),this.type="raster-dem",this.maxzoom=22,this._options=r.h({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(l,t){const s=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function c(m,_){m&&(l.state="errored",t(m)),_&&(l.dem=_,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",t(null))}l.request=r.o(this.map._requestManager.transformRequest(s,r.R.Tile),(function(m,_,v,S){if(delete l.request,l.aborted)l.state="unloaded",t(null);else if(m)l.state="errored",t(m);else if(_){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:v,expires:S});const A=ImageBitmap&&_ instanceof ImageBitmap&&r.t(),k=1-(_.width-r.aL(_.width))/2;k<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const L=A?_:r.q.getImageData(_,k),B={uid:l.uid,tileID:l.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:k};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadTile",B,c.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(l){const t=l.canonical,s=Math.pow(2,t.z),c=(t.x-1+s)%s,m=t.x===0?l.wrap-1:l.wrap,_=(t.x+1+s)%s,v=t.x+1===s?l.wrap+1:l.wrap,S={};return S[new r.aM(l.overscaledZ,m,t.z,c,t.y).key]={backfilled:!1},S[new r.aM(l.overscaledZ,v,t.z,_,t.y).key]={backfilled:!1},t.y>0&&(S[new r.aM(l.overscaledZ,m,t.z,c,t.y-1).key]={backfilled:!1},S[new r.aM(l.overscaledZ,l.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},S[new r.aM(l.overscaledZ,v,t.z,_,t.y-1).key]={backfilled:!1}),t.y+1<s&&(S[new r.aM(l.overscaledZ,m,t.z,c,t.y+1).key]={backfilled:!1},S[new r.aM(l.overscaledZ,l.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},S[new r.aM(l.overscaledZ,v,t.z,_,t.y+1).key]={backfilled:!1}),S}},"raster-array":Dl,geojson:class extends r.E{constructor(l,t,s,c){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(c),this._data=t.data,this._options=r.h({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const m=r.aj/this.tileSize;this.workerOptions=r.h({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:r.aj,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:r.aj,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){if(!this._options.dynamic)return this.fire(new r.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof l!="string"&&(l.type==="Feature"&&(l={type:"FeatureCollection",features:[l]}),l.type!=="FeatureCollection"))return this.fire(new r.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof l!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const s of this._data.features)t.set(s.id,s);for(const s of l.features)t.set(s.id,s);this._data.features=[...t.values()]}else this._data=l;return this._updateWorkerData(!0),this}getClusterExpansionZoom(l,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterChildren(l,t){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterLeaves(l,t,s,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:l,limit:t,offset:s},c),this}_updateWorkerData(l=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=r.h({append:l},this.workerOptions);t.scope=this.scope;const s=this._data;typeof s=="string"?(t.request=this.map._requestManager.transformRequest(r.q.resolveURL(s),r.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(c,m)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new r.z(c));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(_.resourceTiming=m.resourceTiming[this.id]),l&&(this._partialReload=!0),this.fire(new r.A("data",_)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(l),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const l=r.C(this.id,this.scope);this.map.style.clearSource(l),this._updateWorkerData()}loadTile(l,t){const s=l.actor?"reloadTile":"loadTile";l.actor=this.actor;const c=this.map.style?this.map.style.getLut(this.scope):null,m=c?{image:c.image.clone()}:null,_=this._partialReload,v={type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:m,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:_,worldview:this.map.getWorldview()};l.request=this.actor.send(s,v,(S,A)=>_&&!A?(l.state="loaded",t(null)):(delete l.request,l.destroy(),l.aborted?t(null):S?t(S):(l.loadVectorData(A,this.map.painter,s==="reloadTile"),t(null))),void 0,s==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l,t){this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}onRemove(l){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aP{constructor(l,t,s,c){super(l,t,s,c),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const t of l.urls)this.urls.push(this.map._requestManager.transformRequest(t,r.R.Source).url);r.aQ(this.urls,(t,s)=>{this._loaded=!0,t?this.fire(new r.z(t)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const t=this.video.seekable;l<t.start(0)||l>t.end(0)?this.fire(new r.z(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,t=l.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(l,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aP,model:class extends r.E{constructor(l,t,s,c){super(),this.id=l,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const l=[];for(const t in this._options.models){const s=this._options.models[t],c=r.aS(this.map._requestManager.transformRequest(s.uri,r.R.Model).url).then(m=>{if(!m)return;const _=r.aT(m),v=new r.aU(t,s.position,s.orientation,_);v.computeBoundsAndApplyParent(),this.models.push(v)}).catch(m=>{this.fire(new r.z(new Error(`Could not load model ${t} from ${s.uri}: ${m.message}`)))});l.push(c)}Promise.allSettled(l).then(()=>{this._loaded=!0,this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new r.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(l){this.map=l,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(l,t){}serialize(){return this._options}},"batched-model":class extends r.E{constructor(l,t,s,c){super(),this.type="batched-model",this.id=l,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(c)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=r.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(l){this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map.getWorldview();this._tileJSONRequest=Nr(this._options,this.map._requestManager,t,s,(c,m)=>{this._tileJSONRequest=null,this._loaded=!0,c?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new r.z(c))):m&&(r.h(this,m),m.bounds&&(this.tileBounds=new Ds(m.bounds,this.minzoom,this.maxzoom)),zt(m.tiles,this.map._requestManager._customAccessToken),this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))),l&&l(c)})}hasTransition(){return!1}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loaded(){return this._loaded}loadTile(l,t){const s=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),c={request:this.map._requestManager.transformRequest(s,r.R.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:r.q.devicePixelRatio,promoteId:this.promoteId};if(l.actor&&l.state!=="expired")if(l.state==="loading")l.reloadCallback=t;else{if(l.buckets){const _=Object.values(l.buckets);for(const v of _)v.dirty=!0;return void(l.state="loaded")}l.request=l.actor.send("reloadTile",c,m.bind(this))}else l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",c,m.bind(this),void 0,!0);function m(_,v){return l.aborted?t(null):_&&_.status!==404?t(_):(this.map._refreshExpiredTiles&&v&&l.setExpiryData(v),l.loadModelData(v,this.map.painter),l.state="loaded",void t(null))}}serialize(){return r.h({},this._options)}},canvas:class extends r.aP{constructor(l,t,s,c){super(l,t,s,c),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(_=>typeof _!="number"))||this.fire(new r.z(new r.V(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.z(new r.V(`sources.${l}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new r.z(new r.V(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new r.z(new r.V(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.z(new r.V(`sources.${l}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(l){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!l&&!this._playing||this.texture instanceof r.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends r.E{constructor(l,t,s,c){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=t,this.setEventedParent(c),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ds(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),r.h(this,r.aF(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this.map=l,this._loaded=!1,this.fire(new r.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:t,y:s,z:c}=l.canonical;return this._implementation.hasTile({x:t,y:s,z:c})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,t){const{x:s,y:c,z:m}=l.tileID.canonical,_=new AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:s,y:c,z:m},{signal:_.signal})).then((function(v){return delete l.request,l.aborted?(l.state="unloaded",t(null)):v===void 0?(l.state="errored",t(null)):v===null?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",t(null)):function(S){return S instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement}(v)?(this.loadTileData(l,v),l.state="loaded",void t(null)):(l.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(v=>{v.name!=="AbortError"&&(l.state="errored",t(v))}),l.request.cancel=()=>_.abort()}loadTileData(l,t){l.setTexture(t,this.map.painter)}unloadTile(l,t){if(l.texture&&l.texture instanceof r.T?(l.destroy(!0),l.texture&&l.texture instanceof r.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),this._implementation.unloadTile){const{x:s,y:c,z:m}=l.tileID.canonical;this._implementation.unloadTile({x:s,y:c,z:m})}t&&t()}abortTile(l,t){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_clearTiles(){const l=r.C(this.id,this.scope);this.map.style.clearSource(l)}_update(){this.fire(new r.A("data",{dataType:"source",sourceDataType:"content"}))}}},Ll=function(l,t,s,c){const m=new gd[t.type](l,t,s,c);if(m.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${m.id}`);return r.aV(["load","abort","unload","serialize","prepare"],m),m};function zl(l,t,s=""){return`${s}:${t.id||""}:${t.layer.id}:${function(c){if("layerId"in c)return`layer:${c.layerId}`;{const{featuresetId:m,importId:_}=c;return`featureset:${m}${_?`:import:${_}`:""}`}}(l.target)}`}function Fl(l,t,s,c=""){if(l.uniqueFeatureID){const m=zl(l,t,c);if(s.has(m))return!0;s.add(m)}return!1}function vc(l,t,s,c,m=!1){const _=t.sourceCache.transform,v=t.sourceCache.tilesIn(l,t.has3DLayers,m);v.sort(mu);const S=[];for(const A of v){const k=A.tile.queryRenderedFeatures(t,A,s,c,_,m);Object.keys(k).length&&S.push({wrappedTileID:A.tile.tileID.wrapped().key,queryResults:k})}return S.length===0?{}:function(A){const k={},L={};for(const B of A){const O=B.queryResults,j=B.wrappedTileID,X=L[j]=L[j]||{};for(const W in O){const Y=O[W],J=X[W]=X[W]||{},ie=k[W]=k[W]||[];for(const ue of Y)J[ue.featureIndex]||(J[ue.featureIndex]=!0,ie.push(ue))}}return k}(S)}function wc(l,t,s,c,m,_){const v={},S=c.queryRenderedSymbols(l),A=[];for(const k of Object.keys(S).map(Number))A.push(m[k]);A.sort(mu);for(const k of A){const L=k.featureIndex.lookupSymbolFeatures(S[k.bucketInstanceId],k.bucketIndex,k.sourceLayerIndex,t,s,_);for(const B in L){const O=v[B]=v[B]||[],j=L[B];j.sort((X,W)=>{const Y=k.featureSortOrder;if(Y){const J=Y.indexOf(X.featureIndex);return Y.indexOf(W.featureIndex)-J}return W.featureIndex-X.featureIndex});for(const X of j)O.push(X)}}return v}function dh(l,t){const s=l.getRenderableIds().map(_=>l.getTileByID(_)),c=[],m={};for(let _=0;_<s.length;_++){const v=s[_],S=v.tileID.canonical.key;m[S]||(m[S]=!0,v.querySourceFeatures(c,t))}return c}function mu(l,t){const s=l.tileID,c=t.tileID;return s.overscaledZ-c.overscaledZ||s.canonical.y-c.canonical.y||s.wrap-c.wrap||s.canonical.x-c.canonical.x}function Ho(l,t){const s={};if(!t)return s;for(const c of l){const m=c.layerIds.map(_=>t.getLayer(_)).filter(Boolean);if(m.length!==0){c.layers=m,c.stateDependentLayerIds&&(c.stateDependentLayers=c.stateDependentLayerIds.map(_=>m.filter(v=>v.id===_)[0]));for(const _ of m)s[_.fqid]=c}}return s}const io=32,Us=33,el=new Uint16Array(8184);for(let l=0;l<2046;l++){let t=l+2,s=0,c=0,m=0,_=0,v=0,S=0;for(1&t?m=_=v=io:s=c=S=io;(t>>=1)>1;){const k=s+m>>1,L=c+_>>1;1&t?(m=s,_=c,s=v,c=S):(s=m,c=_,m=v,_=S),v=k,S=L}const A=4*l;el[A+0]=s,el[A+1]=c,el[A+2]=m,el[A+3]=_}const Do=new Uint16Array(2178),Xn=new Uint8Array(1089),gu=new Uint16Array(1089);function na(l){return l===0?-.03125:l===32?.03125:0}const bc={type:2,extent:r.aj,loadGeometry:()=>[[new r.P(0,0),new r.P(r.aj+1,0),new r.P(r.aj+1,r.aj+1),new r.P(0,r.aj+1),new r.P(0,0)]]};class Ol{constructor(t,s,c,m,_,v){this.tileID=t,this.uid=r.a$(),this.uses=0,this.tileSize=s,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection),this.worldview=v}registerFadeDuration(t){const s=t+this.timeAdded;s<r.q.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,s,c){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Ho(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const _=this.buckets[m];if(_ instanceof r.b1){if(this.hasSymbolBuckets=!0,!c)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const _=this.buckets[m];if(_ instanceof r.b1&&_.hasRTLText){this.hasRTLText=!0,r.b2();break}}this.queryPadding=0;for(const m in this.buckets){const _=this.buckets[m],v=s.style.getOwnLayer(m);if(!v)continue;const S=v.queryRadius(_);this.queryPadding=Math.max(this.queryPadding,S)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new r.b0}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,s,c){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Ho(t.buckets,s.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const m in this.buckets){const _=this.buckets[m];_.uploadPending()&&_.upload(t)}const s=t.gl,c=this.imageAtlas;c&&!c.uploaded&&(this.imageAtlasTexture=new r.T(t,c.image,s.RGBA8,{useMipmap:!!c.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(t,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(t,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(t,s,c){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,c),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const m=s.style.getBrightness();(this._lastUpdatedBrightness||m)&&(this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this.updateBuckets(s,this._lastUpdatedBrightness!==m),this._lastUpdatedBrightness=m))}queryRenderedFeatures(t,s,c,m,_,v){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const S=function(A,k){const L=r.bn([],[.5*A.width,.5*-A.height,1]);return r.bo(L,L,[1,-1,0]),r.az(L,L,A.calculateProjMatrix(k.toUnwrapped())),Float32Array.from(L)}(_,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:s,pixelPosMatrix:S,transform:m,availableImages:c,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const m=c.loadVTLayers(),_=s?s.sourceLayer:"",v=m._geojsonTileLayer||m[_];if(!v)return;const S=r.b3(s&&s.filter),{z:A,x:k,y:L}=this.tileID.canonical,B={z:A,x:k,y:L};for(let O=0;O<v.length;O++){const j=v.feature(O);if(S.needGeometry){const Y=r.b4(j,!0);if(!S.filter(new r.aa(this.tileID.overscaledZ,{worldview:this.worldview}),Y,this.tileID.canonical))continue}else if(!S.filter(new r.aa(this.tileID.overscaledZ,{worldview:this.worldview}),j))continue;const X=c.getId(j,_),W=new r.b5(j,A,k,L,X);W.tile=B,t.push(W)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const c=r.b6(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let m=!1;if(this.expirationTime>c)m=!1;else if(s)if(this.expirationTime<s)m=!0;else{const _=this.expirationTime-s;_?this.expirationTime=c+Math.max(_,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,s){if(!this.latestFeatureIndex||!t.style)return;const c=this.latestFeatureIndex.loadVTLayers(),m=t.style.listImages(),_=t.style.getBrightness();for(const v in this.buckets){if(!t.style.hasLayer(v))continue;const S=this.buckets[v],A=S.layers[0],k=A.sourceLayer||"_geojsonTileLayer",L=c[k],B=t.style.getLayerSourceCache(A);let O={};B&&(O=B._state.getState(k,void 0));const j=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},X=Object.keys(O).length>0&&!s;X&&!S.stateDependentLayers.length&&!s||S.update(O,L,m,j,X?S.stateDependentLayers:S.layers,s,_),(S instanceof r.b7||S instanceof r.b8)&&t._terrain&&t._terrain.enabled&&B&&S.uploadPending()&&t._terrain._clearRenderCacheForTile(B.id,this.tileID);const W=t&&t.style&&t.style.getOwnLayer(v);W&&(this.queryPadding=Math.max(this.queryPadding,W.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=r.q.now()+t}setTexture(t,s){const c=s.context,m=c.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t):(this.texture=new r.T(c,t,m.RGBA8,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(t,s){const c={};for(const m of s)c[m]=!0;this.dependencies[t]=c}hasDependency(t,s){for(const c of t){const m=this.dependencies[c];if(m){for(const _ of s)if(m[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const c=r.b9(bc,this.tileID.canonical,this.tileTransform)[0],m=new r.ba,_=new r.bb;for(let v=0;v<c.length;v++){const{x:S,y:A}=c[v];m.emplaceBack(S,A),_.emplaceBack(v)}_.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(_),this._tileDebugBuffer=t.createVertexBuffer(m,r.bc.members),this._tileDebugSegments=r.bd.simpleSegment(0,0,m.length,_.length)}_makeTileBoundsBuffers(t,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const c=r.b9(bc,this.tileID.canonical,this.tileTransform)[0];let m,_;if(this.isRaster){const v=function(S,A){const k=r.aW(S,A),L=Math.pow(2,S.z);for(let Y=0;Y<Us;Y++)for(let J=0;J<Us;J++){const ie=r.aX((S.x+(J+na(J))/io)/L),ue=r.aY((S.y+(Y+na(Y))/io)/L),pe=A.project(ie,ue),be=Y*Us+J;Do[2*be+0]=Math.round((pe.x*k.scale-k.x)*r.aj),Do[2*be+1]=Math.round((pe.y*k.scale-k.y)*r.aj)}Xn.fill(0),gu.fill(0);for(let Y=2045;Y>=0;Y--){const J=4*Y,ie=el[J+0],ue=el[J+1],pe=el[J+2],be=el[J+3],Te=ie+pe>>1,xe=ue+be>>1,me=Te+xe-ue,Ee=xe+ie-Te,Ae=ue*Us+ie,Oe=be*Us+pe,Ge=xe*Us+Te,nt=Math.hypot((Do[2*Ae+0]+Do[2*Oe+0])/2-Do[2*Ge+0],(Do[2*Ae+1]+Do[2*Oe+1])/2-Do[2*Ge+1])>=16;Xn[Ge]=Xn[Ge]||(nt?1:0),Y<1022&&(Xn[Ge]=Xn[Ge]||Xn[(ue+Ee>>1)*Us+(ie+me>>1)]||Xn[(be+Ee>>1)*Us+(pe+me>>1)])}const B=new r.aZ,O=new r.a_;let j=0;function X(Y,J){const ie=J*Us+Y;return gu[ie]===0&&(B.emplaceBack(Do[2*ie+0],Do[2*ie+1],Y*r.aj/io,J*r.aj/io),gu[ie]=++j),gu[ie]-1}function W(Y,J,ie,ue,pe,be){const Te=Y+ie>>1,xe=J+ue>>1;if(Math.abs(Y-pe)+Math.abs(J-be)>1&&Xn[xe*Us+Te])W(pe,be,Y,J,Te,xe),W(ie,ue,pe,be,Te,xe);else{const me=X(Y,J),Ee=X(ie,ue),Ae=X(pe,be);O.emplaceBack(me,Ee,Ae)}}return W(0,0,io,io,io,0),W(io,io,0,0,0,io),{vertices:B,indices:O}}(this.tileID.canonical,s);m=v.vertices,_=v.indices}else{m=new r.aZ,_=new r.a_;for(const{x:S,y:A}of c)m.emplaceBack(S,A,0,0);const v=r.be(m.int16.subarray(0,4*m.length),void 0,4);for(let S=0;S<v.length;S+=3)_.emplaceBack(v[S],v[S+1],v[S+2])}this._tileBoundsBuffer=t.createVertexBuffer(m,r.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(_),this._tileBoundsSegments=r.bd.simpleSegment(0,0,m.length,_.length)}_makeGlobeTileDebugBuffers(t,s){const c=s.projection;if(!c||c.name!=="globe"||s.freezeTileCoverage)return;const m=this.tileID.canonical,_=r.bg(m,s),v=r.bh(_),S=r.ah(s.zoom);let A;S>0&&(A=r.bi(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,m,s,v,A,S),this._makeGlobeTileDebugTextBuffer(t,m,s,v,A,S)}_globePoint(t,s,c,m,_,v,S){let A=r.bj(t,s,c);if(v){const k=1<<c.z,L=r.aD(m.center.lng),B=r.aH(m.center.lat),O=(c.x+.5)/k-L;let j=0;O>.5?j=-1:O<-.5&&(j=1);let X=(t/r.aj+c.x)/k+j,W=(s/r.aj+c.y)/k;X=(X-L)*m._pixelsPerMercatorPixel+L,W=(W-B)*m._pixelsPerMercatorPixel+B;const Y=[X*m.worldSize,W*m.worldSize,0];r.ad(Y,Y,v),A=r.bk(A,Y,S)}return r.ad(A,A,_)}_makeGlobeTileDebugBorderBuffer(t,s,c,m,_,v){const S=new r.ba,A=new r.bb,k=new r.bl,L=(O,j,X,W,Y)=>{const J=(X-O)/(Y-1),ie=(W-j)/(Y-1),ue=S.length;for(let pe=0;pe<Y;pe++){const be=O+pe*J,Te=j+pe*ie;S.emplaceBack(be,Te);const xe=this._globePoint(be,Te,s,c,m,_,v);k.emplaceBack(xe[0],xe[1],xe[2]),A.emplaceBack(ue+pe)}},B=r.aj;L(0,0,B,0,16),L(B,0,B,B,16),L(B,B,0,B,16),L(0,B,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(A),this._tileDebugBuffer=t.createVertexBuffer(S,r.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(k,r.bm.members),this._tileDebugSegments=r.bd.simpleSegment(0,0,S.length,A.length)}_makeGlobeTileDebugTextBuffer(t,s,c,m,_,v){const S=r.aj/4,A=new r.ba,k=new r.a_,L=new r.bl,B=25;k.reserve(32),A.reserve(B),L.reserve(B);const O=(j,X)=>B*j+X;for(let j=0;j<B;j++){const X=j*S;for(let W=0;W<B;W++){const Y=W*S;A.emplaceBack(Y,X);const J=this._globePoint(Y,X,s,c,m,_,v);L.emplaceBack(J[0],J[1],J[2])}}for(let j=0;j<4;j++)for(let X=0;X<4;X++){const W=O(j,X),Y=O(j,X+1),J=O(j+1,X),ie=O(j+1,X+1);k.emplaceBack(W,Y,J),k.emplaceBack(J,Y,ie)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(k),this._tileDebugTextBuffer=t.createVertexBuffer(A,r.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(L,r.bm.members),this._tileDebugTextSegments=r.bd.simpleSegment(0,0,B,32)}destroy(t=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.bp.setPbf(r.bq);class Tc extends Ol{constructor(t,s,c,m,_){super(t,s,c,m,_),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,s){const c=s.context,m=c.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t,{premultiply:!1}):this.texture=new r.T(c,t,m.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,s){const c=this._mrt=new r.bp(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=r.br(m,(_,v,S,A)=>{if(_)s(_);else try{const k=c.getHeaderLength(v);if(k>t)return void(this.request=this.fetchHeader(k,s));c.parseHeader(v),this._isHeaderLoaded=!0;let L=0;for(const B of Object.values(c.layers))L=Math.max(L,B.dataIndex[B.dataIndex.length-1].lastByte);v.byteLength>=L&&(this.entireBuffer=v),s(null,this.entireBuffer||v,S,A)}catch(k){s(k)}}),this.request}fetchBand(t,s,c){const m=this._mrt;if(!this._isHeaderLoaded||!m)return void c(new Error("Tile header is not ready"));const _=this.actor;if(!_)return void c(new Error("Can't fetch tile band without an actor"));let v;const S=(B,O)=>{v.complete(B,O),B?c(B):(this.updateTextureDescriptor(t,s),c(null,this.textureDescriptor&&this.textureDescriptor.img))},A=(B,O)=>{if(B)return c(B);const j=_.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:O,task:v},S,void 0,!0);this._workQueue.push(()=>{j&&j.cancel(),v.cancel()})},k=m.getLayer(t);if(!k)return void c(new Error(`Unknown sourceLayer "${t}"`));if(k.hasDataForBand(s))return this.updateTextureDescriptor(t,s),void c(null,this.textureDescriptor?this.textureDescriptor.img:null);const L=k.getDataRange([s]);if(v=m.createDecodingTask(L),!v||v.tasks.length)if(this.flushQueues(),this.entireBuffer)A(null,this.entireBuffer.slice(L.firstByte,L.lastByte+1));else{const B=Object.assign({},this.requestParams,{headers:{Range:`bytes=${L.firstByte}-${L.lastByte}`}}),O=r.br(B,A);this._fetchQueue.push(()=>{O.cancel(),v.cancel()})}else c(null)}updateNeeded(t,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,s){if(!this._mrt)return;const c=this._mrt.getLayer(t);if(!c||!c.hasBand(s)||!c.hasDataForBand(s))return;const{bytes:m,tileSize:_,buffer:v,offset:S,scale:A}=c.getBandView(s),k=_+2*v,L=new r.r({width:k,height:k},m),B=this.texture;B&&B instanceof r.T&&B.update(L,{premultiply:!1}),this.textureDescriptor={layer:t,band:s,img:L,buffer:v,offset:S,tileSize:_,format:c.pixelFormat,mix:[A,256*A,65536*A,16777216*A]}}}class _d{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,c){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const _={value:s,timeout:void 0};if(c!==void 0&&(_.timeout=setTimeout(()=>{this.remove(t,_)},c)),this.data[m].push(_),this.order.push(m),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const c=t.wrapped().key,m=s===void 0?0:this.data[c].indexOf(s),_=this.data[c][m];return this.data[c].splice(m,1),_.timeout&&clearTimeout(_.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(_.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const c in this.data)for(const m of this.data[c])t(m.value)||s.push(m);for(const c of s)this.remove(c.value.tileID,c)}}class fh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,c){const m=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},r.h(this.stateChanges[t][m],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==m&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const _ in this.state[t][m])c[_]||(this.deletedStates[t][m][_]=null)}else for(const _ in c)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][_]===null&&delete this.deletedStates[t][m][_]}removeFeatureState(t,s,c){if(this.deletedStates[t]===null)return;const m=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&s!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][c]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(c in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][c]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,s){const c=this.state[t]||{},m=this.stateChanges[t]||{},_=this.deletedStates[t];if(_===null)return{};if(s!==void 0){const S=String(s),A=r.h({},c[S],m[S]);if(_){const k=_[s];if(k===null)return{};for(const L in k)delete A[L]}return A}const v=r.h({},c,m);if(_)for(const S in _)delete v[S];return v}initializeTileState(t,s){t.refreshFeatureState(s)}coalesceChanges(t,s){const c={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const _={};for(const v in this.stateChanges[m])this.state[m][v]||(this.state[m][v]={}),r.h(this.state[m][v],this.stateChanges[m][v]),_[v]=this.state[m][v];c[m]=_}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const _={};if(this.deletedStates[m]===null)for(const v in this.state[m])_[v]={},this.state[m][v]={};else for(const v in this.deletedStates[m]){if(this.deletedStates[m][v]===null)this.state[m][v]={};else if(this.state[m][v])for(const S of Object.keys(this.deletedStates[m][v]))delete this.state[m][v][S];_[v]=this.state[m][v]}c[m]=c[m]||{},r.h(c[m],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const m in t)t[m].refreshFeatureState(s)}}class bs extends r.E{constructor(t,s,c){super(),this.id=t,this._onlySymbols=c,s.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new _d(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new fh,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,s){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const c=this._tiles[s];c.upload(t),c.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(po).map(t=>t.key)}getRenderableIds(t,s){const c=[];for(const m in this._tiles)this._isIdRenderable(+m,t,s)&&c.push(this._tiles[m]);return t?c.sort((m,_)=>{const v=m.tileID,S=_.tileID,A=new r.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),k=new r.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-S.overscaledZ||k.y-A.y||k.x-A.x}).map(m=>m.tileID.key):c.map(m=>m.tileID).sort(po).map(m=>m.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s,c){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())&&(c||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,s){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,t,s)))}_tileLoaded(t,s,c,m){if(m)if(t.state="errored",m.status!==404)this._source.fire(new r.z(m,{tile:t}));else{if(this._source.fire(new r.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=r.q.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new r.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const s=this.getRenderableIds();for(let m=0;m<s.length;m++){const _=s[m];if(t.neighboringTiles&&t.neighboringTiles[_]){const v=this.getTileByID(_);c(t,v),c(v,t)}}function c(m,_){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let v=_.tileID.canonical.x-m.tileID.canonical.x;const S=_.tileID.canonical.y-m.tileID.canonical.y,A=Math.pow(2,m.tileID.canonical.z),k=_.tileID.key;v===0&&S===0||Math.abs(S)>1||(Math.abs(v)>1&&(Math.abs(v+A)===1?v+=A:Math.abs(v-A)===1&&(v-=A)),_.dem&&m.dem&&(m.dem.backfillBorder(_.dem,v,S),m.neighboringTiles&&m.neighboringTiles[k]&&(m.neighboringTiles[k].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,c,m){for(const _ in this._tiles){let v=this._tiles[_];if(m[_]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>c)continue;let S=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const k=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[k.key],v&&v.hasData()&&(S=k)}let A=S;for(;A.overscaledZ>s;)if(A=A.scaledTo(A.overscaledZ-1),t[A.key]){m[S.key]=S;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=t.overscaledZ-1;c>=s;c--){const m=t.scaledTo(c),_=this._getLoadedTile(m);if(_)return _}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,s){s=s||this._source.tileSize;const c=Math.ceil(t.width/s)+1,m=Math.ceil(t.height/s)+1,_=Math.floor(c*m*5),v=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(S)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const c={};for(const m in this._tiles){const _=this._tiles[m];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+s),c[_.tileID.key]=_}this._tiles=c;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(t,s,c,m,_){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;this.updateCacheSize(t,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const v=this._source.type==="batched-model";let S,A=this._source.maxzoom;const k=this.map&&this.map.painter?this.map.painter._terrain:null;if(k&&k.sourceCache===this&&k.attenuationRange()){const O=k.attenuationRange()[0],j=Math.floor(O)-Math.log2(k.getDemUpscale());A>j&&(A=j)}if(this.used||this.usedForTerrain){if(this._source.tileID)S=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new r.aM(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y));else if(this.tileCoverLift!==0){const O=t.clone();O.tileCoverLift=this.tileCoverLift,S=O.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&t.projection.name==="globe"&&(S.push(new r.aM(1,0,1,0,0)),S.push(new r.aM(1,0,1,1,0)),S.push(new r.aM(1,0,1,0,1)),S.push(new r.aM(1,0,1,1,1)))}else if(S=t.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){const O=this._source.hasTile.bind(this._source);S=S.filter(j=>O(j))}}else S=[];if(S.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Wo(this._source.type)){const O=t.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!c}),j=Math.min(O,this._source.maxzoom);if(v){const X=t.extendTileCover(S,j);for(const W of X)S.push(W)}else if(_){const X=t.extendTileCover(S,j,this.transform._camera.forward());for(const W of X)S.push(W)}else if(this.castsShadows&&m){const X=t.extendTileCover(S,j,m);for(const W of X)this._shadowCasterTiles[W.key]=!0,S.push(W)}}const L=this._updateRetainedTiles(S);if(Wo(this._source.type)&&S.length!==0){const O={},j={},X=Object.keys(L);for(const Y of X){const J=L[Y],ie=this._tiles[Y];if(!ie||ie.fadeEndTime&&ie.fadeEndTime<=r.q.now())continue;const ue=this.findLoadedParent(J,Math.max(J.overscaledZ-bs.maxOverzooming,this._source.minzoom));ue&&(this._addTile(ue.tileID),O[ue.tileID.key]=ue.tileID),j[Y]=J}const W=S[S.length-1].overscaledZ;for(const Y in this._tiles){const J=this._tiles[Y];if(L[Y]||!J.hasData())continue;let ie=J.tileID;for(;ie.overscaledZ>W;){ie=ie.scaledTo(ie.overscaledZ-1);const ue=this._tiles[ie.key];if(ue&&ue.hasData()&&j[ie.key]){L[Y]=J.tileID;break}}}for(const Y in O)L[Y]||(this._coveredTiles[Y]=!0,L[Y]=O[Y])}for(const O in L)this._tiles[O].clearFadeHold();const B=r.bs(this._tiles,L);for(const O of B){const j=this._tiles[O];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(+O)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const s={};if(t.length===0)return s;const c={},m=t.reduce((k,L)=>Math.min(k,L.overscaledZ),1/0),_=t[0].overscaledZ,v=Math.max(_-bs.maxOverzooming,this._source.minzoom),S=Math.max(_+bs.maxUnderzooming,this._source.minzoom),A={};for(const k of t){const L=this._addTile(k);s[k.key]=k,L.hasData()||m<this._source.maxzoom&&(A[k.key]=k)}this._retainLoadedChildren(A,m,S,s);for(const k of t){let L=this._tiles[k.key];if(L.hasData())continue;if(k.canonical.z>=this._source.maxzoom){const O=k.children(this._source.maxzoom)[0],j=this.getTile(O);if(j&&j.hasData()){s[O.key]=O;continue}}else{const O=k.children(this._source.maxzoom);if(s[O[0].key]&&s[O[1].key]&&s[O[2].key]&&s[O[3].key])continue}let B=L.wasRequested();for(let O=k.overscaledZ-1;O>=v;--O){const j=k.scaledTo(O);if(c[j.key]||(c[j.key]=!0,L=this.getTile(j),!L&&B&&(L=this._addTile(j)),L&&(s[j.key]=j,B=L.wasRequested(),L.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let c,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){c=this._loadedParentTiles[m.key];break}s.push(m.key);const _=m.scaledTo(m.overscaledZ-1);if(c=this._getLoadedTile(_),c)break;m=_}for(const _ of s)this._loadedParentTiles[_]=c}}_addTile(t){let s=this._tiles[t.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const c=!!s;if(!c){const m=this.map?this.map.painter:null,_=this._source.tileSize*t.overscaleFactor();s=this._source.type==="raster-array"?new Tc(t,_,this.transform.tileZoom,m,this._isRaster):new Ol(t,_,this.transform.tileZoom,m,this._isRaster,this._source.worldview),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))}return s.uses++,this._tiles[t.key]=s,c||this._source.fire(new r.A("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=s.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,s,c){const m=[],_=this.transform;if(!_)return m;const v=_.projection.name==="globe",S=r.aD(_.center.lng);for(const A in this._tiles){const k=this._tiles[A];if(c&&k.clearQueryDebugViz(),k.holdingForFade())continue;let L;if(v){const B=k.tileID.canonical;if(B.z===0){const O=[Math.abs(r.ay(S,...Lo(B,-1))-S),Math.abs(r.ay(S,...Lo(B,1))-S)];L=[0,2*O.indexOf(Math.min(...O))-1]}else{const O=[Math.abs(r.ay(S,...Lo(B,-1))-S),Math.abs(r.ay(S,...Lo(B,0))-S),Math.abs(r.ay(S,...Lo(B,1))-S)];L=[O.indexOf(Math.min(...O))-1]}}else L=[0];for(const B of L){const O=t.containsTile(k,_,s,B);O&&m.push(O)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,s){const c=this.getRenderableIds(t,s).map(_=>this._tiles[_].tileID),m=this.transform.projection.name==="globe";for(const _ of c)_.projMatrix=this.transform.calculateProjMatrix(_.toUnwrapped()),_.expandedProjMatrix=m?this.transform.calculateProjMatrix(_.toUnwrapped(),!1,!0):_.projMatrix;return c}sortCoordinatesByDistance(t){const s=t.slice(),c=this.transform._camera.position,m=this.transform._camera.forward(),_={};for(const v of s){const S=1/(1<<v.canonical.z);_[v.key]=((v.canonical.x+.5)*S+v.wrap-c[0])*m[0]+((v.canonical.y+.5)*S-c[1])*m[1]-c[2]*m[2]}return s.sort((v,S)=>_[v.key]-_[S.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(Wo(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=r.q.now())return!0}return!1}setFeatureState(t,s,c){this._state.updateState(t=t||"_geojsonTileLayer",s,c)}removeFeatureState(t,s,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,c)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,c){const m=this._tiles[t];m&&m.setDependencies(s,c)}reloadTilesForDependencies(t,s){for(const c in this._tiles)this._tiles[c].hasDependency(t,s)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(t,s))}_preloadTiles(t,s){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(t,s))};return void this._source.on("data",A)}const c=new Map,m=Array.isArray(t)?t:[t],_=this.map.painter.terrain,v=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const A of m){const k=A.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of k)c.set(L.key,L);this.usedForTerrain&&A.updateElevation(!1)}const S=Array.from(c.values());r.bt(S,(A,k)=>{const L=new Ol(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(L,B=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),k(B,L)})},s)}}function po(l,t){const s=Math.abs(2*l.wrap)-+(l.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return l.overscaledZ-t.overscaledZ||c-s||t.canonical.y-l.canonical.y||t.canonical.x-l.canonical.x}function Wo(l){return l==="raster"||l==="image"||l==="video"||l==="custom"}function Lo(l,t){const s=1<<l.z;return[l.x/s+t,(l.x+1)/s+t]}bs.maxOverzooming=10,bs.maxUnderzooming=3;class _u{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,s=!1;for(const c in this.style._mergedLayers){const m=this.style._mergedLayers[c];if(m.type==="fill-extrusion"||m.type==="building")this.layers.push({layer:m,visible:t,visibilityChanged:s});else if(m.type==="model"){const _=this.style.getLayerSource(m);_&&_.type==="batched-model"&&this.layers.push({layer:m,visible:t,visibilityChanged:s})}}}onNewFrame(t){this.layersGotHidden=!1;for(const s of this.layers){const c=s.layer;let m=!1;c.type==="fill-extrusion"?m=!c.isHidden(t)&&c.paint.get("fill-extrusion-opacity")>0:c.type==="building"?m=!c.isHidden(t)&&c.paint.get("building-opacity")>0:c.type==="model"&&(m=!c.isHidden(t)&&c.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!m&&s.visible,s.visible=m}}updateZOffset(t,s){this.currentBuildingBuckets=[];for(const m of this.layers){const _=m.layer,v=this.style.getLayerSourceCache(_);let S=1;_.type==="fill-extrusion"?S=m.visible?_.paint.get("fill-extrusion-vertical-scale"):0:_.type==="building"&&(S=m.visible?_.paint.get("building-vertical-scale"):0);let A=v?v.getTile(s):null;if(!A&&v&&s.canonical.z>v.getSource().minzoom){let k=s.scaledTo(Math.min(v.getSource().maxzoom,s.overscaledZ-1));for(;k.overscaledZ>=v.getSource().minzoom&&(A=v.getTile(k),!A&&k.overscaledZ!==0);)k=k.scaledTo(k.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:A?A.getBucket(_):null,tileID:A?A.tileID:s,verticalScale:S})}t.hasAnyZOffset=!1;let c=!1;for(let m=0;m<t.symbolInstances.length;m++){const _=t.symbolInstances.get(m),v=_.zOffset,S=this._getHeightAtTileOffset(s,_.tileAnchorX,_.tileAnchorY);_.zOffset=S!==Number.NEGATIVE_INFINITY?S:v,c||v===_.zOffset||(c=!0),t.hasAnyZOffset||_.zOffset===0||(t.hasAnyZOffset=!0)}c&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,s,c,m){let _=s,v=c;if(t.canonical.z!==m.canonical.z){const S=m.canonical,A=1/(1<<t.canonical.z-S.z);_=(s+t.canonical.x*r.aj)*A-S.x*r.aj|0,v=(c+t.canonical.y*r.aj)*A-S.y*r.aj|0}return{tileX:_,tileY:v}}_getHeightAtTileOffset(t,s,c){let m,_;for(let v=0;v<this.layers.length;++v){const S=this.layers[v].layer;if(S.type!=="fill-extrusion"&&S.type!=="building")continue;const{bucket:A,tileID:k,verticalScale:L}=this.currentBuildingBuckets[v];if(!A)continue;const{tileX:B,tileY:O}=this._mapCoordToOverlappingTile(t,s,c,k),j=A.getHeightAtTileCoord(B,O);j&&j.height!==void 0&&(j.hidden?m=j.height:_=Math.max(j.height*L,_||0))}if(_!==void 0)return _;for(let v=0;v<this.layers.length;++v){const S=this.layers[v];if(S.layer.type!=="model"||!S.visible)continue;const{bucket:A,tileID:k}=this.currentBuildingBuckets[v];if(!A)continue;const{tileX:L,tileY:B}=this._mapCoordToOverlappingTile(t,s,c,k),O=A.getHeightAtTileCoord(L,B);if(O&&!O.hidden)return O.height===void 0&&m!==void 0?Math.min(O.maxHeight,m)*O.verticalScale:O.height?O.height*O.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function yu(l,t){const s={};for(const c in l)c!=="ref"&&(s[c]=l[c]);return r.bu.forEach(c=>{c in t&&(s[c]=t[c])}),s}function qo(l){l=l.slice();const t=Object.create(null);for(let s=0;s<l.length;s++)t[l[s].id]=l[s];for(let s=0;s<l.length;s++)"ref"in l[s]&&(l[s]=yu(l[s],t[l[s].ref]));return l}const pn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function ph(l,t,s){s.push({command:pn.addSource,args:[l,t[l]]})}function Sa(l,t,s){t.push({command:pn.removeSource,args:[l]}),s[l]=!0}function mh(l,t,s,c){Sa(l,s,c),ph(l,t,s)}function Ep(l,t,s){let c;for(c in l[s])if(l[s].hasOwnProperty(c)&&c!=="data"&&!r.bv(l[s][c],t[s][c]))return!1;for(c in t[s])if(t[s].hasOwnProperty(c)&&c!=="data"&&!r.bv(l[s][c],t[s][c]))return!1;return!0}function Nl(l,t,s,c,m,_){let v;for(v in t=t||{},l=l||{})l.hasOwnProperty(v)&&(r.bv(l[v],t[v])||s.push({command:_,args:[c,v,t[v],m]}));for(v in t)t.hasOwnProperty(v)&&!l.hasOwnProperty(v)&&(r.bv(l[v],t[v])||s.push({command:_,args:[c,v,t[v],m]}))}function Bl(l){return l.id}function jl(l,t){return l[t.id]=t,l}class Sc{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=r.ay(t,0,1);let s=1,c=this._distances[s];const m=t*this.paddedLength+this.padding;for(;c<m&&s<this._distances.length;)c=this._distances[++s];const _=s-1,v=this._distances[_],S=c-v,A=S>0?(m-v)/S:0;return this.points[_].mult(1-A).add(this.points[s].mult(A))}}class Ec{constructor(t,s,c){const m=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(s/c);for(let v=0;v<this.xCellCount*this.yCellCount;v++)m.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,c,m,_){this._forEachCell(s,c,m,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(_)}insertCircle(t,s,c,m){this._forEachCell(s-m,c-m,s+m,c+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(c),this.circles.push(m)}_insertBoxCell(t,s,c,m,_,v){this.boxCells[_].push(v)}_insertCircleCell(t,s,c,m,_,v){this.circleCells[_].push(v)}_query(t,s,c,m,_,v){if(c<0||t>this.width||m<0||s>this.height)return!_&&[];const S=[];if(t<=0&&s<=0&&this.width<=c&&this.height<=m){if(_)return!0;for(let A=0;A<this.boxKeys.length;A++)S.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const k=this.circles[3*A],L=this.circles[3*A+1],B=this.circles[3*A+2];S.push({key:this.circleKeys[A],x1:k-B,y1:L-B,x2:k+B,y2:L+B})}return v?S.filter(v):S}return this._forEachCell(t,s,c,m,this._queryCell,S,{hitTest:_,seenUids:{box:{},circle:{}}},v),_?S.length>0:S}_queryCircle(t,s,c,m,_){const v=t-c,S=t+c,A=s-c,k=s+c;if(S<0||v>this.width||k<0||A>this.height)return!m&&[];const L=[];return this._forEachCell(v,A,S,k,this._queryCellCircle,L,{hitTest:m,circle:{x:t,y:s,radius:c},seenUids:{box:{},circle:{}}},_),m?L.length>0:L}query(t,s,c,m,_){return this._query(t,s,c,m,!1,_)}hitTest(t,s,c,m,_){return this._query(t,s,c,m,!0,_)}hitTestCircle(t,s,c,m){return this._queryCircle(t,s,c,!0,m)}_queryCell(t,s,c,m,_,v,S,A){const k=S.seenUids,L=this.boxCells[_];if(L!==null){const O=this.bboxes;for(const j of L)if(!k.box[j]){k.box[j]=!0;const X=4*j;if(t<=O[X+2]&&s<=O[X+3]&&c>=O[X+0]&&m>=O[X+1]&&(!A||A(this.boxKeys[j]))){if(S.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[j],x1:O[X],y1:O[X+1],x2:O[X+2],y2:O[X+3]})}}}const B=this.circleCells[_];if(B!==null){const O=this.circles;for(const j of B)if(!k.circle[j]){k.circle[j]=!0;const X=3*j;if(this._circleAndRectCollide(O[X],O[X+1],O[X+2],t,s,c,m)&&(!A||A(this.circleKeys[j]))){if(S.hitTest)return v.push(!0),!0;{const W=O[X],Y=O[X+1],J=O[X+2];v.push({key:this.circleKeys[j],x1:W-J,y1:Y-J,x2:W+J,y2:Y+J})}}}}}_queryCellCircle(t,s,c,m,_,v,S,A){const k=S.circle,L=S.seenUids,B=this.boxCells[_];if(B!==null){const j=this.bboxes;for(const X of B)if(!L.box[X]){L.box[X]=!0;const W=4*X;if(this._circleAndRectCollide(k.x,k.y,k.radius,j[W+0],j[W+1],j[W+2],j[W+3])&&(!A||A(this.boxKeys[X])))return v.push(!0),!0}}const O=this.circleCells[_];if(O!==null){const j=this.circles;for(const X of O)if(!L.circle[X]){L.circle[X]=!0;const W=3*X;if(this._circlesCollide(j[W],j[W+1],j[W+2],k.x,k.y,k.radius)&&(!A||A(this.circleKeys[X])))return v.push(!0),!0}}}_forEachCell(t,s,c,m,_,v,S,A){const k=this._convertToXCellCoord(t),L=this._convertToYCellCoord(s),B=this._convertToXCellCoord(c),O=this._convertToYCellCoord(m);for(let j=k;j<=B;j++)for(let X=L;X<=O;X++)if(_.call(this,t,s,c,m,this.xCellCount*X+j,v,S,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,c,m,_,v){const S=m-t,A=_-s,k=c+v;return k*k>S*S+A*A}_circleAndRectCollide(t,s,c,m,_,v,S){const A=(v-m)/2,k=Math.abs(t-(m+A));if(k>A+c)return!1;const L=(S-_)/2,B=Math.abs(s-(_+L));if(B>L+c)return!1;if(k<=A||B<=L)return!0;const O=k-A,j=B-L;return O*O+j*j<=c*c}}const Zo={unknown:0,flipRequired:1,flipNotRequired:2},gh=Math.tan(85*Math.PI/180);function tl(l,t,s,c,m,_,v){const S=r.bz();if(s)if(_.name==="globe"){const A=r.bA(m,t);r.az(S,S,A)}else{const A=r.bB([],v);S[0]=A[0],S[1]=A[1],S[4]=A[2],S[5]=A[3],c||r.by(S,S,m.angle)}else r.az(S,m.labelPlaneMatrix,l);return S}function yd(l,t,s,c,m,_,v){const S=tl(l,t,s,c,m,_,v);return _.name==="globe"&&s||(S[2]=S[6]=S[10]=S[14]=0),S}function xu(l,t,s,c,m,_,v){if(s){if(_.name==="globe"){const S=tl(l,t,s,c,m,_,v);return r.bi(S,S),r.az(S,l,S),S}{const S=r.bw(l),A=r.bx([]);return A[0]=v[0],A[1]=v[1],A[4]=v[2],A[5]=v[3],r.az(S,S,A),c||r.by(S,S,-m.angle),S}}return m.glCoordMatrix}function mo(l,t,s,c){const m=[l,t,s,1];s?r.aA(m,m,c):mn(m,m,c);const _=m[3];return m[0]/=_,m[1]/=_,m[2]/=_,m}function Cc(l,t){return Math.min(.5+l/t*.5,1.5)}function Vl(l,t){const s=l[0]/l[3],c=l[1]/l[3];return s>=-t[0]&&s<=t[0]&&c>=-t[1]&&c<=t[1]}function ra(l,t,s,c,m,_,v,S,A,k){const L=s.transform,B=c?l.textSizeData:l.iconSizeData,O=r.bH(B,s.transform.zoom),j=L.projection.name==="globe",X=[256/s.width*2+1,256/s.height*2+1],W=c?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;W.clear();let Y=null;j&&(Y=c?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const J=l.lineVertexArray,ie=c?l.text.placedSymbolArray:l.icon.placedSymbolArray,ue=s.transform.width/s.transform.height;let pe,be=!1;for(let Te=0;Te<ie.length;Te++){const xe=ie.get(Te),{numGlyphs:me,writingMode:Ee}=xe;if(Ee!==r.bI.vertical||be||pe===r.bI.horizontal||(be=!0),pe=Ee,(xe.hidden||Ee===r.bI.vertical)&&!be){hs(me,W);continue}be=!1;const Ae=new r.P(xe.tileAnchorX,xe.tileAnchorY);let{x:Oe,y:Ge,z:nt}=L.projection.projectTilePoint(Ae.x,Ae.y,k.canonical);if(A){const[jt,Wt,Ot]=A(Ae);Oe+=jt,Ge+=Wt,nt+=Ot}const it=[Oe,Ge,nt,1];if(r.aA(it,it,t),!Vl(it,X)){hs(me,W);continue}const ht=it[3],Be=Cc(s.transform.getCameraToCenterDistance(L.projection),ht),Xe=r.bJ(B,O,xe),ke=v?Xe/Be:Xe*Be,st=mo(Oe,Ge,nt,m);if(st[3]<=0){hs(me,W);continue}let We={};const ut=r.al(l.layers[0].layout.get("text-max-angle")),Et=Math.cos(ut),ot=v?null:A,yt=Ul(xe,ke,!1,S,t,m,_,l.glyphOffsetArray,J,W,Y,st,Ae,We,ue,ot,L.projection,k,v,Et);be=yt.useVertical,ot&&yt.needsFlipping&&(We={}),(yt.notEnoughRoom||be||yt.needsFlipping&&Ul(xe,ke,!0,S,t,m,_,l.glyphOffsetArray,J,W,Y,st,Ae,We,ue,ot,L.projection,k,v,Et).notEnoughRoom)&&hs(me,W)}c?(l.text.dynamicLayoutVertexBuffer.updateData(W),Y&&l.text.globeExtVertexBuffer&&l.text.globeExtVertexBuffer.updateData(Y)):(l.icon.dynamicLayoutVertexBuffer.updateData(W),Y&&l.icon.globeExtVertexBuffer&&l.icon.globeExtVertexBuffer.updateData(Y))}function _h(l,t,s,c,m,_,v,S,A,k,L,B,O,j,X,W,Y){const{lineStartIndex:J,glyphStartIndex:ie,segment:ue}=S,pe=ie+S.numGlyphs,be=J+S.lineLength,Te=t.getoffsetX(ie),xe=t.getoffsetX(pe-1),me=Ic(l*Te,s,c,m,_,v,ue,J,be,A,k,L,B,O,!0,j,X,W,Y);if(!me)return null;const Ee=Ic(l*xe,s,c,m,_,v,ue,J,be,A,k,L,B,O,!0,j,X,W,Y);return Ee?{first:me,last:Ee}:null}function Ac(l,t,s,c){return l===r.bI.horizontal&&Math.abs(c)>Math.abs(s)?{useVertical:!0}:l===r.bI.vertical?c>0?{needsFlipping:!0}:null:t!==Zo.unknown&&function(m,_){return m===0||Math.abs(_/m)>gh}(s,c)?t===Zo.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function Ul(l,t,s,c,m,_,v,S,A,k,L,B,O,j,X,W,Y,J,ie,ue){const pe=t/24,be=l.lineOffsetX*pe,Te=l.lineOffsetY*pe,{lineStartIndex:xe,glyphStartIndex:me,numGlyphs:Ee,segment:Ae,writingMode:Oe,flipState:Ge}=l,nt=xe+l.lineLength,it=ht=>{if(L){const[st,We,ut]=ht.up,Et=k.length;r.bK(L,Et+0,st,We,ut),r.bK(L,Et+1,st,We,ut),r.bK(L,Et+2,st,We,ut),r.bK(L,Et+3,st,We,ut)}const[Be,Xe,ke]=ht.point;r.bL(k,Be,Xe,ke,ht.angle)};if(Ee>1){const ht=_h(pe,S,be,Te,s,B,O,l,A,_,j,W,!1,Y,J,ie,ue);if(!ht)return{notEnoughRoom:!0};if(c&&!s){let[Be,Xe,ke]=ht.first.point,[st,We,ut]=ht.last.point;[Be,Xe]=mo(Be,Xe,ke,v),[st,We]=mo(st,We,ut,v);const Et=Ac(Oe,Ge,(st-Be)*X,We-Xe);if(l.flipState=Et&&Et.needsFlipping?Zo.flipRequired:Zo.flipNotRequired,Et)return Et}it(ht.first);for(let Be=me+1;Be<me+Ee-1;Be++){const Xe=Ic(pe*S.getoffsetX(Be),be,Te,s,B,O,Ae,xe,nt,A,_,j,W,!1,!1,Y,J,ie,ue);if(!Xe)return k.length-=4*(Be-me),{notEnoughRoom:!0};it(Xe)}it(ht.last)}else{if(c&&!s){const Be=mo(O.x,O.y,0,m),Xe=xe+Ae+1,ke=new r.P(A.getx(Xe),A.gety(Xe)),st=mo(ke.x,ke.y,0,m),We=st[3]>0?st:vu(O,ke,Be,1,m,void 0,Y,J.canonical),ut=Ac(Oe,Ge,(We[0]-Be[0])*X,We[1]-Be[1]);if(l.flipState=ut&&ut.needsFlipping?Zo.flipRequired:Zo.flipNotRequired,ut)return ut}const ht=Ic(pe*S.getoffsetX(me),be,Te,s,B,O,Ae,xe,nt,A,_,j,W,!1,!1,Y,J,ie,ue);if(!ht)return{notEnoughRoom:!0};it(ht)}return{}}function Ls(l,t,s,c,m){const{x:_,y:v,z:S}=c.projectTilePoint(l.x,l.y,t);if(!m)return mo(_,v,S,s);const[A,k,L]=m(l);return mo(_+A,v+k,S+L,s)}function vu(l,t,s,c,m,_,v,S){const A=Ls(l.sub(t)._unit()._add(l),S,m,v,_);return r.at(A,s,A),r.au(A,A),r.bE(A,s,A,c)}function Ic(l,t,s,c,m,_,v,S,A,k,L,B,O,j,X,W,Y,J,ie){const ue=c?l-t:l+t;let pe=ue>0?1:-1,be=0;c&&(pe*=-1,be=Math.PI),pe<0&&(be+=Math.PI);let Te=S+v+(pe>0?0:1)|0,xe=m,me=m,Ee=0,Ae=0;const Oe=Math.abs(ue),Ge=[],nt=[];let it=_,ht=it,Be=r.bC([]);const Xe=()=>vu(ht,it,me,Oe-Ee+1,L,O,W,Y.canonical);for(;Ee+Ae<=Oe;){if(Te+=pe,Te<S||Te>=A)return null;if(me=xe,ht=it,Ge.push(me),j&&nt.push(ht),it=new r.P(k.getx(Te),k.gety(Te)),xe=B[Te],!xe){const Ot=Ls(it,Y.canonical,L,W,O);xe=Ot[3]>0?B[Te]=Ot:Xe()}Ee+=Ae;const jt=r.at([],xe,me),Wt=r.bD(me,xe);if(s&&Wt>0&&Ae>0&&r.bG(Be,jt)/(Ae*Wt)<ie)return null;Ae=Wt,Be=jt}X&&O&&(B[Te]&&(xe=Xe(),Ae=r.bD(me,xe),Be=r.at([],xe,me)),B[Te]=xe);const ke=(Oe-Ee)/Ae,st=it.sub(ht)._mult(ke)._add(ht),We=r.bE([],me,Be,ke);let ut=[0,0,1],Et=Be[0],ot=Be[1];if(J&&(ut=W.upVector(Y.canonical,st.x,st.y),ut[0]!==0||ut[1]!==0||ut[2]!==1)){const jt=[ut[2],0,-ut[0]],Wt=r.bF([],ut,jt);r.au(jt,jt),r.au(Wt,Wt),Et=r.bG(Be,jt),ot=r.bG(Be,Wt)}if(s){const jt=r.bF([],ut,Be);r.au(jt,jt),r.bE(We,We,jt,s*pe)}const yt=be+Math.atan2(ot,Et);return Ge.push(We),j&&nt.push(st),{point:We,angle:yt,path:Ge,tilePath:nt,up:ut}}function hs(l,t){const s=t.length,c=s+4*l;t.resize(c),t.float32.fill(-1/0,4*s,4*c)}function mn(l,t,s){const c=t[0],m=t[1];return l[0]=s[0]*c+s[4]*m+s[12],l[1]=s[1]*c+s[5]*m+s[13],l[3]=s[3]*c+s[7]*m+s[15],l}const zo=100;class yh{constructor(t,s,c=new Ec(t.width+200,t.height+200,25),m=new Ec(t.width+200,t.height+200,25)){this.transform=t,this.grid=c,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+zo,this.screenBottomBoundary=t.height+zo,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,c,m,_,v,S,A){let k=c.projectedAnchorX,L=c.projectedAnchorY,B=c.projectedAnchorZ;const O=c.elevation,j=c.tileID,X=t.getProjection();if(O&&j){const[Te,xe,me]=X.upVector(j.canonical,c.tileAnchorX,c.tileAnchorY),Ee=X.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=Te*O*Ee,L+=xe*O*Ee,B+=me*O*Ee}const W=this.projectAndGetPerspectiveRatio(S,k,L,B,c.tileID,X.name==="globe"||!!O||this.transform.pitch>0,X),Y=v*W.perspectiveRatio,J=(c.x1*s+m.x-c.padding)*Y+W.point.x,ie=(c.y1*s+m.y-c.padding)*Y+W.point.y,ue=(c.x2*s+m.x+c.padding)*Y+W.point.x,pe=(c.y2*s+m.y+c.padding)*Y+W.point.y,be=W.perspectiveRatio<=.55||W.occluded;return!this.isInsideGrid(J,ie,ue,pe)||!_&&this.grid.hitTest(J,ie,ue,pe,A)||be?{box:[],offscreen:!1,occluded:W.occluded}:{box:[J,ie,ue,pe],offscreen:this.isOffscreen(J,ie,ue,pe),occluded:!1}}placeCollisionCircles(t,s,c,m,_,v,S,A,k,L,B,O,j,X,W){const Y=[],J=this.transform.elevation,ie=t.getProjection(),ue=J?J.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,ie):null,pe=new r.P(c.tileAnchorX,c.tileAnchorY);let{x:be,y:Te,z:xe}=ie.projectTilePoint(pe.x,pe.y,W.canonical);if(ue){const[ut,Et,ot]=ue(pe);be+=ut,Te+=Et,xe+=ot}const me=ie.name==="globe",Ee=this.projectAndGetPerspectiveRatio(S,be,Te,xe,W,me||!!J||this.transform.pitch>0,ie),{perspectiveRatio:Ae}=Ee,Oe=(B?v/Ae:v*Ae)/r.bO,Ge=mo(be,Te,xe,A),nt=c.lineOffsetX*Oe,it=c.lineOffsetY*Oe,ht=r.al(t.layers[0].layout.get("text-max-angle")),Be=Math.cos(ht),Xe=Ee.signedDistanceFromCamera>0?_h(Oe,_,nt,it,!1,Ge,pe,c,m,A,{},J&&!B?ue:null,B&&!!J,ie,W,B,Be):null;let ke=!1,st=!1,We=!0;if(Xe&&!Ee.occluded){const ut=.5*j*Ae+X,Et=new r.P(-100,-100),ot=new r.P(this.screenRightBoundary,this.screenBottomBoundary),yt=new Sc,{first:jt,last:Wt}=Xe,Ot=jt.path.length;let Zt=[];for(let wi=Ot-1;wi>=1;wi--)Zt.push(jt.path[wi]);for(let wi=1;wi<Wt.path.length;wi++)Zt.push(Wt.path[wi]);const ai=2.5*ut;k&&(Zt=Zt.map(([wi,Ni,cn],Un)=>(ue&&!me&&(cn=ue(Un<Ot-1?jt.tilePath[Ot-1-Un]:Wt.tilePath[Un-Ot+2])[2]),mo(wi,Ni,cn,k))),Zt.some(wi=>wi[3]<=0)&&(Zt=[]));let ui=[];if(Zt.length>0){let wi=1/0,Ni=-1/0,cn=1/0,Un=-1/0;for(const En of Zt)wi=Math.min(wi,En[0]),cn=Math.min(cn,En[1]),Ni=Math.max(Ni,En[0]),Un=Math.max(Un,En[1]);Ni>=Et.x&&wi<=ot.x&&Un>=Et.y&&cn<=ot.y&&(ui=[Zt.map(En=>new r.P(En[0],En[1]))],(wi<Et.x||Ni>ot.x||cn<Et.y||Un>ot.y)&&(ui=r.bM(ui,Et.x,Et.y,ot.x,ot.y)))}for(const wi of ui){yt.reset(wi,.25*ut);let Ni=0;Ni=yt.length<=.5*ut?1:Math.ceil(yt.paddedLength/ai)+1;for(let cn=0;cn<Ni;cn++){const Un=cn/Math.max(Ni-1,1),En=yt.lerp(Un),yn=En.x+zo,_r=En.y+zo;Y.push(yn,_r,ut,0);const Ii=yn-ut,Bi=_r-ut,Yi=yn+ut,Gn=_r+ut;if(We=We&&this.isOffscreen(Ii,Bi,Yi,Gn),st=st||this.isInsideGrid(Ii,Bi,Yi,Gn),!s&&this.grid.hitTestCircle(yn,_r,ut,O)&&(ke=!0,!L))return{circles:[],offscreen:!1,collisionDetected:ke,occluded:!1}}}}return{circles:!L&&ke||!st?[]:Y,offscreen:We,collisionDetected:ke,occluded:Ee.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let c=1/0,m=1/0,_=-1/0,v=-1/0;for(const L of t){const B=new r.P(L.x+zo,L.y+zo);c=Math.min(c,B.x),m=Math.min(m,B.y),_=Math.max(_,B.x),v=Math.max(v,B.y),s.push(B)}const S=this.grid.query(c,m,_,v).concat(this.ignoredGrid.query(c,m,_,v)),A={},k={};for(const L of S){const B=L.key;if(A[B.bucketInstanceId]===void 0&&(A[B.bucketInstanceId]={}),A[B.bucketInstanceId][B.featureIndex])continue;const O=[new r.P(L.x1,L.y1),new r.P(L.x2,L.y1),new r.P(L.x2,L.y2),new r.P(L.x1,L.y2)];r.bN(s,O)&&(A[B.bucketInstanceId][B.featureIndex]=!0,k[B.bucketInstanceId]===void 0&&(k[B.bucketInstanceId]=[]),k[B.bucketInstanceId].push(B.featureIndex))}return k}insertCollisionBox(t,s,c,m,_){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:m,collisionGroupID:_},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,c,m,_){const v=s?this.ignoredGrid:this.grid,S={bucketInstanceId:c,featureIndex:m,collisionGroupID:_};for(let A=0;A<t.length;A+=4)v.insertCircle(S,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,s,c,m,_,v,S){const A=[s,c,m,1];let k=!1;m||this.transform.pitch>0?(r.aA(A,A,t),this.fogState&&_&&S.name!=="globe"&&(k=function(O,j,X,W,Y,J){const ie=J.calculateFogTileMatrix(Y),ue=[j,X,W];return r.ad(ue,ue,ie),Mt(O,r.ae(ue),J.pitch,J._fov)}(this.fogState,s,c,m,_.toUnwrapped(),this.transform)>.9)):mn(A,A,t);const L=A[3];return{point:new r.P((A[0]/L+1)/2*this.transform.width+zo,(-A[1]/L+1)/2*this.transform.height+zo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/L*.5,1.5),signedDistanceFromCamera:L,occluded:v&&A[2]>L||k}}isOffscreen(t,s,c,m){return c<zo||t>=this.screenRightBoundary||m<zo||s>this.screenBottomBoundary}isInsideGrid(t,s,c,m){return c>=0&&t<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=r.bx([]);return r.bo(t,t,[-100,-100,0]),t}}function Ef(l,t,s){const c=t.createTileMatrix(l,l.worldSize,s.toUnwrapped());return r.az(new Float32Array(16),l.projMatrix,c)}function gi(l,t,s){if(t.projection.name===s.projection.name)return l.projMatrix;const c=s.clone();return c.setProjection(t.projection),Ef(c,t.getProjection(),l)}function wu(l,t,s){return t.name===s.projection.name?l.projMatrix:Ef(s,t,l)}class il{constructor(t,s,c,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):m&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Ea{constructor(t,s,c,m,_,v=!1){this.text=new il(t?t.text:null,s,c,_),this.icon=new il(t?t.icon:null,s,m,_),this.clipped=v}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class go{constructor(t,s,c,m=!1){this.text=t,this.icon=s,this.skipFade=c,this.clipped=m}}class Cf{constructor(){this.invProjMatrix=r.bz(),this.viewportMatrix=r.bz(),this.circles=[]}}class bu{constructor(t,s,c,m,_){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=c,this.bucketIndex=m,this.tileID=_}}class oi{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:c=>c.collisionGroupID===s}}return this.collisionGroups[t]}}function An(l,t,s,c,m){const{horizontalAlign:_,verticalAlign:v}=r.bT(l),S=-(_-.5)*t,A=-(v-.5)*s,k=r.bU(l,c);return new r.P(S+k[0]*m,A+k[1]*m)}function Sn(l,t,s,c,m){const _=new r.P(l,t);return s&&_._rotate(c?m:-m),_}class _o{constructor(t,s,c,m,_,v){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new yh(this.transform,_),this.buildingIndex=v,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new oi(c),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,c,m,_=1){const v=c.getBucket(s),S=c.latestFeatureIndex;if(!v||!S||s.fqid!==v.layerIds[0])return;const A=v.layers[0].layout,k=v.layers[0].paint,L=c.collisionBoxArray,B=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),O=c.tileSize/r.aj,j=c.tileID.toUnwrapped();this.transform.setProjection(v.projection);const X=(W=c.tileID,Y=v.getProjection(),J=this.transform,Y.name===this.projection?J.calculateProjMatrix(W.toUnwrapped()):Ef(J,Y,W));var W,Y,J;const ie=A.get("text-pitch-alignment")==="map",ue=A.get("text-rotation-alignment")==="map";s.compileFilter(s.options);const pe=s.dynamicFilter(),be=s.dynamicFilterNeedsFeature(),Te=this.transform.calculatePixelsToTileUnitsMatrix(c),xe=yd(X,c.tileID.canonical,ie,ue,this.transform,v.getProjection(),Te);let me=null;if(ie){const Xe=xu(X,c.tileID.canonical,ie,ue,this.transform,v.getProjection(),Te);me=r.az([],this.transform.labelPlaneMatrix,Xe)}let Ee=null;pe&&c.latestFeatureIndex&&(Ee={unwrappedTileID:j,dynamicFilter:pe,dynamicFilterNeedsFeature:be}),this.retainedQueryData[v.bucketInstanceId]=new bu(v.bucketInstanceId,S,v.sourceLayerIndex,v.index,c.tileID);const[Ae,Oe]=v.layers[0].layout.get("text-size-scale-range"),Ge=r.ay(_,Ae,Oe),[nt,it]=A.get("icon-size-scale-range"),ht=r.ay(_,nt,it),Be={bucket:v,layout:A,paint:k,posMatrix:X,textLabelPlaneMatrix:xe,labelToScreenMatrix:me,clippingData:Ee,scale:B,textPixelRatio:O,holdingForFade:c.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:r.bH(v.textSizeData,this.transform.zoom,Ge),partiallyEvaluatedIconSize:r.bH(v.iconSizeData,this.transform.zoom,ht),collisionGroup:this.collisionGroups.get(v.sourceID),latestFeatureIndex:c.latestFeatureIndex};if(m)for(const Xe of v.sortKeyRanges){const{sortKey:ke,symbolInstanceStart:st,symbolInstanceEnd:We}=Xe;t.push({sortKey:ke,symbolInstanceStart:st,symbolInstanceEnd:We,parameters:Be})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Be})}attemptAnchorPlacement(t,s,c,m,_,v,S,A,k,L,B,O,j,X,W,Y,J,ie){const{textOffset0:ue,textOffset1:pe,crossTileID:be}=O,Te=[ue,pe],xe=An(t,c,m,Te,_),me=this.collisionIndex.placeCollisionBox(X,_,s,Sn(xe.x,xe.y,v,S,this.transform.angle),B,A,k,L.predicate);if(Y){const Ee=X.getSymbolInstanceIconSize(ie,this.transform.zoom,O.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(X,Ee,Y,Sn(xe.x,xe.y,v,S,this.transform.angle),B,A,k,L.predicate).box.length===0)return}if(me.box.length>0){let Ee;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&(Ee=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:Te,width:c,height:m,anchor:t,textScale:_,prevAnchor:Ee},this.markUsedJustification(X,t,O,W),X.allowVerticalPlacement&&(this.markUsedOrientation(X,W,O),this.placedOrientations[be]=W),{shift:xe,placedGlyphBoxes:me}}}placeLayerBucketPart(t,s,c,m,_=1){const{bucket:v,layout:S,paint:A,posMatrix:k,textLabelPlaneMatrix:L,labelToScreenMatrix:B,clippingData:O,textPixelRatio:j,holdingForFade:X,collisionBoxArray:W,partiallyEvaluatedTextSize:Y,partiallyEvaluatedIconSize:J,collisionGroup:ie,latestFeatureIndex:ue}=t.parameters,pe=S.get("text-optional"),be=S.get("icon-optional"),Te=S.get("text-allow-overlap"),xe=S.get("icon-allow-overlap"),me=S.get("text-rotation-alignment")==="map",Ee=S.get("text-pitch-alignment")==="map",Ae=A.get("symbol-z-offset"),Oe=S.get("symbol-elevation-reference")==="sea",[Ge,nt]=S.get("text-size-scale-range"),[it,ht]=S.get("icon-size-scale-range"),Be=r.ay(_,Ge,nt),Xe=r.ay(_,it,ht);this.transform.setProjection(v.projection);let ke=Te&&(xe||!v.hasIconData()||be),st=xe&&(Te||!v.hasTextData()||pe);const We=!Ae.isConstant();!v.collisionArrays&&W&&v.deserializeCollisionBoxes(W),c&&m&&v.updateCollisionDebugBuffers(this.transform.zoom,W,Be,Xe);const ut=(ot,yt,jt)=>{const{crossTileID:Wt,numVerticalGlyphVertices:Ot}=ot;let Zt=null;if(O&&O.dynamicFilterNeedsFeature||We){const Mn=this.retainedQueryData[v.bucketInstanceId];Zt=ue.loadFeature({featureIndex:ot.featureIndex,bucketIndex:Mn.bucketIndex,sourceLayerIndex:Mn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(O&&!(0,O.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Zt,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new r.P(ot.tileAnchorX,ot.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[Wt]=new go(!1,!1,!1,!0),void s.add(Wt);const ai=Ae.evaluate(Zt,{});if(s.has(Wt))return;if(X)return void(this.placements[Wt]=new go(!1,!1,!1));let ui=!1,wi=!1,Ni=!0,cn=!1,Un=!1,En=null,yn={box:null,offscreen:null,occluded:null},_r={box:null},Ii=null,Bi=null,Yi=null,Gn=0,Cr=0,Hn=0;jt.textFeatureIndex?Gn=jt.textFeatureIndex:ot.useRuntimeCollisionCircles&&(Gn=ot.featureIndex),jt.verticalTextFeatureIndex&&(Cr=jt.verticalTextFeatureIndex);const wn=Mn=>{Mn.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const Wn=this.transform.elevation;Mn.elevation=Oe?ai:ai+(Wn?Wn.getAtTileOffset(Mn.tileID,Mn.tileAnchorX,Mn.tileAnchorY):0),Mn.elevation+=ot.zOffset},pr=jt.textBox;if(pr){wn(pr);const Mn=Fi=>{let vr=r.bI.horizontal;if(v.allowVerticalPlacement&&!Fi&&this.prevPlacement){const ns=this.prevPlacement.placedOrientations[Wt];ns&&(this.placedOrientations[Wt]=ns,vr=ns,this.markUsedOrientation(v,vr,ot))}return vr},Wn=(Fi,vr)=>{if(v.allowVerticalPlacement&&Ot>0&&jt.verticalTextBox){for(const ns of v.writingModes)if(ns===r.bI.vertical?(yn=vr(),_r=yn):yn=Fi(),yn&&yn.box&&yn.box.length)break}else yn=Fi()};if(S.get("text-variable-anchor")){let Fi=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Wt]){const ir=this.prevPlacement.variableOffsets[Wt];Fi.indexOf(ir.anchor)>0&&(Fi=Fi.filter(vn=>vn!==ir.anchor),Fi.unshift(ir.anchor))}const vr=(ir,vn,co)=>{const Xs=v.getSymbolInstanceTextSize(Y,ot,this.transform.zoom,yt),Vo=(ir.x2-ir.x1)*Xs+2*ir.padding,Ur=(ir.y2-ir.y1)*Xs+2*ir.padding,Co=ot.hasIconTextFit&&!xe?vn:null;Co&&wn(Co);let uo={box:[],offscreen:!1,occluded:!1};const ho=Te?2*Fi.length:Fi.length;for(let Ao=0;Ao<ho;++Ao){const Io=this.attemptAnchorPlacement(Fi[Ao%Fi.length],ir,Vo,Ur,Xs,me,Ee,j,k,ie,Ao>=Fi.length,ot,yt,v,co,Co,Y,J);if(Io&&(uo=Io.placedGlyphBoxes,uo&&uo.box&&uo.box.length)){ui=!0,En=Io.shift;break}}return uo};Wn(()=>vr(pr,jt.iconBox,r.bI.horizontal),()=>{const ir=jt.verticalTextBox;return ir&&wn(ir),v.allowVerticalPlacement&&!(yn&&yn.box&&yn.box.length)&&Ot>0&&ir?vr(ir,jt.verticalIconBox,r.bI.vertical):{box:null,offscreen:null,occluded:null}}),yn&&(ui=yn.box,Ni=yn.offscreen,cn=yn.occluded);const ns=Mn(!(!yn||!yn.box));if(!ui&&this.prevPlacement){const ir=this.prevPlacement.variableOffsets[Wt];ir&&(this.variableOffsets[Wt]=ir,this.markUsedJustification(v,ir.anchor,ot,ns))}}else{const Fi=(vr,ns)=>{const ir=v.getSymbolInstanceTextSize(Y,ot,this.transform.zoom,yt,_),vn=this.collisionIndex.placeCollisionBox(v,ir,vr,new r.P(0,0),Te,j,k,ie.predicate);return vn&&vn.box&&vn.box.length&&(this.markUsedOrientation(v,ns,ot),this.placedOrientations[Wt]=ns),vn};Wn(()=>Fi(pr,r.bI.horizontal),()=>{const vr=jt.verticalTextBox;return v.allowVerticalPlacement&&Ot>0&&vr?(wn(vr),Fi(vr,r.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Mn(!!(yn&&yn.box&&yn.box.length))}}if(Ii=yn,ui=Ii&&Ii.box&&Ii.box.length>0,Ni=Ii&&Ii.offscreen,cn=Ii&&Ii.occluded,ot.useRuntimeCollisionCircles){const Mn=v.text.placedSymbolArray.get(ot.centerJustifiedTextSymbolIndex>=0?ot.centerJustifiedTextSymbolIndex:ot.verticalPlacedTextSymbolIndex),Wn=r.bJ(v.textSizeData,Y,Mn),Fi=S.get("text-padding");Bi=this.collisionIndex.placeCollisionCircles(v,Te,Mn,v.lineVertexArray,v.glyphOffsetArray,Wn,k,L,B,c,Ee,ie.predicate,ot.collisionCircleDiameter*Wn/r.bO,Fi,this.retainedQueryData[v.bucketInstanceId].tileID),ui=Te||Bi.circles.length>0&&!Bi.collisionDetected,Ni=Ni&&Bi.offscreen,cn=Bi.occluded}if(jt.iconFeatureIndex&&(Hn=jt.iconFeatureIndex),jt.iconBox){const Mn=Wn=>{wn(Wn);const Fi=ot.hasIconTextFit&&En?Sn(En.x,En.y,me,Ee,this.transform.angle):new r.P(0,0),vr=v.getSymbolInstanceIconSize(J,this.transform.zoom,ot.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,vr,Wn,Fi,xe,j,k,ie.predicate)};_r&&_r.box&&_r.box.length&&jt.verticalIconBox?(Yi=Mn(jt.verticalIconBox),wi=Yi.box.length>0):(Yi=Mn(jt.iconBox),wi=Yi.box.length>0),Ni=Ni&&Yi.offscreen,Un=Yi.occluded}const an=pe||ot.numHorizontalGlyphVertices===0&&Ot===0,mr=be||ot.numIconVertices===0;if(an||mr?mr?an||(wi=wi&&ui):ui=wi&&ui:wi=ui=wi&&ui,ui&&Ii&&Ii.box&&this.collisionIndex.insertCollisionBox(Ii.box,S.get("text-ignore-placement"),v.bucketInstanceId,_r&&_r.box&&Cr?Cr:Gn,ie.ID),wi&&Yi&&this.collisionIndex.insertCollisionBox(Yi.box,S.get("icon-ignore-placement"),v.bucketInstanceId,Hn,ie.ID),Bi&&(ui&&this.collisionIndex.insertCollisionCircles(Bi.circles,S.get("text-ignore-placement"),v.bucketInstanceId,Gn,ie.ID),c)){const Mn=v.bucketInstanceId;let Wn=this.collisionCircleArrays[Mn];Wn===void 0&&(Wn=this.collisionCircleArrays[Mn]=new Cf);for(let Fi=0;Fi<Bi.circles.length;Fi+=4)Wn.circles.push(Bi.circles[Fi+0]),Wn.circles.push(Bi.circles[Fi+1]),Wn.circles.push(Bi.circles[Fi+2]),Wn.circles.push(Bi.collisionDetected?1:0)}const Kn=v.projection.name!=="globe";ke=ke&&(Kn||!cn),st=st&&(Kn||!Un),this.placements[Wt]=new go(ui||ke,wi||st,Ni||v.justReloaded),s.add(Wt)},Et=this.retainedQueryData[v.bucketInstanceId].tileID;if(v.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(v,Et),v.elevationType==="road"&&v.updateRoadElevation(Et.canonical),v.updateZOffset(),v.sortFeaturesByY){const ot=v.getSortedSymbolIndexes(this.transform.angle);for(let yt=ot.length-1;yt>=0;--yt){const jt=ot[yt];ut(v.symbolInstances.get(jt),jt,v.collisionArrays[jt])}v.hasAnyZOffset&&r.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){const ot=v.getSortedIndexesByZOffset();for(let yt=0;yt<ot.length;++yt){const jt=ot[yt];ut(v.symbolInstances.get(jt),jt,v.collisionArrays[jt])}}else for(let ot=t.symbolInstanceStart;ot<t.symbolInstanceEnd;ot++)ut(v.symbolInstances.get(ot),ot,v.collisionArrays[ot]);if(c&&v.bucketInstanceId in this.collisionCircleArrays){const ot=this.collisionCircleArrays[v.bucketInstanceId];r.bi(ot.invProjMatrix,k),ot.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(t,s,c,m){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:v,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:A,crossTileID:k}=c,L=r.bV(s),B=m===r.bI.vertical?A:L==="left"?_:L==="center"?v:L==="right"?S:-1;_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=B>=0&&_!==B?0:k),v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=B>=0&&v!==B?0:k),S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=B>=0&&S!==B?0:k),A>=0&&(t.text.placedSymbolArray.get(A).crossTileID=B>=0&&A!==B?0:k)}markUsedOrientation(t,s,c){const m=s===r.bI.horizontal||s===r.bI.horizontalOnly?s:0,_=s===r.bI.vertical?s:0,{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:k}=c,L=t.text.placedSymbolArray;v>=0&&(L.get(v).placedOrientation=m),S>=0&&(L.get(S).placedOrientation=m),A>=0&&(L.get(A).placedOrientation=m),k>=0&&(L.get(k).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let c=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(t):1,_=s?s.opacities:{},v=s?s.variableOffsets:{},S=s?s.placedOrientations:{};for(const A in this.placements){const k=this.placements[A],L=_[A];L?(this.opacities[A]=new Ea(L,m,k.text,k.icon,null,k.clipped),c=c||k.text!==L.text.placed||k.icon!==L.icon.placed):(this.opacities[A]=new Ea(null,m,k.text,k.icon,k.skipFade,k.clipped),c=c||k.text||k.icon)}for(const A in _){const k=_[A];if(!this.opacities[A]){const L=new Ea(k,m,!1,!1);L.isHidden()||(this.opacities[A]=L,c=c||k.text.placed||k.icon.placed)}}for(const A in v)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=v[A]);for(const A in S)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=S[A]);c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s,c,m){const _=new Set;for(const v of s){const S=v.getBucket(t);S&&v.latestFeatureIndex&&t.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,_,v,v.collisionBoxArray,c,m,v.tileID,t.scope),S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,v.tileID),S.elevationType==="road"&&S.updateRoadElevation(v.tileID.canonical),S.updateZOffset())}}updateBucketOpacities(t,s,c,m,_,v,S,A){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const k=t.layers[0].layout,L=t.layers[0].paint,B=!!t.layers[0].dynamicFilter(),O=new Ea(null,0,!1,!1,!0),j=k.get("text-allow-overlap"),X=k.get("icon-allow-overlap"),W=k.get("text-variable-anchor"),Y=k.get("text-rotation-alignment")==="map",J=k.get("text-pitch-alignment")==="map",ie=L.get("symbol-z-offset"),ue=k.get("symbol-elevation-reference")==="sea",pe=!ie.isConstant(),be=new Ea(null,0,j&&(X||!t.hasIconData()||k.get("icon-optional")),X&&(j||!t.hasTextData()||k.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);const Te=(me,Ee,Ae)=>{for(let Oe=0;Oe<Ee/4;Oe++)me.opacityVertexArray.emplaceBack(Ae)};let xe=0;v&&t.updateReplacement(S,v);for(let me=0;me<t.symbolInstances.length;me++){const Ee=t.symbolInstances.get(me),{numHorizontalGlyphVertices:Ae,numVerticalGlyphVertices:Oe,crossTileID:Ge,numIconVertices:nt,tileAnchorX:it,tileAnchorY:ht}=Ee;let Be=null;const Xe=this.retainedQueryData[t.bucketInstanceId];pe&&Ee&&Xe&&(Be=c.latestFeatureIndex.loadFeature({featureIndex:Ee.featureIndex,bucketIndex:Xe.bucketIndex,sourceLayerIndex:Xe.sourceLayerIndex,layoutVertexArrayOffset:0}));const ke=ie.evaluate(Be,{}),st=s.has(Ge);let We=this.opacities[Ge];st?We=O:We||(We=be,this.opacities[Ge]=We),s.add(Ge);const ut=Ae>0||Oe>0,Et=nt>0,ot=this.placedOrientations[Ge],yt=ot===r.bI.vertical,jt=ot===r.bI.horizontal||ot===r.bI.horizontalOnly;!ut&&!Et||We.isHidden()||xe++;let Wt=!1;if((ut||Et)&&v)for(const Ot of t.activeReplacements){if(r.bP(Ot,_,r.bQ.Symbol,A)||Ot.min.x>it||it>Ot.max.x||Ot.min.y>ht||ht>Ot.max.y)continue;const Zt=r.bR(it,ht,S.canonical,Ot.footprintTileId.canonical);if(Wt=r.bS(Zt,Ot.footprint),Wt)break}if(ut){const Ot=Wt?$l:Gl(We.text);Te(t.text,Ae,yt?$l:Ot),Te(t.text,Oe,jt?$l:Ot);const Zt=We.text.isHidden(),{leftJustifiedTextSymbolIndex:ai,centerJustifiedTextSymbolIndex:ui,rightJustifiedTextSymbolIndex:wi,verticalPlacedTextSymbolIndex:Ni}=Ee,cn=t.text.placedSymbolArray,Un=Zt||yt?1:0;ai>=0&&(cn.get(ai).hidden=Un),ui>=0&&(cn.get(ui).hidden=Un),wi>=0&&(cn.get(wi).hidden=Un),Ni>=0&&(cn.get(Ni).hidden=Zt||jt?1:0);const En=this.variableOffsets[Ge];En&&this.markUsedJustification(t,En.anchor,Ee,ot);const yn=this.placedOrientations[Ge];yn&&(this.markUsedJustification(t,"left",Ee,yn),this.markUsedOrientation(t,yn,Ee))}if(Et){const Ot=Wt?$l:Gl(We.icon),{placedIconSymbolIndex:Zt,verticalPlacedIconSymbolIndex:ai}=Ee,ui=t.icon.placedSymbolArray,wi=We.icon.isHidden()?1:0;Zt>=0&&(Te(t.icon,nt,yt?$l:Ot),ui.get(Zt).hidden=wi),ai>=0&&(Te(t.icon,Ee.numVerticalIconVertices,jt?$l:Ot),ui.get(ai).hidden=wi)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ot=t.collisionArrays[me];if(Ot){let Zt=new r.P(0,0),ai=!0;if(Ot.textBox||Ot.verticalTextBox){if(W){const wi=this.variableOffsets[Ge];wi?(Zt=An(wi.anchor,wi.width,wi.height,wi.textOffset,wi.textScale),Y&&Zt._rotate(J?this.transform.angle:-this.transform.angle)):ai=!1}B&&(ai=!We.clipped),Ot.textBox&&nl(t.textCollisionBox.collisionVertexArray,We.text.placed,!ai||yt,ke,ue,Zt.x,Zt.y),Ot.verticalTextBox&&nl(t.textCollisionBox.collisionVertexArray,We.text.placed,!ai||jt,ke,ue,Zt.x,Zt.y)}const ui=ai&&!!(!jt&&Ot.verticalIconBox);Ot.iconBox&&nl(t.iconCollisionBox.collisionVertexArray,We.icon.placed,ui,ke,ue,Ee.hasIconTextFit?Zt.x:0,Ee.hasIconTextFit?Zt.y:0),Ot.verticalIconBox&&nl(t.iconCollisionBox.collisionVertexArray,We.icon.placed,!ui,ke,ue,Ee.hasIconTextFit?Zt.x:0,Ee.hasIconTextFit?Zt.y:0)}}}if(t.fullyClipped=xe===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const me=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=me.invProjMatrix,t.placementViewportMatrix=me.viewportMatrix,t.collisionCircleArray=me.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const c=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function nl(l,t,s,c,m,_,v){l.emplaceBack(t?1:0,s?1:0,_||0,v||0,c,m?1:0),l.emplaceBack(t?1:0,s?1:0,_||0,v||0,c,m?1:0),l.emplaceBack(t?1:0,s?1:0,_||0,v||0,c,m?1:0),l.emplaceBack(t?1:0,s?1:0,_||0,v||0,c,m?1:0)}const In=Math.pow(2,25),xd=Math.pow(2,24),Tu=Math.pow(2,17),xh=Math.pow(2,16),Gs=Math.pow(2,9),zr=Math.pow(2,8),Sm=Math.pow(2,1);function Gl(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const t=l.placed?1:0,s=Math.floor(127*l.opacity);return s*In+t*xd+s*Tu+t*xh+s*Gs+t*zr+s*Sm+t}const $l=0;class vh{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,s,c,m,_,v){const S=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(S,m,t[this._currentTileIndex],this._sortAcrossTiles,v),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((A,k)=>A.sortKey-k.sortKey));this._currentPartIndex<S.length;){const A=S[this._currentPartIndex];if(s.placeLayerBucketPart(A,this._seenCrossTileIDs,c,A.symbolInstanceStart===0,v),this._currentPartIndex++,_())return!0}return!1}}class vd{constructor(t,s,c,m,_,v,S,A,k){this.placement=new _o(t,_,v,S,A,k),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,s,c,m,_){const v=r.q.now(),S=()=>{const A=r.q.now()-v;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=s[t[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=k)&&(!A.maxzoom||A.maxzoom>k)){const L=A,B=L.layout.get("symbol-z-elevate"),O=L.layout.get("symbol-sort-key").constantOr(1)!==void 0,j=L.layout.get("symbol-z-order"),X=j==="viewport-y"||j==="auto"&&!(j!=="viewport-y"&&O),W=L.layout.get("text-allow-overlap")||L.layout.get("icon-allow-overlap")||L.layout.get("text-ignore-placement")||L.layout.get("icon-ignore-placement"),Y=X&&W,J=this._inProgressLayer=this._inProgressLayer||new vh(L),ie=r.C(A.source,A.scope);if(J.continuePlacement(B||Y?m[ie]:c[ie],this.placement,this._showCollisionBoxes,A,S,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Su=512/r.aj/2;class wd{constructor(t,s,c){this.tileID=t,this.bucketInstanceId=c,this.index=new r.bW(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const m=t.canonical.x*r.aj,_=t.canonical.y*r.aj;for(let v=0;v<s.length;v++){const{key:S,crossTileID:A,tileAnchorX:k,tileAnchorY:L}=s.get(v),B=Math.floor((m+k)*Su),O=Math.floor((_+L)*Su);this.index.add(B,O),this.keys.push(S),this.crossTileIDs.push(A)}this.index.finish()}findMatches(t,s,c){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),_=Su/Math.pow(2,s.canonical.z-this.tileID.canonical.z),v=s.canonical.x*r.aj,S=s.canonical.y*r.aj;for(let A=0;A<t.length;A++){const k=t.get(A);if(k.crossTileID)continue;const{key:L,tileAnchorX:B,tileAnchorY:O}=k,j=Math.floor((v+B)*_),X=Math.floor((S+O)*_),W=this.index.range(j-m,X-m,j+m,X+m).sort((Y,J)=>Y-J);for(const Y of W){const J=this.crossTileIDs[Y];if(this.keys[Y]===L&&!c.has(J)){c.add(J),k.crossTileID=J;break}}}}}class $s{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class rl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const c in this.indexes){const m=this.indexes[c],_={};for(const v in m){const S=m[v];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+s),_[S.tileID.key]=S}this.indexes[c]=_}this.lng=t}addBucket(t,s,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<s.symbolInstances.length;_++)s.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const m=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const v=this.indexes[_];if(Number(_)>t.overscaledZ)for(const S in v){const A=v[S];A.tileID.isChildOf(t)&&A.findMatches(s.symbolInstances,t,m)}else{const S=v[t.scaledTo(Number(_)).key];S&&S.findMatches(s.symbolInstances,t,m)}}for(let _=0;_<s.symbolInstances.length;_++){const v=s.symbolInstances.get(_);v.crossTileID||(v.crossTileID=c.generate(),m.add(v.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new wd(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const c of s.crossTileIDs)this.usedCrossTileIDs[t].delete(c)}removeStaleBuckets(t){let s=!1;for(const c in this.indexes){const m=this.indexes[c];for(const _ in m)t[m[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,m[_]),delete m[_],s=!0)}return s}}class no{constructor(){this.layerIndexes={},this.crossTileIDs=new $s,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,c,m){let _=this.layerIndexes[t.fqid];_===void 0&&(_=this.layerIndexes[t.fqid]=new rl);let v=!1;const S={};m.name!=="globe"&&_.handleWrapJump(c);for(const A of s){const k=A.getBucket(t);k&&t.fqid===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(A.tileID,k,this.crossTileIDs)&&(v=!0),S[k.bucketInstanceId]=!0)}return _.removeStaleBuckets(S)&&(v=!0),v}pruneUnusedLayers(t){const s={};t.forEach(c=>{s[c]=!0});for(const c in this.layerIndexes)s[c]||delete this.layerIndexes[c]}}const Pc=771;class Wi{constructor(t,s,c,m){this.blendFunction=t,this.blendColor=s.toNonPremultipliedRenderColor(null),this.mask=c,this.blendEquation=m}}Wi.Replace=[1,0,1,0],Wi.disabled=new Wi(Wi.Replace,r.am.transparent,[!1,!1,!1,!1]),Wi.unblended=new Wi(Wi.Replace,r.am.transparent,[!0,!0,!0,!0]),Wi.alphaBlended=new Wi([1,Pc,1,Pc],r.am.transparent,[!0,!0,!0,!0]),Wi.alphaBlendedNonPremultiplied=new Wi([770,Pc,770,Pc],r.am.transparent,[!0,!0,!0,!0]),Wi.multiply=new Wi([774,0,774,0],r.am.transparent,[!0,!0,!0,!0]);class Xt{constructor(t,s,c){this.func=t,this.mask=s,this.range=c}}Xt.ReadOnly=!1,Xt.ReadWrite=!0,Xt.disabled=new Xt(519,Xt.ReadOnly,[0,1]);const yo=7680;class vi{constructor(t,s,c,m,_,v){this.test=t,this.ref=s,this.mask=c,this.fail=m,this.depthFail=_,this.pass=v}}vi.disabled=new vi({func:519,mask:0},0,0,yo,yo,yo);const kr=1029,Eu=2305;class mi{constructor(t,s,c){this.enable=t,this.mode=s,this.frontFace=c}}function Mc(l,t){const s=r.c1(l,3);r.c3(l,t),r.c7(l,3,s)}function Rc(l,t){const s=r.b_([]);return r.b$(s,s,-t),r.c0(s,s,-l),s}function sl(l,t){const s=[l[0],l[1],0],c=[t[0],t[1],0];if(r.ae(s)>=1e-15){const v=r.au([],s);r.bY(c,v,r.bG(c,v)),t[0]=c[0],t[1]=c[1]}const m=r.bF([],t,l);if(r.bZ(m)<1e-15)return null;const _=Math.atan2(-m[1],m[0]);return Rc(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),_)}mi.disabled=new mi(!1,kr,Eu),mi.backCCW=new mi(!0,kr,Eu),mi.backCW=new mi(!0,kr,2304),mi.frontCW=new mi(!0,1028,2304),mi.frontCCW=new mi(!0,1028,Eu);class kc{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){if(t){const s=t instanceof r.ac?t:new r.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(s.x=r.bX(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(t,s){if(this.orientation=null,!this.position)return;const c=this.position,m=this._elevation?this._elevation.getAtPointOrZero(r.ac.fromLngLat(t)):0,_=r.ac.fromLngLat(t,m),v=[_.x-c.x,_.y-c.y,_.z-c.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=sl(v,s)}setPitchBearing(t,s){this.orientation=Rc(r.al(t),r.al(-s))}}class Xo{constructor(t,s){this._transform=r.bx([]),this.orientation=s,this.position=t}get mercatorPosition(){const t=this.position;return new r.ac(t[0],t[1],t[2])}get position(){const t=r.c1(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var s;t&&r.c7(this._transform,3,[(s=t)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||r.b_([]),t&&Mc(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=Rc(t,s),Mc(this._transform,this._orientation)}forward(){const t=r.c1(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=r.c1(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=r.c1(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const c=new Float64Array(16);return r.bi(c,this.getWorldToCamera(t,s)),c}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,s,c){const m=this.position;r.bY(m,m,-t);const _=new Float64Array(16);return r.bn(_,[c,c,c]),r.bo(_,_,m),_[10]*=s,_}getWorldToCamera(t,s){const c=new Float64Array(16),m=new Float64Array(4),_=this.position;return r.c2(m,this._orientation),r.bY(_,_,-t),r.c3(c,m),r.bo(c,c,_),c[1]*=-1,c[5]*=-1,c[9]*=-1,c[13]*=-1,c[8]*=s,c[9]*=s,c[10]*=s,c[11]*=s,c}getCameraToClipPerspective(t,s,c,m){const _=new Float64Array(16);return r.c4(_,t,s,c,m),_}getCameraToClipOrthographic(t,s,c,m,_,v){const S=new Float64Array(16);return r.c5(S,t,s,c,m,_,v),S}getDistanceToElevation(t,s=!1){const c=t===0?0:r.c6(t,s?r.aY(this.position[1]):this.position[1]),m=this.forward();return(c-this.position[2])/m[2]}clone(){return new Xo([...this.position],[...this.orientation])}}const Hs={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class wh{constructor(t=0,s=0,c=0,m=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(c)||c<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=c,this.right=m}interpolate(t,s,c){return s.top!=null&&t.top!=null&&(this.top=r.ai(t.top,s.top,c)),s.bottom!=null&&t.bottom!=null&&(this.bottom=r.ai(t.bottom,s.bottom,c)),s.left!=null&&t.left!=null&&(this.left=r.ai(t.left,s.left,c)),s.right!=null&&t.right!=null&&(this.right=r.ai(t.right,s.right,c)),this}getCenter(t,s){const c=r.ay((this.left+t-this.right)/2,0,t),m=r.ay((this.top+s-this.bottom)/2,0,s);return new r.P(c,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new wh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const qr=15;class bd{constructor(t,s,c,m,_,v,S){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=c??0,this._maxPitch=m??60,this.setProjection(v),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new r.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new wh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Xo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new bd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<qr}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,s=!1){const c=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||c)&&this._updateCameraOnTerrain(),(t||c)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return r.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=r.ce(this.projectionOptions);const c=this.getProjection(),m=!r.bv(s,c);return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.ce({name:"mercator"});const s=t!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bX(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const s=-t*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=r.cf(),r.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=r.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=r.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&c.exaggeration()&&this._centerAltitudeValidForExaggeration!==c.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*c.exaggeration(),this._centerAltitudeValidForExaggeration=c.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=c.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],c=this.horizonLineFromTop();let m=0,_=0;for(let v=0;v<s.length;v++){const S=new r.P(s[v][0]*this.width,c+s[v][1]*(this.height-c)),A=t.pointCoordinate(S);if(!A)continue;const k=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);m+=A[3]*k,_+=k}return _===0?NaN:m/_}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),c=this.pixelsPerMeter/this.worldSize*s,m=this._mercatorZfromZoom(t),_=this._mercatorZfromZoom(this._maxZoom),v=Math.max(m-c,_);this._setZoom(this._zoomFromMercatorZ(v))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let c;c=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const m=r.ae(r.at([],this._camera.position,c));return r.ay(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!r.ch(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const c=[t.position.x,t.position.y,t.position.z];r.ci(c,this._camera.position)||(this._setCameraPosition(c),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new kc;return s.position=new r.ac(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(t){if(!r.cj(t))return!1;r.ck(t,t);const s=r.cl([],[0,0,-1],t),c=r.cl([],[0,-1,0],t);if(c[2]<0)return!1;const m=sl(s,c);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,c=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=r.ay(t[2],m/c,m/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,c){this._unmodified=!1,this._edgeInsets.interpolate(t,s,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new r.cm(0,t)];if(this.renderWorldCopies){const c=this.pointCoordinate(new r.P(0,0)),m=this.pointCoordinate(new r.P(this.width,0)),_=this.pointCoordinate(new r.P(this.width,this.height)),v=this.pointCoordinate(new r.P(0,this.height)),S=Math.floor(Math.min(c.x,m.x,_.x,v.x)),A=Math.floor(Math.max(c.x,m.x,_.x,v.x)),k=1;for(let L=S-k;L<=A+k;L++)L!==0&&s.push(new r.cm(L,t))}return s}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,s,c){let m=[];const _=c!=null,v=!_;if(v&&this.zoom<s||_&&c[0]===0&&c[1]===0)return m;const S=new Set,A=(L,B,O,j,X)=>{const W=r.cK(B,L,O,j,X);S.has(W)||(m.push(new r.aM(L,B,O,j,X)),S.add(W))};for(let L=0;L<t.length;L++){const B=t[L];if(v&&B.canonical.z!==s)continue;const O=B.canonical,j=B.overscaledZ,X=B.wrap,W=1<<O.z,Y=O.x+1<W,J=O.x>0,ie=O.y+1<W,ue=O.y>0,pe=B.wrap-(J?0:1),be=B.wrap+(Y?0:1),Te=J?O.x-1:W-1,xe=Y?O.x+1:0;if(_)c[0]<0?(A(j,be,O.z,xe,O.y),c[1]<0&&ie&&(A(j,X,O.z,O.x,O.y+1),A(j,be,O.z,xe,O.y+1)),c[1]>0&&ue&&(A(j,X,O.z,O.x,O.y-1),A(j,be,O.z,xe,O.y-1))):c[0]>0?(A(j,pe,O.z,Te,O.y),c[1]<0&&ie&&(A(j,X,O.z,O.x,O.y+1),A(j,pe,O.z,Te,O.y+1)),c[1]>0&&ue&&(A(j,X,O.z,O.x,O.y-1),A(j,pe,O.z,Te,O.y-1))):c[1]<0&&ie?A(j,X,O.z,O.x,O.y+1):ue&&A(j,X,O.z,O.x,O.y-1);else{const me=B.visibleQuadrants;1&me&&(A(j,pe,O.z,Te,O.y),ue&&(A(j,X,O.z,O.x,O.y-1),A(j,pe,O.z,Te,O.y-1))),2&me&&(A(j,be,O.z,xe,O.y),ue&&(A(j,X,O.z,O.x,O.y-1),A(j,be,O.z,xe,O.y-1))),4&me&&(A(j,pe,O.z,Te,O.y),ie&&(A(j,X,O.z,O.x,O.y+1),A(j,pe,O.z,Te,O.y+1))),8&me&&(A(j,be,O.z,xe,O.y),ie&&(A(j,X,O.z,O.x,O.y+1),A(j,be,O.z,xe,O.y+1)))}}const k=[];for(const L of m)m.some(B=>L.isChildOf(B))||k.push(L);if(m=k.filter(L=>!t.some(B=>!!(L.overscaledZ<s&&B.isChildOf(L))||L.equals(B)||L.isChildOf(B))),v){const L=1<<s,B=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),O=[L*B.x,L*B.y],j=4,X=j*j;m=m.filter(W=>{const Y=W.canonical.x+.5-O[0],J=W.canonical.y+.5-O[1];return Y*Y+J*J<X})}return m}coveringTiles(t){let s=this.coveringZoomLevel(t);const c=s,m=this.elevation&&this.elevation.exaggeration(),_=m&&!t.isTerrainDEM,v=this.projection.name==="mercator";if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const S=this.locationCoordinate(this.center),A=this.center.lat,k=1<<s,L=[k*S.x,k*S.y,0],B=this.projection.name==="globe",O=!B,j=r.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,O),X=B?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=k*r.c6(1,this.center.lat),Y=this._camera.position[2]/r.c6(1,this.center.lat),J=[k*X.x,k*X.y,Y*(O?1:W)],ie=B||m,ue=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),pe=this.isLODDisabled(!0)?s:0;let be;if(this._elevation&&t.isTerrainDEM)be=1e4*this._elevation.exaggeration();else if(this._elevation){const ke=this._elevation.getMinMaxForVisibleTiles();be=ke?ke.max:this._centerAltitude}else be=this._centerAltitude;const Te=t.isTerrainDEM?-be:this._elevation?this._elevation.getMinElevationBelowMSL():0,xe=this.projection.isReprojectedInTileSpace?r.co(this):1,me=ke=>{const We=new r.ac(ke.x+25e-6,ke.y,ke.z),ut=new r.ac(ke.x,ke.y+25e-6,ke.z),Et=ke.toLngLat(),ot=We.toLngLat(),yt=ut.toLngLat(),jt=this.locationCoordinate(Et),Wt=this.locationCoordinate(ot),Ot=this.locationCoordinate(yt),Zt=Math.hypot(Wt.x-jt.x,Wt.y-jt.y),ai=Math.hypot(Ot.x-jt.x,Ot.y-jt.y);return Math.sqrt(Zt*ai)*xe/25e-6},Ee=ke=>{const st=be,We=Te;return{aabb:r.cr(this,k,0,0,0,ke,We,st,this.projection),zoom:0,x:0,y:0,minZ:We,maxZ:st,wrap:ke,fullyVisible:!1}},Ae=[];let Oe=[];const Ge=s,nt=t.reparseOverscaled?c:s,it=(Y-this._centerAltitude)*W,ht=ke=>{if(!this._elevation||!ke.tileID||!v)return;const st=this._elevation.getMinMaxForTile(ke.tileID),We=ke.aabb;st?(We.min[2]=st.min,We.max[2]=st.max,We.center[2]=(We.min[2]+We.max[2])/2):(ke.shouldSplit=Xe(ke),ke.shouldSplit||(We.min[2]=We.max[2]=We.center[2]=this._centerAltitude))},Be=(ke,st)=>{if(.707*st<ke)return 1;const We=st/ke;return We/(1.4144271570014144+(Math.pow(1.1,We-1.4144271570014144+1)-1)/(1.1-1)-1)},Xe=ke=>{if(ke.zoom<pe)return!0;if(ke.zoom===Ge)return!1;if(ke.shouldSplit!=null)return ke.shouldSplit;const st=ke.aabb.distanceX(J),We=ke.aabb.distanceY(J);let ut=it,Et=1;if(B){ut=ke.aabb.distanceZ(J);const ai=Math.pow(2,ke.zoom),ui=r.aY((ke.y+1)/ai),wi=r.aY(ke.y/ai),Ni=Math.min(Math.max(A,ui),wi),cn=r.cO(Ni)/r.cO(A);if(Et=Ni===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,cn/this._mercatorScaleRatio),this.zoom<=r.cL&&ke.zoom===Ge-1&&cn>=.9)return!0}else if(_&&(ut=ke.aabb.distanceZ(J)*W),this.projection.isReprojectedInTileSpace&&c<=5){const ai=Math.pow(2,ke.zoom),ui=me(new r.ac((ke.x+.5)/ai,(ke.y+.5)/ai));Et=ui>.85?1:ui}if(!v){const ai=Math.sqrt(st*st+We*We+ut*ut);let ui=(1<<Ge-ke.zoom)*ue*Et;return ui*=Be(Math.max(ut,it),ai),ai<ui}let ot=Number.MAX_VALUE,yt=0;const jt=ke.aabb.getCorners(),Wt=[];for(const ai of jt){r.at(Wt,ai,J),B||(_?Wt[2]*=W:Wt[2]=it);const ui=r.bG(Wt,this._camera.forward());ui<ot&&(ot=ui,yt=Math.abs(Wt[2]))}let Ot=(1<<Ge-ke.zoom)*ue*Et;if(Ot*=Be(Math.max(yt,it),ot),ot<Ot)return!0;const Zt=ke.aabb.closestPoint(L);return Zt[0]===L[0]&&Zt[1]===L[1]};if(this.renderWorldCopies)for(let ke=1;ke<=3;ke++)Ae.push(Ee(-ke)),Ae.push(Ee(ke));for(Ae.push(Ee(0));Ae.length>0;){const ke=Ae.pop(),st=ke.x,We=ke.y;let ut=ke.fullyVisible;const Et=()=>this.projection.name==="globe"&&(ke.y===0||ke.y===(1<<ke.zoom)-1);if(!ut){let ot=ie?ke.aabb.intersects(j):ke.aabb.intersectsFlat(j);if(ot===0&&Et()){const yt=new r.cp(ke.zoom,st,We);ot=r.cq(this,k,yt,!0).intersects(j)}if(ot===0)continue;ut=ot===2}if(ke.zoom!==Ge&&Xe(ke))for(let ot=0;ot<4;ot++){const yt=(st<<1)+ot%2,jt=(We<<1)+(ot>>1),Wt={aabb:v?ke.aabb.quadrant(ot):r.cr(this,k,ke.zoom+1,yt,jt,ke.wrap,ke.minZ,ke.maxZ,this.projection),zoom:ke.zoom+1,x:yt,y:jt,wrap:ke.wrap,fullyVisible:ut,tileID:void 0,shouldSplit:void 0,minZ:ke.minZ,maxZ:ke.maxZ};_&&!B&&(Wt.tileID=new r.aM(ke.zoom+1===Ge?nt:ke.zoom+1,ke.wrap,ke.zoom+1,yt,jt),ht(Wt)),Ae.push(Wt)}else{const ot=ke.zoom===Ge?nt:ke.zoom;if(t.minzoom&&t.minzoom>ot)continue;let yt=0;if(!ut){let Zt=ie?ke.aabb.intersectsPrecise(j):ke.aabb.intersectsPreciseFlat(j);if(Zt===0&&Et()){const ai=new r.cp(ke.zoom,st,We);Zt=r.cq(this,k,ai,!0).intersectsPrecise(j)}if(Zt===0)continue;if(t.calculateQuadrantVisibility)if(j.containsPoint(ke.aabb.center))yt=15;else for(let ai=0;ai<4;ai++)ke.aabb.quadrant(ai).intersects(j)!==0&&(yt|=1<<ai)}const jt=L[0]-(.5+st+(ke.wrap<<ke.zoom))*(1<<s-ke.zoom),Wt=L[1]-.5-We,Ot=ke.tileID?ke.tileID:new r.aM(ot,ke.wrap,ke.zoom,st,We);t.calculateQuadrantVisibility&&(Ot.visibleQuadrants=yt),Oe.push({tileID:Ot,distanceSq:jt*jt+Wt*Wt})}}if(this.fogCullDistSq){const ke=this.fogCullDistSq,st=this.horizonLineFromTop();Oe=Oe.filter(We=>{const ut=[0,0,0,1],Et=[r.aj,r.aj,0,1],ot=this.calculateFogTileMatrix(We.tileID.toUnwrapped());r.aA(ut,ut,ot),r.aA(Et,Et,ot);const yt=r.cs([],ut,Et),jt=r.ct([],ut,Et),Wt=r.cM(yt,jt);if(Wt===0)return!0;let Ot=!1;const Zt=this._elevation;if(Zt&&Wt>ke&&st!==0){const ai=this.calculateProjMatrix(We.tileID.toUnwrapped());let ui;t.isTerrainDEM||(ui=Zt.getMinMaxForTile(We.tileID)),ui||(ui={min:Te,max:be});const wi=r.cu(this.rotation),Ni=[wi[0]*r.aj,wi[1]*r.aj,ui.max];r.ad(Ni,Ni,ai),Ot=(1-Ni[1])*this.height*.5<st}return Wt<ke||Ot})}return Oe.sort((ke,st)=>ke.distanceSq-st.distanceSq).map(ke=>ke.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=r.ay(t.lat,-85.051129,r.cv),c=this.projection.project(t.lng,s);return new r.P(c.x*this.worldSize,c.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,s){let c,m;const _=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;c=(s.x-_.x)/S,m=(s.y-_.y)/S}else{const S=this.pointCoordinate(s),A=this.pointCoordinate(_);c=S.x-A.x,m=S.y-A.y}const v=this.locationCoordinate(t);this.setLocation(new r.ac(v.x-c,v.y-m))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,s){return this.projection.locationPoint(this,t,s)}locationPoint3D(t,s){return this.projection.locationPoint(this,t,s,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,s){return this.coordinateLocation(this.pointCoordinate3D(t,s))}locationCoordinate(t,s){const c=s?r.c6(s,t.lat):void 0,m=this.projection.project(t.lng,t.lat);return new r.ac(m.x,m.y,c)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,s){const c=s??this._centerAltitude,m=[t.x,t.y,0,1],_=[t.x,t.y,1,1];r.aA(m,m,this.pixelMatrixInverse),r.aA(_,_,this.pixelMatrixInverse);const v=_[3];r.cw(m,m,1/m[3]),r.cw(_,_,1/v);const S=m[2],A=_[2];return{p0:m,p1:_,t:S===A?0:(c-S)/(A-S)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],c=[t.x,t.y,1,1];return r.aA(s,s,this.pixelMatrixInverse),r.aA(c,c,this.pixelMatrixInverse),r.cw(s,s,1/s[3]),r.cw(c,c,1/c[3]),s[2]=r.c6(s[2],this._center.lat)*this.worldSize,c[2]=r.c6(c[2],this._center.lat)*this.worldSize,r.cw(s,s,1/this.worldSize),r.cw(c,c,1/this.worldSize),new r.av([s[0],s[1],s[2]],r.au([],r.at([],c,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:c,t:m}=t,_=r.c6(s[2],this._center.lat),v=r.c6(c[2],this._center.lat);return new r.ac(r.ai(s[0],c[0],m)/this.worldSize,r.ai(s[1],c[1],m)/this.worldSize,r.ai(_,v,m))}pointCoordinate(t,s=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,s)}pointCoordinate3D(t,s){if(!this.elevation)return this.pointCoordinate(t,s);let c=this.projection.pointCoordinate3D(this,t.x,t.y);if(c)return new r.ac(c[0],c[1],c[2]);let m=0,_=this.horizonLineFromTop();if(t.y>_)return this.pointCoordinate(t,s);const v=.02*_,S=t.clone();for(let A=0;A<10&&_-m>v;A++){S.y=r.ai(m,_,.66);const k=this.projection.pointCoordinate3D(this,S.x,S.y);k?(_=S.y,c=k):m=S.y}return c?new r.ac(c[0],c[1],c[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=r.cx)return!this.isPointAboveHorizon(t);const s=this.pointCoordinate(t);return s.y>=0&&s.y<=1}_coordinatePoint(t,s){const c=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,c+t.toAltitude(),1];return r.aA(m,m,this.pixelMatrix),m[3]>0?new r.P(m[0]/m[3],m[1]/m[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:s}=this._edgeInsets,c=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,_=this.pointLocation3D(new r.P(s,t)),v=this.pointLocation3D(new r.P(m,t)),S=this.pointLocation3D(new r.P(m,c)),A=this.pointLocation3D(new r.P(s,c));let k=Math.min(_.lng,v.lng,S.lng,A.lng),L=Math.max(_.lng,v.lng,S.lng,A.lng),B=Math.min(_.lat,v.lat,S.lat,A.lat),O=Math.max(_.lat,v.lat,S.lat,A.lat);const j=Math.pow(2,-this.zoom)/16*270,X=this.projection.name==="globe"?1:4,W=(Y,J,ie,ue,pe)=>{const be=(Y+ie)/2,Te=(J+ue)/2,xe=new r.P(be,Te),{lng:me,lat:Ee}=this.pointLocation3D(xe),Ae=Math.max(0,k-me,B-Ee,me-L,Ee-O);k=Math.min(k,me),L=Math.max(L,me),B=Math.min(B,Ee),O=Math.max(O,Ee),(pe<X||Ae>j)&&(W(Y,J,be,Te,pe+1),W(be,Te,ie,ue,pe+1))};if(W(s,t,m,t,1),W(m,t,m,c,1),W(m,c,s,c,1),W(s,c,s,t,1),this.projection.name==="globe"){const[Y,J]=r.cy(this);Y?(O=90,L=180,k=-180):J&&(B=-90,L=180,k=-180)}return new r.aG(new r.cd(k,B),new r.cd(L,O))}_getBoundsRectangular(t,s){const{top:c,left:m}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,S=new r.P(m,c),A=new r.P(v,c),k=new r.P(v,_),L=new r.P(m,_);let B=this.pointCoordinate(S,t),O=this.pointCoordinate(A,t);const j=this.pointCoordinate(k,s),X=this.pointCoordinate(L,s),W=(Y,J)=>(J.y-Y.y)/(J.x-Y.x);return B.y>1&&O.y>=0?B=new r.ac((1-X.y)/W(X,B)+X.x,1):B.y<0&&O.y<=1&&(B=new r.ac(-X.y/W(X,B)+X.x,0)),O.y>1&&B.y>=0?O=new r.ac((1-j.y)/W(j,O)+j.x,1):O.y<0&&B.y<=1&&(O=new r.ac(-j.y/W(j,O)+j.x,0)),new r.aG().extend(this.coordinateLocation(B)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=t.visibleDemTiles.reduce((c,m)=>{if(m.dem){const _=m.dem.tree;c.min=Math.min(c.min,_.minimums[0]),c.max=Math.max(c.max,_.maximums[0])}return c},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,c=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,c):c}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-85.051129,this.maxLat=r.cv,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aD(this.minLng)*this.tileSize,this.worldMaxX=r.aD(this.maxLng)*this.tileSize,this.worldMinY=r.aH(this.maxLat)*this.tileSize,this.worldMaxY=r.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,s){return this.projection.createTileMatrix(this,s,t)}calculateDistanceTileData(t){const s=t.key,c=this._distanceTileDataCache;if(c[s])return c[s];const m=t.canonical,_=1/this.height,v=this.cameraWorldSize,S=v/this.zoomScale(m.z),A=(m.x+Math.pow(2,m.z)*t.wrap)*S,k=m.y*S,L=this.point;L.x*=v/this.worldSize,L.y*=v/this.worldSize;const B=this.angle,O=Math.sin(-B),j=-Math.cos(-B);return c[s]={bearing:[O,j],center:[(L.x-A)*_,(L.y-k)*_],scale:S/r.aj*_},c[s]}calculateFogTileMatrix(t){const s=t.key,c=this._fogTileMatrixCache;if(c[s])return c[s];const m=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return r.az(m,this.worldToFogMatrix,m),c[s]=new Float32Array(m),c[s]}calculateProjMatrix(t,s=!1,c=!1){const m=t.key;let _;if(_=c?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,_[m])return _[m];const v=this.calculatePosMatrix(t,this.worldSize);let S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,r.az(v,S,v),_[m]=new Float32Array(v),_[m]}calculatePixelsToTileUnitsMatrix(t){const s=t.tileID.key,c=this._pixelsToTileUnitsCache;if(c[s])return c[s];const m=r.cz(t,this);return c[s]=m,c[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,s=r.bn([],[t,t,t]);return r.az(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const s=r.c6(1,this._center.lat)*this.worldSize,c=this._computeCameraPosition(s),m=this._camera.forward(),_=r.c6(1,this._center.lat);c[2]/=_,m[2]/=_,r.au(m,m);const v=t.raycast(c,m,t.exaggeration());if(v){const S=r.bE([],c,m,v),A=new r.ac(S[0],S[1],r.c6(S[2],r.aY(S[1]))),k=(A.z+r.ae([A.x-c[0],A.y-c[1],A.z-c[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const s=this._elevation,c=r.c6(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),_=s.getAtPointOrZero(new r.ac(...m)),v=this.pixelsPerMeter/this.worldSize*_,S=this._minimumHeightOverTerrain(),A=m[2]-v;if(A<=S)if(A<0||t){const k=this.locationCoordinate(this._center,this._centerAltitude),L=[m[0],m[1],k.z-m[2]],B=r.ae(L);L[2]-=(S-A)/this._pixelsPerMercatorPixel;const O=r.ae(L);if(O===0)return;r.bY(L,L,B/O*this._pixelsPerMercatorPixel),this._camera.position=[m[0],m[1],k.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const O=this.center;return O.lat=r.ay(O.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(O.lng=r.ay(O.lng,this.minLng,this.maxLng)),this.center=O,void(this._constraining=!1)}const s=this._unmodified,{x:c,y:m}=this.point;let _=0,v=c,S=m;const A=this.width/2,k=this.height/2,L=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(m-k<L&&(S=L+k),m+k>B&&(S=B-k),B-L<this.height&&(_=Math.max(_,this.height/(B-L)),S=(B+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const O=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,X=this.worldSize/2-(O+j)/2;v=(c+X+this.worldSize)%this.worldSize-X,v-A<O&&(v=O+A),v+A>j&&(v=j-A),j-O<this.width&&(_=Math.max(_,this.width/(j-O)),v=(j+O)/2)}v===c&&S===m||this._allowWorldUnderZoom||(this.center=this.unproject(new r.P(v,S))),_&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.projection.name==="globe",c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.c6(1,this.center.lat)/r.c6(1,r.cP));const m=r.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this.projection.zAxisUnit==="meters"?c:1,v=this._camera.getWorldToCamera(this.worldSize,_);let S;const A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-t.x/this.width,A[9]=2*t.y/this.height,this.isOrthographic){let Ee=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ae=Ee*this.aspect,Oe=-Ae,Ge=-Ee;Ae-=t.x,Oe-=t.x,Ee+=t.y,Ge+=t.y,S=this._camera.getCameraToClipOrthographic(Oe,Ae,Ge,Ee,this._nearZ,this._farZ),((nt,it,ht,Be)=>{for(let Xe=0;Xe<16;Xe++)nt[Xe]=r.ai(it[Xe],ht[Xe],Be)})(S,S,A,r.cN(this.pitch>=qr?1:this.pitch/qr))}else S=A;const k=r.cB([],A,v);let L=r.cB([],S,v);if(this.projection.isReprojectedInTileSpace){const Ee=this.locationCoordinate(this.center),Ae=r.bx([]);r.bo(Ae,Ae,[Ee.x*this.worldSize,Ee.y*this.worldSize,0]),r.az(Ae,Ae,r.cC(this)),r.bo(Ae,Ae,[-Ee.x*this.worldSize,-Ee.y*this.worldSize,0]),r.az(L,L,Ae),r.az(k,k,Ae),this.inverseAdjustmentMatrix=r.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.cE([],L,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=L,this.invProjMatrix=r.bi(new Float64Array(16),this.projMatrix),s){const Ee=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ee[8]=2*-t.x/this.width,Ee[9]=2*t.y/this.height,this.expandedFarZProjMatrix=r.cB([],Ee,v)}else this.expandedFarZProjMatrix=this.projMatrix;const B=r.bi([],S);this.frustumCorners=r.cF.fromInvProjectionMatrix(B,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const O=new Float32Array(16);r.bx(O),r.cE(O,O,[1,-1,1]),r.cG(O,O,this._pitch),r.by(O,O,this.angle);const j=r.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.bw(j);const X=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-t.x/this.width,j[9]=2*(t.y+X)/this.height,this.skyboxMatrix=r.az(O,j,O);const W=this.point,Y=W.x,J=W.y,ie=this.width%2/2,ue=this.height%2/2,pe=Math.cos(this.angle),be=Math.sin(this.angle),Te=Y-Math.round(Y)+pe*ie+be*ue,xe=J-Math.round(J)+pe*ue+be*ie,me=new Float64Array(L);if(r.bo(me,me,[Te>.5?Te-1:Te,xe>.5?xe-1:xe,0]),this.alignedProjMatrix=me,L=r.bz(),r.cE(L,L,[this.width/2,-this.height/2,1]),r.bo(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=r.bz(),r.cE(L,L,[1,-1,1]),r.bo(L,L,[-1,-1,0]),r.cE(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=r.az(new Float64Array(16),this.labelPlaneMatrix,k),this._calcFogMatrices(),this._distanceTileDataCache={},L=r.bi(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.cH(this);const Ee=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.ad(Ee,Ee,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,c=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,_=[t,t,s];r.bY(_,_,m),r.bY(c,c,-1),r.cI(c,c,_);const v=r.bz();r.bo(v,v,c),r.cE(v,v,_),this.mercatorFogMatrix=v,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,m)}_computeCameraPosition(t){const s=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,c=this._camera.forward(),m=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-t/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-c[0]*_,m.y/this.worldSize-c[1]*_,t/this.worldSize*this._centerAltitude-c[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),c=this._camera.position[2],m=t[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(_=Math.min((s-c)/m,1)),this._camera.position=r.bE([],this._camera.position,t,_),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:c,bearing:m}=this._camera.getPitchBearing(),_=r.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,v=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.al(this._maxPitch)),S=Math.max((t[2]-_)/Math.cos(c),v),A=this._zoomFromMercatorZ(S);r.bE(t,t,s,S),this._pitch=r.ay(c,r.al(this.minPitch),r.al(this.maxPitch)),this.angle=r.bX(m,-Math.PI,Math.PI),this._setZoom(r.ay(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let s=0,c=r.cx,m=0,_=1/0;for(;c-s>1e-6&&c>s;){const v=s+.5*(c-s),S=this.tileSize*Math.pow(2,v),A=this.getCameraToCenterDistance(this.projection,v,S),k=this.scaleZoom(A/(Math.max(0,t)*this.tileSize)),L=Math.abs(v-k);L<_&&(_=L,m=v),v<k?s=v:c=v}return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,s){const c=Math.min(t.x,s.x),m=Math.max(t.x,s.x),_=Math.min(t.y,s.y),v=Math.max(t.y,s.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new r.P(c,_),new r.P(m,v),new r.P(c,v),new r.P(m,_)],A=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const L of S){const B=this.pointRayIntersection(L);if(B.t<0)return!0;const O=this.rayIntersectionCoordinate(B);if(O.x<A||O.y<0||O.x>k||O.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(t,s){const c=r.ae(r.at([],this._camera.position,t)),m=this._zoomFromMercatorZ(c)+s;return c-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([s,c,m],_){const v=[s,c,m,1];r.aA(v,v,_);const S=v[3]=Math.max(v[3],1e-6);return v[0]/=S,v[1]/=S,v[2]/=S,v}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,t))}}getCameraToCenterDistance(t,s=this.zoom,c=this.worldSize){const m=r.cA(t,s,this.width,this.height,1024),_=t.pixelSpaceConversion(this.center.lat,c,m);let v=.5/Math.tan(.5*this._fov)*this.height*_;return this.isOrthographic&&(v=r.ai(1,v,r.cN(this.pitch>=qr?1:this.pitch/qr))),v}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.az(t,t,this.globeMatrix),t}getFrustum(t){return r.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const xo=(l,t)=>{if(t>0&&l.terrain&&r.w("Cutoff is currently disabled on terrain"),t<=0||l.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=l.transform,c=Math.max(Math.abs(s._zoom-(l.minCutoffZoom-1)),1),m=s.isLODDisabled(!1)?r.af(60,45,s.pitch):r.af(30,15,s.pitch),_=s._farZ-s._nearZ,v=t*s.height,S=((1-(A=m))*s.cameraToCenterDistance+A*(s._farZ+v))*c;var A;return{shouldRenderCutoff:m<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(S-s._nearZ)/_,(S-v-s._nearZ)/_]}}},Zr={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class bh{constructor(t,s){this.aabb=t,this.lastCascade=s}}class Td{add(t,s){const c=this.receivers[t.key];c!==void 0?(c.aabb.min[0]=Math.min(c.aabb.min[0],s.min[0]),c.aabb.min[1]=Math.min(c.aabb.min[1],s.min[1]),c.aabb.min[2]=Math.min(c.aabb.min[2],s.min[2]),c.aabb.max[0]=Math.max(c.aabb.max[0],s.max[0]),c.aabb.max[1]=Math.max(c.aabb.max[1],s.max[1]),c.aabb.max[2]=Math.max(c.aabb.max[2],s.max[2])):this.receivers[t.key]=new bh(s,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,s,c){const m=r.cW.fromPoints(t.points);let _=0;for(const v in this.receivers){const S=this.receivers[v];if(!S||!m.intersectsAabb(S.aabb))continue;S.aabb.min=m.closestPoint(S.aabb.min),S.aabb.max=m.closestPoint(S.aabb.max);const A=S.aabb.getCorners();for(let k=0;k<c.length;k++){let L=!0;for(const B of A){const O=[B[0]*s,B[1]*s,B[2]];if(r.ad(O,O,c[k].matrix),O[0]<-1||O[0]>1||O[1]<-1||O[1]>1){L=!1;break}}if(S.lastCascade=k,_=Math.max(_,k),L)break}}return _+1}}class Em{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Td,this._depthMode=new Xt(t.context.gl.LEQUAL,Xt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(Zr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Zr,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Zr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,s){const c=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const m=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||m<=0||(this._shadowLayerCount=c.style.order.reduce((X,W)=>{const Y=c.style._mergedLayers[W];return X+(Y.hasShadowPass()&&!Y.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const _=c.context,v=Zr.shadowMapResolution,S=Zr.shadowMapResolution;if(this._cascades.length===0||Zr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let X=0;X<Zr.cascadeCount;++X){const W=c._shadowMapDebug,Y=_.gl,J=_.createFramebuffer(v,S,W,"texture"),ie=new r.T(_,{width:v,height:S,data:null},Y.DEPTH_COMPONENT16);if(J.depthAttachment.set(ie.texture),W){const ue=new r.T(_,{width:v,height:S,data:null},Y.RGBA8);J.colorAttachment.set(ue.texture)}this._cascades.push({framebuffer:J,texture:ie,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.cn,scale:0})}}this.shadowDirection=Hl(s);let A=0;if(t.elevation){const X=t.elevation,W=[1e4,-1e4];X.visibleDemTiles.filter(Y=>Y.dem).forEach(Y=>{const J=Y.dem.tree;W[0]=Math.min(W[0],J.minimums[0]),W[1]=Math.max(W[1],J.maximums[0])}),W[0]!==1e4&&(A=(W[1]-W[0])*X.exaggeration())}const k=1.5*t.cameraToCenterDistance,L=3*k,B=new Float64Array(16);for(let X=0;X<this._cascades.length;++X){const W=this._cascades[X];let Y=t.height/50,J=1;Zr.cascadeCount===1?J=L:X===0?J=k:(Y=k,J=L);const[ie,ue]=Dc(t,this.shadowDirection,Y,J,Zr.shadowMapResolution,A);W.scale=t.scale,W.matrix=ie,W.boundingSphereRadius=ue,r.bi(B,W.matrix),W.frustum=r.cn.fromInvProjectionMatrix(B,1,0,!0),W.far=J}const O=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[O].far,this._cascades[O].far],this._uniformValues.u_shadow_intensity=m,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Zr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Zr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Hs.ShadowMap0,this._uniformValues.u_shadowmap_1=Hs.ShadowMap0+1,this._groundShadowTiles=c.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const j=c.transform.elevation;for(const X of this._groundShadowTiles){let W={min:0,max:0};if(j){const Y=j.getMinMaxForTile(X);Y&&(W=Y)}this.addShadowReceiver(X.toUnwrapped(),W.min,W.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,s){if(!this.enabled)return;const c=this.painter,m=c.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(c.transform.getFrustum(0),c.transform.worldSize,this._cascades),m.viewport.set([0,0,Zr.shadowMapResolution,Zr.shadowMapResolution]);for(let _=0;_<this._numCascadesToRender;++_){c.currentShadowCascade=_,m.bindFramebuffer.set(this._cascades[_].framebuffer.framebuffer),m.clear({color:r.am.white,depth:1});for(const v of t.order){const S=t._mergedLayers[v];if(!S.hasShadowPass()||S.isHidden(c.transform.zoom))continue;const A=t.getLayerSourceCache(S),k=A?s[A.id]:void 0;(S.type==="model"||k&&k.length)&&c.renderLayer(c,A,S,k)}}c.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,s=t.style,c=t.context,m=c.gl,_=s.directionalLight,v=s.ambientLight;if(!_||!v)return;const S=[],A=xo(t,t.longestCutoffRange);A.shouldRenderCutoff&&S.push("RENDER_CUTOFF"),S.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&S.push("NORMAL_OFFSET");const k=al(s,_,v),L=new Xt(m.LEQUAL,Xt.ReadOnly,t.depthRangeFor3D),B=new vi({func:m.EQUAL,mask:255},0,255,m.KEEP,m.KEEP,m.KEEP);for(const O of this._groundShadowTiles){const j=O.toUnwrapped(),X=t.isTileAffectedByFog(O),W=t.getOrCreateProgram("groundShadow",{defines:S,overrideFog:X});this.setupShadows(j,W),t.uploadCommonUniforms(c,W,j,null,A);const Y={u_matrix:t.transform.calculateProjMatrix(j),u_ground_shadow_factor:k};W.draw(t,m.TRIANGLES,L,B,Wi.multiply,mi.disabled,Y,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Wi.unblended:Wi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const s=this.painter.transform,c=s.calculatePosMatrix(t,s.worldSize);return r.az(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}calculateShadowPassMatrixFromMatrix(t){return r.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,s,c,m=0){if(!this.enabled)return;const _=this.painter.transform,v=this.painter.context,S=v.gl,A=this._uniformValues,k=new Float64Array(16),L=_.calculatePosMatrix(t,_.worldSize);for(let B=0;B<this._cascades.length;B++)r.az(k,this._cascades[B].matrix,L),A[B===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),v.activeTexture.set(S.TEXTURE0+Hs.ShadowMap0+B),this._cascades[B].texture.bindExtraParam(S.LINEAR,S.LINEAR,S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE,S.GREATER);if(this.useNormalOffset=!!c,this.useNormalOffset){const B=r.cU(t.canonical),O=2/_.tileSize*r.aj/Zr.shadowMapResolution,j=O*this._cascades[0].boundingSphereRadius,X=O*this._cascades[this._cascades.length-1].boundingSphereRadius,W=(c==="vector-tile"?1:3)/Math.pow(2,m-t.canonical.z-(1-_.zoom+Math.floor(_.zoom)));A.u_shadow_normal_offset=[B,j*W,X*W],A.u_shadow_bias=[6e-5,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(v,A)}setupShadowsFromMatrix(t,s,c=!1){if(!this.enabled)return;const m=this.painter.context,_=m.gl,v=this._uniformValues,S=new Float64Array(16);for(let A=0;A<Zr.cascadeCount;A++)r.az(S,this._cascades[A].matrix,t),v[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),m.activeTexture.set(_.TEXTURE0+Hs.ShadowMap0+A),this._cascades[A].texture.bindExtraParam(_.LINEAR,_.LINEAR,_.CLAMP_TO_EDGE,_.CLAMP_TO_EDGE,_.GREATER);if(this.useNormalOffset=c,c){const A=Zr.normalOffset;v.u_shadow_normal_offset=[1,A,A],v.u_shadow_bias=[6e-5,.0012,.012]}else v.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(m,v)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,s,c,m){if(m[2]>=0)return{};const _=function(A,k,L){const B=L/(1<<A.canonical.z);return new r.cW([A.canonical.x*B+A.wrap*L,A.canonical.y*B+A.wrap*L,0],[(A.canonical.x+1)*B+A.wrap*L,(A.canonical.y+1)*B+A.wrap*L,k])}(t,s,c).getCorners(),v=s/-m[2];m[0]<0?(r.cV(_[0],_[0],[m[0]*v,0,0]),r.cV(_[3],_[3],[m[0]*v,0,0])):m[0]>0&&(r.cV(_[1],_[1],[m[0]*v,0,0]),r.cV(_[2],_[2],[m[0]*v,0,0])),m[1]<0?(r.cV(_[0],_[0],[0,m[1]*v,0]),r.cV(_[1],_[1],[0,m[1]*v,0])):m[1]>0&&(r.cV(_[2],_[2],[0,m[1]*v,0]),r.cV(_[3],_[3],[0,m[1]*v,0]));const S={};return S.vertices=_,S.planes=[ol(_[1],_[0],_[4]),ol(_[2],_[1],_[5]),ol(_[3],_[2],_[6]),ol(_[0],_[3],_[7])],S}addShadowReceiver(t,s,c){this._receivers.add(t,r.cW.fromTileIdAndHeight(t,s,c))}getMaxCascadeForTile(t){const s=this._receivers.get(t);return s&&s.lastCascade?s.lastCascade:0}}function ol(l,t,s){const c=r.at([],s,t),m=r.at([],l,t),_=r.bF([],c,m),v=r.ae(_);return v===0?[0,0,1,0]:(r.bY(_,_,1/v),[_[0],_[1],_[2],-r.bG(_,t)])}function Hl(l){const t=l.properties.get("direction"),s=r.cR(t.x,t.y,t.z);s[2]=r.ay(s[2],0,75);const c=r.cT([s[0],s[1],s[2]]);return r.cS(c.x,c.y,c.z)}function al(l,t,s){const c=t.properties.get("color-use-theme")==="none",m=t.properties.get("color"),_=t.properties.get("intensity"),v=t.properties.get("direction"),S=[v.x,v.y,v.z],A=s.properties.get("color-use-theme")==="none",k=s.properties.get("color"),L=s.properties.get("intensity"),B=Math.max(r.bG([0,0,1],S),0),O=[0,0,0];r.bY(O,k.toPremultipliedRenderColor(A?null:l.getLut(t.scope)).toArray01Linear().slice(0,3),L);const j=[0,0,0];return r.bY(j,m.toPremultipliedRenderColor(c?null:l.getLut(s.scope)).toArray01Linear().slice(0,3),B*_),r.cY([O[0]>0?O[0]/(O[0]+j[0]):0,O[1]>0?O[1]/(O[1]+j[1]):0,O[2]>0?O[2]/(O[2]+j[2]):0])}function Dc(l,t,s,c,m,_){const v=l.zoom,S=l.scale,A=l.worldSize,k=1/A,L=l.aspect,B=Math.sqrt(1+L*L)*Math.tan(.5*l.fovX),O=B*B,j=c-s,X=c+s;let W,Y;O>j/X?(W=c,Y=c*B):(W=.5*X*(1+O),Y=.5*Math.sqrt(j*j+2*(c*c+s*s)*O+X*X*O*O));const J=l.projection.pixelsPerMeter(l.center.lat,A),ie=l._camera.getCameraToWorldMercator(),ue=[0,0,-W*k];r.ad(ue,ue,ie);let pe=Y*k;const be=l._edgeInsets;if(!(be.left===0&&be.top===0&&be.right===0&&be.bottom===0||be.left===be.right&&be.top===be.bottom)){const ut=l._camera.getWorldToCamera(l.worldSize,l.projection.zAxisUnit==="meters"?J:1),Et=l._camera.getCameraToClipPerspective(l._fov,l.width/l.height,s,c);Et[8]=2*-l.centerOffset.x/l.width,Et[9]=2*l.centerOffset.y/l.height;const ot=new Float64Array(16);r.cB(ot,Et,ut);const yt=new Float64Array(16);r.bi(yt,ot);const jt=r.cn.fromInvProjectionMatrix(yt,A,v,!0);for(const Wt of jt.points){const Ot=((Te=Wt)[0]/=S,Te[1]/=S,Te[2]=r.c6(Te[2],l._center.lat),Te);pe=Math.max(pe,r.bZ(r.cX([],ue,Ot)))}}var Te;pe*=m/(m-1);const xe=Math.acos(t[2]),me=Math.atan2(-t[0],-t[1]),Ee=new Xo;Ee.position=ue,Ee.setPitchBearing(xe,me);const Ae=Ee.getWorldToCamera(A,J),Oe=pe*A,Ge=Math.min(l._mercatorZfromZoom(17)*A*-2,-2*Oe),nt=Ee.getCameraToClipOrthographic(-Oe,Oe,-Oe,Oe,Ge,(Oe+_*J)/t[2]),it=new Float64Array(16);r.az(it,nt,Ae);const ht=r.cS(Math.floor(1e6*ue[0])/1e6*A,Math.floor(1e6*ue[1])/1e6*A,0),Be=.5*m,Xe=[0,0,0];r.ad(Xe,ht,it),r.bY(Xe,Xe,Be);const ke=[Math.floor(Xe[0]),Math.floor(Xe[1]),Math.floor(Xe[2])],st=[0,0,0];r.at(st,Xe,ke),r.bY(st,st,-1/Be);const We=new Float64Array(16);return r.bx(We),r.bo(We,We,st),r.az(it,We,it),[it,Oe]}class Af extends r.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,s){return r.aS(this.requestManager.transformRequest(s,r.R.Model).url).then(c=>{if(!c)return;const m=r.aT(c),_=new r.aU(t,void 0,void 0,m);return _.computeBoundsAndApplyParent(),_}).catch(c=>{if(c&&c.status===404)return null;this.fire(new r.z(new Error(`Could not load model ${t} from ${s}: ${c.message}`)))})}load(t,s,c={forceReload:!1}){this.models[s]||(this.models[s]={});const m=Object.keys(t),_=[],v=[];for(const S of m){const A=t[S];this.hasURLBeenRequested(A)&&!c.forceReload||(this.modelByURL[A]={modelId:S,scope:s},_.push(this.loadModel(S,A)),v.push(S)),this.models[s][S]||(this.models[s][S]={model:null,numReferences:1})}this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+v.length,Promise.allSettled(_).then(S=>{for(let A=0;A<S.length;A++){const{status:k}=S[A];if(k==="rejected")continue;const{value:L}=S[A];this.models[s][v[A]]||(this.models[s][v[A]]={model:null,numReferences:1}),this.models[s][v[A]].model=L}this.numModelsLoading[s]-=v.length,this.fire(new r.A("data",{dataType:"style"}))}).catch(S=>{this.fire(new r.z(new Error(`Could not load models: ${S.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,s,c={exactIdMatch:!1}){return!!(c.exactIdMatch?this.getModel(t,s):this.getModelByURL(this.modelUris[s][t]))}getModel(t,s){return this.models[s]||(this.models[s]={}),this.models[s][t]?this.models[s][t].model:void 0}getModelByURL(t){if(!t)return null;const s=this.modelByURL[t];return s?this.models[s.scope][s.modelId].model:null}hasModelBeenAdded(t,s){return this.models[s]&&this.models[s][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,s,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const m=this.requestManager.normalizeModelURL(s);if((this.hasModel(t,c,{exactIdMatch:!0})||this.hasModelBeenAdded(t,c))&&this.modelUris[c][t]===m)this.models[c][t].numReferences++;else if(this.hasURLBeenRequested(m)){const{scope:_,modelId:v}=this.modelByURL[m];this.models[_][v].numReferences++}else this.modelUris[c][t]=m,this.load({[t]:this.modelUris[c][t]},c)}addModelURLs(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const c=this.modelUris[s];for(const m in t)c[m]=this.requestManager.normalizeModelURL(t[m])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const c={};for(const m of t)this.hasModel(m,s,{exactIdMatch:!0})||this.hasURLBeenRequested(m)?this.models[s][m].numReferences++:this.modelUris[s][m]&&!this.hasURLBeenRequested(m)?c[m]=this.modelUris[s][m]:!this.hasURLBeenRequested(m)&&r.cZ(m,!1)&&(this.modelUris[s][m]=this.requestManager.normalizeModelURL(m),c[m]=this.modelUris[s][m]);this.load(c,s)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,s,c=!1){if(this.models[s]&&this.models[s][t]&&(this.models[s][t].numReferences--,this.models[s][t].numReferences===0)){const m=this.modelUris[s][t];c||delete this.modelUris[s][t],delete this.modelByURL[m];const _=this.models[s][t].model;if(!_)return;delete this.models[s][t],_.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const s of Object.keys(this.models[t])){const c=this.models[t][s].model;delete this.models[t][s],c&&c.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,s){this.models[s]||(this.models[s]={});for(const c in this.models[s])this.models[s][c].model&&this.models[s][c].model.upload(t.context)}}const Th=new r.a7({data:new r.a8(r.a5.colorTheme.data)}),If={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function ll(l){return l=l||{},Object.assign(l,If)}class Cm extends r.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._floorplanStates={},r.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new r.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible()}_onMove(){this._checkFloorplanVisible()}_checkFloorplanVisible(){if(!this._queryFeatureSetId||!this._map.isStyleLoaded())return;const t=()=>{this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new r.A("floorplangone"))};if(this._map.transform.zoom<13)return void t();const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},c=this._map.transform.width,m=this._map.transform.height,_=c*(2/3),v=m*(2/3),S=.5*(c-_),A=.5*(m-v),k=[new r.P(S,A),new r.P(S+_,A+v)],L=this._map.queryRenderedFeatures(k,s);L.length>0?this._selectedFloorplan&&L[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=L[0],this._floorplanSelected()):t()}_floorplanSelected(){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._floorplanStates[this._indoorData.id]=this._floorplanStates[this._indoorData.id]||{},this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[this._indoorData.id]]);const t=this._floorplanStates[this._indoorData.id].selectedBuilding,s=t?this._indoorData.buildings.find(S=>S.id===t):this._indoorData.buildings.length>0?this._indoorData.buildings[0]:null,c=this._floorplanStates[this._indoorData.id].selectedLevel,m=this._indoorData.levels.find(S=>S.id===c),_=this._indoorData.levels.find(S=>!(!s||!s.levels)&&Number(S.levelOrder)===0&&s.levels.includes(S.id)),v=m?m.id:_?_.id:void 0;this.fire(new r.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:v})),s&&this._buildingSelected(s,!1),v&&this._levelSelected(v)}_buildingSelected(t,s){if(!t||!t.id)return void console.warn("IndoorManager: Building or building id is undefined");s&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const c=this._indoorData.levels.filter(m=>t.levels.includes(m.id));this.fire(new r.A("buildingselected",{buildingId:t.id,levels:c}))}_levelSelected(t){const s=this._indoorData.levels.find(c=>c.id===t);s?(this._updateLevels(s,!0),this.fire(new r.A("levelselected",{levelId:s.id}))):console.warn(`IndoorManager: Level with ID ${t} not found in the current floorplan.`)}_updateLevels(t,s){if(!t||!t.id)throw new Error("IndoorManager: Selected level or level ID is undefined");function c(k){const L=k.indexOf("/floor/");if(L===-1)return k;const B=L+7,O=k.indexOf("/",B);return O===-1?k.slice(B):k.slice(B,O)}this._floorplanStates[this._indoorData.id].selectedLevel=t.id;const m=[],_={},v={},S={},A={};for(const k of this._indoorData.levels){if(m.push(k.id),_[k.id]=k.levelOrder>=0?3*Math.abs(k.levelOrder+1):3*Math.abs(k.levelOrder),v[k.id]=k.levelOrder>=0?3*k.levelOrder:0,this.mergeFloors){const L=c(t.id),B=c(k.id);S[k.id]=B===L?"true":"false"}else S[k.id]=k.id===t.id?"true":"false";A[k.id]=k.levelOrder<t.levelOrder?"true":"false"}this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",m]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",_]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",S]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",A]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",t.levelOrder<0)}selectFloorplan(t){const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},c=[new r.P(0,0),new r.P(this._map.transform.width,this._map.transform.height)],m=this._map.queryRenderedFeatures(c,s);if(m.length>0){for(const _ of m)if(JSON.parse(_.properties["indoor-data"]).id===t){this._selectedFloorplan=_,this._floorplanSelected();break}}}selectBuilding(t){const s=this._indoorData.buildings.find(c=>c.id===t);this._buildingSelected(s,!0)}selectLevel(t){this._levelSelected(t)}}function Am(l){if(!l.metadata||!l.metadata.content_area)return;const t=r.q.devicePixelRatio,{left:s,top:c,width:m,height:_}=l.metadata.content_area,v=s*t,S=c*t;return[v,S,v+m*t,S+_*t]}function Cp(l){if(l)return l.map(([t,s])=>[t*r.q.devicePixelRatio,s*r.q.devicePixelRatio])}class Yo{constructor(t,s,c){this.id=t,this.scope=s,this.sourceCache=c,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const s=this.sourceCache.getVisibleCoordinates();if(s.length===0)return t;const c=this.sourceCache.getSource();if(!(c instanceof Dl))return t;const m=s.map(v=>this.sourceCache.getTile(v)),_=c.getImages(m,Array.from(this.pendingRequests));for(const[v,S]of _)t.set(r.I.from({name:v,iconsetId:this.id}),S),this.pendingRequests.delete(v);for(const v of this.pendingRequests)this.missingRequests.add(v);return this.pendingRequests.clear(),t}}const sa=(l,t)=>we(l,t&&t.filter(s=>s.identifier!=="source.canvas")),Sd=r.aF(pn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Pf=r.aF(pn,["setCenter","setZoom","setBearing","setPitch"]),Sh=new Set(["background","sky","slot","custom"]),Ed={version:8,layers:[],sources:{}},Eh={duration:300,delay:0};class zs extends r.E{constructor(t,s={}){super(),this.map=t,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=r.h({},Eh),this._buildingIndex=new _u(this),this.crossTileSymbolIndex=new no,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new xr,this.dispatcher=s.dispatcher?s.dispatcher:new r.D(r.c$(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new Go(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new r.d0(t._requestManager,s.localFontFamily?r.d1.all:s.localIdeographFontFamily?r.d1.ideographs:r.d1.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new Af(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:s.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",r.d2());const c=this;this._rtlTextPluginCallback=zs.registerForPluginStateChange(m=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(_,v)=>{if(r.d3(_),v&&v.every(S=>S))for(const S in c._sourceCaches){const A=c._sourceCaches[S],k=A.getSource().type;k!=="vector"&&k!=="geojson"||A.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const _=this.getOwnSource(m.sourceId);if(_&&_.vectorLayerIds)for(const v in this._layers){const S=this._layers[v];S.source===_.id&&this._validateLayer(S)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(r.j(t))return t;const s=r.d4(t);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${r.d5(JSON.stringify(t))}`}_diffStyle(t,s,c){this.globalId=this._getGlobalId(t);const m=(_,v)=>{try{v(null,this.setState(_,c))}catch(S){v(S,!1)}};if(typeof t=="string"){const _=this.map._requestManager.normalizeStyleURL(t),v=this.map._requestManager.transformRequest(_,r.R.Style);r.n(v,(S,A)=>{S?this.fire(new r.z(S)):A&&m(A,s)})}else typeof t=="object"&&m(t,s)}loadURL(t,s={}){this.fire(new r.A("dataloading",{dataType:"style"}));const c=typeof s.validate=="boolean"?s.validate:!r.j(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,s.accessToken),this.resolvedImports.add(t);const m=this.importsCache.get(t);if(m)return this._load(m,c);const _=this.map._requestManager.transformRequest(t,r.R.Style);this._request=r.n(_,(v,S)=>{if(this._request=null,v)this.fire(new r.z(v));else if(S)return this.importsCache.set(t,S),this._load(S,c)})}loadJSON(t,s={}){this.fire(new r.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=r.q.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new r.A("dataloading",{dataType:"style"})),this._load(Ed,!1)}_loadImports(t,s,c){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const m=[];for(const _ of t){const v=this._createFragmentStyle(_),S=new Promise(L=>{v.once("style.import.load",L),v.once("error",L)}).then(()=>this.mergeAll());if(m.push(S),this.resolvedImports.has(_.url)){v.loadEmpty();continue}const A=_.data||this.importsCache.get(_.url);A?(v.loadJSON(A,{validate:s}),this._isInternalStyle(A)&&(v.globalId=null)):_.url?v.loadURL(_.url,{validate:s}):v.loadEmpty();const k={style:v,id:_.id,config:_.config};if(c){const L=this.fragments.findIndex(({id:B})=>B===c);this.fragments=this.fragments.slice(0,L).concat(k).concat(this.fragments.slice(L))}else this.fragments.push(k)}return Promise.allSettled(m)}getImportGlobalIds(t=this,s=new Set){for(const c of t.fragments)c.style.globalId&&s.add(c.style.globalId),this.getImportGlobalIds(c.style,s);return[...s.values()]}_createFragmentStyle(t){const s=this.scope?r.C(t.id,this.scope):t.id;let c;const m=this._initialConfig&&this._initialConfig[s];(t.config||m)&&(c=r.h({},t.config,m));const _=new zs(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:c,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return _.setEventedParent(this.map,{style:_}),_}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,s){const c=t.indoor?ll(t.schema):t.schema;if(this._isInternalStyle(t)){const v=r.h({},Ed,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(v,s)}if(this.updateConfig(this._config,c),s&&sa(this,cs(t)))return;this._loaded=!0,this.stylesheet=r.d6(t);const m=()=>{for(const k in t.sources)this.addSource(k,t.sources[k],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const k in t.iconsets)this.addIconset(k,t.iconsets[k]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const v=qo(this.stylesheet.layers);if(this._order=v.map(k=>k.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const k=this.stylesheet.lights[0];this.light=new $e(k.properties,k.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new $e(this.stylesheet.light)),this._layers={};for(const k of v){const L=r.db(k,this.scope,this._styleColorTheme.lut,this.options);L.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L;const B=this.getOwnLayerSourceCache(L),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();B&&L.canCastShadows()&&O&&(B.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const S=this.stylesheet.terrain;S&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(S,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.A("data",{dataType:"style"}));const A=this.isRootStyle();t.imports?this._loadImports(t.imports,s).then(()=>{this._reloadImports(),this.fire(new r.A(A?"style.load":"style.import.load"))}).catch(k=>{this.fire(new r.z(new Error("Failed to load imports",k))),this.fire(new r.A(A?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.A(A?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const _=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(_){const v=this._evaluateColorThemeData(_);this._loadColorTheme(v).then(()=>{m()}).catch(S=>{r.w(`Couldn't load color theme from the stylesheet: ${S}`),m()})}else this._styleColorTheme.lut=null,m()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,s,c,m,_,v,S,A,k,L;const B={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(O.light!=null&&(t=O.light),O.stylesheet.lights)for(const j of O.stylesheet.lights)j.type==="ambient"&&O.ambientLight!=null&&(s=O.ambientLight),j.type==="directional"&&O.directionalLight!=null&&(c=O.directionalLight);m=this._prioritizeTerrain(m,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(_=O.fog),O.stylesheet.snow&&O.snow!=null&&(v=O.snow),O.stylesheet.rain&&O.rain!=null&&(S=O.rain),O.stylesheet.camera!=null&&(L=O.stylesheet.camera),O.stylesheet.projection!=null&&(A=O.stylesheet.projection),O.stylesheet.transition!=null&&(k=O.stylesheet.transition),B[O.scope]=O._styleColorTheme}}),this.light=t,this.ambientLight=s,this.directionalLight=c,this.fog=_,this.snow=v,this.rain=S,this._styleColorThemeForScope=B,m===null?delete this.terrain:this.terrain=m,this.camera=L||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=r.h({},Eh,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const s=c=>{for(const m of c.fragments)s(m.style);t(c)};s(this)}_prioritizeTerrain(t,s,c){const m=t&&t.drapeRenderMode===0;return c===null?s&&s.drapeRenderMode===0?s:m?t:null:s!=null&&(!t||m||s&&s.drapeRenderMode===1)?s:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{t=this._prioritizeTerrain(t,s.terrain,s.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(t=s.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},s={},c={};this.forEachFragmentStyle(m=>{for(const _ in m._sourceCaches){const v=r.C(_,m.scope);t[v]=m._sourceCaches[_]}for(const _ in m._otherSourceCaches){const v=r.C(_,m.scope);s[v]=m._otherSourceCaches[_]}for(const _ in m._symbolSourceCaches){const v=r.C(_,m.scope);c[v]=m._symbolSourceCaches[_]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=c}mergeLayers(){const t={},s=[],c={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(_=>{for(const v of _._order){const S=_._layers[v];if(S.type==="slot"){const A=r.d7(v);if(t[A])continue;t[A]=[]}S.slot&&t[S.slot]?t[S.slot].push(S):s.push(S)}}),this._mergedOrder=[];const m=(_=[])=>{for(const v of _)if(v.type==="slot"){const S=r.d7(v.id);t[S]&&m(t[S]),this._mergedSlots.push(S)}else{const S=r.C(v.id,v.scope);this._mergedOrder.push(S),c[S]=v,v.is3D(!!this.terrain)&&(this._has3DLayers=!0),v.type==="circle"&&(this._hasCircleLayers=!0),v.type==="symbol"&&(this._hasSymbolLayers=!0),v.type==="clip"&&(this._clipLayerPresent=!0)}};m(s),this._mergedOrder.sort((_,v)=>{const S=c[_],A=c[v];return S.hasInitialOcclusionOpacityProperties?A.is3D(!!this.terrain)?1:0:S.is3D(!!this.terrain)&&A.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=c,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=r.h({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(s,c,m,_){const v=r.h({},c);for(const A of Object.keys(r.a5.colorTheme))v[A]===void 0&&(v[A]=r.a5.colorTheme[A].default);const S=new r.a6(Th,s,new Map(m));return S.setTransitionOrValue(v,m),S.untransitioned().possiblyEvaluate(new r.aa(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((c,m)=>{const _="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void c();let v=t;v.startsWith(_)||(v=_+v);const S=r.I.from("mapbox-reserved-lut"),A=new Image;A.src=v,A.onerror=()=>{this._styleColorTheme.lutLoading=!1,m(new Error("Failed to load image data"))},A.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void c();this._styleColorTheme.lutLoading=!1;const{width:k,height:L,data:B}=r.q.getImageData(A);if(L>32)return void m(new Error("The height of the image must be less than or equal to 32 pixels."));if(k!==L*L)return void m(new Error("The width of the image must be equal to the height squared."));this.getImage(S)&&this.removeImage(S),this.addImage(S,{data:new r.r({width:k,height:L},B),pixelRatio:1,sdf:!1,usvg:!1,version:0});const O=this.imageManager.getImage(S,this.scope);O?(this._styleColorTheme.lut={image:O.data,data:t},c()):m(new Error("Missing LUT image."))}})}getLut(t){const s=this._styleColorThemeForScope[t];return s?s.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(s,c,m){let _,v,S;const A=r.q.devicePixelRatio>1?"@2x":"";let k=r.n(c.transformRequest(c.normalizeSpriteURL(s,A,".json"),r.R.SpriteJSON),(O,j)=>{k=null,S||(S=O,_=j,B())}),L=r.o(c.transformRequest(c.normalizeSpriteURL(s,A,".png"),r.R.SpriteImage),(O,j)=>{L=null,S||(S=O,v=j,B())});function B(){if(S)m(S);else if(_&&v){const O=r.q.getImageData(v),j={};for(const X in _){const{width:W,height:Y,x:J,y:ie,sdf:ue,pixelRatio:pe,stretchX:be,stretchY:Te,content:xe}=_[X],me=new r.r({width:W,height:Y});r.r.copy(O,me,{x:J,y:ie},{x:0,y:0},{width:W,height:Y},null),j[X]={data:me,pixelRatio:pe,sdf:ue,stretchX:be,stretchY:Te,content:xe,usvg:!1}}m(null,j)}}return{cancel(){k&&(k.cancel(),k=null),L&&(L.cancel(),L=null)}}}(t,this.map._requestManager,(s,c)=>{if(this._spriteRequest=null,s)this.fire(new r.z(s));else if(c){const m=new Map;for(const _ in c)m.set(r.I.from(_),c[_]);this.addImages(m)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.A("data",{dataType:"style"}))})}addIconset(t,s){if(s.type==="sprite")return void this._loadSprite(s.url);const c=this.getOwnSourceCache(s.source);if(!c)return void this.fire(new r.z(new Error(`Source "${s.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const m=c.getSource();if(m.type!=="raster-array")return void this.fire(new r.z(new Error(`Source "${s.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));m.partial=!1;const _=new Yo(t,this.scope,c);this.imageManager.addImageProvider(_,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!r.j(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const s=this.map._spriteFormat==="auto";var c,m;this._spriteRequest=(m=(_,v)=>{if(this._spriteRequest=null,_)s?this._loadSprite(t):this.fire(new r.z(_));else if(v){const S=new Map;for(const A in v)S.set(r.I.from(A),v[A]);this.addImages(S)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.A("data",{dataType:"style"}))},r.br((c=this.map._requestManager).transformRequest(c.normalizeIconsetURL(t),r.R.Iconset),(_,v)=>{if(_)return void m(_);const S={},A=r.c_(new r.bq(v));for(const k of A.icons){const L={version:1,pixelRatio:r.q.devicePixelRatio,content:Am(k),stretchX:k.metadata?Cp(k.metadata.stretch_x_areas):void 0,stretchY:k.metadata?Cp(k.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:k};S[k.name]=L}m(null,S)}))}_validateLayer(t){const s=this.getOwnSource(t.source);if(!s)return;const c=t.sourceLayer;c&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(c)===-1)&&this.fire(new r.z(new Error(`Source layer "${c}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,s)=>{const c=this.fragments[s];return c&&c.style&&(t.data=c.style.serialize()),t})}_serializeSources(){const t={};for(const s in this._sourceCaches){const c=this._sourceCaches[s].getSource();t[c.id]||(t[c.id]=c.serialize())}return t}_serializeLayers(t){const s=[];for(const c of t){const m=this._layers[c];m&&m.type!=="custom"&&s.push(m.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const s=this.getOwnLayer(t);if(s)return s;this.fire(new r.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const s=this.getOwnSource(t);if(s)return s;this.fire(new r.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,s){const c=this.map.painter;if(c)for(let m=t.minzoom||0;m<(t.maxzoom||25.5);m++){const _=t.getProgramIds();if(_)for(const v of _){const S=t.getDefaultProgramParams(v,s.zoom,this._styleColorTheme.lut);S&&(c.style=this,this.fog&&(c._fogVisible=!0,S.overrideFog=!0,c.getOrCreateProgram(v,S)),c._fogVisible=!1,S.overrideFog=!1,c.getOrCreateProgram(v,S),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(S.overrideRtt=!0,c.getOrCreateProgram(v,S)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const s=this.calculateLightsBrightness();t.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const c=this._changes.isDirty();let m=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const A in S){const{updatedIds:k,removedIds:L}=S[A];(k||L)&&(this._updateWorkerLayers(A,k,L),m=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const _={};for(const S in this._mergedSourceCaches){const A=this._mergedSourceCaches[S];_[S]=A.used,A.used=!1,A.tileCoverLift=0}for(const S of this._mergedOrder){const A=this._mergedLayers[S];if(A.recalculate(t,this._availableImages),!A.isHidden(t.zoom)){const k=this.getLayerSourceCache(A);k&&(k.used=!0,k.tileCoverLift=Math.max(k.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(A,t)}):this.precompilePrograms(A,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&m&&this.mergeLayers();const v=this.imageManager.getPendingImageProviders();for(const S of v)S.sourceCache.used=!0;for(const S in _){const A=this._mergedSourceCaches[S];_[S]!==A.used&&A.getSource().fire(new r.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),c&&this.fire(new r.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const s of t){const c=s.resolvePendingRequests(),m=this.getFragmentStyle(s.scope);m&&m.addImages(c)}}_updateTilesForChangedImages(){const t={};for(const s in this._mergedSourceCaches){const c=this._mergedSourceCaches[s].getSource().scope;t[c]=t[c]||this._changes.getUpdatedImages(c),t[c].length!==0&&this._mergedSourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t[c])}for(const s in t)this._changes.resetUpdatedImages(s)}_updateWorkerLayers(t,s,c){const m=this.getFragmentStyle(t);m&&this.dispatcher.broadcast("updateLayers",{layers:s?m._serializeLayers(s):[],scope:t,removedIds:c||[],options:m.options})}setState(t,s){if(this._checkLoaded(),sa(this,cs(t)))return!1;(t=r.d6(t)).layers=qo(t.layers);const c=function(v,S){if(!v)return[{command:pn.setStyle,args:[S]}];let A=[];try{if(!r.bv(v.version,S.version))return[{command:pn.setStyle,args:[S]}];if(r.bv(v.center,S.center)||A.push({command:pn.setCenter,args:[S.center]}),r.bv(v.zoom,S.zoom)||A.push({command:pn.setZoom,args:[S.zoom]}),r.bv(v.bearing,S.bearing)||A.push({command:pn.setBearing,args:[S.bearing]}),r.bv(v.pitch,S.pitch)||A.push({command:pn.setPitch,args:[S.pitch]}),r.bv(v.sprite,S.sprite)||A.push({command:pn.setSprite,args:[S.sprite]}),r.bv(v.glyphs,S.glyphs)||A.push({command:pn.setGlyphs,args:[S.glyphs]}),r.bv(v.imports,S.imports)||function(j=[],X=[],W){X=X||[];const Y=(j=j||[]).map(Bl),J=X.map(Bl),ie=j.reduce(jl,{}),ue=X.reduce(jl,{}),pe=Y.slice();let be,Te,xe,me;for(be=0,Te=0;be<Y.length;be++)xe=Y[be],ue.hasOwnProperty(xe)?Te++:(W.push({command:pn.removeImport,args:[xe]}),pe.splice(pe.indexOf(xe,Te),1));for(be=0,Te=0;be<J.length;be++)xe=J[J.length-1-be],pe[pe.length-1-be]!==xe&&(ie.hasOwnProperty(xe)?(W.push({command:pn.removeImport,args:[xe]}),pe.splice(pe.lastIndexOf(xe,pe.length-Te),1)):Te++,me=pe[pe.length-be],W.push({command:pn.addImport,args:[ue[xe],me]}),pe.splice(pe.length-be,0,xe));for(const Ee of X){const Ae=ie[Ee.id];Ae&&(delete Ae.data,r.bv(Ae,Ee)||W.push({command:pn.updateImport,args:[Ee.id,Ee]}))}}(v.imports,S.imports,A),r.bv(v.transition,S.transition)||A.push({command:pn.setTransition,args:[S.transition]}),r.bv(v.light,S.light)||A.push({command:pn.setLight,args:[S.light]}),r.bv(v.fog,S.fog)||A.push({command:pn.setFog,args:[S.fog]}),r.bv(v.snow,S.snow)||A.push({command:pn.setSnow,args:[S.snow]}),r.bv(v.rain,S.rain)||A.push({command:pn.setRain,args:[S.rain]}),r.bv(v.projection,S.projection)||A.push({command:pn.setProjection,args:[S.projection]}),r.bv(v.lights,S.lights)||A.push({command:pn.setLights,args:[S.lights]}),r.bv(v.camera,S.camera)||A.push({command:pn.setCamera,args:[S.camera]}),r.bv(v.iconsets,S.iconsets)||function(j,X,W){let Y;for(Y in X=X||{},j=j||{})j.hasOwnProperty(Y)&&(X.hasOwnProperty(Y)||W.push({command:pn.removeIconset,args:[Y]}));for(Y in X){if(!X.hasOwnProperty(Y))continue;const J=X[Y];j.hasOwnProperty(Y)?r.bv(j[Y],J)||(W.push({command:pn.removeIconset,args:[Y]}),W.push({command:pn.addIconset,args:[Y,J]})):W.push({command:pn.addIconset,args:[Y,J]})}}(v.iconsets,S.iconsets,A),!r.bv(v["color-theme"],S["color-theme"]))return[{command:pn.setStyle,args:[S]}];const k={},L=[];(function(j,X,W,Y){let J;for(J in X=X||{},j=j||{})j.hasOwnProperty(J)&&(X.hasOwnProperty(J)||Sa(J,W,Y));for(J in X){if(!X.hasOwnProperty(J))continue;const ie=X[J];j.hasOwnProperty(J)?r.bv(j[J],ie)||(j[J].type==="geojson"&&ie.type==="geojson"&&Ep(j,X,J)?W.push({command:pn.setGeoJSONSourceData,args:[J,ie.data]}):mh(J,X,W,Y)):ph(J,X,W)}})(v.sources,S.sources,L,k);const B=[];v.layers&&v.layers.forEach(j=>{j.source&&k[j.source]?A.push({command:pn.removeLayer,args:[j.id]}):B.push(j)});let O=v.terrain;O&&k[O.source]&&(A.push({command:pn.setTerrain,args:[void 0]}),O=void 0),A=A.concat(L),r.bv(O,S.terrain)||A.push({command:pn.setTerrain,args:[S.terrain]}),function(j,X,W){X=X||[];const Y=(j=j||[]).map(Bl),J=X.map(Bl),ie=j.reduce(jl,{}),ue=X.reduce(jl,{}),pe=Y.slice(),be=Object.create(null);let Te,xe,me,Ee,Ae,Oe,Ge;for(Te=0,xe=0;Te<Y.length;Te++)me=Y[Te],ue.hasOwnProperty(me)?xe++:(W.push({command:pn.removeLayer,args:[me]}),pe.splice(pe.indexOf(me,xe),1));for(Te=0,xe=0;Te<J.length;Te++)me=J[J.length-1-Te],pe[pe.length-1-Te]!==me&&(ie.hasOwnProperty(me)?(W.push({command:pn.removeLayer,args:[me]}),pe.splice(pe.lastIndexOf(me,pe.length-xe),1)):xe++,Oe=pe[pe.length-Te],W.push({command:pn.addLayer,args:[ue[me],Oe]}),pe.splice(pe.length-Te,0,me),be[me]=!0);for(Te=0;Te<J.length;Te++)if(me=J[Te],Ee=ie[me],Ae=ue[me],!be[me]&&!r.bv(Ee,Ae))if(r.bv(Ee.source,Ae.source)&&r.bv(Ee["source-layer"],Ae["source-layer"])&&r.bv(Ee.type,Ae.type)){for(Ge in Nl(Ee.layout,Ae.layout,W,me,null,pn.setLayoutProperty),Nl(Ee.paint,Ae.paint,W,me,null,pn.setPaintProperty),r.bv(Ee.slot,Ae.slot)||W.push({command:pn.setSlot,args:[me,Ae.slot]}),r.bv(Ee.filter,Ae.filter)||W.push({command:pn.setFilter,args:[me,Ae.filter]}),r.bv(Ee.minzoom,Ae.minzoom)&&r.bv(Ee.maxzoom,Ae.maxzoom)||W.push({command:pn.setLayerZoomRange,args:[me,Ae.minzoom,Ae.maxzoom]}),Ee)Ee.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?Nl(Ee[Ge],Ae[Ge],W,me,Ge.slice(6),pn.setPaintProperty):r.bv(Ee[Ge],Ae[Ge])||W.push({command:pn.setLayerProperty,args:[me,Ge,Ae[Ge]]}));for(Ge in Ae)Ae.hasOwnProperty(Ge)&&!Ee.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?Nl(Ee[Ge],Ae[Ge],W,me,Ge.slice(6),pn.setPaintProperty):r.bv(Ee[Ge],Ae[Ge])||W.push({command:pn.setLayerProperty,args:[me,Ge,Ae[Ge]]}))}else W.push({command:pn.removeLayer,args:[me]}),Oe=pe[pe.lastIndexOf(me)+1],W.push({command:pn.addLayer,args:[Ae,Oe]})}(B,S.layers,A)}catch(k){console.warn("Unable to compute style diff:",k),A=[{command:pn.setStyle,args:[S]}]}return A}(this.serialize(),t).filter(v=>!(v.command in Pf));if(c.length===0)return!1;const m=c.filter(v=>!(v.command in Sd));if(m.length>0)throw new Error(`Unimplemented: ${m.map(v=>v.command).join(", ")}.`);const _=[];return c.forEach(v=>{_.push(this[v.command](...v.args))}),s&&Promise.all(_).then(s).catch(s),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){for(const[s,c]of t.entries()){if(this.getImage(s))return this.fire(new r.z(new Error(`An image with the name "${s.name}" already exists.`)));this.imageManager.addImage(s,this.scope,c),this._changes.updateImage(s,this.scope)}return this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})),this}addImage(t,s){return this.getImage(t)?this.fire(new r.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,s),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})),this)}updateImage(t,s,c=!1){this.imageManager.updateImage(t,this.scope,s),c&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.A("data",{dataType:"style"})),this):this.fire(new r.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new r.A("data",{dataType:"style"})),this}addModel(t,s,c={}){return this._checkLoaded(),this._validate(ge,`models.${t}`,s,null,c)||(this.modelManager.addModel(t,s,this.scope),this.fire(new r.A("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this.fire(new r.A("data",{dataType:"style"})),this):this.fire(new r.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,s,c={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(Rl,`sources.${t}`,s,null,c))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=Ll(t,s,this.dispatcher,this);m.scope=this.scope,m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(m.id),source:m.serialize(),sourceId:m.id}));const _=v=>{const S=(v?"symbol:":"other:")+m.id,A=r.C(S,this.scope),k=this._sourceCaches[S]=new bs(A,m,v);(v?this._symbolSourceCaches:this._otherSourceCaches)[m.id]=k,k.onAdd(this.map)};_(!1),s.type!=="vector"&&s.type!=="geojson"||_(!0),m.onAdd&&m.onAdd(this.map),c.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const s=this.getOwnSource(t);if(!s)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new r.z(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new r.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const m=Object.entries(this.stylesheet.iconsets).find(([_,v])=>v.type==="source"&&v.source===t);if(m)return this.fire(new r.z(new Error(`Source "${t}" cannot be removed while iconset "${m[0]}" is using it.`)))}const c=this.getOwnSourceCaches(t);for(const m of c){const _=r.d7(m.id);delete this._sourceCaches[_],this._changes.discardSourceCacheUpdate(m.id),m.fire(new r.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getOwnSource(t).setData(s),this._changes.setDirty()}getOwnSource(t){const s=this.getOwnSourceCache(t);return s&&s.getSource()}getOwnSources(){const t=[];for(const s in this._otherSourceCaches){const c=this.getOwnSourceCache(s);c&&t.push(c.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const s in t){const c=t[s]._tiles;for(const m in c){const _=c[m];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const _ of t){if(this._validate(kl,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){const v=this.ambientLight;v.set(_),v.updateTransitions(s)}else this.ambientLight=new Tn(_,zi||(zi=new r.a7({color:new r.a8(r.a5.properties_light_ambient.color),"color-use-theme":new r.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a8(r.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const v=this.directionalLight;v.set(_),v.updateTransitions(s)}else this.directionalLight=new Tn(_,Bn||(Bn=new r.a7({direction:new r.an(r.a5.properties_light_directional.direction),color:new r.a8(r.a5.properties_light_directional.color),"color-use-theme":new r.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.a8(r.a5.properties_light_directional.intensity),"cast-shadows":new r.a8(r.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new r.a8(r.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.a8(r.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const c=Object.assign(s,{worldview:this.map.getWorldview()}),m=new r.aa(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(m),this.directionalLight&&this.directionalLight.recalculate(m),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,s=this.ambientLight;if(!t||!s)return;const c=O=>.2126*(O[0]<=.03928?O[0]/12.92:Math.pow((O[0]+.055)/1.055,2.4))+.7152*(O[1]<=.03928?O[1]/12.92:Math.pow((O[1]+.055)/1.055,2.4))+.0722*(O[2]<=.03928?O[2]/12.92:Math.pow((O[2]+.055)/1.055,2.4)),m=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),_=t.properties.get("intensity"),v=t.properties.get("direction"),S=1-r.cR(v.x,v.y,v.z)[2]/90,A=c(m)*_*S,k=s.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),L=s.properties.get("intensity"),B=c(k)*L;return Number(((A+B)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(r.d8(t)){const s=r.d9(t),c=this.fragments.find(({id:_})=>_===s);if(!c)return;const m=r.d7(t);return c.style.getFragmentStyle(m)}{const s=this.fragments.find(({id:c})=>c===t);return s?s.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const s={},c=(m,_="")=>`${m}::${_}`;this._featuresetSelectors={};for(const m in t){const _=this._featuresetSelectors[m]=[];for(const v of t[m].selectors){if(v.featureNamespace){const A=this.getOwnLayer(v.layer);if(!A){r.w(`Layer is undefined for selector: ${v.layer}`);continue}const k=c(A.source,A.sourceLayer);if(k in s&&s[k]!==v.featureNamespace){r.w(`"featureNamespace ${v.featureNamespace} of featureset ${m}'s selector is not associated to the same source, skip this selector`);continue}s[k]=v.featureNamespace}let S;if(v.properties)for(const A in v.properties){const k=r.X(v.properties[A]);k.result==="success"&&(S=S||{},S[A]=k.value)}_.push({layerId:v.layer,namespace:v.featureNamespace,properties:S,uniqueFeatureID:v._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const s=this.getFragmentStyle(t);if(!s||!s.stylesheet.featuresets)return[];const c=[];for(const m in s.stylesheet.featuresets)c.push({featuresetId:m,importId:s.scope?s.scope:void 0});return c}getFeaturesetLayers(t,s){const c=this.getFragmentStyle(s),m=c.stylesheet.featuresets;if(!m||!m[t])return this.fire(new r.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const _=[];for(const v of m[t].selectors){const S=c.getOwnLayer(v.layer);S&&_.push(S)}return _}getConfigProperty(t,s){const c=this.getFragmentStyle(t);if(!c)return null;const m=r.C(s,c.scope),_=c.options.get(m),v=_?_.value||_.default:null;return v?v.serialize():null}setConfigProperty(t,s,c){const m=this.getFragmentStyle(t);if(!m)return;const _=m.stylesheet.indoor?ll(m.stylesheet.schema):m.stylesheet.schema;if(!_||!_[s])return;const v=r.X(c);if(v.result!=="success")return void sa(this,v.value);const S=v.value.expression,A=r.C(s,m.scope),k=m.options.get(A);if(!k)return;let L;const{minValue:B,maxValue:O,stepValue:j,type:X,values:W}=_[s],Y=r.X(_[s].default);Y.result==="success"&&(L=Y.value.expression),L?(this.options.set(A,Object.assign({},k,{value:S,default:L,minValue:B,maxValue:O,stepValue:j,type:X,values:W})),this.updateConfigDependencies(s)):this.fire(new r.z(new Error(`No schema defined for the config option "${s}" in the "${t}" fragment.`)))}getConfig(t){const s=this.getFragmentStyle(t);if(!s)return null;const c=s.stylesheet.schema;if(!c)return null;const m={};for(const _ in c){const v=r.C(_,s.scope),S=s.options.get(v),A=S?S.value||S.default:null;m[_]=A?A.serialize():null}return m}setConfig(t,s){const c=this.getFragmentStyle(t);c&&(c.updateConfig(s,c.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const s=this.getFragmentStyle(t);return s?s.stylesheet.schema:null}setSchema(t,s){const c=this.getFragmentStyle(t);c&&(c.stylesheet.schema=s,c.updateConfig(c._config,s),this.updateConfigDependencies())}updateConfig(t,s){if(this._config=t,t||s)if(s)for(const c in s){let m,_;const v=r.X(s[c].default);if(v.result==="success"&&(m=v.value.expression),t&&t[c]!==void 0){const O=r.X(t[c]);O.result==="success"&&(_=O.value.expression)}const{minValue:S,maxValue:A,stepValue:k,type:L,values:B}=s[c];if(m){const O=r.C(c,this.scope);this.options.set(O,{default:m,value:_,minValue:S,maxValue:A,stepValue:k,type:L,values:B})}else this.fire(new r.z(new Error(`No schema defined for config option "${c}".`)))}else this.fire(new r.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const s of this._configDependentLayers){const c=this.getLayer(s);if(c){if(t&&!c.configDependencies.has(t))continue;c.possiblyEvaluateVisibility(),this._updateLayer(c)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(s=>{const c=s._styleColorTheme.colorThemeOverride?s._styleColorTheme.colorThemeOverride:s._styleColorTheme.colorTheme;if(c){const m=s._evaluateColorThemeData(c);(!s._styleColorTheme.lut&&m!==""||s._styleColorTheme.lut&&m!==s._styleColorTheme.lut.data)&&s.setColorTheme(c)}}),this._changes.setDirty()}addLayer(t,s,c={}){this._checkLoaded();const m=t.id;if(this._layers[m])return void this.fire(new r.z(new Error(`Layer with id "${m}" already exists on this map`)));let _;if(t.type==="custom"){if(sa(this,r.da(t)))return;_=r.db(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=r.d6(t),t=r.h(t,{source:m})),this._validate(_n,`layers.${m}`,t,{arrayIndex:-1},c))return;_=r.db(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(_),_.setEventedParent(this,{layer:{id:m}})}_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid);let v=this._order.length;if(s){const L=this._order.indexOf(s);if(L===-1)return void this.fire(new r.z(new Error(`Layer with id "${s}" does not exist on this map.`)));_.slot===this._layers[s].slot?v=L:r.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,m),this._layerOrderChanged=!0,this._layers[m]=_;const S=this.getOwnLayerSourceCache(_),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&_.canCastShadows()&&A&&(S.castsShadows=!0);const k=this._changes.getRemovedLayer(_);if(k&&_.source&&S&&_.type!=="custom"){this._changes.discardLayerRemoval(_);const L=r.C(_.source,_.scope);k.type!==_.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),S.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),_.scope=this.scope,this.mergeLayers()}moveLayer(t,s){this._checkLoaded();const c=this._checkLayer(t);if(!c||t===s)return;const m=this._order.indexOf(t);this._order.splice(m,1);let _=this._order.length;if(s){const v=this._order.indexOf(s);if(v===-1)return void this.fire(new r.z(new Error(`Layer with id "${s}" does not exist on this map.`)));c.slot===this._layers[s].slot?_=v:r.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const s=this._checkLayer(t);if(!s)return;s.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const m=this.getOwnLayerSourceCache(s);if(m&&m.castsShadows){let _=!1;for(const v in this._layers)if(this._layers[v].source===s.source&&this._layers[v].canCastShadows()){_=!0;break}m.castsShadows=_}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,c){this._checkLoaded();const m=this._checkLayer(t);m&&(m.minzoom===s&&m.maxzoom===c||(s!=null&&(m.minzoom=s),c!=null&&(m.maxzoom=c),this._updateLayer(m)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,s){this._checkLoaded();const c=this._checkLayer(t);c&&c.slot!==s&&(c.slot=s,this._updateLayer(c))}setFilter(t,s,c={}){this._checkLoaded();const m=this._checkLayer(t);if(m&&!r.bv(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(qe,`layers.${m.id}.filter`,s,{layerType:m.type},c)||(m.filter=r.d6(s),this._updateLayer(m)))}getFilter(t){const s=this._checkLayer(t);if(s)return r.d6(s.filter)}setLayoutProperty(t,s,c,m={}){this._checkLoaded();const _=this._checkLayer(t);if(_&&!r.bv(_.getLayoutProperty(s),c)){if(c!=null&&(!m||m.validate!==!1)&&sa(_,ne.call(cs,{key:`layers.${t}.layout.${s}`,layerType:_.type,objectKey:s,value:c,styleSpec:r.a5,style:{glyphs:!0,sprite:!0}})))return;_.setLayoutProperty(s,c),_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),this._updateLayer(_)}}getLayoutProperty(t,s){const c=this._checkLayer(t);if(c)return c.getLayoutProperty(s)}setPaintProperty(t,s,c,m={}){this._checkLoaded();const _=this._checkLayer(t);if(!_||r.bv(_.getPaintProperty(s),c)||c!=null&&(!m||m.validate!==!1)&&sa(_,te.call(cs,{key:`layers.${t}.paint.${s}`,layerType:_.type,objectKey:s,value:c,styleSpec:r.a5})))return;const v=_.setPaintProperty(s,c);_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),v&&this._updateLayer(_),this._changes.updatePaintProperties(_)}getPaintProperty(t,s){const c=this._checkLayer(t);if(c)return c.getPaintProperty(s)}setFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:A,importId:k}=t.target,L=this.getFragmentStyle(k),B=L.getFeaturesetLayers(A);for(const{source:O,sourceLayer:j}of B)L.setFeatureState({id:t.id,source:O,sourceLayer:j},s)}else if("layerId"in t.target){const{layerId:A}=t.target,k=this.getLayer(A);this.setFeatureState({id:t.id,source:k.source,sourceLayer:k.sourceLayer},s)}return}const c=t.source,m=t.sourceLayer,_=this._checkSource(c);if(!_)return;const v=_.type;if(v==="geojson"&&m)return void this.fire(new r.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(v==="vector"&&!m)return void this.fire(new r.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new r.z(new Error("The feature id parameter must be provided.")));const S=this.getOwnSourceCaches(c);for(const A of S)A.setFeatureState(m,t.id,s)}removeFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:A,importId:k}=t.target,L=this.getFragmentStyle(k),B=L.getFeaturesetLayers(A);for(const{source:O,sourceLayer:j}of B)L.removeFeatureState({id:t.id,source:O,sourceLayer:j},s)}else if("layerId"in t.target){const{layerId:A}=t.target,k=this.getLayer(A);this.removeFeatureState({id:t.id,source:k.source,sourceLayer:k.sourceLayer},s)}return}const c=t.source,m=this._checkSource(c);if(!m)return;const _=m.type,v=_==="vector"?t.sourceLayer:void 0;if(_==="vector"&&!v)return void this.fire(new r.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new r.z(new Error("A feature id is required to remove its specific state property.")));const S=this.getOwnSourceCaches(c);for(const A of S)A.removeFeatureState(v,t.id,s)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let _;if("featuresetId"in t.target){const{featuresetId:v,importId:S}=t.target,A=this.getFragmentStyle(S),k=A.getFeaturesetLayers(v);for(const{source:L,sourceLayer:B}of k){const O=A.getFeatureState({id:t.id,source:L,sourceLayer:B});if(O&&!_)_=O;else if(!r.bv(_,O))return void this.fire(new r.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:v}=t.target,S=this.getLayer(v);_=this.getFeatureState({id:t.id,source:S.source,sourceLayer:S.sourceLayer})}return _}const s=t.source,c=t.sourceLayer,m=this._checkSource(s);if(m){if(m.type!=="vector"||c)return t.id===void 0&&this.fire(new r.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(c,t.id);this.fire(new r.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=r.h({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return r.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),s=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return r.dc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateFilteredLayers(t){for(const s of Object.values(this._mergedLayers))t(s)&&this._updateLayer(s)}_updateLayer(t){this._changes.updateLayer(t);const s=this.getLayerSourceCache(t),c=r.C(t.source,t.scope),m=this._changes.getUpdatedSourceCaches();t.source&&!m[c]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(c,"reload"),s.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const s=S=>this._mergedLayers[S].is3D(!!this.terrain),c=this.order,m={},_=[];for(let S=c.length-1;S>=0;S--){const A=c[S];if(s(A)){m[A]=S;for(const k of t){const L=k[A];if(L)for(const B of L)_.push(B)}}}_.sort((S,A)=>A.intersectionZ-S.intersectionZ);const v=[];for(let S=c.length-1;S>=0;S--){const A=c[S];if(s(A))for(let k=_.length-1;k>=0;k--){const L=_[k].feature;if(L.layer&&m[L.layer.id]<S)break;v.push(L),_.pop()}else for(const k of t){const L=k[A];if(L)for(const B of L)v.push(B.feature)}}return v}queryRenderedFeatures(t,s,c){let m;s&&!Array.isArray(s)&&s.filter&&(this._validate(qe,"queryRenderedFeatures.filter",s.filter,null,s),m=r.b3(s.filter));const _={},v=L=>{if(Sh.has(L.type))return;const B=this.getOwnLayerSourceCache(L),O=_[B.id]=_[B.id]||{sourceCache:B,layers:{},has3DLayers:!1};L.is3D(!!this.terrain)&&(O.has3DLayers=!0),O.layers[L.fqid]=O.layers[L.fqid]||{styleLayer:L,targets:[]},O.layers[L.fqid].targets.push({filter:m})};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new r.z(new Error("parameters.layers must be an Array."))),[];for(const L of s.layers){const B=this._layers[L];if(!B)return this.fire(new r.z(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];v(B)}}else for(const L in this._layers)v(this._layers[L]);const S=this._queryRenderedFeatures(t,_,c),A=this._flattenAndSortRenderedFeatures(S),k=[];for(const L of A)r.dd(L.layer.id)===this.scope&&k.push(L);return k}queryRenderedFeatureset(t,s,c){let m;s&&!Array.isArray(s)&&s.filter&&(this._validate(qe,"queryRenderedFeatures.filter",s.filter,null,s),m=r.b3(s.filter));const _="mock",v=[];if(s&&s.target)v.push(Object.assign({},s,{targetId:_,filter:m}));else{const L=this.getFeaturesetDescriptors();for(const B of L)v.push({targetId:_,filter:m,target:B});for(const{style:B}of this.fragments){const O=B.getFeaturesetDescriptors();for(const j of O)v.push({targetId:_,filter:m,target:j})}}const S=this.queryRenderedTargets(t,v,c),A=[],k=new Set;for(const L of S)for(const B of L.variants[_])Fl(B,L,k)||A.push(new r.de(L,B));return A}queryRenderedTargets(t,s,c){const m={},_=(S,A,k,L)=>{const B=m[A.id]=m[A.id]||{sourceCache:A,layers:{},has3DLayers:!1};if(B.layers[S.fqid]=B.layers[S.fqid]||{styleLayer:S,targets:[]},S.is3D(!!this.terrain)&&(B.has3DLayers=!0),!L)return k.uniqueFeatureID=!1,void B.layers[S.fqid].targets.push(k);B.layers[S.fqid].targets.push(Object.assign({},k,{namespace:L.namespace,properties:L.properties,uniqueFeatureID:L.uniqueFeatureID}))};for(const S of s)if("featuresetId"in S.target){const{featuresetId:A,importId:k}=S.target,L=this.getFragmentStyle(k);if(!L||!L._featuresetSelectors)continue;const B=L._featuresetSelectors[A];if(!B){this.fire(new r.z(new Error(`The featureset '${A}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const O of B){const j=L.getOwnLayer(O.layerId);j&&!Sh.has(j.type)&&_(j,L.getOwnLayerSourceCache(j),S,O)}}else if("layerId"in S.target){const{layerId:A}=S.target,k=this.getLayer(A);if(!k||Sh.has(k.type))continue;_(k,this.getLayerSourceCache(k),S)}const v=this._queryRenderedFeatures(t,m,c);return this._flattenAndSortRenderedFeatures(v)}_queryRenderedFeatures(t,s,c){const m=[],_=!!this.map._showQueryGeometry,v=xn.createFromScreenPoints(t,c);for(const S in s){const A=vc(v,s[S],this._availableImages,c,_);Object.keys(A).length&&m.push(A)}if(this.placement)for(const S in s){if(!s[S].sourceCache._onlySymbols)continue;const A=wc(v.screenGeometry,s[S],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(A).length&&m.push(A)}return m}querySourceFeatures(t,s){const c=s&&s.filter;c&&this._validate(qe,"querySourceFeatures.filter",c,null,s);let m=[];const _=this.getOwnSourceCaches(t);for(const v of _)m=m.concat(dh(v,s));return m}addSourceType(t,s,c){return zs.getSourceType(t)?c(new Error(`A source type called "${t}" already exists.`)):(zs.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},c):c(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,s,c={}){this._checkLoaded();const m=this.light.getLight();let _=!1;for(const S in t)if(!r.bv(t[S],m[S])){_=!0;break}if(!_)return;const v=this._getTransitionParameters();this.light.setLight(t,s,c),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,s=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let c=t;const m=t.source==null;if(s===1){if(this.disableElevatedTerrain)return;if(typeof c.source=="object"){const S="terrain-dem-src";this.addSource(S,c.source),c=r.d6(c),c=r.h(c,{source:S})}const _=r.h({},c),v={};if(this.terrain&&m){_.source=this.terrain.get().source;const S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(v.style=S.serialize())}if(this._validate(Rt,"terrain",_,v))return}if(!this.terrain||this.terrain.scope!==this.scope&&!m||this.terrain&&s!==this.terrain.drapeRenderMode){if(!c)return;this._createTerrain(c,s),this.fire(new r.A("data",{dataType:"style"}))}else{const _=this.terrain,v=_.get();for(const S of Object.keys(r.a5.terrain))!c.hasOwnProperty(S)&&r.a5.terrain[S].default&&(c[S]=r.a5.terrain[S].default);for(const S in t)if(!r.bv(t[S],v[S])){_.set(t,this.options),this.stylesheet.terrain=t;const A=this._getTransitionParameters({duration:0});_.updateTransitions(A),this.fire(new r.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const s=this.fog=new Ai(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const c=this._getTransitionParameters({duration:0});s.updateTransitions(c)}_createSnow(t){const s=this.snow=new nn(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=s.get();const c=this._getTransitionParameters({duration:0});s.updateTransitions(c)}_createRain(t){const s=this.rain=new tr(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=s.get();const c=this._getTransitionParameters({duration:0});s.updateTransitions(c)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!r.bv(s.get(),t)){s.set(t,this.options),this.stylesheet.fog=s.get();const c=this._getTransitionParameters({duration:0});s.updateTransitions(c)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const s=this.snow;if(!r.bv(s.get(),t)){s.set(t,this.options),this.stylesheet.snow=s.get();const c=this._getTransitionParameters({duration:0});s.updateTransitions(c)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const s=this.rain;if(!r.bv(s.get(),t)){s.set(t,this.options),this.stylesheet.rain=s.get();const c=this._getTransitionParameters({duration:0});s.updateTransitions(c)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const m in this._layers)this._layers[m].lut=this._styleColorTheme.lut;for(const m in this._sourceCaches)this._sourceCaches[m].clearTiles()},s=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!s)return this._styleColorTheme.lut=null,void t();const c=this._evaluateColorThemeData(s);this._loadColorTheme(c).then(()=>{this.fire(new r.A("colorthemeset")),t()}).catch(m=>{r.w(`Couldn't set color theme: ${m}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,s){const c=this.getFragmentStyle(t);c&&(c._styleColorTheme.colorThemeOverride=s,c._reloadColorTheme())}_getTransitionParameters(t){return{now:r.q.now(),transition:r.h(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],s=[];for(const c of this._mergedOrder)this.isLayerDraped(this._mergedLayers[c])?t.push(c):s.push(c);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t,s){const c=this.terrain=new Le(t,s,this.scope,this.options,this.map.getWorldview());s===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="symbol"&&this._updateLayer(s)}}_validate(t,s,c,m,_={}){if(_&&_.validate===!1)return!1;const v=r.h({},this.serialize());return sa(this,t.call(cs,r.h({key:s,style:v,value:c,styleSpec:r.a5},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.df.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const s=this.getSourceCaches(t);for(const c of s)c.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const s=this.getSourceCaches(t);for(const c of s)c.resume(),c.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let s;this.directionalLight&&(s=Hl(this.directionalLight));const c=new Set;for(const m in this._mergedLayers){const _=this._mergedLayers[m];_.hasElevation()&&!c.has(_.source)&&c.add(_.source)}for(const m in this._mergedSourceCaches){const _=this._mergedSourceCaches[m],v=c.has(_._source.id);_.update(t,void 0,void 0,s,v)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,c,m,_,v,S=!1){let A=!1,k=!1;const L={},B={};for(const O of this._mergedOrder){const j=this._mergedLayers[O];if(j.type!=="symbol")continue;const X=r.C(j.source,j.scope);let W=L[X];if(!W){const J=this.getLayerSourceCache(j);if(!J)continue;const ie=J.getRenderableIds(!0).map(ue=>J.getTileByID(ue));B[X]=ie.slice(),W=L[X]=ie.sort((ue,pe)=>pe.tileID.overscaledZ-ue.tileID.overscaledZ||(ue.tileID.isLessThan(pe.tileID)?-1:1))}const Y=this.crossTileSymbolIndex.addLayer(j,W,s.center.lng,s.projection);A=A||Y}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new r.A("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.q.now(),s.zoom))&&(this.pauseablePlacement=new vd(s,this._mergedOrder,S,c,m,_,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,B,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.q.now()),k=!0),A&&this.pauseablePlacement.placement.setStale()),k||A){this._buildingIndex.onNewFrame(s.zoom);for(let O=0;O<this._mergedOrder.length;O++){const j=this._mergedLayers[this._mergedOrder[O]];if(j.type!=="symbol")continue;const X=this.isLayerClipped(j);this.placement.updateLayerOpacities(j,L[r.C(j.source,j.scope)],O,X?v:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,s){this._checkLoaded();const c=this.stylesheet.imports=this.stylesheet.imports||[];if(c.findIndex(({id:_})=>_===t.id)!==-1)return void this.fire(new r.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!s)return c.push(t),this._loadImports([t],!0);const m=c.findIndex(({id:_})=>_===s);return m===-1&&this.fire(new r.z(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=c.slice(0,m).concat(t).concat(c.slice(m)),this._loadImports([t],!0,s)}updateImport(t,s){this._checkLoaded();const c=this.stylesheet.imports||[],m=this.getImportIndex(t);return m===-1?this:typeof s=="string"?(this.setImportUrl(t,s),this):(s.url&&s.url!==c[m].url&&this.setImportUrl(t,s.url),r.bv(s.config,c[m].config)||this.setImportConfig(t,s.config,s.data.schema),r.bv(s.data,c[m].data)||this.setImportData(t,s.data),this)}moveImport(t,s){this._checkLoaded();let c=this.stylesheet.imports||[];const m=this.getImportIndex(t);if(m===-1)return this;const _=this.getImportIndex(s);if(_===-1)return this;const v=c[m],S=this.fragments[m];return c=c.filter(({id:A})=>A!==t),this.fragments=this.fragments.filter(({id:A})=>A!==t),this.stylesheet.imports=c.slice(0,_).concat(v).concat(c.slice(_)),this.fragments=this.fragments.slice(0,_).concat(S).concat(this.fragments.slice(_)),this.mergeLayers(),this}setImportUrl(t,s){this._checkLoaded();const c=this.stylesheet.imports||[],m=this.getImportIndex(t);if(m===-1)return this;c[m].url=s;const _=this.fragments[m];return _.style=this._createFragmentStyle(c[m]),_.style.on("style.import.load",()=>this.mergeAll()),_.style.loadURL(s),this}setImportData(t,s){this._checkLoaded();const c=this.getImportIndex(t),m=this.stylesheet.imports||[];return c===-1?this:s?(this.fragments[c].style.setState(s),this._reloadImports(),this):(delete m[c].data,this.setImportUrl(t,m[c].url))}setImportConfig(t,s,c){this._checkLoaded();const m=this.getImportIndex(t),_=this.stylesheet.imports||[];if(m===-1)return this;s?_[m].config=s:delete _[m].config;const v=this.fragments[m];c&&v.style.stylesheet&&(v.style.stylesheet.schema=c);const S=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=s,v.style.updateConfig(s,S),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const s=this.stylesheet.imports||[],c=this.getImportIndex(t);c!==-1&&(s.splice(c,1),this.fragments[c].style._remove(),this.fragments.splice(c,1),this._reloadImports())}getImportIndex(t){const s=(this.stylesheet.imports||[]).findIndex(c=>c.id===t);return s===-1&&this.fire(new r.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),s}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const s in this._mergedOtherSourceCaches){const c=this._mergedOtherSourceCaches[s];c&&t.push(c.getSource())}return t}getSource(t,s){const c=this.getSourceCache(t,s);return c&&c.getSource()}getLayerSource(t){const s=this.getLayerSourceCache(t);return s&&s.getSource()}getSourceCache(t,s){const c=r.C(t,s);return this._mergedOtherSourceCaches[c]}getLayerSourceCache(t){const s=r.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[t]&&s.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&s.push(this._mergedSymbolSourceCaches[t]),s}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const s in t){const c=t[s];c==="reload"?this.reloadSource(s):c==="clear"&&this.clearSource(s)}}updateLayers(t){const s=this._changes.getUpdatedPaintProperties();for(const c of s){const m=this.getLayer(c);m&&m.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,s,c){this.imageManager.getImages(s.images,s.scope,c),this._updateTilesForChangedImages();const m=v=>{if(v){const S=s.images.map(A=>r.I.toString(A));v.setDependencies(s.tileID.key,s.type,S)}},_=r.C(s.source,s.scope);m(this._mergedOtherSourceCaches[_]),m(this._mergedSymbolSourceCaches[_])}rasterizeImages(t,s,c){this.imageManager.rasterizeImages(s,c)}getGlyphs(t,s,c){this.glyphManager.getGlyphs(s.stacks,s.scope,c)}getResource(t,s,c){return r.dg(s,c)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}_isSourceCacheLoaded(t){const s=this.getOwnSourceCaches(t);return s.length===0?(this.fire(new r.z(new Error(`There is no source with ID '${t}'`))),!1):s.every(c=>c.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,s){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const c=t.type==="fill-extrusion"&&t.sourceLayer==="building",m=t.type==="building";if(t.is3D(!!this.terrain)){if(c||m||s&&s.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}zs.getSourceType=function(l){return gd[l]},zs.setSourceType=function(l,t){gd[l]=t},zs.registerForPluginStateChange=r.dh;var Ch=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Wl=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Ah=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Ca="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ql=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Cd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Lc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ts=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Cu=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Lt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Au=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const zc=[];ds(Ch,zc),ds(Ah,zc),ds(Wl,zc);const Fc={"_prelude_fog.vertex.glsl":Cd,"_prelude_terrain.vertex.glsl":ql,"_prelude_shadow.vertex.glsl":Lt,"_prelude_fog.fragment.glsl":Lc,"_prelude_shadow.fragment.glsl":Au,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ts,"_prelude_raster_particle.glsl":Cu},Iu={};en("",ql),en(Lc,Cd),en(Au,Lt),en(Ts,""),en(Cu,"");const Pu=en(Wl,Ah),oa=Ch;var Ih={background:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:en(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:en("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:en(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:en(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:en("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:en("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:en("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:en(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:en(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:en(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:en(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:en(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:en(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:en("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:en("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:en(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:en(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:en("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:en(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ca),skyboxGradient:en(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ca),skyboxCapture:en(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:en(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:en(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:en(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:en(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:en("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:en("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:en("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:en("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function ds(l,t){const s=l.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let c of s)if(c=c.trim(),c[0]==="#"&&c.includes("if")&&!c.includes("endif")){c=c.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=c.split(" ");for(const _ of m)t.includes(_)||t.push(_)}}function en(l,t){const s=/#include\s+"([^"]+)"/g,c=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let m=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);m&&(m=m.map(k=>{const L=k.split(" ");return L[L.length-1]}),m=[...new Set(m)]);const _={},v=[],S=[];if(l=l.replace(s,(k,L)=>(S.push(L),"")),(t=t.replace(s,(k,L)=>(v.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let A=[...zc];ds(l,A),ds(t,A);for(const k of[...v,...S])Fc[k]||console.error(`Undefined include: ${k}`),Iu[k]||(Iu[k]=[],ds(Fc[k],Iu[k])),A=[...A,...Iu[k]];return{fragmentSource:l=l.replace(c,(k,L,B,O,j)=>(_[j]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${B} ${O} ${j};
#else
uniform ${B} ${O} u_${j};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${j}
    ${B} ${O} ${j} = u_${j};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${B} ${O} ${j};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(c,(k,L,B,O,j)=>{const X=O==="float"?"vec2":O,W=j.match(/color/)?"color":X;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${j}
in ${B} ${O} a_${j};
#endif
`:_[j]?L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${B} ${X} a_${j};
out ${B} ${O} ${j};
#else
uniform ${B} ${O} u_${j};
#endif
`:L==="initialize"?W==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${B} ${O} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${W}(a_${j}, u_${j}_t);
#else
    ${B} ${O} ${j} = u_${j};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${B} ${O} a_${j};
    out ${B} ${O} ${j};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${j} = a_${j};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${B} ${X} a_${j};
#else
uniform ${B} ${O} u_${j};
#endif
`:L==="define-instanced"?W==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${j}0;
in vec4 a_${j}1;
in vec4 a_${j}2;
in vec4 a_${j}3;
#else
uniform ${B} ${O} u_${j};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${B} ${X} a_${j};
#else
uniform ${B} ${O} u_${j};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${B} ${O} ${j} = a_${j};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${B} ${O} ${j} = a_${j};
#else
    ${B} ${O} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${B} ${O} ${j} = unpack_mix_${W}(a_${j}, u_${j}_t);
#else
    ${B} ${O} ${j} = u_${j};
#endif
`}),staticAttributes:m,usedDefines:A,vertexIncludes:v,fragmentIncludes:S}}class Zl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,s,c,m,_,v,S,A){this.context=t;let k=this.boundPaintVertexBuffers.length!==m.length;for(let B=0;!k&&B<m.length;B++)this.boundPaintVertexBuffers[B]!==m[B]&&(k=!0);let L=this.boundDynamicVertexBuffers.length!==S.length;for(let B=0;!L&&B<S.length;B++)this.boundDynamicVertexBuffers[B]!==S[B]&&(L=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==c||k||L||this.boundIndexBuffer!==_||this.boundVertexOffset!==v)this.freshBind(s,c,m,_,v,S,A);else{t.bindVertexArrayOES.set(this.vao);for(const B of S)B&&(B.bind(),A&&B.instanceCount&&B.setVertexAttribDivisor(t.gl,s,A));_&&_.dynamicDraw&&_.bind()}}freshBind(t,s,c,m,_,v,S){const A=t.numAttributes,k=this.context,L=k.gl;this.vao&&this.destroy(),this.vao=k.gl.createVertexArray(),k.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=m,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=v,s.enableAttributes(L,t),s.bind(),s.setVertexAttribPointers(L,t,_);for(const B of c)B.enableAttributes(L,t),B.bind(),B.setVertexAttribPointers(L,t,_);for(const B of v)B&&(B.enableAttributes(L,t),B.bind(),B.setVertexAttribPointers(L,t,_),S&&B.instanceCount&&B.setVertexAttribDivisor(L,t,S));m&&m.bind(),k.currentNumAttributes=A}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Im(l,t){const s=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new r.ac(0,c/s).toLngLat().lat,new r.ac(0,(c+1)/s).toLngLat().lat]}function Pm(l,t,s,c,m,_,v){const S=l.context,A=S.gl,k=s.hillshadeFBO;if(!k)return;l.prepareDrawTile();const L=l.isTileAffectedByFog(t),B=l.getOrCreateProgram("hillshade",{overrideFog:L});S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,k.colorAttachment.get());const O=((Y,J,ie,ue)=>{const pe=ie.paint.get("hillshade-shadow-color"),be=ie.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Te=ie.paint.get("hillshade-highlight-color"),xe=ie.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",me=ie.paint.get("hillshade-accent-color"),Ee=ie.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ae=ie.paint.get("hillshade-emissive-strength");let Oe=r.al(ie.paint.get("hillshade-illumination-direction"));if(ie.paint.get("hillshade-illumination-anchor")==="viewport")Oe-=Y.transform.angle;else if(Y.style&&Y.style.enable3dLights()&&Y.style.directionalLight){const nt=Y.style.directionalLight.properties.get("direction"),it=r.cR(nt.x,nt.y,nt.z);Oe=r.al(it[1])}const Ge=!Y.options.moving;return{u_matrix:ue||Y.transform.calculateProjMatrix(J.tileID.toUnwrapped(),Ge),u_image:0,u_latrange:Im(0,J.tileID),u_light:[ie.paint.get("hillshade-exaggeration"),Oe],u_shadow:pe.toPremultipliedRenderColor(be?null:ie.lut),u_highlight:Te.toPremultipliedRenderColor(xe?null:ie.lut),u_emissive_strength:Ae,u_accent:me.toPremultipliedRenderColor(Ee?null:ie.lut)}})(l,s,c,l.terrain?t.projMatrix:null);l.uploadCommonUniforms(S,B,t.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:X,tileBoundsSegments:W}=l.getTileBoundsBuffers(s);B.draw(l,A.TRIANGLES,m,_,v,mi.disabled,O,c.id,j,X,W)}function Xl(l,t,s){if(!t.needsDEMTextureUpload)return;const c=l.context,m=c.gl;c.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(s.stride);const _=s.getPixels();t.demTexture?t.demTexture.update(_,{premultiply:!1}):t.demTexture=new r.T(c,_,m.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Mm(l,t,s){const c=l.context,m=c.gl;if(!t.dem)return;const _=t.dem;if(c.activeTexture.set(m.TEXTURE1),Xl(l,t,_),!t.demTexture)return;t.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);const v=_.dim;c.activeTexture.set(m.TEXTURE0);let S=t.hillshadeFBO;if(!S){const O=new r.T(c,{width:v,height:v,data:null},m.RGBA8);O.bind(m.LINEAR,m.CLAMP_TO_EDGE),S=t.hillshadeFBO=c.createFramebuffer(v,v,!0,"renderbuffer"),S.colorAttachment.set(O.texture)}c.bindFramebuffer.set(S.framebuffer),c.viewport.set([0,0,v,v]);const{tileBoundsBuffer:A,tileBoundsIndexBuffer:k,tileBoundsSegments:L}=l.getMercatorTileBoundsBuffers(),B=[];l.linearFloatFilteringSupported()&&B.push("TERRAIN_DEM_FLOAT_FORMAT"),l.getOrCreateProgram("hillshadePrepare",{defines:B}).draw(l,m.TRIANGLES,Xt.disabled,vi.disabled,Wi.unblended,mi.disabled,((O,j)=>{const X=j.stride,W=r.bz();return r.c5(W,0,r.aj,-8192,0,0,1),r.bo(W,W,[0,-8192,0]),{u_matrix:W,u_image:1,u_dimension:[X,X],u_zoom:O.overscaledZ}})(t.tileID,_),s.id,A,k,L),t.needsHillshadePrepare=!1}class cr{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Mf extends cr{getDefault(){return r.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Ir extends cr{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Rf extends cr{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Ad extends cr{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ph extends cr{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Ap extends cr{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Id extends cr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Mh extends cr{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Oc extends cr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Mu extends cr{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class kf extends cr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class Df extends cr{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Pd extends cr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Md extends cr{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Aa extends cr{getDefault(){return r.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class cl extends cr{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Ru extends cr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class ku extends cr{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Yl extends cr{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Rd=class extends cr{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}};class Lf extends cr{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class zf extends cr{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Du extends cr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class kd extends cr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Lu extends cr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Ia extends cr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Rh extends cr{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Pa extends cr{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class aa extends cr{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class zu extends cr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ma extends cr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ra extends cr{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class Ip extends Ra{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Pp extends Ra{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Nc extends Ra{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class kh extends Pp{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Kl=(l,t,s)=>({u_matrix:l,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:s}),Bc=(l,t,s,c,m,_,v,S,A,k,L,B,O,j,X,W)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(c),u_merc_matrix:s,u_zoom_transition:m,u_merc_center:_,u_image0:0,u_frustum_tl:v,u_frustum_tr:S,u_frustum_br:A,u_frustum_bl:k,u_globe_pos:L,u_globe_radius:B,u_viewport:O,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:j,u_far_z_cutoff:X});function Fu(l,t){return l!=null&&t!=null&&!(!l.hasData()||!t.hasData())&&l.demTexture!=null&&t.demTexture!=null&&l.tileID.key!==t.tileID.key}const Fo=new class{constructor(){this.operations={}}newMorphing(l,t,s,c,m){if(l in this.operations){const _=this.operations[l];_.to.tileID.key!==s.tileID.key&&(_.queued=s)}else this.operations[l]={startTime:c,phase:0,duration:m,from:t,to:s,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const t=this.operations[l];return{from:t.from,to:t.to,phase:t.phase}}update(l){for(const t in this.operations){const s=this.operations[t];for(s.phase=(l-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,l)){delete this.operations[t];break}}}_nextOp(l,t){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=t,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},ka={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Pr(l,t,s){if(t===0)return 0;const c=t<1&&s===514?.25/t:1;return 6*Math.pow(1.5,22-l)*Math.max(t,1)*c}function Mr(l,t){const s=1<<l.z;return!t&&(l.x===0||l.x===s-1)||l.y===0||l.y===s-1}const vo=l=>({u_matrix:l});function Vr(l,t,s,c,m){if(m>0){const _=r.q.now(),v=(_-l.timeAdded)/m,S=t?(_-t.timeAdded)/m:-1,A=s.getSource(),k=c.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),L=!t||Math.abs(t.tileID.overscaledZ-k)>Math.abs(l.tileID.overscaledZ-k),B=L&&l.refreshedUponExpiration?1:r.ay(L?v:1-S,0,1);return l.refreshedUponExpiration&&v>=1&&(l.refreshedUponExpiration=!1),t?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class ro extends bs{constructor(t){const s={type:"raster-dem",maxzoom:t.transform.maxZoom},c=new r.D(r.c$(),null),m=Ll("mock-dem",s,c,t.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,s){t.state="loaded",s(null)}}class fs extends bs{constructor(t){const s=Ll("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new r.D(r.c$(),null),t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,c){if(t.freezeTileCoverage)return;this.transform=t;const m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,v)=>{if(_[v.key]="",!this._tiles[v.key]){const S=new Ol(v,this._source.tileSize*v.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);S.state="loaded",this._tiles[v.key]=S}return _},{});for(const _ in this._tiles)_ in m||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const c=Object.values(s);this.renderCachePool.push(...c),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ul extends r.aM{constructor(t,s,c){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=c}}class Ss extends r.dt{constructor(t,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[c,m,_]=function(A){const k=new r.ba,L=new r.a_,B=131;k.reserve(17161),L.reserve(33800);const O=r.aj/128,j=r.aj+O/2,X=j+O;for(let Y=-64;Y<X;Y+=O)for(let J=-64;J<X;J+=O){const ie=J<0||J>j||Y<0||Y>j?24575:0,ue=r.ay(Math.round(J),0,r.aj),pe=r.ay(Math.round(Y),0,r.aj);k.emplaceBack(ue+ie,pe)}const W=(Y,J)=>{const ie=J*B+Y;L.emplaceBack(ie+1,ie,ie+B),L.emplaceBack(ie+B,ie+B+1,ie+1)};for(let Y=1;Y<129;Y++)for(let J=1;J<129;J++)W(J,Y);return[0,129].forEach(Y=>{for(let J=0;J<130;J++)W(J,Y),W(Y,J)}),[k,L,32768]}(),v=t.context;this.gridBuffer=v.createVertexBuffer(c,r.bc.members),this.gridIndexBuffer=v.createIndexBuffer(m),this.gridSegments=r.bd.simpleSegment(0,0,c.length,m.length),this.gridNoSkirtSegments=r.bd.simpleSegment(0,0,c.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new fs(s.map),this.orthoMatrix=r.bz(),r.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.aj,0,r.aj,0,1);const S=v.gl;this._overlapStencilMode=new vi({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ro(s.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,s,c){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const m=t.terrain.properties,_=t.terrain.drapeRenderMode===0,v=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.q.now();const S=t.terrain&&t.terrain.scope,A=m.get("source"),k=_?this._mockSourceCache:t.getSourceCache(A,S);if(!k)return void r.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=k,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=v?this.calculateExaggeration(s):m.get("exaggeration"),!s.projection.requiresDraping&&v&&this._exaggeration===0)return void this._disable();this.enabled=!0;const L=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const B=this.getScaledDemTileSize();this.sourceCache.update(s,B,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),s.updateElevation(!0,c),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const s=this._previousCameraAltitude,c=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=c;const m=s!=null?c-s:Number.MAX_VALUE;if(Math.abs(m)<2)return this._exaggeration;const _=t.zoom,v=this._style.terrain;if(!this._previousUpdateTimestamp)return v.getExaggeration(_);let S=_-this._previousZoom;const A=this._previousUpdateTimestamp;let k=_;this._evaluationZoom!=null&&(k=this._evaluationZoom,Math.abs(_-k)>.5&&(S=.5*(_-k+S)),S*m<0&&(k+=S)),this._evaluationZoom=k;const L=v.getExaggeration(k),B=L===v.getExaggeration(Math.max(0,k-.1));if(B&&Math.abs(L-this._exaggeration)<.01)return L;let O=Math.min(.1,.00375*(this._updateTimestamp-A));return(B||L<.1||Math.abs(S)<1e-4)&&(O=Math.min(.2,4*O)),r.ai(this._exaggeration,L,O)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,c=this.painter.transform;this._initializing&&(this._initializing=c._centerAltitude===0&&this.getAtPointOrZero(r.ac.fromLngLat(c.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=s.getIds().map(A=>{const k=s.getTileByID(A).tileID;return k.projMatrix=c.calculateProjMatrix(k.toUnwrapped()),k});(function(A,k){const L=k.transform.pointCoordinate(k.transform.getCameraPoint()),B=new r.P(L.x,L.y);A.sort((O,j)=>{if(j.overscaledZ-O.overscaledZ)return j.overscaledZ-O.overscaledZ;const X=new r.P(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),W=new r.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),Y=B.mult(1<<O.canonical.z);return Y.x-=.5,Y.y-=.5,Y.distSqr(X)-Y.distSqr(W)})})(m,this.painter);const _=this.proxyToSource||{};this.proxyToSource={},m.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const v=this._style._mergedSourceCaches;for(const A in v){const k=v[A];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,t[A],_),k.usedForTerrain))continue;const L=t[A];k.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[s.id]=m.map(A=>new ul(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1;const S={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const k=this.terrainTileForTile[A.key];if(!k)continue;const L=k.tileID.key;L in S||(this._visibleDemTiles.push(k),S[L]=L)}}_assignTerrainTiles(t){this._initializing||t.forEach(s=>{if(this.terrainTileForTile[s.key])return;const c=this._findTileCoveringTileID(s,this.sourceCache);c&&(this.terrainTileForTile[s.key]=c)})}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const c in this.terrainTileForTile){const m=this.terrainTileForTile[c],_=m.dem;!_||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),Xl(this.painter,m,_))}}_prepareDemTileUniforms(t,s,c,m){if(!s||s.demTexture==null)return!1;const _=t.tileID.canonical,v=Math.pow(2,s.tileID.canonical.z-_.z),S=m||"";return c[`u_dem_tl${S}`]=[_.x*v%1,_.y*v%1],c[`u_dem_scale${S}`]=v,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const s=this._visibleDemTiles.reduce((c,m)=>{if(!m.dem)return c;const _=m.dem.tree.minimums[0];return _>0&&t++,c+_},0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const c=this._getLoadedAreaMinimum(),m=new r.du({width:1,height:1},new Float32Array([c]));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(m,{premultiply:!1}):_=this._emptyDEMTexture=new r.T(t,m,s.R32F,{premultiply:!1}),_}setupElevationDraw(t,s,c){const m=this.painter.context,_=m.gl,v={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};v.u_exaggeration=this.exaggeration();let S=null,A=null,k=1;if(c&&c.morphing&&this._useVertexMorphing){const j=c.morphing.srcDemTile,X=c.morphing.dstDemTile;k=c.morphing.phase,j&&X&&(this._prepareDemTileUniforms(t,j,v,"_prev")&&(A=j),this._prepareDemTileUniforms(t,X,v)&&(S=X))}const L=j=>j&&j.demTexture&&this.painter.linearFloatFilteringSupported()?_.LINEAR:_.NEAREST;let B=null;var O;if(this.enabled?A&&S?(B=S.demTexture,m.activeTexture.set(_.TEXTURE4),A.demTexture.bind(L(A),_.CLAMP_TO_EDGE),v.u_dem_lerp=k):(S=this.terrainTileForTile[t.tileID.key],B=this._prepareDemTileUniforms(t,S,v)?S.demTexture:this.emptyDEMTexture):B=this.emptyDEMTexture,m.activeTexture.set(_.TEXTURE2),B&&(v.u_dem_size=(O=B).size[0]===1?1:O.size[0]-2,B.bind(L(S),_.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(c&&c.useDepthForOcclusion,s,v),c&&c.useMeterToDem&&S){const j=(1<<S.tileID.canonical.z)*r.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;v.u_meter_to_dem=j}if(c&&c.labelPlaneMatrixInv&&(v.u_label_plane_matrix_inv=c.labelPlaneMatrixInv),s.setTerrainUniformValues(m,v),this.painter.transform.projection.name==="globe"){const j=this.globeUniformValues(this.painter.transform,t.tileID.canonical,c&&c.useDenormalizedUpVectorScale);s.setGlobeUniformValues(m,j)}}globeUniformValues(t,s,c){const m=t.projection;return{u_tile_tl_up:m.upVector(s,0,0),u_tile_tr_up:m.upVector(s,r.aj,0),u_tile_br_up:m.upVector(s,r.aj,r.aj),u_tile_bl_up:m.upVector(s,0,r.aj),u_tile_up_scale:c?r.dv(1):m.upVectorScale(s,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const s=this.painter,c=this.painter.context;t.length!==0&&(c.bindFramebuffer.set(null),c.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,_,v,S,A){if(m.transform.projection.name==="globe")(function(k,L,B,O,j){const X=k.context,W=X.gl;let Y,J;const ie=k.transform,ue=r.dl(k,X,ie),pe=(nt,it)=>{if(J===it)return;const ht=[ka[it],"PROJECTION_GLOBE_VIEW"];ue&&ht.push("CUSTOM_ANTIALIASING");const Be=k.isTileAffectedByFog(nt);Y=k.getOrCreateProgram("globeRaster",{defines:ht,overrideFog:Be}),J=it},be=k.colorModeForRenderPass(),Te=new Xt(W.LEQUAL,Xt.ReadWrite,k.depthRangeFor3D);Fo.update(j);const xe=r.dm(ie),me=[r.aD(ie.center.lng),r.aH(ie.center.lat)],Ee=k.globeSharedBuffers,Ae=[ie.width*r.q.devicePixelRatio,ie.height*r.q.devicePixelRatio],Oe=Float32Array.from(ie.globeMatrix),Ge={useDenormalizedUpVectorScale:!0};{const nt=k.transform,it=Pr(nt.zoom,L.exaggeration(),L.sourceCache._source.tileSize);J=-1;const ht=W.TRIANGLES;for(const Be of O){const Xe=B.getTile(Be),ke=vi.disabled,st=L.prevTerrainTileForTile[Be.key],We=L.terrainTileForTile[Be.key];Fu(st,We)&&Fo.newMorphing(Be.key,st,We,j,250),X.activeTexture.set(W.TEXTURE0),Xe.texture&&Xe.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const ut=Fo.getMorphValuesForProxy(Be.key),Et=ut?1:0;ut&&r.L(Ge,{morphing:{srcDemTile:ut.from,dstDemTile:ut.to,phase:r.dk(ut.phase)}});const ot=r.dn(Be.canonical),yt=r.dp(ot.getCenter().lat),jt=r.dq(Be.canonical,ot,yt,nt.worldSize/nt._pixelsPerMercatorPixel),Wt=r.bh(r.dr(Be.canonical)),Ot=Bc(nt.expandedFarZProjMatrix,Oe,xe,Wt,r.ah(nt.zoom),me,nt.frustumCorners.TL,nt.frustumCorners.TR,nt.frustumCorners.BR,nt.frustumCorners.BL,nt.globeCenterInViewSpace,nt.globeRadius,Ae,it,nt._farZ,jt);if(pe(Be,Et),Y&&(L.setupElevationDraw(Xe,Y,Ge),k.uploadCommonUniforms(X,Y,Be.toUnwrapped()),Ee)){const[Zt,ai,ui]=Ee.getGridBuffers(yt,it!==0);Y.draw(k,ht,Te,ke,be,mi.backCCW,Ot,"globe_raster",Zt,ai,ui)}}}if(Ee&&(k.renderDefaultNorthPole||k.renderDefaultSouthPole)){const nt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ue&&nt.push("CUSTOM_ANTIALIASING"),Y=k.getOrCreateProgram("globeRaster",{defines:nt});for(const it of O){const{x:ht,y:Be,z:Xe}=it.canonical,ke=Be===0,st=Be===(1<<Xe)-1,[We,ut,Et,ot]=Ee.getPoleBuffers(Xe,!1);if(ot&&(ke||st)){const yt=B.getTile(it);X.activeTexture.set(W.TEXTURE0),yt.texture&&yt.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let jt=r.ds(Xe,ht,ie);const Wt=r.bh(r.dr(it.canonical)),Ot=(Zt,ai)=>Zt.draw(k,W.TRIANGLES,Te,vi.disabled,be,mi.disabled,Bc(ie.expandedFarZProjMatrix,jt,jt,Wt,0,me,ie.frustumCorners.TL,ie.frustumCorners.TR,ie.frustumCorners.BR,ie.frustumCorners.BL,ie.globeCenterInViewSpace,ie.globeRadius,Ae,0,ie._farZ),"globe_pole_raster",ai,Et,ot);L.setupElevationDraw(yt,Y,Ge),k.uploadCommonUniforms(X,Y,it.toUnwrapped()),ke&&k.renderDefaultNorthPole&&Ot(Y,We),st&&k.renderDefaultSouthPole&&(jt=r.cE(r.bz(),jt,[1,-1,1]),Ot(Y,ut))}}}})(m,_,v,S,A);else{const k=m.context,L=k.gl;let B,O;const j=m.shadowRenderer,X=xo(m,m.longestCutoffRange),W=be=>{if(O===be)return;const Te=[];Te.push(ka[be]),X.shouldRenderCutoff&&Te.push("RENDER_CUTOFF"),j&&(Te.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&Te.push("NORMAL_OFFSET")),B=m.getOrCreateProgram("terrainRaster",{defines:Te}),O=be},Y=m.colorModeForRenderPass(),J=new Xt(L.LEQUAL,Xt.ReadWrite,m.depthRangeFor3D);Fo.update(A);const ie=m.transform,ue=Pr(ie.zoom,_.exaggeration(),_.sourceCache._source.tileSize);let pe=[0,0,0];if(j){const be=m.style.directionalLight,Te=m.style.ambientLight;be&&Te&&(pe=al(m.style,be,Te))}{O=-1;const be=L.TRIANGLES,[Te,xe]=[_.gridIndexBuffer,_.gridSegments];for(const me of S){const Ee=v.getTile(me),Ae=vi.disabled,Oe=_.prevTerrainTileForTile[me.key],Ge=_.terrainTileForTile[me.key];Fu(Oe,Ge)&&Fo.newMorphing(me.key,Oe,Ge,A,250),k.activeTexture.set(L.TEXTURE0),Ee.texture&&Ee.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const nt=Fo.getMorphValuesForProxy(me.key),it=nt?1:0;let ht;nt&&(ht={morphing:{srcDemTile:nt.from,dstDemTile:nt.to,phase:r.dk(nt.phase)}});const Be=Kl(me.projMatrix,Mr(me.canonical,ie.renderWorldCopies)?ue/10:ue,pe);if(W(it),!B)continue;_.setupElevationDraw(Ee,B,ht);const Xe=me.toUnwrapped();j&&j.setupShadows(Xe,B),m.uploadCommonUniforms(k,B,Xe,null,X),B.draw(m,be,J,Ae,Y,mi.backCCW,Be,"terrain_raster",_.gridBuffer,Te,xe)}}}}(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,c=this.painter.context,m=this.proxySourceCache,_=this.proxiedCoords[m.id],v=this._drapedRenderBatches.shift(),S=s.style.order,A=[];let k=0;for(const L of _){const B=m.getTileByID(L.proxyTileKey),O=m.proxyCachedFBO[L.key]?m.proxyCachedFBO[L.key][t]:void 0,j=O!==void 0?m.renderCache[O]:this.pool[k++],X=O!==void 0;if(B.texture=j.tex,X&&!j.dirty){A.push(B.tileID);continue}let W;c.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(c.clear({color:r.am.transparent,stencil:0}),j.dirty=!1);for(let Y=v.start;Y<=v.end;++Y){const J=s.style._mergedLayers[S[Y]];if(J.isHidden(s.transform.zoom))continue;const ie=s.style.getLayerSourceCache(J),ue=ie?this.proxyToSource[L.key][ie.id]:[L];if(!ue)continue;const pe=ue;c.viewport.set([0,0,j.fb.width,j.fb.height]),W!==(ie?ie.id:null)&&(this._setupStencil(j,ue,J,ie),W=ie?ie.id:null),s.renderLayer(s,ie,J,pe)}if(this._drapedRenderBatches.length===0)for(const Y of this._pendingGroundEffectLayers){const J=s.style._mergedLayers[S[Y]];if(J.isHidden(s.transform.zoom))continue;const ie=s.style.getLayerSourceCache(J),ue=ie?this.proxyToSource[L.key][ie.id]:[L];if(!ue)continue;const pe=ue;c.viewport.set([0,0,j.fb.width,j.fb.height]),W!==(ie?ie.id:null)&&(this._setupStencil(j,ue,J,ie),W=ie?ie.id:null),s.renderLayer(s,ie,J,pe)}this.renderedToTile?(j.dirty=!0,A.push(B.tileID)):X||--k,k===5&&(k=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,c.bindFramebuffer.set(null),c.viewport.set([0,0,s.width,s.height]),v.end+1}postRender(){}isLayerOrderingCorrect(t){const s=t.order.length;let c=-1,m=s;for(let _=0;_<s;++_)this._style.isLayerDraped(t._mergedLayers[t.order[_]])?c=Math.max(c,_):m=Math.min(m,_);return m>c}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{t=Math.min(t,s.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,s,c){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const v=_.tileID,S=1<<v.overscaledZ,{x:A,y:k}=v.canonical,L=A/S,B=(A+1)/S,O=k/S,j=(k+1)/S;return{minx:L,miny:O,maxx:B,maxy:j,t:_.dem.tree.raycastRoot(L,O,B,j,t,s,c),tile:_}});m.sort((_,v)=>(_.t!==null?_.t:Number.MAX_VALUE)-(v.t!==null?v.t:Number.MAX_VALUE));for(const _ of m){if(_.t==null)return null;const v=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,t,s,c);if(v!=null)return v}return null}_createFBO(){const t=this.painter.context,s=t.gl,c=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const m=new r.T(t,{width:c[0],height:c[1],data:null},s.RGBA8);m.bind(s.LINEAR,s.CLAMP_TO_EDGE);const _=t.createFramebuffer(c[0],c[1],!0,null);return _.colorAttachment.set(m.texture),_.depthAttachment=new kh(t,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,c[0],c[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:_,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const s=this._style._mergedLayers[t],c=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!c&&s.shouldRedrape():!c&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const c of this._style.getSources())if(c instanceof to){t=!0;break}if(!t)return;const s={};for(let c=0;c<this._style.order.length;++c){const m=this._style._mergedLayers[this._style.order[c]],_=this._style.getLayerSourceCache(m);if(_&&!s[_.id]&&!m.isHidden(this.painter.transform.zoom)&&m.type==="line"&&m.widthExpression()instanceof r.ab){s[_.id]=!0;for(const v of this.proxyCoords){const S=this.proxyToSource[v.key][_.id];if(S)for(const A of S)this._clearRenderCacheForTile(_.id,A)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c]._source instanceof us){t=!0;break}if(!t)return;const s={};for(let c=0;c<this._style.order.length;++c){const m=this._style._mergedLayers[this._style.order[c]],_=this._style.getLayerSourceCache(m);if(!_||s[_.id]||m.isHidden(this.painter.transform.zoom)||m.type!=="raster")continue;const v=m.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const A=this.proxyToSource[S.key][_.id];if(A)for(const k of A){const L=Vr(_.getTile(k),_.findLoadedParent(k,0),_,this.painter.transform,v);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(_.id,k)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,s=t.length;if(s===0)return;const c=[];this._pendingGroundEffectLayers=[];let m,_=0,v=this._style._mergedLayers[t[_]];for(;!this._style.isLayerDraped(v)&&v.isHidden(this.painter.transform.zoom)&&++_<s;)v=this._style._mergedLayers[t[_]];for(;_<s;++_){const S=this._style._mergedLayers[t[_]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?m===void 0&&(m=_):(S.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(_),m!==void 0&&(c.push({start:m,end:_-1}),m=void 0)))}if(m!==void 0&&c.push({start:m,end:_-1}),c.length!==0){const S=c[c.length-1];this._pendingGroundEffectLayers.every(A=>A>S.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=c}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const v=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let S=0;S<v.length;++S){const A=Object.values(v[S]);s.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();const c=this.proxyCoords,m=this._tilesDirty;for(let v=c.length-1;v>=0;v--){const S=c[v];if(s.getTileByID(S.key),s.proxyCachedFBO[S.key]!==void 0){const A=t[S.key],k=this.proxyToSource[S.key];let L=0;for(const B in k){const O=k[B],j=A[B];if(!j||j.length!==O.length||O.some((X,W)=>X!==j[W]||m[B]&&m[B].hasOwnProperty(X.key))){L=-1;break}++L}for(const B in s.proxyCachedFBO[S.key])s.renderCache[s.proxyCachedFBO[S.key][B]].dirty=L<0||L!==Object.values(A).length}}const _=[...this._drapedRenderBatches];_.sort((v,S)=>S.end-S.start-(v.end-v.start));for(const v of _)for(const S of c){if(s.proxyCachedFBO[S.key])continue;let A=s.renderCachePool.pop();A===void 0&&s.renderCache.length<50&&(A=s.renderCache.length,s.renderCache.push(this._createFBO())),A!==void 0&&(s.proxyCachedFBO[S.key]={},s.proxyCachedFBO[S.key][v.start]=A,s.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,c,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,v=_.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let S;if(c.isTileClipped())S=s.length,this._overlapStencilMode.test={func:v.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:v.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,c.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):vi.disabled}_renderTileClippingMasks(t,s){const c=this.painter,m=this.painter.context,_=m.gl;c._tileClippingMaskIDs={},m.setColorMode(Wi.disabled),m.setDepthMode(Xt.disabled);const v=c.getOrCreateProgram("clippingMask");for(const S of t){const A=c._tileClippingMaskIDs[S.key]=--s;v.draw(c,_.TRIANGLES,Xt.disabled,new vi({func:_.ALWAYS,mask:0},A,255,_.KEEP,_.KEEP,_.REPLACE),Wi.disabled,mi.disabled,vo(S.projMatrix),"$clipping",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const c=[t.x,t.y,1,1];r.aA(c,c,s.pixelMatrixInverse),r.cw(c,c,1/c[3]),c[0]/=s.worldSize,c[1]/=s.worldSize;const m=s._camera.position,_=r.c6(1,s.center.lat),v=[m[0],m[1],m[2]/_,0],S=r.cX([],c.slice(0,3),v);r.au(S,S);const A=this.raycast(v,S,this._exaggeration);return A!==null&&A?(r.bE(v,v,S,A),v[3]=v[2],v[2]*=_,v):null}_setupProxiedCoordsForOrtho(t,s,c){if(t.getSource()instanceof r.aP)return this._setupProxiedCoordsForImageSource(t,s,c);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const m=this.proxiedCoords[t.id]=[],_=this.proxyCoords;for(let A=0;A<_.length;A++){const k=_[A],L=this._findTileCoveringTileID(k,t);if(L){const B=this._createProxiedId(k,L,c[k.key]&&c[k.key][t.id]);m.push(B),this.proxyToSource[k.key][t.id]=[B]}}let v=!1;const S=new Set;for(let A=0;A<s.length;A++){const k=t.getTile(s[A]);if(!k||!k.hasData())continue;const L=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==k.tileID.canonical.z){const B=this.proxyToSource[L.tileID.key][t.id],O=this._createProxiedId(L.tileID,k,c[L.tileID.key]&&c[L.tileID.key][t.id]);B?B.splice(B.length-1,0,O):this.proxyToSource[L.tileID.key][t.id]=[O];const j=this.proxyToSource[L.tileID.key][t.id];S.has(j)||S.add(j),m.push(O),v=!0}}if(this._sourceTilesOverlap[t.id]=v,v&&this._debugParams.sortTilesHiZFirst)for(const A of S)A.sort((k,L)=>L.overscaledZ-k.overscaledZ)}_setupProxiedCoordsForImageSource(t,s,c){if(!t.getSource().loaded())return;const m=this.proxiedCoords[t.id]=[],_=this.proxyCoords,v=t.getSource(),S=v.tileID;if(!S)return;const A=new r.P(S.x,S.y)._div(1<<S.z),k=v.coordinates.map(r.ac.fromLngLat).reduce((B,O)=>(B.min.x=Math.min(B.min.x,O.x-A.x),B.min.y=Math.min(B.min.y,O.y-A.y),B.max.x=Math.max(B.max.x,O.x-A.x),B.max.y=Math.max(B.max.y,O.y-A.y),B),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(B,O)=>{const j=B.wrap+B.canonical.x/(1<<B.canonical.z),X=B.canonical.y/(1<<B.canonical.z),W=r.aj/(1<<B.canonical.z),Y=O.wrap+O.canonical.x/(1<<O.canonical.z),J=O.canonical.y/(1<<O.canonical.z);return j+W<Y+k.min.x||j>Y+k.max.x||X+W<J+k.min.y||X>J+k.max.y};for(let B=0;B<_.length;B++){const O=_[B];for(let j=0;j<s.length;j++){const X=t.getTile(s[j]);if(!X||!X.hasData()||L(O,X.tileID))continue;const W=this._createProxiedId(O,X,c[O.key]&&c[O.key][t.id]),Y=this.proxyToSource[O.key][t.id];Y?Y.push(W):this.proxyToSource[O.key][t.id]=[W],m.push(W)}}}_createProxiedId(t,s,c){let m=this.orthoMatrix;if(c){const _=c.find(v=>v.key===s.tileID.key);if(_)return _}if(s.tileID.key!==t.key){const _=t.canonical.z-s.tileID.canonical.z;let v,S,A;m=r.bz();const k=s.tileID.wrap-t.wrap<<t.overscaledZ;_>0?(v=r.aj>>_,S=v*((s.tileID.canonical.x<<_)-t.canonical.x+k),A=v*((s.tileID.canonical.y<<_)-t.canonical.y)):(v=r.aj<<-_,S=r.aj*(s.tileID.canonical.x-(t.canonical.x+k<<-_)),A=r.aj*(s.tileID.canonical.y-(t.canonical.y<<-_))),r.c5(m,0,v,0,v,0,1),r.bo(m,m,[S,A,0])}return new ul(s.tileID,t.key,m)}_findTileCoveringTileID(t,s){let c=s.getTile(t);if(c&&c.hasData())return c;const m=this._findCoveringTileCache[s.id],_=m[t.key];if(c=_?s.getTileByID(_):null,c&&c.hasData()||_===null)return c;let v=c?c.tileID:t,S=v.overscaledZ;const A=s.getSource().minzoom,k=[];if(!_){const B=s.getSource().maxzoom;if(t.canonical.z>=B){const O=t.canonical.z-B;s.getSource().reparseOverscaled?(S=Math.max(t.canonical.z+2,s.transform.tileZoom),v=new r.aM(S,t.wrap,B,t.canonical.x>>O,t.canonical.y>>O)):O!==0&&(S=B,v=new r.aM(S,t.wrap,B,t.canonical.x>>O,t.canonical.y>>O))}v.key!==t.key&&(k.push(v.key),c=s.getTile(v))}const L=B=>{k.forEach(O=>{m[O]=B}),k.length=0};for(S-=1;S>=A&&(!c||!c.hasData());S--){c&&L(c.tileID.key);const B=v.calculateScaledKey(S);if(c=s.getTileByID(B),c&&c.hasData())break;const O=m[B];if(O===null)break;O===void 0?k.push(B):c=s.getTileByID(O)}return L(c?c.tileID.key:null),c&&c.hasData()?c:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let c=this._tilesDirty[t];c||(c=this._tilesDirty[t]={}),c[s.key]=!0}}function jc(l,t,s){const c=function(S,A,k){const L=r.bG(A,S),B=r.bG(k,[.2126,.7152,.0722]),O=(X,W,Y)=>(1-Y)*X+Y*W,j=O(1-.3*Math.min(B,1),1,Math.min(L+1,1));return O(.92,1,Math.asin(r.ay(A[2],-1,1))/Math.PI+.5)*j}(l,[0,0,1],t),m=[0,0,0];r.bY(m,s.slice(0,3),c);const _=[0,0,0];r.bY(_,t.slice(0,3),l[2]);const v=[0,0,0];return r.cV(v,m,_),r.cY(v)}const Dd=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ld=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Vc{static cacheKey(t,s,c,m){let _=`${s}${m?m.cacheKey:""}`;for(const v of c)t.usedDefines.includes(v)&&(_+=`/${v}`);return _}constructor(t,s,c,m,_,v){const S=t.gl;this.program=S.createProgram(),this.configuration=m,this.name=s,this.fixedDefines=[...v];const A=m?m.getBinderAttributes():[],k=(c.staticAttributes||[]).concat(A);let L=m?m.defines():[];L=L.concat(v.map(Y=>`#define ${Y}`));const B=`#version 300 es
`;let O=B+L.concat("precision mediump float;",oa,Pu.fragmentSource).join(`
`);for(const Y of c.fragmentIncludes)O+=`
${Fc[Y]}`;O+=`
${c.fragmentSource}`;let j=B+L.concat("precision highp float;",oa,Pu.vertexSource).join(`
`);for(const Y of c.vertexIncludes)j+=`
${Fc[Y]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&c.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(j+=`
uniform int u_instanceID;
`),j+=`
${c.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(j=j.replaceAll("gl_InstanceID","u_instanceID"));const X=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(X,O),S.compileShader(X),S.attachShader(this.program,X);const W=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(W,j),S.compileShader(W),S.attachShader(this.program,W),this.attributes={},this.numAttributes=k.length;for(let Y=0;Y<this.numAttributes;Y++)if(k[Y]){const J=k[Y].startsWith("a_")?k[Y]:`a_${k[Y]}`;S.bindAttribLocation(this.program,Y,J),this.attributes[J]=Y}S.linkProgram(this.program),S.deleteShader(W),S.deleteShader(X),this.fixedUniforms=_(t),this.binderUniforms=m?m.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Y=>({u_instanceID:new r.c8(Y)}))(t)),(v.includes("TERRAIN")||s.indexOf("symbol")!==-1||s.indexOf("circle")!==-1)&&(this.terrainUniforms=(Y=>({u_dem:new r.c8(Y),u_dem_prev:new r.c8(Y),u_dem_tl:new r.cb(Y),u_dem_scale:new r.ca(Y),u_dem_tl_prev:new r.cb(Y),u_dem_scale_prev:new r.ca(Y),u_dem_size:new r.ca(Y),u_dem_lerp:new r.ca(Y),u_exaggeration:new r.ca(Y),u_depth:new r.c8(Y),u_depth_size_inv:new r.cb(Y),u_depth_range_unpack:new r.cb(Y),u_occluder_half_size:new r.ca(Y),u_occlusion_depth_offset:new r.ca(Y),u_meter_to_dem:new r.ca(Y),u_label_plane_matrix_inv:new r.cc(Y)}))(t)),v.includes("GLOBE")&&(this.globeUniforms=(Y=>({u_tile_tl_up:new r.c9(Y),u_tile_tr_up:new r.c9(Y),u_tile_br_up:new r.c9(Y),u_tile_bl_up:new r.c9(Y),u_tile_up_scale:new r.ca(Y)}))(t)),v.includes("FOG")&&(this.fogUniforms=(Y=>({u_fog_matrix:new r.cc(Y),u_fog_range:new r.cb(Y),u_fog_color:new r.cQ(Y),u_fog_horizon_blend:new r.ca(Y),u_fog_vertical_limit:new r.cb(Y),u_fog_temporal_offset:new r.ca(Y),u_frustum_tl:new r.c9(Y),u_frustum_tr:new r.c9(Y),u_frustum_br:new r.c9(Y),u_frustum_bl:new r.c9(Y),u_globe_pos:new r.c9(Y),u_globe_radius:new r.ca(Y),u_globe_transition:new r.ca(Y),u_is_globe:new r.c8(Y),u_viewport:new r.cb(Y)}))(t)),v.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Y=>({u_cutoff_params:new r.cQ(Y)}))(t)),v.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Y=>({u_lighting_ambient_color:new r.c9(Y),u_lighting_directional_dir:new r.c9(Y),u_lighting_directional_color:new r.c9(Y),u_ground_radiance:new r.c9(Y)}))(t)),v.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Y=>({u_light_matrix_0:new r.cc(Y),u_light_matrix_1:new r.cc(Y),u_fade_range:new r.cb(Y),u_shadow_normal_offset:new r.c9(Y),u_shadow_intensity:new r.ca(Y),u_shadow_texel_size:new r.ca(Y),u_shadow_map_resolution:new r.ca(Y),u_shadow_direction:new r.c9(Y),u_shadow_bias:new r.c9(Y),u_shadowmap_0:new r.c8(Y),u_shadowmap_1:new r.c8(Y)}))(t))}}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const c=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)c[m]&&c[m].set(this.program,m,s[m])}}setGlobeUniformValues(t,s){if(!this.globeUniforms)return;const c=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)c[m]&&c[m].set(this.program,m,s[m])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const c=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)c[m].set(this.program,m,s[m])}}setCutoffUniformValues(t,s){if(!this.cutoffUniforms)return;const c=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)c[m].set(this.program,m,s[m])}}setLightsUniformValues(t,s){if(!this.lightsUniforms)return;const c=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)c[m].set(this.program,m,s[m])}}setShadowUniformValues(t,s){if(this.failedToCreate||!this.shadowUniforms)return;const c=this.shadowUniforms;t.program.set(this.program);for(const m in s)c[m].set(this.program,m,s[m])}_drawDebugWireframe(t,s,c,m,_,v,S,A,k,L){const B=t.options.wireframe;if(B.terrain===!1&&B.layers2D===!1&&B.layers3D===!1)return;const O=t.context;if(!(!(!B.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!B.layers2D||t._terrain&&t._terrain.renderingToTexture||!Dd.includes(this.name))||!(!B.layers3D||!Ld.includes(this.name))))return;const j=O.gl,X=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,_,O);if(!X)return;const W=[...this.fixedDefines];W.push("DEBUG_WIREFRAME");const Y=t.getOrCreateProgram(this.name,{config:this.configuration,defines:W});O.program.set(Y.program);const J=(pe,be,Te)=>{if(be[pe]&&Te[pe])for(const xe in be[pe])Te[pe][xe]&&Te[pe][xe].set(Te.program,xe,be[pe][xe].current)};k&&k.setUniforms(Y.program,O,Y.binderUniforms,S,{zoom:A}),J("fixedUniforms",this,Y),J("terrainUniforms",this,Y),J("globeUniforms",this,Y),J("fogUniforms",this,Y),J("lightsUniforms",this,Y),J("shadowUniforms",this,Y),X.bind(),O.setColorMode(new Wi([j.ONE,j.ONE_MINUS_SRC_ALPHA,j.ZERO,j.ONE],r.am.transparent,[!0,!0,!0,!1])),O.setDepthMode(new Xt(s.func===j.LESS?j.LEQUAL:s.func,Xt.ReadOnly,s.range)),O.setStencilMode(vi.disabled);const ie=3*v.primitiveLength*2,ue=3*v.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const pe=L||1;for(let be=0;be<pe;++be)Y.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",be),j.drawElements(j.LINES,ie,j.UNSIGNED_SHORT,ue)}else L&&L>1?j.drawElementsInstanced(j.LINES,ie,j.UNSIGNED_SHORT,ue,L):j.drawElements(j.LINES,ie,j.UNSIGNED_SHORT,ue);_.bind(),O.program.set(this.program),O.setDepthMode(s),O.setStencilMode(c),O.setColorMode(m)}checkUniforms(t,s,c){if(this.fixedDefines.includes(s)){for(const m of Object.keys(c))if(!c[m].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${m} not set but required by ${s} being defined`)}}draw(t,s,c,m,_,v,S,A,k,L,B,O,j,X,W,Y){const J=t.context,ie=J.gl;if(this.failedToCreate)return;J.program.set(this.program),J.setDepthMode(c),J.setStencilMode(m),J.setColorMode(_),J.setCullFace(v);for(const be of Object.keys(this.fixedUniforms))this.fixedUniforms[be].set(this.program,be,S[be]);X&&X.setUniforms(this.program,J,this.binderUniforms,O,{zoom:j});const ue={[ie.POINTS]:1,[ie.LINES]:2,[ie.TRIANGLES]:3,[ie.LINE_STRIP]:1}[s];this.checkUniforms(A,"RENDER_SHADOWS",this.shadowUniforms);const pe=Y&&Y>0?1:void 0;for(const be of B.get()){const Te=be.vaos||(be.vaos={});if((Te[A]||(Te[A]=new Zl)).bind(J,this,k,X?X.getPaintVertexBuffers():[],L,be.vertexOffset,W||[],pe),this.forceManualRenderingForInstanceIDShaders){const xe=Y||1;for(let me=0;me<xe;++me)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",me),L?ie.drawElements(s,be.primitiveLength*ue,ie.UNSIGNED_SHORT,be.primitiveOffset*ue*2):ie.drawArrays(s,be.vertexOffset,be.vertexLength)}else Y&&Y>1?ie.drawElementsInstanced(s,be.primitiveLength*ue,ie.UNSIGNED_SHORT,be.primitiveOffset*ue*2,Y):L?ie.drawElements(s,be.primitiveLength*ue,ie.UNSIGNED_SHORT,be.primitiveOffset*ue*2):ie.drawArrays(s,be.vertexOffset,be.vertexLength);s===ie.TRIANGLES&&L&&this._drawDebugWireframe(t,c,m,_,L,be,O,j,X,Y)}}}function Ou(l,t,s=0){const c=Math.pow(2,t.tileID.overscaledZ),m=t.tileSize*Math.pow(2,l.transform.tileZoom)/c,_=m*(t.tileID.canonical.x+t.tileID.wrap*c),v=m*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.aw(t,1,l.transform.tileZoom),u_pixel_coord_upper:[_>>16,v>>16],u_pixel_coord_lower:[65535&_,65535&v],u_pattern_transition:s}}const wo={terrain:0,flat:1},Nu=r.bz(),Uc=(l,t,s,c,m,_,v,S,A,k,L,B,O,j,X,W,Y,J)=>{const ie=t.style.light,ue=ie.properties.get("position"),pe=[ue.x,ue.y,ue.z],be=r.dx();ie.properties.get("anchor")==="viewport"&&(r.dy(be,-t.transform.angle),r.dz(pe,pe,be));const Te=ie.properties.get("color").toPremultipliedRenderColor(null),xe=t.transform,me={u_matrix:l,u_lightpos:pe,u_lightintensity:ie.properties.get("intensity"),u_lightcolor:[Te.r,Te.g,Te.b],u_vertical_gradient:+s,u_opacity:c,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Nu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:wo[k],u_base_type:wo[L],u_ao:m,u_edge_radius:_,u_width_scale:v,u_flood_light_color:X,u_vertical_scale:W,u_flood_light_intensity:Y,u_ground_shadow_factor:J};return xe.projection.name==="globe"&&(me.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],me.u_zoom_transition=B,me.u_inv_rot_matrix=j,me.u_merc_center=O,me.u_up_dir=xe.projection.upVector(new r.cp(0,0,0),O[0]*r.aj,O[1]*r.aj),me.u_height_lift=A),me},Ff=(l,t,s,c,m,_)=>({u_matrix:l,u_edge_radius:t,u_width_scale:s,u_vertical_scale:c,u_height_type:wo[m],u_base_type:wo[_]}),Mp=(l,t,s,c,m,_,v,S,A,k,L,B,O,j,X,W,Y,J)=>{const ie=Uc(l,t,s,c,m,_,v,S,k,L,B,O,j,X,W,Y,1,[0,0,0]),ue={u_height_factor:-Math.pow(2,S.overscaledZ)/A.tileSize/8};return r.h(ie,Ou(t,A,J),ue)},bo=(l,t,s)=>({u_matrix:l,u_emissive_strength:t,u_ground_shadow_factor:s}),Gc=(l,t,s,c,m,_=0)=>r.h(bo(l,t,m),Ou(s,c,_)),Bu=(l,t,s,c)=>({u_matrix:l,u_world:s,u_emissive_strength:t,u_ground_shadow_factor:c}),zd=(l,t,s,c,m,_,v=0)=>r.h(Gc(l,t,s,c,_,v),{u_world:m}),Fd=(l,t)=>({u_matrix:l,u_ground_shadow_factor:t}),so=(l,t,s,c,m)=>({u_matrix:l,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:s,u_height_scale:c,u_reset_depth:m}),Ko=(l,t,s,c)=>{const m=r.aj/s.tileSize;return{u_matrix:l,u_camera_to_center_distance:t.getCameraToCenterDistance(c),u_extrude_scale:[t.pixelsToGLUnits[0]/m,t.pixelsToGLUnits[1]/m]}},Da=(l,t,s=1)=>({u_matrix:l,u_color:t,u_overlay:0,u_overlay_scale:s}),la=r.bz(),La=(l,t,s,c,m,_,v)=>{const S=l.transform,A=S.projection.name==="globe",k=A?r.dA(S.zoom,t.canonical)*S._pixelsPerMercatorPixel:r.aw(s,1,_),L={u_matrix:t.projMatrix,u_extrude_scale:k,u_intensity:v,u_inv_rot_matrix:la,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){L.u_inv_rot_matrix=c,L.u_merc_center=m,L.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],L.u_zoom_transition=r.ah(S.zoom);const B=m[0]*r.aj,O=m[1]*r.aj;L.u_up_dir=S.projection.upVector(new r.cp(0,0,0),B,O)}return L};function Oo(l,[t,s,c,m],[_,v]){if(_===v)return[0,0,0,0];const S=255*(l-1)/(l*(v-_));return[t*S,s*S,c*S,m*S]}function Od(l,t,[s,c]){return s===c?0:.5/l+(t-s)*(l-1)/(l*(c-s))}const Dh=(l,t,s,c,m,_,v,S,A,k,L,B,O,j,X,W,Y,J,ie,ue,pe)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:c,u_grid_matrix:m,u_tl_parent:_,u_scale_parent:k,u_fade_t:L.mix,u_opacity:L.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:r.dC(B.paint.get("raster-saturation")),u_contrast_factor:r.dB(B.paint.get("raster-contrast")),u_spin_weights:Nd(B.paint.get("raster-hue-rotate")),u_perspective_transform:O,u_raster_elevation:j,u_zoom_transition:v,u_merc_center:S,u_cutoff_params:A,u_colorization_mix:Oo(r.dD,W,J),u_colorization_offset:Od(r.dD,Y,J),u_color_ramp:X,u_texture_offset:[ue/(ie+2*ue),ie/(ie+2*ue)],u_texture_res:[ie+2*ue,ie+2*ue],u_emissive_strength:pe});function Nd(l){l*=Math.PI/180;const t=Math.sin(l),s=Math.cos(l);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const Qr=.05,ps=(l,t,s,c,m,_,v,S,A,k,L,B)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:c,u_grid_matrix:m,u_tl_parent:_,u_scale_parent:k,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:B,u_zoom_transition:v,u_merc_center:S,u_cutoff_params:A}),Dr=(l,t,s,c,m,_,v,S,A,k)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_tile_offset:s,u_velocity:c,u_color_ramp:_,u_velocity_res:m,u_max_speed:v,u_uv_offset:S,u_data_scale:[255*A[0],255*A[1]],u_data_offset:k,u_particle_pos_scale:1.1,u_particle_pos_offset:[Qr,Qr]}),Es=(l,t,s,c,m,_,v,S,A,k)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_velocity:s,u_velocity_res:c,u_max_speed:m,u_speed_factor:_,u_reset_rate:v,u_rand_seed:Math.random(),u_uv_offset:S,u_data_scale:[255*A[0],255*A[1]],u_data_offset:k,u_particle_pos_scale:1.1,u_particle_pos_offset:[Qr,Qr]}),Lh=r.bz(),ju=(l,t,s,c,m,_,v,S,A,k,L,B,O,j,X,W,Y,J,ie,ue,pe,be,Te,xe)=>{const me=m.transform,Ee={u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:me.getCameraToCenterDistance(ie),u_rotate_symbol:+s,u_aspect_ratio:me.width/me.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:v,u_coord_matrix:S,u_is_text:+k,u_elevation_from_sea:A?1:0,u_pitch_with_map:+c,u_texsize:L,u_texsize_icon:B,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Lh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Lh,u_up_vector:[0,-1,0],u_color_adj_mat:be,u_icon_transition:Te||0,u_gamma_scale:c?m.transform.getCameraToCenterDistance(ie)*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:r.q.devicePixelRatio,u_is_halo:1,u_scale_factor:xe||1,u_ground_shadow_factor:ue,u_inv_matrix:r.bi(r.bz(),v),u_normal_scale:pe};return ie.name==="globe"&&(Ee.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],Ee.u_zoom_transition=X,Ee.u_inv_rot_matrix=Y,Ee.u_merc_center=W,Ee.u_camera_forward=me._camera.forward(),Ee.u_ecef_origin=r.dE(me.globeMatrix,j.toUnwrapped()),Ee.u_tile_matrix=Float32Array.from(me.globeMatrix),Ee.u_up_vector=J),Ee},zh=(l,t,s,c)=>({u_matrix:l,u_emissive_strength:t,u_opacity:s,u_color:c}),Fh=(l,t,s,c,m,_,v,S,A)=>r.h(function(k,L,B,O,j,X){const{width:W,height:Y}=O.imageManager.getPixelSize(L),J=Math.pow(2,X.tileID.overscaledZ),ie=X.tileSize*Math.pow(2,O.transform.tileZoom)/J,ue=ie*(X.tileID.canonical.x+X.tileID.wrap*J),pe=ie*X.tileID.canonical.y;return{u_image:0,u_pattern_tl:B.tl,u_pattern_br:B.br,u_texsize:[W,Y],u_pattern_size:B.displaySize,u_pattern_units_to_pixels:j?[O.transform.width,-1*O.transform.height]:[1/r.aw(X,1,O.transform.tileZoom),1/r.aw(X,1,O.transform.tileZoom)],u_pixel_coord_upper:[ue>>16,pe>>16],u_pixel_coord_lower:[65535&ue,65535&pe]}}(0,_,v,c,S,A),{u_matrix:l,u_emissive_strength:t,u_opacity:s}),Vu=new Float32Array(r.bx([])),Jl=(l,t,s,c,m,_,v,S,A,k,L,B,O,j=[0,0,0],X)=>{const W=m.style.light,Y=W.properties.get("position"),J=[-Y.x,-Y.y,Y.z],ie=r.dx();W.properties.get("anchor")==="viewport"&&(r.dy(ie,-m.transform.angle),r.dz(J,J,ie));const ue=L.alphaMode==="MASK",pe=W.properties.get("color").toNonPremultipliedRenderColor(null),be=O.paint.get("model-ambient-occlusion-intensity"),Te=O.paint.get("model-color").constantOr(r.am.white).toNonPremultipliedRenderColor(null);return Te.a=O.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:l,u_lighting_matrix:t,u_normal_matrix:s,u_node_matrix:c||Vu,u_lightpos:J,u_lightintensity:W.properties.get("intensity"),u_lightcolor:[pe.r,pe.g,pe.b],u_camera_pos:j,u_opacity:_,u_baseTextureIsAlpha:0,u_alphaMask:+ue,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:v.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:S.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:A,u_roughnessFactor:k,u_baseColorTexture:Hs.BaseColor,u_metallicRoughnessTexture:Hs.MetallicRoughness,u_normalTexture:Hs.Normal,u_occlusionTexture:Hs.Occlusion,u_emissionTexture:Hs.Emission,u_lutTexture:Hs.LUT,u_color_mix:Te.toArray01(),u_aoIntensity:be,u_emissive_strength:B,u_occlusionTextureTransform:X||[0,0,0,0]}},Of=(l,t=Vu,s=Vu)=>({u_matrix:l,u_instance:t,u_node_matrix:s}),$c={fillExtrusion:l=>({u_matrix:new r.cc(l),u_lightpos:new r.c9(l),u_lightintensity:new r.ca(l),u_lightcolor:new r.c9(l),u_vertical_gradient:new r.ca(l),u_opacity:new r.ca(l),u_edge_radius:new r.ca(l),u_width_scale:new r.ca(l),u_ao:new r.cb(l),u_height_type:new r.c8(l),u_base_type:new r.c8(l),u_tile_id:new r.c9(l),u_zoom_transition:new r.ca(l),u_inv_rot_matrix:new r.cc(l),u_merc_center:new r.cb(l),u_up_dir:new r.c9(l),u_height_lift:new r.ca(l),u_flood_light_color:new r.c9(l),u_vertical_scale:new r.ca(l),u_flood_light_intensity:new r.ca(l),u_ground_shadow_factor:new r.c9(l)}),fillExtrusionDepth:l=>({u_matrix:new r.cc(l),u_edge_radius:new r.ca(l),u_width_scale:new r.ca(l),u_vertical_scale:new r.ca(l),u_height_type:new r.c8(l),u_base_type:new r.c8(l)}),fillExtrusionPattern:l=>({u_matrix:new r.cc(l),u_lightpos:new r.c9(l),u_lightintensity:new r.ca(l),u_lightcolor:new r.c9(l),u_vertical_gradient:new r.ca(l),u_height_factor:new r.ca(l),u_edge_radius:new r.ca(l),u_width_scale:new r.ca(l),u_ao:new r.cb(l),u_height_type:new r.c8(l),u_base_type:new r.c8(l),u_tile_id:new r.c9(l),u_zoom_transition:new r.ca(l),u_inv_rot_matrix:new r.cc(l),u_merc_center:new r.cb(l),u_up_dir:new r.c9(l),u_height_lift:new r.ca(l),u_image:new r.c8(l),u_texsize:new r.cb(l),u_pixel_coord_upper:new r.cb(l),u_pixel_coord_lower:new r.cb(l),u_tile_units_to_pixels:new r.ca(l),u_opacity:new r.ca(l),u_pattern_transition:new r.ca(l)}),fillExtrusionGroundEffect:l=>({u_matrix:new r.cc(l),u_opacity:new r.ca(l),u_ao_pass:new r.ca(l),u_meter_to_tile:new r.ca(l),u_ao:new r.cb(l),u_flood_light_intensity:new r.ca(l),u_flood_light_color:new r.c9(l),u_attenuation:new r.ca(l),u_edge_radius:new r.ca(l),u_fb:new r.c8(l),u_fb_size:new r.ca(l),u_dynamic_offset:new r.ca(l)}),fill:l=>({u_matrix:new r.cc(l),u_emissive_strength:new r.ca(l),u_ground_shadow_factor:new r.c9(l)}),fillPattern:l=>({u_matrix:new r.cc(l),u_emissive_strength:new r.ca(l),u_image:new r.c8(l),u_texsize:new r.cb(l),u_pixel_coord_upper:new r.cb(l),u_pixel_coord_lower:new r.cb(l),u_tile_units_to_pixels:new r.ca(l),u_ground_shadow_factor:new r.c9(l),u_pattern_transition:new r.ca(l)}),fillOutline:l=>({u_matrix:new r.cc(l),u_emissive_strength:new r.ca(l),u_world:new r.cb(l),u_ground_shadow_factor:new r.c9(l)}),fillOutlinePattern:l=>({u_matrix:new r.cc(l),u_emissive_strength:new r.ca(l),u_world:new r.cb(l),u_image:new r.c8(l),u_texsize:new r.cb(l),u_pixel_coord_upper:new r.cb(l),u_pixel_coord_lower:new r.cb(l),u_tile_units_to_pixels:new r.ca(l),u_ground_shadow_factor:new r.c9(l),u_pattern_transition:new r.ca(l)}),building:l=>({u_matrix:new r.cc(l),u_normal_matrix:new r.cc(l),u_opacity:new r.ca(l)}),buildingDepth:l=>({u_matrix:new r.cc(l)}),elevatedStructuresDepth:l=>({u_matrix:new r.cc(l),u_depth_bias:new r.ca(l)}),elevatedStructures:l=>({u_matrix:new r.cc(l),u_ground_shadow_factor:new r.c9(l)}),elevatedStructuresDepthReconstruct:l=>({u_matrix:new r.cc(l),u_camera_pos:new r.c9(l),u_depth_bias:new r.ca(l),u_height_scale:new r.ca(l),u_reset_depth:new r.ca(l)}),circle:r.dH,collisionBox:l=>({u_matrix:new r.cc(l),u_camera_to_center_distance:new r.ca(l),u_extrude_scale:new r.cb(l)}),collisionCircle:l=>({u_matrix:new r.cc(l),u_inv_matrix:new r.cc(l),u_camera_to_center_distance:new r.ca(l),u_viewport_size:new r.cb(l)}),debug:l=>({u_color:new r.di(l),u_matrix:new r.cc(l),u_overlay:new r.c8(l),u_overlay_scale:new r.ca(l)}),clippingMask:l=>({u_matrix:new r.cc(l)}),heatmap:l=>({u_extrude_scale:new r.ca(l),u_intensity:new r.ca(l),u_matrix:new r.cc(l),u_inv_rot_matrix:new r.cc(l),u_merc_center:new r.cb(l),u_tile_id:new r.c9(l),u_zoom_transition:new r.ca(l),u_up_dir:new r.c9(l)}),heatmapTexture:l=>({u_image:new r.c8(l),u_color_ramp:new r.c8(l),u_opacity:new r.ca(l)}),hillshade:l=>({u_matrix:new r.cc(l),u_image:new r.c8(l),u_latrange:new r.cb(l),u_light:new r.cb(l),u_shadow:new r.di(l),u_highlight:new r.di(l),u_emissive_strength:new r.ca(l),u_accent:new r.di(l)}),hillshadePrepare:l=>({u_matrix:new r.cc(l),u_image:new r.c8(l),u_dimension:new r.cb(l),u_zoom:new r.ca(l)}),line:r.dG,linePattern:r.dF,raster:l=>({u_matrix:new r.cc(l),u_normalize_matrix:new r.cc(l),u_globe_matrix:new r.cc(l),u_merc_matrix:new r.cc(l),u_grid_matrix:new r.dj(l),u_tl_parent:new r.cb(l),u_scale_parent:new r.ca(l),u_fade_t:new r.ca(l),u_opacity:new r.ca(l),u_image0:new r.c8(l),u_image1:new r.c8(l),u_brightness_low:new r.ca(l),u_brightness_high:new r.ca(l),u_saturation_factor:new r.ca(l),u_contrast_factor:new r.ca(l),u_spin_weights:new r.c9(l),u_perspective_transform:new r.cb(l),u_raster_elevation:new r.ca(l),u_zoom_transition:new r.ca(l),u_merc_center:new r.cb(l),u_cutoff_params:new r.cQ(l),u_colorization_mix:new r.cQ(l),u_colorization_offset:new r.ca(l),u_color_ramp:new r.c8(l),u_texture_offset:new r.cb(l),u_texture_res:new r.cb(l),u_emissive_strength:new r.ca(l)}),rasterParticle:l=>({u_matrix:new r.cc(l),u_normalize_matrix:new r.cc(l),u_globe_matrix:new r.cc(l),u_merc_matrix:new r.cc(l),u_grid_matrix:new r.dj(l),u_tl_parent:new r.cb(l),u_scale_parent:new r.ca(l),u_fade_t:new r.ca(l),u_opacity:new r.ca(l),u_image0:new r.c8(l),u_image1:new r.c8(l),u_raster_elevation:new r.ca(l),u_zoom_transition:new r.ca(l),u_merc_center:new r.cb(l),u_cutoff_params:new r.cQ(l)}),rasterParticleTexture:l=>({u_texture:new r.c8(l),u_opacity:new r.ca(l)}),rasterParticleDraw:l=>({u_particle_texture:new r.c8(l),u_particle_texture_side_len:new r.ca(l),u_tile_offset:new r.cb(l),u_velocity:new r.c8(l),u_color_ramp:new r.c8(l),u_velocity_res:new r.cb(l),u_max_speed:new r.ca(l),u_uv_offset:new r.cb(l),u_data_scale:new r.cb(l),u_data_offset:new r.ca(l),u_particle_pos_scale:new r.ca(l),u_particle_pos_offset:new r.cb(l)}),rasterParticleUpdate:l=>({u_particle_texture:new r.c8(l),u_particle_texture_side_len:new r.ca(l),u_velocity:new r.c8(l),u_velocity_res:new r.cb(l),u_max_speed:new r.ca(l),u_speed_factor:new r.ca(l),u_reset_rate:new r.ca(l),u_rand_seed:new r.ca(l),u_uv_offset:new r.cb(l),u_data_scale:new r.cb(l),u_data_offset:new r.ca(l),u_particle_pos_scale:new r.ca(l),u_particle_pos_offset:new r.cb(l)}),symbol:l=>({u_is_size_zoom_constant:new r.c8(l),u_is_size_feature_constant:new r.c8(l),u_size_t:new r.ca(l),u_size:new r.ca(l),u_camera_to_center_distance:new r.ca(l),u_rotate_symbol:new r.c8(l),u_aspect_ratio:new r.ca(l),u_fade_change:new r.ca(l),u_matrix:new r.cc(l),u_label_plane_matrix:new r.cc(l),u_coord_matrix:new r.cc(l),u_is_text:new r.c8(l),u_elevation_from_sea:new r.c8(l),u_pitch_with_map:new r.c8(l),u_texsize:new r.cb(l),u_texsize_icon:new r.cb(l),u_texture:new r.c8(l),u_texture_icon:new r.c8(l),u_gamma_scale:new r.ca(l),u_device_pixel_ratio:new r.ca(l),u_tile_id:new r.c9(l),u_zoom_transition:new r.ca(l),u_inv_rot_matrix:new r.cc(l),u_merc_center:new r.cb(l),u_camera_forward:new r.c9(l),u_tile_matrix:new r.cc(l),u_up_vector:new r.c9(l),u_ecef_origin:new r.c9(l),u_is_halo:new r.c8(l),u_icon_transition:new r.ca(l),u_color_adj_mat:new r.cc(l),u_scale_factor:new r.ca(l),u_ground_shadow_factor:new r.c9(l),u_inv_matrix:new r.cc(l),u_normal_scale:new r.ca(l)}),background:l=>({u_matrix:new r.cc(l),u_emissive_strength:new r.ca(l),u_opacity:new r.ca(l),u_color:new r.di(l)}),backgroundPattern:l=>({u_matrix:new r.cc(l),u_emissive_strength:new r.ca(l),u_opacity:new r.ca(l),u_image:new r.c8(l),u_pattern_tl:new r.cb(l),u_pattern_br:new r.cb(l),u_texsize:new r.cb(l),u_pattern_size:new r.cb(l),u_pixel_coord_upper:new r.cb(l),u_pixel_coord_lower:new r.cb(l),u_pattern_units_to_pixels:new r.cb(l)}),terrainRaster:l=>({u_matrix:new r.cc(l),u_image0:new r.c8(l),u_skirt_height:new r.ca(l),u_ground_shadow_factor:new r.c9(l)}),skybox:l=>({u_matrix:new r.cc(l),u_sun_direction:new r.c9(l),u_cubemap:new r.c8(l),u_opacity:new r.ca(l),u_temporal_offset:new r.ca(l)}),skyboxGradient:l=>({u_matrix:new r.cc(l),u_color_ramp:new r.c8(l),u_center_direction:new r.c9(l),u_radius:new r.ca(l),u_opacity:new r.ca(l),u_temporal_offset:new r.ca(l)}),skyboxCapture:l=>({u_matrix_3f:new r.dj(l),u_sun_direction:new r.c9(l),u_sun_intensity:new r.ca(l),u_color_tint_r:new r.cQ(l),u_color_tint_m:new r.cQ(l),u_luminance:new r.ca(l)}),globeRaster:l=>({u_proj_matrix:new r.cc(l),u_globe_matrix:new r.cc(l),u_normalize_matrix:new r.cc(l),u_merc_matrix:new r.cc(l),u_zoom_transition:new r.ca(l),u_merc_center:new r.cb(l),u_image0:new r.c8(l),u_grid_matrix:new r.dj(l),u_skirt_height:new r.ca(l),u_far_z_cutoff:new r.ca(l),u_frustum_tl:new r.c9(l),u_frustum_tr:new r.c9(l),u_frustum_br:new r.c9(l),u_frustum_bl:new r.c9(l),u_globe_pos:new r.c9(l),u_globe_radius:new r.ca(l),u_viewport:new r.cb(l)}),globeAtmosphere:l=>({u_frustum_tl:new r.c9(l),u_frustum_tr:new r.c9(l),u_frustum_br:new r.c9(l),u_frustum_bl:new r.c9(l),u_horizon:new r.ca(l),u_transition:new r.ca(l),u_fadeout_range:new r.ca(l),u_color:new r.cQ(l),u_high_color:new r.cQ(l),u_space_color:new r.cQ(l),u_temporal_offset:new r.ca(l),u_horizon_angle:new r.ca(l)}),model:l=>({u_matrix:new r.cc(l),u_lighting_matrix:new r.cc(l),u_normal_matrix:new r.cc(l),u_node_matrix:new r.cc(l),u_lightpos:new r.c9(l),u_lightintensity:new r.ca(l),u_lightcolor:new r.c9(l),u_camera_pos:new r.c9(l),u_opacity:new r.ca(l),u_baseColorFactor:new r.cQ(l),u_emissiveFactor:new r.cQ(l),u_metallicFactor:new r.ca(l),u_roughnessFactor:new r.ca(l),u_baseTextureIsAlpha:new r.c8(l),u_alphaMask:new r.c8(l),u_alphaCutoff:new r.ca(l),u_baseColorTexture:new r.c8(l),u_metallicRoughnessTexture:new r.c8(l),u_normalTexture:new r.c8(l),u_occlusionTexture:new r.c8(l),u_emissionTexture:new r.c8(l),u_lutTexture:new r.c8(l),u_color_mix:new r.cQ(l),u_aoIntensity:new r.ca(l),u_emissive_strength:new r.ca(l),u_occlusionTextureTransform:new r.cQ(l)}),modelDepth:l=>({u_matrix:new r.cc(l),u_instance:new r.cc(l),u_node_matrix:new r.cc(l)}),groundShadow:l=>({u_matrix:new r.cc(l),u_ground_shadow_factor:new r.c9(l)}),stars:l=>({u_matrix:new r.cc(l),u_up:new r.c9(l),u_right:new r.c9(l),u_intensity_multiplier:new r.ca(l)}),snowParticle:l=>({u_modelview:new r.cc(l),u_projection:new r.cc(l),u_time:new r.ca(l),u_cam_pos:new r.c9(l),u_velocityConeAperture:new r.ca(l),u_velocity:new r.ca(l),u_horizontalOscillationRadius:new r.ca(l),u_horizontalOscillationRate:new r.ca(l),u_boxSize:new r.ca(l),u_billboardSize:new r.ca(l),u_simpleShapeParameters:new r.cb(l),u_screenSize:new r.cb(l),u_thinningCenterPos:new r.cb(l),u_thinningShape:new r.c9(l),u_thinningAffectedRatio:new r.ca(l),u_thinningParticleOffset:new r.ca(l),u_particleColor:new r.cQ(l),u_direction:new r.c9(l)}),rainParticle:l=>({u_modelview:new r.cc(l),u_projection:new r.cc(l),u_time:new r.ca(l),u_cam_pos:new r.c9(l),u_texScreen:new r.c8(l),u_velocityConeAperture:new r.ca(l),u_velocity:new r.ca(l),u_boxSize:new r.ca(l),u_rainDropletSize:new r.cb(l),u_distortionStrength:new r.ca(l),u_rainDirection:new r.c9(l),u_color:new r.cQ(l),u_screenSize:new r.cb(l),u_thinningCenterPos:new r.cb(l),u_thinningShape:new r.c9(l),u_thinningAffectedRatio:new r.ca(l),u_thinningParticleOffset:new r.ca(l),u_shapeDirectionalPower:new r.ca(l),u_shapeNormalPower:new r.ca(l),u_mode:new r.ca(l)}),vignette:l=>({u_vignetteShape:new r.c9(l),u_vignetteColor:new r.cQ(l)}),occlusion:l=>({u_matrix:new r.cc(l),u_anchorPos:new r.c9(l),u_screenSizePx:new r.cb(l),u_occluderSizePx:new r.cb(l),u_color:new r.cQ(l)})};class To{constructor(t,s,c,m){this.id=To.uniqueIdxCounter,To.uniqueIdxCounter++,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||m||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=To.uniqueIdxCounter,To.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}To.uniqueIdxCounter=0;const Rm={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Oh{constructor(t,s,c,m,_,v){this.length=s.length,this.attributes=c,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.instanceCount=v,this.context=t;const S=t.gl;this.buffer=S.createBuffer(),t.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||_||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let c=0;c<this.attributes.length;c++){const m=s.attributes[this.attributes[c].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,s,c){for(let m=0;m<this.attributes.length;m++){const _=this.attributes[m],v=s.attributes[_.name];v!==void 0&&t.vertexAttribPointer(v,_.components,t[Rm[_.type]],!1,this.itemSize,_.offset+this.itemSize*(c||0))}}setVertexAttribDivisor(t,s,c){for(let m=0;m<this.attributes.length;m++){const _=s.attributes[this.attributes[m].name];_!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(_,c)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Uu{constructor(t,s,c,m,_){this.context=t,this.width=s,this.height=c;const v=this.framebuffer=t.gl.createFramebuffer();m&&(this.colorAttachment=new Ip(t,v)),_&&(this.depthAttachmentType=_,this.depthAttachment=_==="renderbuffer"?new Pp(t,v):new Nc(t,v))}destroy(){const t=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&t.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&t.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&t.deleteTexture(s)}t.deleteFramebuffer(this.framebuffer)}}class Rp{constructor(t,s){this.gl=t,this.clearColor=new Mf(this),this.clearDepth=new Ir(this),this.clearStencil=new Rf(this),this.colorMask=new Ad(this),this.depthMask=new Ph(this),this.stencilMask=new Ap(this),this.stencilFunc=new Id(this),this.stencilOp=new Mh(this),this.stencilTest=new Oc(this),this.depthRange=new Mu(this),this.depthTest=new kf(this),this.depthFunc=new Df(this),this.blend=new Pd(this),this.blendFunc=new Md(this),this.blendColor=new Aa(this),this.blendEquation=new cl(this),this.cullFace=new Ru(this),this.cullFaceSide=new ku(this),this.frontFace=new Yl(this),this.program=new Rd(this),this.activeTexture=new Lf(this),this.viewport=new zf(this),this.bindFramebuffer=new Du(this),this.bindRenderbuffer=new kd(this),this.bindTexture=new Lu(this),this.bindVertexBuffer=new Ia(this),this.bindElementBuffer=new Rh(this),this.bindVertexArrayOES=new Pa(this),this.pixelStoreUnpack=new aa(this),this.pixelStoreUnpackPremultiplyAlpha=new zu(this),this.pixelStoreUnpackFlipY=new Ma(this),this.options=s?Object.assign({},s):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=s&&!!s.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s,c){return new To(this,t,s,c)}createVertexBuffer(t,s,c,m,_){return new Oh(this,t,s,c,m,_)}createRenderbuffer(t,s,c){const m=this.gl,_=m.createRenderbuffer();return this.bindRenderbuffer.set(_),m.renderbufferStorage(m.RENDERBUFFER,t,s,c),this.bindRenderbuffer.set(null),_}createFramebuffer(t,s,c,m){return new Uu(this,t,s,c,m)}clear({color:t,depth:s,stencil:c,colorMask:m}){const _=this.gl;let v=0;t&&(v|=_.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(m||[!0,!0,!0,!0])),s!==void 0&&(v|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),c!==void 0&&(v|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),_.clear(v)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){r.bv(t.blendFunction,Wi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Hc;function hl(l,t,s,c,m,_,v){const S=l.context,A=S.gl,k=l.transform,L=l.getOrCreateProgram("collisionBox"),B=[];let O=0,j=0;for(let pe=0;pe<c.length;pe++){const be=c[pe],Te=t.getTile(be),xe=Te.getBucket(s);if(!xe)continue;const me=gi(be,xe,k);let Ee=me;m[0]===0&&m[1]===0||(Ee=l.translatePosMatrix(me,Te,m,_));const Ae=v?xe.textCollisionBox:xe.iconCollisionBox,Oe=xe.collisionCircleArray;if(Oe.length>0){const Ge=r.bz(),nt=Ee;r.cB(Ge,xe.placementInvProjMatrix,k.glCoordMatrix),r.cB(Ge,Ge,xe.placementViewportMatrix),B.push({circleArray:Oe,circleOffset:j,transform:nt,invTransform:Ge,projection:xe.getProjection()}),O+=Oe.length/4,j=O}Ae&&(l.terrain&&l.terrain.setupElevationDraw(Te,L),L.draw(l,A.LINES,Xt.disabled,vi.disabled,l.colorModeForRenderPass(),mi.disabled,Ko(Ee,k,Te,xe.getProjection()),s.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,null,k.zoom,null,[Ae.collisionVertexBuffer,Ae.collisionVertexBufferExt]))}if(!v||!B.length)return;const X=l.getOrCreateProgram("collisionCircle"),W=new r.dI;W.resize(4*O),W._trim();let Y=0;for(const pe of B)for(let be=0;be<pe.circleArray.length/4;be++){const Te=4*be,xe=pe.circleArray[Te+0],me=pe.circleArray[Te+1],Ee=pe.circleArray[Te+2],Ae=pe.circleArray[Te+3];W.emplace(Y++,xe,me,Ee,Ae,0),W.emplace(Y++,xe,me,Ee,Ae,1),W.emplace(Y++,xe,me,Ee,Ae,2),W.emplace(Y++,xe,me,Ee,Ae,3)}(!Hc||Hc.length<2*O)&&(Hc=function(pe){const be=2*pe,Te=new r.a_;Te.resize(be),Te._trim();for(let xe=0;xe<be;xe++){const me=6*xe;Te.uint16[me+0]=4*xe+0,Te.uint16[me+1]=4*xe+1,Te.uint16[me+2]=4*xe+2,Te.uint16[me+3]=4*xe+2,Te.uint16[me+4]=4*xe+3,Te.uint16[me+5]=4*xe+0}return Te}(O));const J=S.createIndexBuffer(Hc,!0),ie=S.createVertexBuffer(W,r.dJ.members,!0);for(const pe of B){const be={u_matrix:pe.transform,u_inv_matrix:pe.invTransform,u_camera_to_center_distance:(ue=k).getCameraToCenterDistance(pe.projection),u_viewport_size:[ue.width,ue.height]};X.draw(l,A.TRIANGLES,Xt.disabled,vi.disabled,l.colorModeForRenderPass(),mi.disabled,be,s.id,ie,J,r.bd.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,k.zoom)}var ue;ie.destroy(),J.destroy()}const za=r.bz();function Ql(l){const t=l._camera.getWorldToCamera(l.worldSize,1),s=r.az([],t,l.globeMatrix);r.bi(s,s);const c=[0,0,0],m=[0,1,0,0];return r.aA(m,m,s),c[0]=m[0],c[1]=m[1],c[2]=m[2],r.au(c,c),c}function ec({width:l,height:t,anchor:s,textOffset:c,textScale:m},_){const{horizontalAlign:v,verticalAlign:S}=r.bT(s),A=-(v-.5)*l,k=-(S-.5)*t,L=r.bU(s,c);return new r.P((A/m+L[0])*_,(k/m+L[1])*_)}function Wc(l,t,s,c,m,_,v,S,A,k){const L=l.text.placedSymbolArray,B=l.text.dynamicLayoutVertexArray,O=l.icon.dynamicLayoutVertexArray,j={},X=l.getProjection(),W=wu(v,X,m),Y=m.elevation,J=X.upVectorScale(v.canonical,m.center.lat,m.worldSize).metersToTile;B.clear();for(let ie=0;ie<L.length;ie++){const ue=L.get(ie),{tileAnchorX:pe,tileAnchorY:be,numGlyphs:Te}=ue,xe=ue.hidden||!ue.crossTileID||l.allowVerticalPlacement&&!ue.placedOrientation?null:c[ue.crossTileID];if(xe){let me=0,Ee=0,Ae=0;if(Y){const st=Y?Y.getAtTileOffset(v,pe,be):0,[We,ut,Et]=X.upVector(v.canonical,pe,be);me=st*We*J,Ee=st*ut*J,Ae=st*Et*J}let[Oe,Ge,nt,it]=mo(ue.projectedAnchorX+me,ue.projectedAnchorY+Ee,ue.projectedAnchorZ+Ae,s?W:_);const ht=Cc(m.getCameraToCenterDistance(X),it);let Be=r.bJ(l.textSizeData,A,ue)*ht/r.bO;s&&(Be*=l.tilePixelRatio/S);const Xe=ec(xe,Be);s?({x:Oe,y:Ge,z:nt}=X.projectTilePoint(pe+Xe.x,be+Xe.y,v.canonical),[Oe,Ge,nt]=mo(Oe+me,Ge+Ee,nt+Ae,_)):(t&&Xe._rotate(-m.angle),Oe+=Xe.x,Ge+=Xe.y,nt=0);const ke=l.allowVerticalPlacement&&ue.placedOrientation===r.bI.vertical?Math.PI/2:0;for(let st=0;st<Te;st++)r.bL(B,Oe,Ge,nt,ke);k&&ue.associatedIconIndex>=0&&(j[ue.associatedIconIndex]={x:Oe,y:Ge,z:nt,angle:ke})}else hs(Te,B)}if(k){O.clear();const ie=l.icon.placedSymbolArray;for(let ue=0;ue<ie.length;ue++){const pe=ie.get(ue),{numGlyphs:be}=pe,Te=j[ue];if(pe.hidden||!Te)hs(be,O);else{const{x:xe,y:me,z:Ee,angle:Ae}=Te;for(let Oe=0;Oe<be;Oe++)r.bL(O,xe,me,Ee,Ae)}}l.icon.dynamicLayoutVertexBuffer.updateData(O)}l.text.dynamicLayoutVertexBuffer.updateData(B)}function tc(l,t,s,c,m,_,v={}){const S=s.paint.get("icon-translate"),A=s.paint.get("text-translate"),k=s.paint.get("icon-translate-anchor"),L=s.paint.get("text-translate-anchor"),B=s.layout.get("icon-rotation-alignment"),O=s.layout.get("text-rotation-alignment"),j=s.layout.get("icon-pitch-alignment"),X=s.layout.get("text-pitch-alignment"),W=s.layout.get("icon-keep-upright"),Y=s.layout.get("text-keep-upright"),J=s.paint.get("icon-color-saturation"),ie=s.paint.get("icon-color-contrast"),ue=s.paint.get("icon-color-brightness-min"),pe=s.paint.get("icon-color-brightness-max"),be=s.layout.get("symbol-elevation-reference")==="sea",Te=l.context,xe=Te.gl,me=l.transform,Ee=B==="map",Ae=O==="map",Oe=j==="map",Ge=X==="map",nt=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let it=!1;const ht=l.depthModeForSublayer(0,Xt.ReadOnly),Be=new Xt(l.context.gl.LEQUAL,Xt.ReadOnly,l.depthRangeFor3D),Xe=[r.aD(me.center.lng),r.aH(me.center.lat)],ke=s.layout.get("text-variable-anchor"),st=me.projection.name==="globe",We=[],ut=[0,-1,0];for(const Et of c){const ot=t.getTile(Et),yt=ot.getBucket(s);if(!yt||yt.projection.name==="mercator"&&st||yt.fullyClipped)continue;const jt=yt.projection.name==="globe",Wt=jt?r.ah(me.zoom):0,Ot=wu(Et,yt.getProjection(),me),Zt=me.calculatePixelsToTileUnitsMatrix(ot),ai=ke&&yt.hasTextData(),ui=yt.hasIconTextFit()&&ai&&yt.hasIconData(),wi=yt.getProjection().createInversionMatrix(me,Et.canonical),Ni=(1<<ot.tileID.canonical.z)*r.aj/l.transform.worldSize,cn=Hn=>{let wn=[0,0,0];if(Hn){const pr=l.style.directionalLight,an=l.style.ambientLight;pr&&an&&(wn=al(l.style,pr,an))}return wn},Un=Hn=>{me.depthOcclusionForSymbolsAndCircles&&(s.hasInitialOcclusionOpacityProperties||l.terrain)&&(Hn.push("DEPTH_D24"),Hn.push("DEPTH_OCCLUSION"))},En=()=>{const Hn=Ee&&s.layout.get("symbol-placement")!=="point",wn=[];Un(wn);const pr=Hn||ui,an=yt.elevationType==="road"&&Oe,mr=l.shadowRenderer,Kn=an&&!!mr&&mr.enabled,Mn=cn(Kn),Wn=an?Be:ht,Fi=s.paint.get("icon-image-cross-fade");l.terrainRenderModeElevated()&&Oe&&wn.push("PITCH_WITH_MAP_TERRAIN"),jt&&(wn.push("PROJECTION_GLOBE_VIEW"),pr&&wn.push("PROJECTED_POS_ON_VIEWPORT")),Fi>0&&wn.push("ICON_TRANSITION"),yt.icon.zOffsetVertexBuffer&&wn.push("Z_OFFSET"),J===0&&ie===0&&ue===0&&pe===1||wn.push("COLOR_ADJUSTMENT"),yt.sdfIcons&&wn.push("RENDER_SDF"),Kn&&wn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),an&&yt.icon.orientationVertexBuffer&&wn.push("ELEVATED_ROADS");const vr=yt.icon.programConfigurations.get(s.id),ns=l.getOrCreateProgram("symbol",{config:vr,defines:wn}),ir=ot.imageAtlasTexture?ot.imageAtlasTexture.size:[0,0],vn=yt.iconSizeData,co=r.bH(vn,me.zoom),Xs=Oe||!me.isOrthographic,Vo=tl(Ot,ot.tileID.canonical,Oe,Ee,me,yt.getProjection(),Zt),Ur=xu(Ot,ot.tileID.canonical,Oe,Ee,me,yt.getProjection(),Zt),Co=l.translatePosMatrix(Ur,ot,S,k,!0),uo=l.translatePosMatrix(Ot,ot,S,k),ho=pr?za:Vo,Ao=Ee&&!Oe&&!Hn;let Io=ut;!st&&!me.mercatorFromTransition||Ee||(Io=Ql(me));const lc=jt?Io:ut,ed=s.getColorAdjustmentMatrix(J,ie,ue,pe),cc=ju(vn.kind,co,Ao,Oe,l,uo,ho,Co,be,!1,ir,[0,0],0,Et,Wt,Xe,wi,lc,yt.getProjection(),Mn,Ni,ed,Fi,null),Kf=ot.imageAtlasTexture?ot.imageAtlasTexture:null,su=s.layout.get("icon-size").constantOr(0)!==1||yt.iconsNeedLinear,af=yt.sdfIcons||l.options.rotating||l.options.zooming||su||Xs?xe.LINEAR:xe.NEAREST,td=yt.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,pa=l.terrain&&Oe&&Hn?r.bi(r.bz(),Vo):za;if(Hn&&yt.icon){const wl=me.elevation,Ha=wl?wl.getAtTileOffsetFunc(Et,me.center.lat,me.worldSize,yt.getProjection()):null,bl=yd(Ot,ot.tileID.canonical,Oe,Ee,me,yt.getProjection(),Zt);ra(yt,Ot,l,!1,bl,Ur,Oe,W,Ha,Et)}return{program:ns,buffers:yt.icon,uniformValues:cc,atlasTexture:Kf,atlasTextureIcon:null,atlasInterpolation:af,atlasInterpolationIcon:null,isSDF:yt.sdfIcons,hasHalo:td,depthMode:Wn,tile:ot,renderWithShadows:Kn,labelPlaneMatrixInv:pa}},yn=()=>{const Hn=Ae&&s.layout.get("symbol-placement")!=="point",wn=[],pr=Hn||ke||ui,an=yt.elevationType==="road"&&Ge,mr=l.shadowRenderer,Kn=an&&!!mr&&mr.enabled,Mn=cn(Kn),Wn=an?Be:ht;l.terrainRenderModeElevated()&&Ge&&wn.push("PITCH_WITH_MAP_TERRAIN"),jt&&(wn.push("PROJECTION_GLOBE_VIEW"),pr&&wn.push("PROJECTED_POS_ON_VIEWPORT")),yt.text.zOffsetVertexBuffer&&wn.push("Z_OFFSET"),yt.iconsInText&&wn.push("RENDER_TEXT_AND_SYMBOL"),wn.push("RENDER_SDF"),Kn&&wn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),an&&yt.text.orientationVertexBuffer&&wn.push("ELEVATED_ROADS"),Un(wn);const Fi=yt.text.programConfigurations.get(s.id),vr=l.getOrCreateProgram("symbol",{config:Fi,defines:wn});let ns,ir=[0,0],vn=null;const co=yt.textSizeData;yt.iconsInText&&(ir=ot.imageAtlasTexture?ot.imageAtlasTexture.size:[0,0],vn=ot.imageAtlasTexture?ot.imageAtlasTexture:null,ns=Ge||!me.isOrthographic||l.options.rotating||l.options.zooming||co.kind==="composite"||co.kind==="camera"?xe.LINEAR:xe.NEAREST);const Xs=ot.glyphAtlasTexture?ot.glyphAtlasTexture.size:[0,0],Vo=s.layout.get("text-size-scale-range"),Ur=r.ay(l.scaleFactor,Vo[0],Vo[1]),Co=r.bH(co,me.zoom,Ur),uo=tl(Ot,ot.tileID.canonical,Ge,Ae,me,yt.getProjection(),Zt),ho=xu(Ot,ot.tileID.canonical,Ge,Ae,me,yt.getProjection(),Zt),Ao=l.translatePosMatrix(ho,ot,A,L,!0),Io=l.translatePosMatrix(Ot,ot,A,L),lc=pr?za:uo,ed=Ae&&!Ge&&!Hn;let cc=ut;!st&&!me.mercatorFromTransition||Ae||(cc=Ql(me));const Kf=ju(co.kind,Co,ed,Ge,l,Io,lc,Ao,be,!0,Xs,ir,0,Et,Wt,Xe,wi,jt?cc:ut,yt.getProjection(),Mn,Ni,null,null,Ur),su=ot.glyphAtlasTexture?ot.glyphAtlasTexture:null,af=xe.LINEAR,td=s.paint.get("text-halo-width").constantOr(1)!==0,pa=l.terrain&&Ge&&Hn?r.bi(r.bz(),uo):za;if(Hn&&yt.text){const wl=me.elevation,Ha=wl?wl.getAtTileOffsetFunc(Et,me.center.lat,me.worldSize,yt.getProjection()):null,bl=yd(Ot,ot.tileID.canonical,Ge,Ae,me,yt.getProjection(),Zt);ra(yt,Ot,l,!0,bl,ho,Ge,Y,Ha,Et)}return{program:vr,buffers:yt.text,uniformValues:Kf,atlasTexture:su,atlasTextureIcon:vn,atlasInterpolation:af,atlasInterpolationIcon:ns,isSDF:!0,hasHalo:td,depthMode:Wn,tile:ot,renderWithShadows:Kn,labelPlaneMatrixInv:pa}},_r=yt.icon.segments.get().length,Ii=yt.text.segments.get().length,Bi=_r&&!v.onlyText?En():null,Yi=Ii&&!v.onlyIcons?yn():null,Gn=s.paint.get("icon-opacity").constantOr(1),Cr=s.paint.get("text-opacity").constantOr(1);if(nt&&yt.canOverlap){it=!0;const Hn=Gn&&!v.onlyText?yt.icon.segments.get():[],wn=Cr&&!v.onlyIcons?yt.text.segments.get():[];for(const pr of Hn)We.push({segments:new r.bd([pr]),sortKey:pr.sortKey,state:Bi});for(const pr of wn)We.push({segments:new r.bd([pr]),sortKey:pr.sortKey,state:Yi})}else v.onlyText||We.push({segments:Gn?yt.icon.segments:new r.bd([]),sortKey:0,state:Bi}),v.onlyIcons||We.push({segments:Cr?yt.text.segments:new r.bd([]),sortKey:0,state:Yi})}it&&We.sort((Et,ot)=>Et.sortKey-ot.sortKey);for(const Et of We){const ot=Et.state;if(ot)if(l.terrain?l.terrain.setupElevationDraw(ot.tile,ot.program,{useDepthForOcclusion:me.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ot.labelPlaneMatrixInv}):l.setupDepthForOcclusion(me.depthOcclusionForSymbolsAndCircles,ot.program),Te.activeTexture.set(xe.TEXTURE0),ot.atlasTexture&&ot.atlasTexture.bind(ot.atlasInterpolation,xe.CLAMP_TO_EDGE,!0),ot.atlasTextureIcon&&(Te.activeTexture.set(xe.TEXTURE1),ot.atlasTextureIcon&&ot.atlasTextureIcon.bind(ot.atlasInterpolationIcon,xe.CLAMP_TO_EDGE,!0)),ot.renderWithShadows&&l.shadowRenderer.setupShadows(ot.tile.tileID.toUnwrapped(),ot.program,"vector-tile",ot.tile.tileID.overscaledZ),l.uploadCommonLightUniforms(l.context,ot.program),ot.hasHalo){const yt=ot.uniformValues;yt.u_is_halo=1,ic(ot.buffers,Et.segments,s,l,ot.program,ot.depthMode,m,_,yt,2),yt.u_is_halo=0}else{if(ot.isSDF){const yt=ot.uniformValues;ot.hasHalo&&(yt.u_is_halo=1,ic(ot.buffers,Et.segments,s,l,ot.program,ot.depthMode,m,_,yt,1)),yt.u_is_halo=0}ic(ot.buffers,Et.segments,s,l,ot.program,ot.depthMode,m,_,ot.uniformValues,1)}}}function ic(l,t,s,c,m,_,v,S,A,k){const L=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.iconTransitioningVertexBuffer,l.globeExtVertexBuffer,l.zOffsetVertexBuffer,l.orientationVertexBuffer];m.draw(c,c.context.gl.TRIANGLES,_,v,S,mi.disabled,A,s.id,l.layoutVertexBuffer,l.indexBuffer,t,s.paint,c.transform.zoom,l.programConfigurations.get(s.id),L,k)}function Gu(l,t){const s=1<<l.canonical.z,c=(t.x*s-l.canonical.x-l.wrap*s)*r.aj,m=(t.y*s-l.canonical.y)*r.aj,_=r.dS(t.z,t.y);return r.cS(c,m,_)}function Nh(l,t,s,c,m){if(!s.layout||s.layout.get("fill-elevation-reference")==="none")return;const _=l.context.gl,v=new Xt(l.context.gl.LEQUAL,Xt.ReadWrite,l.depthRangeFor3D),S=new Xt(l.context.gl.GREATER,Xt.ReadWrite,l.depthRangeFor3D),A=function(j){const X=r.cJ(j.pitch);let W=.01;return j.isOrthographic&&(W=r.ai(1e-4,W,r.cN(X>=qr?1:X/qr))),2*W}(l.transform),k=l.transform.getFreeCameraOptions().position,L="elevatedStructuresDepthReconstruct",B=l.getOrCreateProgram(L,{defines:["DEPTH_RECONSTRUCTION"]}),O=l.getOrCreateProgram(L);for(const j of c){const X=t.getTile(j),W=X.getBucket(s);if(!W)continue;const Y=W.elevatedStructures;if(!Y)continue;const J=W.elevationBufferData.heightRange,ie=Gu(j.toUnwrapped(),k),ue=l.translatePosMatrix(j.projMatrix,X,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));let pe,be,Te,xe;if(m==="initialize"){if(!J||J.min>=1||Y.depthSegments.segments[0].primitiveLength===0)continue;pe=so(ue,ie,A,1,0),be=v,Te=Y.depthSegments,xe=B}else if(m==="reset"){if(!J||J.min>=0||Y.maskSegments.segments[0].primitiveLength===0)continue;pe=so(ue,ie,0,0,1),be=S,Te=Y.maskSegments,xe=B}else if(m==="geometry"){if(Y.depthSegments.segments[0].primitiveLength===0)continue;pe=so(ue,ie,A,1,0),be=v,Te=Y.depthSegments,xe=O}xe.draw(l,_.TRIANGLES,be,vi.disabled,Wi.disabled,mi.disabled,pe,s.id,Y.vertexBuffer,Y.indexBuffer,Te,s.paint,l.transform.zoom)}}function nc(l,t,s){const{painter:c,sourceCache:m,layer:_,coords:v,colorMode:S,elevationType:A,terrainEnabled:k,pass:L}=l,B=c.context.gl,O=_.paint.get("fill-pattern"),j=_.paint.get("fill-pattern-cross-fade"),X=O.constantOr(null);let W=A;A!=="road"||t&&!k||(W="none");const Y=W==="road",J=l.painter.shadowRenderer,ie=Y&&!!J&&J.enabled,ue=new Xt(c.context.gl.LEQUAL,Xt.ReadOnly,c.depthRangeFor3D);let pe=[0,0,0];if(ie){const xe=c.style.directionalLight,me=c.style.ambientLight;xe&&me&&(pe=al(c.style,xe,me))}const be=O&&O.constantOr(1),Te=(xe,me)=>{let Ee,Ae,Oe,Ge,nt;me?(Ee=be&&!_.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Oe=B.LINES):(Ee=be?"fillPattern":"fill",Oe=B.TRIANGLES);for(const it of v){const ht=m.getTile(it);if(be&&!ht.patternsLoaded())continue;const Be=ht.getBucket(_);if(!Be)continue;const Xe=t?Be.elevationBufferData:Be.bufferData;if(Xe.isEmpty())continue;c.prepareDrawTile();const ke=Xe.programConfigurations.get(_.id),st=c.isTileAffectedByFog(it),We=[],ut=[];Y&&(We.push("ELEVATED_ROADS"),ut.push(Xe.elevatedLayoutVertexBuffer)),ie&&We.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),be&&(c.context.activeTexture.set(B.TEXTURE0),ht.imageAtlasTexture&&ht.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),ke.updatePaintBuffers());let Et=!1;if(X&&ht.imageAtlas){const Ot=ht.imageAtlas,Zt=r.dN.from(X),ai=Zt.getPrimary().scaleSelf(r.q.devicePixelRatio).toString(),ui=Zt.getSecondary(),wi=Ot.patternPositions.get(ai),Ni=ui?Ot.patternPositions.get(ui.scaleSelf(r.q.devicePixelRatio).toString()):null;Et=!!wi&&!!Ni,wi&&ke.setConstantPatternPositions(wi,Ni)}j>0&&(Et||ke.getPatternTransitionVertexBuffer("fill-pattern"))&&We.push("FILL_PATTERN_TRANSITION");const ot=c.getOrCreateProgram(Ee,{config:ke,overrideFog:st,defines:We}),yt=c.translatePosMatrix(it.projMatrix,ht,_.paint.get("fill-translate"),_.paint.get("fill-translate-anchor"));ie&&J.setupShadows(ht.tileID.toUnwrapped(),ot,"vector-tile",ht.tileID.overscaledZ);const jt=_.paint.get("fill-emissive-strength");if(me){Ge=Xe.lineIndexBuffer,nt=Xe.lineSegments;const Ot=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[B.drawingBufferWidth,B.drawingBufferHeight];Ae=Ee==="fillOutlinePattern"&&be?zd(yt,jt,c,ht,Ot,pe,j):Bu(yt,jt,Ot,pe)}else Ge=Xe.indexBuffer,nt=Xe.triangleSegments,Ae=be?Gc(yt,jt,c,ht,pe,j):bo(yt,jt,pe);c.uploadCommonUniforms(c.context,ot,it.toUnwrapped());let Wt=xe;(A==="road"&&!k||A==="offset")&&(Wt=ue),ot.draw(c,Oe,Wt,s||c.stencilModeForClipping(it),S,mi.disabled,Ae,_.id,Xe.layoutVertexBuffer,Ge,nt,_.paint,c.transform.zoom,ke,ut)}};c.renderPass===L&&Te(c.depthModeForSublayer(1,c.renderPass==="opaque"?Xt.ReadWrite:Xt.ReadOnly),!1),W==="none"&&c.renderPass==="translucent"&&_.paint.get("fill-antialias")&&Te(c.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,Xt.ReadOnly),!0)}function es(l,t,s,c,m,_,v,S){s.resetLayerRenderingStats(l);const A=l.context,k=A.gl,L=l.transform,B=s.paint.get("fill-extrusion-pattern"),O=s.paint.get("fill-extrusion-pattern-cross-fade"),j=B.constantOr(null),X=B.constantOr(1),W=s.paint.get("fill-extrusion-opacity"),Y=l.style.enable3dLights(),J=s.paint.get(Y&&!X?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ie=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),J],ue=s.layout.get("fill-extrusion-edge-radius"),pe=ue>0&&!s.paint.get("fill-extrusion-rounded-roof"),be=pe?0:ue,Te=L.projection.name==="globe"?r.dV():0,xe=L.projection.name==="globe",me=xe?r.ah(L.zoom):0,Ee=[r.aD(L.center.lng),r.aH(L.center.lat)],Ae=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Oe=s.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ae?null:s.lut).toArray01().slice(0,3),Ge=s.paint.get("fill-extrusion-flood-light-intensity"),nt=s.paint.get("fill-extrusion-vertical-scale"),it=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ht=s.paint.get("fill-extrusion-height-alignment"),Be=s.paint.get("fill-extrusion-base-alignment"),Xe=xo(l,s.paint.get("fill-extrusion-cutoff-fade-range")),ke=[];let st;xe&&ke.push("PROJECTION_GLOBE_VIEW"),ie[0]>0&&ke.push("FAUX_AO"),pe&&ke.push("ZERO_ROOF_RADIUS"),S&&ke.push("HAS_CENTROID"),Ge>0&&ke.push("FLOOD_LIGHT"),Xe.shouldRenderCutoff&&ke.push("RENDER_CUTOFF"),it&&ke.push("RENDER_WALL_MODE");const We=l.renderPass==="shadow",ut=l.shadowRenderer,Et=We&&!!ut,ot=We?mi.disabled:mi.backCCW;l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!0);let yt=[0,0,0];if(ut){const Ot=l.style.directionalLight,Zt=l.style.ambientLight;Ot&&Zt&&(yt=al(l.style,Ot,Zt)),We||(ke.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ut.useNormalOffset&&ke.push("NORMAL_OFFSET")),st=ke.concat(["SHADOWS_SINGLE_CASCADE"])}const jt=Et?"fillExtrusionDepth":X?"fillExtrusionPattern":"fillExtrusion",Wt=s.getLayerRenderingStats();for(const Ot of c){const Zt=t.getTile(Ot),ai=Zt.getBucket(s);if(!ai||ai.projection.name!==L.projection.name)continue;let ui=!1;ut&&(ui=ut.getMaxCascadeForTile(Ot.toUnwrapped())===0);const wi=l.isTileAffectedByFog(Ot),Ni=ai.programConfigurations.get(s.id);let cn=!1;if(j&&Zt.imageAtlas){const Yi=Zt.imageAtlas,Gn=r.dN.from(j),Cr=Gn.getPrimary().scaleSelf(r.q.devicePixelRatio).toString(),Hn=Gn.getSecondary(),wn=Yi.patternPositions.get(Cr),pr=Hn?Yi.patternPositions.get(Hn.scaleSelf(r.q.devicePixelRatio).toString()):null;cn=!!wn&&!!pr,wn&&Ni.setConstantPatternPositions(wn,pr)}O>0&&(cn||Ni.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&ke.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Un=l.getOrCreateProgram(jt,{config:Ni,defines:ui?st:ke,overrideFog:wi});if(l.terrain&&l.terrain.setupElevationDraw(Zt,Un,{useMeterToDem:!0}),!ai.centroidVertexBuffer){const Yi=Un.attributes.a_centroid_pos;Yi!==void 0&&k.vertexAttrib2f(Yi,0,0)}!We&&ut&&ut.setupShadows(Zt.tileID.toUnwrapped(),Un,"vector-tile",Zt.tileID.overscaledZ),X&&(l.context.activeTexture.set(k.TEXTURE0),Zt.imageAtlasTexture&&Zt.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Ni.updatePaintBuffers());const En=s.paint.get("fill-extrusion-vertical-gradient"),yn=1/ai.tileToMeter;let _r;if(We&&ut){if(Oa(Zt.tileID,ai,l))continue;const Yi=ut.calculateShadowPassMatrixFromTile(Zt.tileID.toUnwrapped());_r=Ff(Yi,be,yn,nt,ht,Be)}else{const Yi=l.translatePosMatrix(Ot.expandedProjMatrix,Zt,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Gn=L.projection.createInversionMatrix(L,Ot.canonical);_r=X?Mp(Yi,l,En,W,ie,be,yn,Ot,Zt,Te,ht,Be,me,Ee,Gn,Oe,nt,O):Uc(Yi,l,En,W,ie,be,yn,Ot,Te,ht,Be,me,Ee,Gn,Oe,nt,Ge,yt)}l.uploadCommonUniforms(A,Un,Ot.toUnwrapped(),null,Xe);let Ii=ai.segments;if(L.projection.name==="mercator"&&!We&&(Ii=ai.getVisibleSegments(Zt.tileID,l.terrain,l.transform.getFrustum(0)),!Ii.get().length))continue;if(Wt)if(We)for(const Yi of Ii.get())Wt.numRenderedVerticesInShadowPass+=Yi.primitiveLength;else for(const Yi of Ii.get())Wt.numRenderedVerticesInTransparentPass+=Yi.primitiveLength;const Bi=[];(l.terrain||S)&&Bi.push(ai.centroidVertexBuffer),xe&&Bi.push(ai.layoutVertexExtBuffer),it&&Bi.push(ai.wallVertexBuffer),Un.draw(l,A.gl.TRIANGLES,m,_,v,ot,_r,s.id,ai.layoutVertexBuffer,ai.indexBuffer,Ii,s.paint,l.transform.zoom,Ni,Bi)}l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!1)}function oo(l,t,s,c,m,_,v,S,A,k,L,B,O,j,X,W,Y,J,ie){const ue=l.context,pe=ue.gl,be=l.transform,Te=l.transform.zoom,xe=[],me=xo(l,s.paint.get("fill-extrusion-cutoff-fade-range"));k==="clear"?(xe.push("CLEAR_SUBPASS"),ie&&(xe.push("CLEAR_FROM_TEXTURE"),ue.activeTexture.set(pe.TEXTURE0),ie.bind(pe.LINEAR,pe.CLAMP_TO_EDGE))):k==="sdf"&&xe.push("SDF_SUBPASS"),Y&&xe.push("HAS_CENTROID"),me.shouldRenderCutoff&&xe.push("RENDER_CUTOFF");const Ee=s.layout.get("fill-extrusion-edge-radius"),Ae=(Oe,Ge,nt,it,ht)=>{const Be=Ge.programConfigurations.get(s.id),Xe=l.isTileAffectedByFog(Oe),ke=l.getOrCreateProgram("fillExtrusionGroundEffect",{config:Be,defines:xe,overrideFog:Xe}),st=((ut,Et,ot,yt,jt,Wt,Ot,Zt,ai,ui,wi)=>({u_matrix:Et,u_opacity:ot,u_ao_pass:yt?1:0,u_meter_to_tile:jt,u_ao:Wt,u_flood_light_intensity:Ot,u_flood_light_color:Zt,u_attenuation:ai,u_edge_radius:ui,u_fb:0,u_fb_size:wi,u_dynamic_offset:1}))(0,it,L,A,ht,[B,O*ht],j,X,W,Te>=17?0:Ee*ht,ie?ie.size[0]:0),We=[];Y&&We.push(Ge.hiddenByLandmarkVertexBuffer),l.uploadCommonUniforms(ue,ke,Oe.toUnwrapped(),null,me),ke.draw(l,ue.gl.TRIANGLES,m,_,v,S,st,s.id,Ge.vertexBuffer,Ge.indexBuffer,nt,s.paint,Te,Be,We)};for(const Oe of c){const Ge=t.getTile(Oe),nt=Ge.getBucket(s);if(!nt||nt.projection.name!==be.projection.name||!nt.groundEffect||nt.groundEffect&&!nt.groundEffect.hasData())continue;const it=nt.groundEffect,ht=1/nt.tileToMeter;{const Be=l.translatePosMatrix(Oe.projMatrix,Ge,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Xe=it.getDefaultSegment();Ae(Oe,it,Xe,Be,ht)}if(J)for(let Be=0;Be<4;Be++){const Xe=r.dT[Be](Oe),ke=t.getTile(Xe);if(!ke)continue;const st=ke.getBucket(s);if(!st||st.projection.name!==be.projection.name||!st.groundEffect||st.groundEffect&&!st.groundEffect.hasData())continue;const We=st.groundEffect;let ut,Et;Be===0?(ut=[-8192,0,0],Et=1):Be===1?(ut=[r.aj,0,0],Et=0):Be===2?(ut=[0,-8192,0],Et=3):(ut=[0,r.aj,0],Et=2);const ot=We.regionSegments[Et];if(!ot)continue;const yt=new Float32Array(16);r.bo(yt,Oe.projMatrix,ut),Ae(Oe,We,ot,l.translatePosMatrix(yt,Ge,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),ht)}}}function qt(l,t,s,c,m,_,v){c.centroidVertexArray.length===0&&c.createCentroidsBuffer();const S=_?_.findDEMTileFor(s):null;if(!(S&&S.dem||v))return;_&&S&&S.dem&&c.selfDEMTileTimestamp!==S.dem._timestamp&&(c.borderDoneWithNeighborZ=[-1,-1,-1,-1],c.selfDEMTileTimestamp=S.dem._timestamp);const A=J=>new r.P(Math.ceil((J+r.dX)*r.dY),0),k=J=>{const ie=t.getSource().minzoom,ue=be=>{const Te=t.getTileByID(be);if(Te&&Te.hasData())return Te.getBucket(m)},pe=[0,-1,1];for(const be of pe){if(J.overscaledZ+be<ie)continue;const Te=ue(J.calculateScaledKey(J.overscaledZ+be));if(Te)return Te}},L=[0,0,0],B=(J,ie)=>(L[0]=Math.min(J.min.y,ie.min.y),L[1]=Math.max(J.max.y,ie.max.y),L[2]=r.aj-ie.min.x>J.max.x?ie.min.x-r.aj:J.max.x,L),O=(J,ie)=>(L[0]=Math.min(J.min.x,ie.min.x),L[1]=Math.max(J.max.x,ie.max.x),L[2]=r.aj-ie.min.y>J.max.y?ie.min.y-r.aj:J.max.y,L),j=[(J,ie)=>B(J,ie),(J,ie)=>B(ie,J),(J,ie)=>O(J,ie),(J,ie)=>O(ie,J)],X=(J,ie,ue,pe,be,Te,xe)=>{if(!_)return 0;const me=[[Te?ue:J,Te?J:ue,0],[Te?ue:ie,Te?ie:ue,0]],Ee=xe<0?r.aj+xe:xe,Ae=[Te?Ee:(J+ie)/2,Te?(J+ie)/2:Ee,0];return ue===0&&xe<0||ue!==0&&xe>0?_.getForTilePoints(be,[Ae],!0,pe):me.push(Ae),_.getForTilePoints(s,me,!0,S),Math.max(me[0][2],me[1][2],Ae[2])/_.exaggeration()};for(let J=0;J<4;J++){const ie=c.borderFeatureIndices[J];if(ie.length===0)continue;const ue=r.dT[J](s),pe=k(ue);if(!(pe&&pe instanceof r.dU))continue;const be=_?_.findDEMTileFor(ue):null;if(!(be&&be.dem||v)||(_&&be&&be.dem&&c.borderDEMTileTimestamp[J]!==be.dem._timestamp&&(c.borderDoneWithNeighborZ[J]=-1,c.borderDEMTileTimestamp[J]=be.dem._timestamp),c.borderDoneWithNeighborZ[J]===pe.canonical.z))continue;pe.centroidVertexArray.length===0&&pe.createCentroidsBuffer();const Te=(J<2?1:5)-J,xe=pe.borderDoneWithNeighborZ[Te]!==c.canonical.z,me=pe.borderFeatureIndices[Te];let Ee=0;if(c.canonical.z!==pe.canonical.z){for(const Ae of ie)c.showCentroid(c.featuresOnBorder[Ae]);if(xe)for(const Ae of me)pe.showCentroid(pe.featuresOnBorder[Ae]);c.borderDoneWithNeighborZ[J]=pe.canonical.z,pe.borderDoneWithNeighborZ[Te]=c.canonical.z}for(const Ae of ie){const Oe=c.featuresOnBorder[Ae],Ge=c.centroidData[Oe.centroidDataIndex],nt=Oe.borders[J];let it;for(;Ee<me.length;){it=pe.featuresOnBorder[me[Ee]];const ht=it.borders[Te];if(ht[1]>nt[0]+3||ht[0]>nt[0]-3)break;pe.showCentroid(it),Ee++}if(it&&Ee<me.length){const ht=Ee;let Be=0;for(;!(it.borders[Te][0]>nt[1]-3)&&(Be++,++Ee!==me.length);)it=pe.featuresOnBorder[me[Ee]];it=pe.featuresOnBorder[me[ht]];let Xe=!1;if(Be>=1){const We=it.borders[Te];Math.abs(nt[0]-We[0])<3&&Math.abs(nt[1]-We[1])<3&&(Be=1,Xe=!0,Ee=ht+1)}else if(Be===0){c.showCentroid(Oe);continue}const ke=pe.centroidData[it.centroidDataIndex];v&&Xe&&(((W=Ge).flags|(Y=ke).flags)&r.dW?(W.flags|=r.dW,Y.flags|=r.dW):(W.flags&=2147483647,Y.flags&=2147483647));const st=Oe.intersectsCount()>1||it.intersectsCount()>1;if(Be>1)Ee=ht,Ge.centroidXY=ke.centroidXY=new r.P(0,0);else if(be&&be.dem&&!st){const We=j[J](Ge,ke),ut=J%2?r.aj-1:0,Et=X(We[0],Math.min(r.aj-1,We[1]),ut,be,ue,J<2,We[2]);Ge.centroidXY=ke.centroidXY=A(Et)}else st?Ge.centroidXY=ke.centroidXY=new r.P(0,0):(Ge.centroidXY=c.encodeBorderCentroid(Oe),ke.centroidXY=pe.encodeBorderCentroid(it));c.writeCentroidToBuffer(Ge),pe.writeCentroidToBuffer(ke)}else c.showCentroid(Oe)}c.borderDoneWithNeighborZ[J]=pe.canonical.z,pe.borderDoneWithNeighborZ[Te]=c.canonical.z}var W,Y;(c.needsCentroidUpdate||!c.centroidVertexBuffer&&c.centroidVertexArray.length!==0)&&c.uploadCentroid(l)}const Nf=[1,0,0],Fa=[0,1,0],ao=[0,0,1];function Oa(l,t,s){const c=s.transform,m=s.shadowRenderer;if(!m)return!0;const _=l.toUnwrapped(),v=c.tileSize*m._cascades[s.currentShadowCascade].scale;let S=t.maxHeight;if(c.elevation){const W=c.elevation.getMinMaxForTile(l);W&&(S+=W.max)}const A=[...m.shadowDirection];A[2]=-A[2];const k=m.computeSimplifiedTileShadowVolume(_,S,v,A);if(!k)return!1;const L=[Nf,Fa,ao,A,[A[0],0,A[2]],[0,A[1],A[2]]],B=c.projection.name==="globe",O=c.scaleZoom(v),j=r.cn.fromInvProjectionMatrix(c.invProjMatrix,c.worldSize,O,!B),X=m.getCurrentCascadeFrustum();return j.intersectsPrecise(k.vertices,k.planes,L)===0||X.intersectsPrecise(k.vertices,k.planes,L)===0}function fi(l){return[l[0]*r.dZ,l[1]*r.dZ,l[2]*r.dZ,0]}function No(l,t,s,c,m,_,v,S,A){const k=c.getSource(),L=s.globeSharedBuffers;if(!L)return;let B,O,j;if(t&&(B=c.getTile(t)),k instanceof r.aP?(O=k.texture,j=r.ds(0,0,s.transform)):B&&t&&(O=B.texture,j=r.ds(t.canonical.z,t.canonical.x,s.transform)),!O||!j)return;l||(j=r.cE(r.bz(),j,[1,-1,1]));const X=s.context,W=X.gl,Y=m.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR,J=s.colorModeForDrapableLayerRenderPass(_),ie=v.defines;ie.push("GLOBE_POLES");const ue=new Xt(W.LEQUAL,Xt.ReadWrite,s.depthRangeFor3D),pe=Float32Array.from(s.transform.expandedFarZProjMatrix),be=Float32Array.from(r.bh(r.dr(new r.cp(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),X.activeTexture.set(W.TEXTURE0),O.bind(Y,W.CLAMP_TO_EDGE),X.activeTexture.set(W.TEXTURE1),O.bind(Y,W.CLAMP_TO_EDGE),"useMipmap"in O&&X.extTextureFilterAnisotropic&&s.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax);const[Te,xe,me,Ee]=t?L.getPoleBuffers(t.canonical.z,!1):L.getPoleBuffers(0,!0),Ae=m.paint.get("raster-elevation");let Oe;l?(Oe=Te,s.renderDefaultNorthPole=Ae!==0):(Oe=xe,s.renderDefaultSouthPole=Ae!==0);const Ge=fi(v.mix),nt=((ht,Be,Xe,ke,st,We,ut,Et,ot,yt,jt,Wt,Ot)=>Dh(ht,Be,Xe,new Float32Array(16),new Float32Array(9),[0,0],ke,[0,0],[0,0,0,0],1,{opacity:1,mix:0},We,[0,0],Et,2,yt,jt,Wt,1,0,Ot))(pe,be,j,r.ah(s.transform.zoom),0,m,0,Ae,0,Ge,v.offset,v.range,_),it=s.getOrCreateProgram("raster",{defines:ie});s.uploadCommonUniforms(X,it,null),it.draw(s,W.TRIANGLES,ue,A,J,S,nt,m.id,Oe,me,Ee)}function rc(l){const t=l._nearZ,s=l.projection.farthestPixelDistance(l),c=s-t,m=.2*l.height,_=t+m;return[t,s,(_-m-t)/c,(_-t)/c]}function Bd(l,t,s,c){if(l)return t instanceof Dl&&l instanceof Tc?t.getTextureDescriptor(l,s,!0):{texture:l.texture,mix:fi(c.mix),offset:c.offset,buffer:0,tileSize:1}}var jd=r.d_([{name:"a_index",type:"Int16",components:1}]);class Bh{constructor(t,s,c,m){const _={width:c[0],height:c[1],data:null},v=t.gl;this.targetColorTexture=new r.T(t,_,v.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(t,_,v.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(s,m),this.lastInvalidatedAt=0}updateParticleTexture(t,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const c=this.context.gl,m=s.width*s.height;this.particleTexture0=new r.T(this.context,s,c.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,s,c.RGBA8,{premultiply:!1,useMipmap:!1});const _=new r.d$;_.reserve(m);for(let v=0;v<m;v++)_.emplaceBack(v);this.particleIndexBuffer=this.context.createVertexBuffer(_,jd.members,!0),this.particleSegment=r.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=r.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function kp(l,t,s){if(!l)return null;const c=t.getTextureDescriptor(l,s,!0);if(!c)return null;let{texture:m,mix:_,offset:v,tileSize:S,buffer:A,format:k}=c;if(!m||!k)return null;let L=!1;return k==="uint32"&&(L=!0,_[3]=0,_=Oo(r.e0,_,[0,s.paint.get("raster-particle-max-speed")]),v=Od(r.e0,v,[0,s.paint.get("raster-particle-max-speed")])),{texture:m,textureOffset:[A/(S+2*A),S/(S+2*A)],tileSize:S,scalarData:L,scale:_,offset:v,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[k]]}}function $u(l){const t=l._nearZ,s=l.projection.farthestPixelDistance(l),c=s-t,m=.2*l.height,_=t+m;return[t,s,(_-m-t)/c,(_-t)/c]}const Na=new r.am(1,0,0,1),jh=new r.am(0,1,0,1),Cs=new r.am(0,0,1,1),dl=new r.am(1,0,1,1),As=new r.am(0,1,1,1);function So(l,t,s,c,m,_){for(let v=0;v<s.length;v++)if(m){const k=new r.am(c.r*.8,c.g*.8,c.b*.8,1);sc(l,t,s[v],c,-1,-1,_),sc(l,t,s[v],c,-1,1,_),sc(l,t,s[v],c,1,1,_),sc(l,t,s[v],c,1,-1,_),sc(l,t,s[v],k,0,0,_)}else sc(l,t,s[v],c,0,0,_)}function sc(l,t,s,c,m,_,v){const S=l.context,A=l.transform,k=S.gl,L=A.projection.name==="globe",B=L?["PROJECTION_GLOBE_VIEW"]:[];let O=r.bw(s.projMatrix);if(L&&r.ah(A.zoom)>0){const Ge=r.bg(s.canonical,A),nt=r.e1(Ge);O=r.az(new Float32Array(16),A.globeMatrix,nt),r.az(O,A.projMatrix,O)}const j=r.bz();j[12]+=2*m/(r.q.devicePixelRatio*A.width),j[13]+=2*_/(r.q.devicePixelRatio*A.height),r.az(O,j,O);const X=l.getOrCreateProgram("debug",{defines:B}),W=t.getTileByID(s.key);l.terrain&&l.terrain.setupElevationDraw(W,X);const Y=Xt.disabled,J=vi.disabled,ie=l.colorModeForRenderPass(),ue="$debug";S.activeTexture.set(k.TEXTURE0),l.emptyTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),L?W._makeGlobeTileDebugBuffers(l.context,A):W._makeDebugTileBoundsBuffers(l.context,A.projection);const pe=W._tileDebugBuffer||l.debugBuffer,be=W._tileDebugIndexBuffer||l.debugIndexBuffer,Te=W._tileDebugSegments||l.debugSegments;if(X.draw(l,k.LINE_STRIP,Y,J,ie,mi.disabled,Da(O,c.toPremultipliedRenderColor(null)),ue,pe,be,Te,null,null,null,[W._globeTileDebugBorderBuffer]),v){const Ge=W.latestRawTileData,nt=Math.floor((Ge&&Ge.byteLength||0)/1024);let it=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(it+=` => ${s.overscaledZ}`),it+=` ${W.state}`,it+=` ${nt}kb`,function(ht,Be){ht.initDebugOverlayCanvas();const Xe=ht.debugOverlayCanvas,ke=ht.context.gl,st=ht.debugOverlayCanvas.getContext("2d");st.clearRect(0,0,Xe.width,Xe.height),st.shadowColor="white",st.shadowBlur=2,st.lineWidth=1.5,st.strokeStyle="white",st.textBaseline="top",st.font="bold 36px Open Sans, sans-serif",st.fillText(Be,5,5),st.strokeText(Be,5,5),ht.debugOverlayTexture.update(Xe),ht.debugOverlayTexture.bind(ke.LINEAR,ke.CLAMP_TO_EDGE)}(l,it)}const xe=t.getTile(s).tileSize,me=512/Math.min(xe,512)*(s.overscaledZ/A.zoom)*.5,Ee=W._tileDebugTextBuffer||l.debugBuffer,Ae=W._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,Oe=W._tileDebugTextSegments||l.debugSegments;X.draw(l,k.TRIANGLES,Y,J,Wi.alphaBlended,mi.disabled,Da(O,r.am.transparent.toPremultipliedRenderColor(null),me),ue,Ee,Ae,Oe,null,null,null,[W._globeTileDebugTextBuffer])}function Hu(l,t,s,c){fl(l,0,t+s/2,l.transform.width,s,c)}function Rr(l,t,s,c){fl(l,t-s/2,0,s,l.transform.height,c)}function fl(l,t,s,c,m,_){const v=l.context,S=v.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*r.q.devicePixelRatio,s*r.q.devicePixelRatio,c*r.q.devicePixelRatio,m*r.q.devicePixelRatio),v.clear({color:_}),S.disable(S.SCISSOR_TEST)}const Vd=r.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ca}=Vd;function Pn(l,t,s,c){l.emplaceBack(t,s,c)}class qc{constructor(t){this.vertexArray=new r.e2,this.indices=new r.a_,Pn(this.vertexArray,-1,-1,1),Pn(this.vertexArray,1,-1,1),Pn(this.vertexArray,-1,1,1),Pn(this.vertexArray,1,1,1),Pn(this.vertexArray,-1,-1,-1),Pn(this.vertexArray,1,-1,-1),Pn(this.vertexArray,-1,1,-1),Pn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ca),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=r.bd.simpleSegment(0,0,36,12)}}function Eo(l,t,s,c,m,_){const v=l.context.gl,S=t.paint.get("sky-atmosphere-color"),A=t.paint.get("sky-atmosphere-halo-color"),k=t.paint.get("sky-atmosphere-sun-intensity"),L=((B,O,j,X,W)=>({u_matrix_3f:B,u_sun_direction:O,u_sun_intensity:j,u_color_tint_r:[X.r,X.g,X.b,X.a],u_color_tint_m:[W.r,W.g,W.b,W.a],u_luminance:5e-5}))(r.e4(r.dx(),c),m,k,S.toPremultipliedRenderColor(null),A.toPremultipliedRenderColor(null));v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+_,t.skyboxTexture,0),s.draw(l,v.TRIANGLES,Xt.disabled,vi.disabled,Wi.unblended,mi.frontCW,L,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Fr=r.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ts{constructor(t){const s=new r.e5;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const c=new r.a_;c.emplaceBack(0,1,2),c.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(s,Fr.members),this.indexBuffer=t.createIndexBuffer(c),this.segments=r.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ms=r.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ud{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ba{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Wi([1,Pc,1,Pc],r.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Wi([1,0,1,0],r.am.transparent,[!1,!1,!1,!0]),this.params=new Ud,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const s=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ts(s);const c=this.params.sizeRange,m=this.params.intensityRange,_=function(L){const B=r.e7(30),O=[];for(let j=0;j<L;++j){const X=2*Math.PI*B(),W=Math.acos(1-2*B())-.5*Math.PI;O.push(r.cS(Math.cos(W)*Math.cos(X),Math.cos(W)*Math.sin(X),Math.sin(W)))}return O}(this.params.starsCount),v=r.e7(300),S=new r.e6,A=new r.a_;let k=0;for(let L=0;L<_.length;++L){const B=r.bY([],_[L],200),O=Math.max(0,1+.01*c*(1*v()-.5)),j=Math.max(0,1+.01*m*(1*v()-.5));S.emplaceBack(B[0],B[1],B[2],-1,-1,O,j),S.emplaceBack(B[0],B[1],B[2],1,-1,O,j),S.emplaceBack(B[0],B[1],B[2],1,1,O,j),S.emplaceBack(B[0],B[1],B[2],-1,1,O,j),A.emplaceBack(k+0,k+1,k+2),A.emplaceBack(k+0,k+2,k+3),k+=4}this.starsVx=s.createVertexBuffer(S,ms.members),this.starsIdx=s.createIndexBuffer(A),this.starsSegments=r.bd.simpleSegment(0,0,S.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,s){const c=t.context,m=c.gl,_=t.transform,v=new Xt(m.LEQUAL,Xt.ReadOnly,[0,1]),S=r.ah(_.zoom),A=t.style.getLut(s.scope),k=s.properties.get("color-use-theme")==="none",L=s.properties.get("color").toNonPremultipliedRenderColor(k?null:A).toArray01(),B=s.properties.get("high-color-use-theme")==="none",O=s.properties.get("high-color").toNonPremultipliedRenderColor(B?null:A).toArray01(),j=s.properties.get("space-color-use-theme")==="none",X=s.properties.get("space-color").toNonPremultipliedRenderColor(j?null:A).toArray01(),W=5e-4,Y=r.e8(s.properties.get("horizon-blend"),0,1,W,.25),J=r.dl(t,c,_)&&Y===W?_.worldSize/(2*Math.PI*1.025)-1:_.globeRadius,ie=t.frameCounter/1e3%1,ue=r.ae(_.globeCenterInViewSpace),pe=Math.sqrt(Math.pow(ue,2)-Math.pow(J,2)),be=Math.acos(pe/ue),Te=xe=>{const me=_.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];xe&&me.push("ALPHA_PASS");const Ee=t.getOrCreateProgram("globeAtmosphere",{defines:me}),Ae=((Ge,nt,it,ht,Be,Xe,ke,st,We,ut,Et,ot)=>({u_frustum_tl:Ge,u_frustum_tr:nt,u_frustum_br:it,u_frustum_bl:ht,u_horizon:Be,u_transition:Xe,u_fadeout_range:ke,u_color:st,u_high_color:We,u_space_color:ut,u_temporal_offset:Et,u_horizon_angle:ot}))(_.frustumCorners.TL,_.frustumCorners.TR,_.frustumCorners.BR,_.frustumCorners.BL,_.frustumCorners.horizon,S,Y,L,O,X,ie,be);t.uploadCommonUniforms(c,Ee);const Oe=this.atmosphereBuffer;Oe&&Ee.draw(t,m.TRIANGLES,v,vi.disabled,xe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,mi.backCW,Ae,xe?"atmosphere_glow_alpha":"atmosphere_glow",Oe.vertexBuffer,Oe.indexBuffer,Oe.segments)};Te(!1),Te(!0)}drawStars(t,s){const c=r.ay(s.properties.get("star-intensity"),0,1);if(c===0)return;const m=t.context,_=m.gl,v=t.transform,S=t.getOrCreateProgram("stars"),A=r.b_([]);r.c0(A,A,-v._pitch),r.b$(A,A,-v.angle),r.c0(A,A,r.al(v._center.lat)),r.e9(A,A,-r.al(v._center.lng));const k=r.c3(new Float32Array(16),A),L=r.az([],v.starsProjMatrix,k),B=r.e4([],k),O=r.ea([],B),j=[0,1,0];r.dz(j,j,O),r.bY(j,j,this.params.sizeMultiplier);const X=[1,0,0];r.dz(X,X,O),r.bY(X,X,this.params.sizeMultiplier);const W=(Y=j,J=X,ie=c,{u_matrix:Float32Array.from(L),u_up:Y,u_right:J,u_intensity_multiplier:ie});var Y,J,ie;t.uploadCommonUniforms(m,S),this.starsVx&&this.starsIdx&&S.draw(t,_.TRIANGLES,Xt.disabled,vi.disabled,this.colorModeAlphaBlendedWriteRGB,mi.disabled,W,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function ua(l,t){const s=[...l],c=t.cameraWorldSizeForFog/t.worldSize,m=r.bx([]);return r.cE(m,m,[c,c,1]),r.az(s,m,s),r.az(s,t.worldToFogMatrix,s),s}function wt(l,t,s,c,m){const _=s.material,v=c.context,{baseColorTexture:S,metallicRoughnessTexture:A}=_.pbrMetallicRoughness,{normalTexture:k,occlusionTexture:L,emissionTexture:B}=_;function O(X,W,Y){if(X&&(l.push(W),v.activeTexture.set(v.gl.TEXTURE0+Y),X.gfxTexture)){const{minFilter:J,magFilter:ie,wrapS:ue,wrapT:pe}=X.sampler;X.gfxTexture.bindExtraParam(J,ie,ue,pe)}}O(S,"HAS_TEXTURE_u_baseColorTexture",Hs.BaseColor),O(A,"HAS_TEXTURE_u_metallicRoughnessTexture",Hs.MetallicRoughness),O(k,"HAS_TEXTURE_u_normalTexture",Hs.Normal),O(L,"HAS_TEXTURE_u_occlusionTexture",Hs.Occlusion),O(B,"HAS_TEXTURE_u_emissionTexture",Hs.Emission),m&&(m.texture||(m.texture=new r.eh(c.context,m.image,[m.image.height,m.image.height,m.image.height],v.gl.RGBA8)),v.activeTexture.set(v.gl.TEXTURE0+Hs.LUT),m.texture&&m.texture.bind(v.gl.LINEAR,v.gl.CLAMP_TO_EDGE),l.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(l.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(s.texcoordBuffer)),s.colorBuffer&&(l.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(s.colorBuffer)),s.normalBuffer&&(l.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(s.normalBuffer)),s.pbrBuffer&&(l.push("HAS_ATTRIBUTE_a_pbr"),l.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(s.pbrBuffer)),_.alphaMode!=="OPAQUE"&&_.alphaMode!=="MASK"||l.push("UNPREMULT_TEXTURE_IN_SHADER"),_.defined||l.push("DIFFUSE_SHADED");const j=c.shadowRenderer;j&&(l.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&l.push("NORMAL_OFFSET"))}function kt(l,t,s,c,m,_){const v=s.paint.get("model-opacity").constantOr(1),S=t.context,A=new Xt(t.context.gl.LEQUAL,Xt.ReadWrite,t.depthRangeFor3D),k=t.transform,L=l.mesh,B=L.material,O=B.pbrMetallicRoughness,j=t.style.fog;let X;X=t.transform.projection.zAxisUnit==="pixels"?[...l.nodeModelMatrix]:r.az([],c.zScaleMatrix,l.nodeModelMatrix),r.az(X,c.negCameraPosMatrix,X);const W=r.bi([],X);r.ee(W,W);const Y=s.paint.get("model-color-use-theme").constantOr("default")==="none",J=s.paint.get("model-emissive-strength").constantOr(0),ie=Jl(new Float32Array(l.worldViewProjection),new Float32Array(X),new Float32Array(W),null,t,v,O.baseColorFactor,B.emissiveFactor,O.metallicFactor,O.roughnessFactor,B,J,s),ue={defines:[]},pe=[],be=t.shadowRenderer;be&&(be.useNormalOffset=!1),wt(ue.defines,pe,L,t,Y?null:s.lut);let Te=null;if(j){const Ee=ua(l.nodeModelMatrix,t.transform);if(Te=new Float32Array(Ee),k.projection.name!=="globe"){const Ae=L.aabb.min,Oe=L.aabb.max,[Ge,nt]=j.getOpacityForBounds(Ee,Ae[0],Ae[1],Oe[0],Oe[1]);ue.overrideFog=Ge>=Ze||nt>=Ze}}const xe=xo(t,s.paint.get("model-cutoff-fade-range"));xe.shouldRenderCutoff&&ue.defines.push("RENDER_CUTOFF");const me=t.getOrCreateProgram("model",ue);t.uploadCommonUniforms(S,me,null,Te,xe),t.renderPass!=="shadow"&&be&&be.setupShadowsFromMatrix(l.nodeModelMatrix,me),me.draw(t,S.gl.TRIANGLES,A,m,_,L.material.doubleSided?mi.disabled:mi.backCCW,ie,s.id,L.vertexBuffer,L.indexBuffer,L.segments,s.paint,t.transform.zoom,void 0,pe)}function pl(l,t,s,c,m,_,v){let S;S=l.projection.name==="globe"?r.ed(s,l):[...s],r.az(S,S,t.matrix);const A=r.az([],c,S);if(t.meshes)for(const k of t.meshes){if(k.material.alphaMode!=="BLEND"){v.push({mesh:k,depth:0,modelIndex:m,worldViewProjection:A,nodeModelMatrix:S});continue}const L=r.ad([],k.centroid,A);!l.isOrthographic&&L[2]<=0||_.push({mesh:k,depth:L[2],modelIndex:m,worldViewProjection:A,nodeModelMatrix:S})}if(t.children)for(const k of t.children)pl(l,k,s,c,m,_,v)}function ur(l,t,s,c){const m=s.shadowRenderer;if(!m)return;const _=m.getShadowPassDepthMode(),v=m.getShadowPassColorMode(),S=m.calculateShadowPassMatrixFromMatrix(t),A=Of(S);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,_,vi.disabled,v,mi.backCCW,A,c.id,l.vertexBuffer,l.indexBuffer,l.segments,c.paint,s.transform.zoom,void 0,void 0)}function je(l,t,s){const c=t.updateZoomBasedPaintProperties(),m=function(_,v,S){let A,k,L,B=_.terrain?_.terrain.exaggeration():0;if(_.terrain&&B>0){const O=_.terrain,j=O.findDEMTileFor(S);j&&j.dem?A=r.ei.create(O,S,j):B=0}if(B===0&&(v.terrainElevationMin=0,v.terrainElevationMax=0),B===v.validForExaggeration&&(B===0||A&&A._demTile&&A._demTile.tileID===v.validForDEMTile.id&&A._dem._timestamp===v.validForDEMTile.timestamp))return!1;for(const O in v.instancesPerModel){const j=v.instancesPerModel[O];for(let X=0;X<j.instancedDataArray.length;++X){const W=(A?B*A.getElevationAt(0|j.instancedDataArray.float32[16*X],0|j.instancedDataArray.float32[16*X+1],!0,!0):0)+j.instancesEvaluatedElevation[X];j.instancedDataArray.float32[16*X+6]=W,k=k?Math.min(v.terrainElevationMin,W):W,L=L?Math.max(v.terrainElevationMax,W):W}}return v.terrainElevationMin=k||0,v.terrainElevationMax=L||0,v.validForExaggeration=B,v.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(l,t,s);(c||m)&&(t.uploaded=!1,t.upload(l.context))}const is={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.cW([0,0,0],[r.aj,r.aj,0])};function lo(l,t){const s=1<<l.canonical.z,c=t.getFreeCameraOptions().position,m=t.elevation,_=l.canonical.x/s,v=(l.canonical.x+1)/s,S=l.canonical.y/s,A=(l.canonical.y+1)/s;let k=t._centerAltitude;if(m){const j=m.getMinMaxForTile(l);j&&j.max>k&&(k=j.max)}const L=r.ay(c.x,_,v)-c.x,B=r.ay(c.y,S,A)-c.y,O=r.c6(k,t.center.lat)-c.z;return t._zoomFromMercatorZ(Math.sqrt(L*L+B*B+O*O))}function oc(l,t,s,c,m,_,v){const S=l.context,A=l.renderPass==="shadow",k=l.shadowRenderer,L=A&&k?k.getShadowPassDepthMode():new Xt(S.gl.LEQUAL,Xt.ReadWrite,l.depthRangeFor3D),B=l.isTileAffectedByFog(_);if(s.meshes)for(const O of s.meshes){const j=["MODEL_POSITION_ON_GPU"],X=[];let W,Y,J;c.instancedDataArray.length>20&&j.push("INSTANCED_ARRAYS");const ie=xo(l,t.paint.get("model-cutoff-fade-range"));if(ie.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),A&&k)W=l.getOrCreateProgram("modelDepth",{defines:j}),Y=Of(v.shadowTileMatrix,v.shadowTileMatrix,Float32Array.from(s.matrix)),J=k.getShadowPassColorMode();else{wt(j,X,O,l,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),W=l.getOrCreateProgram("model",{defines:j,overrideFog:B});const pe=O.material,be=pe.pbrMetallicRoughness,Te=t.paint.get("model-opacity").constantOr(1),xe=t.paint.get("model-emissive-strength").constantOr(0);Y=Jl(_.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),null,l,Te,be.baseColorFactor,pe.emissiveFactor,be.metallicFactor,be.roughnessFactor,pe,xe,t,m),k&&(v.shadowUniformsInitialized?W.setShadowUniformValues(S,k.getShadowUniformValues()):(k.setupShadows(_.toUnwrapped(),W,"model-tile",_.overscaledZ),v.shadowUniformsInitialized=!0)),J=ie.shouldRenderCutoff||Te<1||pe.alphaMode!=="OPAQUE"?Wi.alphaBlended:Wi.unblended}l.uploadCommonUniforms(S,W,_.toUnwrapped(),null,ie);const ue=O.material.doubleSided?mi.disabled:mi.backCCW;if(c.instancedDataArray.length>20)X.push(c.instancedDataBuffer),W.draw(l,S.gl.TRIANGLES,L,vi.disabled,J,ue,Y,t.id,O.vertexBuffer,O.indexBuffer,O.segments,t.paint,l.transform.zoom,void 0,X,c.instancedDataArray.length);else{const pe=A?"u_instance":"u_normal_matrix";for(let be=0;be<c.instancedDataArray.length;++be)Y[pe]=new Float32Array(c.instancedDataArray.arrayBuffer,64*be,16),W.draw(l,S.gl.TRIANGLES,L,vi.disabled,J,ue,Y,t.id,O.vertexBuffer,O.indexBuffer,O.segments,t.paint,l.transform.zoom,void 0,X)}}if(s.children)for(const O of s.children)oc(l,t,O,c,m,_,v)}const Vh=[1,-1,1];function Gd(l,t,s,c){if(!s.modelManager)return!0;const m=s.modelManager;if(!s.shadowRenderer)return!0;const _=s.shadowRenderer,v=t.aabb;let S=!0,A=l.maxHeight;if(A===0){let L=0;for(const B in l.instancesPerModel){const O=m.getModel(B,c);O?L=Math.max(L,Math.max(Math.max(O.aabb.max[0],O.aabb.max[1]),O.aabb.max[2])):S=!1}A=l.maxScale*L*1.41+l.maxVerticalOffset,S&&(l.maxHeight=A)}v.max[2]=A,v.min[2]+=l.terrainElevationMin,v.max[2]+=l.terrainElevationMax,r.ad(v.min,v.min,t.tileMatrix),r.ad(v.max,v.max,t.tileMatrix);const k=v.intersects(_.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(l.isInsideFirstShadowMapFrustum=k===2),k===0}function Bf(l,t){const s=l.uniformValues.u_cutoff_params[0],c=l.uniformValues.u_cutoff_params[1],m=l.uniformValues.u_cutoff_params[2],_=l.uniformValues.u_cutoff_params[3];return c===s||_===m?1:r.ay(((t-s)/(c-s)-m)/(_-m),0,1)}function Zc(l,t,s,c){if(t.pitch<20)return 1;const m=t.getWorldToCameraMatrix();r.az(m,m,l);const _=r.ej(s.min[0],s.min[1],s.min[2],1);let v=r.aA(r.ek(),_,m),S=v,A=v;_[1]=s.max[1],v=r.aA(r.ek(),_,m),S=v[1]<S[1]?v:S,A=v[1]>A[1]?v:A,_[0]=s.max[0],v=r.aA(r.ek(),_,m),S=v[1]<S[1]?v:S,A=v[1]>A[1]?v:A,_[1]=s.min[1],v=r.aA(r.ek(),_,m),S=v[1]<S[1]?v:S,A=v[1]>A[1]?v:A;const k=r.ay(c[0],0,1),L=100*t.pixelsPerMeter*r.ay(c[1],0,1),B=r.ay(c[2],0,1),O=r.el(r.ek(),S,A,k),j=Math.tan(.5*t.fovX),X=-O[2]*j;if(L===0)return O[1]<-Math.abs(X)?B:1;const W=(-Math.abs(X)-O[1])/L,Y=(ie,ue,pe)=>(1-pe)*ie+pe*ue,J=r.ay(Y(1,B,W),B,1);return Y(1,J,r.ay((t.pitch-20)/20,0,1))}class Dp{}class Lp{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,s,c){{const B=this._storage.get(s.id);if(B)return B.lastUsedFrameIdx=t,B.buf}const m=c.gl,_=m.getBufferParameter(m.ELEMENT_ARRAY_BUFFER,m.BUFFER_SIZE),v=new ArrayBuffer(_),S=new Int16Array(v);m.getBufferSubData(m.ELEMENT_ARRAY_BUFFER,0,new Int16Array(v));const A=new r.en;for(let B=0;B<_/2;B+=3){const O=S[B],j=S[B+1],X=S[B+2];A.emplaceBack(O,j),A.emplaceBack(j,X),A.emplaceBack(X,O)}const k=c.bindVertexArrayOES.current,L=new Dp;return L.buf=new To(c,A),L.lastUsedFrameIdx=t,this._storage.set(s.id,L),c.bindVertexArrayOES.set(k),L.buf}update(t){for(const[s,c]of this._storage)t-c.lastUsedFrameIdx>30&&(c.buf.destroy(),this._storage.delete(s))}destroy(){for(const[t,s]of this._storage)s.buf.destroy(),this._storage.delete(t)}}class jf{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Uh=r.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class $d{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Hd{constructor(t,s){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...s,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...s,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Wu=r.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class Gh{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,s){const c=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const v=new r.eo,S=new r.a_;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(1,1),v.emplaceBack(-1,1),S.emplaceBack(0,1,2),S.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(v,Wu.members),this.vignetteIdx=t.context.createIndexBuffer(S)}const m=r.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,c);const v={u_vignetteShape:(_={vignetteShape:[s.start,s.range,Math.pow(10,s.fadePower)],vignetteColor:[s.color.r,s.color.g,s.color.b,s.color.a*s.strength]}).vignetteShape,u_vignetteColor:_.vignetteColor};c.draw(t,t.context.gl.TRIANGLES,Xt.disabled,vi.disabled,Wi.alphaBlended,mi.disabled,v,"vignette",this.vignetteVx,this.vignetteIdx,m)}var _}}class ac{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,s){const c=t.getFreeCameraOptions().position,m=c.toAltitude(),_=c.toLngLat(),v=r.al(_.lng),S=r.al(_.lat),A=t.pixelsPerMeter/s,k=v*r.eq,L=r.eq*Math.log(Math.tan(Math.PI/4+S/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const B=-this._offsetYPrev+L,O=-this._elevationPrev+m;this._accumulatedOffsetX+=(-this._offsetXPrev+k)*A,this._accumulatedOffsetY+=B*A,this._accumulatedElevation+=O*A,this._offsetXPrev=k,this._offsetYPrev=L,this._elevationPrev=m}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function ja(l,t){return[-(l[0]-Math.floor(l[0]/t)*t),-(l[1]-Math.floor(l[1]/t)*t),-(l[2]-Math.floor(l[2]/t)*t)]}function Wd(l){const t=r.e7(1323123451230),s=[];for(let c=0;c<l;++c){const m=2*t()-1,_=2*t()-1,v=2*t()-1;s.push(r.cS(m,_,v))}return s}function Va(l,t,s,c,m){const _=r.ay((m-s)/(c-s),0,1);return(1-_)*l+_*t}class Is{constructor(t){this._movement=new ac,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Gh,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,s){const c=t.transform;this._movement.update(c,this._ppmScaleFactor);const m=c.starsProjMatrix,_=r.b_([]);r.c0(_,_,r.al(90)-c._pitch),r.b$(_,_,-c.angle);const v=r.c3(new Float32Array(16),_),S=r.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),A=r.ee([],S),k=r.az([],A,v),L=Date.now()/1e3;return this._accumulatedTimeFromStart+=(L-this._prevTime)*s,this._prevTime=L,{projectionMatrix:m,modelviewMatrix:k}}}class zp extends Is{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Hd(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const c=Wd(this.particlesCount),m=new r.er,_=new r.a_;let v=0;const S=r.e7(1323123451230);for(let A=0;A<c.length;++A){const k=c[A],L=[2*S()-1,S(),S(),S()];m.emplaceBack(k[0],k[1],k[2],-1,-1,...L),m.emplaceBack(k[0],k[1],k[2],1,-1,...L),m.emplaceBack(k[0],k[1],k[2],1,1,...L),m.emplaceBack(k[0],k[1],k[2],-1,1,...L),_.emplaceBack(v+0,v+1,v+2),_.emplaceBack(v+0,v+2,v+3),v+=4}this.particlesVx=s.createVertexBuffer(m,Uh.members),this.particlesIdx=s.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const s=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},c=t.transform.zoom;if(s.revealStart>c)return;const m=Va(0,1,s.revealStart,s.revealStart+s.revealRange,c);if(!this.particlesVx||!this.particlesIdx)return;const _=structuredClone(this._params);let v=[-_.direction.x,_.direction.y,-100];r.au(v,v);const S=structuredClone(this._vignetteParams);S.strength*=m,_.overrideStyleParameters||(_.intensity=t.style.rain.state.density,_.timeFactor=t.style.rain.state.intensity,_.color=structuredClone(t.style.rain.state.color),v=structuredClone(t.style.rain.state.direction),_.screenThinning.intensity=t.style.rain.state.centerThinning,_.dropletSizeX=t.style.rain.state.dropletSize[0],_.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],_.distortionStrength=100*t.style.rain.state.distortionStrength,S.strength=1,S.color=structuredClone(t.style.rain.state.vignetteColor));const A=this.updateOnRender(t,_.timeFactor),k=t.context,L=k.gl,B=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new r.T(k,{width:t.width,height:t.height,data:null},L.RGBA8)),_.distortionStrength>0&&(k.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),L.copyTexSubImage2D(L.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const O=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(k,O),k.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const j=[_.color.r,_.color.g,_.color.b,_.color.a],X=(W,Y)=>{const J=ja(this._movement.getPosition(),W),ie=_.dropletSizeX,ue=_.dropletSizeX*_.dropletSizeYScale,pe=t.width/2,be=t.height/2,Te=Va(0,_.screenThinning.start,0,1,_.screenThinning.intensity),xe=Va(.001,_.screenThinning.range,0,1,_.screenThinning.intensity),me=Va(0,_.screenThinning.particleOffset,0,1,_.screenThinning.intensity),Ee=(Ae={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:J,velocityConeAperture:_.velocityConeAperture,velocity:_.velocity,boxSize:W,rainDropletSize:[ie,ue],distortionStrength:_.distortionStrength,rainDirection:v,color:j,screenSize:[B.width,B.height],thinningCenterPos:[pe,be],thinningShape:[Te,xe,Math.pow(10,_.screenThinning.fadePower)],thinningAffectedRatio:_.screenThinning.affectedRatio,thinningParticleOffset:me,shapeDirectionalPower:_.shapeDirPower,shapeNormalPower:_.shapeNormalPower,mode:Y?0:1},{u_modelview:Float32Array.from(Ae.modelview),u_projection:Float32Array.from(Ae.projection),u_time:Ae.time,u_cam_pos:Ae.camPos,u_texScreen:0,u_velocityConeAperture:Ae.velocityConeAperture,u_velocity:Ae.velocity,u_boxSize:Ae.boxSize,u_rainDropletSize:Ae.rainDropletSize,u_distortionStrength:Ae.distortionStrength,u_rainDirection:Ae.rainDirection,u_color:Ae.color,u_screenSize:Ae.screenSize,u_thinningCenterPos:Ae.thinningCenterPos,u_thinningShape:Ae.thinningShape,u_thinningAffectedRatio:Ae.thinningAffectedRatio,u_thinningParticleOffset:Ae.thinningParticleOffset,u_shapeDirectionalPower:Ae.shapeDirectionalPower,u_shapeNormalPower:Ae.shapeNormalPower,u_mode:Ae.mode});var Ae;const Oe=Math.round(_.intensity*this.particlesCount),Ge=r.bd.simpleSegment(0,0,4*Oe,2*Oe);O.draw(t,L.TRIANGLES,Xt.disabled,vi.disabled,Wi.alphaBlended,mi.disabled,Ee,"rain_particles",this.particlesVx,this.particlesIdx,Ge)};_.distortionStrength>0&&X(_.boxSize,!0),X(_.boxSize,!1),this._vignette.draw(t,S)}}const qu=r.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Yn extends Is{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Hd(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const c=Wd(this.particlesCount),m=new r.es,_=new r.a_;let v=0;const S=r.e7(1323123451230);for(let A=0;A<c.length;++A){const k=c[A],L=S(),B=S(),O=S(),j=[A/c.length,L,B,O],X=[S(),S()];m.emplaceBack(k[0],k[1],k[2],-1,-1,...j,...X),m.emplaceBack(k[0],k[1],k[2],1,-1,...j,...X),m.emplaceBack(k[0],k[1],k[2],1,1,...j,...X),m.emplaceBack(k[0],k[1],k[2],-1,1,...j,...X),_.emplaceBack(v+0,v+1,v+2),_.emplaceBack(v+0,v+2,v+3),v+=4}this.particlesVx=s.createVertexBuffer(m,qu.members),this.particlesIdx=s.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const s=structuredClone(this._params);let c=[-s.direction.x,s.direction.y,-100];r.au(c,c);const m=structuredClone(this._vignetteParams),_=s.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},v=t.transform.zoom;if(_.revealStart>v)return;const S=Va(0,1,_.revealStart,_.revealStart+_.revealRange,v);m.strength*=S,s.overrideStyleParameters||(s.intensity=t.style.snow.state.density,s.timeFactor=t.style.snow.state.intensity,s.color=structuredClone(t.style.snow.state.color),c=structuredClone(t.style.snow.state.direction),s.screenThinning.intensity=t.style.snow.state.centerThinning,s.billboardSize=2.79*t.style.snow.state.flakeSize,m.strength=1,m.color=structuredClone(t.style.snow.state.vignetteColor));const A=this.updateOnRender(t,s.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const k=t.context,L=k.gl,B=t.transform,O=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(k,O),((j,X,W)=>{const Y=ja(this._movement.getPosition(),j),J=B.width/2,ie=B.height/2,ue=Va(0,W.screenThinning.start,0,1,W.screenThinning.intensity),pe=Va(.001,W.screenThinning.range,0,1,W.screenThinning.intensity),be=Va(0,W.screenThinning.particleOffset,0,1,W.screenThinning.intensity),Te=(xe={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Y,velocityConeAperture:W.velocityConeAperture,velocity:W.velocity,horizontalOscillationRadius:W.horizontalOscillationRadius,horizontalOscillationRate:W.horizontalOscillationRate,boxSize:j,billboardSize:1*W.billboardSize,simpleShapeParameters:[W.shapeFadeStart,W.shapeFadePower],screenSize:[B.width,B.height],thinningCenterPos:[J,ie],thinningShape:[ue,pe,Math.pow(10,W.screenThinning.fadePower)],thinningAffectedRatio:W.screenThinning.affectedRatio,thinningParticleOffset:be,color:[W.color.r,W.color.g,W.color.b,W.color.a],direction:c},{u_modelview:Float32Array.from(xe.modelview),u_projection:Float32Array.from(xe.projection),u_time:xe.time,u_cam_pos:xe.camPos,u_velocityConeAperture:xe.velocityConeAperture,u_velocity:xe.velocity,u_horizontalOscillationRadius:xe.horizontalOscillationRadius,u_horizontalOscillationRate:xe.horizontalOscillationRate,u_boxSize:xe.boxSize,u_billboardSize:xe.billboardSize,u_simpleShapeParameters:xe.simpleShapeParameters,u_screenSize:xe.screenSize,u_thinningCenterPos:xe.thinningCenterPos,u_thinningShape:xe.thinningShape,u_thinningAffectedRatio:xe.thinningAffectedRatio,u_thinningParticleOffset:xe.thinningParticleOffset,u_particleColor:xe.color,u_direction:xe.direction});var xe;const me=Math.round(W.intensity*this.particlesCount),Ee=r.bd.simpleSegment(0,0,4*me,2*me);this.particlesVx&&this.particlesIdx&&O.draw(t,L.TRIANGLES,Xt.disabled,vi.disabled,Wi.alphaBlended,mi.disabled,Te,"snow_particles",this.particlesVx,this.particlesIdx,Ee)})(s.boxSize,0,s),this._vignette.draw(t,m)}}const hn={symbol:function(l,t,s,c,m){if(l.renderPass!=="translucent")return;const _=vi.disabled,v=l.colorModeForRenderPass(),S=s.layout.get("text-variable-anchor"),A=s.layout.get("text-size-scale-range"),k=r.ay(l.scaleFactor,A[0],A[1]);S&&function(O,j,X,W,Y,J,ie,ue){const pe=j.transform,be=Y==="map",Te=J==="map";for(const xe of O){const me=W.getTile(xe),Ee=me.getBucket(X);if(!Ee||!Ee.text||!Ee.text.segments.get().length)continue;const Ae=r.bH(Ee.textSizeData,pe.zoom,ue),Oe=wu(xe,Ee.getProjection(),pe),Ge=pe.calculatePixelsToTileUnitsMatrix(me),nt=tl(Oe,me.tileID.canonical,Te,be,pe,Ee.getProjection(),Ge),it=Ee.hasIconTextFit()&&Ee.hasIconData();Ae&&Wc(Ee,be,Te,ie,pe,nt,xe,Math.pow(2,pe.zoom-me.tileID.overscaledZ),Ae,it)}}(c,l,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m,k);const L=s.paint.get("icon-opacity").constantOr(1)!==0,B=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(L||B)?tc(l,t,s,c,_,v):(L&&tc(l,t,s,c,_,v,{onlyIcons:!0}),B&&tc(l,t,s,c,_,v,{onlyText:!0})),t.map.showCollisionBoxes&&(hl(l,t,s,c,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),hl(l,t,s,c,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,s,c){if(l.renderPass!=="translucent")return;const m=s.paint.get("circle-opacity"),_=s.paint.get("circle-stroke-width"),v=s.paint.get("circle-stroke-opacity"),S=s.layout.get("circle-sort-key").constantOr(1)!==void 0,A=s.paint.get("circle-emissive-strength");if(m.constantOr(1)===0&&(_.constantOr(1)===0||v.constantOr(1)===0))return;const k=l.context,L=k.gl,B=l.transform,O=!(!l.terrain||!l.terrain.enabled),j=s.layout.get("circle-elevation-reference"),X=l.depthModeForSublayer(0,Xt.ReadOnly),W=new Xt(l.context.gl.LEQUAL,Xt.ReadOnly,l.depthRangeFor3D),Y=j==="none"||O?X:W,J=vi.disabled,ie=l.colorModeForDrapableLayerRenderPass(A),ue=B.projection.name==="globe",pe=[r.aD(B.center.lng),r.aH(B.center.lat)],be=[];for(let xe=0;xe<c.length;xe++){const me=c[xe],Ee=t.getTile(me),Ae=Ee.getBucket(s);if(!Ae||Ae.projection.name!==B.projection.name)continue;const Oe=Ae.programConfigurations.get(s.id),Ge=Ae.layoutVertexBuffer,nt=Ae.globeExtVertexBuffer,it=Ae.indexBuffer,ht=r.dK(s),Be=[nt],Xe=l.isTileAffectedByFog(me);ue&&ht.push("PROJECTION_GLOBE_VIEW"),ht.push("DEPTH_D24"),l.terrain&&B.depthOcclusionForSymbolsAndCircles&&ht.push("DEPTH_OCCLUSION"),Ae.hasElevation&&(ht.push("ELEVATED_ROADS"),Be.push(Ae.elevatedLayoutVertexBuffer));const ke=l.getOrCreateProgram("circle",{config:Oe,defines:ht,overrideFog:Xe}),st=B.projection.createInversionMatrix(B,me.canonical),We={programConfiguration:Oe,program:ke,layoutVertexBuffer:Ge,dynamicBuffers:Be,indexBuffer:it,uniformValues:r.dL(l,me,Ee,st,pe,s),tile:Ee};if(S){const ut=Ae.segments.get();for(const Et of ut)be.push({segments:new r.bd([Et]),sortKey:Et.sortKey,state:We})}else be.push({segments:Ae.segments,sortKey:0,state:We})}S&&be.sort((xe,me)=>xe.sortKey-me.sortKey);const Te={useDepthForOcclusion:B.depthOcclusionForSymbolsAndCircles};for(const xe of be){const{programConfiguration:me,program:Ee,layoutVertexBuffer:Ae,dynamicBuffers:Oe,indexBuffer:Ge,uniformValues:nt,tile:it}=xe.state,ht=xe.segments;l.terrain&&l.terrain.setupElevationDraw(it,Ee,Te),l.uploadCommonUniforms(k,Ee,it.tileID.toUnwrapped()),Ee.draw(l,L.TRIANGLES,Y,J,ie,mi.disabled,nt,s.id,Ae,Ge,ht,s.paint,B.zoom,me,Oe)}},heatmap:function(l,t,s,c){if(s.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const m=l.context,_=m.gl,v=vi.disabled,S=new Wi([_.ONE,_.ONE,_.ONE,_.ONE],r.am.transparent,[!0,!0,!0,!0]);(function(j,X,W,Y){const J=j.gl,ie=X.width*Y,ue=X.height*Y;j.activeTexture.set(J.TEXTURE1),j.viewport.set([0,0,ie,ue]);let pe=W.heatmapFbo;if(!pe||pe&&(pe.width!==ie||pe.height!==ue)){pe&&pe.destroy();const be=J.createTexture();J.bindTexture(J.TEXTURE_2D,be),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.LINEAR),pe=W.heatmapFbo=j.createFramebuffer(ie,ue,!0,null),function(Te,xe,me,Ee,Ae,Oe){const Ge=Te.gl;Ge.texImage2D(Ge.TEXTURE_2D,0,Te.extRenderToTextureHalfFloat?Ge.RGBA16F:Ge.RGBA,Ae,Oe,0,Ge.RGBA,Te.extRenderToTextureHalfFloat?Ge.HALF_FLOAT:Ge.UNSIGNED_BYTE,null),Ee.colorAttachment.set(me)}(j,0,be,pe,ie,ue)}else J.bindTexture(J.TEXTURE_2D,pe.colorAttachment.get()),j.bindFramebuffer.set(pe.framebuffer)})(m,l,s,l.transform.projection.name==="globe"?.5:.25),m.clear({color:r.am.transparent});const A=l.transform,k=A.projection.name==="globe",L=k?["PROJECTION_GLOBE_VIEW"]:[],B=k?mi.frontCCW:mi.disabled,O=[r.aD(A.center.lng),r.aH(A.center.lat)];for(let j=0;j<c.length;j++){const X=c[j];if(t.hasRenderableParent(X))continue;const W=t.getTile(X),Y=W.getBucket(s);if(!Y||Y.projection.name!==A.projection.name)continue;const J=l.isTileAffectedByFog(X),ie=Y.programConfigurations.get(s.id),ue=l.getOrCreateProgram("heatmap",{config:ie,defines:L,overrideFog:J}),{zoom:pe}=l.transform;l.terrain&&l.terrain.setupElevationDraw(W,ue),l.uploadCommonUniforms(m,ue,X.toUnwrapped());const be=A.projection.createInversionMatrix(A,X.canonical);ue.draw(l,_.TRIANGLES,Xt.disabled,v,S,B,La(l,X,W,be,O,pe,s.paint.get("heatmap-intensity")),s.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,s.paint,l.transform.zoom,ie,k?[Y.globeExtVertexBuffer]:null)}m.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(m,_){const v=m.context,S=v.gl,A=_.heatmapFbo;if(!A)return;v.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,A.colorAttachment.get()),v.activeTexture.set(S.TEXTURE1);let k=_.colorRampTexture;k||(k=_.colorRampTexture=new r.T(v,_.colorRamp,S.RGBA8)),k.bind(S.LINEAR,S.CLAMP_TO_EDGE),m.getOrCreateProgram("heatmapTexture").draw(m,S.TRIANGLES,Xt.disabled,vi.disabled,m.colorModeForRenderPass(),mi.disabled,((L,B,O,j)=>({u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}))(0,_),_.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,_.paint,m.transform.zoom)}(l,s))},line:function(l,t,s,c){if(l.renderPass!=="translucent")return;const m=s.paint.get("line-opacity"),_=s.paint.get("line-width");if(m.constantOr(1)===0||_.constantOr(1)===0)return;const v=s.paint.get("line-emissive-strength"),S=s.paint.get("line-occlusion-opacity"),A=s.layout.get("line-elevation-reference"),k=s.layout.get("line-width-unit")==="meters",L=A==="sea",B=!(!l.terrain||!l.terrain.enabled),O=l.context,j=O.gl;if(s.hasElevatedBuckets&&l.transform.projection.name==="globe")return;const X=s.layout.get("line-cross-slope"),W=X!==void 0,Y=X<1,J=l.colorModeForDrapableLayerRenderPass(v),ie=l.terrain&&l.terrain.renderingToTexture,ue=ie?1:r.q.devicePixelRatio,pe=s.paint.get("line-dasharray"),be=pe.constantOr(1),Te=s.layout.get("line-cap"),xe=pe.constantOr(null),me=Te.constantOr(null),Ee=s.paint.get("line-pattern"),Ae=Ee.constantOr(1),Oe=s.paint.get("line-pattern-cross-fade"),Ge=Ee.constantOr(null),nt=s.paint.get("line-opacity").constantOr(1);let it=!Ae&&nt!==1||l.depthOcclusion&&S>0&&S<1;const ht=s.paint.get("line-gradient"),Be=Ae?"linePattern":"line",Xe=r.dM(s);let ke;if(ie&&l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(it=!1),S!==0&&l.depthOcclusion){const Et=s.paint._values["line-opacity"];Et&&Et.value&&Et.value.kind==="constant"?ke=Et.value:r.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}_.value.kind!=="constant"&&_.value.isLineProgressConstant===!1&&Xe.push("VARIABLE_LINE_WIDTH");const st=(Et,ot,yt,jt,Wt,Ot)=>{for(const Zt of Et){const ai=t.getTile(Zt);if(Ae&&!ai.patternsLoaded())continue;const ui=ai.getBucket(s);if(!ui||ui.elevationType!=="none"&&!Wt||ui.elevationType==="none"&&Wt)continue;l.prepareDrawTile();const wi=[...ot],Ni=l.shadowRenderer,cn=ui.elevationType==="road"&&!!Ni&&Ni.enabled;let Un=[0,0,0];if(cn){const an=l.style.directionalLight,mr=l.style.ambientLight;an&&mr&&(Un=al(l.style,an,mr)),wi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const En=ui.programConfigurations.get(s.id);let yn=!1;if(Ge&&ai.imageAtlas){const an=r.dN.from(Ge),mr=an.getPrimary().scaleSelf(ue).toString(),Kn=ai.imageAtlas.patternPositions.get(mr),Mn=an.getSecondary(),Wn=Mn?ai.imageAtlas.patternPositions.get(Mn.scaleSelf(ue).toString()):null;yn=!!Kn&&!!Wn,Kn&&En.setConstantPatternPositions(Kn,Wn)}Oe>0&&(yn||En.getPatternTransitionVertexBuffer("line-pattern"))&&wi.push("LINE_PATTERN_TRANSITION");const _r=l.isTileAffectedByFog(Zt),Ii=l.getOrCreateProgram(Be,{config:En,defines:wi,overrideFog:_r,overrideRtt:!Wt&&void 0});if(!Ae&&xe&&me&&ai.lineAtlas){const an=ai.lineAtlas.getDash(xe,me);an&&En.setConstantPatternPositions(an)}cn&&Ni.setupShadows(ai.tileID.toUnwrapped(),Ii,"vector-tile",ai.tileID.overscaledZ);let[Bi,Yi]=s.paint.get("line-trim-offset");(me==="round"||me==="square")&&Bi!==Yi&&(Bi===0&&(Bi-=1),Yi===1&&(Yi+=1));const Gn=ie?Zt.projMatrix:null,Cr=k?1/ui.tileToMeter/r.aw(ai,1,l.transform.zoom):1,Hn=k?1/ui.tileToMeter/r.aw(ai,1,Math.floor(l.transform.zoom)):1,wn=Ae?r.dO(l,ai,s,Gn,ue,Cr,Hn,[Bi,Yi],Un,Oe):r.dP(l,ai,s,Gn,ui.lineClipsArray.length,ue,Cr,Hn,[Bi,Yi],Un);if(ht){const an=ui.gradients[s.id];let mr=an.texture;if(s.gradientVersion!==an.version){let Kn=256;if(s.stepInterpolant){const Mn=t.getSource().maxzoom,Wn=Zt.canonical.z===Mn?Math.ceil(1<<l.transform.maxZoom-Zt.canonical.z):1;Kn=r.ay(r.dQ(ui.maxLineLength/r.aj*1024*Wn),256,O.maxTextureSize)}an.gradient=r.dR({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Kn,image:an.gradient||void 0,clips:ui.lineClipsArray}),an.texture?an.texture.update(an.gradient):an.texture=new r.T(O,an.gradient,j.RGBA8),an.version=s.gradientVersion,mr=an.texture}O.activeTexture.set(j.TEXTURE1),mr.bind(s.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}be&&(O.activeTexture.set(j.TEXTURE0),ai.lineAtlasTexture&&ai.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),En.updatePaintBuffers()),Ae&&(O.activeTexture.set(j.TEXTURE0),ai.imageAtlasTexture&&ai.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),En.updatePaintBuffers()),Wt&&!L&&l.terrain.setupElevationDraw(ai,Ii),l.uploadCommonUniforms(O,Ii,Zt.toUnwrapped());const pr=an=>{ke!=null&&(ke.value=nt*S),Ii.draw(l,j.TRIANGLES,yt,an,J,mi.disabled,wn,s.id,ui.layoutVertexBuffer,ui.indexBuffer,ui.segments,s.paint,l.transform.zoom,En,[ui.layoutVertexBuffer2,ui.patternVertexBuffer,ui.zOffsetVertexBuffer]),ke!=null&&(ke.value=nt)};if(it&&!Wt){const an=l.stencilModeForClipping(Zt).ref;an===0&&ie&&O.clear({stencil:0});const mr={func:j.EQUAL,mask:255};wn.u_alpha_discard_threshold=.8,pr(new vi(mr,an,255,j.KEEP,j.KEEP,j.INVERT)),wn.u_alpha_discard_threshold=0,pr(new vi(mr,an,255,j.KEEP,j.KEEP,j.KEEP))}else wn.u_alpha_discard_threshold=it&&Wt&&Ot?.8:0,pr(Wt?jt:l.stencilModeForClipping(Zt))}};let We=l.depthModeForSublayer(0,Xt.ReadOnly);const ut=new Xt(l.depthOcclusion?j.GREATER:j.LEQUAL,Xt.ReadOnly,l.depthRangeFor3D);if(s.hasNonElevatedBuckets){const Et=!ie&&l.terrain;S!==0&&Et?r.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has line-z-offset enabled.`):Et?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${s.id}.`):st(c,Xe,We,vi.disabled,!1,!0)}if(s.hasElevatedBuckets){A==="hd-road-markup"?B||(We=ut,Xe.push("ELEVATED_ROADS")):(Xe.push("ELEVATED"),We=ut,W&&Xe.push(Y?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),L&&Xe.push("ELEVATION_REFERENCE_SEA"));const Et=it?l.stencilModeFor3D():vi.disabled;l.forceTerrainMode=!0,st(c,Xe,We,Et,!0,!0),it&&st(c,Xe,We,Et,!0,!1),l.forceTerrainMode=!1}it&&(l.resetStencilClippingMasks(),ie&&O.clear({stencil:0})),S===0||l.depthOcclusion||ie||l.layersWithOcclusionOpacity.push(l.currentLayer)},fill:function(l,t,s,c){const m=s.paint.get("fill-color"),_=s.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const v=s.paint.get("fill-emissive-strength"),S=l.colorModeForDrapableLayerRenderPass(v),A=s.paint.get("fill-pattern"),k=l.opaquePassEnabledForLayer()&&!A.constantOr(1)&&m.constantOr(r.am.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";let L="none";s.layout.get("fill-elevation-reference")!=="none"?L="road":s.paint.get("fill-z-offset").constantOr(1)!==0&&(L="offset");const B=!(!l.terrain||!l.terrain.enabled),O={painter:l,sourceCache:t,layer:s,coords:c,colorMode:S,elevationType:L,terrainEnabled:B,pass:k};if(l.renderPass!=="shadow")if(L!=="offset"){if(nc(O,!1),L==="road"){const j=!B&&l.renderPass==="translucent";j&&Nh(l,t,s,c,"geometry"),nc(O,!0,vi.disabled),j&&function(X){const{painter:W,sourceCache:Y,layer:J,coords:ie,colorMode:ue}=X,pe=W.context.gl,be=X.painter.shadowRenderer,Te=!!be&&be.enabled,xe=new Xt(W.context.gl.LEQUAL,Xt.ReadOnly,W.depthRangeFor3D);let me=[0,0,0];if(Te){const Ae=W.style.directionalLight,Oe=W.style.ambientLight;Ae&&Oe&&(me=al(W.style,Ae,Oe))}const Ee=Ae=>{for(const Oe of ie){const Ge=Y.getTile(Oe),nt=Ge.getBucket(J);if(!nt)continue;const it=nt.elevatedStructures;if(!it)continue;let ht,Be;if(Ae?(ht=it.renderableBridgeSegments,Be=it.bridgeProgramConfigurations.get(J.id)):(ht=it.renderableTunnelSegments,Be=it.tunnelProgramConfigurations.get(J.id)),!ht||ht.segments[0].primitiveLength===0)continue;Be.updatePaintBuffers(),W.prepareDrawTile();const Xe=W.isTileAffectedByFog(Oe),ke=[];Te&&ke.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const st=W.getOrCreateProgram("elevatedStructures",{config:Be,overrideFog:Xe,defines:ke}),We=W.translatePosMatrix(Oe.projMatrix,Ge,J.paint.get("fill-translate"),J.paint.get("fill-translate-anchor"));Te&&be.setupShadows(Ge.tileID.toUnwrapped(),st,"vector-tile",Ge.tileID.overscaledZ);const ut=Fd(We,me);W.uploadCommonUniforms(W.context,st,Oe.toUnwrapped()),st.draw(W,pe.TRIANGLES,xe,vi.disabled,ue,mi.backCCW,ut,J.id,it.vertexBuffer,it.indexBuffer,ht,J.paint,W.transform.zoom,Be,[it.vertexBufferNormal])}};Ee(!0),Ee(!1)}(O)}}else nc(O,!1,l.stencilModeFor3D());else l.shadowRenderer&&L==="road"&&!B&&function(j){const{painter:X,sourceCache:W,layer:Y,coords:J}=j,ie=X.context.gl,ue=j.painter.shadowRenderer;for(const pe of J){const be=W.getTile(pe),Te=be.getBucket(Y);if(!Te)continue;const xe=Te.elevatedStructures;if(!xe||!xe.shadowCasterSegments||xe.shadowCasterSegments.segments[0].primitiveLength===0)continue;X.prepareDrawTile();const me=Te.bufferData.programConfigurations.get(Y.id),Ee=X.isTileAffectedByFog(pe),Ae=X.getOrCreateProgram("elevatedStructuresDepth",{config:me,overrideFog:Ee}),Oe=ue.calculateShadowPassMatrixFromTile(be.tileID.toUnwrapped());X.uploadCommonUniforms(X.context,Ae,pe.toUnwrapped());const Ge={u_matrix:Oe,u_depth_bias:.001};Ae.draw(X,ie.TRIANGLES,ue.getShadowPassDepthMode(),vi.disabled,ue.getShadowPassColorMode(),mi.disabled,Ge,Y.id,xe.vertexBuffer,xe.indexBuffer,xe.shadowCasterSegments,Y.paint,X.transform.zoom,me)}}(O)},"fill-extrusion":function(l,t,s,c){const m=s.paint.get("fill-extrusion-opacity"),_=l.context,v=_.gl,S=l.terrain,A=S&&S.renderingToTexture;if(m===0)return;const k=l.conflationActive&&l.style.isLayerClipped(s,t.getSource()),L=l.style.order.indexOf(s.fqid);if(k&&function(B,O,j,X,W){for(const Y of X){const J=O.getTile(Y).getBucket(j);J&&(J.updateReplacement(Y,B.replacementSource,W),J.uploadCentroid(B.context))}}(l,t,s,c,L),S||k)for(const B of c){const O=t.getTile(B).getBucket(s);O&&qt(l.context,t,B,O,s,S,k)}if(l.renderPass==="shadow"&&l.shadowRenderer){const B=l.shadowRenderer;if(S&&m<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.ab)return;const O=B.getShadowPassDepthMode(),j=B.getShadowPassColorMode();es(l,t,s,c,O,vi.disabled,j,k)}else if(l.renderPass==="translucent"){const B=!s.paint.get("fill-extrusion-pattern").constantOr(1),O=s.paint.get("fill-extrusion-color").constantOr(r.am.white);if(!A&&O.a!==0){const j=new Xt(l.context.gl.LEQUAL,Xt.ReadWrite,l.depthRangeFor3D);m===1&&B?es(l,t,s,c,j,vi.disabled,Wi.unblended,k):(es(l,t,s,c,j,vi.disabled,Wi.disabled,k),es(l,t,s,c,j,l.stencilModeFor3D(),l.colorModeForRenderPass(),k),l.resetStencilClippingMasks())}if(l.style.enable3dLights()&&B&&(!S&&l.transform.projection.name!=="globe"||A)){const j=s.paint.get("fill-extrusion-opacity"),X=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),W=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Y=s.paint.get("fill-extrusion-flood-light-intensity"),J=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ie=s.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(J?null:s.lut).toArray01().slice(0,3),ue=X>0&&W>0,pe=Y>0,be=(xe,me,Ee)=>(1-Ee)*xe+Ee*me,Te=xe=>{const me=l.depthModeForSublayer(1,Xt.ReadOnly,v.LEQUAL,!0),Ee=s.paint.get(xe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ae=be(.1,3,Ee),Oe=l._showOverdrawInspector;if(!Oe){const Ge=new vi({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),nt=new Wi([v.ONE,v.ONE,v.ONE,v.ONE],r.am.transparent,[!1,!1,!1,!0],v.MIN);oo(l,t,s,c,me,Ge,nt,mi.disabled,xe,"sdf",j,X,W,Y,ie,Ae,k,!1)}{const Ge=Oe?vi.disabled:new vi({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),nt=Oe?l.colorModeForRenderPass():new Wi([v.ONE_MINUS_DST_ALPHA,v.DST_ALPHA,v.ONE,v.ONE],r.am.transparent,[!0,!0,!0,!0]);oo(l,t,s,c,me,Ge,nt,mi.disabled,xe,"color",j,X,W,Y,ie,Ae,k,!1)}};if(A){const xe=(me,Ee,Ae)=>{const Oe=l.depthModeForSublayer(1,Xt.ReadOnly,v.LEQUAL,!1),Ge=s.paint.get(me?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),nt=be(.1,3,Ge);{const it=new Wi([v.ONE,v.ONE,v.ONE,v.ONE],r.am.transparent,[!1,!1,!1,!0]);oo(l,t,s,c,Oe,vi.disabled,it,mi.disabled,me,"clear",j,X,W,Y,ie,nt,k,Ee)}{const it=new vi({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),ht=new Wi([v.ONE,v.ONE,v.ONE,v.ONE],r.am.transparent,[!1,!1,!1,!0],v.MIN);oo(l,t,s,c,Oe,it,ht,mi.disabled,me,"sdf",j,X,W,Y,ie,nt,k,Ee)}{const it=me?v.ZERO:v.ONE_MINUS_DST_ALPHA,ht=new vi({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),Be=new Wi([it,v.DST_ALPHA,v.ONE_MINUS_DST_ALPHA,v.ZERO],r.am.transparent,[!0,!0,!0,!0]);oo(l,t,s,c,Oe,ht,Be,mi.disabled,me,"color",j,X,W,Y,ie,nt,k,Ee)}{const it=new Wi([v.ONE,v.ONE,v.ONE,me?v.ZERO:v.ONE],r.am.transparent,[!1,!1,!1,!0],me?v.FUNC_ADD:v.MAX);oo(l,t,s,c,Oe,vi.disabled,it,mi.disabled,me,"clear",j,X,W,Y,ie,nt,k,Ee,Ae)}};if(ue||pe){let me;if(l.prepareDrawTile(),S){const Ee=S.drapeBufferSize[0],Ae=S.drapeBufferSize[1];me=S.framebufferCopyTexture,me&&(!me||me.size[0]===Ee&&me.size[1]===Ae)||(me&&me.destroy(),me=S.framebufferCopyTexture=new r.T(_,new r.r({width:Ee,height:Ae}),v.RGBA8)),me.bind(v.LINEAR,v.CLAMP_TO_EDGE),v.copyTexSubImage2D(v.TEXTURE_2D,0,0,0,0,0,Ee,Ae)}ue&&xe(!0,!1,me),pe&&xe(!1,!0,me)}}else ue&&Te(!0),pe&&Te(!1),(ue||pe)&&l.resetStencilClippingMasks()}}},building:function(l,t,s,c){},hillshade:function(l,t,s,c){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent"||l.style.disableElevatedTerrain)return;const m=l.context,_=l.terrain&&l.terrain.renderingToTexture,[v,S]=l.renderPass!=="translucent"||_?[{},c]:l.stencilConfigForOverlap(c);for(const A of S){const k=t.getTile(A);if(k.needsHillshadePrepare&&l.renderPass==="offscreen")Mm(l,k,s);else if(l.renderPass==="translucent"){const L=l.depthModeForSublayer(0,Xt.ReadOnly),B=s.paint.get("hillshade-emissive-strength"),O=l.colorModeForDrapableLayerRenderPass(B),j=_&&l.terrain?l.terrain.stencilModeForRTTOverlap(A):v[A.overscaledZ];Pm(l,A,k,s,L,j,O)}}m.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,t,s,c,m,_){if(l.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const v=l.transform.projection.name==="globe",S=s.paint.get("raster-elevation")!==0,A=S&&v;if(l.renderElevatedRasterBackface&&!A)return;const k=l.context,L=k.gl,B=t.getSource(),O=function(Te,xe,me,Ee){const Ae=xe.paint.get("raster-color"),Oe=Te.type==="raster-array",Ge=[],nt=xe.paint.get("raster-resampling"),it=xe.paint.get("raster-color-mix");let ht=xe.paint.get("raster-color-range");const Be=[it[0],it[1],it[2],0],Xe=it[3];let ke=nt==="nearest"?Ee.NEAREST:Ee.LINEAR;if(Oe&&(Ge.push("RASTER_ARRAY"),Ae||Ge.push("RASTER_COLOR"),nt==="linear"&&Ge.push("RASTER_ARRAY_LINEAR"),ke=Ee.NEAREST,!ht&&Te.rasterLayers)){const st=Te.rasterLayers.find(({id:We})=>We===xe.sourceLayer);st&&st.fields&&st.fields.range&&(ht=st.fields.range)}if(ht=ht||[0,1],Ae){Ge.push("RASTER_COLOR"),me.activeTexture.set(Ee.TEXTURE2),xe.updateColorRamp(ht);let st=xe.colorRampTexture;st||(st=xe.colorRampTexture=new r.T(me,xe.colorRamp,Ee.RGBA8)),st.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)}return{mix:Be,range:ht,offset:Xe,defines:Ge,resampling:ke}}(B,s,k,L);if(B instanceof r.aP&&!c.length&&!v)return;const j=s.paint.get("raster-emissive-strength"),X=l.colorModeForDrapableLayerRenderPass(j),W=l.terrain&&l.terrain.renderingToTexture,Y=!l.options.moving,J=s.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(B instanceof r.aP&&!c.length&&(B.onNorthPole||B.onSouthPole)){const Te=S?l.stencilModeFor3D():vi.disabled;return void No(!!B.onNorthPole,null,l,t,s,j,O,mi.disabled,Te)}if(!c.length)return;const[ie,ue]=B instanceof r.aP||W?[{},c]:l.stencilConfigForOverlap(c),pe=ue[ue.length-1].overscaledZ;A&&O.defines.push("PROJECTION_GLOBE_VIEW"),S&&O.defines.push("RENDER_CUTOFF");const be=(Te,xe,me)=>{for(const Ee of Te){const Ae=Ee.toUnwrapped(),Oe=t.getTile(Ee);if(W&&(!Oe||!Oe.hasData()))continue;k.activeTexture.set(L.TEXTURE0);const Ge=Bd(Oe,B,s,O);if(!Ge||!Ge.texture)continue;const{texture:nt,mix:it,offset:ht,tileSize:Be,buffer:Xe}=Ge;let ke,st;W?(ke=Xt.disabled,st=Ee.projMatrix):S?(ke=new Xt(L.LEQUAL,Xt.ReadWrite,l.depthRangeFor3D),st=v?Float32Array.from(l.transform.expandedFarZProjMatrix):l.transform.calculateProjMatrix(Ae,Y)):(ke=l.depthModeForSublayer(Ee.overscaledZ-pe,s.paint.get("raster-opacity")===1?Xt.ReadWrite:Xt.ReadOnly,L.LESS),st=l.transform.calculateProjMatrix(Ae,Y));const We=l.terrain&&W?l.terrain.stencilModeForRTTOverlap(Ee):ie[Ee.overscaledZ],ut=_?0:s.paint.get("raster-fade-duration");Oe.registerFadeDuration(ut);const Et=t.findLoadedParent(Ee,0),ot=Vr(Oe,Et,t,l.transform,ut);let yt,jt;l.terrain&&l.terrain.prepareDrawTile(),k.activeTexture.set(L.TEXTURE0),nt.bind(J,L.CLAMP_TO_EDGE),k.activeTexture.set(L.TEXTURE1),Et?(Et.texture&&Et.texture.bind(J,L.CLAMP_TO_EDGE),yt=Math.pow(2,Et.tileID.overscaledZ-Oe.tileID.overscaledZ),jt=[Oe.tileID.canonical.x*yt%1,Oe.tileID.canonical.y*yt%1]):nt.bind(J,L.CLAMP_TO_EDGE),"useMipmap"in nt&&k.extTextureFilterAnisotropic&&l.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const Wt=l.transform;let Ot;const Zt=S?rc(Wt):[0,0,0,0];let ai,ui,wi,Ni,cn,Un=0;if(A&&B instanceof r.aP&&B.coordinates.length>3)ai=Float32Array.from(r.bh(r.dr(new r.cp(0,0,0)))),ui=Float32Array.from(Wt.globeMatrix),wi=Float32Array.from(r.dm(Wt)),Ni=[r.aD(Wt.center.lng),r.aH(Wt.center.lat)],Ot=B.elevatedGlobePerspectiveTransform,cn=B.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){const Ii=r.dn(Ee.canonical);Un=r.dp(Ii.getCenter().lat),ai=Float32Array.from(r.bh(r.dr(Ee.canonical))),ui=Float32Array.from(Wt.globeMatrix),wi=Float32Array.from(r.dm(Wt)),Ni=[r.aD(Wt.center.lng),r.aH(Wt.center.lat)],Ot=[0,0],cn=Float32Array.from(r.dq(Ee.canonical,Ii,Un,Wt.worldSize/Wt._pixelsPerMercatorPixel))}else Ot=B instanceof r.aP?B.perspectiveTransform:[0,0],ai=new Float32Array(16),ui=new Float32Array(9),wi=new Float32Array(16),Ni=[0,0],cn=new Float32Array(9);const En=Dh(st,ai,ui,wi,cn,jt||[0,0],r.ah(l.transform.zoom),Ni,Zt,yt||1,ot,s,Ot,S?s.paint.get("raster-elevation"):0,2,it,ht,O.range,Be,Xe,j),yn=l.isTileAffectedByFog(Ee),_r=l.getOrCreateProgram("raster",{defines:O.defines,overrideFog:yn});if(l.uploadCommonUniforms(k,_r,Ae),B instanceof r.aP){const Ii=B.elevatedGlobeVertexBuffer,Bi=B.elevatedGlobeIndexBuffer;if(W||!v)B.boundsBuffer&&B.boundsSegments&&_r.draw(l,L.TRIANGLES,ke,vi.disabled,X,mi.disabled,En,s.id,B.boundsBuffer,l.quadTriangleIndexBuffer,B.boundsSegments);else if(Ii&&Bi){const Yi=Wt.zoom<=r.cL?B.elevatedGlobeSegments:B.getSegmentsForLongitude(Wt.center.lng);Yi&&_r.draw(l,L.TRIANGLES,ke,vi.disabled,X,xe,En,s.id,Ii,Bi,Yi)}}else if(A){ke=new Xt(L.LEQUAL,Xt.ReadOnly,l.depthRangeFor3D);const Ii=l.globeSharedBuffers;if(Ii){const[Bi,Yi,Gn]=Ii.getGridBuffers(Un,!1);_r.draw(l,L.TRIANGLES,ke,me||We,l.colorModeForRenderPass(),xe,En,s.id,Bi,Yi,Gn)}}else{const{tileBoundsBuffer:Ii,tileBoundsIndexBuffer:Bi,tileBoundsSegments:Yi}=l.getTileBoundsBuffers(Oe);_r.draw(l,L.TRIANGLES,ke,We,X,mi.disabled,En,s.id,Ii,Bi,Yi)}}if(!(B instanceof r.aP)&&A)for(const Ee of Te){const Ae=Ee.canonical.y===(1<<Ee.canonical.z)-1;Ee.canonical.y===0&&No(!0,Ee,l,t,s,j,O,xe,me||vi.disabled),Ae&&No(!1,Ee,l,t,s,j,O,xe===mi.frontCW?mi.backCW:mi.frontCW,me||vi.disabled)}};A?be(ue,l.renderElevatedRasterBackface?mi.backCW:mi.frontCW,l.stencilModeFor3D()):be(ue,mi.disabled,void 0),l.resetStencilClippingMasks()},"raster-particle":function(l,t,s,c,m,_){l.renderPass==="offscreen"&&function(v,S,A,k){if(!k.length)return;const L=v.context,B=L.gl,O=S.getSource();if(!(O instanceof Dl))return;const j=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count")));let X=A.particlePositionRGBAImage;if(!X||X.width!==j){const ue=function(pe){const be=pe*pe,Te=new Uint8Array(4*be),xe=function(Ee){return Ee|=0,Ee=Math.imul(2747636419^Ee,2654435769),Ee=Math.imul(Ee^Ee>>>16,2654435769),((Ee=Math.imul(Ee^Ee>>>16,2654435769))>>>0)/4294967296},me=1/1.1;for(let Ee=0;Ee<be;Ee++){const Ae=me*(xe(2*Ee+0)+Qr),Oe=me*(xe(2*Ee+1)+Qr),Ge=255*Ae%1,nt=255*Oe%1,it=Ge,ht=Oe-nt/255,Be=nt;Te[4*Ee+0]=255*(Ae-Ge/255),Te[4*Ee+1]=255*it,Te[4*Ee+2]=255*ht,Te[4*Ee+3]=255*Be}return Te}(j);X=A.particlePositionRGBAImage=new r.r({width:j,height:j},ue)}let W=A.particleFramebuffer;W?W.width!==j&&(W.destroy(),W=A.particleFramebuffer=L.createFramebuffer(j,j,!0,null)):W=A.particleFramebuffer=L.createFramebuffer(j,j,!0,null);const Y=[];for(const ue of k){const pe=S.getTile(ue);if(!(pe instanceof Tc))continue;const be=kp(pe,O,A);if(!be)continue;const Te=[pe.tileSize,pe.tileSize];let xe=A.tileFramebuffer;xe||(xe=A.tileFramebuffer=L.createFramebuffer(Te[0],Te[1],!0,null));let me=pe.rasterParticleState;me||(me=pe.rasterParticleState=new Bh(L,ue,Te,X));const Ee=me.update(A.lastInvalidatedAt);me.particleTextureDimension!==j&&me.updateParticleTexture(ue,X);const Ae=me.targetColorTexture;me.targetColorTexture=me.backgroundColorTexture,me.backgroundColorTexture=Ae;const Oe=me.particleTexture0;me.particleTexture0=me.particleTexture1,me.particleTexture1=Oe,Y.push([ue,be,me,Ee])}if(Y.length===0)return;const J=r.q.now(),ie=A.previousDrawTimestamp?.001*(J-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=J,A.hasColorMap()){L.activeTexture.set(B.TEXTURE0+2);let ue=A.colorRampTexture;ue||(ue=A.colorRampTexture=new r.T(L,A.colorRamp,B.RGBA8)),ue.bind(B.LINEAR,B.CLAMP_TO_EDGE)}L.bindFramebuffer.set(A.tileFramebuffer.framebuffer),function(ue,pe,be){const Te=ue.context,xe=Te.gl,me=pe.tileFramebuffer;Te.activeTexture.set(xe.TEXTURE0);const Ee={u_texture:0,u_opacity:1.05*(Oe=pe.paint.get("raster-particle-fade-opacity-factor"))/(Oe+.05)},Ae=ue.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Oe;for(const Ge of be){const[,,nt,it]=Ge;me.colorAttachment.set(nt.targetColorTexture.texture),Te.viewport.set([0,0,me.width,me.height]),Te.clear({color:r.am.transparent}),it&&(nt.backgroundColorTexture.bind(xe.NEAREST,xe.CLAMP_TO_EDGE),Ae.draw(ue,xe.TRIANGLES,Xt.disabled,vi.disabled,Wi.alphaBlended,mi.disabled,Ee,pe.id,ue.viewportBuffer,ue.quadTriangleIndexBuffer,ue.viewportSegments))}}(v,A,Y),function(ue,pe,be,Te){const xe=ue.context,me=xe.gl,Ee=be.tileFramebuffer,Ae=ue.transform.projection.name==="globe",Oe=be.paint.get("raster-particle-max-speed");for(const Ge of Te){const[nt,it,ht]=Ge;xe.activeTexture.set(me.TEXTURE0+0),it.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE),Ee.colorAttachment.set(ht.targetColorTexture.texture);const Be=ue.getOrCreateProgram("rasterParticleDraw",{defines:it.defines,overrideFog:!1});xe.activeTexture.set(me.TEXTURE0+1);const Xe=it.scalarData?[]:[0,1,2,3].map(We=>r.dT[We](nt));Xe.push(nt);const ke=nt.canonical.x,st=nt.canonical.y;for(const We of Xe){const ut=pe.getTile(Ae?We.wrapped():We);if(!ut)continue;const Et=ut.rasterParticleState;if(!Et)continue;const ot=We.canonical.x+(1<<We.canonical.z)*(We.wrap-nt.wrap),yt=We.canonical.y;Et.particleTexture0.bind(me.NEAREST,me.CLAMP_TO_EDGE);const jt=Dr(1,Et.particleTexture0.size[0],[ot-ke,yt-st],0,it.texture.size,2,Oe,it.textureOffset,it.scale,it.offset);Be.draw(ue,me.POINTS,Xt.disabled,vi.disabled,Wi.alphaBlended,mi.disabled,jt,be.id,Et.particleIndexBuffer,void 0,Et.particleSegment)}}}(v,S,A,Y),L.bindFramebuffer.set(A.particleFramebuffer.framebuffer),function(ue,pe,be,Te){const xe=ue.context,me=xe.gl,Ee=pe.paint.get("raster-particle-max-speed"),Ae=Te*pe.paint.get("raster-particle-speed-factor")*.15,Oe=function(nt){return Math.pow(nt,6)}(.01+1*pe.paint.get("raster-particle-reset-rate-factor")),Ge=pe.particleFramebuffer;xe.viewport.set([0,0,Ge.width,Ge.height]);for(const nt of be){const[,it,ht]=nt;xe.activeTexture.set(me.TEXTURE0+0),it.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE),xe.activeTexture.set(me.TEXTURE0+1);const Be=ht.particleTexture0;Be.bind(me.NEAREST,me.CLAMP_TO_EDGE);const Xe=Es(1,Be.size[0],0,it.texture.size,Ee,Ae,Oe,it.textureOffset,it.scale,it.offset);Ge.colorAttachment.set(ht.particleTexture1.texture),xe.clear({color:r.am.transparent}),ue.getOrCreateProgram("rasterParticleUpdate",{defines:it.defines}).draw(ue,me.TRIANGLES,Xt.disabled,vi.disabled,Wi.unblended,mi.disabled,Xe,pe.id,ue.viewportBuffer,ue.quadTriangleIndexBuffer,ue.viewportSegments)}}(v,A,Y,ie)}(l,t,s,c),l.renderPass==="translucent"&&(function(v,S,A,k,L){const B=v.context,O=B.gl,j=S.getSource().tileSize,X=5*(1-r.af(r.cx,r.cx+1,v.transform.zoom))*j+A.paint.get("raster-particle-elevation"),W=!v.options.moving,Y=v.transform.projection.name==="globe";if(!k.length)return;const[J,ie]=v.stencilConfigForOverlap(k),ue=[];Y&&ue.push("PROJECTION_GLOBE_VIEW");const pe=v.stencilModeFor3D();for(const be of ie){const Te=be.toUnwrapped(),xe=S.getTile(be);if(!xe.rasterParticleState)continue;const me=xe.rasterParticleState,Ee=100;xe.registerFadeDuration(Ee);const Ae=S.findLoadedParent(be,0),Oe=Vr(xe,Ae,S,v.transform,Ee);let Ge,nt;v.terrain&&v.terrain.prepareDrawTile(),B.activeTexture.set(O.TEXTURE0),me.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),B.activeTexture.set(O.TEXTURE1),Ae&&Ae.rasterParticleState?(Ae.rasterParticleState.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Ge=Math.pow(2,Ae.tileID.overscaledZ-xe.tileID.overscaledZ),nt=[xe.tileID.canonical.x*Ge%1,xe.tileID.canonical.y*Ge%1]):me.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const it=Y?Float32Array.from(v.transform.expandedFarZProjMatrix):v.transform.calculateProjMatrix(Te,W),ht=v.transform,Be=$u(ht),Xe=r.dn(be.canonical),ke=r.dp(Xe.getCenter().lat);let st,We,ut,Et,ot;Y?(st=Float32Array.from(r.bh(r.dr(be.canonical))),We=Float32Array.from(ht.globeMatrix),ut=Float32Array.from(r.dm(ht)),Et=[r.aD(ht.center.lng),r.aH(ht.center.lat)],ot=Float32Array.from(r.dq(be.canonical,Xe,ke,ht.worldSize/ht._pixelsPerMercatorPixel))):(st=new Float32Array(16),We=new Float32Array(9),ut=new Float32Array(16),Et=[0,0],ot=new Float32Array(9));const yt=ps(it,st,We,ut,ot,nt||[0,0],r.ah(v.transform.zoom),Et,Be,Ge||1,Oe,X),jt=v.isTileAffectedByFog(be),Wt=v.getOrCreateProgram("rasterParticle",{defines:ue,overrideFog:jt});if(v.uploadCommonUniforms(B,Wt,Te),Y){const Ot=new Xt(O.LEQUAL,Xt.ReadOnly,v.depthRangeFor3D),Zt=0,ai=v.globeSharedBuffers;if(ai){const[ui,wi,Ni]=ai.getGridBuffers(ke,Zt!==0);Wt.draw(v,O.TRIANGLES,Ot,pe,Wi.alphaBlended,v.renderElevatedRasterBackface?mi.frontCCW:mi.backCCW,yt,A.id,ui,wi,Ni)}}else{const Ot=v.depthModeForSublayer(0,Xt.ReadOnly),Zt=J[be.overscaledZ],{tileBoundsBuffer:ai,tileBoundsIndexBuffer:ui,tileBoundsSegments:wi}=v.getTileBoundsBuffers(xe);Wt.draw(v,O.TRIANGLES,Ot,Zt,Wi.alphaBlended,mi.disabled,yt,A.id,ai,ui,wi)}}v.resetStencilClippingMasks()}(l,t,s,c),l.style.map.triggerRepaint())},background:function(l,t,s,c){const m=s.paint.get("background-color"),_=s.paint.get("background-color-use-theme").constantOr("default")==="none",v=s.paint.get("background-opacity"),S=s.paint.get("background-emissive-strength"),A=s.paint.get("background-pitch-alignment")==="viewport";if(v===0)return;const k=l.context,L=k.gl,B=l.transform,O=B.tileSize,j=s.paint.get("background-pattern");let X;if(j!==void 0&&(j===null||(X=l.imageManager.getPattern(r.I.from(j.toString()),s.scope,l.style.getLut(s.scope)),!X)))return;const W=!j&&m.a===1&&v===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==W)return;const Y=vi.disabled,J=l.depthModeForSublayer(0,W==="opaque"?Xt.ReadWrite:Xt.ReadOnly),ie=l.colorModeForDrapableLayerRenderPass(S),ue=j?"backgroundPattern":"background";let pe,be=c;if(be||(pe=l.getBackgroundTiles(),be=Object.values(pe).map(Te=>Te.tileID)),j&&(k.activeTexture.set(L.TEXTURE0),l.imageManager.bind(l.context,s.scope)),A){const Te=l.getOrCreateProgram(ue,{overrideFog:!1,overrideRtt:!0}),xe=new Float32Array(r.bx([])),me=new r.aM(0,0,0,0,0),Ee=j?Fh(xe,S,v,l,0,s.scope,X,A,{tileID:me,tileSize:O}):zh(xe,S,v,m.toPremultipliedRenderColor(_?null:s.lut));Te.draw(l,L.TRIANGLES,J,Y,ie,mi.disabled,Ee,s.id,l.viewportBuffer,l.quadTriangleIndexBuffer,l.viewportSegments)}else for(const Te of be){const xe=l.isTileAffectedByFog(Te),me=l.getOrCreateProgram(ue,{overrideFog:xe}),Ee=Te.toUnwrapped(),Ae=c?Te.projMatrix:l.transform.calculateProjMatrix(Ee);l.prepareDrawTile();const Oe=t?t.getTile(Te):pe?pe[Te.key]:new Ol(Te,O,B.zoom,l),Ge=j?Fh(Ae,S,v,l,0,s.scope,X,A,{tileID:Te,tileSize:O}):zh(Ae,S,v,m.toPremultipliedRenderColor(_?null:s.lut));l.uploadCommonUniforms(k,me,Ee);const{tileBoundsBuffer:nt,tileBoundsIndexBuffer:it,tileBoundsSegments:ht}=l.getTileBoundsBuffers(Oe);me.draw(l,L.TRIANGLES,J,Y,ie,mi.disabled,Ge,s.id,nt,it,ht)}},sky:function(l,t,s){const c=l._atmosphere?r.ah(l.transform.zoom):1,m=s.paint.get("sky-opacity")*c;if(m===0)return;const _=l.context,v=s.paint.get("sky-type"),S=new Xt(_.gl.LEQUAL,Xt.ReadOnly,[0,1]),A=l.frameCounter/1e3%1;v==="atmosphere"?l.renderPass==="offscreen"?s.needsSkyboxCapture(l)&&(function(k,L,B,O){const j=k.context,X=j.gl;let W=L.skyboxFbo;if(!W){W=L.skyboxFbo=j.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new qc(j),L.skyboxTexture=j.gl.createTexture(),X.bindTexture(X.TEXTURE_CUBE_MAP,L.skyboxTexture),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MAG_FILTER,X.LINEAR);for(let ue=0;ue<6;++ue)X.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,X.RGBA,32,32,0,X.RGBA,X.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(W.framebuffer),j.viewport.set([0,0,32,32]);const Y=L.getCenter(k,!0),J=k.getOrCreateProgram("skyboxCapture"),ie=new Float64Array(16);r.bx(ie),r.e3(ie,ie,.5*-Math.PI),Eo(k,L,J,ie,Y,0),r.bx(ie),r.e3(ie,ie,.5*Math.PI),Eo(k,L,J,ie,Y,1),r.bx(ie),r.cG(ie,ie,.5*-Math.PI),Eo(k,L,J,ie,Y,2),r.bx(ie),r.cG(ie,ie,.5*Math.PI),Eo(k,L,J,ie,Y,3),r.bx(ie),Eo(k,L,J,ie,Y,4),r.bx(ie),r.e3(ie,ie,Math.PI),Eo(k,L,J,ie,Y,5),j.viewport.set([0,0,k.width,k.height])}(l,s),s.markSkyboxValid(l)):l.renderPass==="sky"&&function(k,L,B,O,j){const X=k.context,W=X.gl,Y=k.transform,J=k.getOrCreateProgram("skybox");X.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_CUBE_MAP,L.skyboxTexture);const ie=((ue,pe,be,Te,xe)=>({u_matrix:ue,u_sun_direction:pe,u_cubemap:0,u_opacity:Te,u_temporal_offset:xe}))(Y.skyboxMatrix,L.getCenter(k,!1),0,O,j);k.uploadCommonUniforms(X,J),J.draw(k,W.TRIANGLES,B,vi.disabled,k.colorModeForRenderPass(),mi.backCW,ie,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(l,s,S,m,A):v==="gradient"&&l.renderPass==="sky"&&function(k,L,B,O,j){const X=k.context,W=X.gl,Y=k.transform,J=k.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new qc(X)),X.activeTexture.set(W.TEXTURE0);let ie=L.colorRampTexture;ie||(ie=L.colorRampTexture=new r.T(X,L.colorRamp,W.RGBA8)),ie.bind(W.LINEAR,W.CLAMP_TO_EDGE);const ue=((pe,be,Te,xe,me)=>({u_matrix:pe,u_color_ramp:0,u_center_direction:be,u_radius:r.al(Te),u_opacity:xe,u_temporal_offset:me}))(Y.skyboxMatrix,L.getCenter(k,!1),L.paint.get("sky-gradient-radius"),O,j);k.uploadCommonUniforms(X,J),J.draw(k,W.TRIANGLES,B,vi.disabled,k.colorModeForRenderPass(),mi.backCW,ue,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(l,s,S,m,A)},custom:function(l,t,s,c){const m=l.context,_=s.implementation;if(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes("custom")||l.terrain&&(l.terrain.renderingToTexture||l.renderPass==="offscreen")&&s.isDraped(t)){if(l.renderPass==="offscreen"){const v=_.prerender;if(v){if(l.setCustomLayerDefaults(),m.setColorMode(l.colorModeForRenderPass()),l.transform.projection.name==="globe"){const S=l.transform.pointMerc;v.call(_,m.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),r.ah(l.transform.zoom),[S.x,S.y],l.transform.pixelsPerMeterRatio)}else v.call(_,m.gl,l.transform.customLayerMatrix());m.setDirty(),l.setBaseState()}}else if(l.renderPass==="translucent"){if(l.terrain&&l.terrain.renderingToTexture){const S=_.renderToTile;if(S){const A=c[0].canonical,k={x:A.x+c[0].wrap*(_.wrapTileId?0:1<<A.z),y:A.y,z:A.z};m.setDepthMode(Xt.disabled),m.setStencilMode(vi.disabled),m.setColorMode(l.colorModeForRenderPass()),l.setCustomLayerDefaults(),S.call(_,m.gl,k),m.setDirty(),l.setBaseState()}return}l.setCustomLayerDefaults(),m.setColorMode(l.colorModeForRenderPass()),m.setStencilMode(vi.disabled);const v=_.renderingMode==="3d"?new Xt(l.context.gl.LEQUAL,Xt.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,Xt.ReadOnly);if(m.setDepthMode(v),l.transform.projection.name==="globe"){const S=l.transform.pointMerc;_.render(m.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),r.ah(l.transform.zoom),[S.x,S.y],l.transform.pixelsPerMeterRatio)}else _.render(m.gl,l.transform.customLayerMatrix());m.setDirty(),l.setBaseState(),m.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(l,t,s,c){if(l.renderPass==="opaque")return;const m=s.paint.get("model-opacity").constantOr(1);if(m===0)return;const _=s.paint.get("model-cast-shadows");if(l.renderPass==="shadow"&&(!_||l.terrain&&m<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof r.ab))return;const v=l.shadowRenderer,S=s.paint.get("model-receive-shadows");v&&(v.useNormalOffset=!0,S||(v.enabled=!1));const A=()=>{v&&(v.useNormalOffset=!0,S||(v.enabled=!0))},k=t.getSource();if(l.renderPass==="light-beam"&&k.type!=="batched-model")return;if(k.type==="vector"||k.type==="geojson")return function(J,ie,ue,pe,be){const Te=J.transform;if(Te.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${Te.projection.name} projection is not yet implemented`);const xe=Te.getFreeCameraOptions().position;if(!J.modelManager)return;const me=J.modelManager;ue.modelManager=me;const Ee=J.shadowRenderer;if(!ue._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ae=ue._unevaluatedLayout._values["model-id"],Oe=Object.assign({},ue.layout.get("model-id").parameters),Ge=J.style.order.indexOf(ue.fqid);for(const nt of pe){const it=ie.getTile(nt).getBucket(ue);if(!it||it.projection.name!==Te.projection.name)continue;const ht=it.getModelUris();ht&&!it.modelsRequested&&(me.addModelsFromBucket(ht,be),it.modelsRequested=!0);const Be=lo(nt,Te);Oe.zoom=Be;const Xe=Ae.possiblyEvaluate(Oe);if(je(J,it,nt),is.shadowUniformsInitialized=!1,is.useSingleShadowCascade=!!Ee&&Ee.getMaxCascadeForTile(nt.toUnwrapped())===0,J.renderPass==="shadow"&&Ee){if(J.currentShadowCascade===1&&it.isInsideFirstShadowMapFrustum)continue;const We=Te.calculatePosMatrix(nt.toUnwrapped(),Te.worldSize);if(is.tileMatrix.set(We),is.shadowTileMatrix=Float32Array.from(Ee.calculateShadowPassMatrixFromMatrix(We)),is.aabb.min.fill(0),is.aabb.max[0]=is.aabb.max[1]=r.aj,is.aabb.max[2]=0,Gd(it,is,J,ue.scope))continue}const ke=1<<nt.canonical.z,st=[((xe.x-nt.wrap)*ke-nt.canonical.x)*r.aj,(xe.y*ke-nt.canonical.y)*r.aj,xe.z*ke*r.aj];J.conflationActive&&Object.keys(it.instancesPerModel).length>0&&J.style.isLayerClipped(ue,ie.getSource())&&it.updateReplacement(nt,J.replacementSource,Ge,be)&&(it.uploaded=!1,it.upload(J.context));for(let We in it.instancesPerModel){const ut=it.instancesPerModel[We];ut.features.length>0&&(We=Xe.evaluate(ut.features[0].feature,{}));const Et=me.getModel(We,be);if(Et||me.hasURLBeenRequested(We)||it.modelUris.includes(We)||(it.modelUris.push(We),it.modelsRequested=!1),Et&&Et.uploaded)for(const ot of Et.nodes)oc(J,ue,ot,ut,st,nt,is)}}}(l,t,s,c,k.type==="vector"?s.scope:""),void A();if(!k.loaded())return;if(k.type==="batched-model")return function(J,ie,ue,pe){ue.resetLayerRenderingStats(J);const be=J.context,Te=J.transform,xe=J.style.fog,me=J.shadowRenderer;if(Te.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${Te.projection.name} projection is not yet implemented`);const Ee=J.transform.getFreeCameraOptions().position,Ae=r.bY([],[Ee.x,Ee.y,Ee.z],J.transform.worldSize),Oe=r.eb([],Ae),Ge=r.bx([]),nt=r.ec(Te.center.lat,Te.zoom),it=r.bn([],[1,1,1/nt]);r.bo(Ge,Ge,Oe);const ht=ue.paint.get("model-opacity").constantOr(1),Be=new Xt(be.gl.LEQUAL,Xt.ReadWrite,J.depthRangeFor3D),Xe=new Xt(be.gl.LEQUAL,Xt.ReadOnly,J.depthRangeFor3D),ke=new r.cW([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),st=J.renderPass==="shadow",We=st&&me?me.getCurrentCascadeFrustum():Te.getFrustum(Te.scaleZoom(Te.worldSize)),ut=ue.paint.get("model-front-cutoff"),Et=ut[2]<1,ot=xo(J,ue.paint.get("model-cutoff-fade-range")),yt=ue.getLayerRenderingStats();(function(jt,Wt,Ot,Zt){const ai=jt.terrain?jt.terrain.exaggeration():0,ui=jt.transform.zoom;for(const wi of Zt){const Ni=Wt.getTile(wi).getBucket(Ot);Ni&&(Ni.setFilter(Ot.filter),jt.conflationActive&&Ni.updateReplacement(wi,jt.replacementSource),Ni.evaluateTransform(jt,Ot),jt.terrain&&ai>0&&Ni.elevationUpdate(jt.terrain,ai,wi,Ot.source),Ni.needsReEvaluation(jt,ui,Ot)&&Ni.evaluate(Ot))}})(J,ie,ue,pe),function(){let jt,Wt,Ot;Et?(jt=pe.length-1,Wt=-1,Ot=-1):(jt=0,Wt=pe.length,Ot=1);const Zt=new Float64Array(16),ai=r.ef(),ui=new r.P(0,0);for(let wi=jt;wi!==Wt;wi+=Ot){const Ni=pe[wi],cn=ie.getTile(Ni).getBucket(ue);if(!cn||!cn.uploaded)continue;let Un=!1;me&&(Un=me.getMaxCascadeForTile(Ni.toUnwrapped())===0);const En=Te.calculatePosMatrix(Ni.toUnwrapped(),Te.worldSize),yn=cn.modelTraits;!st&&Et&&(r.bi(Zt,En),r.ad(ai,Ae,Zt),ui.x=ai[0],ui.y=ai[1]);const _r=[];cn.setFilter(ue.filter);for(const Ii of cn.getNodesInfo()){if(Ii.hiddenByReplacement||!Ii.node.meshes)continue;const Bi=Ii.node;let Yi=0;J.terrain&&Bi.elevation&&(Yi=Bi.elevation*J.terrain.exaggeration());const Gn=(()=>{const vr=Ii.aabb;return ke.min=[...vr.min],ke.max=[...vr.max],ke.min[2]+=Yi,ke.max[2]+=Yi,r.ad(ke.min,ke.min,En),r.ad(ke.max,ke.max,En),ke})(),Cr=Ii.evaluatedScale;if(Cr[0]<=1&&Cr[1]<=1&&Cr[2]<=1&&Gn.intersects(We)===0)continue;if(!st&&Et){const vr=.16666666666666666;Ii.cameraCollisionOpacity=Ae[0]>Gn.min[0]&&Ae[0]<Gn.max[0]&&Ae[1]>Gn.min[1]&&Ae[1]<Gn.max[1]&&Ae[2]*nt<Gn.max[2]&&Bi.footprint&&r.bS(ui,Bi.footprint)?Math.max(Ii.cameraCollisionOpacity-vr,0):Math.min(1,Ii.cameraCollisionOpacity+vr)}const Hn=[...En],wn=1/r.cU(Ni.canonical),pr=Bi.anchor?Bi.anchor[0]:0,an=Bi.anchor?Bi.anchor[1]:0;r.bo(Hn,Hn,[pr*(Cr[0]-1)+Ii.evaluatedTranslation[0]*wn,an*(Cr[1]-1)+Ii.evaluatedTranslation[1]*wn,Yi+Ii.evaluatedTranslation[2]]),r.ci(Cr,r.eg)||r.cE(Hn,Hn,Cr);const mr=r.az([],Hn,Bi.matrix),Kn=r.az([],Te.expandedFarZProjMatrix,mr),Mn=r.az([],Te.expandedFarZProjMatrix,Hn),Wn=r.aA([],[pr,an,Yi,1],Kn)[2];Bi.hidden=!1;let Fi=ht;st||(Et&&(Fi*=Ii.cameraCollisionOpacity,Fi*=Zc(Hn,Te,Ii.aabb,ut)),Fi*=Bf(ot,Wn)),Fi!==0?_r.push({nodeInfo:Ii,depth:Wn,opacity:Fi,wvpForNode:Kn,wvpForTile:Mn,nodeModelMatrix:mr,tileModelMatrix:Hn}):Bi.hidden=!0}st||_r.sort((Ii,Bi)=>!Et||Ii.opacity===1&&Bi.opacity===1?Ii.depth<Bi.depth?-1:1:Ii.opacity===1?-1:Bi.opacity===1?1:Ii.depth>Bi.depth?-1:1);for(const Ii of _r){const Bi=Ii.nodeInfo,Yi=Bi.node;let Gn=r.az([],it,Ii.tileModelMatrix);r.az(Gn,Ge,Gn);const Cr=r.bi([],Gn);r.ee(Cr,Cr),r.cE(Cr,Cr,Vh),Gn=r.az(Gn,Gn,Yi.matrix);const Hn=J.renderPass==="light-beam",wn=ue.paint.get("model-color-use-theme").constantOr("default")==="none",pr=yn&r.em.HasMapboxMeshFeatures,an=pr?0:Bi.evaluatedRMEA[0][2];for(let mr=0;mr<Yi.meshes.length;++mr){const Kn=Yi.meshes[mr],Mn=mr===Yi.lightMeshIndex;let Wn=Ii.wvpForNode;if(Mn){if(!Hn&&!J.terrain&&J.shadowRenderer){J.currentLayer<J.firstLightBeamLayer&&(J.firstLightBeamLayer=J.currentLayer);continue}Wn=Ii.wvpForTile}else if(Hn)continue;const Fi={defines:[]},vr=[];if(!st&&me&&(me.useNormalOffset=!!Kn.normalBuffer),wt(Fi.defines,vr,Kn,J,wn?null:ue.lut),pr||Fi.defines.push("DIFFUSE_SHADED"),Un&&Fi.defines.push("SHADOWS_SINGLE_CASCADE"),yt&&(st?yt.numRenderedVerticesInShadowPass+=Kn.vertexArray.length:yt.numRenderedVerticesInTransparentPass+=Kn.vertexArray.length),st){ur(Kn,Ii.nodeModelMatrix,J,ue);continue}let ns=null;if(xe){const Ur=ua(Ii.nodeModelMatrix,J.transform);if(ns=new Float32Array(Ur),Te.projection.name!=="globe"){const Co=Kn.aabb.min,uo=Kn.aabb.max,[ho,Ao]=xe.getOpacityForBounds(Ur,Co[0],Co[1],uo[0],uo[1]);Fi.overrideFog=ho>=Ze||Ao>=Ze}}const ir=Kn.material;let vn;ir.occlusionTexture&&ir.occlusionTexture.offsetScale&&(vn=ir.occlusionTexture.offsetScale,Fi.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const co=J.getOrCreateProgram("model",Fi);!st&&me&&me.setupShadowsFromMatrix(Ii.tileModelMatrix,co,me.useNormalOffset),J.uploadCommonUniforms(be,co,null,ns);const Xs=ir.pbrMetallicRoughness;Xs.metallicFactor=.9,Xs.roughnessFactor=.5;const Vo=Jl(new Float32Array(Wn),new Float32Array(Gn),new Float32Array(Cr),new Float32Array(Yi.matrix),J,Ii.opacity,Xs.baseColorFactor,ir.emissiveFactor,Xs.metallicFactor,Xs.roughnessFactor,ir,an,ue,[0,0,0],vn);!Mn&&(Bi.hasTranslucentParts||Ii.opacity<1)&&co.draw(J,be.gl.TRIANGLES,Be,vi.disabled,Wi.disabled,mi.backCCW,Vo,ue.id,Kn.vertexBuffer,Kn.indexBuffer,Kn.segments,ue.paint,J.transform.zoom,void 0,vr),co.draw(J,be.gl.TRIANGLES,Mn?Xe:Be,vi.disabled,Mn||Ii.opacity<1||Bi.hasTranslucentParts?Wi.alphaBlended:Wi.unblended,mi.backCCW,Vo,ue.id,Kn.vertexBuffer,Kn.indexBuffer,Kn.segments,ue.paint,J.transform.zoom,void 0,vr)}}}}()}(l,t,s,c),void A();if(k.type!=="model")return;const L=k.getModels(),B=[],O=l.transform.getFreeCameraOptions().position,j=r.bY([],[O.x,O.y,O.z],l.transform.worldSize);r.eb(j,j);const X=[],W=[];let Y=0;for(const J of L){const ie=s.paint.get("model-rotation").constantOr(null),ue=s.paint.get("model-scale").constantOr(null),pe=s.paint.get("model-translation").constantOr(null);J.computeModelMatrix(l,ie,ue,pe,!0,!0,!1);const be=r.bx([]),Te=r.ec(J.position.lat,l.transform.zoom),xe=r.bn([],[1,1,1/Te]);r.bo(be,be,j),B.push({zScaleMatrix:xe,negCameraPosMatrix:be});for(const me of J.nodes)pl(l.transform,me,J.matrix,l.transform.expandedFarZProjMatrix,Y,X,W);Y++}if(X.sort((J,ie)=>ie.depth-J.depth),l.renderPass!=="shadow"){if(m===1)for(const J of W)kt(J,l,s,B[J.modelIndex],vi.disabled,l.colorModeForRenderPass());else{for(const J of W)kt(J,l,s,B[J.modelIndex],vi.disabled,Wi.disabled);for(const J of W)kt(J,l,s,B[J.modelIndex],l.stencilModeFor3D(),l.colorModeForRenderPass());l.resetStencilClippingMasks()}for(const J of X)kt(J,l,s,B[J.modelIndex],vi.disabled,l.colorModeForRenderPass());A()}else{for(const J of W)ur(J.mesh,J.nodeModelMatrix,l,s);for(const J of X)ur(J.mesh,J.nodeModelMatrix,l,s);A()}}},qd={line:function(l,t,s){if(l.hasElevatedBuckets=!1,l.hasNonElevatedBuckets=!1,l._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||l._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const c=t.getVisibleCoordinates();for(const m of c){const _=t.getTile(m).getBucket(l);if(_&&(_.elevationType!=="none"?l.hasElevatedBuckets=!0:l.hasNonElevatedBuckets=!0,l.hasElevatedBuckets&&l.hasNonElevatedBuckets))break}}}else l.hasNonElevatedBuckets=!0},model:function(l,t,s){const c=t.getSource();if(!c.loaded())return;if(c.type==="vector"||c.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,c.type==="vector"?l.scope:""));if(c.type==="batched-model"||c.type!=="model")return;const m=c.getModels();for(const _ of m)_.upload(s.context)},raster:function(l,t,s){const c=t.getSource();if(!(c instanceof Dl&&c.loaded()))return;const m=l.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!m)return;const _=l.paint.get("raster-array-band")||c.getInitialBand(m);if(_==null)return;const v=t.getIds().map(S=>t.getTileByID(S));for(const S of v)S.updateNeeded(m,_)&&c.prepareTile(S,m,_)},"raster-particle":function(l,t,s){const c=t.getSource();if(!(c instanceof Dl&&c.loaded()))return;const m=l.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!m)return;const _=l.paint.get("raster-particle-array-band")||c.getInitialBand(m);if(_==null)return;const v=t.getIds().map(S=>t.getTileByID(S));for(const S of v)S.updateNeeded(m,_)&&c.prepareTile(S,m,_)}},Ua={fill:Nh},Zu={fill:function(l,t,s,c){if(!s.layout||s.layout.get("fill-elevation-reference")==="none")return;const m=l.context.gl,_=new Xt(m.LEQUAL,Xt.ReadOnly,l.depthRangeFor3D),v=new vi({func:m.ALWAYS,mask:255},255,255,m.KEEP,m.KEEP,m.REPLACE),S=l.transform.getFreeCameraOptions().position,A=l.getOrCreateProgram("elevatedStructuresDepthReconstruct",{defines:["DEPTH_RECONSTRUCTION"]});for(const k of c){const L=t.getTile(k),B=L.getBucket(s);if(!B)continue;const O=B.elevatedStructures;if(!O||O.maskSegments.segments[0].primitiveLength===0)continue;const j=Gu(k.toUnwrapped(),S),X=l.translatePosMatrix(k.projMatrix,L,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor")),W=so(X,j,0,0,0);A.draw(l,m.TRIANGLES,_,v,Wi.disabled,mi.disabled,W,s.id,O.vertexBuffer,O.indexBuffer,O.maskSegments,s.paint,l.transform.zoom)}}};class Xu{constructor(t,s,c,m,_,v){this.context=new Rp(t,s),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=r.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const S=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const k of S)this._debugParams.enabledLayers[k]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),_.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const k of S)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],k);this.occlusionParams=new jf(_),this.setup(),this.numSublayers=bs.maxUnderzooming+bs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Em(this),this._wireframeDebugCache=new Lp,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const A=new r.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,A,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=m,this.worldview=v}updateTerrain(t,s){const c=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(c||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ss(this,t));const m=this._terrain;this.transform.elevation=c?m:null,m.update(t,this.transform,s),this.transform.elevation&&!m.enabled&&(this.transform.elevation=null)}_updateFog(t){const s=t.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[c,m]=s.getFovAdjustedRange(this.transform._fov);if(c>m)return void(this.transform.fogCullDistSq=null);const _=c+.78*(m-c);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Ss(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,s){if(this.width=t*r.q.devicePixelRatio,this.height=s*r.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style.order)this.style._mergedLayers[c].resize()}setup(){const t=this.context,s=new r.ba;s.emplaceBack(0,0),s.emplaceBack(r.aj,0),s.emplaceBack(0,r.aj),s.emplaceBack(r.aj,r.aj),this.tileExtentBuffer=t.createVertexBuffer(s,r.bc.members),this.tileExtentSegments=r.bd.simpleSegment(0,0,4,2);const c=new r.ba;c.emplaceBack(0,0),c.emplaceBack(r.aj,0),c.emplaceBack(0,r.aj),c.emplaceBack(r.aj,r.aj),this.debugBuffer=t.createVertexBuffer(c,r.bc.members),this.debugSegments=r.bd.simpleSegment(0,0,4,5);const m=new r.ba;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,r.bc.members),this.viewportSegments=r.bd.simpleSegment(0,0,4,2);const _=new r.aZ;_.emplaceBack(0,0,0,0),_.emplaceBack(r.aj,0,r.aj,0),_.emplaceBack(0,r.aj,0,r.aj),_.emplaceBack(r.aj,r.aj,r.aj,r.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(_,r.bf.members),this.mercatorBoundsSegments=r.bd.simpleSegment(0,0,4,2);const v=new r.a_;v.emplaceBack(0,1,2),v.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(v);const S=new r.bb;for(const k of[0,1,3,2,0])S.emplaceBack(k);this.debugIndexBuffer=t.createIndexBuffer(S),this.emptyTexture=new r.T(t,new r.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=r.bz();const A=this.context.gl;this.stencilClearMode=new vi({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Xt.disabled,this.stencilClearMode,Wi.disabled,mi.disabled,vo(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,s,c){if(!s||this.currentStencilSource===s.id||!t.isTileClipped()||!c||c.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const A of c)if(this._tileClippingMaskIDs[A.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=s.id;const m=this.context,_=m.gl;this.nextStencilID+c.length>256&&this.clearStencil(),m.setColorMode(Wi.disabled),m.setDepthMode(Xt.disabled);const v=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of c){const A=s.getTile(S),k=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:B,tileBoundsSegments:O}=this.getTileBoundsBuffers(A);v.draw(this,_.TRIANGLES,Xt.disabled,new vi({func:_.ALWAYS,mask:0},k,255,_.KEEP,_.KEEP,_.REPLACE),Wi.disabled,mi.disabled,vo(S.projMatrix),"$clipping",L,B,O)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new vi({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new vi({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,c=t.sort((v,S)=>S.overscaledZ-v.overscaledZ),m=c[c.length-1].overscaledZ,_=c[0].overscaledZ-m+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const v={};for(let S=0;S<_;S++)v[S+m]=new vi({func:s.GEQUAL,mask:255},S+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=_,[v,c]}return[{[m]:vi.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Wi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new r.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Wi.unblended:Wi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Wi([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new r.am(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,s,c,m=!1){if(this.depthOcclusion)return new Xt(this.context.gl.GREATER,Xt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!m)return Xt.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Xt(c||this.context.gl.LEQUAL,s,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,s=Math.ceil(this.width),c=Math.ceil(this.height),m=this.context.bindFramebuffer.get(),_=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===c||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&c!==0&&(this.depthFBO=new Uu(this.context,s,c,!1,"texture"),this.depthTexture=new r.T(this.context,{width:s,height:c,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(m),t.bindTexture(t.TEXTURE_2D,_),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,s,c,0,0,s,c,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,s)=>t+s/this._fpsHistory.length,0))}render(t,s){const c=r.q.now();this._dt=c-this._timeStamp,this._timeStamp=c,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=s;const m=this.style._mergedLayers,_=!(!this.terrain||!this.terrain.enabled),v=()=>this.style._getOrder(_).filter(Be=>{const Xe=m[Be];return!(Xe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Xe.type]});let S=v(),A=!1,k=!1;for(const Be of S){const Xe=m[Be];Xe.type==="circle"&&(A=!0),Xe.type==="symbol"&&(Xe.hasInitialOcclusionOpacityProperties?k=!0:A=!0)}let L=S.map(Be=>m[Be]);const B=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(r.q.now()),this.imageManager.beginFrame();let O=0,j=!1;for(const Be in B){const Xe=B[Be];Xe.used&&(Xe.prepare(this.context),Xe.getSource().usedInConflation&&++O)}let X=!1;for(const Be of L)Be.isHidden(this.transform.zoom)||(Be.type==="clip"&&(X=!0),this.prepareLayer(Be));const W={},Y={},J={},ie={},ue={};for(const Be in B){const Xe=B[Be];W[Be]=Xe.getVisibleCoordinates(),Y[Be]=W[Be].slice().reverse(),J[Be]=Xe.getVisibleCoordinates(!0).reverse(),ie[Be]=Xe.getShadowCasterCoordinates(),ue[Be]=Xe.sortCoordinatesByDistance(W[Be])}const pe=Be=>{const Xe=this.style.getLayerSourceCache(Be);return Xe&&Xe.used?Xe.getSource():null};if(O||X||this._clippingActiveLastFrame){const Be=[],Xe=[];let ke=0;for(const st of L)this.isSourceForClippingOrConflation(st,pe(st))&&(Be.push(st),Xe.push(ke)),ke++;if(Be&&(X||Be.length>1)||this._clippingActiveLastFrame){X=!1;const st=[];for(let We=0;We<Be.length;We++){const ut=Be[We],Et=Xe[We],ot=this.style.getLayerSourceCache(ut);if(!ot||!ot.used||!ot.getSource().usedInConflation&&ut.type!=="clip")continue;let yt=r.eu,jt=r.bQ.None;const Wt=[];let Ot=!0;if(ut.type==="clip"){yt=Et;for(const Zt of ut.layout.get("clip-layer-types"))jt|=Zt==="model"?r.bQ.Model:Zt==="symbol"?r.bQ.Symbol:r.bQ.FillExtrusion;for(const Zt of ut.layout.get("clip-layer-scope"))Wt.push(Zt);ut.isHidden(this.transform.zoom)?Ot=!1:X=!0}Ot&&st.push({layer:ut.fqid,cache:ot,order:yt,clipMask:jt,clipScope:Wt})}this.replacementSource.setSources(st),j=!0}}this._clippingActiveLastFrame=X,j||this.replacementSource.clear(),this.conflationActive=j,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Be=0;Be<L.length;Be++){const Xe=L[Be],ke=Xe.cutoffRange();if(this.longestCutoffRange=Math.max(ke,this.longestCutoffRange),ke>0){const st=pe(Xe);st&&(this.minCutoffZoom=Math.max(st.minzoom,this.minCutoffZoom)),Xe.minzoom&&(this.minCutoffZoom=Math.max(Xe.minzoom,this.minCutoffZoom))}Xe.is3D(_)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Be),this._lastOcclusionLayer=Be)}const be=this.style&&this.style.fog;be?(this._fogVisible=be.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=be.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(J),this.opaquePassCutoff=0,S=v(),L=S.map(Be=>m[Be]));const Te=this._shadowRenderer;if(Te){Te.updateShadowParameters(this.transform,this.style.directionalLight);for(const Be in B)for(const Xe of W[Be]){let ke={min:0,max:0};this.terrain&&(ke=this.terrain.getMinMaxForTile(Xe)||ke),Te.addShadowReceiver(Xe.toUnwrapped(),ke.min,ke.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.ev(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ba(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const xe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),me=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(xe&&!this._snow&&(this._snow=new Yn(this)),!xe&&this._snow&&(this._snow.destroy(),delete this._snow),me&&!this._rain&&(this._rain=new zp(this)),!me&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!js.has(this.context.gl))return;this.renderPass="offscreen";for(const Be of L){const Xe=t.getLayerSourceCache(Be);if(!Be.hasOffscreenPass()||Be.isHidden(this.transform.zoom))continue;const ke=Xe?Y[Xe.id]:void 0;(Be.type==="custom"||Be.type==="raster"||Be.type==="raster-particle"||Be.isSky()||ke&&ke.length)&&this.renderLayer(this,Xe,Be,ke)}this.depthRangeFor3D=[0,1-(L.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ie)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ee=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ae=(()=>{if(s.showOverdrawInspector)return r.am.black;const Be=this.style.fog;if(Be&&this.transform.projection.supportsFog){const Xe=this.style.getLut(Be.scope);if(!Ee){const ke=Be.properties.get("color-use-theme")==="none",st=Be.properties.get("color").toNonPremultipliedRenderColor(ke?null:Xe).toArray01();return new r.am(...st)}if(Ee){const ke=Be.properties.get("space-color-use-theme")==="none",st=Be.properties.get("space-color").toNonPremultipliedRenderColor(ke?null:Xe).toArray01();return new r.am(...st)}}return r.am.transparent})();if(this.context.clear({color:Ae,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ee&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const Be=L[this.currentLayer],Xe=t.getLayerSourceCache(Be);if(Be.isSky())continue;const ke=Xe?(Be.is3D(_)?ue:Y)[Xe.id]:void 0;this._renderTileClippingMasks(Be,Xe,ke),this.renderLayer(this,Xe,Be,ke)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ee&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const Be=L[this.currentLayer],Xe=t.getLayerSourceCache(Be);Be.isSky()&&this.renderLayer(this,Xe,Be,Xe?Y[Xe.id]:void 0)}function Oe(Be,Xe){let ke;return Xe&&(ke=(Be.type==="symbol"?J:Be.is3D(_)?ue:Y)[Xe.id]),ke}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<S.length;){const Be=L[this.currentLayer];if(Be.type==="raster"||Be.type==="raster-particle"){const Xe=t.getLayerSourceCache(Be);this.renderLayer(this,Xe,Be,Oe(Be,Xe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ge=0;Te&&(Ge=Te.getShadowCastingLayerCount());let nt=!1,it=-1;for(let Be=0;Be<S.length;++Be){const Xe=L[Be];Xe.isHidden(this.transform.zoom)||Xe.is3D(_)&&(it=Be)}k&&it===-1&&(A=!0);let ht=!1;for(;this.currentLayer<S.length;){const Be=L[this.currentLayer],Xe=t.getLayerSourceCache(Be);if(Be.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Be)){if(Be.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!ht&&Be.is3D(_)&&!_){const ke=this.currentLayer,st=We=>{for(this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){const ut=L[this.currentLayer];if(Ua[ut.type]){const Et=this.style.getLayerSourceCache(ut);Ua[ut.type](this,Et,ut,Oe(ut,Et),We)}}};st("initialize"),st("reset"),this.currentLayer=ke,ht=!0}if(A&&!nt&&this.terrain&&!this.transform.isOrthographic&&(nt=!0,this.blitDepth()),k&&it!==-1&&this.currentLayer===it+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Be,Xe,Xe?W[Xe.id]:void 0),this.renderLayer(this,Xe,Be,Oe(Be,Xe)),!this.terrain&&Te&&Ge>0&&Be.hasShadowPass()&&--Ge==0){{this.clearStencil();const ke=this.currentLayer;for(this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){const st=L[this.currentLayer];if(Zu[st.type]){const We=this.style.getLayerSourceCache(st);Zu[st.type](this,We,st,Oe(st,We))}}this.currentLayer=ke}if(Te.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const ke=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ke;this.currentLayer++){const st=L[this.currentLayer];if(!st.hasLightBeamPass())continue;const We=t.getLayerSourceCache(st);this.renderLayer(this,We,st,We?Y[We.id]:void 0)}this.currentLayer=ke,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ke=this.currentLayer;this.depthOcclusion=!0;for(const st of this.layersWithOcclusionOpacity){this.currentLayer=st;const We=L[this.currentLayer],ut=t.getLayerSourceCache(We),Et=ut?Y[ut.id]:void 0;this.terrain||this._renderTileClippingMasks(We,ut,ut?W[ut.id]:void 0),this.renderLayer(this,ut,We,Et)}this.depthOcclusion=!1,this.currentLayer=ke,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Be=null;L.forEach(Xe=>{const ke=t.getLayerSourceCache(Xe);ke&&!Xe.isHidden(this.transform.zoom)&&ke.getVisibleCoordinates().length&&(!Be||Be.getSource().maxzoom<ke.getSource().maxzoom)&&(Be=ke)}),Be&&this.options.showTileBoundaries&&So(this,Be,Be.getVisibleCoordinates(),r.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&So(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Be){const Xe=Be.transform.padding;Hu(Be,Be.transform.height-(Xe.top||0),3,Na),Hu(Be,Xe.bottom||0,3,jh),Rr(Be,Xe.left||0,3,Cs),Rr(Be,Be.transform.width-(Xe.right||0),3,dl);const ke=Be.transform.centerPoint;(function(st,We,ut,Et){fl(st,We-1,ut-10,2,20,Et),fl(st,We-10,ut-1,20,2,Et)})(Be,ke.x,Be.transform.height-ke.y,As)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),j||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:s}=this.transform.projection,c=!s||!s.includes(t.type);if(qd[t.type]&&(c||this.terrain&&t.type==="custom")){const m=this.style.getLayerSourceCache(t);qd[t.type](t,m,this)}this.gpuTimingEnd()}renderLayer(t,s,c,m){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="sky"||c.type==="custom"||c.type==="model"||c.type==="raster"||c.type==="raster-particle"||m&&m.length)&&(this.id=c.id,this.gpuTimingStart(c),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(c.type)&&(!t.terrain||c.type!=="custom")||c.type==="clip"||hn[c.type](t,s,c,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,c=this.context.gl;let m=this.gpuTimers[t.id];m||(m=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:c.createQuery()}),m.calls++,c.beginQuery(s.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,s=this.context.gl,c=s.createQuery();this.deferredRenderGpuTimeQueries.push(c),s.beginQuery(t.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const s={};for(const c in t){const m=t[c],_=this.context.extTimerQuery,v=_.getQueryParameter(m.query,this.context.gl.QUERY_RESULT)/1e6;_.deleteQueryEXT(m.query),s[c]=v}return s}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.gl;let c=0;for(const m of t)c+=s.getQueryParameter(m,s.QUERY_RESULT)/1e6,s.deleteQuery(m);return c}translatePosMatrix(t,s,c,m,_){if(!c[0]&&!c[1])return t;const v=_?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(v){const k=Math.sin(v),L=Math.cos(v);c=[c[0]*L-c[1]*k,c[0]*k+c[1]*L]}const S=[_?c[0]:r.aw(s,c[0],this.transform.zoom),_?c[1]:r.aw(s,c[1],this.transform.zoom),0],A=new Float32Array(16);return r.bo(A,t,S),A}saveTileTexture(t){const s=t.size[0],c=this._tileTextures[s];c?c.push(t):this._tileTextures[s]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,s,c){const m=c===void 0?this.terrain&&this.terrain.renderingToTexture:c,_=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(_.push("LIGHTING_3D_MODE"),_.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):m||_.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||_.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(_.push("TERRAIN"),this.linearFloatFilteringSupported()&&_.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&_.push("GLOBE"),!this._fogVisible||m||s!==void 0&&!s||_.push("FOG","FOG_DITHERING"),m&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}getOrCreateProgram(t,s){this.cache=this.cache||{};const c=s&&s.defines||[],m=s&&s.config,_=this.currentGlobalDefines(t,s&&s.overrideFog,s&&s.overrideRtt).concat(c),v=Vc.cacheKey(Ih[t],t,_,m);return this.cache[v]||(this.cache[v]=new Vc(this.context,t,Ih[t],m,$c[t],_)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,s){if(this.style.enable3dLights()){const c=this.style.directionalLight,m=this.style.ambientLight;if(c&&m){const _=((v,S,A)=>{const k=v.properties.get("direction"),L=v.properties.get("color-use-theme")==="none",B=v.properties.get("color").toNonPremultipliedRenderColor(L?null:A.getLut(v.scope)).toArray01(),O=v.properties.get("intensity"),j=S.properties.get("color-use-theme")==="none",X=S.properties.get("color").toNonPremultipliedRenderColor(j?null:A.getLut(S.scope)).toArray01(),W=S.properties.get("intensity"),Y=[k.x,k.y,k.z],J=r.dw(X,W),ie=r.dw(B,O);return{u_lighting_ambient_color:J,u_lighting_directional_dir:Y,u_lighting_directional_color:ie,u_ground_radiance:jc(Y,ie,J)}})(c,m,this.style);s.setLightsUniformValues(t,_)}}}uploadCommonUniforms(t,s,c,m,_){if(this.uploadCommonLightUniforms(t,s),this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const S=v.getOpacity(this.transform.pitch),A=((k,L,B,O,j,X,W,Y,J,ie,ue,pe)=>{const be=k.transform,Te=L.properties.get("color-use-theme")==="none",xe=L.properties.get("color").toNonPremultipliedRenderColor(Te?null:k.style.getLut(L.scope)).toArray01();xe[3]=O;const me=k.frameCounter/1e3%1,[Ee,Ae]=L.properties.get("vertical-range");return{u_fog_matrix:B?be.calculateFogTileMatrix(B):pe||k.identityMat,u_fog_range:L.getFovAdjustedRange(be._fov),u_fog_color:xe,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ee,Ae),Ae],u_fog_temporal_offset:me,u_frustum_tl:j,u_frustum_tr:X,u_frustum_br:W,u_frustum_bl:Y,u_globe_pos:J,u_globe_radius:ie,u_viewport:ue,u_globe_transition:r.ah(be.zoom),u_is_globe:+(be.projection.name==="globe")}})(this,v,c,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.q.devicePixelRatio,this.transform.height*r.q.devicePixelRatio],m);s.setFogUniformValues(t,A)}_&&s.setCutoffUniformValues(t,_.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,s=this._backgroundTiles={},c=this.transform.coveringTiles({tileSize:512});for(const m of c)s[m.key]=t[m.key]||new Ol(m,512,this.transform.tileZoom,this,void 0,this.worldview);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,s){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[t.key];return s||(this._cachedTileFogOpacities[t.key]=s=this.style.fog.getOpacityForTile(t)),s[0]>=Ze||s[1]>=Ze}setupDepthForOcclusion(t,s,c){const m=this.context,_=m.gl,v=!!c;var S;c||(c={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),m.activeTexture.set(_.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),c.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],c.u_depth_range_unpack=[2/((S=this.depthRangeFor3D)[1]-S[0]),-1-2*S[0]/(S[1]-S[0])],c.u_occluder_half_size=.5*this.occlusionParams.occluderSize,c.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),m.activeTexture.set(_.TEXTURE0),v||s.setTerrainUniformValues(m,c)}}function ml(l,t){let s=!1,c=null;const m=()=>{c=null,s&&(l(),c=setTimeout(m,t),s=!1)};return()=>(s=!0,c||m(),c)}class Vf{constructor(t){this._hashName=t&&encodeURIComponent(t),r.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ml(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const s=Zd(t);if(this._hashName){const c=this._hashName;let m=!1;const _=location.hash.slice(1).split("&").map(v=>{const S=v.split("=")[0];return S===c?(m=!0,`${S}=${s}`):v}).filter(v=>v);return m||_.push(`${c}=${s}`),`#${_.join("&")}`}return`#${s}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(s=c)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(c=>isNaN(Number(c)))){const c=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(s[3]||0):t.getBearing();return t.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:c,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Zd(l,t){const s=l.getCenter(),c=Math.round(100*l.getZoom())/100,m=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,m),v=Math.round(s.lng*_)/_,S=Math.round(s.lat*_)/_,A=l.getBearing(),k=l.getPitch();let L=t?`/${v}/${S}/${c}`:`${c}/${S}/${v}`;return(A||k)&&(L+="/"+Math.round(10*A)/10),k&&(L+=`/${Math.round(k)}`),L}const Xc={linearity:.3,easing:r.ew(0,0,.3,1)},Xd=r.h({deceleration:2500,maxSpeed:1400},Xc),ha=r.h({deceleration:20,maxSpeed:1400},Xc),da=r.h({deceleration:1e3,maxSpeed:360},Xc),$h=r.h({deceleration:1e3,maxSpeed:90},Xc);class Yd{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=r.q.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)s.zoom+=_.zoomDelta||0,s.bearing+=_.bearingDelta||0,s.pitch+=_.pitchDelta||0,_.panDelta&&s.pan._add(_.panDelta),_.around&&(s.around=_.around),_.pinchAround&&(s.pinchAround=_.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const _=Ws(s.pan.mag(),c,r.h({},Xd,t||{}));m.offset=s.pan.mult(_.amount/s.pan.mag()),m.center=this._map.transform.center,Yu(m,_)}if(s.zoom){const _=Ws(s.zoom,c,ha);m.zoom=this._map.transform.zoom+_.amount,Yu(m,_)}if(s.bearing){const _=Ws(s.bearing,c,da);m.bearing=this._map.transform.bearing+r.ay(_.amount,-179,179),Yu(m,_)}if(s.pitch){const _=Ws(s.pitch,c,$h);m.pitch=this._map.transform.pitch+_.amount,Yu(m,_)}if(m.zoom||m.bearing){const _=s.pinchAround===void 0?s.around:s.pinchAround;m.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function Yu(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function Ws(l,t,s){const{maxSpeed:c,linearity:m,deceleration:_}=s,v=r.ay(l*m/(t/1e3),-c,c),S=Math.abs(v)/(_*m);return{easing:s.easing,duration:1e3*S,amount:v*(S/2)}}class Xr extends r.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,c,m={}){const _=Yt(s.getCanvasContainer(),c),v=s.unproject(_);super(t,r.h({point:_,lngLat:v,originalEvent:c},m)),this._defaultPrevented=!1,this.target=s}}class gl extends r.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,c){const m=t==="touchend"?c.changedTouches:c.touches,_=vt(s.getCanvasContainer(),m),v=_.map(A=>s.unproject(A)),S=_.reduce((A,k,L,B)=>A.add(k.div(B.length)),new r.P(0,0));super(t,{points:_,point:S,lngLats:v,lngLat:s.unproject(S),originalEvent:c}),this._defaultPrevented=!1}}class _l extends r.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class Kd{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new _l(this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Xr(t.type,this._map,t))}mouseup(t){this._map.fire(new Xr(t.type,this._map,t))}preclick(t){const s=r.h({},t);s.type="preclick",this._map.fire(new Xr(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Xr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Xr(t.type,this._map,t))}mouseover(t){this._map.fire(new Xr(t.type,this._map,t))}mouseout(t){this._map.fire(new Xr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new gl(t.type,this._map,t))}touchmove(t){this._map.fire(new gl(t.type,this._map,t))}touchend(t){this._map.fire(new gl(t.type,this._map,t))}touchcancel(t){this._map.fire(new gl(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hh{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Xr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Xr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wh{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(Tt(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const c=s,m=this._startPos,_=this._lastPos;if(!m||!_||_.equals(c)||!this._box&&c.dist(m)<this._clickTolerance)return;this._lastPos=c,this._box||(this._box=ve("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(m.x,c.x),S=Math.max(m.x,c.x),A=Math.min(m.y,c.y),k=Math.max(m.y,c.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${A}px)`,this._box.style.width=S-v+"px",this._box.style.height=k-A+"px")})}mouseupWindow(t,s){if(!this._active)return;const c=this._startPos,m=s;if(c&&t.button===0){if(this.reset(),Bt(),c.x!==m.x||c.y!==m.y)return this._map.fire(new r.A("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(c,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),It(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new r.A(t,{originalEvent:s}))}}function Ga(l,t){const s={};for(let c=0;c<l.length;c++)s[l[c].identifier]=t[c];return s}class Yr{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,s,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(m){const _=new r.P(0,0);for(const v of m)_._add(v);return _.div(m.length)}(s),this.touches=Ga(c,s)))}touchmove(t,s,c){if(this.aborted||!this.centroid)return;const m=Ga(c,s);for(const _ in this.touches){const v=m[_];(!v||v.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,s,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Yc{constructor(t){this.singleTap=new Yr(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,s,c){this.singleTap.touchstart(t,s,c)}touchmove(t,s,c){this.singleTap.touchmove(t,s,c)}touchend(t,s,c){const m=this.singleTap.touchend(t,s,c);if(m){const _=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(m)<30;if(_&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Uf{constructor(){this._zoomIn=new Yc({numTouches:1,numTaps:2}),this._zoomOut=new Yc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,c){this._zoomIn.touchstart(t,s,c),this._zoomOut.touchstart(t,s,c)}touchmove(t,s,c){this._zoomIn.touchmove(t,s,c),this._zoomOut.touchmove(t,s,c)}touchend(t,s,c){const m=this._zoomIn.touchend(t,s,c),_=this._zoomOut.touchend(t,s,c);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()+1,around:v.unproject(m)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()-1,around:v.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Jd={0:1,2:2},yl={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Ku{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const c=Jt(t);this._correctButton(t,c)&&(this._lastPoint=s,this._eventButton=c)}mousemoveWindow(t,s){const c=this._lastPoint;if(c){if(t.preventDefault(),this._eventButton!=null&&function(m,_){const v=Jd[_];return m.buttons===void 0||(m.buttons&v)!==v}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(c,s)}}mouseupWindow(t){this._lastPoint&&Jt(t)===this._eventButton&&(this._moved&&Bt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qd extends Ku{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class qh extends Ku{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?yl[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const c=.8*(s.x-t.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Kc extends Ku{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?yl[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const c=-.5*(s.y-t.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class qs{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),r.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(t,s,c){return this._calculateTransform(t,s,c)}touchmove(t,s,c){if(this._active&&!(c.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(c.length===1&&!r.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,s,c)}}touchend(t,s,c){this._calculateTransform(t,s,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,c){c.length>0&&(this._active=!0);const m=Ga(c,s),_=new r.P(0,0),v=new r.P(0,0);let S=0;for(const k in m){const L=m[k],B=this._touches[k];B&&(_._add(L),v._add(L.sub(B)),S++,m[k]=L)}if(this._touches=m,S<this._minTouches||!v.mag())return;const A=v.div(S);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(S),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ve("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class gs{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,s,c){return{}}touchstart(t,s,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,c){const m=this._firstTwoTouches;if(!m)return;t.preventDefault();const[_,v]=m,S=Jc(c,s,_),A=Jc(c,s,v);if(!S||!A)return;const k=this._aroundCenter?null:S.add(A).div(2);return this._move([S,A],k,t)}touchend(t,s,c){if(!this._firstTwoTouches)return;const[m,_]=this._firstTwoTouches,v=Jc(c,s,m),S=Jc(c,s,_);v&&S||(this._active&&Bt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Jc(l,t,s){for(let c=0;c<l.length;c++)if(l[c].identifier===s)return t[c]}function Ju(l,t){return Math.log(l/t)/Math.LN2}class ef extends gs{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Ju(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ju(this._distance,c),pinchAround:s}}}function Zh(l,t){return 180*l.angleWith(t)/Math.PI}class Gf extends gs{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const c=this._vector;if(this._vector=t[0].sub(t[1]),c&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Zh(this._vector,c),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,c=this._startVector;if(!c)return!1;const m=Zh(t,c);return Math.abs(m)<s}}function Qu(l){return Math.abs(l.y)>Math.abs(l.x)}class $f extends gs{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Qu(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,c){const m=this._lastPoints;if(!m)return;const _=t[0].sub(m[0]),v=t[1].sub(m[1]);return this._map._cooperativeGestures&&!r.ex()&&c.touches.length<3||(this._valid=this.gestureBeginsVertically(_,v,c.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+v.y)/2*-.5})}gestureBeginsVertically(t,s,c){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,_=s.mag()>=2;if(!m&&!_)return;if(!m||!_)return this._firstMove==null&&(this._firstMove=c),c-this._firstMove<100&&void 0;const v=t.y>0==s.y>0;return Qu(t)&&Qu(s)&&v}}const tf={panStep:100,bearingStep:15,pitchStep:10};class Hf{constructor(){const t=tf;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,c=0,m=0,_=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(c=0,m=0),{cameraAnimation:S=>{const A=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Wf,zoom:s?Math.round(A)+s*(t.shiftKey?2:1):A,bearing:S.getBearing()+c*this._bearingStep,pitch:S.getPitch()+m*this._pitchStep,offset:[-_*this._panStep,-v*this._panStep],center:S.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Wf(l){return l*(2-l)}const Xh=4.000244140625,nf=1/450;class qf{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=nf,r.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||r.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=r.q.now(),m=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,s!==0&&s%Xh==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Yt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>Xh?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&L!==0&&(L=1/L);const B=s(),O=Math.pow(2,B),j=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(j*L))),this._type==="wheel"&&(this._startZoom=B,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const c=typeof this._targetZoom=="number"?this._targetZoom:s(),m=this._startZoom,_=this._easing;let v,S=!1;if(this._type==="wheel"&&m&&_){const k=Math.min((r.q.now()-this._lastWheelEventTime)/200,1),L=_(k);v=r.ai(m,c,L),k<1?this._frameId||(this._frameId=!0):S=!0}else v=c,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=v-s();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=r.ey;if(this._prevEase){const c=this._prevEase,m=(r.q.now()-c.start)/c.duration,_=c.easing(m+.01)-c.easing(m),v=.27/Math.sqrt(_*_+1e-4)*.01,S=Math.sqrt(.0729-v*v);s=r.ew(v,S,.25,1)}return this._prevEase={start:r.q.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ve("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class rf{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Yh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(t.shiftKey?-1:1),around:c.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fp{constructor(){this._tap=new Yc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,s,c){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=s[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(t,s,c))}touchmove(t,s,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const m=s[0],_=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,s,c)}touchend(t,s,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(t,s,c)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zf{constructor(t,s,c){this._el=t,this._mousePan=s,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Xf{constructor(t,s,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Op{constructor(t,s,c,m){this._el=t,this._touchZoom=s,this._touchRotate=c,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Qc=l=>l.zoom||l.drag||l.pitch||l.rotate;class Vn extends r.A{}class Np{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const c=r.at([],s,t);this.radius=r.ae(c[2]<0?r.eA([],c,this.constants):[c[0],c[1],0])}projectRay(t){r.eA(t,t,this.constants),r.au(t,t),r.eB(t,t,this.constants);const s=r.bY([],t,this.radius);if(s[2]>0){const c=r.bY([],[0,0,1],r.bG(s,[0,0,1])),m=r.bY([],r.au([],[s[0],s[1],0]),this.radius),_=r.cV([],s,r.bY([],r.at([],r.cV([],m,c),s),2));s[0]=_[0],s[1]=_[1]}return s}}function Kh(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class Jh{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Yd(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Np,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),r.aV(["handleEvent","handleWindowEvent"],this);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,_,v]of this._listeners){const S=m===document?this.handleWindowEvent:this.handleEvent;m.addEventListener(_,S,v)}}destroy(){for(const[t,s,c]of this._listeners){const m=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(s,m,c)}}_addDefaultHandlers(t){const s=this._map,c=s.getCanvasContainer();this._add("mapEvent",new Kd(s,t));const m=s.boxZoom=new Wh(s,t);this._add("boxZoom",m);const _=new Uf,v=new Yh;s.doubleClickZoom=new rf(v,_),this._add("tapZoom",_),this._add("clickZoom",v);const S=new Fp;this._add("tapDragZoom",S);const A=s.touchPitch=new $f(s);this._add("touchPitch",A);const k=new qh(t),L=new Kc(t);s.dragRotate=new Xf(t,k,L),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const B=new Qd(t),O=new qs(s,t);s.dragPan=new Zf(c,B,O),this._add("mousePan",B),this._add("touchPan",O,["touchZoom","touchRotate"]);const j=new Gf,X=new ef;s.touchZoomRotate=new Op(c,X,j,S),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Hh(s));const W=s.scrollZoom=new qf(s,this);this._add("scrollZoom",W,["mousePan"]);const Y=s.keyboard=new Hf;this._add("keyboard",Y);for(const J of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[J]&&s[J].enable(t[J])}_add(t,s,c){this._handlers.push({handlerName:t,handler:s,allowed:c}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Qc(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,s,c){for(const m in t)if(m!==c&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const c of t)this._el.contains(c.target)&&s.push(c);return s}handleEvent(t,s){this._updatingCamera=!0;const c=t.type==="renderFrame",m=c?void 0:t,_={needsRenderFrame:!1},v={},S={},A=t.touches?this._getMapTouches(t.touches):void 0,k=A?vt(this._el,A):c?void 0:Yt(this._el,t);for(const{handlerName:O,handler:j,allowed:X}of this._handlers){if(!j.isEnabled())continue;let W;this._blockedByActive(S,X,O)?j.reset():j[s||t.type]&&(W=j[s||t.type](t,k,A),this.mergeHandlerResult(_,v,W,O,m),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||j.isActive())&&(S[O]=j)}const L={};for(const O in this._previousActiveHandlers)S[O]||(L[O]=m);this._previousActiveHandlers=S,(Object.keys(L).length||Kh(_))&&(this._changes.push([_,v,L]),this._triggerRenderFrame()),(Object.keys(S).length||Kh(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=_;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(t,s,c,m,_){if(!c)return;r.h(t,c);const v={handlerName:m,originalEvent:c.originalEvent||_};c.zoomDelta!==void 0&&(s.zoom=v),c.panDelta!==void 0&&(s.drag=v),c.pitchDelta!==void 0&&(s.pitch=v),c.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const t={},s={},c={};for(const[m,_,v]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new r.P(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),r.h(s,_),r.h(c,v);this._updateMapTransform(t,s,c),this._changes=[]}_updateMapTransform(t,s,c){const m=this._map,_=m.transform,v=ie=>[ie.x,ie.y,ie.z];if((ie=>{const ue=this._eventsInProgress.drag;return ue&&!this._handlersById[ue.handlerName].isActive()})()&&!Kh(t)){const ie=_.zoom;_.cameraElevationReference="sea",this._originalZoom!=null&&_._orthographicProjectionAtLowPitch&&_.projection.name!=="globe"&&_.pitch===0?(_.cameraElevationReference="ground",_.zoom=this._originalZoom):(_.recenterOnTerrain(),_.cameraElevationReference="ground"),ie!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&m._stop(!0),!Kh(t))return void this._fireEvents(s,c,!0);let{panDelta:S,zoomDelta:A,bearingDelta:k,pitchDelta:L,around:B,aroundCoord:O,pinchAround:j}=t;_._isCameraConstrained&&(A>0&&(A=0),_._isCameraConstrained=!1),j!==void 0&&(B=j),(A||(ie=>s[ie]&&!this._eventsInProgress[ie])("drag"))&&B&&(this._dragOrigin=v(_.pointCoordinate3D(B)),this._originalZoom=_.zoom,this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",m._stop(!0),B=B||m.transform.centerPoint,k&&(_.bearing+=k),L&&(_.pitch+=L),_._updateCameraState();const X=[0,0,0];if(S)if(_.projection.name==="mercator"){const ie=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(B).dir),ue=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(B.sub(S)).dir);X[0]=ue[0]-ie[0],X[1]=ue[1]-ie[1]}else{const ie=_.pointCoordinate(B);if(_.projection.name==="globe"){S=S.rotate(-_.angle);const ue=_._pixelsPerMercatorPixel/_.worldSize;X[0]=-S.x*r.ez(r.aY(ie.y))*ue,X[1]=-S.y*r.ez(_.center.lat)*ue}else{const ue=_.pointCoordinate(B.sub(S));ie&&ue&&(X[0]=ue.x-ie.x,X[1]=ue.y-ie.y)}}const W=_.zoom,Y=[0,0,0];if(A){const ie=v(O||_.pointCoordinate3D(B)),ue={dir:r.au([],r.at([],ie,_._camera.position))};if(ue.dir[2]<0){const pe=_.zoomDeltaToMovement(ie,A);r.bY(Y,ue.dir,pe)}}const J=r.cV(X,X,Y);_._translateCameraConstrained(J),A&&Math.abs(_.zoom-W)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,c,!0)}_fireEvents(t,s,c){const m=Qc(this._eventsInProgress),_=Qc(t),v={};for(const L in t){const{originalEvent:B}=t[L];this._eventsInProgress[L]||(v[`${L}start`]=B),this._eventsInProgress[L]=t[L]}!m&&_&&this._fireEvent("movestart",_.originalEvent);for(const L in v)this._fireEvent(L,v[L]);_&&this._fireEvent("move",_.originalEvent);for(const L in t){const{originalEvent:B}=t[L];this._fireEvent(L,B)}const S={};let A;for(const L in this._eventsInProgress){const{handlerName:B,originalEvent:O}=this._eventsInProgress[L];this._handlersById[B].isActive()||(delete this._eventsInProgress[L],A=s[B]||O,S[`${L}end`]=A)}for(const L in S)this._fireEvent(L,S[L]);const k=Qc(this._eventsInProgress);if(c&&(m||_)&&!k){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;L?(B(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:A})):(this._map.fire(new r.A("moveend",{originalEvent:A})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new r.A(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Vn("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Yf="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class eh extends r.E{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,r.aV(["_renderFrameCallback"],this)}getCenter(){return new r.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,c){return t=r.P.convert(t).mult(-1),this.panTo(this.transform.center,r.h({offset:t},s),c)}panTo(t,s,c){return this.easeTo(r.h({center:t},s),c)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,c){return this.easeTo(r.h({zoom:t},s),c)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,c){return this.easeTo(r.h({bearing:t},s),c)}resetNorth(t,s){return this.rotateTo(0,r.h({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(r.h({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=r.aG.convert(t);const c=s&&s.bearing||0,m=s&&s.pitch||0,_=t.getNorthWest(),v=t.getSouthEast();return this._cameraForBounds(this.transform,_,v,c,m,s)}_extendPadding(t){const s={top:0,right:0,bottom:0,left:0};return t==null?r.h({},s,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:r.h({},s,t)}_extendCameraOptions(t){return(t=r.h({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,s){const c=s.max[0]-s.min[0],m=s.max[1]-s.min[1];return c/m>t.aspect?c/(2*Math.tan(.5*t.fovX)*t.aspect):m/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,s,c,m,_,v){const S=t.clone(),A=this._extendCameraOptions(v);S.bearing=m,S.pitch=_;const k=r.cd.convert(s),L=r.cd.convert(c),B=.5*(k.lat+L.lat),O=.5*(k.lng+L.lng),j=r.eC(B,O),X=r.au([],j),W=r.au([],r.bF([],X,[0,1,0])),Y=r.bF([],W,X),J=[W[0],W[1],W[2],0,Y[0],Y[1],Y[2],0,X[0],X[1],X[2],0,0,0,0,1],ie=[j,r.eC(k.lat,k.lng),r.eC(L.lat,k.lng),r.eC(L.lat,L.lng),r.eC(k.lat,L.lng),r.eC(B,k.lng),r.eC(B,L.lng),r.eC(k.lat,O),r.eC(L.lat,O)];let ue=r.cW.fromPoints(ie.map(We=>[r.bG(W,We),r.bG(Y,We),r.bG(X,We)]));const pe=r.ad([],ue.center,J);r.eD(pe)===0&&r.eE(pe,0,0,1),r.au(pe,pe),r.bY(pe,pe,r.aB),S.center=r.eF(pe);const be=S.getWorldToCameraMatrix(),Te=r.bi(new Float64Array(16),be);ue=r.cW.applyTransform(ue,r.az([],be,J));const xe=this._extendAABB(ue,S,A,m);if(!xe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ue=xe,r.ad(pe,pe,be);const me=.5*(ue.max[2]-ue.min[2]),Ee=this._minimumAABBFrustumDistance(S,ue),Ae=r.bY([],[0,0,1],me),Oe=r.cV(Ae,pe,Ae),Ge=Ee+(S.pitch===0?0:r.bD(pe,Oe)),nt=S.globeCenterInViewSpace,it=r.at([],pe,[nt[0],nt[1],nt[2]]);r.au(it,it),r.bY(it,it,Ge);const ht=r.cV([],pe,it);r.ad(ht,ht,Te);const Be=r.eq/r.aB,Xe=r.ae(ht),ke=r.c6(Math.max(Xe*Be-r.eq,Number.EPSILON),0),st=Math.min(S.zoomFromMercatorZAdjusted(ke),A.maxZoom);return st>.5*(r.cL+r.cx)?(S.setProjection({name:"mercator"}),S.zoom=st,this._cameraForBounds(S,s,c,m,_,v)):{center:S.center,zoom:st,bearing:m,pitch:_}}_extendAABB(t,s,c,m){const _=.5*((c.padding.left||0)+(c.padding.right||0)),v=.5*((c.padding.top||0)+(c.padding.bottom||0)),S=v,A=_,k=_,L=v,B=s.width-(A+k),O=s.height-(S+L),j=r.at([],t.max,t.min),X=Math.min(B/j[0],O/j[1]),W=Math.min(s.scaleZoom(s.scale*X),c.maxZoom);if(isNaN(W))return null;const Y=s.scale/s.zoomScale(W),J=new r.cW([t.min[0]-A*Y,t.min[1]-L*Y,t.min[2]],[t.max[0]+k*Y,t.max[1]+S*Y,t.max[2]]),ie=(typeof c.offset.x=="number"&&typeof c.offset.y=="number"?new r.P(c.offset.x,c.offset.y):r.P.convert(c.offset)).rotate(-r.al(m));return J.center[0]-=ie.x*Y,J.center[1]+=ie.y*Y,J}queryTerrainElevation(t,s){const c=this.transform.elevation;return c?(s=r.h({},{exaggerated:!0},s),c.getAtPoint(r.ac.fromLngLat(t),null,s.exaggerated)):null}_cameraForBounds(t,s,c,m,_,v){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,s,c,m,_,v);const S=t.clone(),A=this._extendCameraOptions(v);S.bearing=m,S.pitch=_;const k=r.cd.convert(s),L=r.cd.convert(c),B=new r.cd(k.lng,L.lat),O=new r.cd(L.lng,k.lat),j=S.project(k),X=S.project(L),W=this.queryTerrainElevation(k),Y=this.queryTerrainElevation(L),J=this.queryTerrainElevation(B),ie=this.queryTerrainElevation(O),ue=[[j.x,j.y,Math.min(W||0,Y||0,J||0,ie||0)],[X.x,X.y,Math.max(W||0,Y||0,J||0,ie||0)]];let pe=r.cW.fromPoints(ue);const be=S.getWorldToCameraMatrix(),Te=r.bi(new Float64Array(16),be);pe=r.cW.applyTransform(pe,be);const xe=this._extendAABB(pe,S,A,m);if(!xe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=xe;const me=.5*r.at([],pe.max,pe.min)[2],Ee=this._minimumAABBFrustumDistance(S,pe),Ae=[0,0,1,0];r.aA(Ae,Ae,be),r.eG(Ae,Ae);const Oe=r.bY([],Ae,Ee+me),Ge=r.cV([],pe.center,Oe);r.ad(pe.center,pe.center,Te),r.ad(Ge,Ge,Te);const nt=S.unproject(new r.P(pe.center[0],pe.center[1])),it=r.eH(S.projection,nt),ht=Math.pow(2,it),Be=Math.min(S._zoomFromMercatorZ(Ge[2]*S.pixelsPerMeter*ht/S.worldSize),A.maxZoom);return S.mercatorFromTransition&&Be<.5*(r.cL+r.cx)?(S.setProjection({name:"globe"}),S.zoom=Be,this._cameraForBounds(S,s,c,m,_,v)):{center:nt,zoom:Be,bearing:m,pitch:_}}fitBounds(t,s,c){const m=this.cameraForBounds(t,s);return this._fitInternal(m,s,c)}fitScreenCoordinates(t,s,c,m,_){const v=r.P.convert(t),S=r.P.convert(s),A=new r.P(Math.min(v.x,S.x),Math.min(v.y,S.y)),k=new r.P(Math.max(v.x,S.x),Math.max(v.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(v,S))return this;const L=this.transform.pointLocation3D(A),B=this.transform.pointLocation3D(k),O=this.transform.pointLocation3D(new r.P(A.x,k.y)),j=this.transform.pointLocation3D(new r.P(k.x,A.y)),X=[Math.min(L.lng,B.lng,O.lng,j.lng),Math.min(L.lat,B.lat,O.lat,j.lat)],W=[Math.max(L.lng,B.lng,O.lng,j.lng),Math.max(L.lat,B.lat,O.lat,j.lat)],Y=m&&m.pitch?m.pitch:this.getPitch(),J=this._cameraForBounds(this.transform,X,W,c,Y,m);return this._fitInternal(J,m,_)}_fitInternal(t,s,c){return t?(s=r.h(t,s)).linear?this.easeTo(s,c):this.flyTo(s,c):this}jumpTo(t,s){this.stop();const c=t.preloadOnly?this.transform.clone():this.transform;let m=!1,_=!1,v=!1;"zoom"in t&&c.zoom!==+t.zoom&&(m=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=r.cd.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(_=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(v=!0,c.pitch=+t.pitch);const S=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!c.isPaddingEqual(S))if(t.retainPadding===!1){const A=c.clone();A.padding=S,c.setLocationAtPoint(c.center,A.centerPoint)}else c.padding=S;return t.preloadOnly?(this._preloadTiles(c),this):(this.fire(new r.A("movestart",s)).fire(new r.A("move",s)),m&&this.fire(new r.A("zoomstart",s)).fire(new r.A("zoom",s)).fire(new r.A("zoomend",s)),_&&this.fire(new r.A("rotatestart",s)).fire(new r.A("rotate",s)).fire(new r.A("rotateend",s)),v&&this.fire(new r.A("pitchstart",s)).fire(new r.A("pitch",s)).fire(new r.A("pitchend",s)),this.fire(new r.A("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Yf),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){const c=this.transform;if(!c.projection.supportsFreeCamera)return r.w(Yf),this;this.stop();const m=c.zoom,_=c.pitch,v=c.bearing;c.setFreeCameraOptions(t);const S=m!==c.zoom,A=_!==c.pitch,k=v!==c.bearing;return this.fire(new r.A("movestart",s)).fire(new r.A("move",s)),S&&this.fire(new r.A("zoomstart",s)).fire(new r.A("zoom",s)).fire(new r.A("zoomend",s)),k&&this.fire(new r.A("rotatestart",s)).fire(new r.A("rotate",s)).fire(new r.A("rotateend",s)),A&&this.fire(new r.A("pitchstart",s)).fire(new r.A("pitch",s)).fire(new r.A("pitchend",s)),this.fire(new r.A("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=r.h({offset:[0,0],duration:500,easing:r.ey},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const c=this.transform,m=this.getZoom(),_=this.getBearing(),v=this.getPitch(),S=this.getPadding(),A="zoom"in t?+t.zoom:m,k="bearing"in t?this._normalizeBearing(t.bearing,_):_,L="pitch"in t?+t.pitch:v,B=this._extendPadding(t.padding),O=r.P.convert(t.offset);let j,X,W;if(c.projection.name==="globe"){const Ae=r.ac.fromLngLat(c.center),Oe=O.rotate(-c.angle);Ae.x+=Oe.x/c.worldSize,Ae.y+=Oe.y/c.worldSize;const Ge=Ae.toLngLat(),nt=r.cd.convert(t.center||Ge);this._normalizeCenter(nt),j=c.centerPoint.add(Oe),X=new r.P(Ae.x,Ae.y).mult(c.worldSize),W=new r.P(r.aD(nt.lng),r.aH(nt.lat)).mult(c.worldSize).sub(X)}else{j=c.centerPoint.add(O);const Ae=c.pointLocation(j),Oe=r.cd.convert(t.center||Ae);this._normalizeCenter(Oe),X=c.project(Ae),W=c.project(Oe).sub(X)}const Y=c.zoomScale(A-m);let J,ie;t.around&&(J=r.cd.convert(t.around),ie=c.locationPoint(J));const ue=this._zooming||A!==m,pe=this._rotating||_!==k,be=this._pitching||L!==v,Te=!c.isPaddingEqual(B),xe=t.retainPadding===!1?c.clone():c,me=Ae=>Oe=>{if(ue&&(Ae.zoom=r.ai(m,A,Oe)),pe&&(Ae.bearing=r.ai(_,k,Oe)),be&&(Ae.pitch=r.ai(v,L,Oe)),Te&&(xe.interpolatePadding(S,B,Oe),j=xe.centerPoint.add(O)),J)Ae.setLocationAtPoint(J,ie);else{const Ge=Ae.zoomScale(Ae.zoom-m),nt=A>m?Math.min(2,Y):Math.max(.5,Y),it=Math.pow(nt,1-Oe),ht=Ae.unproject(X.add(W.mult(Oe*it)).mult(Ge));Ae.setLocationAtPoint(Ae.renderWorldCopies?ht.wrap():ht,j)}return t.preloadOnly||this._fireMoveEvents(s),Ae};if(t.preloadOnly){const Ae=this._emulate(me,t.duration,c);return this._preloadTiles(Ae),this}const Ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ue,this._rotating=pe,this._pitching=be,this._padding=Te,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,Ee),this._ease(me(c),Ae=>{c.cameraElevationReference==="sea"&&c.recenterOnTerrain(),this._afterEase(s,Ae)},t),this}_prepareEase(t,s,c={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||c.moving||this.fire(new r.A("movestart",t)),this._zooming&&!c.zooming&&this.fire(new r.A("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new r.A("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new r.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new r.A("move",t)),this._zooming&&this.fire(new r.A("zoom",t)),this._rotating&&this.fire(new r.A("rotate",t)),this._pitching&&this.fire(new r.A("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const c=this._zooming,m=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new r.A("zoomend",t)),m&&this.fire(new r.A("rotateend",t)),_&&this.fire(new r.A("pitchend",t)),this.fire(new r.A("moveend",t))}flyTo(t,s){if(this._prefersReducedMotion(t)){const We=r.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(We,s)}this.stop(),t=r.h({offset:[0,0],speed:1.2,curve:1.42,easing:r.ey},t);const c=this.transform,m=this.getZoom(),_=this.getBearing(),v=this.getPitch(),S=this.getPadding(),A="zoom"in t?r.ay(+t.zoom,c.minZoom,c.maxZoom):m,k="bearing"in t?this._normalizeBearing(t.bearing,_):_,L="pitch"in t?+t.pitch:v,B=this._extendPadding(t.padding),O=c.zoomScale(A-m),j=r.P.convert(t.offset);let X=c.centerPoint.add(j);const W=c.pointLocation(X),Y=r.cd.convert(t.center||W);this._normalizeCenter(Y);const J=c.project(W),ie=c.project(Y).sub(J);let ue=t.curve;const pe=Math.max(c.width,c.height),be=pe/O,Te=ie.mag();if("minZoom"in t){const We=r.ay(Math.min(t.minZoom,m,A),c.minZoom,c.maxZoom),ut=pe/c.zoomScale(We-m);ue=Math.sqrt(ut/Te*2)}const xe=ue*ue;function me(We){const ut=(be*be-pe*pe+(We?-1:1)*xe*xe*Te*Te)/(2*(We?be:pe)*xe*Te);return Math.log(Math.sqrt(ut*ut+1)-ut)}function Ee(We){return(Math.exp(We)-Math.exp(-We))/2}function Ae(We){return(Math.exp(We)+Math.exp(-We))/2}const Oe=me(0);let Ge=function(We){return Ae(Oe)/Ae(Oe+ue*We)},nt=function(We){return pe*((Ae(Oe)*(Ee(ut=Oe+ue*We)/Ae(ut))-Ee(Oe))/xe)/Te;var ut},it=(me(1)-Oe)/ue;if(Math.abs(Te)<1e-6||!isFinite(it)){if(Math.abs(pe-be)<1e-6)return this.easeTo(t,s);const We=be<pe?-1:1;it=Math.abs(Math.log(be/pe))/ue,nt=function(){return 0},Ge=function(ut){return Math.exp(We*ue*ut)}}t.duration="duration"in t?+t.duration:1e3*it/("screenSpeed"in t?+t.screenSpeed/ue:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const ht=_!==k,Be=L!==v,Xe=!c.isPaddingEqual(B),ke=t.retainPadding===!1?c.clone():c,st=We=>ut=>{const Et=ut*it,ot=1/Ge(Et);We.zoom=ut===1?A:m+We.scaleZoom(ot),ht&&(We.bearing=r.ai(_,k,ut)),Be&&(We.pitch=r.ai(v,L,ut)),Xe&&(ke.interpolatePadding(S,B,ut),X=ke.centerPoint.add(j));const yt=ut===1?Y:We.unproject(J.add(ie.mult(nt(Et))).mult(ot));return We.setLocationAtPoint(We.renderWorldCopies?yt.wrap():yt,X),We._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(s),We};if(t.preloadOnly){const We=this._emulate(st,t.duration,c);return this._preloadTiles(We),this}return this._zooming=!0,this._rotating=ht,this._pitching=Be,this._padding=Xe,this._prepareEase(s,!1),this._ease(st(c),()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const c=this._onEaseEnd;this._onEaseEnd=void 0,c.call(this,s)}if(!t){const c=this.handlers;c&&c.stop(!1)}return this}_ease(t,s,c){c.animate===!1||c.duration===0?(t(1),s()):(this._easeStart=r.q.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((r.q.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=r.bX(t,-180,180);const c=Math.abs(t-s);return Math.abs(t-360-s)<c&&(t-=360),Math.abs(t+360-s)<c&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const c=t.lng-s.center.lng;t.lng+=c>180?-360:c<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&r.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,s,c){const m=Math.ceil(15*s/1e3),_=[],v=t(c.clone());for(let S=0;S<=m;S++){const A=v(S/m);_.push(A.clone())}return _}_preloadTiles(t,s){}}class eu{constructor(t={}){this.options=t,r.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact,c=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=ve("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ve("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",c);const m=ve("span","mapboxgl-ctrl-icon",this._compactButton);return m.setAttribute("aria-hidden","true"),m.setAttribute("title",c),this._innerContainer=ve("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(t){const c=s.reduce((m,_,v)=>(_.value&&(m+=`${_.key}=${_.value}${v<s.length-1?"&":""}`),m),"?");t.href=`${r.e.FEEDBACK_URL}/${c}#${Zd(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style._mergedSourceCaches;for(const m in s){const _=s[m];if(_.used){const v=_.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t.sort((m,_)=>m.length-_.length),t=t.filter((m,_)=>{for(let v=_+1;v<t.length;v++)if(t[v].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class _s{constructor(){r.aV(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=ve("div","mapboxgl-ctrl");const s=ve("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const c=t[s].getSource();if(c.hasOwnProperty("mapbox_logo")&&!c.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class Qh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,c=s?this._queue.concat(s):this._queue;for(const m of c)if(m.id===t)return void(m.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const c of s)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class xl{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=r.dk((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,c){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+c}}const tu={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class zn extends r.A{constructor(t,s,c,m){const{point:_,lngLat:v,originalEvent:S,target:A}=t;super(t.type,{point:_,lngLat:v,originalEvent:S,target:A}),this.preventDefault=()=>{t.preventDefault()},this.id=s,this.interaction=c,this.feature=m}}class $a{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,s){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const c=s.filter;let m=s.type;c&&this.filters.set(t,r.b3(c)),m==="mouseover"&&(m="mouseenter"),m==="mouseout"&&(m="mouseleave");const _=this.interactionsByType.get(m)||new Map;m==="mouseenter"||m==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,s)):_.size===0&&this.map.on(m,this.handleType),_.size===0&&this.interactionsByType.set(m,_),_.set(t,s),this.typeById.set(t,m)}get(t){const s=this.typeById.get(t);if(!s)return;const c=this.interactionsByType.get(s);return c?c.get(t):void 0}remove(t){const s=this.typeById.get(t);if(!s)return;this.typeById.delete(t),this.filters.delete(t);const c=this.interactionsByType.get(s);c&&(c.delete(t),s==="mouseenter"||s==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):c.size===0&&this.map.off(s,this.handleType))}queryTargets(t,s){const c=[];for(const[m,_]of s)_.target&&c.push({targetId:m,target:_.target,filter:this.filters.get(m)});return this.map.style.queryRenderedTargets(t,c,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const s=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());s.length&&(t.type="mouseenter",this.handleType(t,s));const c=new Map;for(const[m,{feature:_}]of this.prevHoveredFeatures)this.hoveredFeatures.has(m)||c.set(_.id,_);c.size&&(t.type="mouseleave",this.handleType(t,Array.from(c.values())))}handleOut(t){const s=Array.from(this.hoveredFeatures.values()).map(({feature:c})=>c);s.length&&(t.type="mouseleave",this.handleType(t,s)),this.hoveredFeatures.clear()}handleType(t,s){const c=t.type==="mouseenter";if(c&&!this.interactionsByType.has(t.type))return void r.w("mouseenter interaction required for mouseleave to work.");const m=Array.from(this.interactionsByType.get(t.type)).reverse(),_=!!s;s=s||this.queryTargets(t.point,m);let v=!1;const S=new Set;for(const A of s){for(const[k,L]of m){if(!L.target)continue;const B=A.variants?A.variants[k]:null;if(B){for(const O of B){if(Fl(O,A,S,k))continue;const j=new r.de(A,O),X=zl(O,A,k);_&&(j.state=this.map.getFeatureState(j));const W=c?this.prevHoveredFeatures.get(X):null,Y=new zn(t,k,L,j),J=W?W.stop:L.handler(Y);if(c&&this.hoveredFeatures.set(X,{feature:A,stop:J}),J!==!1){v=!0;break}}if(v)break}}if(v)break}if(!v)for(const[A,k]of m){const{handler:L,target:B}=k;if(!B&&L(new zn(t,A,k,null))!==!1)break}}}function Ri(l,t){if(Array.isArray(l)&&Array.isArray(t)){const s=new Set(l),c=new Set(t);return s.size===c.size&&l.every(m=>c.has(m))}return r.bv(l,t)}const vl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},sf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Bp{constructor(t,s,c=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new qh({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,c&&(this.mousePitch=new Kc({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),r.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),Tt()}move(t,s){const c=this.map,m=this.mouseRotate.mousemoveWindow(t,s),_=m&&m.bearingDelta;if(_&&c.setBearing(c.getBearing()+_),this.mousePitch){const v=this.mousePitch.mousemoveWindow(t,s),S=v&&v.pitchDelta;S&&c.setPitch(c.getPitch()+S)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){It(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(r.h({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Yt(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Yt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=vt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=vt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function th(l,t,s){if(l=new r.cd(l.lng,l.lat),t){const c=new r.cd(l.lng-360,l.lat),m=new r.cd(l.lng+360,l.lat),_=360*Math.ceil(Math.abs(l.lng-s.center.lng)/360),v=s.locationPoint3D(l).distSqr(t),S=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint3D(c).distSqr(t)<v&&(S||Math.abs(c.lng-s.center.lng)<_)?l=c:s.locationPoint3D(m).distSqr(t)<v&&(S||Math.abs(m.lng-s.center.lng)<_)&&(l=m)}for(;Math.abs(l.lng-s.center.lng)>180;){const c=s.locationPoint3D(l);if(c.x>=0&&c.y>=0&&c.x<=s.width&&c.y<=s.height)break;l.lng>s.center.lng?l.lng-=360:l.lng+=360}return l}const iu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Bo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class nu extends r.E{constructor(t,s){super(),(t instanceof HTMLElement||s)&&(t=r.h({element:t},s)),r.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:c="center",color:m="#3FB1CE",scale:_=1,draggable:v=!1,clickTolerance:S=0,rotation:A=Bo.rotation,rotationAlignment:k=Bo.rotationAlignment,pitchAlignment:L=Bo.pitchAlignment,occludedOpacity:B=Bo.occludedOpacity,altitude:O=Bo.altitude}=t||{};this._anchor=c,this._color=m,this._scale=_,this._draggable=v,this._clickTolerance=S,this._rotation=A,this._rotationAlignment=k,this._pitchAlignment=L,this._occludedOpacity=B,this._altitude=O,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=r.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=r.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",W=>{W.preventDefault()}),this._element.addEventListener("mousedown",W=>{W.preventDefault()});const j=this._element.classList;for(const W in iu)j.remove(`mapboxgl-marker-anchor-${W}`);j.add(`mapboxgl-marker-anchor-${this._anchor}`);const X=t&&t.className?t.className.trim().split(/\s+/):[];j.add(...X),this._popup=null}_createDefaultMarker(){const t=ve("div"),s=ce("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const c=ce("radialGradient",{id:"shadowGradient"},ce("defs",{},s));ce("stop",{offset:"10%","stop-opacity":.4},c),ce("stop",{offset:"100%","stop-opacity":.05},c),ce("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},s)}return ce("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},s),ce("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},s),ce("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},s),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=r.cd.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Bo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const s=t.code,c=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,c=this._element;this._popup&&(s===c||c.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,s=this._pos;if(!t||!s)return!1;const c=t.unproject(s,this._altitude),m=t.getFreeCameraOptions();if(!m.position)return!1;const _=m.position.toLngLat();return _.distanceTo(c)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const s=this._pos;if(!s||s.x<0||s.x>t.transform.width||s.y<0||s.y>t.transform.height)return void this._clearFadeTimer();const c=t.unproject(s,this._altitude);let m;t._showingGlobe()&&r.eK(t.transform,this._lngLat)?m=0:(m=1-t._queryFogOpacity(c),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${iu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const t=this._pos,s=this._map,c=this.getPitchAlignment();if(!s||!t||c!=="map")return"";if(!s._showingGlobe()){const A=s.getPitch();return A?`rotateX(${A}deg)`:""}const m=r.cJ(r.eL(s.transform,this._lngLat)),_=t.sub(r.eM(s.transform)),v=Math.abs(_.x)+Math.abs(_.y);if(v===0)return"";const S=m/v;return`rotateX(${-_.y*S}deg) rotateY(${_.x*S}deg)`}_calculateZTransform(){const t=this._pos,s=this._map;if(!s||!t)return"";let c=0;const m=this.getRotationAlignment();if(m==="map")if(s._showingGlobe()){const _=s.project(new r.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),v=s.project(new r.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(_);c=r.cJ(Math.atan2(v.y,v.x))-90}else c=-s.getBearing();else if(m==="horizon"){const _=r.af(4,6,s.getZoom()),v=r.eM(s.transform);v.y+=_*s.transform.height;const S=t.sub(v),A=r.cJ(Math.atan2(S.y,S.x));c=(A>90?A-270:A+90)*(1-_)}return c+=this._rotation,c?`rotateZ(${c}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=th(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=r.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const s=this._map;if(!s)return;const c=this._pointerdownPos,m=this._positionDelta;if(c&&m){if(!this._isDragging){const _=this._clickTolerance||s._clickTolerance;if(t.point.dist(c)<_)return;this._isDragging=!0}this._pos=t.point.sub(m),this._lngLat=s.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.A("dragstart"))),this.fire(new r.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.A("dragend")),this._state="inactive"}_addDragHandler(t){const s=this._map,c=this._pos;s&&c&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(c),this._pointerdownPos=t.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const s=this._map;return s&&(t?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Bo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Bo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Bo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Bo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const of={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ih={maxWidth:100,unit:"metric"},ru={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},fa={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},jo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Er(l=new r.P(0,0),t="bottom"){if(typeof l=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(t){case"top":return new r.P(0,l);case"top-left":return new r.P(s,s);case"top-right":return new r.P(-s,s);case"bottom":return new r.P(0,-l);case"bottom-left":return new r.P(s,-s);case"bottom-right":return new r.P(-s,-s);case"left":return new r.P(l,0);case"right":return new r.P(-l,0)}return new r.P(0,0)}return l instanceof r.P||Array.isArray(l)?r.P.convert(l):r.P.convert(l[t]||[0,0])}return{version:U,supported:Se.supported,setRTLTextPlugin:r.eQ,getRTLTextPluginStatus:r.eP,Map:class extends eh{constructor(l){Q.mark(G.create);const t=l;if((l=r.h({},vl,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&r.eI(window)&&(l.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new bd(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies,null,null),l),this._repaint=!!l.repaint,this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._collectResourceTiming=l.collectResourceTiming,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new Qh,this._domRenderTaskQueue=new Qh,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.a$(),this._locale=r.h({},tu,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._tessellationStep=l.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=l.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new xl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=l.scaleFactor,this._requestManager=new Dt(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,this._contextCreateOptions=l.contextCreateOptions?Object.assign({},l.contextCreateOptions):{},typeof l.container=="string"){const s=document.getElementById(l.container);if(!s)throw new Error(`Container '${l.container.toString()}' not found.`);this._container=s}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),this._spriteFormat=l.spriteFormat,r.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new $d),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Jh(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,(l.style||!l.testMode)&&this.setStyle(l.style||r.e.DEFAULT_STYLE,{config:l.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),this.indoor=new Cm(this),l.hash&&(this._hash=new Vf(typeof l.hash=="string"&&l.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch});const s=l.bounds;s&&(this.resize(),this.fitBounds(s,r.h({},l.fitBoundsOptions,{duration:0})))}this.resize(),l.attributionControl&&this.addControl(new eu({customAttribution:l.customAttribution})),this._logoControl=new _s,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new r.A(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new r.A(`${s.dataType}dataloading`,s))}),this._interactions=new $a(this)}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new r.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=l.onAdd(this);this._controls.push(l);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(s,c.firstChild):c.appendChild(s),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new r.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new r.A("movestart",l)).fire(new r.A("move",l)),this.fire(new r.A("resize",l)),t&&this.fire(new r.A("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(r.aG.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new r.A("zoomstart")).fire(new r.A("zoom")).fire(new r.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new r.A("zoomstart")).fire(new r.A("zoom")).fire(new r.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new r.A("pitchstart")).fire(new r.A("pitch")).fire(new r.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new r.A("pitchstart")).fire(new r.A("pitch")).fire(new r.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(l){return this._scaleFactor=l,this.painter.scaleFactor=l,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return l==="auto"?navigator.language:Array.isArray(l)?l.length===0?void 0:l.map(t=>t==="auto"?navigator.language:t):l}setLanguage(l){const t=this._parseLanguage(l);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(l){return this._lazyInitEmptyStyle(),l?typeof l=="string"&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const l=this.transform,t=l.projection.name;let s;t==="globe"&&l.zoom>=r.cx?(l.setMercatorFromTransition(),s=!0):t==="mercator"&&l.zoom<r.cx&&(l.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(l,t){return this._updateProjection(l||t||{name:"mercator"})}_updateProjection(l){let t;return t=l.name==="globe"&&this.transform.zoom>=r.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(l,t){return this.transform.locationPoint3D(r.cd.convert(l),t)}unproject(l,t){return this.transform.pointLocation3D(r.P.convert(l),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(l,t,s){const c=m=>{let _=[];if(Array.isArray(t)){const v=t.filter(S=>this.getLayer(S));_=v.length?this.queryRenderedFeatures(m,{layers:v}):[]}else _=this.queryRenderedFeatures(m,{target:t});return _};if(l==="mouseenter"||l==="mouseover"){let m=!1;return{listener:s,targets:t,delegates:{mousemove:v=>{const S=c(v.point);S.length?m||(m=!0,s.call(this,new Xr(l,this,v.originalEvent,{features:S}))):m=!1},mouseout:()=>{m=!1}}}}if(l==="mouseleave"||l==="mouseout"){let m=!1;return{listener:s,targets:t,delegates:{mousemove:S=>{c(S.point).length?m=!0:m&&(m=!1,s.call(this,new Xr(l,this,S.originalEvent)))},mouseout:S=>{m&&(m=!1,s.call(this,new Xr(l,this,S.originalEvent)))}}}}{const m=_=>{const v=c(_.point);v.length&&(_.features=v,s.call(this,_),delete _.features)};return{listener:s,targets:t,delegates:{[l]:m}}}}on(l,t,s){if(typeof t=="function"||s===void 0)return super.on(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._createDelegatedListener(l,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(c);for(const m in c.delegates)this.on(m,c.delegates[m]);return this}once(l,t,s){if(typeof t=="function"||s===void 0)return super.once(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._createDelegatedListener(l,t,s);for(const m in c.delegates)this.once(m,c.delegates[m]);return this}off(l,t,s){if(typeof t=="function"||s===void 0)return super.off(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._delegatedListeners?this._delegatedListeners[l]:void 0;return c&&(m=>{for(let _=0;_<m.length;_++){const v=m[_];if(v.listener===s&&Ri(v.targets,t)){for(const S in v.delegates)this.off(S,v.delegates[S]);return m.splice(_,1),this}}})(c),this}queryRenderedFeatures(l,t){if(!this.style)return[];if(l===void 0||l instanceof r.P||Array.isArray(l)||t!==void 0||(t=l,l=void 0),l=l||[[0,0],[this.transform.width,this.transform.height]],!t){const _=this.style.queryRenderedFeatures(l,void 0,this.transform),v=this.style.queryRenderedFeatureset(l,void 0,this.transform);return _.concat(v)}let s=!0;if(t.target&&(s=this._isTargetValid(t.target),s&&!t.layers))return this.style.queryRenderedFeatureset(l,t,this.transform);let c=!0;if(t.layers&&Array.isArray(t.layers)){for(const _ of t.layers)if(!this._isValidId(_)){c=!1;break}if(c&&!t.target)return this.style.queryRenderedFeatures(l,t,this.transform)}let m=[];return c&&(m=m.concat(this.style.queryRenderedFeatures(l,t,this.transform))),s&&(m=m.concat(this.style.queryRenderedFeatureset(l,t,this.transform))),m}querySourceFeatures(l,t){return!l||typeof l=="string"&&!this._isValidId(l)?[]:this.style.querySourceFeatures(l,t)}isPointOnSurface(l){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&r.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(l))}addInteraction(l,t){return this._interactions.add(l,t),this}removeInteraction(l){return this._interactions.remove(l),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(l){return this._cooperativeGestures=l,this}setStyle(l,t){return t=r.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&l&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(l,(s,c)=>{if(s){const m=typeof s=="string"?s:s instanceof Error?s.message:s.error;r.w(`Unable to perform style diff: ${m}. Rebuilding the style from scratch.`),this._updateStyle(l,t)}else c&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(l,t))}_getUIString(l){const t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l){const s=r.h({},t);t&&t.config&&(s.initialConfig=t.config,delete s.config),this.style=new zs(this,s).load(l),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new zs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(l){return l==null?(this.fire(new r.z(new Error("IDs can't be empty."))),!1):!r.d8(l)||(this.fire(new r.z(new Error(`IDs can't contain special symbols: "${l}".`))),!1)}_isTargetValid(l){return"featuresetId"in l?this._isValidId("importId"in l?l.importId:l.featuresetId):"layerId"in l&&this._isValidId(l.layerId)}_areTargetsValid(l){if(Array.isArray(l)){for(const t of l)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(l)}addSource(l,t){return this._isValidId(l)?(this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)):this}isSourceLoaded(l){return!!this._isValidId(l)&&!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(l,t,s){this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,s)}removeSource(l){return this._isValidId(l)?(this.style.removeSource(l),this._updateTerrain(),this._update(!0)):this}getSource(l){return this._isValidId(l)?this.style.getOwnSource(l):null}addImage(l,t,{pixelRatio:s=1,sdf:c=!1,stretchX:m,stretchY:_,content:v}={}){this._lazyInitEmptyStyle();const S=r.I.from(l);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:A,height:k,data:L}=r.q.getImageData(t);this.style.addImage(S,{data:new r.r({width:A,height:k},L),pixelRatio:s,stretchX:m,stretchY:_,content:v,sdf:c,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new r.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:k}=t,L=t;this.style.addImage(S,{data:new r.r({width:A,height:k},new Uint8Array(L.data)),pixelRatio:s,stretchX:m,stretchY:_,content:v,sdf:c,usvg:!1,version:0,userImage:L}),L.onAdd&&L.onAdd(this,l)}}updateImage(l,t){this._lazyInitEmptyStyle();const s=r.I.from(l),c=this.style.getImage(s);if(!c)return void this.fire(new r.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?r.q.getImageData(t):t,{width:_,height:v,data:S}=m;if(_===void 0||v===void 0)return void this.fire(new r.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==(c.usvg?c.icon.usvg_tree.width:c.data.width)||v!==(c.usvg?c.icon.usvg_tree.height:c.data.height))return void this.fire(new r.z(new Error(`The width and height of the updated image (${_}, ${v})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`)));const A=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let k=!1;c.usvg?(c.data=new r.r({width:_,height:v},new Uint8Array(S)),c.usvg=!1,c.icon=void 0,k=!0):c.data.replace(S,A),this.style.updateImage(s,c,k)}hasImage(l){return l?!!this.style&&!!this.style.getImage(r.I.from(l)):(this.fire(new r.z(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(r.I.from(l))}loadImage(l,t){r.o(this._requestManager.transformRequest(l,r.R.Image),(s,c)=>{t(s,c instanceof HTMLImageElement?r.q.getImageData(c):c)})}listImages(){return this.style.listImages().map(l=>l.name)}addModel(l,t){this._lazyInitEmptyStyle(),this.style.addModel(l,t)}hasModel(l){return l?this.style.hasModel(l):(this.fire(new r.z(new Error("Missing required model id"))),!1)}removeModel(l){this.style.removeModel(l)}listModels(){return this.style.listModels()}addLayer(l,t){return this._isValidId(l.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)):this}getSlot(l){const t=this.getLayer(l);return t&&t.slot||null}setSlot(l,t){return this.style.setSlot(l,t),this.style.mergeLayers(),this._update(!0)}addImport(l,t){return this.style.addImport(l,t).catch(s=>this.fire(new r.z(new Error("Failed to add import",s)))),this}updateImport(l,t){return typeof t!="string"&&t.id!==l?(this.removeImport(l),this.addImport(t)):(this.style.updateImport(l,t),this._update(!0))}removeImport(l){return this.style.removeImport(l),this}moveImport(l,t){return this.style.moveImport(l,t),this._update(!0)}moveLayer(l,t){return this._isValidId(l)?(this.style.moveLayer(l,t),this._update(!0)):this}removeLayer(l){return this._isValidId(l)?(this.style.removeLayer(l),this._update(!0)):this}getLayer(l){if(!this._isValidId(l))return null;const t=this.style.getOwnLayer(l);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(l,t,s){return this._isValidId(l)?(this.style.setLayerZoomRange(l,t,s),this._update(!0)):this}setFilter(l,t,s={}){return this._isValidId(l)?(this.style.setFilter(l,t,s),this._update(!0)):this}getFilter(l){return this._isValidId(l)?this.style.getFilter(l):null}setPaintProperty(l,t,s,c={}){return this._isValidId(l)?(this.style.setPaintProperty(l,t,s,c),this._update(!0)):this}getPaintProperty(l,t){return this._isValidId(l)?this.style.getPaintProperty(l,t):null}setLayoutProperty(l,t,s,c={}){return this._isValidId(l)?(this.style.setLayoutProperty(l,t,s,c),this._update(!0)):this}getLayoutProperty(l,t){return this._isValidId(l)?this.style.getLayoutProperty(l,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(l){return this.style.setGlyphsUrl(l),this._update(!0)}getSchema(l){return this.style.getSchema(l)}setSchema(l,t){return this.style.setSchema(l,t),this._update(!0)}getConfig(l){return this.style.getConfig(l)}setConfig(l,t){return this.style.setConfig(l,t),this._update(!0)}getConfigProperty(l,t){return this.style.getConfigProperty(l,t)}setConfigProperty(l,t,s){return this.style.setConfigProperty(l,t,s),this._update(!0)}getFeaturesetDescriptors(l){return this.style.getFeaturesetDescriptors(l)}setLights(l){if(this._lazyInitEmptyStyle(),l&&l.length===1&&l[0].type==="flat"){const t=l[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(l),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const l=this.style.getLights()||[];return l.length===0&&l.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),l}setLight(l,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:l}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(l){return this._lazyInitEmptyStyle(),this.style.setSnow(l),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(l){return this._lazyInitEmptyStyle(),this.style.setRain(l),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(l){return this._lazyInitEmptyStyle(),this.style.setColorTheme(l),this._update(!0)}setImportColorTheme(l,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(l,t),this._update(!0)}setCamera(l){return this.style.setCamera(l),this._triggerCameraUpdate(l)}_triggerCameraUpdate(l){return this._update(this.transform.setOrthographicProjectionAtLowPitch(l["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.cd.convert(l),this.transform):0}setFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.setFeatureState(l,t),this._update())}removeFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.removeFeatureState(l,t),this._update())}getFeatureState(l){return l.source&&!this._isValidId(l.source)?null:this.style.getFeatureState(l)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let s,c,m,_=this._container;for(;_&&(!c||!m);){const v=window.getComputedStyle(_).transform;v&&v!=="none"&&(s=v.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(c=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(m=s[3])),_=_.parentElement}this._containerWidth=c?Math.abs(l/c):l,this._containerHeight=m?Math.abs(t/m):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=ve("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=ve("div","mapboxgl-canvas-container",l);this._canvas=ve("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=ve("div","mapboxgl-control-container",l),c=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(m=>{c[m]=ve("div",`mapboxgl-ctrl-${m}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,t){const s=r.q.devicePixelRatio||1;this._canvas.width=s*Math.ceil(l),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const t=this._markers.indexOf(l);t!==-1&&this._markers.splice(t,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){const t=this._popups.indexOf(l);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const l=r.h({},Se.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",l);t?(Rs(t,!0),this.painter=new Xu(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.l.testSupport(t)):this.fire(new r.z(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.A("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new r.A("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let t;this.fire(new r.A("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,c=r.q.now(),m=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=m.createQuery(),m.beginQuery(s.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,L=this.transform.pitch,B=r.q.now(),O=new r.aa(k,{now:B,fadeDuration:_,pitch:L,transition:this.style.transition,worldview:this._worldview});this.style.update(O)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(c),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(c);const S=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),S&&(this._placementDirty=S.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Q.mark(G.load),this.fire(new r.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const k=r.q.now()-c;m.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{const L=m.getQueryParameter(t,m.QUERY_RESULT)/1e6;m.deleteQuery(t),this.fire(new r.A("gpu-timing-frame",{cpuTime:k,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(k);this.fire(new r.A("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const L=this.painter.queryGpuTimeDeferredRender(k);this.fire(new r.A("gpu-timing-deferred-render",{gpuTime:L}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(A||this._repaint)this.triggerRepaint();else{const k=this.idle();if(k&&(v=this._updateAverageElevation(c,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new r.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new r.A("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,Q.mark(G.fullLoad),this._performanceMetricsCollection&&Ln(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(const t of this._markers)l&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!l||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(l,t=!1){const s=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const c=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(c||(t||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const m=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=l;const v=Math.abs(m-_);if(v>1){if(this._isInitialLoad||c)return this._averageElevation.jumpTo(_),s(_);this._averageElevation.easeTo(_,l,300)}else if(v>1e-4)return this._averageElevation.jumpTo(_),s(_)}return!!this._averageElevation.isEasing(l)&&s(this._averageElevation.getValue(l))}_authenticate(){Hr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===Li||l.status===401)){const t=this.painter.context.gl;Rs(t,!1),this._logoControl instanceof _s&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ln(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Zi(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const l=this._isDragging();this.painter.updateTerrain(this.style,l)}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,c=s.createFramebuffer();function m(_){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,_,0);const v=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,v),v}return s.bindFramebuffer(s.FRAMEBUFFER,c),this._canvasPixelComparison(m(l),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(l,t,s){let c=s[1]-s[0];const m=l.length/4;for(let _=0;_<t.length;_++){const v=t[_];let S=0;for(let A=0;A<v.length;A+=4)v[A]===l[A]&&v[A+1]===l[A+1]&&v[A+2]===l[A+2]&&v[A+3]===l[A+3]&&(S+=1);c+=(s[_+2]-s[_+1])*(1-S/m)}return c}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),js.delete(this.painter.context.gl),Xi.remove(),un.remove(),this._removed=!0,this.fire(new r.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=r.q.frame(t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)}))}_preloadTiles(l){const t=this.style?this.style.getSourceCaches():[];return r.bt(t,(s,c)=>s._preloadTiles(l,c),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(l){this._showParseStatus!==l&&(this._showParseStatus=l,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(l){this._showLayers2DWireframe!==l&&(this._showLayers2DWireframe=l,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(l){this._showLayers3DWireframe!==l&&(this._showLayers3DWireframe=l,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,this._tp.refreshUI(),l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,this._tp.refreshUI(),l&&this._update())}_setCacheLimits(l,t){r.eJ(l,t)}get version(){return U}},NavigationControl:class{constructor(l={}){this.options=r.h({},sf,l),this._container=ve("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(r.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),ve("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),ve("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:t}):s.resetNorth({},{originalEvent:t}))}),this._compassIcon=ve("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const t=l.getZoom(),s=t===l.getMaxZoom(),c=t===l.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bp(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,t){const s=ve("button",l,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(l,t){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${t}`);l.setAttribute("aria-label",s),l.firstElementChild&&l.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends r.E{constructor(l={}){super();const t=navigator.geolocation;this.options=r.h({geolocation:t},of,l),r.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ml(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=ve("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){const t=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,l(s)};this._supportsGeolocation!==void 0?l(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>t(s.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(l){const t=this._map.getMaxBounds(),s=l.coords;return!!t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new r.A("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.A("geolocate",l)),this._finish()}}_updateCamera(l){const t=new r.cd(l.coords.longitude,l.coords.latitude),s=l.coords.accuracy,c=this._map.getBearing(),m=r.h({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),m,{geolocateSource:!0})}_updateMarker(l){if(l){const t=new r.cd(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,t=r.c6(1,l._center.lat)*l.worldSize,s=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.A("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=ve("button","mapboxgl-ctrl-geolocate",this._container),ve("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ve("div","mapboxgl-user-location"),this._dotElement.appendChild(ve("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ve("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new nu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ve("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new nu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.A("trackuserlocationend")))})}}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:l.absolute===!0&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&l()}).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:eu,ScaleControl:class{constructor(l={}){this.options=r.h({},ih,l),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,t=this._map,s=t._containerHeight/2,c=t._containerWidth/2-l/2,m=t.unproject([c,s]),_=t.unproject([c+l,s]),v=m.distanceTo(_);if(this.options.unit==="imperial"){const S=3.2808*v;S>5280?this._setScale(l,S/5280,"mile"):this._setScale(l,S,"foot")}else this.options.unit==="nautical"?this._setScale(l,v/1852,"nautical-mile"):v>=1e3?this._setScale(l,v/1e3,"kilometer"):this._setScale(l,v,"meter")}_setScale(l,t,s){this._map._requestDomTask(()=>{const c=function(_){const v=Math.pow(10,`${Math.floor(_)}`.length-1);let S=_/v;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(A){const k=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*k)/k}(S),v*S}(t),m=c/t;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(c):`${c}&nbsp;${ru[s]}`,this._container.style.width=l*m+"px"})}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=ve("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l={}){this._fullscreen=!1,l&&l.container&&(l.container instanceof HTMLElement?this._container=l.container:r.w("Full screen control 'container' must be a DOM element.")),r.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=ve("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=ve("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ve("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(l){super(),this.options=r.h(Object.create(fa),l),this._altitude=this.options.altitude,r.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new r.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new r.A("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=r.cd.convert(l),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(l){return this._altitude=l,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(document.createTextNode(l))}setHTML(l){const t=document.createDocumentFragment(),s=document.createElement("body");let c;for(s.innerHTML=l;c=s.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=ve("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(l),this.options.closeButton){const s=this._closeButton=ve("button","mapboxgl-popup-close-button",t);s.type="button",s.setAttribute("aria-label","Close popup"),s.innerHTML='<span aria-hidden="true">&#215;</span>',s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let t;return this._classList.delete(l)?t=!1:(this._classList.add(l),t=!0),this._updateClassList(),t}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const t=this._map,s=this._container,c=this._pos;if(!t||!s||!c)return"bottom";const m=s.offsetWidth,_=s.offsetHeight,v=c.x<m/2,S=c.x>t.transform.width-m/2;if(c.y+l<_)return v?"top-left":S?"top-right":"top";if(c.y>t.transform.height-_){if(v)return"bottom-left";if(S)return"bottom-right"}return v?"left":S?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),l.className=t.join(" ")}_update(l){const t=this._map,s=this._content;if(!t||!this._lngLat&&!this._trackPointer||!s)return;let c=this._container;if(c||(c=this._container=ve("div","mapboxgl-popup",t.getContainer()),this._tip=ve("div","mapboxgl-popup-tip",c),c.appendChild(s)),this.options.maxWidth&&c.style.maxWidth!==this.options.maxWidth&&(c.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=th(this._lngLat,this._pos,t.transform)),!this._trackPointer||l){const m=this._pos=this._trackPointer&&l instanceof r.P?l:t.project(this._lngLat,this._altitude),_=Er(this.options.offset),v=this._anchor=this._getAnchor(_.y),S=Er(this.options.offset,v),A=m.add(S).round();t._requestDomTask(()=>{this._container&&v&&(this._container.style.transform=`${iu[v]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&t._showingGlobe()){const m=r.eK(t.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(jo);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:nu,Style:zs,LngLat:r.cd,LngLatBounds:r.aG,Point:r.P,MercatorCoordinate:r.ac,FreeCameraOptions:kc,Evented:r.E,config:r.e,prewarm:r.eO,clearPrewarmedResources:r.eN,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(l){r.e.ACCESS_TOKEN=l},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(l){r.e.API_URL=l},get workerCount(){return r.eX.workerCount},set workerCount(l){r.eX.workerCount=l},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){r.e.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){r.eW(l)},get workerUrl(){return r.eV.workerUrl},set workerUrl(l){r.eV.workerUrl=l},get workerClass(){return r.eV.workerClass},set workerClass(l){r.eV.workerClass=l},get workerParams(){return r.eV.workerParams},set workerParams(l){r.eV.workerParams=l},get dracoUrl(){return r.eU()},set dracoUrl(l){r.eT(l)},get meshoptUrl(){return r.eS()},set meshoptUrl(l){r.eR(l)},setNow:r.q.setNow,restoreNow:r.q.restoreNow}});var D=C;return D})}(uy)),uy.exports}var w8=v8();const Sg=l3(w8);Sg.accessToken="pk.eyJ1IjoieHVuaXh3d2kiLCJhIjoiY21kOW92ODUyMGE1aDJscTNuaW55eWNocyJ9.sqfV_Ukyc6u9jgWeq3vukQ";const i4=({onRegionClick:u,onRegionHover:p,onRouteClick:y,className:b="w-full h-full",center:C=[39.9042,116.4074],zoom:M=5,minZoom:D=1,maxZoom:r=18,points:U=[],routes:G=[],disableZoom:Q=!1,disableInteraction:se=!1,mapTheme:de="default"})=>{const Pe=Fe.useRef(null),Se=Fe.useRef(null),ve=Fe.useRef([]),[ce,ze]=Fe.useState(!1),[et]=Nn(pd),pt=y8(de),Tt=()=>{window.playInfoWindowAnimation=function(vt){console.log("playInfoWindowAnimationID:",vt);const Jt=document.getElementById(vt);if(!Jt){console.error(":",vt);return}const Ht=Jt.querySelectorAll(".photo-card");if(Ht.length===0){console.warn("photo-card");return}if(typeof window.gsap>"u"){console.warn("GSAP not available for InfoWindow animation");return}window.gsap.set(Ht,{scale:0,rotation:function(Nt){return[8,-5,3][Nt]||0},x:function(Nt){return[-50,0,50][Nt]||0},y:0}),window.gsap.to(Ht,{scale:1,stagger:.08,ease:"elastic.out(1, 0.8)",delay:.2,duration:.6})}};Fe.useEffect(()=>{if(Se.current)return;typeof window.gsap>"u"?m8(()=>import("./index-XlrKqp1i.js"),[]).then(Nt=>{window.gsap=Nt.gsap,Tt()}):Tt(),Se.current=new Sg.Map({container:Pe.current,style:pt.style,center:[C[1],C[0]],zoom:M,language:et==="zh"?"zh-Hans":"en",interactive:!se,scrollZoom:!Q&&!se,doubleClickZoom:!Q&&!se,touchZoomRotate:!Q&&!se,dragPan:!se,keyboard:!se,minZoom:D,maxZoom:r}),console.log(":",{minZoom:D,maxZoom:r,currentZoom:M}),Se.current.on("load",()=>{ze(!0),Se.current.setMinZoom(D),Se.current.setMaxZoom(r),console.log(":",{minZoom:D,maxZoom:r,actualMinZoom:Se.current.getMinZoom(),actualMaxZoom:Se.current.getMaxZoom()})}),Se.current.on("zoom",()=>{const Nt=Se.current.getZoom();Nt>r&&(Se.current.setZoom(r),console.log(":",r)),Nt<D&&(Se.current.setZoom(D),console.log(":",D))}),Se.current.on("click",Nt=>{console.log(":",Nt.lngLat.lng,Nt.lngLat.lat)});const vt=Pe.current,Jt=Nt=>{(Nt.ctrlKey||Nt.metaKey)&&Nt.preventDefault()},Ht=Nt=>{Nt.touches.length>1&&Nt.preventDefault()};return vt.addEventListener("wheel",Jt,{passive:!1}),vt.addEventListener("touchstart",Ht,{passive:!1}),vt.addEventListener("touchmove",Ht,{passive:!1}),()=>{var Nt;vt.removeEventListener("wheel",Jt),vt.removeEventListener("touchstart",Ht),vt.removeEventListener("touchmove",Ht),(Nt=Se.current)==null||Nt.remove()}},[de,D,r]),Fe.useEffect(()=>{!Se.current||!ce||(Se.current.setCenter([C[1],C[0]]),Se.current.setZoom(M))},[C,M,ce]),Fe.useEffect(()=>{!Se.current||!ce||(Se.current.setMinZoom(D),Se.current.setMaxZoom(r),console.log(":",{minZoom:D,maxZoom:r}))},[D,r,ce]);const It=vt=>({beijing:["https://images.unsplash.com/photo-1508804185872-d7badad00f7d?q=80&w=200&auto=format&fit=crop","https://images.unsplash.com/photo-1545558014-8692077e9b5c?q=80&w=200&auto=format&fit=crop","https://images.unsplash.com/photo-1570197788417-0e82375c9371?q=80&w=200&auto=format&fit=crop"],shanghai:["https://images.unsplash.com/photo-1474181487882-5abf3f0ba6c2?q=80&w=200&auto=format&fit=crop","https://images.unsplash.com/photo-1545558014-8692077e9b5c?q=80&w=200&auto=format&fit=crop","https://images.unsplash.com/photo-1537986904618-27d0e2b52eb4?q=80&w=200&auto=format&fit=crop"],shenzhen:["https://images.unsplash.com/photo-1512917774080-9991f1c4c750?q=80&w=200&auto=format&fit=crop","https://images.unsplash.com/photo-1556075798-4825dfaaf498?q=80&w=200&auto=format&fit=crop","https://images.unsplash.com/photo-1549693578-d683be217e58?q=80&w=200&auto=format&fit=crop"],chengdu:["https://images.unsplash.com/photo-1572120360610-d971b9d7767c?q=80&w=200&auto=format&fit=crop","https://images.unsplash.com/photo-1449844908441-8829872d2607?q=80&w=200&auto=format&fit=crop","https://images.unsplash.com/photo-1452626212852-811d58933cae?q=80&w=200&auto=format&fit=crop"]})[vt]||["https://images.unsplash.com/photo-1512917774080-9991f1c4c750?q=80&w=200&auto=format&fit=crop","https://images.unsplash.com/photo-1480074568708-e7b720bb3f09?q=80&w=200&auto=format&fit=crop","https://images.unsplash.com/photo-1449844908441-8829872d2607?q=80&w=200&auto=format&fit=crop"],di=(vt,Jt)=>{if(vt.length<2)return vt.map(Dt=>[Dt.position[1],Dt.position[0]]);if((Jt==null?void 0:Jt.enabled)===!1)return vt.map(Dt=>[Dt.position[1],Dt.position[0]]);const Ht=(Jt==null?void 0:Jt.intensity)??.3,Nt=[];for(let Dt=0;Dt<vt.length-1;Dt++){const Ci=vt[Dt],yi=vt[Dt+1];Nt.push([Ci.position[1],Ci.position[0]]);const xi=Ci.position[1],$t=Ci.position[0],Ei=yi.position[1],Kt=yi.position[0],Ue=Ei-xi,zt=Kt-$t,un=Math.sqrt(Ue*Ue+zt*zt),ln=Math.min(un*.15*Ht,1.5*Ht),Di=-zt,Zi=Ue,fn=Math.sqrt(Di*Di+Zi*Zi);if(fn>0){const Ln=Di/fn*ln,Xi=Zi/fn*ln,Hr=Math.max(6,Math.floor(un*8));for(let js=1;js<Hr;js++){const Rs=js/Hr,xr=xi+Ue*Rs,_a=$t+zt*Rs,Go=Math.sin(Rs*Math.PI)*(1-Math.pow(Math.abs(Rs-.5)*2,3)),ls=xr+Ln*Go,ia=_a+Xi*Go;Nt.push([ls,ia])}}}const Li=vt[vt.length-1];return Nt.push([Li.position[1],Li.position[0]]),Nt},Bt=(vt,Jt)=>{const Ht=It(vt.id),Nt=Jt||"infowindow-"+vt.id+"-"+Date.now();return`
      <div class="map-point-card" style="min-width: min(300px, 85vw); max-width: min(340px, 90vw); background: linear-gradient(145deg, #f0f9ff 0%, #e0f2fe 50%, #bae6fd 100%); border: 2px solid rgba(56, 189, 248, 0.3); box-shadow: 0 25px 50px rgba(14, 165, 233, 0.15), 0 12px 24px rgba(56, 189, 248, 0.1), 0 4px 12px rgba(0, 0, 0, 0.08);">
        <div class="map-card-close" onclick="this.closest('.mapboxgl-popup').remove()" style="color: ${Sl.forest};">
          
        </div>
        
        <div class="map-card-photos" id="${Nt}">
          ${Ht.map((Li,Dt)=>`
            <div class="photo-card" style="position: absolute; width: 70px; aspect-ratio: 1; border: 3px solid ${Sl.pure}; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(104, 121, 73, 0.15); left: 50%; top: 50%; margin-left: -35px; margin-top: -35px; transform-origin: center center;">
              <img 
                src="${Li}" 
                alt=" ${Dt+1}"
                class="map-photo-image"
                style="width: 100%; height: 100%; object-fit: cover;"
              />
            </div>
          `).join("")}
        </div>
        
        <div class="map-card-info">
          <h3 class="map-card-title" style="color: ${Sl.forest}; font-weight: 700; text-align: center; margin: 15px 0;">${vt.title}</h3>
          
          <button class="map-replay-btn" onclick="if(window.playInfoWindowAnimation) window.playInfoWindowAnimation('${Nt}')" style="background: linear-gradient(135deg, rgba(177, 193, 146, 0.12) 0%, rgba(199, 170, 108, 0.08) 100%); border: 1px solid rgba(177, 193, 146, 0.3); color: ${Sl.forest};">
            <span style="font-size: 14px;"></span>
            
          </button>
        </div>
      </div>`},Yt=vt=>{const Ht=document.createElement("div");Ht.innerHTML=`
      <div class="relative wanderpaw-marker">
        <div class=" flex items-center justify-center transition-all duration-200 hover:scale-110 cursor-pointer overflow-hidden" 
             style="width: 40px; 
                    height: 40px; 
                    
                    position: relative;">
          <img 
            src="/decorations/shitx.jpg" 
            alt="Map marker" 
            style="width: 100%; height: 100%; object-fit: cover;"
          />
        </div>
        <div class="absolute -bottom-1 left-1/2 transform -translate-x-1/2 w-0 h-0" 
             style="border-left: 6px solid transparent; border-right: 6px solid transparent; border-top: 8px solid ${Sl.earth}; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));"></div>
      </div>
    `,Ht.className="marker";const Nt=new Sg.Marker(Ht).setLngLat([vt.position[1],vt.position[0]]);return Ht.addEventListener("click",Li=>{Li.stopPropagation(),console.log(":",vt.title),u==null||u(vt.id,vt.data);const Dt="infowindow-"+vt.id+"-"+Date.now(),Ci=Bt(vt,Dt);new Sg.Popup({offset:[0,-48],className:"custom-popup"}).setHTML(Ci).setLngLat([vt.position[1],vt.position[0]]).addTo(Se.current),setTimeout(()=>{window.playInfoWindowAnimation&&window.playInfoWindowAnimation(Dt)},300)}),Ht.addEventListener("mouseenter",()=>{p==null||p(vt.id,vt.data)}),Ht.addEventListener("mouseleave",()=>{p==null||p(null)}),Nt};return Fe.useEffect(()=>{!Se.current||!ce||(ve.current.forEach(vt=>vt.remove()),ve.current=[],U.forEach(vt=>{const Jt=Yt(vt);Jt.addTo(Se.current),ve.current.push(Jt)}))},[U,ce,et]),Fe.useEffect(()=>{!Se.current||!ce||(G.forEach((vt,Jt)=>{const Ht=`route-${Jt}`,Nt=`route-${Jt}-layer`;Se.current.getLayer(Nt)&&Se.current.removeLayer(Nt),Se.current.getSource(Ht)&&Se.current.removeSource(Ht)}),G.forEach((vt,Jt)=>{const Ht={...g8,...vt.style},Nt=di(vt.waypoints,vt.curveStyle),Li=`route-${Jt}`,Dt=`route-${Jt}-layer`;Se.current.addSource(Li,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:Nt}}}),Se.current.addLayer({id:Dt,type:"line",source:Li,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":Ht.color||Sl.sage,"line-width":Ht.weight||4,"line-opacity":Ht.opacity||.8}}),Se.current.on("click",Dt,Ci=>{y==null||y(vt.id,vt),new Sg.Popup().setLngLat(Ci.lngLat).setHTML(`
            <div class="p-3 max-w-sm rounded-lg shadow-lg" style="background: linear-gradient(145deg, ${Sl.pure} 0%, ${Sl.pearl} 100%); border: 2px solid ${Sl.cream};">
              <h3 class="font-bold text-lg mb-2" style="color: ${Sl.forest};">${vt.name}</h3>
              ${vt.description?`<p class="text-sm" style="color: ${Sl.earth};">${vt.description}</p>`:""}
            </div>
          `).addTo(Se.current)}),Se.current.on("mouseenter",Dt,()=>{Se.current.getCanvas().style.cursor="pointer"}),Se.current.on("mouseleave",Dt,()=>{Se.current.getCanvas().style.cursor=""})}))},[G,ce,et]),V.jsxs("div",{className:`${b} relative`,children:[V.jsx("div",{ref:Pe,style:{height:"100%",width:"100%"},className:`${pt.className} rounded-lg overflow-hidden shadow-xl`}),!ce&&V.jsx("div",{className:"absolute inset-0 flex items-center justify-center wanderpaw-map-loading rounded-lg",children:V.jsx("div",{style:{color:Sl.forest},children:et==="zh"?"...":"Loading map..."})})]})},Sp=({children:u,className:p="",showDecorations:y=!0})=>V.jsxs("div",{className:`relative h-screen w-full overflow-hidden ${p}`,style:{backgroundColor:"#FFF6E4"},children:[y&&V.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[V.jsx("div",{className:"absolute top-0 left-[-60px] w-[350px] h-[350px]",children:V.jsx("img",{src:"/decorations/leaves-dark.jpeg",alt:"Left decoration",className:"w-full h-full object-contain"})}),V.jsx("div",{className:"absolute top-0 right-[-20px] w-[250px] h-[250px]",children:V.jsx("img",{src:"/decorations/leaves-light.jpeg",alt:"Right decoration",className:"w-full h-full object-contain"})})]}),V.jsx("div",{className:"relative z-10 w-full h-full",children:u})]}),qS=()=>{const[u]=Nn(pd),[p,y]=Fe.useState(null),[b,C]=Fe.useState([35,110]),[M,D]=Fe.useState(4),[r,U]=Fe.useState([]),[G,Q]=Fe.useState([]);Fe.useEffect(()=>{const Se=QC(M),ve=e4(M);U(Se),Q(ve)},[M]);const se=(Se,ve)=>{const ce=r.find(ze=>ze.id===Se);ce&&(Dn.success(`${u==="zh"?"":"Selected"}: ${ce.title}`,{duration:1500,position:"top-center"}),C(ce.position),D(Math.max(M,8))),y(null)},de=(Se,ve)=>{if(Se){const ce=r.find(ze=>ze.id===Se);ce&&console.log(`Hovering over: ${ce.title}`)}},Pe=(Se,ve)=>{y(Se);const ce=G.find(ze=>ze.id===Se);if(ce&&(Dn.success(`${u==="zh"?"":"Selected Route"}: ${ce.name}`,{duration:2e3,position:"top-center"}),ce.waypoints.length>0)){const ze=ce.waypoints.reduce((Tt,It)=>(Tt.minLat=Math.min(Tt.minLat,It.position[0]),Tt.maxLat=Math.max(Tt.maxLat,It.position[0]),Tt.minLng=Math.min(Tt.minLng,It.position[1]),Tt.maxLng=Math.max(Tt.maxLng,It.position[1]),Tt),{minLat:ce.waypoints[0].position[0],maxLat:ce.waypoints[0].position[0],minLng:ce.waypoints[0].position[1],maxLng:ce.waypoints[0].position[1]}),et=(ze.minLat+ze.maxLat)/2,pt=(ze.minLng+ze.maxLng)/2;C([et,pt]),D(Math.max(M,6))}};return V.jsxs(Sp,{className:"relative w-full h-screen overflow-hidden",children:[V.jsx("div",{className:"absolute top-8 left-1/2 transform -translate-x-1/2 z-[1000]",children:V.jsx("h1",{className:"text-6xl font-bold drop-shadow-lg tracking-wide",style:{fontFamily:"Paytone One, sans-serif",color:"#687949"},children:"wanderpaw"})}),V.jsx(i4,{onRegionClick:se,onRegionHover:de,onRouteClick:Pe,className:"w-full h-full",center:b,zoom:M,maxZoom:8,points:r,routes:G}),p&&V.jsx("div",{className:"absolute top-32 right-8 z-[1000]",children:V.jsxs("div",{className:"bg-white bg-opacity-95 backdrop-blur-sm rounded-lg px-4 py-3 max-w-sm shadow-lg",children:[V.jsxs("h3",{className:"text-gray-800 font-semibold mb-2 flex items-center gap-2",children:[V.jsx("span",{children:""}),u==="zh"?"":"Selected Route Details"]}),V.jsxs("div",{className:"text-gray-700 text-sm space-y-2",children:[(()=>{const Se=G.find(ce=>ce.id===p);if(!Se)return null;const ve=ce=>{switch(ce){case"driving":return"";case"walking":return"";case"transit":return"";case"bicycling":return"";default:return""}};return V.jsxs(V.Fragment,{children:[V.jsxs("div",{className:"font-medium text-base flex items-center gap-2",children:[ve(Se.travelMode),Se.name]}),Se.description&&V.jsx("p",{className:"text-sm text-gray-600",children:Se.description}),V.jsxs("div",{className:"space-y-1",children:[V.jsxs("div",{className:"font-medium text-xs",children:[u==="zh"?"":"Waypoints",":"]}),Se.waypoints.map((ce,ze)=>V.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[V.jsx("span",{className:"w-4 h-4 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs",children:ze+1}),V.jsx("span",{children:ce.name||`${u==="zh"?"":"Point"} ${ze+1}`})]},ze))]}),Se.travelMode&&V.jsxs("div",{className:"text-xs text-gray-500",children:[u==="zh"?"":"Travel Mode",": ",Se.travelMode]})]})})(),V.jsx("button",{onClick:()=>y(null),className:"mt-2 px-3 py-1 bg-green-500 text-white rounded-md text-xs hover:bg-green-600 transition-colors",children:u==="zh"?"":"Close"})]})]})})]})},Uo=bf("petInitialization",{currentStep:"type",petInfo:{},isCompleted:!1,isSkipped:!1});yr(u=>u(Uo).currentStep,(u,p,y)=>{const b=u(Uo);p(Uo,{...b,currentStep:y})});const o1=yr(u=>u(Uo).petInfo,(u,p,y)=>{const b=u(Uo);p(Uo,{...b,petInfo:y})}),b8=yr(u=>u(Uo).isCompleted,(u,p,y)=>{const b=u(Uo);p(Uo,{...b,isCompleted:y})}),T8=yr(u=>u(Uo).isSkipped,(u,p,y)=>{const b=u(Uo);p(Uo,{...b,isSkipped:y})});yr(null,(u,p)=>{p(Uo,{currentStep:"type",petInfo:{},isCompleted:!1,isSkipped:!1}),localStorage.removeItem("petInitialization")});yr(null,(u,p)=>{const y=u(Uo),b=["type","details","personality","confirmation"],C=b.indexOf(y.currentStep);if(C<b.length-1){const M=b[C+1];p(Uo,{...y,currentStep:M})}});yr(null,(u,p)=>{const y=u(Uo),b=["type","details","personality","confirmation"],C=b.indexOf(y.currentStep);if(C>0){const M=b[C-1];p(Uo,{...y,currentStep:M})}});const S8=[{value:"cat",label:"",emoji:""},{value:"dog",label:"",emoji:""},{value:"other",label:"",emoji:""},{value:"none",label:"",emoji:""}],E8=[{value:"male",label:"",emoji:""},{value:"female",label:"",emoji:""},{value:"unknown",label:"",emoji:""}],n4=[{value:"active",label:"",emoji:""},{value:"gentle",label:"",emoji:""},{value:"independent",label:"",emoji:""},{value:"clingy",label:"",emoji:""},{value:"playful",label:"",emoji:""},{value:"calm",label:"",emoji:""},{value:"curious",label:"",emoji:""},{value:"shy",label:"",emoji:""}],C8=[{value:"young",label:"",emoji:""},{value:"adult",label:"",emoji:""},{value:"senior",label:"",emoji:""}],A8=[{id:"capy",name:"Capy",type:"other",gender:"unknown",personality:["calm","gentle","independent"],age:"adult",emoji:"",avatar:"/decorations/capybara.jpeg",description:"",quote:"",bgColor:"from-orange-100 to-amber-50",accentColor:"orange-500"},{id:"tanuki",name:"Tanuki",type:"cat",gender:"female",personality:["curious","playful","independent"],age:"young",emoji:"",avatar:"/decorations/cat.png",description:'""',quote:"",bgColor:"from-pink-100 to-rose-50",accentColor:"pink-500"},{id:"foxo",name:"Foxo",type:"dog",gender:"male",personality:["active","curious","playful"],age:"adult",emoji:"",avatar:"/decorations/fox.png",description:"",quote:"",bgColor:"from-blue-100 to-sky-50",accentColor:"blue-500"}],I8="https://backeenee.zeabur.app",P8="/users",sm=Or.create({baseURL:`${I8}${P8}`,timeout:1e4,headers:{"Content-Type":"application/json"}});class r4{static async initializePetInfo(p,y){var b,C,M;try{return(await sm.post("/pet-info",p,{headers:{Authorization:`Bearer ${y}`}})).data}catch(D){if(console.error(":",D),D.code==="ERR_NETWORK")throw new Error("");if(D.message.includes("CORS")||D.message.includes("Network Error"))throw new Error("");if(((b=D.response)==null?void 0:b.status)===401)throw new Error("");if(((C=D.response)==null?void 0:C.status)===403)throw new Error("");if((M=D.response)!=null&&M.data){const r=D.response.data.message||D.response.data.error||"";throw new Error(r)}throw D.code==="ECONNABORTED"?new Error(""):new Error("")}}static async getPetInfo(p){var y,b,C;try{return(await sm.get("/pet-info",{headers:{Authorization:`Bearer ${p}`}})).data.petInfo}catch(M){if(console.error(":",M),((y=M.response)==null?void 0:y.status)===401)throw new Error("");if(((b=M.response)==null?void 0:b.status)===404)return{};if((C=M.response)!=null&&C.data){const D=M.response.data.message||M.response.data.error||"";throw new Error(D)}throw new Error("")}}static async updatePetInfo(p,y){var b,C;try{return(await sm.put("/pet-info",p,{headers:{Authorization:`Bearer ${y}`}})).data}catch(M){if(console.error(":",M),((b=M.response)==null?void 0:b.status)===401)throw new Error("");if((C=M.response)!=null&&C.data){const D=M.response.data.message||M.response.data.error||"";throw new Error(D)}throw new Error("")}}static async deletePetInfo(p){var y,b;try{return(await sm.delete("/pet-info",{headers:{Authorization:`Bearer ${p}`}})).data}catch(C){if(console.error(":",C),((y=C.response)==null?void 0:y.status)===401)throw new Error("");if((b=C.response)!=null&&b.data){const M=C.response.data.message||C.response.data.error||"";throw new Error(M)}throw new Error("")}}static setupInterceptors(p){sm.interceptors.request.use(y=>{const b=p();return b&&(y.headers.Authorization=`Bearer ${b}`),y},y=>Promise.reject(y)),sm.interceptors.response.use(y=>y,async y=>{var C;const b=y.config;return((C=y.response)==null?void 0:C.status)===401&&!b._retry&&(b._retry=!0,console.log("Token expired, need to refresh or redirect to login")),Promise.reject(y)})}}const Vg=(u=!1)=>({padding:"1vh 4vw",background:u?"linear-gradient(to right, #9ca3af, #6b7280)":"linear-gradient(to right, #687949, #687949)",color:"white",borderRadius:"0.7vw",fontWeight:"bold",fontSize:"1.2vw",transition:"all 0.2s",boxShadow:"0 0.5vh 1vh rgba(0,0,0,0.3)",cursor:u?"not-allowed":"pointer",border:"none"}),M8=(u=!1)=>({padding:"1vh 4vw",background:u?"linear-gradient(to right, #d1d5db, #9ca3af)":"linear-gradient(to right, #6b7280, #6b7280)",color:"white",borderRadius:"0.7vw",fontWeight:"bold",fontSize:"1.2vw",transition:"all 0.2s",boxShadow:"0 0.5vh 1vh rgba(0,0,0,0.3)",cursor:u?"not-allowed":"pointer",border:"none"}),vf=(u,p,y=!1)=>{y||(p?(u.currentTarget.style.background="linear-gradient(to right, #C7AA6C, #C7AA6C)",u.currentTarget.style.transform="scale(1.05)"):(u.currentTarget.style.background="linear-gradient(to right, #687949, #687949)",u.currentTarget.style.transform="scale(1)"))},ZS=(u,p,y=!1)=>{y||(p?(u.currentTarget.style.background="linear-gradient(to right, #9ca3af, #9ca3af)",u.currentTarget.style.transform="scale(1.05)"):(u.currentTarget.style.background="linear-gradient(to right, #6b7280, #6b7280)",u.currentTarget.style.transform="scale(1)"))},XS=()=>{var se,de;const[u]=Nn(as),[,p]=Nn(i1),[,y]=Nn(EC),[b,C]=Fe.useState(((se=u.user)==null?void 0:se.petInfo)||{}),[M,D]=Fe.useState(!1),[r,U]=Fe.useState("pet");Fe.useEffect(()=>{var Pe;(Pe=u.user)!=null&&Pe.petInfo&&C(u.user.petInfo)},[(de=u.user)==null?void 0:de.petInfo]);const G=async()=>{if(!u.accessToken){Dn.error("");return}D(!0);try{await r4.updatePetInfo(b,u.accessToken),p({petInfo:b,isInitialized:!0}),Dn.success("")}catch(Pe){Dn.error(Pe.message||"")}finally{D(!1)}},Q=()=>{y(),Dn.success("")};return V.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:V.jsxs("div",{className:"max-w-4xl mx-auto",children:[V.jsxs("div",{className:"mb-8",children:[V.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:""}),V.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:""})]}),V.jsx("div",{className:"mb-6 border-b border-gray-200 dark:border-gray-700",children:V.jsx("nav",{className:"flex space-x-8",children:[{key:"pet",label:" ",icon:""},{key:"account",label:" ",icon:""},{key:"about",label:" ",icon:""}].map(Pe=>V.jsx("button",{onClick:()=>U(Pe.key),className:`py-2 px-1 border-b-2 font-medium text-sm transition-colors ${r===Pe.key?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"}`,children:Pe.label},Pe.key))})}),V.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[r==="pet"&&V.jsx(R8,{petInfo:b,setPetInfo:C,onSave:G,loading:M}),r==="account"&&V.jsx(k8,{user:u.user,onLogout:Q}),r==="about"&&V.jsx(D8,{})]})]})})},R8=({petInfo:u,setPetInfo:p,onSave:y,loading:b})=>{var C;return V.jsxs("div",{className:"space-y-6",children:[V.jsxs("div",{children:[V.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:" "}),V.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:""})]}),V.jsxs("div",{className:"space-y-3",children:[V.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:""}),V.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:S8.map(M=>V.jsxs("button",{onClick:()=>p({...u,type:M.value}),className:`p-3 rounded-lg border-2 transition-all duration-200 text-center ${u.type===M.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-blue-300"}`,children:[V.jsx("div",{className:"text-2xl mb-1",children:M.emoji}),V.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:M.label})]},M.value))})]}),u.type&&u.type!=="none"&&V.jsxs(V.Fragment,{children:[V.jsxs("div",{className:"space-y-2",children:[V.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:""}),V.jsx("input",{type:"text",value:u.name||"",onChange:M=>p({...u,name:M.target.value}),placeholder:"",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),V.jsxs("div",{className:"space-y-3",children:[V.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:""}),V.jsx("div",{className:"grid grid-cols-3 gap-3",children:E8.map(M=>V.jsxs("button",{onClick:()=>p({...u,gender:M.value}),className:`p-3 rounded-lg border-2 transition-all duration-200 text-center ${u.gender===M.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-blue-300"}`,children:[V.jsx("div",{className:"text-xl mb-1",children:M.emoji}),V.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:M.label})]},M.value))})]}),V.jsxs("div",{className:"space-y-3",children:[V.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:""}),V.jsx("div",{className:"grid grid-cols-3 gap-3",children:C8.map(M=>V.jsxs("button",{onClick:()=>p({...u,age:M.value}),className:`p-3 rounded-lg border-2 transition-all duration-200 text-center ${u.age===M.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-600 hover:border-blue-300"}`,children:[V.jsx("div",{className:"text-xl mb-1",children:M.emoji}),V.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:M.label})]},M.value))})]}),V.jsxs("div",{className:"space-y-3",children:[V.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:" (3)"}),V.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:n4.map(M=>{var G,Q;const D=((G=u.personality)==null?void 0:G.includes(M.value))||!1,r=((Q=u.personality)==null?void 0:Q.length)||0,U=D||r<3;return V.jsxs("button",{onClick:()=>{if(!U&&!D)return;const se=u.personality||[],de=D?se.filter(Pe=>Pe!==M.value):[...se,M.value];p({...u,personality:de})},disabled:!U&&!D,className:`p-3 rounded-lg border-2 transition-all duration-200 text-center ${D?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":U?"border-gray-200 dark:border-gray-600 hover:border-blue-300":"border-gray-200 dark:border-gray-600 opacity-50 cursor-not-allowed"}`,children:[V.jsx("div",{className:"text-xl mb-1",children:M.emoji}),V.jsx("div",{className:"text-xs font-medium text-gray-900 dark:text-white",children:M.label})]},M.value)})}),V.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[" ",((C=u.personality)==null?void 0:C.length)||0,"/3 "]})]})]}),V.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:V.jsx("button",{onClick:y,disabled:b,style:Vg(b),onMouseEnter:M=>vf(M,!0,b),onMouseLeave:M=>vf(M,!1,b),children:b?"...":""})})]})},k8=({user:u,onLogout:p})=>V.jsxs("div",{className:"space-y-6",children:[V.jsxs("div",{children:[V.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:" "}),V.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:""})]}),V.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[V.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:""}),V.jsxs("div",{className:"space-y-2",children:[V.jsxs("div",{className:"flex justify-between",children:[V.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:""}),V.jsx("span",{className:"text-gray-900 dark:text-white",children:u==null?void 0:u.username})]}),(u==null?void 0:u.phoneNumber)&&V.jsxs("div",{className:"flex justify-between",children:[V.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:""}),V.jsx("span",{className:"text-gray-900 dark:text-white",children:u.phoneNumber})]}),(u==null?void 0:u.lastLogin)&&V.jsxs("div",{className:"flex justify-between",children:[V.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:""}),V.jsx("span",{className:"text-gray-900 dark:text-white",children:new Date(u.lastLogin).toLocaleString()})]}),V.jsxs("div",{className:"flex justify-between",children:[V.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:""}),V.jsx("span",{className:`${u!=null&&u.isInitialized?"text-green-600":"text-orange-600"}`,children:u!=null&&u.isInitialized?"":""})]})]})]}),V.jsx("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:V.jsx("button",{onClick:p,style:M8(),onMouseEnter:y=>ZS(y,!0),onMouseLeave:y=>ZS(y,!1),children:""})})]}),D8=()=>V.jsxs("div",{className:"space-y-6",children:[V.jsxs("div",{children:[V.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-4",children:["  ",V.jsx("span",{className:"wanderpaw-title",children:"WanderPaw"})]}),V.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:""})]}),V.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[V.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[V.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:""}),V.jsxs("div",{className:"space-y-2 text-sm",children:[V.jsxs("div",{className:"flex justify-between",children:[V.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:""}),V.jsx("span",{className:"text-gray-900 dark:text-white",children:"1.0.0"})]}),V.jsxs("div",{className:"flex justify-between",children:[V.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:""}),V.jsxs("span",{className:"text-gray-900 dark:text-white",children:[V.jsx("span",{className:"wanderpaw-title",children:"WanderPaw"})," Team"]})]}),V.jsxs("div",{className:"flex justify-between",children:[V.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:""}),V.jsx("span",{className:"text-gray-900 dark:text-white",children:"React + Fastify"})]})]})]}),V.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[V.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:""}),V.jsxs("div",{className:"space-y-3",children:[V.jsxs("a",{href:"https://space.bilibili.com/32090268",target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:[V.jsx("span",{className:"mr-2",children:""}),"Bilibili "]}),V.jsxs("a",{href:"https://github.com/jrenc2002",target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:[V.jsx("span",{className:"mr-2",children:""}),"GitHub "]}),V.jsxs("a",{href:"https://jrenc.com",target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:[V.jsx("span",{className:"mr-2",children:""}),""]})]})]})]}),V.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[V.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-3",children:" "}),V.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[V.jsxs("div",{className:"flex items-start space-x-2",children:[V.jsx("span",{children:""}),V.jsxs("div",{children:[V.jsx("strong",{children:""}),V.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:""})]})]}),V.jsxs("div",{className:"flex items-start space-x-2",children:[V.jsx("span",{children:""}),V.jsxs("div",{children:[V.jsx("strong",{children:""}),V.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:""})]})]}),V.jsxs("div",{className:"flex items-start space-x-2",children:[V.jsx("span",{children:""}),V.jsxs("div",{children:[V.jsx("strong",{children:""}),V.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:""})]})]}),V.jsxs("div",{className:"flex items-start space-x-2",children:[V.jsx("span",{children:""}),V.jsxs("div",{children:[V.jsx("strong",{children:""}),V.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:""})]})]})]})]})]}),L8=({onSuccess:u,onSwitchToRegister:p})=>{const y=mc(),[b,C]=Nn(M6),[M,D]=Nn(TC),[,r]=Nn(SC),[,U]=Nn(CC),[,G]=Nn(i1),[Q,se]=Fe.useState(!1),de=Se=>ve=>{C({...b,[Se]:ve.target.value}),r(null)},Pe=async Se=>{if(Se.preventDefault(),!b.username||!b.password){r(""),Dn.error("");return}D(!0),r(null);try{const ve=await jg.login(b);U({user:{id:ve.id,username:ve.username,phoneNumber:ve.phoneNumber,lastLogin:ve.lastLogin,isInitialized:!1},accessToken:ve.accessToken,refreshToken:ve.refreshToken});try{const ce=await jg.getUserProfile(ve.accessToken);G({isInitialized:ce.isInitialized??!1,petInfo:ce.petInfo})}catch(ce){console.error(":",ce)}Dn.success(`${ve.username}`),C({username:"",password:""}),u?u():y("/home")}catch(ve){const ce=ve.message||"";r(ce),Dn.error(ce)}finally{D(!1)}};return V.jsxs("div",{className:"w-full",children:[V.jsxs("div",{className:"text-center mb-6",children:[V.jsx("h2",{className:"text-xl font-bold text-[#687949] mb-2",children:""}),V.jsx("p",{className:"text-sm text-[#687949] opacity-60",children:""})]}),V.jsxs("form",{onSubmit:Pe,className:"space-y-4",children:[V.jsxs("div",{children:[V.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-[#687949] mb-2",children:""}),V.jsx("input",{id:"username",type:"text",value:b.username,onChange:de("username"),className:`w-full px-4 py-3 rounded-xl bg-[#F0E6D6] text-[#687949] placeholder-[#687949]/50\r
                       border-2 border-transparent focus:border-[#687949] focus:bg-white\r
                       transition-all duration-200`,placeholder:"",disabled:M,required:!0})]}),V.jsxs("div",{children:[V.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-[#687949] mb-2",children:""}),V.jsxs("div",{className:"relative",children:[V.jsx("input",{id:"password",type:Q?"text":"password",value:b.password,onChange:de("password"),className:`w-full px-4 py-3 pr-12 rounded-xl bg-[#F0E6D6] text-[#687949] placeholder-[#687949]/50\r
                         border-2 border-transparent focus:border-[#687949] focus:bg-white\r
                         transition-all duration-200`,placeholder:"",disabled:M,required:!0}),V.jsx("button",{type:"button",onClick:()=>se(!Q),className:`absolute right-3 top-1/2 transform -translate-y-1/2\r
                         text-[#687949]/50 hover:text-[#687949] transition-colors duration-200`,disabled:M,children:Q?V.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:V.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):V.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[V.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),V.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),V.jsx("button",{type:"submit",disabled:M,className:`w-full py-3 px-4 bg-[#687949] hover:bg-[#505D39] disabled:bg-[#687949]/50\r
                     text-white font-medium rounded-xl transition-all duration-200\r
                     focus:outline-none focus:ring-2 focus:ring-[#687949]/50 focus:ring-offset-2\r
                     disabled:cursor-not-allowed transform hover:scale-[1.02] active:scale-[0.98]`,children:M?V.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[V.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),V.jsx("span",{children:"..."})]}):""})]}),V.jsx("div",{className:"mt-4 text-center",children:V.jsxs("p",{className:"text-sm text-[#687949] opacity-70",children:[""," ",V.jsx("button",{onClick:p,className:`text-[#687949] hover:text-[#505D39] font-medium \r
                       transition-colors duration-200 underline`,disabled:M,children:""})]})})]})},z8=({onSuccess:u,onSwitchToLogin:p})=>{const y=mc(),[b,C]=Nn(R6),[M,D]=Nn(TC),[,r]=Nn(SC),[,U]=Nn(CC),[G,Q]=Fe.useState(!1),[se,de]=Fe.useState(""),Pe=ze=>et=>{C({...b,[ze]:et.target.value}),r(null)},Se=ze=>{de(ze.target.value),r(null)},ve=()=>!b.username||!b.password?(r(""),Dn.error(""),!1):b.username.length<3?(r("3"),Dn.error("3"),!1):b.password.length<8?(r("8"),Dn.error("8"),!1):b.password!==se?(r(""),Dn.error(""),!1):!0,ce=async ze=>{if(ze.preventDefault(),!!ve()){D(!0),r(null);try{const et=await jg.register(b);U({user:{id:et.id,username:et.username,phoneNumber:et.phoneNumber,lastLogin:et.lastLogin},accessToken:et.accessToken,refreshToken:et.refreshToken}),Dn.success(` ${et.username}`),C({username:"",password:""}),de(""),u?u():y("/home")}catch(et){const pt=et.message||"";r(pt),Dn.error(pt)}finally{D(!1)}}};return V.jsxs("div",{className:"w-full",children:[V.jsxs("div",{className:"text-center mb-6",children:[V.jsx("h2",{className:"text-xl font-bold text-[#687949] mb-2",children:""}),V.jsx("p",{className:"text-sm text-[#687949] opacity-60",children:""})]}),V.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[V.jsxs("div",{children:[V.jsx("label",{htmlFor:"register-username",className:"block text-sm font-medium text-[#687949] mb-2",children:" *"}),V.jsx("input",{id:"register-username",type:"text",value:b.username,onChange:Pe("username"),className:`w-full px-4 py-3 rounded-xl bg-[#F0E6D6] text-[#687949] placeholder-[#687949]/50\r
                       border-2 border-transparent focus:border-[#687949] focus:bg-white\r
                       transition-all duration-200`,placeholder:"3",disabled:M,required:!0,minLength:3,maxLength:30})]}),V.jsxs("div",{children:[V.jsx("label",{htmlFor:"register-password",className:"block text-sm font-medium text-[#687949] mb-2",children:" *"}),V.jsxs("div",{className:"relative",children:[V.jsx("input",{id:"register-password",type:G?"text":"password",value:b.password,onChange:Pe("password"),className:`w-full px-4 py-3 pr-12 rounded-xl bg-[#F0E6D6] text-[#687949] placeholder-[#687949]/50\r
                         border-2 border-transparent focus:border-[#687949] focus:bg-white\r
                         transition-all duration-200`,placeholder:"8",disabled:M,required:!0,minLength:8,maxLength:100}),V.jsx("button",{type:"button",onClick:()=>Q(!G),className:`absolute right-3 top-1/2 transform -translate-y-1/2\r
                         text-[#687949]/50 hover:text-[#687949] transition-colors duration-200`,disabled:M,children:G?V.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:V.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):V.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[V.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),V.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),V.jsxs("div",{children:[V.jsx("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-[#687949] mb-2",children:" *"}),V.jsx("input",{id:"confirm-password",type:G?"text":"password",value:se,onChange:Se,className:`w-full px-4 py-3 rounded-xl bg-[#F0E6D6] text-[#687949] placeholder-[#687949]/50\r
                       border-2 border-transparent focus:border-[#687949] focus:bg-white\r
                       transition-all duration-200`,placeholder:"",disabled:M,required:!0})]}),V.jsx("button",{type:"submit",disabled:M,className:`w-full py-3 px-4 bg-[#687949] hover:bg-[#505D39] disabled:bg-[#687949]/50\r
                     text-white font-medium rounded-xl transition-all duration-200\r
                     focus:outline-none focus:ring-2 focus:ring-[#687949]/50 focus:ring-offset-2\r
                     disabled:cursor-not-allowed transform hover:scale-[1.02] active:scale-[0.98]`,children:M?V.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[V.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),V.jsx("span",{children:"..."})]}):""})]}),V.jsx("div",{className:"mt-4 text-center",children:V.jsxs("p",{className:"text-sm text-[#687949] opacity-70",children:[""," ",V.jsx("button",{onClick:p,className:`text-[#687949] hover:text-[#505D39] font-medium \r
                       transition-colors duration-200 underline`,disabled:M,children:""})]})}),V.jsx("div",{className:"mt-3 text-center",children:V.jsxs("p",{className:"text-xs text-[#687949] opacity-50",children:[""," ",V.jsx("a",{href:"#",className:"text-[#687949] hover:text-[#505D39] underline",children:""})," ",""," ",V.jsx("a",{href:"#",className:"text-[#687949] hover:text-[#505D39] underline",children:""})]})})]})},YS=()=>{const[u,p]=Fe.useState(!0),y=()=>p(!0),b=()=>p(!1);return V.jsx(Sp,{showDecorations:!0,children:V.jsx("div",{className:"flex items-center justify-center min-h-screen p-4",children:V.jsx("div",{className:"w-full max-w-md",children:V.jsxs("div",{className:"relative",style:{borderRadius:"38px",background:"#FDF8F3",boxShadow:"0 2px 34.9px 3px rgba(123, 66, 15, 0.11)"},children:[V.jsx("div",{className:"absolute top-[22px] left-[22px] right-[22px] bottom-[22px] pointer-events-none",style:{borderRadius:"21px",border:"2px dashed #D1BA9E"}}),V.jsxs("div",{className:"relative z-10 p-8",children:[V.jsxs("div",{className:"text-center mb-8",children:[V.jsx("h1",{className:"wanderpaw-title text-4xl md:text-5xl font-bold text-[#687949] mb-2",children:"WanderPaw"}),V.jsx("p",{className:"text-sm text-[#687949] opacity-70",children:" "})]}),V.jsxs("div",{className:"flex rounded-2xl p-1 mb-6",style:{backgroundColor:"#F0E6D6"},children:[V.jsx("button",{onClick:y,className:`flex-1 py-2.5 px-4 rounded-xl text-sm font-medium transition-all duration-200 ${u?"bg-[#687949] text-white shadow-sm":"text-[#687949] hover:text-[#505D39]"}`,children:""}),V.jsx("button",{onClick:b,className:`flex-1 py-2.5 px-4 rounded-xl text-sm font-medium transition-all duration-200 ${u?"text-[#687949] hover:text-[#505D39]":"bg-[#687949] text-white shadow-sm"}`,children:""})]}),V.jsx("div",{className:"transition-all duration-300 ease-in-out",children:u?V.jsx(L8,{onSwitchToRegister:b}):V.jsx(z8,{onSwitchToLogin:y})}),V.jsxs("div",{className:"mt-6 text-center",children:[V.jsx("p",{className:"text-xs text-[#687949] opacity-60 mb-3",children:"    "}),V.jsxs("div",{className:"flex justify-center space-x-4",children:[V.jsx("a",{href:"#",className:"text-xs text-[#687949] opacity-50 hover:opacity-70 transition-opacity",children:""}),V.jsx("a",{href:"#",className:"text-xs text-[#687949] opacity-50 hover:opacity-70 transition-opacity",children:""}),V.jsx("a",{href:"#",className:"text-xs text-[#687949] opacity-50 hover:opacity-70 transition-opacity",children:"GitHub"})]})]})]})]})})})})},F8=()=>{const u=mc(),[p,y]=Fe.useState(!1),[b,C]=Fe.useState(null),[,M]=Nn(o1),[,D]=Nn(b8),[,r]=Nn(T8),[U]=Nn(as),[,G]=Nn(i1),Q=Pe=>{C(Pe)},se=async()=>{if(!b){Dn.error("");return}if(!U.accessToken){Dn.error("");return}y(!0);try{const Pe={type:b.type,name:b.name,gender:b.gender,personality:b.personality,age:b.age,avatar:b.avatar||b.emoji};await r4.initializePetInfo(Pe,U.accessToken),M(Pe),G({isInitialized:!0,petInfo:Pe}),D(!0),r(!1),Dn.success(` ${b.name} WanderPaw`),u("/home")}catch(Pe){Dn.error(Pe.message||"")}finally{y(!1)}},de=Pe=>{const Se=n4.find(ve=>ve.value===Pe);return Se?Se.label:Pe};return V.jsx(Sp,{children:V.jsxs("div",{className:"flex flex-col min-h-screen py-8 px-4 sm:px-6 lg:px-8",children:[V.jsxs("div",{className:"text-center mb-12",children:[V.jsx("h1",{className:"wanderpaw-title text-4xl md:text-5xl font-bold mb-4",style:{color:"#687949"},children:"WanderPaw"}),V.jsx("p",{className:"text-xl font-medium",style:{color:"#687949"},children:""})]}),V.jsx("div",{className:"flex-1 max-w-6xl mx-auto w-full",children:V.jsx("div",{className:"character-cards-grid mb-8",children:A8.map(Pe=>V.jsx("div",{onClick:()=>Q(Pe),tabIndex:0,className:`character-card ${(b==null?void 0:b.id)===Pe.id?"selected":""}`,children:V.jsxs("div",{className:"character-card-content",children:[V.jsxs("div",{className:"text-center mb-4",children:[V.jsx("div",{children:Pe.avatar?V.jsx("img",{src:Pe.avatar,alt:Pe.name,className:"w-30 h-20 object-cover mx-auto "}):V.jsx("div",{className:"text-6xl",children:Pe.emoji})}),V.jsx("div",{className:"bg-white/80 rounded-full px-4 py-2 inline-block",children:V.jsx("h3",{className:"font-bold text-gray-800 text-lg",children:Pe.name})})]}),V.jsxs("div",{className:"flex-1",children:[V.jsxs("div",{className:"rounded-lg p-4 mb-4 relative",children:[V.jsx("div",{className:"text-xl text-gray-400 absolute -top-1 -left-1",children:'"'}),V.jsx("p",{className:"text-sm text-gray-700 leading-relaxed italic px-3",children:Pe.description}),V.jsx("div",{className:"text-xl text-gray-400 absolute -bottom-1 -right-1",children:'"'})]}),Pe.personality.length>0&&V.jsx("div",{className:"flex flex-wrap gap-1 mb-3 justify-center",children:Pe.personality.slice(0,3).map(Se=>V.jsx("span",{className:"px-2 py-1 text-xs font-medium",style:{borderRadius:"19.5px",border:"1px solid #BBA084",background:"#FDF5E8",color:"#BBA084"},children:de(Se)},Se))})]}),(b==null?void 0:b.id)===Pe.id&&V.jsx("div",{className:"absolute top-2 right-2",children:V.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"36",height:"36",viewBox:"0 0 24 24",className:"text-emerald-600 opacity-70 transform rotate-12 drop-shadow-lg animate-pulse",children:[V.jsx("title",{children:"paw_fill"}),V.jsx("g",{id:"paw_fill",fill:"none",fillRule:"evenodd",children:V.jsx("path",{fill:"currentColor",d:"M12 3a1 1 0 0 1 1 1v.19c1.257.504 2 1.93 2 3.31 0 1.713-1.146 3.5-3 3.5S9 9.213 9 7.5c0-1.38.743-2.806 2-3.31V4a1 1 0 0 1 1-1m6.6 3.543a2.56 2.56 0 0 0-1.093.307c-.608.325-1.115.878-1.431 1.556-.316.677-.414 1.421-.272 2.095.142.675.545 1.342 1.27 1.68.724.338 1.495.218 2.103-.107.607-.325 1.114-.878 1.43-1.555.316-.678.414-1.422.272-2.096a2.562 2.562 0 0 0-.467-1.035 1 1 0 0 0-1.812-.845m-15.012.849c-.238.31-.39.67-.467 1.035-.142.674-.044 1.418.272 2.095.316.678.823 1.23 1.43 1.556.608.325 1.379.445 2.103.107.725-.338 1.128-1.006 1.27-1.68.142-.674.044-1.418-.272-2.096-.316-.677-.823-1.23-1.43-1.555A2.561 2.561 0 0 0 5.4 6.547a1 1 0 0 0-1.813.845Zm3.563 6.227A8.068 8.068 0 0 1 12 12c1.89 0 3.6.666 4.849 1.619 1.213.925 2.151 2.255 2.151 3.659 0 1.407-1.184 2.335-2.349 2.857C15.406 20.692 13.76 21 12 21c-1.76 0-3.406-.308-4.651-.865C6.184 19.613 5 18.685 5 17.278c0-1.404.938-2.734 2.151-3.66Z"})})]})})]})},Pe.id))})}),V.jsx("div",{className:"max-w-2xl mx-auto w-full",children:V.jsx("div",{className:"flex justify-center space-x-4",children:V.jsx("button",{onClick:se,disabled:!b||p,className:"px-8 py-3 text-white font-bold text-lg hover:opacity-80 transition-all duration-200 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-105 bg-[#687949] rounded-[20px]",children:p?"...":b?`${b.name}`:""})})})]})})},KS=()=>V.jsx(F8,{}),a1={world:{id:"world",name:"",nameEn:"World",type:"world",countryCode:"XX",currency:"USD",averageSalary:0,rentPrice:0,foodCost:0,transportCost:0,entertainmentCost:0,livingIndex:0,workLifeBalance:0,socialSafety:0,culturalDiversity:0,languageBarrier:0,climateComfort:0,internetSpeed:0,petFriendlyIndex:0,lifeQuality:0,stressFactor:0,freelanceFriendly:0,population:0,gdpPerCapita:0,unemploymentRate:0,timezone:"UTC",coordinates:[0,0]},CN:{id:"CN",name:"",nameEn:"China",type:"country",parentId:"world",countryCode:"CN",currency:"CNY",averageSalary:8500,rentPrice:2800,foodCost:1200,transportCost:400,entertainmentCost:800,livingIndex:65,workLifeBalance:45,socialSafety:85,culturalDiversity:70,languageBarrier:15,climateComfort:70,internetSpeed:120,petFriendlyIndex:58,lifeQuality:68,stressFactor:72,freelanceFriendly:55,population:1411778e3,gdpPerCapita:12551,unemploymentRate:5.1,timezone:"Asia/Shanghai",coordinates:[104.1954,35.8617]},JP:{id:"JP",name:"",nameEn:"Japan",type:"country",parentId:"world",countryCode:"JP",currency:"JPY",averageSalary:42e4,rentPrice:18e4,foodCost:8e4,transportCost:25e3,entertainmentCost:45e3,livingIndex:78,workLifeBalance:35,socialSafety:95,culturalDiversity:40,languageBarrier:75,climateComfort:75,internetSpeed:150,petFriendlyIndex:42,lifeQuality:82,stressFactor:85,freelanceFriendly:30,population:12544e4,gdpPerCapita:39285,unemploymentRate:2.8,timezone:"Asia/Tokyo",coordinates:[138.2529,36.2048]},KR:{id:"KR",name:"",nameEn:"South Korea",type:"country",parentId:"world",countryCode:"KR",currency:"KRW",averageSalary:38e5,rentPrice:12e5,foodCost:6e5,transportCost:18e4,entertainmentCost:4e5,livingIndex:72,workLifeBalance:25,socialSafety:88,culturalDiversity:35,languageBarrier:70,climateComfort:65,internetSpeed:200,petFriendlyIndex:32,lifeQuality:75,stressFactor:92,freelanceFriendly:25,population:51269e3,gdpPerCapita:31846,unemploymentRate:3.1,timezone:"Asia/Seoul",coordinates:[127.7669,35.9078]},SG:{id:"SG",name:"",nameEn:"Singapore",type:"country",parentId:"world",countryCode:"SG",currency:"SGD",averageSalary:6500,rentPrice:2800,foodCost:800,transportCost:120,entertainmentCost:600,livingIndex:85,workLifeBalance:55,socialSafety:95,culturalDiversity:95,languageBarrier:10,climateComfort:60,internetSpeed:250,petFriendlyIndex:65,lifeQuality:88,stressFactor:75,freelanceFriendly:80,population:5896e3,gdpPerCapita:72794,unemploymentRate:2.1,timezone:"Asia/Singapore",coordinates:[103.8198,1.3521]},TH:{id:"TH",name:"",nameEn:"Thailand",type:"country",parentId:"world",countryCode:"TH",currency:"THB",averageSalary:25e3,rentPrice:8e3,foodCost:4e3,transportCost:1500,entertainmentCost:3e3,livingIndex:45,workLifeBalance:75,socialSafety:70,culturalDiversity:85,languageBarrier:65,climateComfort:80,internetSpeed:85,petFriendlyIndex:78,lifeQuality:72,stressFactor:45,freelanceFriendly:85,population:6995e4,gdpPerCapita:7806,unemploymentRate:1.2,timezone:"Asia/Bangkok",coordinates:[100.9925,15.87]},DE:{id:"DE",name:"",nameEn:"Germany",type:"country",parentId:"world",countryCode:"DE",currency:"EUR",averageSalary:4200,rentPrice:1200,foodCost:400,transportCost:200,entertainmentCost:300,livingIndex:70,workLifeBalance:85,socialSafety:90,culturalDiversity:75,languageBarrier:45,climateComfort:70,internetSpeed:180,petFriendlyIndex:82,lifeQuality:88,stressFactor:35,freelanceFriendly:75,population:8324e4,gdpPerCapita:46258,unemploymentRate:3,timezone:"Europe/Berlin",coordinates:[10.4515,51.1657]},NL:{id:"NL",name:"",nameEn:"Netherlands",type:"country",parentId:"world",countryCode:"NL",currency:"EUR",averageSalary:4800,rentPrice:1500,foodCost:450,transportCost:180,entertainmentCost:350,livingIndex:75,workLifeBalance:90,socialSafety:92,culturalDiversity:90,languageBarrier:10,climateComfort:65,internetSpeed:220,petFriendlyIndex:88,lifeQuality:92,stressFactor:25,freelanceFriendly:95,population:17441e3,gdpPerCapita:52331,unemploymentRate:3.2,timezone:"Europe/Amsterdam",coordinates:[5.2913,52.1326]},DK:{id:"DK",name:"",nameEn:"Denmark",type:"country",parentId:"world",countryCode:"DK",currency:"DKK",averageSalary:32e3,rentPrice:12e3,foodCost:3500,transportCost:1200,entertainmentCost:2500,livingIndex:80,workLifeBalance:95,socialSafety:95,culturalDiversity:80,languageBarrier:5,climateComfort:60,internetSpeed:200,petFriendlyIndex:92,lifeQuality:95,stressFactor:20,freelanceFriendly:90,population:5831e3,gdpPerCapita:60170,unemploymentRate:2.9,timezone:"Europe/Copenhagen",coordinates:[9.5018,56.2639]},US:{id:"US",name:"",nameEn:"United States",type:"country",parentId:"world",countryCode:"US",currency:"USD",averageSalary:5800,rentPrice:1800,foodCost:600,transportCost:300,entertainmentCost:400,livingIndex:75,workLifeBalance:50,socialSafety:65,culturalDiversity:85,languageBarrier:5,climateComfort:75,internetSpeed:180,petFriendlyIndex:62,lifeQuality:78,stressFactor:68,freelanceFriendly:85,population:3319e5,gdpPerCapita:70248,unemploymentRate:3.7,timezone:"America/New_York",coordinates:[-95.7129,37.0902]},CA:{id:"CA",name:"",nameEn:"Canada",type:"country",parentId:"world",countryCode:"CA",currency:"CAD",averageSalary:6200,rentPrice:1600,foodCost:550,transportCost:250,entertainmentCost:350,livingIndex:72,workLifeBalance:80,socialSafety:88,culturalDiversity:95,languageBarrier:5,climateComfort:55,internetSpeed:160,petFriendlyIndex:85,lifeQuality:88,stressFactor:35,freelanceFriendly:80,population:38e6,gdpPerCapita:46194,unemploymentRate:5.2,timezone:"America/Toronto",coordinates:[-106.3468,56.1304]},AU:{id:"AU",name:"",nameEn:"Australia",type:"country",parentId:"world",countryCode:"AU",currency:"AUD",averageSalary:7200,rentPrice:2e3,foodCost:600,transportCost:200,entertainmentCost:400,livingIndex:78,workLifeBalance:85,socialSafety:85,culturalDiversity:90,languageBarrier:5,climateComfort:85,internetSpeed:140,petFriendlyIndex:88,lifeQuality:90,stressFactor:30,freelanceFriendly:85,population:2569e4,gdpPerCapita:51812,unemploymentRate:3.7,timezone:"Australia/Sydney",coordinates:[133.7751,-25.2744]},"CN-BJ":{id:"CN-BJ",name:"",nameEn:"Beijing",type:"province",parentId:"CN",countryCode:"CN",currency:"CNY",averageSalary:12e3,rentPrice:4500,foodCost:1500,transportCost:300,entertainmentCost:1e3,livingIndex:85,workLifeBalance:35,socialSafety:90,culturalDiversity:60,languageBarrier:10,climateComfort:60,internetSpeed:150,petFriendlyIndex:45,lifeQuality:72,stressFactor:85,freelanceFriendly:65,population:2154e4,gdpPerCapita:24e3,unemploymentRate:4.2,timezone:"Asia/Shanghai",coordinates:[116.4074,39.9042]},"CN-SH":{id:"CN-SH",name:"",nameEn:"Shanghai",type:"province",parentId:"CN",countryCode:"CN",currency:"CNY",averageSalary:11500,rentPrice:4200,foodCost:1400,transportCost:280,entertainmentCost:950,livingIndex:82,workLifeBalance:40,socialSafety:88,culturalDiversity:75,languageBarrier:15,climateComfort:65,internetSpeed:180,petFriendlyIndex:48,lifeQuality:75,stressFactor:82,freelanceFriendly:70,population:2487e4,gdpPerCapita:25e3,unemploymentRate:4.1,timezone:"Asia/Shanghai",coordinates:[121.4737,31.2304]},"CN-GD":{id:"CN-GD",name:"",nameEn:"Guangdong",type:"province",parentId:"CN",countryCode:"CN",currency:"CNY",averageSalary:9200,rentPrice:3200,foodCost:1200,transportCost:350,entertainmentCost:800,livingIndex:75,workLifeBalance:50,socialSafety:85,culturalDiversity:80,languageBarrier:20,climateComfort:80,internetSpeed:140,petFriendlyIndex:62,lifeQuality:72,stressFactor:70,freelanceFriendly:75,population:126012e3,gdpPerCapita:13500,unemploymentRate:3.8,timezone:"Asia/Shanghai",coordinates:[113.2644,23.1291]},"CN-ZJ":{id:"CN-ZJ",name:"",nameEn:"Zhejiang",type:"province",parentId:"CN",countryCode:"CN",currency:"CNY",averageSalary:9800,rentPrice:2800,foodCost:1100,transportCost:280,entertainmentCost:750,livingIndex:70,workLifeBalance:55,socialSafety:88,culturalDiversity:65,languageBarrier:25,climateComfort:75,internetSpeed:130,petFriendlyIndex:68,lifeQuality:78,stressFactor:65,freelanceFriendly:72,population:654e5,gdpPerCapita:17500,unemploymentRate:3.2,timezone:"Asia/Shanghai",coordinates:[120.1537,30.2654]},"CN-SC":{id:"CN-SC",name:"",nameEn:"Sichuan",type:"province",parentId:"CN",countryCode:"CN",currency:"CNY",averageSalary:7200,rentPrice:1800,foodCost:900,transportCost:220,entertainmentCost:500,livingIndex:55,workLifeBalance:70,socialSafety:82,culturalDiversity:75,languageBarrier:30,climateComfort:85,internetSpeed:110,petFriendlyIndex:78,lifeQuality:75,stressFactor:50,freelanceFriendly:68,population:83675e3,gdpPerCapita:8500,unemploymentRate:4.5,timezone:"Asia/Shanghai",coordinates:[104.0665,30.5728]},"CN-QD":{id:"CN-QD",name:"",nameEn:"Qingdao",type:"city",parentId:"CN",countryCode:"CN",currency:"CNY",averageSalary:8200,rentPrice:2200,foodCost:1e3,transportCost:250,entertainmentCost:600,livingIndex:62,workLifeBalance:75,socialSafety:85,culturalDiversity:70,languageBarrier:25,climateComfort:80,internetSpeed:120,petFriendlyIndex:72,lifeQuality:78,stressFactor:55,freelanceFriendly:70,population:10071e3,gdpPerCapita:14500,unemploymentRate:3.8,timezone:"Asia/Shanghai",coordinates:[120.3826,36.0671]}},O8="/assets/%E5%A4%B9%E5%AD%90-Cy-UU36C.jpg",N8="/xhs-api",B8="/spider",Mx=Or.create({baseURL:`${N8}${B8}`,timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!1});class JS{static async searchCityRoutes(p,y=""){var b,C,M;try{const r=[p,y].join(" ");console.log(":",{cityName:p,routeType:y,query:r});const U={query:r,require_num:5,save_choice:"none",sort_type_choice:0,note_type:0,note_time:0,note_range:0,pos_distance:0},G=await Mx.post("/search",U);return console.log(":",{success:G.data.success,noteCount:((C=(b=G.data.data)==null?void 0:b.notes)==null?void 0:C.length)||0}),G.data}catch(D){if(console.error(":",D),D.code==="ERR_NETWORK"||D.code==="ECONNREFUSED")throw new Error("");if(D.code==="ECONNABORTED")throw new Error("");if((M=D.response)!=null&&M.data){const r=D.response.data.message||D.response.data.error||"";throw new Error(r)}throw new Error("")}}static processRouteData(p){var r;if(!p.success||!((r=p.data)!=null&&r.notes))return{routes:[],routeSummary:{popularRoutes:[],recommendedDuration:[],mustVisitSpots:[]},totalNotes:0};const y=p.data.notes,b=[],C=[],M=[],D=[];return y.forEach(U=>{var se;const G=`${U.title} ${U.desc}`.toLowerCase();if(["","","","","","","",""].some(de=>G.includes(de))){const de=parseInt(U.interact_info.liked_count||"0")+parseInt(U.interact_info.collected_count||"0")+parseInt(U.interact_info.comment_count||"0");b.push({title:U.title,description:U.desc,author:U.user.nickname,tags:((se=U.tag_list)==null?void 0:se.map(Se=>Se.name))||[],interactionCount:de}),U.title.includes("")&&C.push(U.title);const Pe=G.match(/([1-9]+[])/g);Pe&&M.push(...Pe),U.tag_list&&U.tag_list.forEach(Se=>{Se.name&&Se.name.length>1&&!Se.name.includes("")&&D.push(Se.name)})}}),b.sort((U,G)=>G.interactionCount-U.interactionCount),{routes:b.slice(0,10),routeSummary:{popularRoutes:[...new Set(C)].slice(0,5),recommendedDuration:[...new Set(M)].slice(0,3),mustVisitSpots:[...new Set(D)].slice(0,8)},totalNotes:b.length}}static async searchTravelContent(p,y=[]){var b,C,M;try{const r=[p,"","",...y].join(" ");console.log(":",{cityName:p,additionalKeywords:y,query:r});const U={query:r,require_num:10,save_choice:"none",sort_type_choice:0,note_type:0,note_time:0,note_range:0,pos_distance:0},G=await Mx.post("/search",U);return console.log(":",{success:G.data.success,noteCount:((C=(b=G.data.data)==null?void 0:b.notes)==null?void 0:C.length)||0}),G.data}catch(D){if(console.error(":",D),D.code==="ERR_NETWORK"||D.code==="ECONNREFUSED")throw new Error("");if(D.code==="ECONNABORTED")throw new Error("");if((M=D.response)!=null&&M.data){const r=D.response.data.message||D.response.data.error||"";throw new Error(r)}throw new Error("")}}static processTravelData(p){var D;if(!p.success||!((D=p.data)!=null&&D.notes))return{travelTips:[],popularSpots:[],recommendations:[],totalNotes:0};const y=p.data.notes,b=[],C=[],M=[];return y.forEach(r=>{const U=`${r.title} ${r.desc}`.toLowerCase();r.title&&r.title.length>5&&M.push(`${r.title}${r.user.nickname}`),r.tag_list&&r.tag_list.forEach(G=>{G.name&&G.name.length>1&&C.push(G.name)}),(U.includes("")||U.includes("")||U.includes(""))&&b.push(`${r.title}${r.desc.slice(0,100)}`)}),{travelTips:[...new Set(b)].slice(0,5),popularSpots:[...new Set(C)].slice(0,8),recommendations:[...new Set(M)].slice(0,6),totalNotes:y.length}}static async checkHealth(){var p,y;try{const b=await Mx.post("/search",{query:"test",require_num:1,save_choice:"none",sort_type_choice:0,note_type:0,note_time:0,note_range:0,pos_distance:0},{timeout:1e4,headers:{Accept:"application/json"}});return b.status===200?{status:"ok",message:"XHS service is running through proxy"}:{status:"error",message:`XHS service returned status ${b.status}`}}catch(b){return console.error(":",b),((p=b.response)==null?void 0:p.status)===400?{status:"ok",message:"XHS service is running (test request rejected but service available)"}:{status:"error",message:((y=b.response)==null?void 0:y.status)===404?"":b.code==="ECONNREFUSED"?"":""}}}}const QS={11e4:{name:"",nameEn:"Beijing",coordinates:[116.4074,39.9042]},12e4:{name:"",nameEn:"Tianjin",coordinates:[117.2008,39.0842]},13e4:{name:"",nameEn:"Hebei",coordinates:[114.5149,38.0428]},14e4:{name:"",nameEn:"Shanxi",coordinates:[112.5489,37.857]},15e4:{name:"",nameEn:"Inner Mongolia",coordinates:[111.6708,40.8183]},21e4:{name:"",nameEn:"Liaoning",coordinates:[123.4315,41.8057]},22e4:{name:"",nameEn:"Jilin",coordinates:[125.3245,43.8868]},23e4:{name:"",nameEn:"Heilongjiang",coordinates:[126.642,45.756]},31e4:{name:"",nameEn:"Shanghai",coordinates:[121.4737,31.2304]},32e4:{name:"",nameEn:"Jiangsu",coordinates:[118.7633,32.0615]},33e4:{name:"",nameEn:"Zhejiang",coordinates:[120.1536,30.265]},34e4:{name:"",nameEn:"Anhui",coordinates:[117.2757,31.8612]},35e4:{name:"",nameEn:"Fujian",coordinates:[119.2965,26.0745]},36e4:{name:"",nameEn:"Jiangxi",coordinates:[115.9092,28.6765]},37e4:{name:"",nameEn:"Shandong",coordinates:[117.0009,36.6758]},41e4:{name:"",nameEn:"Henan",coordinates:[113.65,34.7574]},42e4:{name:"",nameEn:"Hubei",coordinates:[114.298,30.5844]},43e4:{name:"",nameEn:"Hunan",coordinates:[112.9836,28.1124]},44e4:{name:"",nameEn:"Guangdong",coordinates:[113.2644,23.1291]},45e4:{name:"",nameEn:"Guangxi",coordinates:[108.3201,22.82]},46e4:{name:"",nameEn:"Hainan",coordinates:[110.3312,20.0311]},5e5:{name:"",nameEn:"Chongqing",coordinates:[106.5048,29.5343]},51e4:{name:"",nameEn:"Sichuan",coordinates:[104.0665,30.5723]},52e4:{name:"",nameEn:"Guizhou",coordinates:[106.707,26.5982]},53e4:{name:"",nameEn:"Yunnan",coordinates:[102.7123,25.0406]},54e4:{name:"",nameEn:"Tibet",coordinates:[91.1174,29.6456]},61e4:{name:"",nameEn:"Shaanxi",coordinates:[108.954,34.2658]},62e4:{name:"",nameEn:"Gansu",coordinates:[103.8236,36.0581]},63e4:{name:"",nameEn:"Qinghai",coordinates:[101.7804,36.623]},64e4:{name:"",nameEn:"Ningxia",coordinates:[106.2586,38.4711]},65e4:{name:"",nameEn:"Xinjiang",coordinates:[87.6177,43.7928]},71e4:{name:"",nameEn:"Taiwan",coordinates:[121.5654,25.033]},81e4:{name:"",nameEn:"Hong Kong",coordinates:[114.1694,22.3193]},82e4:{name:"",nameEn:"Macau",coordinates:[113.5439,22.1987]}};class hv{static async geocodeAddress(p,y={}){const{timeout:b=5e3,fallbackCoordinates:C=[116.4074,39.9042],useStaticData:M=!0}=y;try{const D=this.cleanAddress(p);if(M){const Q=this.searchStaticData(D);if(Q)return Q}const r=await this.geocodeWithMapbox(D,b);if(r)return r;const U=await this.geocodeWithNominatim(D,b);if(U)return U;const G=this.fuzzySearchStaticData(D);return G||{address:D,coordinates:C,confidence:.1,source:"fallback"}}catch(D){return console.error(":",D),{address:p,coordinates:C,confidence:.1,source:"fallback"}}}static async batchGeocode(p,y={}){const b=[];for(let M=0;M<p.length;M+=3){const D=p.slice(M,M+3),r=await Promise.all(D.map(U=>this.geocodeAddress(U,y)));b.push(...r),M+3<p.length&&await new Promise(U=>setTimeout(U,100))}return b}static cleanAddress(p){return p.replace(/^.*?/,"").replace(/[^\w\u4e00-\u9fa5\u3040-\u309f\u30a0-\u30ff\s-]/g,"").trim()}static searchStaticData(p){if(this.STATIC_LOCATIONS[p])return{address:p,coordinates:this.STATIC_LOCATIONS[p],confidence:1,source:"static"};for(const y of Object.values(QS))if(y.name===p||y.nameEn===p)return{address:p,coordinates:y.coordinates,confidence:.9,source:"static"};return null}static fuzzySearchStaticData(p){const y=p.toLowerCase();for(const[b,C]of Object.entries(this.STATIC_LOCATIONS))if(b.includes(p)||p.includes(b))return{address:p,coordinates:C,confidence:.7,source:"static"};for(const b of Object.values(QS))if(b.name.includes(p)||b.nameEn.toLowerCase().includes(y))return{address:p,coordinates:b.coordinates,confidence:.6,source:"static"};return null}static async geocodeWithMapbox(p,y){try{const C=`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(p)}.json?access_token=${this.MAPBOX_TOKEN}&limit=1&language=zh`,M=new AbortController,D=setTimeout(()=>M.abort(),y),r=await fetch(C,{signal:M.signal,headers:{Accept:"application/json"}});if(clearTimeout(D),!r.ok)throw new Error(`Mapbox API: ${r.status}`);const U=await r.json();if(U.features&&U.features.length>0){const G=U.features[0],[Q,se]=G.center;return{address:p,coordinates:[Q,se],confidence:G.relevance||.8,source:"api"}}return null}catch(b){return b instanceof Error&&b.name==="AbortError"?console.warn("Mapbox:",p):console.warn("Mapbox:",b),null}}static isValidCoordinates(p){const[y,b]=p;return y>=-180&&y<=180&&b>=-90&&b<=90}static calculateDistance(p,y){const[b,C]=p,[M,D]=y,r=6371,U=(D-C)*Math.PI/180,G=(M-b)*Math.PI/180,Q=Math.sin(U/2)*Math.sin(U/2)+Math.cos(C*Math.PI/180)*Math.cos(D*Math.PI/180)*Math.sin(G/2)*Math.sin(G/2),se=2*Math.atan2(Math.sqrt(Q),Math.sqrt(1-Q));return r*se}static async geocodeWithNominatim(p,y){try{const C=`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(p)}&format=json&limit=1&accept-language=zh,en`,M=new AbortController,D=setTimeout(()=>M.abort(),y),r=await fetch(C,{signal:M.signal,headers:{Accept:"application/json","User-Agent":"WanderPaw-App/1.0"}});if(clearTimeout(D),!r.ok)throw new Error(`Nominatim API: ${r.status}`);const U=await r.json();if(U&&U.length>0){const G=U[0],Q=parseFloat(G.lon),se=parseFloat(G.lat);return{address:p,coordinates:[Q,se],confidence:.7,source:"api"}}return null}catch(b){return b instanceof Error&&b.name==="AbortError"?console.warn("Nominatim:",p):console.warn("Nominatim:",b),null}}}Q0(hv,"MAPBOX_TOKEN","pk.eyJ1IjoieHVuaXh3d2kiLCJhIjoiY21kOW92ODUyMGE1aDJscTNuaW55eWNocyJ9.sqfV_Ukyc6u9jgWeq3vukQ"),Q0(hv,"STATIC_LOCATIONS",{:[139.6969,35.6439],:[139.6956,35.6503],:[139.6681,35.6611],MoCHA:[139.7027,35.6695],:[139.7027,35.6695],:[139.6958,35.6719],:[139.7016,35.658],:[139.7016,35.658],"Sunshine City":[139.7179,35.7295],:[139.7108,35.7297],:[139.7643,35.7285],:[139.7615,35.7283],:[139.7738,35.7144],:[139.7738,35.7144],:[139.7762,35.7188],:[139.7738,35.7144],:[139.7967,35.7148],:[139.7967,35.7148],:[139.8024,35.7148],"":[139.7738,35.7144],:[116.4074,39.9042],:[121.4737,31.2304],:[120.1551,30.2741],:[114.0579,22.5431],:[113.2644,23.1291],:[104.0668,30.5728],:[108.9398,34.3412],:[118.7969,32.0603],:[114.3162,30.581],:[106.5104,29.5647],:[117.2008,39.0842],:[120.5954,31.2989],:[120.3826,36.0668],:[121.6147,38.914],:[118.1689,24.4797],:[121.544,29.8683],:[139.6503,35.6762],:[135.5023,34.6937],:[135.7681,35.0116],:[136.9066,35.1815],:[130.4017,33.5904],:[-74.006,40.7128],:[-118.2437,34.0522],:[-122.4194,37.7749],:[-.1276,51.5074],:[2.3522,48.8566],:[13.405,52.52],:[12.4964,41.9028],:[151.2093,-33.8688],:[144.9631,-37.8136],:[126.978,37.5665],:[103.8198,1.3521],:[100.5018,13.7563],:[101.6869,3.139]});function dv(u,p=!0){try{const y=u.content.text,b=JSON.parse(y);if(!b.city||!b.plan||!Array.isArray(b.plan))return{success:!1,error:""};const C=b.plan.map((M,D)=>{const r=`ai_activity_${D+1}`,U=M.time.split("-"),G=U[0]||"09:00",Q=U[1]||"10:00",se=V8(G,Q),de=M.place.replace(/^.*?/,""),Pe=U8(M.tags);return{id:r,time:G,title:de,titleEn:Rx(de),location:de,locationEn:Rx(de),theme:Pe,duration:se,description:M.description,descriptionEn:Rx(M.description),coordinates:void 0,tips:M.tags,estimatedCost:void 0,difficulty:"easy"}});return{success:!0,data:{city:b.city,travelStyle:b.travel_style,themes:b.travel_theme,activities:C}}}catch(y){return console.error("AI:",y),{success:!1,error:`: ${y instanceof Error?y.message:""}`}}}async function j8(u,p=!0){try{const y=dv(u,!1);if(!y.success||!y.data)return y;const{data:b}=y;if(!p)return y;console.log("...");const C=b.activities.map(U=>U.location),M=await hv.batchGeocode(C,{timeout:3e3,useStaticData:!0});console.log(":",M);const D=b.activities.map((U,G)=>{const Q=M[G];return{...U,coordinates:Q?Q.coordinates:void 0}}),r=M.filter(U=>U&&U.confidence>.5).length;return console.log(`: ${r}/${C.length} `),{success:!0,data:{...b,activities:D}}}catch(y){console.error("AI:",y);const b=dv(u,!1);return b.success?(console.warn(""),b):{success:!1,error:`: ${y instanceof Error?y.message:""}`}}}function V8(u,p){try{const[y,b]=u.split(":").map(Number),[C,M]=p.split(":").map(Number),D=y*60+b,U=C*60+M-D;return U>0?U:60}catch{return 60}}function U8(u){const p={:"nature",:"culture",:"food",:"shopping",:"photography",:"relaxation",:"walking",:"nightlife",:"pet-friendly",:"interactive",:"adventure",:"vintage",:"surprise"};for(const y of u)if(p[y])return p[y];return"culture"}function Rx(u){return{:"Nakameguro Riverside",:"Daikanyama T-Site",:"Shimokitazawa Streets",MoCHA:"Harajuku Cat Cafe MoCHA",:"Harajuku Street",:"Yoyogi Park Lawn",:"Shibuya Station",:"Shibuya Cat Street","Sunshine City":"Ikebukuro Sunshine City Rooftop Garden",:"Ikebukuro Station Convenience Store","":"Want to walk slowly along the river meow~","":"Want to sleep in the bookshelf~","":"Want to explore alleys to find cats~","":"Want to eat while cuddling cats!","":"Praised by passersby as cute meow~","":"Going to roll on the grass meow meow!","":"Got lost and saw dancing meow!","":"Want to buy cat ear headband~","":"Want to stargaze and daydream meow~","":"Got excited eating cheese rice ball!"}[u]||u}const s4="/api",o4="/chat",G8=Or.create({baseURL:`${s4}${o4}`,timeout:6e4,headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!1});class a4{static async parseAITripPlanResponse(p,y="zh"){try{console.log("AI...");const b=await j8(p,!0);if(!b.success||!b.data)return{success:!1,message:"AI",error:b.error||""};const{data:C}=b,M=y==="zh"?`${C.city}`:`${C.city} Day Trip Plan`,D=`${C.city} Day Trip Plan`,r=y==="zh"?`${C.city}${C.travelStyle}${C.activities.length}`:`A carefully planned ${C.travelStyle} in ${C.city} with ${C.activities.length} selected activities.`,U=`A carefully planned ${C.travelStyle} in ${C.city} with ${C.activities.length} selected activities.`,G=C.activities.reduce((se,de)=>se+de.duration,0),Q=y==="zh"?[`${C.travelStyle}`,"","",""]:[`This plan is suitable for ${C.travelStyle}`,"Please adjust the schedule according to actual conditions","It is recommended to check the opening hours of attractions in advance","Pay attention to weather changes and make appropriate preparations"];return console.log("AI:",{city:C.city,activitiesCount:C.activities.length,totalDuration:G,themes:C.themes}),{success:!0,message:"AI",data:{planTitle:M,planTitleEn:D,activities:C.activities,summary:r,summaryEn:U,totalDuration:G,estimatedBudget:void 0,notes:Q,xhsSourceCount:0}}}catch(b){return console.error("AI:",b),{success:!1,message:"AI",error:b instanceof Error?b.message:""}}}static async generateTripPlan(p,y){var b,C,M,D;try{console.log(":",{city:p.cityName,themes:p.themes,hasPetInfo:!!p.petInfo,hasXhsData:!!p.xhsData,language:p.language});let r=p.xhsData;if(!r)try{console.log("...");const se=await JS.searchTravelContent(p.cityName,[...p.themeNames,"",""]);r=JS.processTravelData(se),console.log(":",{travelTips:r.travelTips.length,popularSpots:r.popularSpots.length,recommendations:r.recommendations.length})}catch(se){console.warn(":",se),r={travelTips:[],popularSpots:[],recommendations:[],totalNotes:0}}const U={destination:p.cityName,destination_en:p.cityNameEn,travel_themes:p.themes.join(", "),travel_themes_names:p.themeNames.join(", "),language:p.language,duration:p.duration||1,pet_name:p.petInfo.name||"",pet_type:p.petInfo.type||"",pet_character:((b=p.petInfo.personality)==null?void 0:b.join(", "))||"",pet_preferences:"",pet_age:p.petInfo.age||"",pet_special_needs:"",xhs_travel_tips:r.travelTips.join(`
`),xhs_popular_spots:r.popularSpots.join(", "),xhs_recommendations:r.recommendations.join(`
`),xhs_source_count:r.totalNotes,generate_coordinates:!0,include_timeline:!0,include_pet_activities:!0,output_format:"structured_json"};console.log("Dify:",{inputsKeys:Object.keys(U),destinationInfo:`${p.cityName} (${p.cityNameEn})`,petInfo:`${p.petInfo.name} (${p.petInfo.type})`,xhsDataStatus:r.totalNotes>0?"":""});const G={origin_data:JSON.stringify(r),travel_style:`${p.petInfo.name}(${p.petInfo.type})${p.duration}`,travel_theme:p.themeNames.join(""),city:p.cityName,streaming:!1},Q=await G8.post("/generate-task-plan",G,{headers:{Authorization:`Bearer ${y}`}});if(console.log("Dify:",{status:Q.data.status,hasResponse:!!Q.data.response,hasError:!!Q.data.error}),Q.data.status==="completed"&&Q.data.response)return{success:!0,message:"",data:{...this.parseTripPlanFromDify(Q.data.response,p.language),xhsSourceCount:r.totalNotes}};throw Q.data.error?new Error(Q.data.error):new Error("Dify")}catch(r){throw console.error(":",r),r.code==="ERR_NETWORK"||r.code==="ECONNREFUSED"?new Error(""):((C=r.response)==null?void 0:C.status)===401?new Error(""):r.code==="ECONNABORTED"?new Error(""):(D=(M=r.response)==null?void 0:M.data)!=null&&D.error?new Error(r.response.data.error):new Error(r.message||"")}}static parseTripPlanFromDify(p,y){try{console.log("Dify:",p);let b=p;if(typeof p=="string"){const D=p.match(/\{[\s\S]*\}/);if(D)b=JSON.parse(D[0]);else return this.parseTextTripPlan(p,y)}if(b.content&&b.content.text){console.log("AI");const D=dv(b);if(D.success&&D.data){const{data:r}=D;return{planTitle:y==="zh"?`${r.city}`:`${r.city} Day Trip Plan`,planTitleEn:`${r.city} Day Trip Plan`,activities:r.activities,summary:y==="zh"?`${r.city}${r.travelStyle}${r.activities.length}`:`A carefully planned ${r.travelStyle} in ${r.city} with ${r.activities.length} selected activities.`,summaryEn:`A carefully planned ${r.travelStyle} in ${r.city} with ${r.activities.length} selected activities.`,totalDuration:r.activities.reduce((U,G)=>U+G.duration,0),estimatedBudget:void 0,notes:y==="zh"?[`${r.travelStyle}`,"","",""]:[`This plan is suitable for ${r.travelStyle}`,"Please adjust the schedule according to actual conditions","It is recommended to check the opening hours of attractions in advance","Pay attention to weather changes and make appropriate preparations"]}}}const C=[];return(b.activities||b.itinerary||b.schedule||b.plan||[]).forEach((D,r)=>{const U=D.id||`activity_${r+1}`;let G=D.time,Q=D.duration||120;if(G&&G.includes("-")){const[ve,ce]=G.split("-");G=ve;try{const[ze,et]=ve.split(":").map(Number),[pt,Tt]=ce.split(":").map(Number),It=ze*60+et,di=pt*60+Tt;Q=di-It>0?di-It:120}catch{Q=120}}else G||(G=`${(9+r*2).toString().padStart(2,"0")}:00`);const de=(D.place||D.location||"").replace(/^.*?/,""),Pe=ve=>{const ce={:"nature",:"culture",:"food",:"shopping",:"photography",:"relaxation",:"walking",:"nightlife",:"pet-friendly",:"interactive",:"adventure",:"vintage",:"surprise"};for(const ze of ve)if(ce[ze])return ce[ze];return"culture"},Se=D.theme||D.category||(D.tags?Pe(D.tags):"culture");C.push({id:U,time:G,title:D.title||D.name||de||` ${r+1}`,titleEn:D.titleEn||D.nameEn||D.title||de||`Activity ${r+1}`,location:de,locationEn:D.locationEn||D.placeEn||de||"TBD",theme:Se,duration:Q,description:D.description||D.details||"",descriptionEn:D.descriptionEn||D.detailsEn||D.description||"",coordinates:D.coordinates||D.location_coords,tips:D.tips||D.tags||[],estimatedCost:D.cost||D.price,difficulty:D.difficulty||"easy"})}),{planTitle:b.title||b.planTitle||(y==="zh"?"":"My Trip Plan"),planTitleEn:b.titleEn||b.planTitleEn||b.title||"My Trip Plan",activities:C,summary:b.summary||b.description||"",summaryEn:b.summaryEn||b.descriptionEn||b.summary||"",totalDuration:C.reduce((D,r)=>D+r.duration,0),estimatedBudget:b.budget||b.estimatedCost,notes:b.notes||b.tips||[]}}catch(b){return console.error("Dify:",b),this.parseTextTripPlan(p,y)}}static parseTextTripPlan(p,y){const b=p.split(`
`).filter(D=>D.trim()),C=[];let M=9;return b.forEach((D,r)=>{if(D.includes("")||D.includes(":")){const U=`${M.toString().padStart(2,"0")}:00`;C.push({id:`activity_${r+1}`,time:U,title:D.split("")[0]||D.split(":")[0]||` ${r+1}`,titleEn:`Activity ${r+1}`,location:"",locationEn:"TBD",theme:"culture",duration:120,description:D,descriptionEn:D}),M+=2}}),{planTitle:y==="zh"?"":"My Trip Plan",planTitleEn:"My Trip Plan",activities:C,summary:p.slice(0,200),summaryEn:p.slice(0,200),totalDuration:C.reduce((D,r)=>D+r.duration,0),notes:[]}}static async checkHealth(){var p,y,b;try{const C=await Or.post(`${s4}${o4}/generate-task-plan`,{origin_data:"test",travel_style:"test",travel_theme:"test",city:"test"},{timeout:5e3,headers:{Accept:"application/json",Authorization:"Bearer test-token"}});return{status:"ok",message:"Trip planning service is running"}}catch(C){return console.error(":",(p=C.response)==null?void 0:p.status,C.message),((y=C.response)==null?void 0:y.status)===401||((b=C.response)==null?void 0:b.status)===400?{status:"ok",message:"Trip planning service is running (auth required)"}:{status:"error",message:C.code==="ECONNREFUSED"?"":""}}}}const kx=[{id:"photography",name:"",nameEn:"Photography",icon:"",description:"",descriptionEn:"Find the most beautiful angles to record your journey",gradient:"from-pink-400 to-purple-500",popularity:95},{id:"nature",name:"",nameEn:"Nature Healing",icon:"",description:"",descriptionEn:"Want to feel the wind, rain and forests",gradient:"from-green-400 to-emerald-500",popularity:90},{id:"culture",name:"",nameEn:"Cultural Experience",icon:"",description:"",descriptionEn:"Want to experience the local culture",gradient:"from-blue-400 to-indigo-500",popularity:82},{id:"random",name:"",nameEn:"Random Adventure",icon:"",description:"",descriptionEn:"Let the little pet decide",gradient:"from-purple-400 to-pink-500",popularity:88}],e3=()=>{var Se;const u=mc(),{cityId:p}=rM(),[y]=Nn(pd),[b]=Nn(as),C=(Se=b.user)==null?void 0:Se.petInfo,[M,D]=Fe.useState(null),[r,U]=Fe.useState(null),[G,Q]=Fe.useState(!1),se=()=>{if(console.log("authState.user:",b.user),console.log("petInfo:",C),!b.user||!C)return console.log(""),{src:"/decorations/capybara.jpeg",alt:y==="zh"?"":"Capybara decoration"};if(C.avatar)return console.log(":",C.avatar),{src:C.avatar,alt:C.name||(y==="zh"?"":"Pet decoration")};switch(console.log(":",C.type),C.type){case"cat":return{src:"/decorations/cat.png",alt:y==="zh"?"":"Cat decoration"};case"dog":return{src:"/decorations/fox.png",alt:y==="zh"?"":"Dog decoration"};case"other":return{src:"/decorations/capybara.jpeg",alt:y==="zh"?"":"Capybara decoration"};case"none":case void 0:case null:default:return{src:"/decorations/capybara.jpeg",alt:y==="zh"?"":"Capybara decoration"}}};Fe.useEffect(()=>{if(p){const ve=a1[p];D(ve)}},[p]);const de=async ve=>{if(!M){Dn.error(y==="zh"?"":"City data not loaded");return}if(!b.accessToken){Dn.error(y==="zh"?"":"Please login first"),u("/auth");return}if(!C||!C.name){Dn.error(y==="zh"?"":"Please set pet information first"),u("/pet-initialization");return}Q(!0);try{const ce=Dn.loading(y==="zh"?"...":"Generating exclusive trip plan..."),ze=kx.find(It=>It.id===ve),et=ze?[y==="zh"?ze.name:ze.nameEn]:[],pt={cityName:y==="zh"?M.name:M.nameEn,cityNameEn:M.nameEn||M.name,themes:[ve],themeNames:et,duration:1,petInfo:C,language:y};console.log(":",pt);const Tt=await a4.generateTripPlan(pt,b.accessToken);if(Dn.dismiss(ce),Tt.success&&Tt.data)Dn.success(y==="zh"?`${Tt.data.activities.length}`:`Trip plan generated! Including ${Tt.data.activities.length} activities`,{duration:3e3}),u("/trip-plan",{state:{tripPlan:{cityId:p,cityName:pt.cityName,themes:pt.themes,selectedThemeNames:et},generatedPlan:Tt.data,isAiGenerated:!0}});else throw new Error(Tt.error||"")}catch(ce){if(console.error(":",ce),Dn.error(y==="zh"?`${ce.message}`:`Generation failed: ${ce.message}`,{duration:5e3}),ce.message.includes("")||ce.message.includes("connect")){Dn(y==="zh"?"":"Switching to offline mode for plan generation",{icon:"",duration:3e3});const ze=kx.find(Tt=>Tt.id===ve),et=ze?[y==="zh"?ze.name:ze.nameEn]:[],pt={cityId:p,cityName:y==="zh"?M.name:M.nameEn,themes:[ve],selectedThemeNames:et};u("/trip-plan",{state:{tripPlan:pt}})}}finally{Q(!1)}},Pe=()=>{u(-1)};return M?V.jsxs(Sp,{children:[V.jsxs("div",{onClick:Pe,className:"absolute top-6 left-6 z-20 flex items-center gap-2 text-[#687949] bg-transparent p-2 rounded-lg cursor-pointer transform transition-transform duration-200 hover:scale-110",children:[V.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:V.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),V.jsx("span",{children:y==="zh"?"":"Back"})]}),V.jsx("div",{className:"fixed bottom-0 left-[3vh] z-0",children:V.jsx("img",{src:se().src,alt:se().alt,className:"w-[35vh] h-[35vh] object-contain transition-opacity duration-300",onError:ve=>{console.error(":",se().src),console.error("URL:",ve.currentTarget.src);const ce=window.location.origin+"/decorations/capybara.jpeg";ve.currentTarget.src!==ce&&(ve.currentTarget.src=ce)},onLoad:()=>{console.log(":",se().src)}})}),V.jsxs("div",{className:"px-[2.2vh] py-[3vh]",children:[V.jsxs("div",{className:"text-center mb-[3vh]",children:[V.jsx("h1",{className:"wanderpaw-title text-4xl md:text-5xl font-bold text-[#687949] dark:text-amber-200 mb-[1.5vh]",children:"WanderPaw"}),V.jsx("p",{className:"text-[1.8vh] text-[#687949] dark:text-amber-300 font-medium",children:""})]}),V.jsxs("div",{className:"mx-auto max-w-2xl pt-[3vh] pb-[3vh] px-[4.4vh] mb-[3vh] relative z-10",style:{borderRadius:"3.5vh",background:"#FEFDF9",boxShadow:"0 0.2vh 3.2vh 0.3vh rgba(123, 66, 15, 0.11)"},children:[V.jsx("div",{className:"absolute -top-[8vh] -right-[8vh] z-20",children:V.jsx("img",{src:O8,alt:"Clip decoration",className:"w-[18vh] h-[18vh] object-contain transform rotate-12"})}),V.jsxs("div",{className:"text-center mb-[3vh]",children:[V.jsx("h2",{className:"mb-[1.5vh]",style:{color:"#687949",fontFamily:'"PingFang SC"',fontSize:"2.5vh",fontWeight:600,lineHeight:"normal"},children:""}),V.jsx("p",{style:{color:"#ADA89E",fontFamily:'"PingFang SC"',fontSize:"1.5vh",fontWeight:400,lineHeight:"normal"},children:""})]}),V.jsx("div",{className:"grid grid-cols-2 gap-[1.5vh]",children:kx.slice(0,4).map(ve=>{const ce=r===ve.id;return V.jsx("div",{onClick:()=>U(ve.id),className:"cursor-pointer transition-all duration-300 hover:scale-105 p-[1.5vh] h-[18vh] flex items-center justify-center",style:{borderRadius:"1vh",border:"0.2vh solid #E5E2DC",background:ce?"#F0F3EA":"transparent"},children:V.jsxs("div",{className:"text-center",children:[V.jsx("div",{className:"mb-[1.1vh] flex justify-center",children:ve.id==="photography"?V.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"4.5vh",height:"4.5vh",viewBox:"0 0 60 60",fill:"none",children:[V.jsx("path",{d:"M55.3379 31.9645C54.5099 31.9645 53.8379 31.2925 53.8379 30.4645V29.7715C53.8379 28.9435 54.5099 28.2715 55.3379 28.2715C56.1659 28.2715 56.8379 28.9435 56.8379 29.7715V30.4645C56.8379 31.2925 56.1659 31.9645 55.3379 31.9645Z",fill:"#687949"}),V.jsx("path",{d:"M46.3372 52.1736H13.7812C7.99125 52.1736 3.28125 47.1696 3.28125 41.0196V25.4976C3.28125 19.3476 7.99125 14.3436 13.7812 14.3436H15.4462C15.7372 14.3436 16.0132 14.2026 16.1842 13.9686L18.9292 10.2276C20.4442 8.08863 23.1892 7.51562 24.5782 7.51562H36.1342C37.6042 7.51562 40.4302 8.12762 41.7862 10.4136L44.2462 13.9206C44.4292 14.1906 44.7112 14.3406 45.0172 14.3406H46.3402C52.1302 14.3406 56.8402 19.3446 56.8402 25.4946C56.8402 26.3226 56.1682 26.9946 55.3402 26.9946C54.5122 26.9946 53.8402 26.3226 53.8402 25.4946C53.8402 20.9976 50.4772 17.3406 46.3402 17.3406H45.0172C43.7182 17.3406 42.5062 16.6986 41.7772 15.6246L39.2962 12.0876C39.2692 12.0486 39.2452 12.0126 39.2242 11.9736C38.5942 10.8756 36.8722 10.5186 36.1372 10.5186H24.5782C24.0112 10.5186 22.2082 10.7856 21.3742 11.9676C21.3682 11.9766 21.3622 11.9856 21.3562 11.9916L18.6022 15.7416C18.238 16.2365 17.7627 16.639 17.2146 16.9168C16.6664 17.1945 16.0607 17.3397 15.4462 17.3406H13.7812C9.64425 17.3406 6.28125 21.0006 6.28125 25.4946V41.0136C6.28125 45.5106 9.64425 49.1676 13.7812 49.1676H46.3342C50.4712 49.1676 53.8342 45.5076 53.8342 41.0136V34.6686C53.8342 33.8406 54.5062 33.1686 55.3342 33.1686C56.1622 33.1686 56.8342 33.8406 56.8342 34.6686V41.0136C56.8372 47.1696 52.1272 52.1736 46.3372 52.1736Z",fill:"#687949"}),V.jsx("path",{d:"M30.06 42.6544C24.486 42.6544 19.953 38.1184 19.953 32.5474C19.953 26.9764 24.486 22.4404 30.06 22.4404C35.634 22.4404 40.167 26.9764 40.167 32.5474C40.167 38.1184 35.634 42.6544 30.06 42.6544ZM30.06 25.4374C26.142 25.4374 22.953 28.6264 22.953 32.5444C22.953 36.4624 26.142 39.6514 30.06 39.6514C33.978 39.6514 37.167 36.4624 37.167 32.5444C37.167 28.6264 33.981 25.4374 30.06 25.4374ZM16.296 24.6094H11.625C10.797 24.6094 10.125 23.9374 10.125 23.1094C10.125 22.2814 10.797 21.6094 11.625 21.6094H16.296C17.124 21.6094 17.796 22.2814 17.796 23.1094C17.796 23.9374 17.124 24.6094 16.296 24.6094Z",fill:"#687949"})]}):ve.id==="nature"?V.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"4.5vh",height:"4.5vh",viewBox:"0 0 49 49",fill:"none",children:[V.jsxs("g",{clipPath:"url(#clip0_5036_10360)",children:[V.jsx("path",{d:"M24.5383 4.55547C24.1172 4.55547 23.7727 4.21094 23.7727 3.78984V0.957031C23.7727 0.535937 24.1172 0.191406 24.5383 0.191406C24.9594 0.191406 25.3039 0.535937 25.3039 0.957031V3.78984C25.3039 4.21094 24.9594 4.55547 24.5383 4.55547ZM28.6344 48.8086C25.9547 48.8086 23.7344 46.6266 23.7344 43.9086V26.95C23.7344 26.5289 24.0789 26.1844 24.5 26.1844C24.9211 26.1844 25.2656 26.5289 25.2656 26.95V43.9086C25.2656 45.7461 26.7586 47.2773 28.6344 47.2773C30.4719 47.2773 32.0031 45.7844 32.0031 43.9086C32.0031 43.4875 32.3477 43.143 32.7687 43.143C33.1898 43.143 33.5344 43.4875 33.5344 43.9086C33.5344 46.6266 31.3141 48.8086 28.6344 48.8086Z",fill:"#687949",stroke:"#687949"}),V.jsx("path",{d:"M12.7467 27.7157C12.5553 27.7157 12.3639 27.5625 12.3639 27.3711C12.3639 27.1797 11.4451 9.37895 24.3459 3.44535C24.5373 3.36879 24.767 3.44535 24.8436 3.63676C24.9201 3.82817 24.8436 4.05785 24.6522 4.13442C12.249 9.83832 13.1295 27.1414 13.1295 27.3329C13.1295 27.5243 12.9764 27.7157 12.7467 27.7157Z",fill:"#687949"}),V.jsx("path",{d:"M36.2145 27.7157C35.9848 27.7157 35.8316 27.5243 35.8316 27.2946C35.8316 27.1032 36.7121 9.83832 24.2707 4.13442C24.1176 4.05785 24.0027 3.82817 24.1176 3.63676C24.1941 3.44535 24.4238 3.36879 24.6152 3.44535C37.516 9.37895 36.6355 27.1797 36.5973 27.3711C36.5973 27.5625 36.4441 27.7157 36.2145 27.7157ZM12.748 27.7157C12.5566 27.7157 12.3652 27.5625 12.3652 27.3711V27.2946C12.3652 27.1032 12.5184 26.9118 12.748 26.9118C12.9395 26.9118 13.1309 27.0649 13.1309 27.2946V27.3711C13.1309 27.5625 12.9777 27.7157 12.748 27.7157Z",fill:"#687949"}),V.jsx("path",{d:"M24.4992 4.59297C24.3844 4.59297 24.2695 4.55469 24.193 4.51641C23.8867 4.36328 23.657 4.01875 23.7336 3.63594C23.8102 3.29141 24.1164 3.02344 24.4609 3.02344H24.5375C24.882 3.02344 25.1883 3.29141 25.3031 3.63594C25.3797 3.98047 25.1883 4.325 24.882 4.47812C24.882 4.47812 24.8437 4.47813 24.8437 4.51641C24.6906 4.55469 24.5758 4.59297 24.4992 4.59297Z",fill:"#687949"}),V.jsx("path",{d:"M24.501 4.59434C24.3861 4.59434 24.3096 4.55606 24.1947 4.51778H24.1564C23.8885 4.40294 23.6971 4.09669 23.7353 3.82872C23.7353 3.52247 23.8885 3.2545 24.1564 3.13965C24.3861 3.02481 24.6924 3.06309 24.9221 3.17794C25.1518 3.33106 25.3049 3.56075 25.3049 3.82872C25.3049 4.09669 25.1518 4.36465 24.9603 4.4795C24.8072 4.55606 24.6541 4.59434 24.501 4.59434Z",fill:"#687949"}),V.jsx("path",{d:"M24.5391 27.7162C24.3094 27.7162 24.1562 27.563 24.1562 27.3333V3.82866C24.1562 3.71382 24.2328 3.56069 24.3477 3.52241C24.4625 3.44585 24.6156 3.44585 24.7305 3.48413C36.2531 8.8435 36.7125 23.6966 36.6742 26.606C36.6742 26.7974 36.5211 26.9888 36.3297 26.9888C36.1383 26.9888 35.9469 26.8357 35.9469 26.6443C35.6023 23.888 33.2672 21.8208 30.4727 21.8208C27.4484 21.8208 24.9602 24.2708 24.9602 27.3333C24.9219 27.563 24.7305 27.7162 24.5391 27.7162ZM24.9219 4.44116V24.3474C25.9937 22.3951 28.0609 21.0935 30.4344 21.0935C32.693 21.0935 34.6836 22.2802 35.7937 24.1177C35.4109 19.0263 33.5352 8.8435 24.9219 4.44116Z",fill:"#687949",stroke:"#687949"}),V.jsx("path",{d:"M12.7469 27.7158C12.5172 27.7158 12.364 27.5627 12.364 27.333V27.2947C12.3258 26.5674 11.675 9.30254 24.3078 3.48379C24.4226 3.44551 24.5375 3.44551 24.614 3.48379H24.6523C24.7672 3.56035 24.882 3.6752 24.882 3.82832V27.333C24.882 27.5627 24.7289 27.7158 24.4992 27.7158C24.2695 27.7158 24.1164 27.5627 24.1164 27.333C24.1164 24.3088 21.6664 21.8205 18.6039 21.8205C15.5797 21.8205 13.0914 24.2705 13.0914 27.333C13.1297 27.5627 12.9765 27.7158 12.7469 27.7158ZM18.6422 21.0549C21.0156 21.0549 23.0828 22.3947 24.1547 24.3088V4.40254C15.3883 8.80488 13.5508 19.0643 13.2062 24.2322C14.2781 22.3564 16.307 21.0549 18.6422 21.0549Z",fill:"#687949",stroke:"#687949"}),V.jsx("path",{d:"M36.2899 28.0977C35.8689 28.0977 35.5243 27.7531 35.5243 27.332C35.5243 24.4992 33.2274 22.2023 30.3946 22.2023C27.5618 22.2023 25.2649 24.4992 25.2649 27.332C25.2649 27.7531 24.9204 28.0977 24.4993 28.0977C24.0782 28.0977 23.7337 27.7531 23.7337 27.332C23.7337 24.4992 21.4368 22.2023 18.604 22.2023C15.7712 22.2023 13.4743 24.4992 13.4743 27.332C13.4743 27.7531 13.1298 28.0977 12.7087 28.0977C12.2876 28.0977 11.9431 27.7531 11.9431 27.332C11.9431 24.4992 9.6462 22.2023 6.81339 22.2023C4.24854 22.2023 2.06651 24.1164 1.72198 26.643C1.6837 27.0641 1.30089 27.332 0.879793 27.2938C0.458699 27.2555 0.152449 26.9109 0.190731 26.4898C0.420418 20.1734 3.02354 14.2781 7.57901 9.87578C12.1345 5.47344 18.1446 3.02344 24.4993 3.02344C30.854 3.02344 36.8642 5.47344 41.4196 9.87578C45.9751 14.2781 48.5782 20.1734 48.8079 26.4898C48.8079 26.9109 48.5017 27.2555 48.1189 27.2938C47.6978 27.332 47.3532 27.0258 47.2767 26.643C46.9321 24.1164 44.7501 22.2023 42.1853 22.2023C39.3524 22.2023 37.0556 24.4992 37.0556 27.332C37.0556 27.7531 36.711 28.0977 36.2899 28.0977ZM6.81339 20.6711C9.37823 20.6711 11.5985 22.1258 12.7087 24.2312C13.8189 22.1258 16.0392 20.6711 18.604 20.6711C21.1689 20.6711 23.3892 22.1258 24.4993 24.2312C25.6095 22.1258 27.8298 20.6711 30.3946 20.6711C32.9595 20.6711 35.1798 22.1258 36.2899 24.2312C37.4001 22.1258 39.6204 20.6711 42.1853 20.6711C43.9462 20.6711 45.554 21.3602 46.779 22.5086C44.597 12.1727 35.486 4.55469 24.4993 4.55469C13.5126 4.55469 4.43995 12.1727 2.21964 22.5086C3.44464 21.3602 5.05245 20.6711 6.81339 20.6711Z",fill:"#687949",stroke:"#687949"})]}),V.jsx("defs",{children:V.jsx("clipPath",{id:"clip0_5036_10360",children:V.jsx("rect",{width:"49",height:"49",fill:"white"})})})]}):ve.id==="culture"?V.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"4.5vh",height:"2.7vh",viewBox:"0 0 81 48",fill:"none",children:[V.jsx("path",{d:"M23.9879 9.74194C24.1132 10.0075 24.2356 10.2791 24.352 10.5611C24.6295 11.2102 25.3771 11.5087 26.0202 11.2296C26.6634 10.9506 26.9678 10.1971 26.6858 9.54945C26.5529 9.23162 26.4127 8.92423 26.2739 8.62579C25.9695 7.98863 25.2115 7.72452 24.5773 8.0334C23.9431 8.33929 23.6805 9.10776 23.9879 9.74194Z",fill:"#687949"}),V.jsx("path",{d:"M39.1657 5.33488C39.1762 5.62884 39.1822 5.92727 39.1792 6.23168C39.1822 6.93748 39.7566 7.50451 40.455 7.49854C41.1578 7.49406 41.7293 6.91659 41.7263 6.21079C41.7278 5.86759 41.7189 5.53035 41.7054 5.20058C41.6741 4.49627 41.0787 3.9561 40.3744 3.99192C39.6716 4.02773 39.1299 4.63057 39.1657 5.33488Z",fill:"#687949"}),V.jsx("path",{d:"M26.372 15.6889C25.7573 14.2444 25.8334 12.8254 26.5481 12.5225C27.2584 12.2181 28.3357 13.1507 28.9461 14.5936L40.7731 42.4302C41.3863 43.8746 41.3102 45.2907 40.597 45.5936C39.8852 45.8965 38.8108 44.9684 38.1976 43.524L26.372 15.6889Z",fill:"#687949"}),V.jsx("path",{d:"M13.6361 16.7949C13.8136 17.0322 13.9897 17.2799 14.1583 17.5366C14.5627 18.126 15.3685 18.2737 15.949 17.8678C16.5339 17.4634 16.6831 16.6562 16.2787 16.0668C16.0832 15.7788 15.8818 15.5012 15.6863 15.2326C15.2566 14.6596 14.4523 14.5477 13.8838 14.979C13.3153 15.4117 13.2048 16.2249 13.6361 16.7949Z",fill:"#687949"}),V.jsx("path",{d:"M17.4327 21.9789C16.4046 20.7926 16.042 19.4213 16.6284 18.9125C17.2134 18.4051 18.522 18.9617 19.5486 20.1435L39.3543 42.9888C40.3809 44.1751 40.745 45.5464 40.1571 46.0537C39.5737 46.5596 38.2635 46.0105 37.2399 44.8212L17.4327 21.9789Z",fill:"#687949"}),V.jsx("path",{d:"M39.0767 11.3872C39.0841 9.77718 39.7228 8.476 40.4957 8.48048C41.2687 8.48346 41.885 9.79658 41.8775 11.4022L41.6969 42.3679C41.688 43.9749 41.0553 45.2761 40.2824 45.2716C39.5079 45.2687 38.8872 43.96 38.9006 42.3529L39.0767 11.3872Z",fill:"#687949"}),V.jsx("path",{d:"M53.3684 8.40031C53.2774 8.67934 53.1804 8.96137 53.073 9.24637C52.8327 9.9089 53.1744 10.6401 53.834 10.8743C54.495 11.1131 55.2337 10.7684 55.4724 10.1044C55.5933 9.78207 55.6992 9.46274 55.8022 9.14789C56.017 8.47492 55.6455 7.76315 54.971 7.55424C54.2981 7.34832 53.5803 7.72584 53.3684 8.40031Z",fill:"#687949"}),V.jsx("path",{d:"M50.803 13.9663C51.376 12.4339 52.4295 11.4088 53.1547 11.6803C53.8799 11.9519 53.9963 13.4187 53.4248 14.9482L42.3722 44.4665C41.7977 45.9989 40.7472 47.0211 40.0235 46.7495C39.2983 46.4779 39.176 45.0171 39.752 43.4846L50.803 13.9663Z",fill:"#687949"}),V.jsx("path",{d:"M65.1166 15.2409C64.9286 15.4662 64.7287 15.69 64.5242 15.9139C64.0512 16.4361 64.09 17.2419 64.6108 17.7104C65.1345 18.1805 65.9448 18.1417 66.4193 17.6164C66.6506 17.3658 66.8714 17.1106 67.0848 16.8584C67.5369 16.3168 67.4623 15.5169 66.9177 15.0678C66.3745 14.6201 65.5658 14.6992 65.1166 15.2409Z",fill:"#687949"}),V.jsx("path",{d:"M61.1385 20.0218C62.2158 18.8564 63.5528 18.3357 64.1228 18.8609C64.6928 19.3862 64.2705 20.759 63.1962 21.9214L42.4295 44.3712C41.3522 45.5381 40.0182 46.0574 39.4511 45.5321C38.8811 45.0069 39.2959 43.6356 40.3748 42.4717L61.1385 20.0218Z",fill:"#687949"}),V.jsx("path",{d:"M0.138672 23.0669C0.138672 23.0669 38.5548 -29.0191 80.4283 23.3459L77.9409 25.2425C77.9409 25.2425 45.2607 -25.0589 2.47542 24.6337L0.138672 23.0669Z",fill:"#687949"}),V.jsx("path",{d:"M27.6934 37.9674C27.6934 37.9674 39.8651 21.6191 52.9962 38.039L52.0293 38.5374C52.0293 38.5374 42.0168 23.647 28.4648 38.4076L27.6934 37.9674Z",fill:"#687949"}),V.jsx("path",{d:"M41.9184 46.7395C40.956 47.2842 39.8577 47.1633 39.4653 46.4709C39.0773 45.7815 39.5399 44.7788 40.5053 44.2342L77.9739 23.081C78.9349 22.5364 80.0346 22.6587 80.4256 23.3466C80.8136 24.0375 80.3495 25.0418 79.3855 25.5849L41.9184 46.7395Z",fill:"#687949"}),V.jsx("path",{d:"M38.6443 46.4607C39.6068 47.0053 40.705 46.883 41.0975 46.1906C41.4854 45.5012 41.0229 44.5 40.0589 43.9553L2.58731 22.8022C1.62635 22.2576 0.526614 22.3784 0.138648 23.0678C-0.252303 23.7587 0.211764 24.7629 1.17571 25.3061L38.6443 46.4607Z",fill:"#687949"})]}):ve.id==="random"?V.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"4.5vh",height:"4.5vh",viewBox:"0 0 59 59",fill:"none",children:V.jsx("path",{d:"M23.7182 51.0943L17.1397 36.0788L5.07422 29.5003L17.1397 22.9218L23.7182 7.90633L30.2967 22.9218L42.3622 29.5003L30.2967 36.0788L23.7182 51.0943ZM46.4922 21.0928L43.8667 15.1338L39.0877 12.5083L43.8667 9.88283L46.4922 3.92383L49.1177 9.88283L53.9262 12.5083L49.1177 15.1338L46.4922 21.0928ZM46.4922 55.0768L43.8667 49.1178L39.0877 46.4923L43.8667 43.8668L46.4922 37.9078L49.1177 43.8668L53.9262 46.4923L49.1177 49.1178L46.4922 55.0768Z",stroke:"#687949",strokeWidth:"3"})}):V.jsx("span",{style:{fontSize:"3.5vh"},children:ve.icon})}),V.jsx("h3",{className:"font-bold mb-[0.4vh]",style:{color:"#687949",fontSize:"3vh"},children:y==="zh"?ve.name:ve.nameEn}),V.jsx("p",{className:"text-gray-500 leading-tight",style:{fontSize:"1.4vh"},children:y==="zh"?ve.description:ve.descriptionEn})]})},ve.id)})}),V.jsx("div",{className:"text-center mt-[3vh]",children:V.jsx("button",{onClick:()=>{r?de(r):Dn.error(y==="zh"?"":"Please select a theme first")},disabled:G||!r,style:{...Vg(),opacity:G||!r?.6:1,cursor:G||!r?"not-allowed":"pointer",background:G||!r?"linear-gradient(to right, #9ca3af, #6b7280)":Vg().background},onMouseEnter:ve=>{!G&&r&&vf(ve,!0)},onMouseLeave:ve=>{!G&&r&&vf(ve,!1)},children:G?V.jsxs("div",{className:"flex items-center justify-center gap-2",children:[V.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),V.jsx("span",{children:y==="zh"?"...":"Generating..."})]}):y==="zh"?"":"Generate Plan"})})]})]})]}):V.jsx("div",{className:"min-h-screen flex items-center justify-center",children:V.jsxs("div",{className:"text-center",children:[V.jsx("div",{className:"animate-spin w-[3vh] h-[3vh] border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-[1.5vh]"}),V.jsx("p",{className:"text-gray-600 text-[1.4vh]",children:y==="zh"?"...":"Loading..."})]})})},l4={"CN-BJ":{center:[116.4074,39.9042],activities:[{id:"forbidden-city",theme:"culture",coordinates:[116.3974,39.9163],name:"",nameEn:"Forbidden City"},{id:"tiananmen",theme:"photography",coordinates:[116.3913,39.9054],name:"",nameEn:"Tiananmen Square"},{id:"temple-of-heaven",theme:"nature",coordinates:[116.4167,39.8828],name:"",nameEn:"Temple of Heaven"},{id:"wangfujing",theme:"shopping",coordinates:[116.4103,39.9097],name:"",nameEn:"Wangfujing Street"},{id:"beijing-roast-duck",theme:"food",coordinates:[116.3889,39.9288],name:"",nameEn:"Quanjude Roast Duck"}]},"CN-SH":{center:[121.4737,31.2304],activities:[{id:"the-bund",theme:"photography",coordinates:[121.49,31.2397],name:"",nameEn:"The Bund"},{id:"yu-garden",theme:"culture",coordinates:[121.492,31.228],name:"",nameEn:"Yu Garden"},{id:"peoples-park",theme:"nature",coordinates:[121.465,31.2275],name:"",nameEn:"People's Park"},{id:"nanjing-road",theme:"shopping",coordinates:[121.4758,31.2344],name:"",nameEn:"Nanjing Road"},{id:"xiaolongbao",theme:"food",coordinates:[121.4944,31.2267],name:"",nameEn:"Nanxiang Xiaolongbao"}]},"CN-GD":{center:[113.2644,23.1291],activities:[{id:"canton-tower",theme:"photography",coordinates:[113.3189,23.1059],name:"",nameEn:"Canton Tower"},{id:"chen-clan-academy",theme:"culture",coordinates:[113.2438,23.1267],name:"",nameEn:"Chen Clan Academy"},{id:"yuexiu-park",theme:"nature",coordinates:[113.2656,23.138],name:"",nameEn:"Yuexiu Park"},{id:"beijing-road",theme:"shopping",coordinates:[113.2661,23.129],name:"",nameEn:"Beijing Road"},{id:"dim-sum",theme:"food",coordinates:[113.259,23.1163],name:"",nameEn:"Dim Sum Restaurant"}]},"CN-SC":{center:[104.0668,30.5728],activities:[{id:"jinli-street",theme:"culture",coordinates:[104.0433,30.6471],name:"",nameEn:"Jinli Ancient Street"},{id:"tianfu-square",theme:"photography",coordinates:[104.0717,30.6598],name:"",nameEn:"Tianfu Square"},{id:"peoples-park-chengdu",theme:"nature",coordinates:[104.0589,30.671],name:"",nameEn:"People's Park"},{id:"chunxi-road",theme:"shopping",coordinates:[104.0813,30.6587],name:"",nameEn:"Chunxi Road"},{id:"hotpot",theme:"food",coordinates:[104.0776,30.6515],name:"",nameEn:"Hotpot Restaurant"}]},DK:{center:[12.5683,55.6761],activities:[{id:"little-mermaid",theme:"photography",coordinates:[12.5993,55.6928],name:"",nameEn:"The Little Mermaid"},{id:"nyhavn",theme:"culture",coordinates:[12.5913,55.6798],name:"",nameEn:"Nyhavn"},{id:"tivoli-gardens",theme:"nature",coordinates:[12.5681,55.6736],name:"",nameEn:"Tivoli Gardens"},{id:"stroget",theme:"shopping",coordinates:[12.5707,55.6783],name:"",nameEn:"Strget"},{id:"danish-pastry",theme:"food",coordinates:[12.5725,55.6805],name:"",nameEn:"Danish Pastry Shop"}]},US:{center:[-74.006,40.7128],activities:[{id:"statue-of-liberty",theme:"photography",coordinates:[-74.0445,40.6892],name:"",nameEn:"Statue of Liberty"},{id:"times-square",theme:"culture",coordinates:[-73.9857,40.758],name:"",nameEn:"Times Square"},{id:"central-park",theme:"nature",coordinates:[-73.9654,40.7829],name:"",nameEn:"Central Park"},{id:"fifth-avenue",theme:"shopping",coordinates:[-73.9776,40.7614],name:"",nameEn:"Fifth Avenue"},{id:"pizza-slice",theme:"food",coordinates:[-73.9969,40.7505],name:"",nameEn:"New York Pizza"}]},JP:{center:[139.6917,35.6895],activities:[{id:"tokyo-tower",theme:"photography",coordinates:[139.7454,35.6586],name:"",nameEn:"Tokyo Tower"},{id:"sensoji-temple",theme:"culture",coordinates:[139.7967,35.7148],name:"",nameEn:"Sensoji Temple"},{id:"ueno-park",theme:"nature",coordinates:[139.7744,35.7153],name:"",nameEn:"Ueno Park"},{id:"ginza",theme:"shopping",coordinates:[139.7671,35.6719],name:"",nameEn:"Ginza"},{id:"ramen-shop",theme:"food",coordinates:[139.7005,35.6762],name:"",nameEn:"Ramen Shop"}]}},$8=(u,p,y)=>{const b=l4[u];if(!b)throw new Error(`No activity data found for city: ${u}`);const C=b.activities.find(D=>D.theme===p);return C?C.coordinates:b.activities[y%b.activities.length].coordinates},t3=(u,p,y="zh")=>{const b=l4[u];if(!b)return[];const C=[];return p.forEach(M=>{b.activities.filter(r=>r.theme===M).forEach((r,U)=>{const Q=`${(9+C.length*2).toString().padStart(2,"0")}:00`;C.push({id:r.id,time:Q,title:y==="zh"?r.name:r.nameEn,titleEn:r.nameEn,location:y==="zh"?r.name:r.nameEn,locationEn:r.nameEn,theme:r.theme,duration:90+Math.random()*60,description:y==="zh"?`${r.name}`:`Explore ${r.nameEn} and experience local culture`,descriptionEn:`Explore ${r.nameEn} and experience local culture`})})}),C},uh=bf("currentTripPlan",null),fd=bf("tripProgress",{currentActivityIndex:0,completedActivities:[],totalActivities:0,elapsedTime:0,estimatedRemainingTime:0}),gm=bf("petTravelState",{mood:"happy",energy:100,experience:0,location:[116.4074,39.9042],isVisible:!0,lastMoodUpdate:new Date().toISOString(),dressUpItem:null}),i3=bf("tripHistory",[]),H8=yr(u=>{const p=u(uh),y=u(fd);return!p||!p.activities.length?null:p.activities[y.currentActivityIndex]||null});yr(u=>{const p=u(uh),y=u(fd);return p?p.activities.slice(y.currentActivityIndex+1):[]});yr(u=>{const p=u(fd);return p.totalActivities===0?0:Math.round(p.completedActivities.length/p.totalActivities*100)});const W8=yr(null,(u,p,y)=>{p(uh,{...y,status:"active",startDate:new Date().toISOString(),updatedAt:new Date().toISOString()}),p(fd,{currentActivityIndex:0,completedActivities:[],totalActivities:y.activities.length,startTime:new Date().toISOString(),elapsedTime:0,estimatedRemainingTime:y.activities.reduce((b,C)=>b+C.duration,0)}),p(gm,{mood:"excited",energy:100,experience:0,location:y.cityCoordinates,isVisible:!0,lastMoodUpdate:new Date().toISOString(),moodMessage:void 0})});yr(null,(u,p)=>{const y=u(uh),b=u(fd),C=u(gm);if(!y||b.currentActivityIndex>=y.activities.length)return;const M=y.activities[b.currentActivityIndex],D=y.activities.map((G,Q)=>Q===b.currentActivityIndex?{...G,status:"completed"}:G);p(uh,{...y,activities:D,updatedAt:new Date().toISOString()}),p(fd,{...b,currentActivityIndex:b.currentActivityIndex+1,completedActivities:[...b.completedActivities,M.id],elapsedTime:b.elapsedTime+M.duration});const r=C.experience+10,U=Math.max(0,C.energy-5);p(gm,{...C,experience:r,energy:U,location:M.coordinates,lastMoodUpdate:new Date().toISOString()})});yr(null,(u,p,y,b)=>{const C=u(gm);p(gm,{...C,mood:y,moodMessage:b,lastMoodUpdate:new Date().toISOString()})});const q8=yr(null,(u,p)=>{const y=u(uh),b=u(i3);if(!y)return;const C={...y,status:"completed",endDate:new Date().toISOString(),updatedAt:new Date().toISOString()};p(i3,[C,...b]),p(uh,C),p(fd,{currentActivityIndex:0,completedActivities:[],totalActivities:0,elapsedTime:0,estimatedRemainingTime:0})}),Z8=yr(null,(u,p)=>{p(uh,null),p(fd,{currentActivityIndex:0,completedActivities:[],totalActivities:0,elapsedTime:0,estimatedRemainingTime:0})}),X8=(u,p)=>{const y=[{id:"start",name:"",nameEn:"Trip Start",coordinates:p,type:"start",estimatedTime:"09:00"},...u.map((C,M)=>({id:C.id,name:C.location,nameEn:C.locationEn,coordinates:C.coordinates,type:"activity",activityId:C.id,estimatedTime:C.time,description:C.description})),{id:"end",name:"",nameEn:"Trip End",coordinates:p,type:"end",estimatedTime:"18:00"}];let b=0;for(let C=0;C<y.length-1;C++){const[M,D]=y[C].coordinates,[r,U]=y[C+1].coordinates,G=Math.sqrt(Math.pow(r-M,2)+Math.pow(U-D,2))*111;b+=G}return{id:`route_${Date.now()}`,waypoints:y,totalDistance:Math.round(b*100)/100,estimatedDuration:u.reduce((C,M)=>C+M.duration,0),transportModes:["walking","transit"],style:{color:"#10B981",weight:4,opacity:.8,pattern:"solid"}}},Y8=(u,p,y,b,C)=>{if(b&&C)try{return $8(b,C,p)}catch{console.log(`Using generated coordinates for city ${b} (no real data available)`)}const[M,D]=u,r=.05,U=p/y*2*Math.PI,G=.02+Math.random()*(r-.02),Q=M+G*Math.cos(U)+(Math.random()-.5)*.01,se=D+G*Math.sin(U)+(Math.random()-.5)*.01;return[Q,se]},K8=(u,p,y,b,C)=>{const M=b.map((r,U)=>({...r,coordinates:Y8(u.coordinates,U,b.length,u.id,r.theme),status:"pending"})),D=X8(M,u.coordinates);return{id:`trip_${Date.now()}`,cityId:u.id,cityName:u.name,cityNameEn:u.nameEn,cityCoordinates:u.coordinates,selectedThemes:p,selectedThemeNames:y,activities:M,route:D,petCompanion:C,startDate:"",endDate:"",status:"planning",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}},J8=({children:u,bottomElement:p,width:y,height:b,className:C="",style:M={}})=>{const D={width:y,height:b,borderRadius:"38px",background:"#FDF8F3",boxShadow:"0 2px 34.9px 3px rgba(123, 66, 15, 0.11)",position:"relative",...M},r={position:"absolute",top:"22px",left:"22px",right:"22px",bottom:"22px",borderRadius:"21px",border:"2px dashed #D1BA9E",pointerEvents:"none"},U={position:"relative",zIndex:1,padding:"22px",paddingBottom:p?"80px":"22px",width:"100%",height:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box"};return V.jsxs("div",{className:`dashed-card ${C}`,style:D,children:[V.jsx("div",{className:"dashed-border",style:r}),V.jsx("div",{className:"content",style:U,children:u}),p&&V.jsx("div",{className:"bottom-element",style:{position:"absolute",bottom:"22px",left:"22px",right:"22px",zIndex:2},children:p})]})},n3=(u,p)=>{const y={photography:[{id:"photo-1",time:"08:30",title:"",titleEn:"Morning Coffee Cafe Check-in",location:"",locationEn:"Old town coffee street",theme:"photography",duration:60,description:"",descriptionEn:"Capture warm coffee moments in morning light"},{id:"photo-2",time:"10:00",title:"",titleEn:"Street Art Graffiti Wall",location:"",locationEn:"Creative district",theme:"photography",duration:90,description:"",descriptionEn:"Photography at colorful graffiti walls"},{id:"photo-3",time:"14:00",title:"",titleEn:"Vintage Bookstore Shoot",location:"",locationEn:"Independent bookstore cafe corner",theme:"photography",duration:75,description:"",descriptionEn:"Capture literary moments among books"},{id:"photo-4",time:"16:30",title:"",titleEn:"Sunset Market Documentation",location:"",locationEn:"Traditional night market entrance",theme:"photography",duration:90,description:"",descriptionEn:"Document authentic beauty of local life"},{id:"photo-5",time:"18:30",title:"",titleEn:"City Skyline",location:"",locationEn:"Observation deck",theme:"photography",duration:60,description:"",descriptionEn:"Capture the most beautiful city skyline"}],food:[{id:"food-1",time:"09:00",title:"",titleEn:"Traditional Breakfast Experience",location:"",locationEn:"Local breakfast shop",theme:"food",duration:60,description:"",descriptionEn:"Taste the most authentic local breakfast"},{id:"food-2",time:"12:00",title:"",titleEn:"Specialty Restaurant Lunch",location:"",locationEn:"Old town food street",theme:"food",duration:90,description:"",descriptionEn:"Enjoy local signature dishes"},{id:"food-3",time:"15:30",title:"",titleEn:"Handmade Dessert Shop",location:"",locationEn:"Dessert workshop",theme:"food",duration:45,description:"",descriptionEn:"Taste exquisite handmade desserts"},{id:"food-4",time:"18:00",title:"",titleEn:"Street Food Exploration",location:"",locationEn:"Night market food area",theme:"food",duration:120,description:"",descriptionEn:"Deep experience of street food culture"},{id:"food-5",time:"20:30",title:"",titleEn:"Specialty Bar Drinks",location:"",locationEn:"Craft beer bar",theme:"food",duration:90,description:"",descriptionEn:"Taste local specialty beverages"}],culture:[{id:"culture-1",time:"09:30",title:"",titleEn:"History Museum Exploration",location:`${p}`,locationEn:`${p} History Museum`,theme:"culture",duration:150,description:"",descriptionEn:"Learn about local historical context"},{id:"culture-2",time:"13:00",title:"",titleEn:"Traditional Handicraft Experience",location:"",locationEn:"Handicraft experience center",theme:"culture",duration:120,description:"",descriptionEn:"Hands-on traditional craft making"},{id:"culture-3",time:"15:30",title:"",titleEn:"Historic Architecture Walk",location:"",locationEn:"Historic architecture district",theme:"culture",duration:90,description:"",descriptionEn:"Feel the charm of architectural art"},{id:"culture-4",time:"17:30",title:"",titleEn:"Local Folk Performance",location:"",locationEn:"Cultural square",theme:"culture",duration:75,description:"",descriptionEn:"Watch traditional folk performances"},{id:"culture-5",time:"19:30",title:"",titleEn:"Cultural Night Tour",location:"",locationEn:"Historic district",theme:"culture",duration:90,description:"",descriptionEn:"Historic district has unique charm at night"}],nature:[{id:"nature-1",time:"07:00",title:"",titleEn:"Sunrise Viewing",location:"",locationEn:"Sunrise viewing platform",theme:"nature",duration:90,description:"",descriptionEn:"Welcome the first ray of sunlight"},{id:"nature-2",time:"09:30",title:"",titleEn:"City Park Morning Exercise",location:"",locationEn:"Central Park",theme:"nature",duration:75,description:"",descriptionEn:"Start an energetic day in nature"},{id:"nature-3",time:"14:00",title:"",titleEn:"Botanical Garden Discovery",location:"",locationEn:"City botanical garden",theme:"nature",duration:120,description:"",descriptionEn:"Explore the rich plant world"},{id:"nature-4",time:"16:30",title:"",titleEn:"Lakeside Rest",location:"",locationEn:"Lakeside Park",theme:"nature",duration:90,description:"",descriptionEn:"Feel peaceful moments by the lake"},{id:"nature-5",time:"18:30",title:"",titleEn:"Sunset Viewing",location:"",locationEn:"Mountaintop viewing platform",theme:"nature",duration:60,description:"",descriptionEn:"Enjoy the most beautiful sunset views"}],nightlife:[{id:"night-1",time:"20:00",title:"",titleEn:"Night Market Exploration",location:"",locationEn:"Nightlife district",theme:"nightlife",duration:120,description:"",descriptionEn:"Feel the lively nighttime atmosphere"},{id:"night-2",time:"22:30",title:"",titleEn:"Music Bar Experience",location:"",locationEn:"Live music bar",theme:"nightlife",duration:90,description:"",descriptionEn:"Enjoy the charm of live music"}],shopping:[{id:"shop-1",time:"10:30",title:"",titleEn:"Local Specialty Market",location:"",locationEn:"Traditional market",theme:"shopping",duration:90,description:"",descriptionEn:"Find unique local specialties"},{id:"shop-2",time:"14:00",title:"",titleEn:"Shopping Mall Exploration",location:"",locationEn:"Downtown shopping district",theme:"shopping",duration:150,description:"",descriptionEn:"Buy favorite souvenirs"},{id:"shop-3",time:"17:00",title:"",titleEn:"Creative Market",location:"",locationEn:"Creative park",theme:"shopping",duration:90,description:"",descriptionEn:"Discover unique creative products"}],adventure:[{id:"adventure-1",time:"08:00",title:"",titleEn:"Outdoor Hiking Challenge",location:"",locationEn:"Nature trail",theme:"adventure",duration:180,description:"",descriptionEn:"Challenge physical limits, get close to nature"},{id:"adventure-2",time:"13:30",title:"",titleEn:"Water Sports Experience",location:"",locationEn:"Water sports center",theme:"adventure",duration:150,description:"",descriptionEn:"Experience thrilling water activities"},{id:"adventure-3",time:"16:30",title:"",titleEn:"Rock Climbing Experience",location:"",locationEn:"Climbing gym",theme:"adventure",duration:120,description:"",descriptionEn:"Challenge the courage of vertical heights"}],relaxation:[{id:"relax-1",time:"10:00",title:"",titleEn:"Hot Spring Wellness",location:"",locationEn:"Hot spring resort",theme:"relaxation",duration:150,description:"",descriptionEn:"Relax body and mind in hot springs"},{id:"relax-2",time:"14:30",title:"SPA",titleEn:"SPA Therapy Experience",location:"SPA",locationEn:"Premium SPA center",theme:"relaxation",duration:120,description:"",descriptionEn:"Enjoy professional therapy services"},{id:"relax-3",time:"17:30",title:"",titleEn:"Meditation Yoga",location:"",locationEn:"Yoga studio",theme:"relaxation",duration:90,description:"",descriptionEn:"Find inner peace through yoga"}]},b=[];if(u.forEach(C=>{y[C]&&b.push(...y[C])}),u.length===1&&b.length<6){const M=Object.keys(y).filter(D=>!u.includes(D)).sort(()=>Math.random()-.5);for(const D of M){if(b.length>=8)break;const r=y[D].slice(0,2);b.push(...r)}}return b.sort((C,M)=>C.time.localeCompare(M.time)).slice(0,8)},r3=()=>{var Ht,Nt,Li;const u=mc(),p=Ka(),[y]=Nn(pd),[b]=Nn(as),[C]=Nn(o1),[M,D]=Nn(uh),[,r]=Nn(W8),[U,G]=Fe.useState([]),[Q,se]=Fe.useState(null),[de,Pe]=Fe.useState(!1),[Se,ve]=Fe.useState(""),[ce,ze]=Fe.useState(""),[et,pt]=Fe.useState("list"),Tt=(Ht=p.state)==null?void 0:Ht.tripPlan,It=(Nt=p.state)==null?void 0:Nt.generatedPlan,di=(Li=p.state)==null?void 0:Li.isAiGenerated;Fe.useEffect(()=>{if(Tt){const Dt=a1[Tt.cityId];if(se(Dt),Pe(!0),di&&It){console.log("AI:",It),ve(y==="zh"?It.planTitle:It.planTitleEn),ze(y==="zh"?It.summary:It.summaryEn);const Ci=It.activities.map(yi=>({id:yi.id,time:yi.time,title:y==="zh"?yi.title:yi.titleEn,titleEn:yi.titleEn,location:y==="zh"?yi.location:yi.locationEn,locationEn:yi.locationEn,theme:yi.theme,duration:yi.duration,description:y==="zh"?yi.description:yi.descriptionEn,descriptionEn:yi.descriptionEn,tips:yi.tips||[]}));G(Ci),Dn.success(y==="zh"?` AI${(C==null?void 0:C.name)||""}`:` AI has customized an exclusive trip plan for you and ${(C==null?void 0:C.name)||"buddy"}!`,{duration:4e3})}else{const Ci=y==="zh"?Dt==null?void 0:Dt.name:Dt==null?void 0:Dt.nameEn,yi=n3(Tt.themes,Ci||"");if(yi.length>0)G(yi);else{const xi=t3(Tt.cityId,Tt.themes,y);G(xi)}ve(y==="zh"?`${Ci}`:`${Ci} Trip Plan`)}Pe(!1)}},[Tt,It,di,y,C==null?void 0:C.name]);const Bt=()=>{if(!Q||!U.length){Dn.error(y==="zh"?"":"Plan data incomplete");return}try{const Dt=K8(Q,Tt.themes,Tt.selectedThemeNames,U,C);D(Dt),r(Dt),Dn.success(y==="zh"?"":"Trip plan created!",{icon:"",duration:2e3}),u("/trip-journey")}catch(Dt){console.error("Failed to create trip plan:",Dt),Dn.error(y==="zh"?"":"Failed to create plan, please try again")}},Yt=async()=>{if(!(!Tt||!Q)){if(!b.accessToken){Dn.error(y==="zh"?"":"Please login first");return}if(!C||!C.name){Dn.error(y==="zh"?"":"Please set pet information first");return}Pe(!0);try{const Dt=Dn.loading(y==="zh"?"...":"Regenerating trip plan..."),Ci={cityName:y==="zh"?Q.name:Q.nameEn,cityNameEn:Q.nameEn||Q.name,themes:Tt.themes,themeNames:Tt.selectedThemeNames,duration:1,petInfo:C,language:y};console.log(":",Ci);const yi=await a4.generateTripPlan(Ci,b.accessToken);if(Dn.dismiss(Dt),yi.success&&yi.data){ve(y==="zh"?yi.data.planTitle:yi.data.planTitleEn),ze(y==="zh"?yi.data.summary:yi.data.summaryEn);const xi=yi.data.activities.map($t=>({id:$t.id,time:$t.time,title:y==="zh"?$t.title:$t.titleEn,titleEn:$t.titleEn,location:y==="zh"?$t.location:$t.locationEn,locationEn:$t.locationEn,theme:$t.theme,duration:$t.duration,description:y==="zh"?$t.description:$t.descriptionEn,descriptionEn:$t.descriptionEn,tips:$t.tips||[]}));G(xi),Dn.success(y==="zh"?` ${(C==null?void 0:C.name)||""}`:` A brand new trip plan has been customized for you and ${(C==null?void 0:C.name)||"buddy"}!`,{icon:"",duration:4e3})}else throw new Error(yi.error||"")}catch(Dt){console.error(":",Dt),Dn.error(y==="zh"?`${Dt.message}`:`Regeneration failed: ${Dt.message}`,{duration:5e3}),(Dt.message.includes("")||Dt.message.includes("connect"))&&(Dn(y==="zh"?"":"Switching to offline mode for plan regeneration",{icon:"",duration:3e3}),setTimeout(()=>{const Ci=y==="zh"?Q==null?void 0:Q.name:Q==null?void 0:Q.nameEn,yi=n3(Tt.themes,Ci||"");if(yi.length>0)G(yi);else{const xi=t3(Tt.cityId,Tt.themes,y);G(xi)}Dn.success(y==="zh"?"":"Plan regenerated!",{icon:"",duration:2e3})},500))}finally{Pe(!1)}}},vt=()=>{u(-1)},Jt=Dt=>{const[Ci]=Dt.split(":").map(Number);return Ci===0?"12AM":Ci===12?"12PM":Ci<12?`${Ci}AM`:`${Ci-12}PM`};return!Tt||!Q?V.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:V.jsxs("div",{style:{textAlign:"center"},children:[V.jsx("div",{style:{animation:"spin 1s linear infinite",width:"2vw",height:"2vw",border:"0.2vw solid #3b82f6",borderTop:"0.2vw solid transparent",borderRadius:"50%",margin:"0 auto 1vh auto"}}),V.jsx("p",{style:{color:"#6b7280"},children:y==="zh"?"...":"Generating plan..."})]})}):V.jsxs(Sp,{children:[V.jsxs("div",{onClick:vt,className:"absolute top-6 left-6 z-20 flex items-center gap-2 text-[#687949] bg-transparent p-2 rounded-lg cursor-pointer transform transition-transform duration-200 hover:scale-110",children:[V.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:V.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),V.jsx("span",{children:y==="zh"?"":"Back"})]}),V.jsx("div",{className:"fixed bottom-0 left-[3vh] z-0",children:V.jsx("img",{src:C.type==="cat"?"/decorations/cat.png":C.type==="dog"?"/decorations/fox.png":"/decorations/capybara.jpeg",alt:C.type==="cat"?"Cat decoration":C.type==="dog"?"Dog decoration":"Pet decoration",className:"w-[35vh] h-[35vh] object-contain transition-opacity duration-300"})}),V.jsx("style",{children:`
        .activities-scroll::-webkit-scrollbar {
          width: 0.3vw;
        }
        .activities-scroll::-webkit-scrollbar-track {
          background: #EADDC7;
          border-radius: 0.15vw;
        }
        .activities-scroll::-webkit-scrollbar-thumb {
          background: #597466;
          border-radius: 0.15vw;
        }
        .activities-scroll::-webkit-scrollbar-thumb:hover {
          background: #4a5f54;
        }
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `}),V.jsx("div",{style:{padding:"4vh 3vw",maxWidth:"40vw",margin:"0 auto",minHeight:"100vh"},children:V.jsxs("div",{style:{position:"relative"},children:[V.jsx("img",{src:"/src/assets/%E5%A4%B9%E5%AD%90.jpg",alt:"Clip decoration",style:{position:"absolute",top:"-4vh",right:"-2vw",width:"9vw",height:"9vw",objectFit:"contain",zIndex:20,transform:"rotate(15deg)",filter:"drop-shadow(0 0.2vh 0.4vh rgba(0,0,0,0.2))",background:"transparent"}}),V.jsxs(J8,{width:"100%",style:{minHeight:"80vh",position:"relative"},bottomElement:V.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"2vw",paddingTop:"2vh",marginBottom:"2vh"},children:[V.jsx("button",{onClick:Bt,disabled:de||!U.length,style:{padding:"1vh 4vw",background:!de&&U.length?"linear-gradient(to right, #687949, #687949)":"linear-gradient(to right, #9ca3af, #6b7280)",color:"white",borderRadius:"0.7vw",fontWeight:"bold",fontSize:"1.2vw",transition:"all 0.2s",boxShadow:"0 0.5vh 1vh rgba(0,0,0,0.3)",transform:!de&&U.length?"scale(1)":"none",cursor:!de&&U.length?"pointer":"not-allowed",border:"none"},onMouseEnter:Dt=>{!de&&U.length&&(Dt.currentTarget.style.background="linear-gradient(to right, #C7AA6C, #C7AA6C)",Dt.currentTarget.style.transform="scale(1.05)")},onMouseLeave:Dt=>{!de&&U.length&&(Dt.currentTarget.style.background="linear-gradient(to right, #687949, #687949)",Dt.currentTarget.style.transform="scale(1)")},children:y==="zh"?"":"Start Journey"}),V.jsx("button",{onClick:Yt,disabled:de,style:{padding:"0.5vh",transition:"all 0.2s",opacity:de?.5:1,cursor:de?"not-allowed":"pointer",border:"none",background:"transparent"},title:y==="zh"?"":"Regenerate plan",onMouseEnter:Dt=>{de||(Dt.currentTarget.style.transform="scale(1.1)")},onMouseLeave:Dt=>{de||(Dt.currentTarget.style.transform="scale(1)")},children:V.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.5vw",height:"1.5vw",viewBox:"0 0 48 48",fill:"none",style:{transition:"transform 0.2s"},children:V.jsx("path",{d:"M42 9.3V17.7C42 18.6 41.7 19.2 41.1 19.8C40.5 20.4 39.6 20.7 39 20.7H30.6C29.7 20.7 29.1 20.4 28.5 19.8C27.3 18.6 27.3 16.8 28.5 15.6C29.1 15 29.7 14.7 30.6 14.7H31.8C29.4 12.9 27 12 24.3 12C20.7 12 17.7 13.2 15.6 15.6C14.4 16.8 12.6 16.8 11.4 15.6C10.2 14.4 10.2 12.6 11.4 11.4C14.7 8.1 19.2 6 24.3 6C28.8 6 33 7.8 36 10.5V9.3C36 8.4 36.3 7.8 36.9 7.2C38.1 6 39.9 6 41.1 7.2C41.7 7.5 42 8.4 42 9.3ZM19.5 32.4C18.9 33 18 33.3 17.4 33.3H16.5C18.6 35.1 21 36 23.7 36C27 36 30 34.8 32.1 32.4C33.3 31.2 35.1 31.2 36.3 32.4C37.5 33.6 37.5 35.4 36.3 36.6C33.3 39.9 28.8 42 23.7 42C19.2 42 15 40.2 12 37.5V39C12 39.9 11.7 40.5 11.1 41.1C9.9 42.3 8.1 42.3 6.9 41.1C6.3 40.5 6 39.6 6 38.7V30.3C6 29.4 6.3 28.8 6.9 28.2C7.5 27.6 8.1 27.3 9 27.3H17.4C18.3 27.3 18.9 27.6 19.5 28.2C20.7 29.4 20.7 31.2 19.5 32.4Z",fill:"#C7AA6C"})})})]}),children:[V.jsx("div",{style:{marginTop:"2vh",textAlign:"center"},children:V.jsx("h2",{style:{fontSize:"1.5vw",fontWeight:"bold",color:"#573E23",marginBottom:"1vh"},children:Se||(y==="zh"?`${C.name||""}`:`${C.name||"Tonton-kun"}'s Exploration Plan`)})}),V.jsxs("div",{style:{marginTop:"3vh",marginLeft:"2px",marginRight:"2px",display:"flex",flexDirection:"column",height:"calc(80vh - 20vh)",minHeight:"40vh",position:"relative"},children:[V.jsx("div",{style:{flex:1,overflowY:"auto",paddingRight:"1vw"},className:"activities-scroll",children:de?V.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:V.jsxs("div",{style:{textAlign:"center"},children:[V.jsx("div",{style:{animation:"spin 1s linear infinite",width:"2vw",height:"2vw",border:"0.2vw solid #C7AA6C",borderTop:"0.2vw solid transparent",borderRadius:"50%",margin:"0 auto 2vh auto"}}),V.jsx("p",{style:{color:"#6b7280"},children:y==="zh"?"...":"Generating plan..."})]})}):V.jsx("div",{style:{height:"100%"},children:U.map((Dt,Ci)=>{const yi=Ci===U.length-1;return V.jsxs("div",{className:"flex items-start gap-2 mb-4",children:[V.jsxs("div",{className:"flex flex-col items-center ml-2",children:[V.jsxs("div",{className:"relative",children:[V.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.5vw",height:"1.5vw",viewBox:"0 0 41 41",fill:"none",children:V.jsx("path",{d:"M20.4216 0.600098C9.33294 0.600098 0.400391 9.53265 0.400391 20.6213C0.400391 31.71 9.33294 40.6426 20.4216 40.6426C31.5103 40.6426 40.4429 31.71 40.4429 20.6213C40.4429 9.53265 31.5103 0.600098 20.4216 0.600098ZM20.4216 37.5624C11.0271 37.5624 3.48058 30.0159 3.48058 20.6213C3.48058 11.2268 11.0271 3.68029 20.4216 3.68029C29.8162 3.68029 37.3627 11.2268 37.3627 20.6213C37.3627 30.0159 29.8162 37.5624 20.4216 37.5624Z",fill:"#687949",fillOpacity:"0.22"})}),V.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:V.jsx("div",{className:"w-[0.6vw] h-[0.6vw] bg-[#687949] rounded-full"})})]}),!yi&&V.jsx("div",{className:"w-[1px] h-[14vh] mt-2",style:{background:"#687949"}})]}),V.jsxs("div",{className:"flex-1",children:[V.jsx("div",{className:"flex items-center gap-2 mb-2",children:V.jsx("span",{className:"text-sm font-medium text-gray-700",children:Jt(Dt.time)})}),V.jsxs("div",{className:"relative p-3",style:{borderRadius:"0.8vw",background:"#FDF9EF",boxShadow:"0 1.8px 8px 2.7px rgba(123, 66, 15, 0.1)"},children:[V.jsxs("div",{className:"flex items-center gap-3 m-2 relative z-10",children:[V.jsx("div",{className:"w-[3.5vw] h-[3.5vw] bg-[#F4EDE0] rounded-full flex items-center flex-shrink-0 overflow-hidden",children:V.jsx("img",{src:C.type==="cat"?"/decorations/cat1.jpeg":C.type==="dog"?"/decorations/fox1.jpeg":C.type==="other"?"/decorations/capybara1.jpeg":"/decorations/fox1.jpeg",alt:C.type==="cat"?"Cat":C.type==="dog"?"Dog":C.type==="other"?"Capybara":"Pet",className:"w-[120%] h-[120%] object-cover transform -translate-x-2 scale-110"})}),V.jsx("div",{className:"flex-1 flex flex-col justify-center",children:V.jsx("div",{className:"text-s font-medium text-gray-800 leading-tight mb-1",children:y==="zh"?Dt.location:Dt.locationEn})})]}),V.jsx("div",{className:"w-[90%] h-px bg-[#BBA084] my-1 relative z-10 mx-auto"}),V.jsx("div",{className:"flex items-center justify-between relative z-10",children:V.jsx("div",{className:"ml-2 my-1 text-xs text-gray-700",children:y==="zh"?Dt.description:Dt.titleEn})})]})]})]},Dt.id)})})}),V.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,height:"6vh",background:"linear-gradient(to bottom, rgba(253, 248, 243, 0) 0%, rgba(253, 248, 243, 0.8) 50%, rgba(253, 248, 243, 1) 100%)",pointerEvents:"none",zIndex:10}})]})]})]})})]})},Dx=[{id:"hand_roast",name:"",nameEn:"Hand Roast",image:"/decorations/hand_roast.png",type:"accessory"},{id:"mountain",name:"",nameEn:"Mount Fuji",image:"/decorations/mountain.png",type:"background"},{id:"leaf_tag",name:"",nameEn:"Leaf Tag",image:"/decorations/leaf_tag.png",type:"accessory"},{id:"chinese_knot",name:"",nameEn:"Chinese Knot",image:"/decorations/chinese_knot.png",type:"accessory"},{id:"green_tea",name:"",nameEn:"Green Tea",image:"/decorations/green_tea.png",type:"accessory"},{id:"cat_dog_hug",name:"",nameEn:"Cat & Dog Hug",image:"/decorations/cat_dog_hug.png",type:"background"}],Q8=({isOpen:u,onClose:p,onSave:y,currentItem:b,petName:C})=>{const[M]=Nn(pd),[D,r]=Fe.useState(b||null),U=se=>{r(se)},G=()=>{y(D),p()},Q=()=>{p()};return V.jsx(Lg,{children:u&&V.jsx(eo.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",style:{background:"rgba(92, 90, 76, 0.15)",backdropFilter:"blur(9.399999618530273px)"},onClick:Q,children:V.jsxs(eo.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{duration:.3,ease:"easeOut"},className:"w-[80vw] max-w-2xl relative",style:{background:"#FEFDF9",borderRadius:"2vw",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.15)"},onClick:se=>se.stopPropagation(),children:[V.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8",children:V.jsx("div",{className:"w-full h-full",style:{background:"linear-gradient(45deg, #8FBC8F, #90EE90)",borderRadius:"50%",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"}})}),V.jsxs("div",{className:"p-8",children:[V.jsxs("div",{className:"text-center mb-6",children:[V.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:"#687949"},children:M==="zh"?`${C}`:`Add dressing up for [${C}]`}),V.jsx("p",{className:"text-sm",style:{color:"#A6A196"},children:M==="zh"?"":"The pet image in the returned photo will also change"})]}),V.jsxs("div",{className:"mb-8",children:[V.jsx("div",{className:"flex justify-center gap-4 mb-4",children:Dx.map(se=>V.jsxs(eo.div,{whileHover:{scale:1.05},whileTap:{scale:.95},className:`cursor-pointer p-2 rounded-lg transition-all duration-200 ${(D==null?void 0:D.id)===se.id?"ring-2 ring-[#687949] ring-offset-2":"hover:bg-gray-50"}`,onClick:()=>U(se),children:[V.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden border border-gray-200",children:V.jsx("img",{src:se.image,alt:M==="zh"?se.name:se.nameEn,className:"w-full h-full object-cover"})}),V.jsx("p",{className:"text-xs text-center mt-2",style:{color:"#687949"},children:M==="zh"?se.name:se.nameEn})]},se.id))}),V.jsx("div",{className:"flex justify-center",children:V.jsx("div",{className:"w-full max-w-xs h-2 bg-gray-200 rounded-full overflow-hidden",children:V.jsx(eo.div,{className:"h-full",style:{background:"#687949"},initial:{width:0},animate:{width:D?`${(Dx.findIndex(se=>se.id===D.id)+1)/Dx.length*100}%`:"0%"},transition:{duration:.3}})})})]}),V.jsxs("div",{className:"flex justify-center gap-4",children:[V.jsx("button",{onClick:Q,className:"px-6 py-3 rounded-lg font-medium transition-all hover:scale-105",style:{background:"#F5F5DC",color:"#687949"},children:M==="zh"?"":"Cancel"}),V.jsx("button",{onClick:G,className:"px-6 py-3 rounded-lg font-medium text-white transition-all hover:scale-105",style:{background:"#687949"},children:M==="zh"?"":"Save Dressing Up"})]})]})]})})})},s3=()=>{var Ei,Kt;const u=mc(),[p]=Nn(pd),[y,b]=Fe.useState("12:45"),[C,M]=Fe.useState(!1),[D,r]=Fe.useState(!1),[U,G]=Fe.useState("hidden"),[Q,se]=Fe.useState(!1),[de,Pe]=Fe.useState(!1),[Se,ve]=Fe.useState(!1),[ce]=Nn(uh),[ze]=Nn(fd),[et,pt]=Nn(gm),[Tt]=Nn(H8),[,It]=Nn(q8),[,di]=Nn(Z8);Fe.useEffect(()=>{const Ue=setInterval(()=>{b(new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}))},1e3);return()=>clearInterval(Ue)},[]),Fe.useEffect(()=>{if(!ce){console.log("TripJourneyView: No current trip plan, redirecting to home"),u("/home");return}console.log("TripJourneyView: Current trip plan:",ce),console.log("TripJourneyView: Trip progress:",ze),console.log("TripJourneyView: Pet travel state:",et)},[ce,u]),Fe.useEffect(()=>{if(ce&&(ze.currentActivityIndex>=ce.activities.length||ce.status==="completed")){const Ue=setTimeout(()=>{Bt()},1e3);return()=>clearTimeout(Ue)}},[ce,ze.currentActivityIndex]);const Bt=()=>{G("appearing"),setTimeout(()=>{G("disappearing")},1500),setTimeout(()=>{G("reappearing")},2500),setTimeout(()=>{G("final")},3500)},Yt=()=>{!$t&&U==="hidden"&&!de&&(Pe(!0),setTimeout(()=>{It(),Pe(!1),Dn.success(p==="zh"?"":"Trip completed!",{icon:"",duration:2e3}),setTimeout(()=>{Bt()},500)},1500))};Fe.useEffect(()=>{ce&&(console.log("TripJourneyView: Map center coordinates:",[ce.cityCoordinates[1],ce.cityCoordinates[0]]),console.log("TripJourneyView: Route waypoints:",ce.route.waypoints))},[ce]);const vt=()=>{r(!0),setTimeout(()=>{u("/travel-journal",{state:{tripPlan:ce,currentActivity:Tt}})},800)},Jt=()=>{M(!0)},Ht=()=>{M(!1)},Nt=()=>{ve(!0)},Li=Ue=>{pt(zt=>({...zt,dressUpItem:Ue})),Ue?Dn.success(p==="zh"?`${ce==null?void 0:ce.petCompanion.name}${Ue.name}`:`Added ${Ue.nameEn} dressing up for ${ce==null?void 0:ce.petCompanion.name}`):Dn.success(p==="zh"?`${ce==null?void 0:ce.petCompanion.name}`:`Removed dressing up for ${ce==null?void 0:ce.petCompanion.name}`)},Dt=()=>{if(!ce)return;const Ue={cityId:ce.cityId,themes:ce.selectedThemes,selectedThemeNames:ce.selectedThemeNames};u("/trip-plan",{state:{tripPlan:Ue}})},Ci=Ue=>{const[zt]=Ue.split(":").map(Number);return zt===0?"12AM":zt===12?"12PM":zt<12?`${zt}AM`:`${zt-12}PM`};if(!ce)return V.jsx("div",{className:"min-h-screen flex items-center justify-center",children:V.jsxs("div",{className:"text-center",children:[V.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto mb-4"}),V.jsx("p",{className:"text-gray-600",children:p==="zh"?"...":"Loading..."})]})});const yi=ce.route.waypoints.map(Ue=>({id:Ue.id,position:[Ue.coordinates[1],Ue.coordinates[0]],title:p==="zh"?Ue.name:Ue.nameEn,description:Ue.description||"",petFriendlyIndex:Ue.type==="start"?90:Ue.type==="end"?85:75,data:{averageSalary:8e3,rentPrice:3e3,currency:"CNY",workLifeBalance:"",costOfLiving:70,qualityOfLife:80}})),xi=[{id:ce.route.id,name:p==="zh"?"":"Travel Route",description:p==="zh"?"":"Today's exploration route",waypoints:ce.route.waypoints.map(Ue=>({position:[Ue.coordinates[1],Ue.coordinates[0]],name:p==="zh"?Ue.name:Ue.nameEn})),style:{color:ce.route.style.color,weight:ce.route.style.weight,opacity:ce.route.style.opacity},travelMode:"walking",curveStyle:{enabled:!0,intensity:.3}}],$t=ce&&(ze.currentActivityIndex>=ce.activities.length||ce.status==="completed");return V.jsxs("div",{className:"relative",children:[V.jsx("style",{children:`
          .activities-scroll::-webkit-scrollbar {
            width: 0.3vw;
          }
          .activities-scroll::-webkit-scrollbar-track {
            background: #EADDC7;
            border-radius: 0.15vw;
          }
          .activities-scroll::-webkit-scrollbar-thumb {
            background: #597466;
            border-radius: 0.15vw;
          }
          .activities-scroll::-webkit-scrollbar-thumb:hover {
            background: #4a5f54;
          }
        `}),V.jsx("div",{className:"fixed inset-0 w-full h-full z-0",children:V.jsx(i4,{className:"w-full h-full",center:[ce.cityCoordinates[1],ce.cityCoordinates[0]],zoom:12,maxZoom:16,disableZoom:!1,disableInteraction:!1,points:yi,routes:xi})}),V.jsxs("div",{className:"fixed bottom-[-80vh] left-1/2 transform -translate-x-1/2 z-5 w-[50vw] h-[50vw]",children:[V.jsx("img",{src:"/decorations/earth.jpeg",alt:p==="zh"?"":"Earth decoration",className:"w-full h-full object-contain drop-shadow-lg pointer-events-none",style:{animation:"earthRotate 60s linear infinite"}}),V.jsxs("div",{className:`absolute top-[-15%] left-1/2 transform -translate-x-1/2 animate-pulse cursor-pointer ${ce.petCompanion.type==="cat"||ce.petCompanion.type==="dog"?"w-[12vw] h-[12vw]":"w-[15vw] h-[15vw]"}`,style:{animation:"petSwing 4s ease-in-out infinite"},onClick:Nt,title:p==="zh"?"":"Click to dress up your pet",children:[V.jsx("img",{src:ce.petCompanion.type==="cat"?"/decorations/cat.png":ce.petCompanion.type==="dog"?"/decorations/fox.png":"/decorations/capybara.jpeg",alt:p==="zh"?ce.petCompanion.type==="cat"?"":ce.petCompanion.type==="dog"?"":"":ce.petCompanion.type==="cat"?"Cat":ce.petCompanion.type==="dog"?"Dog":"Capybara",className:"w-full h-full object-contain drop-shadow-md"}),et.dressUpItem&&V.jsx(eo.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},className:"absolute -top-6 -right-6 w-12 h-12",children:V.jsx("img",{src:et.dressUpItem.image,alt:p==="zh"?et.dressUpItem.name:et.dressUpItem.nameEn,className:"w-full h-full object-contain drop-shadow-md"})})]})]}),V.jsx("style",{children:`
        @keyframes earthRotate {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        
        @keyframes petSwing {
          0%, 100% { transform: translate(-50%, 0) rotate(-3deg); }
          50% { transform: translate(-50%, 0) rotate(3deg); }
        }
      `}),V.jsxs("div",{className:"relative z-10",children:[V.jsxs("div",{onClick:()=>u(-1),className:"absolute top-6 left-6 z-20 flex items-center gap-2 text-[#687949] bg-transparent p-2 rounded-lg cursor-pointer transform transition-transform duration-200 hover:scale-110",children:[V.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:V.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),V.jsx("span",{children:p==="zh"?"":"Back"})]}),V.jsx("div",{className:"absolute top-6 left-1/2 transform -translate-x-1/2 z-20",children:V.jsxs("div",{className:`backdrop-blur-sm p-5 w-[47vw] transition-all duration-300 ${!$t&&U==="hidden"&&!de?"cursor-pointer hover:scale-105 hover:shadow-lg":"cursor-default"}`,style:{borderRadius:"1.5vw",background:"#FEFDF9",boxShadow:$t||de?"0 2px 34.9px 3px rgba(123, 66, 15, 0.05)":"0 2px 34.9px 3px rgba(123, 66, 15, 0.11)",opacity:$t||de?.8:1},onClick:Yt,title:!$t&&U==="hidden"&&!de?p==="zh"?"":"Click to end trip":"",children:[V.jsxs("div",{className:"flex items-start justify-between mb-1",children:[V.jsxs("div",{className:"flex items-start gap-4",children:[V.jsx("div",{className:`flex items-center justify-center overflow-hidden ${ce.petCompanion.type==="cat"||ce.petCompanion.type==="dog"?"w-[7vw] h-[5.5vw]":"w-[8vw] h-[6vw]"}`,children:V.jsx("img",{src:ce.petCompanion.type==="cat"?"/decorations/cat.png":ce.petCompanion.type==="dog"?"/decorations/fox.png":ce.petCompanion.type==="other"?"/decorations/capybara.jpeg":"/decorations/fox.png",alt:ce.petCompanion.type==="cat"?"Cat":ce.petCompanion.type==="dog"?"Dog":ce.petCompanion.type==="other"?"Capybara":"Pet",className:`w-full h-full ${ce.petCompanion.type==="cat"||ce.petCompanion.type==="dog"?"object-contain":"object-cover"}`})}),V.jsxs("div",{className:"flex flex-col",children:[V.jsx("h2",{style:{color:"#687949",fontFamily:"PingFang SC",fontSize:"1.6vw",fontStyle:"normal",fontWeight:600,lineHeight:"normal"},children:ce.petCompanion.name||(p==="zh"?"":"Pig-kun")}),Tt&&V.jsx("p",{style:{color:"#B1C192",fontFamily:"PingFang SC",fontSize:"0.9vw",fontStyle:"normal",fontWeight:400,lineHeight:"normal",margin:"8px 0"},children:p==="zh"?Tt.title:Tt.titleEn})]})]}),V.jsxs("div",{className:"flex flex-col items-end",children:[V.jsx("div",{style:{color:"#687949",fontFamily:"PingFang SC",fontSize:"2.3vw",fontStyle:"normal",fontWeight:600,lineHeight:"normal"},children:y}),V.jsx("div",{style:{borderRadius:"4vw",background:"#F3E2B6",padding:"2px 10px",marginTop:"1px",marginBottom:"1px"},children:V.jsx("span",{className:"text-s font-medium text-gray-700",children:ce.cityName})})]})]}),V.jsxs("div",{className:"flex items-center gap-2",children:[V.jsx("div",{className:"flex top-[2vh] gap-2",children:V.jsx("span",{className:"text-s text-gray-600",children:ze.currentActivityIndex<ce.activities.length?p==="zh"?"":"In Progress":p==="zh"?"":"Trip Completed"})}),V.jsx("div",{className:"flex-1 relative",style:{minWidth:"20vw",marginLeft:"1vw"},children:V.jsxs("div",{className:"flex items-center justify-between relative",children:[V.jsx("div",{className:"rounded-full absolute top-[7px] left-[10px] right-[10px] h-2",style:{backgroundColor:"#E5E5E5"}}),V.jsx("div",{className:"rounded-full absolute top-[7px] left-[10px] h-2 transition-all duration-500",style:{width:`${(ze.currentActivityIndex+1)/ze.totalActivities*120}%`,backgroundColor:"#597466"}}),ce.activities.map((Ue,zt)=>V.jsxs("div",{className:"flex flex-col items-center relative z-10",children:[V.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",className:"w-[20px] h-[20px]",children:[V.jsx("circle",{cx:"10",cy:"10",r:"10",fill:zt<=ze.currentActivityIndex?"#B1C192":"#E5E5E5"}),V.jsx("circle",{cx:"10",cy:"10",r:"5",fill:zt<=ze.currentActivityIndex?"#597466":"#D1D5DB"})]}),V.jsx("span",{className:"mt-1",style:{color:"#687949",fontFamily:"PingFang SC",fontSize:"14px",fontWeight:400},children:Ci(Ue.time)})]},Ue.id))]})})]})]})}),V.jsxs("div",{className:"absolute top-[32vh] left-8 w-[23vw] backdrop-blur-sm p-4 z-20 h-[60vh]",style:{borderRadius:"1vw",border:"2px dashed #D1BA9E",background:"#FEFDF9",boxShadow:"0 1.8px 6.48px 2.7px rgba(194, 100, 18, 0.12)",position:"relative"},children:[V.jsx("img",{src:"/src/assets/%E5%A4%B9%E5%AD%90.jpg",alt:"Clip decoration",style:{position:"absolute",top:"-6vh",right:"-3vw",width:"7vw",height:"7vw",objectFit:"contain",zIndex:30,transform:"rotate(15deg)",filter:"drop-shadow(0 0.2vh 0.4vh rgba(0,0,0,0.2))"}}),V.jsx("h3",{className:"text-lg font-bold mb-4 text-center",style:{color:"rgb(87, 62, 35)"},children:p==="zh"?`${ce.petCompanion.name||""}`:`${ce.petCompanion.name||"Pet"}'s Exploration Plan`}),V.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"calc(60vh - 200px)",minHeight:"75%",position:"relative"},children:[V.jsxs("div",{style:{flex:1,overflowY:"auto",paddingRight:"0.5vw",paddingBottom:"1vh",position:"relative"},className:"activities-scroll",children:[ce.activities.map((Ue,zt)=>{const un=zt<ze.currentActivityIndex,ln=zt===ze.currentActivityIndex,Di=zt===ce.activities.length-1;return V.jsxs("div",{className:"flex items-start gap-2 mb-4",children:[V.jsxs("div",{className:"flex flex-col items-center",children:[V.jsxs("div",{className:"relative",children:[V.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"2vw",height:"2vw",viewBox:"0 0 41 41",fill:"none",children:V.jsx("path",{d:"M20.4216 0.600098C9.33294 0.600098 0.400391 9.53265 0.400391 20.6213C0.400391 31.71 9.33294 40.6426 20.4216 40.6426C31.5103 40.6426 40.4429 31.71 40.4429 20.6213C40.4429 9.53265 31.5103 0.600098 20.4216 0.600098ZM20.4216 37.5624C11.0271 37.5624 3.48058 30.0159 3.48058 20.6213C3.48058 11.2268 11.0271 3.68029 20.4216 3.68029C29.8162 3.68029 37.3627 11.2268 37.3627 20.6213C37.3627 30.0159 29.8162 37.5624 20.4216 37.5624Z",fill:"#687949","fill-opacity":"0.22"})}),(un||ln)&&V.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:V.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.5vw",height:"1.5vw",viewBox:"0 0 30 29",fill:"none",children:[V.jsx("g",{clipPath:"url(#clip0_5036_8885)",children:V.jsx("path",{d:"M28.8664 1.97266C20.1112 7.34386 13.7608 14.1263 10.8952 17.5247L3.89678 12.0383L0.800781 14.5295L12.8824 26.8271C14.956 21.4991 21.5512 11.0879 29.6008 3.68626L28.8664 1.97266Z",fill:"#687949"})}),V.jsx("defs",{children:V.jsx("clipPath",{id:"clip0_5036_8885",children:V.jsx("rect",{width:"28.8",height:"28.8",fill:"white",transform:"translate(0.800781)"})})})]})})]}),!Di&&V.jsx("div",{className:"w-[1px] h-[14vh] mt-2",style:{background:"#687949"}})]}),V.jsxs("div",{className:"flex-1",children:[V.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[V.jsx("span",{className:"text-sm font-medium text-gray-700",children:Ci(Ue.time)}),ln&&V.jsx("span",{className:"text-xs text-white px-2 py-1",style:{borderRadius:"38px",background:"#687949"},children:p==="zh"?"":"In Progress"}),un&&V.jsx("span",{className:"text-xs text-white px-2 py-1",style:{borderRadius:"38px",background:"#687949"},children:p==="zh"?"":"Completed"})]}),V.jsxs("div",{className:"relative p-3",style:{borderRadius:"0.8vw",background:ln?"#FDF5E8":"#FDF9EF",boxShadow:"0 1.8px 8px 2.7px rgba(123, 66, 15, 0.1)"},children:[ln&&V.jsx("div",{className:"absolute",style:{top:"10px",left:"10px",right:"10px",bottom:"10px",border:"2px dashed #D1BA9E",borderRadius:"0.6vw",pointerEvents:"none"}}),V.jsxs("div",{className:"flex items-start gap-3 m-2 relative z-10",children:[V.jsx("div",{className:"w-[3.5vw] h-[3.5vw] bg-[#F4EDE0] rounded-full flex items-center flex-shrink-0 overflow-hidden",children:V.jsx("img",{src:ce.petCompanion.type==="cat"?"/decorations/cat1.jpeg":ce.petCompanion.type==="dog"?"/decorations/fox1.jpeg":ce.petCompanion.type==="other"?"/decorations/capybara1.jpeg":"/decorations/fox1.jpeg",alt:ce.petCompanion.type==="cat"?"Cat":ce.petCompanion.type==="dog"?"Dog":ce.petCompanion.type==="other"?"Capybara":"Pet",className:"w-[120%] h-[120%] object-cover transform -translate-x-2 scale-110"})}),V.jsxs("div",{className:"flex-1 flex flex-col justify-center",children:[V.jsx("div",{className:"text-s font-medium text-gray-800 leading-tight mb-1",children:p==="zh"?Ue.location:Ue.locationEn}),V.jsx("div",{className:"text-xs text-gray-600 leading-tight",children:ln?et.moodMessage||(p==="zh"?"":"Feeling good~"):un?p==="zh"?"":"Completed~":p==="zh"?"":"Looking forward~"})]})]}),V.jsx("div",{className:"w-[90%] h-px bg-[#BBA084] my-1 relative z-10 mx-auto"}),V.jsx("div",{className:"flex items-center justify-between relative z-10",children:V.jsx("div",{className:"ml-2 my-1 text-xs text-gray-700",children:p==="zh"?Ue.title:Ue.titleEn})})]})]})]},Ue.id)}),$t&&V.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[V.jsx("div",{className:"flex flex-col items-center",children:V.jsxs("div",{className:"relative",children:[V.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"3vw",height:"3vw",viewBox:"0 0 41 41",fill:"none",children:V.jsx("path",{d:"M20.4216 0.600098C9.33294 0.600098 0.400391 9.53265 0.400391 20.6213C0.400391 31.71 9.33294 40.6426 20.4216 40.6426C31.5103 40.6426 40.4429 31.71 40.4429 20.6213C40.4429 9.53265 31.5103 0.600098 20.4216 0.600098ZM20.4216 37.5624C11.0271 37.5624 3.48058 30.0159 3.48058 20.6213C3.48058 11.2268 11.0271 3.68029 20.4216 3.68029C29.8162 3.68029 37.3627 11.2268 37.3627 20.6213C37.3627 30.0159 29.8162 37.5624 20.4216 37.5624Z",fill:"#687949","fill-opacity":"0.8"})}),V.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:V.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"2vw",height:"2vw",viewBox:"0 0 30 29",fill:"none",children:[V.jsx("g",{clipPath:"url(#clip0_5036_8885)",children:V.jsx("path",{d:"M28.8664 1.97266C20.1112 7.34386 13.7608 14.1263 10.8952 17.5247L3.89678 12.0383L0.800781 14.5295L12.8824 26.8271C14.956 21.4991 21.5512 11.0879 29.6008 3.68626L28.8664 1.97266Z",fill:"#687949"})}),V.jsx("defs",{children:V.jsx("clipPath",{id:"clip0_5036_8885",children:V.jsx("rect",{width:"28.8",height:"28.8",fill:"white",transform:"translate(0.800781)"})})})]})})]})}),V.jsxs("div",{className:"flex-1",children:[V.jsx("div",{className:"flex items-center gap-2 mb-2",children:V.jsx("span",{className:"text-xs text-white px-2 py-1",style:{borderRadius:"38px",background:"#687949"},children:p==="zh"?"":"All Completed"})}),V.jsx("div",{className:"p-3",style:{borderRadius:"0.8vw",background:"#FDF9EF",boxShadow:"0 1.8px 8px 2.7px rgba(123, 66, 15, 0.1)"},children:V.jsxs("div",{className:"text-center",children:[V.jsx("h4",{className:"font-bold text-sm text-gray-700",children:p==="zh"?"":"Congratulations! All activities completed"}),V.jsx("p",{className:"text-xs text-gray-500 mt-1",children:p==="zh"?"":"What a fulfilling day~"})]})})]})]})]}),V.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:"0.5vw",height:"4vh",background:"linear-gradient(to bottom, rgba(254, 253, 249, 0) 0%, rgba(254, 253, 249, 0.8) 50%, rgba(254, 253, 249, 1) 100%)",pointerEvents:"none",zIndex:10}})]}),V.jsxs("div",{className:"mt-4 flex justify-center",children:[!$t&&!de&&V.jsx("button",{onClick:Dt,style:Vg(),onMouseEnter:Ue=>vf(Ue,!0),onMouseLeave:Ue=>vf(Ue,!1),children:V.jsxs("span",{className:"flex items-center justify-center gap-2",children:[V.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.2vw",height:"1.2vw",viewBox:"0 0 31 32",fill:"none",children:V.jsx("path",{d:"M11.7993 22.7033C11.6848 22.8178 11.5431 22.9014 11.3874 22.9461L4.44681 24.9423C4.08559 25.0462 3.75126 24.7118 3.85516 24.3506L5.85128 17.41C5.89604 17.2544 5.97959 17.1127 6.0941 16.9982L20.2248 2.86746C20.5982 2.49405 21.2037 2.49405 21.5771 2.86746L25.9299 7.22037C26.3034 7.59379 26.3034 8.19928 25.9299 8.57272L11.7993 22.7033ZM19.2105 7.2626L21.5348 9.58694L23.2253 7.8965L20.9009 5.57216L19.2105 7.2626ZM17.6891 8.78396L8.04641 18.4267L7.10806 21.6894L10.3707 20.751L20.0135 11.1083L17.6891 8.78396ZM3.95608 27.2658H26.9061V29.4173H3.95608V27.2658Z",fill:"white"})}),V.jsx("span",{children:p==="zh"?"":"Adjust Plan"})]})}),$t&&V.jsx("button",{style:Vg(),onMouseEnter:Ue=>vf(Ue,!0),onMouseLeave:Ue=>vf(Ue,!1),onClick:()=>{di(),u("/home")},children:V.jsxs("span",{className:"flex items-center justify-center gap-2",children:[V.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:V.jsx("path",{d:"M3 12L5 10M5 10L3 8M5 10H13M13 12V18C13 18.5304 13.2107 19.0391 13.5858 19.4142C13.9609 19.7893 14.4696 20 15 20H19C19.5304 20 20.0391 19.7893 20.4142 19.4142C20.7893 19.0391 21 18.5304 21 18V6C21 5.46957 20.7893 4.96086 20.4142 4.58579C20.0391 4.21071 19.5304 4 19 4H15C14.4696 4 13.9609 4.21071 13.5858 4.58579C13.2107 4.96086 13 5.46957 13 6V12Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),V.jsx("span",{children:p==="zh"?"":"Start New Journey!"})]})})]})]}),V.jsx(Lg,{children:U!=="hidden"&&V.jsx(eo.div,{initial:{left:"50%",top:"50%",scale:0,opacity:0,x:"-50%",y:"-50%"},animate:U==="appearing"?{left:"50%",top:"50%",scale:1.2,opacity:1,x:"-50%",y:"-50%",transition:{duration:1.5,ease:"easeOut"}}:U==="disappearing"?{left:"50%",top:"50%",scale:0,opacity:0,x:"-50%",y:"-50%",transition:{duration:.5,ease:"easeIn"}}:U==="reappearing"?{left:"60vw",top:"85vh",scale:.4,opacity:1,x:"-50%",y:"-50%",transition:{duration:.8,ease:"easeOut"}}:{left:"60vw",top:"85vh",scale:.4,opacity:1,x:"-50%",y:"-50%"},className:"fixed z-[10000]",style:{transformOrigin:"center"},children:V.jsx(eo.div,{onClick:U==="reappearing"||U==="final"?Jt:void 0,className:`w-[8vw] h-[8vw] transition-transform cursor-pointer bg-transparent ${U==="reappearing"||U==="final"?"ring-2 ring-yellow-400 ring-opacity-50 rounded-lg":""}`,"aria-label":p==="zh"?"":"View Letter",role:"button",tabIndex:U==="reappearing"||U==="final"?0:-1,whileHover:U==="reappearing"||U==="final"?{scale:1.15}:{},animate:U==="reappearing"||U==="final"?{y:[0,-5,0],transition:{duration:2,repeat:1/0,ease:"easeInOut"}}:{},style:{backgroundColor:"transparent",pointerEvents:U==="reappearing"||U==="final"?"auto":"none",position:"relative",zIndex:10001},children:V.jsx("img",{src:"/decorations/letter.jpeg",alt:p==="zh"?"":"Letter from Pet",className:"w-full h-full object-contain drop-shadow-lg transition-transform duration-200",style:{backgroundColor:"transparent"}})})})})]}),V.jsx(eo.div,{onClick:vt,className:"fixed bottom-8 right-8 z-40 w-[12vw] h-[12vw] cursor-pointer","aria-label":p==="zh"?"":"Open Journal",role:"button",tabIndex:0,initial:{scale:1,rotate:0},whileHover:{scale:1.1,rotate:2,transition:{duration:.3,ease:"easeOut"}},whileTap:{scale:.95,rotate:-2,transition:{duration:.1}},animate:D?{scale:[1,.9,1.2,.8],rotate:[0,-5,5,0],transition:{duration:.4,ease:"easeInOut"}}:{y:[0,-3,0],transition:{duration:3,repeat:1/0,ease:"easeInOut"}},onKeyDown:Ue=>{(Ue.key==="Enter"||Ue.key===" ")&&vt()},children:V.jsx(eo.img,{src:"/decorations/book.jpeg",alt:p==="zh"?"":"Journal",className:"w-full h-full object-contain drop-shadow-lg",animate:D?{rotateY:[0,180,0],transition:{duration:.6,ease:"easeInOut"}}:{}})}),C&&V.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",style:{background:"rgba(92, 90, 76, 0.15)",backdropFilter:"blur(9.399999618530273px)"},onClick:Ht,children:V.jsx("div",{className:"w-[65vw] h-[80vh] relative",style:{backgroundImage:"url(/decorations/letter_paper.jpeg)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},onClick:Ue=>Ue.stopPropagation(),children:V.jsxs("div",{className:"w-full h-full",style:{padding:"8vw"},children:[V.jsx("div",{className:"text-center mb-6",children:V.jsx("h2",{className:"text-2xl font-bold",style:{color:"#687949"},children:p==="zh"?`${((Ei=ce==null?void 0:ce.petCompanion)==null?void 0:Ei.name)||""}`:`Letter from ${((Kt=ce==null?void 0:ce.petCompanion)==null?void 0:Kt.name)||"Pet"}`})}),V.jsxs("div",{className:"flex gap-6 h-[calc(100%-120px)]",children:[V.jsx("div",{className:"w-[50%] flex items-start",children:V.jsx("div",{className:"w-full aspect-square  p-1 transform  relative",children:V.jsx("img",{src:"/decorations/photo.png",alt:"",className:"w-full h-full object-cover"})})}),V.jsxs("div",{className:"flex-1 flex flex-col",children:[V.jsxs("div",{className:"text-center mb-4",children:[V.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"#687949"},children:""}),V.jsx("div",{className:"text-sm",style:{color:"#A6A196"},children:"724 14:30   "})]}),V.jsxs("div",{className:"p-4 mb-4 flex-1 relative",style:{borderRadius:"25px",background:"#F9F2E2"},children:[V.jsx("div",{className:"absolute top-2 left-3 text-3xl opacity-50",style:{color:"#687949"},children:'"'}),V.jsx("div",{className:"text-sm leading-relaxed pt-4 px-2",style:{color:"#687949"},children:""}),V.jsx("div",{className:"absolute bottom-2 right-3 text-3xl opacity-50",style:{color:"#687949"},children:'"'})]}),V.jsx("div",{className:"h-px mb-4",style:{background:"#EADDC7"}}),V.jsxs("div",{className:"flex items-center justify-between mb-4",children:[V.jsxs("div",{className:"flex items-center gap-2",children:[V.jsx("span",{className:"text-sm",style:{color:"#A6A196"},children:""}),V.jsx("div",{className:"flex text-yellow-500",children:""})]}),V.jsx("div",{className:"px-3 py-2 flex items-center gap-2",style:{borderRadius:"17px",border:"3px solid #D9C6B1",background:"#FDF5E8",boxShadow:"0 2px 11.4px 3px rgba(123, 66, 15, 0.11)"},children:V.jsx("img",{src:"/decorations/image 93.png",alt:"",className:"w-6 h-6 object-contain"})})]}),V.jsxs("div",{className:"flex gap-3 mt-auto",children:[V.jsx("button",{className:"flex-1 py-3 px-4 rounded-[1vw] text-white font-medium transition-all hover:scale-105",style:{background:"#687949"},onClick:()=>{Ht(),u("/travel-journal")},children:p==="zh"?"":"Add to Journal"}),V.jsx("button",{className:"w-[4vw] h-[4vw] rounded-full flex items-center justify-center transition-all hover:scale-105",style:{background:"#D9C6B1"},title:p==="zh"?"":"Share","aria-label":p==="zh"?"":"Share letter",children:V.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:V.jsx("path",{d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z",stroke:"#687949",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]})]})]})})}),V.jsx(Lg,{children:D&&V.jsxs(V.Fragment,{children:[V.jsx(eo.div,{initial:{width:"12vw",height:"12vw",borderRadius:"50%",opacity:.8,scale:.8,x:0,y:0},animate:{width:"200vmax",height:"200vmax",borderRadius:"0%",opacity:.95,scale:1,x:"-50%",y:"-50%",transition:{duration:.8,ease:[.25,.46,.45,.94],borderRadius:{duration:.5,delay:.2},scale:{duration:.3},x:{duration:.8,ease:[.25,.46,.45,.94]},y:{duration:.8,ease:[.25,.46,.45,.94]}}},className:"fixed z-[25] bg-gradient-to-tl from-amber-50/90 to-orange-100/90",style:{bottom:"calc(2rem + 6vw)",right:"calc(2rem + 6vw)",transformOrigin:"bottom right",backdropFilter:"blur(2px)"}}),V.jsx(eo.div,{initial:{width:"8vw",height:"8vw",borderRadius:"50%",opacity:0,x:0,y:0},animate:{width:"200vmax",height:"200vmax",borderRadius:"0%",opacity:.7,x:"-50%",y:"-50%",transition:{duration:.9,delay:.1,ease:[.22,1,.36,1],x:{duration:.9,delay:.1,ease:[.22,1,.36,1]},y:{duration:.9,delay:.1,ease:[.22,1,.36,1]}}},className:"fixed z-[24] bg-gradient-to-tl from-yellow-50/60 to-amber-50/60",style:{bottom:"calc(2rem + 6vw)",right:"calc(2rem + 6vw)",transformOrigin:"bottom right",backgroundImage:"radial-gradient(circle at 85% 85%, rgba(255,255,255,0.2) 0%, transparent 50%)"}}),[...Array(6)].map((Ue,zt)=>V.jsx(eo.div,{initial:{x:"calc(100vw - 5rem)",y:"calc(100vh - 5rem)",rotate:0,opacity:0,scale:.5},animate:{x:`${Math.random()*80}vw`,y:`${Math.random()*80}vh`,rotate:-180+Math.random()*360,opacity:[0,.6,0],scale:[.5,1,.3],transition:{duration:1.2,delay:.2+zt*.1,ease:"easeOut"}},className:"fixed z-[23] w-6 h-6 bg-amber-100 rounded-sm shadow-sm",style:{background:"linear-gradient(45deg, #fef3c7, #fed7aa)",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"}},zt)),V.jsx(eo.div,{initial:{width:"6vw",height:"6vw",borderRadius:"50%",opacity:0,x:0,y:0},animate:{width:"40vw",height:"40vw",opacity:[0,.4,.2,0],x:"-50%",y:"-50%",transition:{duration:1.5,delay:.3,ease:"easeOut",x:{duration:1.5,delay:.3,ease:"easeOut"},y:{duration:1.5,delay:.3,ease:"easeOut"}}},className:"fixed z-[22]",style:{bottom:"calc(2rem + 6vw)",right:"calc(2rem + 6vw)",transformOrigin:"bottom right",background:"radial-gradient(circle, rgba(255, 243, 199, 0.6) 0%, rgba(254, 215, 170, 0.3) 40%, transparent 70%)",filter:"blur(20px)"}})]})}),V.jsx(Q8,{isOpen:Se,onClose:()=>ve(!1),onSave:Li,currentItem:et.dressUpItem||null,petName:(ce==null?void 0:ce.petCompanion.name)||""})]})},c4=({className:u="",petType:p="other"})=>{const[y]=Nn(pd),b=()=>{switch(p){case"cat":return"/decorations/cat.png";case"dog":return"/decorations/fox.png";default:return"/decorations/capybara.jpeg"}},C=()=>{if(y==="zh")switch(p){case"cat":return"";case"dog":return"";default:return""}else switch(p){case"cat":return"Cat";case"dog":return"Dog";default:return"Capybara"}};return V.jsxs(V.Fragment,{children:[V.jsx("style",{children:`
        @keyframes earthRotate {
          from {
            transform: rotate(0deg);
          }
          to {
            transform: rotate(360deg);
          }
        }
        
        @keyframes petSwing {
          0%, 100% {
            transform: translate(-50%, 0) rotate(-3deg);
          }
          50% {
            transform: translate(-50%, 0) rotate(3deg);
          }
        }
        
        .earth-rotating {
          animation: earthRotate 60s linear infinite;
        }
        
        .pet-swinging {
          animation: petSwing 4s ease-in-out infinite;
        }
      `}),V.jsxs("div",{className:`fixed bottom-[-15vw] left-1/2 transform -translate-x-1/2 z-30 w-[50vw] h-[50vw] pointer-events-none relative ${u}`,children:[V.jsx("img",{src:"/decorations/earth.jpeg",alt:y==="zh"?"":"Earth decoration",className:"w-full h-full object-contain drop-shadow-lg earth-rotating"}),V.jsx("div",{className:`absolute top-[-15%] left-1/2 animate-pulse pet-swinging ${p==="cat"||p==="dog"?"w-[12vw] h-[12vw]":"w-[15vw] h-[15vw]"}`,children:V.jsx("img",{src:b(),alt:C(),className:"w-full h-full object-contain drop-shadow-md"})})]})]})},eO=({className:u="",height:p="calc(100vh / 13)"})=>V.jsx("div",{className:`fixed bottom-0 left-0 w-full z-30 pointer-events-none ${u}`,style:{height:p,background:"linear-gradient(180deg, rgba(237, 232, 222, 0.00) 0%, #F4F0E7 94.71%)"}}),o3=()=>{const u=mc(),p=Ka(),[y]=Nn(pd),[b,C]=Fe.useState(!1),[M,D]=Fe.useState(null),[r,U]=Fe.useState(!1),{currentActivity:G}=p.state||{},Q=[{id:"1",title:"",date:"2025.2.6",location:" ",weather:" ",content:"",petImage:"/decorations/photo.png",backgroundImage:"/decorations/letter_paper.jpeg",rating:4,surprise:"/decorations/image 93.png",petName:"",cardImage:"/decorations/polaroid1.png"},{id:"2",title:"",date:"2025.2.5",location:" ",weather:" ",content:"",petImage:"/decorations/photo.png",backgroundImage:"/decorations/letter_paper.jpeg",rating:5,surprise:"/decorations/image 93.png",petName:"",cardImage:"/decorations/polaroid2.png"},{id:"3",title:"",date:"2025.2.4",location:" ",weather:" ",content:"",petImage:"/decorations/photo.png",backgroundImage:"/decorations/letter_paper.jpeg",rating:4,surprise:"/decorations/image 93.png",petName:"",cardImage:"/decorations/polaroid3.png"},{id:"4",title:"",date:"2025.2.3",location:" ",weather:" ",content:"",petImage:"/decorations/photo.png",backgroundImage:"/decorations/letter_paper.jpeg",rating:5,surprise:"/decorations/image 93.png",petName:"",cardImage:"/decorations/polaroid4.png"},{id:"5",title:"",date:"2025.2.2",location:" ",weather:" ",content:"",petImage:"/decorations/photo.png",backgroundImage:"/decorations/letter_paper.jpeg",rating:5,surprise:"/decorations/image 93.png",petName:"",cardImage:"/decorations/polaroid5.png"}],se=()=>{C(!0),setTimeout(()=>{u(-1)},800)},de=ce=>{D(ce),U(!0)},Pe=()=>{U(!1),D(null)},Se={initial:{clipPath:"circle(0% at 88% 88%)",opacity:0},animate:{clipPath:"circle(150% at 88% 88%)",opacity:1,transition:{duration:.8,ease:[.22,1,.36,1]}},exit:{clipPath:"circle(0% at 88% 88%)",opacity:0,transition:{duration:.6,ease:[.22,1,.36,1]}}},ve={hidden:{opacity:0,y:20,scale:.9},visible:ce=>({opacity:1,y:0,scale:1,transition:{delay:ce*.1,duration:.5,ease:"easeOut"}}),hover:{y:-5,scale:1.05,transition:{duration:.2,ease:"easeOut"}}};return V.jsxs(Sp,{children:[V.jsxs(eo.div,{variants:Se,initial:"initial",animate:b?"exit":"animate",className:"min-h-screen relative",children:[V.jsxs("div",{className:"absolute top-8 left-1/2 transform -translate-x-1/2 z-30 text-center",children:[V.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:"#687949"},children:y==="zh"?"":"Travel Journal"}),V.jsx("p",{className:"text-sm",style:{color:"#A6A196"},children:y==="zh"?"":"Record every beautiful travel memory"})]}),V.jsx("div",{className:"pt-32 pb-24 px-8",children:V.jsx("div",{className:"max-w-7xl mx-auto",children:V.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6",children:Q.map((ce,ze)=>V.jsx(eo.div,{custom:ze,variants:ve,initial:"hidden",animate:"visible",whileHover:"hover",className:"cursor-pointer",onClick:()=>de(ce),children:V.jsxs("div",{className:"relative",children:[V.jsxs("div",{className:"relative bg-white shadow-xl overflow-hidden polaroid-card",style:{transform:`rotate(${Math.random()*6-3}deg)`,borderRadius:"8px",border:"1px solid #e5e7eb",maxWidth:"280px",margin:"0 auto"},children:[V.jsx("div",{className:"relative",children:V.jsx("img",{src:ce.cardImage,alt:ce.title,className:"w-full h-auto object-cover",style:{borderRadius:"8px 8px 0 0"}})}),V.jsxs("div",{className:"p-4 bg-white",children:[V.jsxs("div",{className:"text-center",children:[V.jsx("h3",{className:"font-semibold text-lg mb-1",style:{color:"#687949"},children:ce.title}),V.jsxs("p",{className:"text-sm mb-2",style:{color:"#A6A196"},children:[ce.date,"  ",ce.location]}),V.jsx("p",{className:"text-xs",style:{color:"#A6A196"},children:ce.weather})]}),V.jsxs("div",{className:"flex justify-center gap-4 mt-3 pt-3 border-t border-gray-100",children:[V.jsx("div",{className:"w-6 h-6 text-gray-400",children:V.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:V.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})}),V.jsx("div",{className:"w-6 h-6 text-gray-400",children:V.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:V.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),V.jsx("div",{className:"w-6 h-6 text-gray-400",children:V.jsx("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:V.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})})})]})]})]}),V.jsx("div",{className:"absolute -top-2 -left-2 w-8 h-8 tape-decoration",style:{transform:"rotate(-15deg)"}}),V.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 tape-decoration",style:{transform:"rotate(10deg)"}}),V.jsx("div",{className:"absolute -top-3 right-4",children:V.jsx("div",{className:"w-4 h-8 clothespin"})})]})},ce.id))})})}),V.jsx("div",{className:"absolute bottom-[-60vh]",children:V.jsx(c4,{})}),V.jsx(eO,{}),V.jsx("div",{onClick:se,className:"fixed bottom-8 right-8 z-50 w-[12vw] h-[12vw] hover:scale-110 transition-transform cursor-pointer","aria-label":y==="zh"?"":"Go Back",role:"button",tabIndex:0,onKeyDown:ce=>{(ce.key==="Enter"||ce.key===" ")&&se()},children:V.jsx("img",{src:"/decorations/book.jpeg",alt:y==="zh"?"":"Journal",className:"w-full h-full object-contain drop-shadow-lg"})}),V.jsx(Lg,{children:r&&M&&V.jsx(eo.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",style:{background:"rgba(92, 90, 76, 0.15)",backdropFilter:"blur(9.399999618530273px)"},onClick:Pe,children:V.jsx(eo.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{duration:.3,ease:"easeOut"},className:"w-[65vw] h-[80vh] relative",style:{backgroundImage:`url(${M.backgroundImage})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},onClick:ce=>ce.stopPropagation(),children:V.jsxs("div",{className:"w-full h-full",style:{padding:"8vw"},children:[V.jsx("div",{className:"text-center mb-6",children:V.jsx("h2",{className:"text-2xl font-bold",style:{color:"#687949"},children:y==="zh"?`${M.petName}`:`Letter from ${M.petName}`})}),V.jsxs("div",{className:"flex gap-6 h-[calc(100%-120px)]",children:[V.jsx("div",{className:"w-[50%] flex items-start",children:V.jsx("div",{className:"w-full aspect-square p-1 transform relative",children:V.jsx("img",{src:M.cardImage,alt:"",className:"w-full h-full object-cover",style:{borderRadius:"8px"}})})}),V.jsxs("div",{className:"flex-1 flex flex-col",children:[V.jsxs("div",{className:"text-center mb-4",children:[V.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"#687949"},children:M.title}),V.jsxs("div",{className:"text-sm",style:{color:"#A6A196"},children:[M.date," ",M.location,"  ",M.weather]})]}),V.jsxs("div",{className:"p-4 mb-4 flex-1 relative",style:{borderRadius:"25px",background:"#F9F2E2"},children:[V.jsx("div",{className:"absolute top-2 left-3 text-3xl opacity-50",style:{color:"#687949"},children:'"'}),V.jsx("div",{className:"text-sm leading-relaxed pt-4 px-2",style:{color:"#687949"},children:M.content}),V.jsx("div",{className:"absolute bottom-2 right-3 text-3xl opacity-50",style:{color:"#687949"},children:'"'})]}),V.jsx("div",{className:"h-px mb-4",style:{background:"#EADDC7"}}),V.jsxs("div",{className:"flex items-center justify-between mb-4",children:[V.jsxs("div",{className:"flex items-center gap-2",children:[V.jsx("span",{className:"text-sm",style:{color:"#A6A196"},children:""}),V.jsx("div",{className:"flex text-yellow-500",children:"".repeat(M.rating)})]}),V.jsx("div",{className:"px-3 py-2 flex items-center gap-2",style:{borderRadius:"17px",border:"3px solid #D9C6B1",background:"#FDF5E8",boxShadow:"0 2px 11.4px 3px rgba(123, 66, 15, 0.11)"},children:V.jsx("img",{src:M.surprise,alt:"",className:"w-6 h-6 object-contain"})})]}),V.jsxs("div",{className:"flex gap-3 mt-auto",children:[V.jsx("button",{className:"flex-1 py-3 px-4 rounded-[1vw] text-white font-medium transition-all hover:scale-105",style:{background:"#687949"},onClick:Pe,children:y==="zh"?"":"Close"}),V.jsx("button",{className:"w-[4vw] h-[4vw] rounded-full flex items-center justify-center transition-all hover:scale-105",style:{background:"#D9C6B1"},title:y==="zh"?"":"Share","aria-label":y==="zh"?"":"Share letter",children:V.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:V.jsx("path",{d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z",stroke:"#687949",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]})]})]})})})})]},"travel-journal"),V.jsx("style",{children:`
        .polaroid-card {
          background: white;
          box-shadow: 
            0 4px 8px rgba(0,0,0,0.1),
            0 8px 16px rgba(0,0,0,0.1),
            0 16px 32px rgba(0,0,0,0.1);
          transition: all 0.3s ease;
        }
        
        .polaroid-card:hover {
          transform: translateY(-8px) rotate(0deg) !important;
          box-shadow: 
            0 8px 16px rgba(0,0,0,0.15),
            0 16px 32px rgba(0,0,0,0.15),
            0 32px 64px rgba(0,0,0,0.15);
        }
        
        .tape-decoration {
          background: linear-gradient(45deg, #fbbf24, #f59e0b);
          opacity: 0.7;
          border-radius: 2px;
          box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .clothespin {
          background: linear-gradient(to bottom, #8b5a2b, #a0522d);
          border-radius: 50%;
          box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
      `})]})},tO="/assets/%E6%9D%AD%E5%B7%9E-dqV8nLCN.png",iO="/assets/%E6%88%90%E9%83%BD-DQGK_K_A.jpg",nO="/assets/%E4%BA%AC%E9%83%BD-C5Gzb0l5.jpg",rO="/assets/%E6%96%B0%E5%8A%A0%E5%9D%A1-RDFaHU1G.jpg",sO="/assets/%E9%9D%92%E5%B2%9B-jQso_xw2.jpg",oO=[{id:"CN-ZJ",cityName:"",cityNameEn:"Hangzhou",image:tO,fallbackImage:"/city-images/.jpg"},{id:"CN-SC",cityName:"",cityNameEn:"Chengdu",image:iO,fallbackImage:"/city-images/.jpg"},{id:"JP",cityName:"",cityNameEn:"Kyoto",image:nO,fallbackImage:"/city-images/.jpg"},{id:"SG",cityName:"",cityNameEn:"Singapore",image:rO,fallbackImage:"/city-images/.jpg"},{id:"CN-QD",cityName:"",cityNameEn:"Qingdao",image:sO,fallbackImage:"/city-images/.jpg"}],a3=()=>{const u=mc(),[p]=Nn(pd),[y]=Nn(o1),[b,C]=Fe.useState(2),[M,D]=Fe.useState({}),r=Fe.useMemo(()=>oO.map(ve=>({...ve,regionData:a1[ve.id]})).filter(ve=>ve.regionData),[]),U=(Se,ve)=>{console.error(`: ${ve} (${Se})`),D(ce=>({...ce,[Se]:!0}))},G=Se=>{console.log(`: ${Se}`)},Q=()=>{const Se=[],ve=r.length;for(let ce=-2;ce<=2;ce++){const ze=(b+ce+ve)%ve;Se.push({...r[ze],position:ce,originalIndex:ze})}return Se},se=Se=>{const ve=r[Se];if(!ve){Dn.error(p==="zh"?"":"City data not found");return}Se===b?(Dn.success(`${p==="zh"?"":"Ready to go!"}`,{duration:1500,position:"top-center"}),setTimeout(()=>{u(`/trip-themes/${ve.id}`)},1e3)):C(Se)},de=()=>{u(-1)},Pe=Q();return V.jsx(Sp,{children:V.jsxs("div",{className:"min-h-screen relative overflow-hidden flex flex-col",children:[V.jsxs("div",{onClick:de,className:"absolute top-6 left-6 z-40 flex items-center gap-2 text-[#687949] bg-transparent p-2 rounded-lg cursor-pointer transform transition-transform duration-200 hover:scale-110",children:[V.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:V.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),V.jsx("span",{children:p==="zh"?"":"Back"})]}),V.jsxs("div",{className:"relative z-20 flex flex-col items-center flex-grow p-6 pt-16",children:[V.jsxs("div",{className:"text-center mb-12",children:[V.jsx("h1",{className:"wanderpaw-title text-4xl md:text-5xl font-bold text-[#687949] dark:text-amber-200 mb-4 transition-all duration-300 ease-in-out hover:scale-105",children:"WanderPaw"}),V.jsx("p",{className:"text-lg mb-4",style:{color:"#687949"},children:p==="zh"?"":"Choose the city you wish to explore"}),r[b]&&V.jsx("div",{className:"inline-block transition-all duration-500 ease-in-out animate-fadeIn",children:V.jsx("div",{className:"px-6 py-2 text-white rounded-full text-lg font-semibold shadow-lg transition-all duration-500 ease-in-out transform hover:scale-105 active:scale-95",style:{backgroundColor:"#687949"},children:p==="zh"?r[b].cityName:r[b].cityNameEn})},b)]}),V.jsxs("div",{className:"relative w-full max-w-6xl",style:{marginTop:"5vh"},children:[V.jsx("div",{className:"flex items-center justify-center space-x-8 transition-all duration-700 ease-in-out",children:Pe.map((Se,ve)=>{const ce=Se.position===0,ze=Math.abs(Se.position),et=ce?1.2:1-ze*.15,pt=ce?1:.4+.6/(ze+1),Tt=ce?20:10-ze,It=Se.position*10;return V.jsx("div",{className:"transition-all duration-700 ease-in-out cursor-pointer hover:scale-105 active:scale-95 transform-gpu",style:{transform:`scale(${et}) translateX(${It}px) translateZ(0)`,opacity:pt,zIndex:Tt,filter:ce?"blur(0px)":"blur(0.5px)"},onClick:()=>se(Se.originalIndex),children:V.jsxs("div",{className:"relative w-64 h-64 group",children:[V.jsx("div",{className:"w-full h-full rounded-2xl overflow-hidden transition-all duration-700 ease-in-out",children:V.jsx("img",{src:M[Se.id]?Se.fallbackImage:Se.image,alt:p==="zh"?Se.cityName:Se.cityNameEn,className:`w-full h-full object-cover transition-all duration-700 ease-in-out transform-gpu ${ce?"brightness-110 saturate-110 scale-105":"brightness-75 saturate-75 scale-100 group-hover:brightness-90 group-hover:saturate-90 group-hover:scale-102"}`,onError:()=>U(Se.id,Se.cityName),onLoad:()=>G(Se.cityName)})}),ce&&V.jsx("div",{className:"absolute inset-0 rounded-2xl border-2 border-white/30 animate-pulse"})]})},`${Se.id}-${Se.position}`)})}),V.jsx("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 flex space-x-2",children:r.map((Se,ve)=>V.jsx("button",{onClick:()=>C(ve),className:`w-3 h-3 rounded-full transition-all duration-500 ease-in-out transform hover:scale-110 active:scale-95 ${ve===b?"bg-white/90 scale-125 shadow-lg":"bg-white/50 hover:bg-white/70 scale-100"}`},ve))})]})]}),V.jsx("div",{className:"absolute bottom-[-60vh] left-0 w-full h-full",children:V.jsx(c4,{petType:y.type==="none"?"other":y.type||"other"})})]})})},aO=()=>{const u=mc(),p=()=>{u("/city-selection")};return V.jsxs("svg",{onClick:p,className:"fixed bottom-5 right-6 z-50 cursor-pointer transform transition-transform duration-200 hover:scale-110",width:"250",height:"63",viewBox:"0 0 459 110",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-label":"",children:[V.jsx("g",{clipPath:"url(#clip0_5036_9983)",children:V.jsx("path",{d:"M430 68.6025L409.99 87.3438C409.399 87.8966 408.612 88.1918 407.803 88.1647C406.994 88.1375 406.229 87.79 405.676 87.1987C405.123 86.6075 404.828 85.8208 404.855 85.0118C404.883 84.2029 405.23 83.4378 405.821 82.885L423.294 66.5L405.64 49.825C405.049 49.2722 404.701 48.5071 404.674 47.6982C404.647 46.8892 404.942 46.1025 405.495 45.5112C406.048 44.92 406.813 44.5725 407.622 44.5453C408.431 44.5182 409.218 44.8134 409.809 45.3662L430 64.1437C430.306 64.4287 430.551 64.7738 430.718 65.1573C430.885 65.5409 430.971 65.9548 430.971 66.3731C430.971 66.7915 430.885 67.2054 430.718 67.5889C430.551 67.9725 430.306 68.3175 430 68.6025ZM415.5 23C406.897 23 398.486 25.5512 391.333 30.3311C384.179 35.1109 378.604 41.9047 375.311 49.8533C372.019 57.8019 371.157 66.5483 372.836 74.9864C374.514 83.4246 378.657 91.1756 384.741 97.2591C390.824 103.343 398.575 107.486 407.014 109.164C415.452 110.843 424.198 109.981 432.147 106.689C440.095 103.396 446.889 97.8208 451.669 90.6673C456.449 83.5138 459 75.1035 459 66.5C459 54.9631 454.417 43.8987 446.259 35.7409C438.101 27.583 427.037 23 415.5 23Z",fill:"#687949"})}),V.jsx("line",{x1:"372",y1:"69",x2:"1.74846e-07",y2:"69",stroke:"#687949",strokeWidth:"4",strokeDasharray:"28 8"}),V.jsx("path",{d:"M2.142 12.324H39.816V16.608H22.092V21.732C27.216 24.168 32.382 26.982 37.632 30.09L34.986 34.038C29.82 30.762 25.536 28.2 22.092 26.436V49.368H17.682V16.608H2.142V12.324ZM43.89 27.402H82.068V31.77H43.89V27.402ZM104.748 20.64C103.446 24.588 101.808 27.696 99.792 29.964L96.138 27.402C99.456 23.286 101.598 17.574 102.564 10.224L106.932 10.938C106.638 12.87 106.302 14.718 105.924 16.398H123.312V19.296C122.43 22.824 121.296 26.31 119.868 29.796L115.542 28.578C116.718 26.31 117.726 23.664 118.566 20.64H104.748ZM107.94 22.992H112.224C112.224 25.176 112.098 27.234 111.888 29.166C114.24 36.306 118.566 41.934 124.782 46.134L121.884 49.494C116.97 45.714 113.19 41.094 110.586 35.676L110.082 37.188C108.402 42.144 104.37 46.302 97.986 49.578L95.088 46.05C100.59 43.278 104.202 39.96 105.924 36.012C107.184 32.652 107.856 28.284 107.94 22.992ZM89.25 12.03C92.358 15.348 94.752 18.246 96.432 20.766L92.988 23.16C91.182 20.472 88.746 17.49 85.722 14.256L89.25 12.03ZM92.778 30.174L96.642 31.644C94.458 37.524 92.064 43.026 89.376 48.15L85.302 46.302C88.158 41.052 90.678 35.676 92.778 30.174ZM134.148 38.658C135.282 38.658 136.248 39.12 137.004 40.044C137.718 40.968 138.096 42.186 138.096 43.656C138.096 45.882 137.424 47.814 136.164 49.494C134.862 51.132 133.098 52.266 130.914 52.896V50.124C132.048 49.704 133.014 49.032 133.812 48.108C134.568 47.1 134.904 46.134 134.904 45.126C134.652 45.21 134.316 45.294 133.854 45.294C132.93 45.294 132.174 44.958 131.544 44.328C130.914 43.698 130.62 42.9 130.62 41.976C130.62 40.968 130.956 40.17 131.628 39.582C132.258 38.952 133.098 38.658 134.148 38.658ZM189.462 29.586V34.038C187.236 34.794 184.926 35.466 182.49 36.096V44.622C182.49 47.394 181.02 48.822 178.08 48.822H173.334L172.368 44.664C173.838 44.832 175.224 44.916 176.568 44.916C177.534 44.916 178.038 44.412 178.038 43.488V37.146C175.602 37.65 173.124 38.112 170.52 38.532L169.89 34.122C172.746 33.702 175.476 33.198 178.038 32.652V25.428H169.848V21.228H178.038V17.322C176.022 17.742 173.964 18.078 171.78 18.372L170.856 14.214C176.652 13.584 181.86 12.366 186.396 10.518L187.908 14.634C186.186 15.264 184.38 15.81 182.49 16.314V21.228H191.1C190.848 17.994 190.764 14.424 190.764 10.56H195.174C195.216 14.592 195.342 18.12 195.594 21.228H208.152V25.428H195.93C196.182 28.158 196.56 30.384 197.022 32.148C197.19 32.82 197.358 33.408 197.526 33.996C199.248 31.854 200.76 29.46 202.02 26.856L205.8 28.872C203.952 32.652 201.726 35.97 199.164 38.742C199.584 39.75 200.046 40.632 200.508 41.304C201.684 43.152 202.608 44.076 203.196 44.076C203.658 44.076 204.12 41.934 204.624 37.734L208.53 39.792C207.438 45.798 205.884 48.822 203.826 48.822C201.978 48.822 200.046 47.562 198.072 45.084C197.316 44.118 196.602 43.026 195.972 41.766C193.116 44.118 189.924 45.966 186.438 47.31L184.002 43.572C187.866 42.144 191.268 40.128 194.166 37.524C193.704 36.18 193.284 34.794 192.906 33.366C192.276 31.098 191.814 28.452 191.478 25.428H182.49V31.644C184.926 31.014 187.278 30.342 189.462 29.586ZM199.794 10.938C202.734 12.786 205.254 14.634 207.354 16.482L204.204 19.632C202.482 17.784 200.046 15.852 196.854 13.752L199.794 10.938ZM244.104 49.032H240.408L239.232 44.916L243.222 45.042C244.23 45.042 244.734 44.37 244.734 43.026V16.986H235.2V12.744H249.102V44.244C249.102 47.436 247.422 49.032 244.104 49.032ZM230.118 10.476C231.966 12.87 233.352 14.97 234.36 16.776L230.916 19.17C229.908 17.154 228.522 14.97 226.758 12.576L230.118 10.476ZM220.836 10.098L224.826 11.988C223.734 15.222 222.348 18.33 220.626 21.312V49.452H216.258V27.57C215.124 28.956 213.906 30.3 212.646 31.644L211.218 27.15C215.544 22.32 218.736 16.65 220.836 10.098ZM224.49 17.616H228.816V49.368H224.49V17.616ZM280.854 32.904C285.138 38.364 288.414 43.068 290.682 47.1L286.944 49.704C286.314 48.57 285.642 47.436 284.97 46.302C275.31 47.142 266.154 47.814 257.502 48.276L256.788 44.706C260.19 42.9 263.634 38.616 267.162 31.854H254.142V27.57H270.774V21.06H256.746V16.818H270.774V10.602H275.226V16.818H289.17V21.06H275.226V27.57H291.816V31.854H272.076C269.472 37.23 266.826 41.304 264.222 44.16C272.748 43.572 278.88 43.068 282.66 42.648C281.064 40.254 279.3 37.776 277.326 35.172L280.854 32.904ZM306.894 13.668V42.522H300.678V45.966H296.814V13.668H306.894ZM300.678 38.826H303.114V17.448H300.678V38.826ZM308.196 21.48H310.506V15.894H308.154V12.03H320.46C320.46 28.83 320.292 39.162 320.04 43.026C319.704 46.932 318.276 48.906 315.714 48.906C315.168 48.906 314.244 48.822 312.984 48.654L312.06 44.916C313.194 45 314.16 45.084 315 45.084C315.84 45.084 316.302 43.866 316.47 41.43C316.512 40.38 316.554 38.196 316.596 34.92H313.53C312.69 40.926 311.094 45.63 308.658 48.99L305.592 46.344C307.608 43.572 309.036 39.75 309.792 34.92H308.112V31.056H310.254C310.38 29.25 310.464 27.36 310.506 25.344H308.196V21.48ZM316.638 31.056V25.344H314.16C314.118 27.36 314.034 29.25 313.908 31.056H316.638ZM316.638 21.48C316.638 19.716 316.638 17.826 316.68 15.894H314.16V21.48H316.638ZM322.308 11.988H333.732V15.138C333.06 18.75 332.22 22.488 331.296 26.436C333.06 30.468 334.068 33.912 334.236 36.852C334.236 39.288 333.9 40.968 333.228 41.976C332.22 43.278 330.456 43.95 328.02 43.992L326.676 39.96C327.852 40.086 328.818 40.17 329.616 40.17C329.868 40.044 330.078 39.792 330.204 39.372C330.288 38.868 330.372 38.028 330.372 36.852C330.372 33.912 329.406 30.636 327.474 27.024C328.566 22.824 329.364 19.044 329.91 15.684H326.172V49.284H322.308V11.988ZM346.962 14.424C349.692 14.424 351.918 15.138 353.598 16.65C355.278 18.12 356.118 20.136 356.118 22.698C356.118 24.798 355.572 26.52 354.564 27.864C354.186 28.284 352.968 29.418 350.952 31.182C350.196 31.812 349.65 32.526 349.272 33.282C348.852 34.122 348.642 35.004 348.642 36.012V36.6H343.812V36.012C343.812 34.416 344.064 33.03 344.652 31.896C345.198 30.762 346.836 28.998 349.566 26.562L350.07 25.974C350.826 25.05 351.204 24.042 351.204 22.992C351.204 21.606 350.784 20.514 350.028 19.716C349.23 18.918 348.096 18.54 346.668 18.54C344.82 18.54 343.518 19.086 342.72 20.262C342.006 21.228 341.67 22.614 341.67 24.378H336.882C336.882 21.27 337.764 18.834 339.612 17.07C341.418 15.306 343.854 14.424 346.962 14.424ZM346.206 38.658C347.13 38.658 347.928 38.952 348.558 39.54C349.146 40.128 349.482 40.884 349.482 41.808C349.482 42.732 349.146 43.53 348.516 44.118C347.886 44.706 347.13 45 346.206 45C345.282 45 344.526 44.664 343.896 44.076C343.266 43.488 342.972 42.732 342.972 41.808C342.972 40.884 343.266 40.128 343.896 39.54C344.526 38.952 345.282 38.658 346.206 38.658Z",fill:"#687949"}),V.jsx("defs",{children:V.jsx("clipPath",{id:"clip0_5036_9983",children:V.jsx("rect",{width:"87",height:"87",fill:"white",transform:"translate(372 23)"})})})]})};function lO(){return V.jsx(V.Fragment,{children:V.jsxs(VM,{children:[V.jsx("div",{className:"flex min-h-screen flex-col",children:V.jsx(P5,{children:V.jsx(cO,{})})}),V.jsx(o5,{})]})})}const cO=()=>{const u=Ka(),p=u.pathname==="/auth",y=u.pathname==="/pet-initialization",b=u.pathname==="/city-selection"||u.pathname.startsWith("/trip-themes/")||u.pathname==="/trip-plan"||u.pathname==="/trip-journey"||u.pathname==="/travel-journal";return V.jsx("main",{className:"h-screen w-screen grow",children:p||y?V.jsxs("div",{className:"w-full h-screen",children:[V.jsxs(J2,{children:[V.jsx(Ns,{path:"/",element:V.jsx(Dg,{to:"/home",replace:!0})}),V.jsx(Ns,{path:"/auth",element:V.jsx(GS,{children:V.jsx(YS,{})})}),V.jsx(Ns,{path:"/pet-initialization",element:V.jsx(Za,{children:V.jsx(KS,{})})}),V.jsx(Ns,{path:"/home",element:V.jsx(Za,{children:V.jsx(qS,{})})}),V.jsx(Ns,{path:"/setting",element:V.jsx(Za,{children:V.jsx(XS,{})})}),V.jsx(Ns,{path:"/city-selection",element:V.jsx(Za,{children:V.jsx(a3,{})})}),V.jsx(Ns,{path:"/trip-themes/:cityId",element:V.jsx(Za,{children:V.jsx(e3,{})})}),V.jsx(Ns,{path:"/trip-plan",element:V.jsx(Za,{children:V.jsx(r3,{})})}),V.jsx(Ns,{path:"/trip-journey",element:V.jsx(Za,{children:V.jsx(s3,{})})}),V.jsx(Ns,{path:"/travel-journal",element:V.jsx(o3,{})})]}),V.jsx("div",{children:V.jsx(cT,{position:"top-center"})})]}):V.jsxs("div",{className:"fixed inset-0 flex justify-center  bg-[#f4f4f4] dark:bg-[#303133] bg-dot-black/[0.5] dark:bg-dot-white/[0.5]",children:[V.jsx("div",{className:" pointer-events-none absolute inset-0 z-0 flex items-center justify-center bg-[#f4f4f4] dark:bg-[#303133] [mask-image:radial-gradient(ellipse_at_center,transparent_20%,black)] dark:[mask-image:radial-gradient(ellipse_at_center,transparent_30%,white)] "}),V.jsx("div",{className:"flex w-full  h-screen z-10 overflow-y-auto",children:V.jsx("div",{className:"ring-1 ring-zinc-100 dark:ring-zinc-400/20 w-full bg-transparent",children:V.jsxs(J2,{children:[V.jsx(Ns,{path:"/",element:V.jsx(Dg,{to:"/home",replace:!0})}),V.jsx(Ns,{path:"/auth",element:V.jsx(GS,{children:V.jsx(YS,{})})}),V.jsx(Ns,{path:"/pet-initialization",element:V.jsx(Za,{children:V.jsx(KS,{})})}),V.jsx(Ns,{path:"/home",element:V.jsx(Za,{children:V.jsx(qS,{})})}),V.jsx(Ns,{path:"/setting",element:V.jsx(Za,{children:V.jsx(XS,{})})}),V.jsx(Ns,{path:"/city-selection",element:V.jsx(Za,{children:V.jsx(a3,{})})}),V.jsx(Ns,{path:"/trip-themes/:cityId",element:V.jsx(Za,{children:V.jsx(e3,{})})}),V.jsx(Ns,{path:"/trip-plan",element:V.jsx(Za,{children:V.jsx(r3,{})})}),V.jsx(Ns,{path:"/trip-journey",element:V.jsx(Za,{children:V.jsx(s3,{})})}),V.jsx(Ns,{path:"/travel-journal",element:V.jsx(o3,{})})]})})}),V.jsx("div",{children:V.jsx(cT,{position:"top-center"})}),V.jsx(c8,{}),!b&&V.jsx(aO,{})]})})};IP.createRoot(document.getElementById("root")).render(V.jsx(lO,{}));
